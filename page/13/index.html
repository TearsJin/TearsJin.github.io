<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="222222"/><link rel="alternate" href="/atom.xml" title="K1rit0's Blog" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="http://tearsjin.github.io/page/13/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" /><script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":true};
</script>

    <title>K1rit0's Blog</title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">K1rit0's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archives
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">K1rit0's Blog</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            Categories
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            About
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><section id="posts" class="posts"><article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2021/01/18/writeup-for-2020-starCTF/">writeup for 2020 starCTF Crypto</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2021-01-18
        </span><span class="post-category">
            <a href="/categories/WriteUp/">WriteUp</a>
            </span>
        </div>
    </header>

    <div class="post-content"><blockquote>
<p>总之就是吃老本<br>总之就是曲线好难<br>这次就差一道MyCurve…找个师傅学习学习再补充这个</p>
</blockquote>
<p>Crypto</p>
<ul>
<li>MyEnc</li>
<li>GuessKey2</li>
<li>little case</li>
<li>MyCurve</li>
</ul>
<h1 id="MyEnc"><a href="#MyEnc" class="headerlink" title="MyEnc"></a>MyEnc</h1><p>nc 52.163.228.53 8081<br>附件:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime,bytes_to_long</span><br><span class="line"><span class="keyword">import</span> time,urandom</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line">iv=bytes_to_long(urandom(<span class="number">256</span>))</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag)==<span class="number">15</span></span><br><span class="line">keystream=<span class="built_in">bin</span>(<span class="built_in">int</span>(flag.encode(<span class="string">&#x27;hex&#x27;</span>),<span class="number">16</span>))[<span class="number">2</span>:].rjust(<span class="number">8</span>*<span class="built_in">len</span>(flag),<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">p=getPrime(<span class="number">1024</span>)</span><br><span class="line">q=getPrime(<span class="number">1024</span>)</span><br><span class="line">n=p*q</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;n:&quot;</span>,n</span><br><span class="line">cnt=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&#x27;give me a number:&#x27;</span></span><br><span class="line">		m=<span class="built_in">int</span>(raw_input())</span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	ct=iv</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">8</span>):</span><br><span class="line">		<span class="keyword">if</span> keystream[cnt]==<span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">			ct+=<span class="built_in">pow</span>(m^q,i**i**i,n)</span><br><span class="line">			ct%=n</span><br><span class="line">		cnt=(cnt+<span class="number">1</span>)%<span class="built_in">len</span>(keystream)</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;done:&quot;</span>,ct</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>stream cipher的味道<br>flag 即 keystream 共120位<br>每次输入一个m , 根据key的7位返回一个ct<br>第1个m对应key的0<del>6<br>第2个m对应key的7</del>13<br>…<br>第17个m对应key的112<del>118<br>第18个m对应key的119</del>5<br>…<br>120个m则会回到刚开始一样</p>
<p>而重复传同样的m的时候, 如果取key的7位是相同的, 那么返回的ct也是相同的, 根据这个特点, 重复传120个m=0, 可以得到一些返回相同ct的7位, 也就是key里面相同的两个7位</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">printable = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line"></span><br><span class="line">con = remote(<span class="string">&#x27;52.163.228.53&#x27;</span>, <span class="number">8081</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof</span>(<span class="params">END, SHA</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> printable:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> printable:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> printable:</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> printable:</span><br><span class="line">                    start = i + j + k + l</span><br><span class="line">                    ensha = sha256((start + END).encode()).hexdigest()</span><br><span class="line">                    <span class="keyword">if</span> ensha == SHA:</span><br><span class="line">                        print(start)</span><br><span class="line">                        <span class="keyword">return</span> start.encode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">resp = con.recvuntil(<span class="string">&#x27;xxxx:&#x27;</span>).decode()</span><br><span class="line">END = re.findall(<span class="string">r&#x27;xxxx\+(.*)\) ==&#x27;</span>, resp)[<span class="number">0</span>]</span><br><span class="line">SHA = re.findall(<span class="string">r&#x27;== (.*)&#x27;</span>, resp)[<span class="number">0</span>]</span><br><span class="line">print(resp)</span><br><span class="line">resp = con.recv().decode()</span><br><span class="line">print(resp)</span><br><span class="line">con.sendline(proof(END, SHA))</span><br><span class="line"></span><br><span class="line">resp = con.recvuntil(<span class="string">&#x27;number:&#x27;</span>).decode()</span><br><span class="line">print(resp)</span><br><span class="line"></span><br><span class="line">arr = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">120</span>):</span><br><span class="line">    con.sendline(<span class="string">&#x27;0&#x27;</span>.encode())</span><br><span class="line">    resp = con.recvuntil(<span class="string">&#x27;number:&#x27;</span>).decode()</span><br><span class="line">    num = <span class="built_in">int</span>(resp[<span class="number">6</span>:-<span class="number">17</span>])</span><br><span class="line">    <span class="keyword">if</span> num <span class="keyword">not</span> <span class="keyword">in</span> arr:</span><br><span class="line">        arr.append(num)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        arr.append(-<span class="number">1</span>)</span><br><span class="line">        print(_, arr.index(num))</span><br></pre></td></tr></table></figure>
<p>得到的输出为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">15 12</span><br><span class="line">26 14</span><br><span class="line">32 1</span><br><span class="line">37 9</span><br><span class="line">43 31</span><br><span class="line">52 51</span><br><span class="line">54 14</span><br><span class="line">60 48</span><br><span class="line">69 58</span><br><span class="line">71 31</span><br><span class="line">76 39</span><br><span class="line">77 65</span><br><span class="line">80 8</span><br><span class="line">81 38</span><br><span class="line">82 48</span><br><span class="line">85 63</span><br><span class="line">86 31</span><br><span class="line">88 48</span><br><span class="line">90 7</span><br><span class="line">92 17</span><br><span class="line">93 56</span><br><span class="line">94 2</span><br><span class="line">96 64</span><br><span class="line">98 70</span><br><span class="line">99 0</span><br><span class="line">100 12</span><br><span class="line">103 48</span><br><span class="line">104 12</span><br><span class="line">105 65</span><br><span class="line">106 49</span><br><span class="line">110 73</span><br><span class="line">112 72</span><br><span class="line">114 78</span><br><span class="line">115 87</span><br><span class="line">117 29</span><br><span class="line">118 83</span><br></pre></td></tr></table></figure>
<p>第一行的15 12代表着, key的15* 7<del>15* 7+6 == 12* 7</del>12* 7+6<br>也就是<code>key[105:112] == key[84:91]</code><br>每一行都能构造出这么一个等式</p>
<p>根据所有等式, 可以将后面的一些位数用前面的位数表示(他们都是相等的)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">15</span>, <span class="number">12</span>, <span class="number">26</span>, <span class="number">14</span>, <span class="number">32</span>, <span class="number">1</span>, <span class="number">37</span>, <span class="number">9</span>, <span class="number">43</span>, <span class="number">31</span>, <span class="number">52</span>, <span class="number">51</span>, <span class="number">54</span>, <span class="number">14</span>, <span class="number">60</span>, <span class="number">48</span>, <span class="number">69</span>, <span class="number">58</span>, <span class="number">71</span>, <span class="number">31</span>, <span class="number">76</span>, <span class="number">39</span>, <span class="number">77</span>, <span class="number">65</span>, <span class="number">80</span>, <span class="number">8</span>, <span class="number">81</span>, <span class="number">38</span>, <span class="number">82</span>,</span><br><span class="line">       <span class="number">48</span>, <span class="number">85</span>, <span class="number">63</span>, <span class="number">86</span>, <span class="number">31</span>, <span class="number">88</span>, <span class="number">48</span>, <span class="number">90</span>, <span class="number">7</span>, <span class="number">92</span>, <span class="number">17</span>, <span class="number">93</span>, <span class="number">56</span>, <span class="number">94</span>, <span class="number">2</span>, <span class="number">96</span>, <span class="number">64</span>, <span class="number">98</span>, <span class="number">70</span>, <span class="number">99</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">12</span>, <span class="number">103</span>, <span class="number">48</span>, <span class="number">104</span>, <span class="number">12</span>, <span class="number">105</span>,</span><br><span class="line">       <span class="number">65</span>, <span class="number">106</span>, <span class="number">49</span>, <span class="number">110</span>, <span class="number">73</span>, <span class="number">112</span>, <span class="number">72</span>, <span class="number">114</span>, <span class="number">78</span>, <span class="number">115</span>, <span class="number">87</span>, <span class="number">117</span>, <span class="number">29</span>, <span class="number">118</span>, <span class="number">83</span>]</span><br><span class="line"></span><br><span class="line">key = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">120</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(arr), <span class="number">2</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (j, k) <span class="keyword">in</span> <span class="built_in">zip</span>(<span class="built_in">range</span>((arr[i + <span class="number">1</span>] * <span class="number">7</span>), (arr[i + <span class="number">1</span>] * <span class="number">7</span> + <span class="number">7</span>)), <span class="built_in">range</span>((arr[i] * <span class="number">7</span>), (arr[i] * <span class="number">7</span> + <span class="number">7</span>))):</span><br><span class="line">            <span class="keyword">if</span> key[j % <span class="number">120</span>] &lt; key[k % <span class="number">120</span>]:</span><br><span class="line">                key[k % <span class="number">120</span>] = key[j % <span class="number">120</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                key[j % <span class="number">120</span>] = key[k % <span class="number">120</span>]</span><br><span class="line">print(key)</span><br></pre></td></tr></table></figure>
<p>然后! 就能把key还原成:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[0, 0, 2, 0, 2, 0, 2, 0, 0, 2, 0, 0, 0, 0, 2, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 2, 0, 0, 0, 2, 2, 0, 0, 2, 34, 35, 36, 0, 2, 2, 40, 41, 42, 43, 2, 0, 0, 2, 0, 2, 0, 0, 2, 34, 35, 36, 0, 2, 2, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 2, 2, 2, 0, 0, 2, 2, 0, 0, 0, 0, 0, 2, 2, 2, 0, 2, 0, 0, 0, 0, 2, 2, 0, 0, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 2, 0, 0, 0, 0, 2, 0, 113, 114, 2, 2, 2, 0, 2]</span><br></pre></td></tr></table></figure>
<p>0和2分别代表着1或者0(不确定是0对应1还是2对应1<br>而其他的比较大的数则是未知的, 一共12位,<br>所以只需要爆破2^12次, 然后再猜一下0对应的是1还是0<br>这里直接猜0对应0, 中啦!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">    <span class="keyword">if</span> key[i] == <span class="number">0</span>:</span><br><span class="line">        key[i] = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> key[i] == <span class="number">2</span>:</span><br><span class="line">        key[i] = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        key[i] = <span class="string">&#x27;&#123;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">key = <span class="string">&#x27;&#x27;</span>.join(key)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> MyCrypto.Conversion <span class="keyword">import</span> bin2text</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> ** <span class="number">12</span>):</span><br><span class="line">    pad = <span class="built_in">bin</span>(i)[<span class="number">2</span>:].zfill(<span class="number">12</span>)</span><br><span class="line">    keystream = key.<span class="built_in">format</span>(pad[<span class="number">0</span>], pad[<span class="number">1</span>], pad[<span class="number">2</span>], pad[<span class="number">3</span>], pad[<span class="number">4</span>], pad[<span class="number">5</span>], pad[<span class="number">6</span>], pad[<span class="number">7</span>], pad[<span class="number">8</span>], pad[<span class="number">9</span>], pad[<span class="number">10</span>], pad[<span class="number">11</span>])</span><br><span class="line">    flag = bin2text(keystream)</span><br><span class="line">    <span class="keyword">if</span> flag[<span class="number">0</span>] == <span class="string">&#x27;*&#x27;</span> <span class="keyword">and</span> flag[-<span class="number">1</span>] == <span class="string">&#x27;&#125;&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;&#123;&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        print(flag)</span><br></pre></td></tr></table></figure>
<p>得到的输出:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">*CTF&#123;	HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;	IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;	JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;	KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;	LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;	MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;	NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;	OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;)OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;9OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IHuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IIuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IJuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IKuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ILuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IMuG0t1T!&#125;</span><br><span class="line">*CTF&#123;INuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IOuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YHuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YIuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YJuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YKuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YLuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YMuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YNuG0t1T!&#125;</span><br><span class="line">*CTF&#123;YOuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iHuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iIuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iJuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iKuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iLuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iMuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iNuG0t1T!&#125;</span><br><span class="line">*CTF&#123;iOuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yHuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yIuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yJuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yKuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yLuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yMuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yNuG0t1T!&#125;</span><br><span class="line">*CTF&#123;yOuG0t1T!&#125;</span><br><span class="line">*CTF&#123;HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;©HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;©IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;©JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;©KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;©LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;©MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;©NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;©OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;¹HuG0t1T!&#125;</span><br><span class="line">*CTF&#123;¹IuG0t1T!&#125;</span><br><span class="line">*CTF&#123;¹JuG0t1T!&#125;</span><br><span class="line">*CTF&#123;¹KuG0t1T!&#125;</span><br><span class="line">*CTF&#123;¹LuG0t1T!&#125;</span><br><span class="line">*CTF&#123;¹MuG0t1T!&#125;</span><br><span class="line">*CTF&#123;¹NuG0t1T!&#125;</span><br><span class="line">*CTF&#123;¹OuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÉHuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÉIuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÉJuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÉKuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÉLuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÉMuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÉNuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÉOuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÙHuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÙIuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÙJuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÙKuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÙLuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÙMuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÙNuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ÙOuG0t1T!&#125;</span><br><span class="line">*CTF&#123;éHuG0t1T!&#125;</span><br><span class="line">*CTF&#123;éIuG0t1T!&#125;</span><br><span class="line">*CTF&#123;éJuG0t1T!&#125;</span><br><span class="line">*CTF&#123;éKuG0t1T!&#125;</span><br><span class="line">*CTF&#123;éLuG0t1T!&#125;</span><br><span class="line">*CTF&#123;éMuG0t1T!&#125;</span><br><span class="line">*CTF&#123;éNuG0t1T!&#125;</span><br><span class="line">*CTF&#123;éOuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ùHuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ùIuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ùJuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ùKuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ùLuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ùMuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ùNuG0t1T!&#125;</span><br><span class="line">*CTF&#123;ùOuG0t1T!&#125;</span><br></pre></td></tr></table></figure>
<p>还好小学读过英语, 根据语义猜测flag在<code>*CTF&#123;YOuG0t1T!&#125;</code>和<code>*CTF&#123;yOuG0t1T!&#125;</code>之中</p>
<blockquote>
<p>猜猜是哪个呀</p>
</blockquote>
<h1 id="GuessKey2"><a href="#GuessKey2" class="headerlink" title="GuessKey2"></a>GuessKey2</h1><blockquote>
<p>关于出题人忘记把key注释掉多了一题GuessKey2那件事</p>
</blockquote>
<p>nc 52.163.228.53 8080<br>附件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line">N=<span class="number">64</span></span><br><span class="line">key=randint(<span class="number">0</span>,<span class="number">2</span>**N)</span><br><span class="line"><span class="built_in">print</span> key</span><br><span class="line">key=<span class="built_in">bin</span>(key)[<span class="number">2</span>:].rjust(N,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">count=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	p=<span class="number">0</span></span><br><span class="line">	q=<span class="number">0</span></span><br><span class="line">	new_key=<span class="string">&#x27;&#x27;</span></span><br><span class="line">	zeros=[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">		<span class="keyword">if</span> key[j]==<span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">			zeros.append(j)</span><br><span class="line">	p=zeros[randint(<span class="number">0</span>,<span class="built_in">len</span>(zeros))-<span class="number">1</span>]</span><br><span class="line">	q=zeros[randint(<span class="number">0</span>,<span class="built_in">len</span>(zeros))-<span class="number">1</span>]</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		mask=<span class="built_in">int</span>(raw_input(<span class="string">&quot;mask:&quot;</span>))</span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		exit(<span class="number">0</span>)</span><br><span class="line">	mask=<span class="built_in">bin</span>(mask)[<span class="number">2</span>:]</span><br><span class="line">	<span class="keyword">if</span> p&gt;q:</span><br><span class="line">		tmp=q</span><br><span class="line">		q=p</span><br><span class="line">		p=tmp</span><br><span class="line">	cnt=<span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,N):</span><br><span class="line">		<span class="keyword">if</span> j <span class="keyword">in</span> <span class="built_in">range</span>(p,q+<span class="number">1</span>):</span><br><span class="line">			new_key+=<span class="built_in">str</span>(<span class="built_in">int</span>(mask[cnt])^<span class="built_in">int</span>(key[j]))</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			new_key+=key[j]</span><br><span class="line">		cnt+=<span class="number">1</span></span><br><span class="line">		cnt%=<span class="built_in">len</span>(mask)</span><br><span class="line">	key=new_key</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		guess=<span class="built_in">int</span>(raw_input(<span class="string">&quot;guess:&quot;</span>))</span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		exit(<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">if</span> guess==<span class="built_in">int</span>(key,<span class="number">2</span>):</span><br><span class="line">		count+=<span class="number">1</span></span><br><span class="line">		<span class="built_in">print</span> <span class="string">&#x27;Nice.&#x27;</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		count=<span class="number">0</span></span><br><span class="line">		<span class="built_in">print</span> <span class="string">&#x27;Oops.&#x27;</span></span><br><span class="line">	<span class="keyword">if</span> count&gt;<span class="number">2</span>:</span><br><span class="line">		<span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure>
<p>随机生成一个key, 输入mask, 每一轮都会随机的在key中取一段(开头结尾两位必定都是0), 然后与mask对应的一段异或(mask先重复填充成key长度).</p>
<p>题目让我们猜每一轮的key, 连续猜中3轮就能得到flag</p>
<p>可以看到只有输入mask才能改变key, 想到key中拿来跟mask异或的第一位必定是0, 如果最前面的0被改成了1, 那么它前面的位数和它本身就再也不会改变了, 利用这个特点, 可以疯狂传mask=1,让key的所有位数变成1, 当key变成全1之后, 传mask=0就能保持key不变了, 一直传<code>guess=int(&#39;1&#39;*64,2)</code>就行了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">mask = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;1&#x27;</span>*<span class="number">64</span></span><br><span class="line"></span><br><span class="line">mask = <span class="built_in">str</span>(<span class="built_in">int</span>(mask,<span class="number">2</span>))</span><br><span class="line">key = <span class="built_in">str</span>(<span class="built_in">int</span>(key,<span class="number">2</span>))</span><br><span class="line">print(mask)</span><br><span class="line">print(key)</span><br><span class="line"></span><br><span class="line">con = remote(<span class="string">&#x27;52.163.228.53&#x27;</span>, <span class="number">8082</span>)</span><br><span class="line">resp = con.recv().decode()</span><br><span class="line">print(resp)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    con.sendline(mask.encode())</span><br><span class="line">    resp = con.recv().decode()</span><br><span class="line">    con.sendline(key.encode())</span><br><span class="line">    resp = con.recvuntil(<span class="string">&#x27;mask:&#x27;</span>).decode()</span><br><span class="line">    print(resp)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;e&#x27;</span> <span class="keyword">in</span> resp:</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            con.sendline(<span class="string">&#x27;0&#x27;</span>.encode())</span><br><span class="line">            resp = con.recv().decode()</span><br><span class="line">            con.sendline(key.encode())</span><br><span class="line">            resp = con.recvuntil(<span class="string">&#x27;mask:&#x27;</span>).decode()</span><br><span class="line">            print(resp)</span><br><span class="line">	<span class="keyword">break</span></span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure>
<p>大概跑个一两百轮?就能出结果了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*CTF&#123;27d30dad45523cbf88013674a4b5bd29&#125;</span><br></pre></td></tr></table></figure>

<h1 id="little-case"><a href="#little-case" class="headerlink" title="little case"></a>little case</h1><blockquote>
<p>总会有一道RSA的对吧?</p>
</blockquote>
<p>附件:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,special,p,q,n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">little_trick</span>(<span class="params">msg</span>):</span></span><br><span class="line">    p1 = getPrime(<span class="number">1024</span>)</span><br><span class="line">    q1 = getPrime(<span class="number">1024</span>)</span><br><span class="line">    n1 = p1 * q1</span><br><span class="line">    d1=random.randint(<span class="number">1</span>,<span class="number">2</span>**<span class="number">256</span>)</span><br><span class="line">    e1=inverse(d1,(p1-<span class="number">1</span>)*(q1-<span class="number">1</span>))</span><br><span class="line">    print(n1)</span><br><span class="line">    print(e1)</span><br><span class="line">    print(<span class="built_in">pow</span>(msg,e1,n1))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">real_trick</span>():</span></span><br><span class="line">    <span class="keyword">assert</span> (special &gt; (<span class="built_in">ord</span>(<span class="string">&quot;*&quot;</span>)*<span class="number">100</span>) <span class="keyword">and</span> gcd(special,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))!=<span class="number">1</span> )</span><br><span class="line">    print(n)</span><br><span class="line">    print(<span class="built_in">pow</span>(libnum.s2n(flag),special,n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    little_trick(p-<span class="number">1</span>)</span><br><span class="line">    real_trick()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">输出</span></span><br><span class="line"><span class="string">21669699875387343975765484834175962461348837371447024695458479154615348697330944566714587217852888702291368306637977095490953192701450127798670425959768118384915082017373951315699899009631834471691811815393784748930880954114446745814058132752897827717077886547911476575751254872623927783670252969995075629255541621917767501261249192653546875104532649043219697616464205772025267019328364349763854659490144531087349974469079255236823096415094552037488277752927579909539401311624671444833332618177513356173537573280352724384376372955100031534236816681805396608147647003653628203258681097552049114308367967967184116839561</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">20717541468269984768938524534679430706714860712589983300712432366828367981392533792814384884126053081363266457682162675931547901815985830455612301105504518353600255693451085179954519939635263372257973143178677586338992274607959326361412487748088349413448526455377296931144384663805056580662706419414607407821761761574754611275621927387380065975844282519447660467416826579669726178901884060454994606177784839804528666823956703141147239309978420776148158425922031573513062568162012505209805669623841355103885621402814626329355281853436655713194649170570579414480803671531927080535374958180810697826214794117466378050607</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">17653913822265292046140436077352027388518012934178497059850703004839268622175666123728756590505344279395546682262531546841391088108347695091027910544112830270722179480786859703225421972669021406495452107007154426730798752912163553332446929049057464612267870012438268458914652129391150217932076946886301294155031704279222594842585123671871118879574946424138391703308869753154497665630799300138651304835205755177940116680821142858923842124294529640719629497853598914963074656319325664210104788201957945801990296604585721820046391439235286951088086966253038989586737352467905401107613763487302070546247282406664431777475</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">22346087036331379968192118389403047568445805414881948978518580277027027486284293415097623011228506968071753709256352246733181304513713003096615266613365080909760605498017330085960699607777361429562376124376340215426398797920168016137830563564636922257215066266075494625782943973857490781916694118187094786034792437781964601089843549995939887939410763350338658901108020658475956489391300528691289604149598720803012371765770928211044755626045817053870803040863722458554924076011151695567147976903053993914859714631837755435592006986598006207692599019026644753575853382810261910332197447386727419606073948645238377595719</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">12732299056226934743176360461051108799706450051853623472248552066649321279227693844417404789169416642586313895494292082308084823101092675162498154181999270703392144766031531668783213589136974486867571090321426005719333327425286160436925591205840653712046866950957876967715226097699016798471712274797888761218915345301238306497841970203137048433491914195023230951832644259526895087301990301002618450573323078919808182376666320244077837033894089805640452791930176084416087344594957596135877833163152566525019063919662459299054294655118065279192807949989681674190983739625056255497842063989284921411358232926435537518406</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>一共两个问题吧</p>
<ol>
<li>根据n1,e1以及<code>pow(p-1,e1,n1)</code>求p-1</li>
<li>根据上面的p, n 还有一些e有关的条件, 求flag </li>
</ol>
<h2 id="根据n1-e1以及pow-p-1-e1-n1-求p-1"><a href="#根据n1-e1以及pow-p-1-e1-n1-求p-1" class="headerlink" title="根据n1,e1以及pow(p-1,e1,n1)求p-1"></a>根据n1,e1以及<code>pow(p-1,e1,n1)</code>求p-1</h2><p>e1够大, 直接上Boneh_Durfee, 直接拿github上面的脚本跑了(不想改了….</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Config</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting debug to true will display more informations</span></span><br><span class="line"><span class="string">about the lattice, the bounds, the vectors...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">debug = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting strict to true will stop the algorithm (and</span></span><br><span class="line"><span class="string">return (-1, -1)) if we don&#x27;t have a correct </span></span><br><span class="line"><span class="string">upperbound on the determinant. Note that this </span></span><br><span class="line"><span class="string">doesn&#x27;t necesseraly mean that no solutions </span></span><br><span class="line"><span class="string">will be found since the theoretical upperbound is</span></span><br><span class="line"><span class="string">usualy far away from actual results. That is why</span></span><br><span class="line"><span class="string">you should probably use `strict = False`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">This is experimental, but has provided remarkable results</span></span><br><span class="line"><span class="string">so far. It tries to reduce the lattice as much as it can</span></span><br><span class="line"><span class="string">while keeping its efficiency. I see no reason not to use</span></span><br><span class="line"><span class="string">this option, but if things don&#x27;t work, you should try</span></span><br><span class="line"><span class="string">disabling it</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># stop removing if lattice reaches that dimension</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Functions</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display stats on helpful vectors</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span></span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> (nothelpful, <span class="string">&quot;/&quot;</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">&quot; vectors are not helpful&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># display matrix picture with 0 and X</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">matrix_overview</span>(<span class="params">BB, bound</span>):</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>:</span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="built_in">print</span> (a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tries to remove unhelpful vectors</span></span><br><span class="line"><span class="comment"># we start at current = n-1 (last vector)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span></span><br><span class="line">    <span class="comment"># end of our recursive function</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">    <span class="comment"># we start by checking from the end</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment"># if it is unhelpful:</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">            <span class="comment"># let&#x27;s check if it affects other vectors</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># if another vector is affected:</span></span><br><span class="line">                <span class="comment"># we increase the count</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:0</span></span><br><span class="line">            <span class="comment"># if no other vectors end up affected</span></span><br><span class="line">            <span class="comment"># we remove it</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;* removing unhelpful vector&quot;</span>, ii)</span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:1</span></span><br><span class="line">            <span class="comment"># if just one was affected we check</span></span><br><span class="line">            <span class="comment"># if it is affecting someone else</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># if it is affecting even one vector</span></span><br><span class="line">                    <span class="comment"># we give up on this one</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># remove both it if no other vector was affected and</span></span><br><span class="line">                <span class="comment"># this helpful vector is not helpful enough</span></span><br><span class="line">                <span class="comment"># compared to our unhelpful one</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="built_in">print</span> (<span class="string">&quot;* removing unhelpful vectors&quot;</span>, ii, <span class="string">&quot;and&quot;</span>, affected_vector_index)</span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1,-1 if `strict=true`, and determinant doesn&#x27;t bound</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    finds a solution if:</span></span><br><span class="line"><span class="string">    * d &lt; N^delta</span></span><br><span class="line"><span class="string">    * |x| &lt; e^delta</span></span><br><span class="line"><span class="string">    * |y| &lt; e^0.5</span></span><br><span class="line"><span class="string">    whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u) <span class="comment"># u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"></span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts list of monomials</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials():</span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:</span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts (selected by Herrman and May)</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts list of monomials</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct lattice B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Prototype to reduce the lattice</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment"># automatically remove</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># reset dimension</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># check if vectors are helpful</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># check if determinant is correctly bounded</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;looking for independent vectors in the lattice&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line">            <span class="comment"># for i and j, create the two polynomials</span></span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># resultant</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># are these good polynomials?</span></span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        print( <span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">example</span>():</span></span><br><span class="line"></span><br><span class="line">    N = <span class="number">21669699875387343975765484834175962461348837371447024695458479154615348697330944566714587217852888702291368306637977095490953192701450127798670425959768118384915082017373951315699899009631834471691811815393784748930880954114446745814058132752897827717077886547911476575751254872623927783670252969995075629255541621917767501261249192653546875104532649043219697616464205772025267019328364349763854659490144531087349974469079255236823096415094552037488277752927579909539401311624671444833332618177513356173537573280352724384376372955100031534236816681805396608147647003653628203258681097552049114308367967967184116839561</span></span><br><span class="line">    <span class="comment"># the public exponent</span></span><br><span class="line">    e = <span class="number">20717541468269984768938524534679430706714860712589983300712432366828367981392533792814384884126053081363266457682162675931547901815985830455612301105504518353600255693451085179954519939635263372257973143178677586338992274607959326361412487748088349413448526455377296931144384663805056580662706419414607407821761761574754611275621927387380065975844282519447660467416826579669726178901884060454994606177784839804528666823956703141147239309978420776148158425922031573513062568162012505209805669623841355103885621402814626329355281853436655713194649170570579414480803671531927080535374958180810697826214794117466378050607</span></span><br><span class="line">    <span class="comment"># the hypothesis on the private exponent (the theoretical maximum is 0.292)</span></span><br><span class="line">    delta = <span class="number">.29</span> <span class="comment"># this means that d &lt; N^delta</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Lattice (tweak those values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you should tweak this (after a first run), (e.g. increment it until a solution is found)</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line"><span class="comment">#         m = 4 # size of the lattice (bigger the better/slower)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># you need to be a lattice master to tweak these</span></span><br><span class="line">        t = <span class="built_in">int</span>((<span class="number">1</span>-<span class="number">2</span>*delta) * m)  <span class="comment"># optimization from Herrmann and May</span></span><br><span class="line">        X = <span class="number">2</span>*floor(N^delta)  <span class="comment"># this _might_ be too much</span></span><br><span class="line">        Y = floor(N^(<span class="number">1</span>/<span class="number">2</span>))    <span class="comment"># correct if p, q are ~ same size</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Don&#x27;t touch anything below</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Problem put in equation</span></span><br><span class="line">        P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">        A = <span class="built_in">int</span>((N+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line">        pol = <span class="number">1</span> + x * (A + y)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Find the solutions!</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Checking bounds</span></span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;=== checking values ===&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;* delta:&quot;</span>, delta)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;* delta &lt; 0.292&quot;</span>, delta &lt; <span class="number">0.292</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;* size of e:&quot;</span>, <span class="built_in">int</span>(log(e)/log(<span class="number">2</span>)))</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;* size of N:&quot;</span>, <span class="built_in">int</span>(log(N)/log(<span class="number">2</span>)))</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;* m:&quot;</span>, m, <span class="string">&quot;, t:&quot;</span>, t)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># boneh_durfee</span></span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;=== running algorithm ===&quot;</span>)</span><br><span class="line">            start_time = time.time()</span><br><span class="line"></span><br><span class="line">        solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># found a solution?</span></span><br><span class="line">        <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;=== solution found ===&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;x:&quot;</span>, solx)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;y:&quot;</span>, soly)</span><br><span class="line"></span><br><span class="line">            d = <span class="built_in">int</span>(pol(solx, soly) / e)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;private key found:&quot;</span>, d)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;=== no solution was found ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            print(<span class="string">&quot;=== %s seconds ===&quot;</span> % (time.time() - start_time))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    example()</span><br></pre></td></tr></table></figure>
<p>跑出<code>d1 =36167461773898995192586226632578677184913220227461899855497899052924496298787 </code></p>
<p>解rsa , 有<code>p = 199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059</code></p>
<h2 id="根据上面的p-n-还有一些e有关的条件-求flag"><a href="#根据上面的p-n-还有一些e有关的条件-求flag" class="headerlink" title="根据上面的p, n 还有一些e有关的条件, 求flag"></a>根据上面的p, n 还有一些e有关的条件, 求flag</h2><p>通过p,n得到</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="number">12732299056226934743176360461051108799706450051853623472248552066649321279227693844417404789169416642586313895494292082308084823101092675162498154181999270703392144766031531668783213589136974486867571090321426005719333327425286160436925591205840653712046866950957876967715226097699016798471712274797888761218915345301238306497841970203137048433491914195023230951832644259526895087301990301002618450573323078919808182376666320244077837033894089805640452791930176084416087344594957596135877833163152566525019063919662459299054294655118065279192807949989681674190983739625056255497842063989284921411358232926435537518406</span></span><br><span class="line">p = <span class="number">199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059</span></span><br><span class="line">q = <span class="number">112213695905472142415221444515326532320352429478341683352811183503269676555434601229013679319423878238944956830244386653674413411658696751173844443394608246716053086226910581400528167848306119179879115809778793093611381764939789057524575349501163689452810148280625226541609383166347879832134495444706697124741</span></span><br><span class="line">e=</span><br></pre></td></tr></table></figure>
<p>这里有个e是未知的, 但是<code>assert (e &gt; (ord(&quot;*&quot;)*100) and gcd(e,(p-1)*(q-1))!=1 )</code><br>可以看到e&gt;4200而且e与phi不是互素的…</p>
<p>马上想到AMM了, 但是这个e不知道<br>试试从4200开始爆破e….结果AMM实在是跑的太久了(也不知道为啥<br>根本没办法往下爆…</p>
<p>想回去看看之前找到AMM的那个博客, 想自己重新写一个来着……<br><a target="_blank" rel="noopener" href="http://yulige.top/?p=752#Sore667pt_6solvers">http://yulige.top/?p=752#Sore667pt_6solvers</a> - easyRSA<br>然后…就发现 怎么博客那道题的p和q和这道题的一模一样啊!<br>会不会e也没改?<br>于是试了一下原题的e = 0x1337, 然后把<del>慢到打把游戏都跑不完的</del>组合ART改成直接遍历mod p下的0x1337次方根(只有flag够短才能成功, 事实上做出答案了发现出题人是有做padding的, 但是似乎还是太短了?</p>
<p>然后就直接跑出来了….</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># About 3 seconds to run</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AMM</span>(<span class="params">o, r, q</span>):</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    print(<span class="string">&#x27;\n----------------------------------------------------------------------------------&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;Start to run Adleman-Manders-Miller Root Extraction Method&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;Try to find one &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(r, o, q))</span><br><span class="line">    g = GF(q)</span><br><span class="line">    o = g(o)</span><br><span class="line">    p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    <span class="keyword">while</span> p ^ ((q-<span class="number">1</span>) // r) == <span class="number">1</span>:</span><br><span class="line">        p = g(random.randint(<span class="number">1</span>, q))</span><br><span class="line">    print(<span class="string">&#x27;[+] Find p:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(p))</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    s = q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> s % r == <span class="number">0</span>:</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        s = s // r</span><br><span class="line">    print(<span class="string">&#x27;[+] Find s:&#123;&#125;, t:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(s, t))</span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (k * s + <span class="number">1</span>) % r != <span class="number">0</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    alp = (k * s + <span class="number">1</span>) // r</span><br><span class="line">    print(<span class="string">&#x27;[+] Find alp:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(alp))</span><br><span class="line">    a = p ^ (r**(t-<span class="number">1</span>) * s)</span><br><span class="line">    b = o ^ (r*alp - <span class="number">1</span>)</span><br><span class="line">    c = p ^ s</span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t):</span><br><span class="line">        d = b ^ (r^(t-<span class="number">1</span>-i))</span><br><span class="line">        <span class="keyword">if</span> d == <span class="number">1</span>:</span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&#x27;[+] Calculating DLP...&#x27;</span>)</span><br><span class="line">            j = - dicreat_log(a, d)</span><br><span class="line">            print(<span class="string">&#x27;[+] Finish DLP...&#x27;</span>)</span><br><span class="line">        b = b * (c^r)^j</span><br><span class="line">        h = h * c^j</span><br><span class="line">        c = c ^ r</span><br><span class="line">    result = o^alp * h</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    print(<span class="string">&#x27;Find one solution: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(result))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findAllPRoot</span>(<span class="params">p, e</span>):</span></span><br><span class="line">    print(<span class="string">&quot;Start to find all the Primitive &#123;:#x&#125;th root of 1 modulo &#123;&#125;.&quot;</span>.<span class="built_in">format</span>(e, p))</span><br><span class="line">    start = time.time()</span><br><span class="line">    proot = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(proot) &lt; e:</span><br><span class="line">        proot.add(<span class="built_in">pow</span>(random.randint(<span class="number">2</span>, p-<span class="number">1</span>), (p-<span class="number">1</span>)//e, p))</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="keyword">return</span> proot</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findAllSolutions</span>(<span class="params">mp, proot, cp, p</span>):</span></span><br><span class="line">    print(<span class="string">&quot;Start to find all the &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;.&quot;</span>.<span class="built_in">format</span>(e, cp, p))</span><br><span class="line">    start = time.time()</span><br><span class="line">    all_mp = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> root <span class="keyword">in</span> proot:</span><br><span class="line">        mp2 = mp * root % p</span><br><span class="line">        <span class="keyword">assert</span>(<span class="built_in">pow</span>(mp2, e, p) == cp)</span><br><span class="line">        all_mp.add(mp2)</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="built_in">format</span>(end - start))</span><br><span class="line">    <span class="keyword">return</span> all_mp</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">c = <span class="number">12732299056226934743176360461051108799706450051853623472248552066649321279227693844417404789169416642586313895494292082308084823101092675162498154181999270703392144766031531668783213589136974486867571090321426005719333327425286160436925591205840653712046866950957876967715226097699016798471712274797888761218915345301238306497841970203137048433491914195023230951832644259526895087301990301002618450573323078919808182376666320244077837033894089805640452791930176084416087344594957596135877833163152566525019063919662459299054294655118065279192807949989681674190983739625056255497842063989284921411358232926435537518406</span></span><br><span class="line">p = <span class="number">199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059</span></span><br><span class="line">q = <span class="number">112213695905472142415221444515326532320352429478341683352811183503269676555434601229013679319423878238944956830244386653674413411658696751173844443394608246716053086226910581400528167848306119179879115809778793093611381764939789057524575349501163689452810148280625226541609383166347879832134495444706697124741</span></span><br><span class="line">e = <span class="number">0x1337</span></span><br><span class="line">cp = c % p</span><br><span class="line">mp = AMM(cp, e, p)</span><br><span class="line">p_proot = findAllPRoot(p, e)</span><br><span class="line">mps = findAllSolutions(mp, p_proot, cp, p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">m</span>):</span></span><br><span class="line">    <span class="keyword">if</span> long_to_bytes(m).decode(<span class="string">&#x27;utf-8&#x27;</span>,<span class="string">&#x27;ignore&#x27;</span>).startswith(<span class="string">&#x27;*CTF&#x27;</span>):</span><br><span class="line">        print(long_to_bytes(m))</span><br><span class="line">        exit()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">elif</span> long_to_bytes(m).decode(<span class="string">&#x27;utf-8&#x27;</span>,<span class="string">&#x27;ignore&#x27;</span>).startswith(<span class="string">&#x27;*ctf&#x27;</span>):</span><br><span class="line">        print(long_to_bytes(m))</span><br><span class="line">        exit()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> mpp <span class="keyword">in</span> mps:</span><br><span class="line">    check(<span class="built_in">int</span>(mpp))</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b&#39;*CTF&#123;S0_Y0u_ARE_REA11Y_GOOd_At_Pla1_This&#125;Ifyoumissthetrainimonyouwillknowthatiamgoneyoucanheartheflagfluwwwwwwwwww&#39;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>看这个flag好像又是歪打正着的一题….Pla1估计是某个方法吧?等个官方wp咯<br>还好padding长度不够hhhh, 不过要是长度够跑那个组合ART应该也是可以出结果的, 就是要多打两把游戏而已<br>顺便一提, 这个padding是歌词吧! 500 miles好听!</p>
</blockquote>
<h1 id="MyCurve"><a href="#MyCurve" class="headerlink" title="MyCurve"></a>MyCurve</h1><p>附件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">assert</span> flag[:<span class="number">5</span>]==<span class="string">&#x27;*CTF&#123;&#x27;</span> <span class="keyword">and</span> flag[-<span class="number">1</span>]==<span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">flag=flag[<span class="number">5</span>:-<span class="number">1</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">P,Q</span>):</span></span><br><span class="line">	<span class="keyword">if</span> Q==<span class="number">0</span>:</span><br><span class="line">		<span class="keyword">return</span> P</span><br><span class="line">	x1,y1=P</span><br><span class="line">	x2,y2=Q</span><br><span class="line">	<span class="keyword">return</span> (d1*(x1+x2)+d2*(x1+y1)*(x2+y2)+(x1+x1^<span class="number">2</span>)*(x2*(y1+y2+<span class="number">1</span>)+y1*y2))/(d1+(x1+x1^<span class="number">2</span>)*(x2+y2)),(d1*(y1+y2)+d2*(x1+y1)*(x2+y2)+(y1+y1^<span class="number">2</span>)*(y2*(x1+x2+<span class="number">1</span>)+x1*x2))/(d1+(y1+y1^<span class="number">2</span>)*(x2+y2))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">k,P</span>):</span></span><br><span class="line">	Q=(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">while</span> k&gt;<span class="number">0</span>:</span><br><span class="line">		<span class="keyword">if</span> is_even(k):</span><br><span class="line">			k/=<span class="number">2</span></span><br><span class="line">			P=add(P,P)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			k-=<span class="number">1</span></span><br><span class="line">			Q=add(P,Q)</span><br><span class="line">	<span class="keyword">return</span> Q</span><br><span class="line"></span><br><span class="line">F=GF(<span class="number">2</span>**<span class="number">100</span>)</span><br><span class="line">R.&lt;x,y&gt;=F[]</span><br><span class="line">d1=F.fetch_int(<span class="number">1</span>)</span><br><span class="line">d2=F.fetch_int(<span class="number">1</span>)</span><br><span class="line">x,y=(<span class="number">698546134536218110797266045394L</span>, <span class="number">1234575357354908313123830206394L</span>)</span><br><span class="line">G=(F.fetch_int(x),F.fetch_int(y))</span><br><span class="line">P=mul(bytes_to_long(flag),G)</span><br><span class="line"><span class="built_in">print</span> (G[<span class="number">0</span>].integer_representation(),G[<span class="number">1</span>].integer_representation())</span><br><span class="line"><span class="built_in">print</span> (P[<span class="number">0</span>].integer_representation(),P[<span class="number">1</span>].integer_representation())</span><br><span class="line"><span class="comment">#(698546134536218110797266045394L, 1234575357354908313123830206394L)</span></span><br><span class="line"><span class="comment">#(403494114976379491717836688842L, 915160228101530700618267188624L)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>椭圆曲线… 第一次做这样的<br>比赛的时候也没做出来 查了查<a target="_blank" rel="noopener" href="https://www.hyperelliptic.org/">https://www.hyperelliptic.org</a>  (应该是一个曲线库<br>发现里面有一种曲线就是题目给的曲线<a target="_blank" rel="noopener" href="https://www.hyperelliptic.org/EFD/g12o/auto-edwards.html">就是这个</a><br>具体是啥玩意还搞不懂 只能先按着库里面的数据把脚本写好 学完ECC再来看看了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">F=GF(<span class="number">2</span>**<span class="number">100</span>)</span><br><span class="line">R.&lt;x,y&gt;=F[]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_map</span>(<span class="params">p</span>):</span></span><br><span class="line">    x,y = F.fetch_int(p[<span class="number">0</span>]),F.fetch_int(p[<span class="number">1</span>])</span><br><span class="line">    u = <span class="number">3</span>*(x+y)/(x*y+x+y)</span><br><span class="line">    v = <span class="number">3</span>*(x/(x*y+x+y)+<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> (u,v)</span><br><span class="line">G = (<span class="number">698546134536218110797266045394</span>,<span class="number">1234575357354908313123830206394</span>)P = (<span class="number">403494114976379491717836688842</span>,<span class="number">915160228101530700618267188624</span>)</span><br><span class="line">E = EllipticCurve(GF(<span class="number">2</span>**<span class="number">100</span>),[<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>])</span><br><span class="line">base = E(_map(G))</span><br><span class="line">res = E(_map(P))</span><br><span class="line">flag = discrete_log(res,base,base.order(),operation=<span class="string">&quot;+&quot;</span>)</span><br><span class="line">print(long_to_bytes(flag))</span><br></pre></td></tr></table></figure>
        </div></article>
      <nav class="pagination"><a class="prev" href="/page/12/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text">Prev</span>
      </a>
    <a class="next" href="/page/14/">
        <span class="next-text">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></section></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
        <a target="_blank" rel="noopener" href="https://github.com/tearsjin" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2020 - 2021<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">K1rit0</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
