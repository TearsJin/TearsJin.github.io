<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="222222"/><link rel="alternate" href="/atom.xml" title="K1rit0's Blog" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="http://tearsjin.github.io/page/15/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" /><script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":true};
</script>

    <title>K1rit0's Blog</title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">K1rit0's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archives
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About
          </li>
      </a><a href="/link/">
        <li class="mobile-menu-item">Link
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">K1rit0's Blog</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            Categories
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            About
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/link/">
            Link
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><section id="posts" class="posts"><article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2021/03/28/Translation-of-LatticeHacks/">Translation of LatticeHacks</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2021-03-28
        </span><span class="post-category">
            <a href="/categories/CryptoSummary/">CryptoSummary</a>
            </span>
        </div>
    </header>

    <div class="post-content"><blockquote>
<p>打了个比赛NTRU不会做, 翻密码爷爷的博客发现一个宝藏网站<a target="_blank" rel="noopener" href="https://latticehacks.cr.yp.to/">https://latticehacks.cr.yp.to</a><br>虽然内容不多, 还是英语的. 这里翻译翻译也顺便学习一下.</p>
</blockquote>
<h1 id="NTRU"><a href="#NTRU" class="headerlink" title="NTRU"></a>NTRU</h1><h2 id="多项式"><a href="#多项式" class="headerlink" title="多项式"></a>多项式</h2><p><code>Zx.&lt;x&gt; = ZZ[]</code></p>
<p>这里创建了一个<code>Zx</code>类, 一个Zx对象, 一个<code>Zx</code>对象是关于<code>x</code>的整系数多项式, 举个栗子:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sage : f &#x3D; Zx([3,1,4])</span><br><span class="line">sage : f</span><br><span class="line">4*x^2 + x + 3</span><br></pre></td></tr></table></figure>

<p>这个多项式<code>f</code>是$4x^2,x,3$这三部分的和. 每一部分都是整数系数(分别为4,1,3) 乘(times?)上一个$x$的次幂(为别为$x^2,x,1$)</p>
<p>也可以将上面的例子复制黏贴进<code>Sage</code>源代码里</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = Zx([<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>])</span><br><span class="line">f</span><br><span class="line"><span class="comment"># output: 4*x^2 + x + 3</span></span><br></pre></td></tr></table></figure>

<h2 id="多项式乘法"><a href="#多项式乘法" class="headerlink" title="多项式乘法"></a>多项式乘法</h2><p><code>Zx</code>类有一个把每一部分相乘并相加的内置乘法. 比如说, $f$乘一个$x$, 或者是$x$的任意次方, 不过这样也就是在移动$f$的参数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f</span><br><span class="line"><span class="comment"># output: 4*x^2 + x + 3</span></span><br><span class="line">f*x</span><br><span class="line"><span class="comment"># output: 4*x^3 + x^2 + 3*x</span></span><br></pre></td></tr></table></figure>

<p>再来个例子:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">g = Zx([<span class="number">2</span>,<span class="number">7</span>,<span class="number">1</span>])</span><br><span class="line">g</span><br><span class="line"><span class="comment"># output: x^2 + 7*x + 2</span></span><br><span class="line">f*g</span><br><span class="line"><span class="comment"># output: 4*x^4 + 29*3^3 + 18*x^2 + 23*x + 6</span></span><br></pre></td></tr></table></figure>

<h2 id="循环卷积"><a href="#循环卷积" class="headerlink" title="循环卷积"></a>循环卷积</h2><blockquote>
<p>顺便学习一下循环卷积是怎样的<br>卷积分三种: 线性卷积, 周期卷积, 循环卷积<br>线性卷积: 就是普通的多项式乘法<br>循环卷积与周期卷积并没有本质区别, 循环卷积就是保留前一部分不动, 把后面的截下来加到前一部分去(就是模$X^n - 1$吧, 比如模$x^3-1$, 对于结果$x^4 + x^2 + x + 1 \mod x^3-1$来说, 就是把$x^4$模成$x$, 再加到前面去变成$x^2 + 2x + 1$) </p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convolution</span>(<span class="params">f,g</span>):</span></span><br><span class="line">	<span class="keyword">return</span> (f * g)% (x^n - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>这个乘法就是NTRU中使用的乘法. 它就像模一个$x^n-1$多项式乘法. 这意味着把$x^n$替换成1, 把$x^{(n+1)}$替换成$x$, 把$x^{n+2}$替换成$x^2$等等</p>
<p>输入两个模$x^{n-1}$的$n$系数多项式$f$和$g$, 那么输出也会是一个$n$次多项式, 因为$n$次及以上的式子都被约掉了. 所以是有可能存在一些甚至是全部项的系数为0. 我们常说的$n$系数多项式并不是说$1, x,…,x^{n-1}$全都存在, 而是说$x^n,x^{n+1}$ 等等的项不存在.</p>
<p>例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">3</span></span><br><span class="line">f*g</span><br><span class="line"><span class="comment"># output: 4*x^4 + 29*x^3 + 18*x^2 + 23*x + 6</span></span><br><span class="line">convolution(f,g)</span><br><span class="line"><span class="comment"># output: 18*x^2 + 27*x + 35</span></span><br></pre></td></tr></table></figure>

<p>另外一个例子, 计算$f$和$x$次幂的卷积, 就是在旋转$f$的系数.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">3</span></span><br><span class="line">f</span><br><span class="line"><span class="comment"># output: 4*x^2 + x + 3</span></span><br><span class="line">convolution(f,x)</span><br><span class="line"><span class="comment"># output: x^2 + 3*x + 4</span></span><br><span class="line">convolution(f,x^<span class="number">2</span>)</span><br><span class="line"><span class="comment"># output: 3*x^2 + 4*x + 1</span></span><br></pre></td></tr></table></figure>

<p>注意, 这里的$n$是一个全局变量.</p>
<blockquote>
<p>原文这里还有两个练习, 一个是python练习, 一个是数学练习…这里就不翻译了, 也没什么必要.</p>
</blockquote>
<p><code>Sage</code>可以直接用<code>R = Zx.quotient(x^n-1)</code>生成一个加减乘运算都是$\mod x^{n-1} $的类<code>R</code></p>
<p>“cyclic convolution”(循环卷积) 或者是 “circular convolution” 这个名字来自与信号处理. 在多项式乘法中, 它叫”acyclic convolution”</p>
<h2 id="模约"><a href="#模约" class="headerlink" title="模约"></a>模约</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">balancedmod</span>(<span class="params">f,q</span>):</span></span><br><span class="line">	g = <span class="built_in">list</span>(((f[i] + q//<span class="number">2</span>) %q) - q//<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n))</span><br><span class="line">	<span class="keyword">return</span> Zx(g)</span><br></pre></td></tr></table></figure>

<p><code>balancedmod()</code>有两个输入: 一个$n$整系数多项式$f$和一个正整数$q$. 输出一个也是n整系数, 并且每一个系数都$\mod q$. 数学家们通常定义模约的结果在$[0,q-1]$ 之中, 但这个函数的输出会将系数模约到$[-q/2,q/2]$之间, 更详细的说, 当$q$是偶数的时候, 结果的范围是$[-q/2,q/2-1]$;当$q$是奇数的时候, 范围是$[-(q-1)/2,(q-1)/2]$</p>
<p>来个例子:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">u = Zx([<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">9</span>])</span><br><span class="line">u</span><br><span class="line"><span class="comment"># output: 9*x^5 + 5*x^4 + x^3 + 4*x^2 + x + 3</span></span><br><span class="line">n = <span class="number">7</span></span><br><span class="line">balancedmod(u,<span class="number">10</span>)</span><br><span class="line"><span class="comment"># output: -x^5 - 5*x^4 + x^3 + 4*x^2 + x + 3</span></span><br><span class="line">balancedmod(u,<span class="number">3</span>)</span><br><span class="line"><span class="comment"># output: -x^4 + x^3 + x^2 + x</span></span><br></pre></td></tr></table></figure>

<p>在函数内部, <code>balancedmod()</code>依旧使用<code>Sage</code>的<code>% q</code>操作, 这个操作的输出会在$[0,q-1]$之间. 但这个函数会调整输入和输出到$q // 2$, 也就是$q / 2$取整数部分.</p>
<p>注意, 负数输入<code>% q</code>后在低级语言中往往会输出负数. 这样会泄露输入的符号(除非输入刚好是$q$的倍数, 那么输出就会是0). 泄露符号可以导致一些严重的安全问题, <code>Sage</code>支持对多项式进行<code>% p</code>这个操作, 但是输出<strong>有时候</strong>会泄露输入的符号, 比如说:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">u &#x3D; 314 - 159*x</span><br><span class="line">u % 200</span><br><span class="line"># output: -159*x + 114</span><br><span class="line">(u - 400) % 200</span><br><span class="line"># output: -159*x - 86</span><br><span class="line">(u - 600) % 200</span><br><span class="line"># output: -159*x + 114</span><br><span class="line">balancedmod(u,200)</span><br><span class="line"># output: 41*x - 86</span><br></pre></td></tr></table></figure>

<h2 id="d项非零的随机多项式-Random-polynomials-with-d-nonzero-coefficients"><a href="#d项非零的随机多项式-Random-polynomials-with-d-nonzero-coefficients" class="headerlink" title="d项非零的随机多项式(Random polynomials with d nonzero coefficients)"></a>d项非零的随机多项式(Random polynomials with d nonzero coefficients)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomdpoly</span>():</span></span><br><span class="line">	<span class="keyword">assert</span> d &lt;= n</span><br><span class="line">	result = n*[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(d):</span><br><span class="line">		<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">			r = randrange(n)</span><br><span class="line">			<span class="keyword">if</span> <span class="keyword">not</span> result[r]: <span class="keyword">break</span></span><br><span class="line">		result[r] = <span class="number">1</span> - <span class="number">2</span>*randrange(<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">return</span> Zx(result)</span><br></pre></td></tr></table></figure>

<p><code>randomdpoly()</code>返回一个有$d$个非零系数($n-d$个系数为0)的$n$次多项式. 而且每个非零的系数要么是1, 要么是-1.</p>
<p>来看例子(注意n和d是全局变量):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">n &#x3D; 7</span><br><span class="line">d &#x3D; 5</span><br><span class="line">f &#x3D; randomdpoly()</span><br><span class="line">f</span><br><span class="line"># output: x^6 + x^5 - x^3 + x^2 - 1</span><br><span class="line">f &#x3D; randomdpoly()</span><br><span class="line">f</span><br><span class="line"># output: -x^4 + x^3 + x^2 - x + 1</span><br></pre></td></tr></table></figure>

<h2 id="模素数的除法"><a href="#模素数的除法" class="headerlink" title="模素数的除法"></a>模素数的除法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invertmodprime</span>(<span class="params">f,p</span>):</span></span><br><span class="line">	T = Zx.change_ring(Integers(p)).quotient(x^n-<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">return</span> Zx(lift(<span class="number">1</span> / T(f)))</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>litf()</code>, 把一个在环R/I中的数,  转成在R中</p>
</blockquote>
<p><code>invertmodprime()</code>会计算一个多项式在$\mod x^n-1 \mod p$下的逆元. </p>
<p>这个函数有两个输入, 一个$n$系数多项式$f$以及一个素数$p$(比如说 3). 输出一个$n$系数多项式$g$, 这个$g$满足$f \cdot g = 1 + p \cdot u$($f \cdot g$是循环卷积, $u$也是一个多项式). 如果多项式$g$不存在, 那么这个函数将报错. 举个例子:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">7</span></span><br><span class="line">f</span><br><span class="line"><span class="comment"># output: -x^4 + x^3 + x^2 - x + 1</span></span><br><span class="line">f3 = invertmodprime(f,<span class="number">3</span>)</span><br><span class="line">f3</span><br><span class="line"><span class="comment"># output: x^6 + 2*x^4 + x</span></span><br><span class="line">convolution(f,f3)</span><br><span class="line"><span class="comment"># output: 3*x^6 - 3*x^5 + 3*x^4 + 1</span></span><br></pre></td></tr></table></figure>

<p><code>convolution</code>的结果可以看成$1 + 3 \cdot u$, 其中$u = x^6 - x^5 + x^4$</p>
<p>事实上在模非素数的时候也是可能算出结果的, 但是由于<code>invertmodprime</code>使用了<code>Sage</code>中的子程序?(subroutines), 以至于该函数会没那么好的处理非素数模.</p>
<h2 id="模-2-n-的除法"><a href="#模-2-n-的除法" class="headerlink" title="模$2^n$的除法"></a>模$2^n$的除法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invertmodpowerof2</span>(<span class="params">f,q</span>):</span></span><br><span class="line">     <span class="keyword">assert</span> q.is_power_of(<span class="number">2</span>)</span><br><span class="line">     g = invertmodprime(f,<span class="number">2</span>)</span><br><span class="line">     <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">       r = balancedmod(convolution(g,f),q)</span><br><span class="line">       <span class="keyword">if</span> r == <span class="number">1</span>: <span class="keyword">return</span> g</span><br><span class="line">       g = balancedmod(convolution(g,<span class="number">2</span> - r),q)</span><br></pre></td></tr></table></figure>

<p>这个函数跟上面的<code>invertmodprime</code>很像, 唯一的不同是输入$q$是$2^n$, 比如$2,4,8,16,…$ </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">7</span></span><br><span class="line">q = <span class="number">256</span></span><br><span class="line">f</span><br><span class="line"><span class="comment"># output: -x^4 + x^3 + x^2 - x + 1</span></span><br><span class="line">fq = invertmodpowerof2(f,q)</span><br><span class="line">convolution(f,fq)</span><br><span class="line"><span class="comment"># output: -256*x^6 + 256*x^4 - 256*x ^2 + 257</span></span><br></pre></td></tr></table></figure>

<p><code>convolution</code>的结果可以看成$1 + 256 \cdot u$, 其中$u = x^6 + x^4 - x^2 + 1$</p>
<blockquote>
<p>这里依旧有个数学练习</p>
</blockquote>
<h2 id="NTRU-密钥生成"><a href="#NTRU-密钥生成" class="headerlink" title="NTRU 密钥生成"></a>NTRU 密钥生成</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keypair</span>():</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			f = randomdpoly()</span><br><span class="line">			f3 = invertmodprime(f,<span class="number">3</span>)</span><br><span class="line">			fq = invertmodpowerof(f,q)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			<span class="keyword">pass</span></span><br><span class="line">	g = randomdpoly()</span><br><span class="line">	publickey = balancedmod(<span class="number">3</span> * convolution(fq,g),q)</span><br><span class="line">	secretkey = f,f3</span><br><span class="line">	<span class="keyword">return</span> publickey,secretkey</span><br></pre></td></tr></table></figure>

<p><code>keypair()</code>会生成一个公钥<code>h</code>和对应的私钥<code>f,f3</code>. 公钥看起来就像一个随机的$\mod q$的$n$系数多项式. 比如说, 如果$n = 7, q = 256$, 那么公钥看起来就像一个7个随机的字节?(bytes):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">7</span></span><br><span class="line">d = <span class="number">5</span></span><br><span class="line">q = <span class="number">256</span></span><br><span class="line">publickey, secretkey = keypair()</span><br><span class="line">publickey</span><br><span class="line"><span class="comment"># output: 54*x^6 - 40*x^5 + 90*x^4 + 101*x^3 - 108*x^2 + 80*x + 76</span></span><br></pre></td></tr></table></figure>

<p>其中一个私钥$f$是一个有小系数的多项式, 将$f$与公钥$h$卷积再$\mod q$能生成另外一个小系数的多项式, 也就是出现在密钥生成里的$3 \cdot g$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">f,f3 &#x3D; secretkey</span><br><span class="line">f</span><br><span class="line"># output:-x^6 + x^5 - x^4 + x^2 + 1</span><br><span class="line">convolution(f, publickey)</span><br><span class="line"># output: 256*x^6 + 3*x^5 - 3*x^3 - 3*x^2 + 253*x - 253</span><br><span class="line">balancedmod(_,q)</span><br><span class="line"># output: 3*x^5 - 3*x^3 - 3*x^2 - 3*x + 3</span><br></pre></td></tr></table></figure>

<h2 id="用于加密的消息"><a href="#用于加密的消息" class="headerlink" title="用于加密的消息"></a>用于加密的消息</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randommessage</span>():</span></span><br><span class="line">	result = <span class="built_in">list</span>(randrange(<span class="number">3</span>) - <span class="number">1</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n))</span><br><span class="line">	<span class="keyword">return</span> Zx(result)</span><br></pre></td></tr></table></figure>

<p>这个函数会返回一个$n$个系数为$\{1,0,-1\}$的多项式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">7</span></span><br><span class="line">randommessage()</span><br><span class="line"><span class="comment"># output: -x^6 - x^5 + x^4</span></span><br><span class="line">randommessage()</span><br><span class="line"><span class="comment"># output: x^6 + x^5 - x^4 - 1</span></span><br><span class="line">randommessage()</span><br><span class="line"><span class="comment"># output: -x^4 - x^3 - x + 1</span></span><br><span class="line">randommessage()</span><br><span class="line"><span class="comment"># output: -x^6 + x^4 - x^2 + 1</span></span><br></pre></td></tr></table></figure>

<h2 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">message,publickey</span>):</span></span><br><span class="line">     r = randomdpoly()</span><br><span class="line">     <span class="keyword">return</span> balancedmod(convolution(publickey,r) + message,q)</span><br></pre></td></tr></table></figure>

<p>加密函数输入一个需要加密的消息和公钥$h$, 输出的密文为$h \cdot r + m \mod x^{n - 1} \mod q$,其中$m$是消息, $r$是随机的一个多项式.</p>
<p>例子:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">7</span></span><br><span class="line">d = <span class="number">5</span></span><br><span class="line">q = <span class="number">256</span></span><br><span class="line">h,secretkey = keypair()</span><br><span class="line">h</span><br><span class="line"><span class="comment"># output: -82*x^6 + 118*x^5 - 94*x^4 + 108*x^3 + 70*x^2 - 122*x + 5</span></span><br><span class="line">m = randommessage()</span><br><span class="line">m</span><br><span class="line"><span class="comment"># output: -x^6 - x^4 + x^2 + 1</span></span><br><span class="line">c = encrypt(m,h)</span><br><span class="line">c</span><br><span class="line"><span class="comment"># output: -66*x^6 + 37*x^5 + 115*x^4 - 15*x^3 - 6*x^2 - 89*x + 27</span></span><br></pre></td></tr></table></figure>

<h2 id="解密"><a href="#解密" class="headerlink" title="解密"></a>解密</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">ciphertext,secretkey</span>):</span></span><br><span class="line">     f,f3 = secretkey</span><br><span class="line">     a = balancedmod(convolution(ciphertext,f),q)</span><br><span class="line">     <span class="keyword">return</span> balancedmod(convolution(a,f3),<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>解密函数需要输入密文和私钥</p>
<blockquote>
<p>这里作者测试了一下解密算法, 就知识简单的重复加完密再解密, 这部分就不写下来了.</p>
</blockquote>
<p>下面这个例子就是加解密的时候函数内部的所有过程, 用来说明解密的正确性:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">7</span></span><br><span class="line">d = <span class="number">5</span></span><br><span class="line">q = <span class="number">256</span></span><br><span class="line">h,secretkey = keypair()</span><br><span class="line">h</span><br><span class="line"><span class="comment"># output: -82*x^6 + 118*x^5 - 94*x^4 + 108*x^3 + 70*x^2 - 122*x + 5</span></span><br><span class="line">m = randommessage()</span><br><span class="line">m</span><br><span class="line"><span class="comment"># output: x^6 + x^5 - x^4 - x^3 + x - 1</span></span><br><span class="line">r = randomdpoly()</span><br><span class="line">r</span><br><span class="line"><span class="comment"># output: -x^6 + x^5 + x^4 + x^3 - x^2</span></span><br><span class="line">f = secretkey[<span class="number">0</span>]</span><br><span class="line">f</span><br><span class="line"><span class="comment"># output: -x^6 - x^5 - x^4 - x^3 - x</span></span><br><span class="line">g3 = balancedmod(convolution(f,h),q)</span><br><span class="line">g3</span><br><span class="line"><span class="comment"># output: -3*x^6 - 3*x^3 + 3*x^2 - 3*x - 3</span></span><br><span class="line">c = balancedmod(convolution(h,r) + m,q)</span><br><span class="line">c</span><br><span class="line"><span class="comment"># output: -93*x^6 - 105*x^5 - 110*x^4 - 95*x^3 - 106*x^2 </span></span><br><span class="line">a = balancedmod(convolution(f,c),q)</span><br><span class="line">a</span><br><span class="line"><span class="comment"># output: 3*x^5 - 13*x^4 - 3*x^3 + 2*x^2 - x + 3</span></span><br><span class="line">convolution(g3,r) + convolution(f,m)</span><br><span class="line"><span class="comment"># output: 3*x^5 - 13*x^4 - 3*x^3 + 2*x^2 - x + 3</span></span><br><span class="line">balancedmod(a,<span class="number">3</span>)</span><br><span class="line"><span class="comment"># output: -x^4 - x^2 - x</span></span><br><span class="line">balancedmod(convolution(f,m),<span class="number">3</span>)</span><br><span class="line"><span class="comment"># output: -x^4 - x^2 - x</span></span><br></pre></td></tr></table></figure>

<p>再看看过程,<br>$$<br>c = h \cdot r + m \mod q \\<br>f \cdot h = 3 \cdot g \mod q<br>$$<br>所以我们有:<br>$$<br>a = f \cdot c = f \cdot h \cdot r + f \cdot m = 3 \cdot g \cdot r + f \cdot m \mod q<br>$$<br>多项式$g,r,f,m$的系数都特别的小, 所以这里对$3 \cdot g \cdot r + f \cdot m$系数的最大值有限制. 只有当这个限制足够小, 小到$a \mod q$就是$3 \cdot g \cdot r + f \cdot m$, 这个时候$\mod 3$规约$a$就是在计算$f \cdot m \mod 3$, 最后再乘$f3$就能得到$m \mod 3$了</p>
<p>注意到解密是有可能失败的, 有一个办法避免对有效密文的解密失败就是标准化$n,d,q$的选取, 但是攻击者仍然可以故意选择无效密文来查看解密是否可以正常进行. 所以为了安全采取额外的措施抵抗这种选择密文攻击是很重要的!</p>
<h2 id="一个对参数过小的NTRU的攻击实例"><a href="#一个对参数过小的NTRU的攻击实例" class="headerlink" title="一个对参数过小的NTRU的攻击实例"></a>一个对参数过小的NTRU的攻击实例</h2><p>在下面的例子中, 参数将使用$n = 7,d = 5,q = 256$</p>
<p>攻击者将会从公钥$h = 3 \cdot g / f$入手. 我们可以计算$h3 = g / f$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h</span><br><span class="line"><span class="comment"># output: -82*x^6 + 118*x^5 - 94*x^4 + 108*x^3 + 70*x^2 - 122*x + 5</span></span><br><span class="line">Integers(q)(<span class="number">1</span>/<span class="number">3</span>)</span><br><span class="line"><span class="comment"># output: 171</span></span><br><span class="line">h3 = (<span class="number">171</span> * h)%q</span><br></pre></td></tr></table></figure>

<p>我们可以把$g$看成是私钥$f$乘$h3$. 记住, 私钥$f$是从$1,x,x^2,x^3,x^4,x^5,x^6$通过一些加减得到的. 那么$g$对应的就是从$h3,h3\cdot x,h3\cdot x^2,h3\cdot x^3,h3\cdot x^4,h3\cdot x^5,h3\cdot x^6$通过一些加减得到的.下面是这些多项式:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">h3</span><br><span class="line"><span class="comment"># output: 58*x^6 + 210*x^5 + 54*x^4 + 36*x^3 + 194*x^2 + 130*x + 87</span></span><br><span class="line">convolution(h3,x)</span><br><span class="line"><span class="comment"># output: 210*x^6 + 54*x^5 + 36*x^4 + 194*x^3 + 130*x^2 + 87*x + 58</span></span><br><span class="line">convolution(h3,x^<span class="number">2</span>)</span><br><span class="line"><span class="comment"># output: 54*x^6 + 36*x^5 + 194*x^4 + 130*x^3 + 87*x^2 + 58*x + 210</span></span><br><span class="line">convolution(h3,x^<span class="number">3</span>)</span><br><span class="line"><span class="comment"># output: 36*x^6 + 194*x^5 + 130*x^4 + 87*x^3 + 58*x^2 + 210*x + 54</span></span><br><span class="line">convolution(h3,x^<span class="number">4</span>)</span><br><span class="line"><span class="comment"># output: 194*x^6 + 130*x^5 + 87*x^4 + 58*x^3 + 210*x^2 + 54*x + 36</span></span><br><span class="line">convolution(h3,x^<span class="number">5</span>)</span><br><span class="line"><span class="comment"># output: 130*x^6 + 87*x^5 + 58*x^4 + 210*x^3 + 54*x^2 + 36*x + 194</span></span><br><span class="line">convolution(h3,x^<span class="number">6</span>)</span><br><span class="line"><span class="comment"># output: 87*x^6 + 58*x^5 + 210*x^4 + 54*x^3 + 36*x^2 + 194*x + 130</span></span><br></pre></td></tr></table></figure>

<p>事实上, $g = f\cdot h3 \mod q$, $q$ 可以从任意的参数通过加减得到. 这意味着$g$可以从$q,q\cdot x,q\cdot x^2,q\cdot x^3,q\cdot x^4,q\cdot x^5,q\cdot x^6,h3,h3\cdot x,h3\cdot x^2,h3\cdot x^3,h3\cdot x^4,h3\cdot x^5,h3\cdot x^6$组合而来</p>
<p>最后, 连接上面的这些系数并将产生的组合写进下面的矩阵中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">M = Matrix(<span class="number">2</span>*n)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n): M[i,i] = q</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n,<span class="number">2</span>*n): M[i,i] = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">		M[i+n,j] = convolution(h3, x^i)[j]</span><br><span class="line">M</span><br><span class="line"><span class="comment"># output: [256   0   0   0   0   0   0   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0 256   0   0   0   0   0   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0   0 256   0   0   0   0   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0   0   0 256   0   0   0   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0   0   0   0 256   0   0   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0   0   0   0   0 256   0   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0   0   0   0   0   0 256   0   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [ 87 130 194  36  54 210  58   1   0   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [ 58  87 130 194  36  54 210   0   1   0   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [210  58  87 130 194  36  54   0   0   1   0   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [ 54 210  58  87 130 194  36   0   0   0   1   0   0   0]</span></span><br><span class="line"><span class="comment"># output: [ 36  54 210  58  87 130 194   0   0   0   0   1   0   0]</span></span><br><span class="line"><span class="comment"># output: [194  36  54 210  58  87 130   0   0   0   0   0   1   0]</span></span><br><span class="line"><span class="comment"># output: [130 194  36  54 210  58  87   0   0   0   0   0   0   1]</span></span><br></pre></td></tr></table></figure>

<p>然后使用LLL算法可以快速的找出行组合出来的短向量.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">M.LLL()</span><br><span class="line"><span class="comment"># output: [ -1  -1   1  -1   1   0   0  -1   1  -1  -1   1   0   0]</span></span><br><span class="line"><span class="comment"># output: [  0  -1  -1   1  -1   1   0   0  -1   1  -1  -1   1   0]</span></span><br><span class="line"><span class="comment"># output: [  1  -1   1  -1   0   0   1  -1   1   1  -1   0   0   1]</span></span><br><span class="line"><span class="comment"># output: [ -1   1  -1   0   0   1   1   1   1  -1   0   0   1  -1]</span></span><br><span class="line"><span class="comment"># output: [  1  -1   0   0   1   1  -1   1  -1   0   0   1  -1   1]</span></span><br><span class="line"><span class="comment"># output: [  1   1   1   1   1   1   1   1   1   1   1   1   1   1]</span></span><br><span class="line"><span class="comment"># output: [  0   0   1   1  -1   1  -1   0   0   1  -1   1   1  -1]</span></span><br><span class="line"><span class="comment"># output: [ 39 -28  19  12  11 -48  -4  47   6 -31 -20 -19  36 -18]</span></span><br><span class="line"><span class="comment"># output: [ -5 -34 -14  -3   9 -39 -43  47  54  22   1 -17  19   1]</span></span><br><span class="line"><span class="comment"># output: [  4 -39  28 -19 -12 -11  48  18 -47  -6  31  20  19 -36]</span></span><br><span class="line"><span class="comment"># output: [  9 -40 -43  -5 -32 -13  -1 -17  20   1  47  54  23   3]</span></span><br><span class="line"><span class="comment"># output: [ -1   9 -40 -43  -5 -32 -13   3 -17  20   1  47  54  23]</span></span><br><span class="line"><span class="comment"># output: [ 14   3  -9  40  43   4  32 -22  -3  17 -18  -1 -48 -54]</span></span><br><span class="line"><span class="comment"># output: [ 28 -19 -12 -11  48   4 -39  -6  31  20  19 -36  18 -47]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里详细的解释一下, 因为多项式g的系数就是由$q,q\cdot x,q\cdot x^2,q\cdot x^3,q\cdot x^4,q\cdot x^5,q\cdot x^6,h3,h3\cdot x,h3\cdot x^2,h3\cdot x^3,h3\cdot x^4,h3\cdot x^5,h3\cdot x^6$这些项的系数线性组合而来的, 矩阵M左下角那一块就是h3可能出现的系数的排列, 左上角一块是q和$x^n$相乘的系数(其实就是q), 这些行向量进行线性组合的结果中, 肯定存在$g$的系数, 而又因为$g$的系数都是很小的$\{1,0,-1\}$, 所以利用格基规约, 可以把向量$g$规约出来.</p>
</blockquote>
<p>第一行的就是$f$对应的$g$, 事实上, 如果$f$的负数那么产生的也是$g$的负数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">M.LLL()[<span class="number">0</span>][n:]</span><br><span class="line"><span class="comment"># output: (-1, 1, -1, -1, 1, 0, 0)</span></span><br><span class="line">Zx(<span class="built_in">list</span>(_))</span><br><span class="line"><span class="comment"># output: x^4 - x^3 - x^2 + x - 1</span></span><br><span class="line">f</span><br><span class="line"><span class="comment"># output: -x^4 + x^3 + x^2 - x + 1</span></span><br></pre></td></tr></table></figure>

<p>但是攻击者仍然可以解密且不考虑负数. 同样的, LLL 可以产生能够正常用于解密的$x \cdot f$和$x \cdot g$, 所以对于NTRU方案, 需要更大的参数$n$来保证它的安全性.</p>
<h2 id="自动化攻击"><a href="#自动化攻击" class="headerlink" title="自动化攻击"></a>自动化攻击</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack</span>(<span class="params">publickey</span>):</span></span><br><span class="line">  recip3 = lift(<span class="number">1</span>/Integers(q)(<span class="number">3</span>))</span><br><span class="line">  publickeyover3 = balancedmod(recip3 * publickey,q)</span><br><span class="line">  M = matrix(<span class="number">2</span> * n)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    M[i,i] = q</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    M[i+n,i+n] = <span class="number">1</span></span><br><span class="line">    c = convolution(x^i,publickeyover3)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">      M[i+n,j] = c[j]</span><br><span class="line">  M = M.LLL()</span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> * n):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">      f = Zx(<span class="built_in">list</span>(M[j][n:]))</span><br><span class="line">      f3 = invertmodprime(f,<span class="number">3</span>)</span><br><span class="line">      <span class="keyword">return</span> (f,f3)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">      <span class="keyword">pass</span></span><br><span class="line">  <span class="keyword">return</span> (f,f)</span><br><span class="line"></span><br><span class="line">n = <span class="number">120</span></span><br><span class="line">q = <span class="number">2</span>^<span class="number">32</span></span><br><span class="line">d = <span class="number">81</span></span><br><span class="line"></span><br><span class="line">publickey,secretkey = keypair()</span><br><span class="line">donald = attack(publickey)</span><br><span class="line"><span class="built_in">print</span> donald[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  m = randommessage()</span><br><span class="line">  c = encrypt(m,publickey)</span><br><span class="line">  <span class="keyword">assert</span> decrypt(c,donald) == m</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&#x27;attack successfully decrypts&#x27;</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&#x27;attack was unsuccessful&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个脚本用的是Python2的sage? 真的要用来解题估计还得自己写一个</p>
</blockquote>

        </div></article>
      <nav class="pagination"><a class="prev" href="/page/14/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text">Prev</span>
      </a>
    <a class="next" href="/page/16/">
        <span class="next-text">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></section></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
        <a target="_blank" rel="noopener" href="https://github.com/tearsjin" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2020 - 2022<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">K1rit0</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
