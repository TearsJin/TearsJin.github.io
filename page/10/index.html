<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="k1rit0"><title>K1rit0's Blog</title><meta name="description" content="just for fun"><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.webp"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/tags">Tags</a></li><li> <a href="/about">About</a></li><li> <a href="/links">Links</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)" style="display:none;"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li></div><div class="avatar"><img src="https://avatars.githubusercontent.com/u/56160386?s=96&amp;v=4"></div></div></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo@2x.webp" style="width:220px;" alt="favicon"><h3 title=""><a href="/">K1rit0's Blog</a></h3><div class="description"><p>just for fun</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/tearsjin"><i class="fa fa-github"></i></a></li><li><a href="mailto:k1rit0@qq.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY=3519728596"><i class="fa fa-qq"></i></a></li></ul></div></div><div class="footer"><div class="p"> <span> 全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> k1rit0</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><span>Anatolo </span></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2021/04/17/writeup-for-2021-MRCTF/">writeup for 2021 MRCTF</a></h3></div><div class="post-content"><div class="card"><p><blockquote>
<p>啊比赛的时候刚好和npy出去玩了, 也没怎么看题, 就看了半个下午的Common prime rsa. 也没整出来.<br>最近又在忙学校的HW<del>就是什么成果都没, 只能看着大佬干自己划水的那种</del>. 所以题目复现什么的就慢了好多.<br>慢慢的更新完吧, 每次做题都一堆paper, 想慢慢的看完只能花多点时间了吧</p>
</blockquote>
<h1 id="Strange-GCD"><a href="#Strange-GCD" class="headerlink" title="Strange_GCD"></a>Strange_GCD</h1><h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">P_bits = <span class="number">444</span></span><br><span class="line">Q_bits = <span class="number">666</span></span><br><span class="line">R_bits = <span class="number">333</span></span><br><span class="line">key_num = <span class="number">9</span></span><br><span class="line">e = <span class="number">0x1337</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    could_not_solve = <span class="literal">False</span></span><br><span class="line">    p = getPrime(P_bits)</span><br><span class="line">    <span class="keyword">if</span> gcd(p-<span class="number">1</span>, e) != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    R = []</span><br><span class="line">    Q = []</span><br><span class="line">    N = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(key_num):</span><br><span class="line">        Q.append(getPrime(Q_bits))</span><br><span class="line">        R.append(getrandbits(R_bits))</span><br><span class="line">        N.append(p * Q[-<span class="number">1</span>] + R[-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> gcd(Q[-<span class="number">1</span>], e) != <span class="number">1</span>:</span><br><span class="line">            could_not_solve = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> could_not_solve:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C = []</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">45</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(key_num):</span><br><span class="line">    tmp_cipher = flag[i*<span class="built_in">len</span>(flag)//key_num:(i+<span class="number">1</span>)*<span class="built_in">len</span>(flag)//key_num].encode()</span><br><span class="line">    tmp_cipher = urandom(<span class="number">128</span> - <span class="built_in">len</span>(tmp_cipher)) + tmp_cipher</span><br><span class="line">    tmp_cipher = <span class="built_in">pow</span>(bytes_to_long(tmp_cipher), e, p * Q[i])</span><br><span class="line">    C.append(tmp_cipher)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;N =&#x27;</span>, N)</span><br><span class="line">print(<span class="string">&#x27;C =&#x27;</span>, C)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">N = [...]</span></span><br><span class="line"><span class="string">C = [...]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="analyses"><a href="#analyses" class="headerlink" title="analyses"></a>analyses</h2><p>这题比完赛以后做的, paper也是直接就看别人找了<del>自己找太浪费时间啦</del></p>
<p>做的时候没看paper, 造格子没去思考怎么消去比较大的项, 看了paper才明白, </p>
<h3 id="AGCD"><a href="#AGCD" class="headerlink" title="AGCD"></a>AGCD</h3><p>先来看看这边的公钥生成, 这共生成了9个$N_i = p \cdot q_i + r_i,i=0,1,…,8$<br>其中$p,q,r$的位数分别为$444,666,333$, 这个问题看着像LWE但是我们只知道$N_i$. 尝试了一下造格子也没啥结果, 找paper找到了这个-&gt; <a target="_blank" rel="noopener" href="https://martinralbrecht.wordpress.com/2020/03/21/the-approximate-gcd-problem/">The Approximate GCD Problem</a> 这里面提供了一个造格子的方法来分解$N_i$</p>
<blockquote>
<p>其实这里面就有一种造格子的思想吧? 我们想要通过格基规约得出结果, 那么我们必须保证我们需要求出的量不会很大(只有这样才能使得我们要求的向量是最短向量), 所以我们的一个思路, 可以是消去一些比较大的数, 留下一些比较小的.</p>
</blockquote>
<p>在这里我们先拿两行等式来分析<br>$$<br>N_0 = p \cdot q_0 + r_0 \\<br>N_1 = p \cdot q_1 + r_1<br>$$<br>我们可以看到式子里有个非常大的$p,q$, 可以想个办法消去这个大的项并且不引入比他更大的项. 一个办法就是通过减法!<br>$$<br>N_1q_0 - N_0q_1 = r_1q_0 - r_0q_1 \tag 1<br>$$<br>通过减法可以将$1110 $ bits的$pq$变成了小一点的$999$ bits 的$r_1q_0 - r_0q_1$, 这里小了点就可以尝试做文章了. 我们可以根据$(1)$这个式子写出剩下的一样的式子<br>$$<br>\begin{cases}<br>N_1q_0 - N_0q_1 = r_1q_0 - r_0q_1 \\<br>N_2q_0 - N_0q_2 = r_2q_0 - r_0q_2 \\<br>\vdots \\<br>N_8q_0 - N_0q_8 = r_8q_0 - r_0q_8<br>\end{cases}<br>$$<br>根据这个式子, 可以造出格子<br>$$<br>(q_0,q_1,…,q_8)<br>\begin{pmatrix}<br>2^\lambda&amp;N_1&amp;N_2&amp;\cdots&amp;N_8 \\<br>0&amp;-N_0&amp;0&amp;\cdots&amp;0 \\<br>0&amp;0&amp;-N_0&amp;\cdots&amp;0 \\<br>0&amp;0&amp;0&amp;\ddots&amp;0 \\<br>0&amp;0&amp;0&amp;\cdots&amp;-N_0<br>\end{pmatrix}<br>=<br>(2^\lambda q_0,r_1q_0-r_0q_1,…,r_8q_0-r_0q_8)<br>$$</p>
<h3 id="lambda-的取值"><a href="#lambda-的取值" class="headerlink" title="$\lambda$ 的取值"></a>$\lambda$ 的取值</h3><p>这里有个参数$\lambda$需要确定下来, 这个参数跟最短向量的上界有关, 一直以来这个参数都是用来调目标向量长度和格的行列式用的, 也没有具体的分析过, 每次做的时候都直接爆破, 这次慢慢分析了一下.</p>
<p>先来看我们要求的向量, 暂时记为$v$<br>$$<br>\begin{align}<br>||v|| &amp; = \sqrt{(2^\lambda q_0)^2 + (r_1q_0-r_0q_1)^2 + \cdots +(r_8q_0-r_0q_8)^2} \\<br>&amp; \approx \sqrt{2^{2\lambda+1332}+2^{1998}+\cdots+2^{1998}} \\<br>&amp; = \sqrt{2^{2\lambda+1332}+2^{2001}} \\<br>&amp; \approx<br>\begin{cases}<br>2^{1001} , \lambda \le 335 \\<br>2^{\lambda + 666} , \lambda &gt;335<br>\end{cases}<br>\end{align}<br>$$<br>再来看看$det(L)$</p>
<p>$$<br>det(L)  = 2^\lambda \cdot N_0^8 \approx 2^{\lambda+8880}<br>$$<br>格子是9维的, 那么我们可以有一个粗略的不等式 $||v|| \le det(L)^{1/9}$<br>通过简单的计算就可以得到<br>$$<br>129 &lt; \lambda &lt; 360 \tag 2<br>$$<br>得到参数的大概取值范围, 选一个中间的就行了, <del>想刺激一点可以试试130 359之类的(反正我试了都是可以的).</del></p>
<blockquote>
<p>(2) 式只是粗略得到的, 因为上界还有更严格的条件而且LLL算法实际上要比理论上要好….</p>
</blockquote>
<p>我们构造出格子并规约后就能得到$q_0$了, 剩下的就是仿造这个格子构造求$q_1,\cdots,q_8$的格子, 求出所有的$q$以后, 因为$q&gt;r$ , 所以$N = r \mod q$, 直接就可以求出$r$了, 继续求出$p$,然后就是正常的RSA解密了.</p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">N = [...]</span><br><span class="line">C = [...]</span><br><span class="line">Q = []</span><br><span class="line">R = []</span><br><span class="line">D = []</span><br><span class="line">t = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    M = <span class="number">2</span>^<span class="number">130</span></span><br><span class="line">    L = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)]</span><br><span class="line">    L[<span class="number">0</span>] = [M]+N[<span class="number">0</span>:t] + N[t+<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">        L[i][i] = - N[t]</span><br><span class="line">    L[<span class="number">0</span>][<span class="number">0</span>] = M</span><br><span class="line">    MQ = <span class="built_in">abs</span>(matrix(L).LLL()[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">assert</span>  MQ % M == <span class="number">0</span></span><br><span class="line">    Q.append(MQ // M)</span><br><span class="line">    t+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n,q <span class="keyword">in</span> <span class="built_in">zip</span>(N,Q):</span><br><span class="line">    R.append(n % q)</span><br><span class="line"></span><br><span class="line">p = (N[<span class="number">0</span>] - R[<span class="number">0</span>]) // Q[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    phi = (p-<span class="number">1</span>) * (Q[i]-<span class="number">1</span>)</span><br><span class="line">    D.append(inverse_mod(<span class="number">0x1337</span>,phi))</span><br><span class="line"><span class="keyword">for</span> c,d,q <span class="keyword">in</span> <span class="built_in">zip</span>(C,D,Q):</span><br><span class="line">    print(long_to_bytes(<span class="built_in">pow</span>(c,d,p*q))[-<span class="number">5</span>:].decode(),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="Common-Prime-RSA"><a href="#Common-Prime-RSA" class="headerlink" title="Common_Prime_RSA"></a>Common_Prime_RSA</h1><h2 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_my_prime</span>(<span class="params">nibt, gamma</span>):</span></span><br><span class="line">    g = getPrime(<span class="built_in">int</span>(nibt * gamma))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = <span class="number">2</span> * g * getPrime(<span class="built_in">int</span>(nibt * (<span class="number">0.5</span> - gamma))) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        q = <span class="number">2</span> * g * getPrime(<span class="built_in">int</span>(nibt * (<span class="number">0.5</span> - gamma))) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(q):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> <span class="number">2</span> * p &gt; q <span class="keyword">and</span> <span class="number">2</span> * q &gt; p</span><br><span class="line">    <span class="keyword">return</span> p, q, g</span><br><span class="line"></span><br><span class="line">p1, q1, g1 = get_my_prime(<span class="number">1024</span>, <span class="number">0.2247</span>)</span><br><span class="line">p2, q2, g2 = get_my_prime(<span class="number">1024</span>, <span class="number">0.3247</span>)</span><br><span class="line">n1 = p1 * q1</span><br><span class="line">n2 = p2 * q2</span><br><span class="line"></span><br><span class="line">print(<span class="built_in">hex</span>(n1))</span><br><span class="line"><span class="comment"># 0x48b11209b62c5bc580d00fc94886272b92814ce35fcd265b2915c6917a299bc54c2c0603c41f8bf7c8f6f2a545eb03d38f99ec995bf6658bb1a2d23056ee21c7230caa2decec688ea9ee00b0d50b39e8cd23eb2c3ddeb20f5ab26777b80052c171f47b716e72f6aee9cece92776fc65119046f9a1ad92c40e2094d7ed7526d49</span></span><br><span class="line"></span><br><span class="line">print(<span class="built_in">hex</span>(<span class="built_in">pow</span>(bytes_to_long(<span class="string">b&#x27;Common prime RSA is a variant of RSA&#x27;</span> + long_to_bytes(g1) + <span class="string">b&#x27;And the common factor g is large prime and p=2ga+1 q=2gb+1&#x27;</span>), <span class="number">3</span>, n1)))</span><br><span class="line"><span class="comment"># 0x27d8d7249643668ffc115be8b61775c60596e51f6313b47ad5af8493526922f5e10026a2cdaef74e22c3eec959dd8771abe3495b18d19f97623f5a3f65f22ff8fc294fc37ceb3b43ebbbf8a9bcf622922e22c5520dbd523483b9dc54fdffcd1a1b3f02ca1f53b75413fb79399ca00034f2acf108ac9a01bd24d2b9df6e27d156</span></span><br><span class="line"></span><br><span class="line">print(<span class="built_in">hex</span>(<span class="built_in">pow</span>(g2, <span class="number">65537</span>, n1)))</span><br><span class="line"><span class="comment"># 0xeaf06b9050a809659f962251b14d6b93009a7010f0e8d8f0fa4d71591757e98243b8ff50ec98a4e140fd8a63bbb4b8bb0a6d302a48845b8b09d1e40874fcb586ddccbb0bbf86d21540ec6c15c1d2bf925942f6f384fdc1baae7f8e06150ccd9459eb65d0f07eea16a911fa0a17e876a145dbfec83537ca2bee4641897b9f7f5</span></span><br><span class="line"></span><br><span class="line">print(<span class="built_in">hex</span>(n2))</span><br><span class="line"><span class="comment"># 0x6d457110d6044472d786936acbd3cd93c7728daa3343b35ccaa5c55eba6b35c28c831bb245b8cdd8fc8cb67a72f57e62a0e1259f5e804c487a8478f6895b302d39277bd73947598a5f8ec0a535be9e9a4d34df91df948ee44cc3d13d14e23b9651089e4767c7f0e7245df55619c92fe24483225d35f5f3ee6f74375065766ffd</span></span><br><span class="line"></span><br><span class="line">print(<span class="built_in">hex</span>(<span class="built_in">pow</span>(bytes_to_long(flag.encode()), <span class="number">65537</span>, n2)))</span><br><span class="line"><span class="comment"># 0x15be2b0eaef8837a753587c47d3f31696a7d239d88837a9b7d903cd0d0648ef8e225ea555402693a23f305d19e7e13905be61b44c651dba5b26614bcf876234e765a724e0ed8af4a4e408e6a233c48ab9cc63e9c552ef9cd1999512aa0aca830fe6cbcbcc3c6bb354903124a2c3a12d442cdbdefdae6576f4bbc1515051b7111</span></span><br></pre></td></tr></table></figure>

<h2 id="analyses-1"><a href="#analyses-1" class="headerlink" title="analyses"></a>analyses</h2><p>这道题做的时候自己踩了坑, 也没做出来, 后面看wp找到了那个paper才大概明白, 关于界的确定还得谢谢d33师傅.</p>
<h3 id="coppersmith"><a href="#coppersmith" class="headerlink" title="coppersmith"></a>coppersmith</h3><p>这题的第一个problem就是求解$g_1$, 第一个明文可以分成三部分<br>$$<br>Plaintext_1 = high | g_1 | low \tag 1<br>$$<br>$high$和$low$我们都是知道的, 而$g1$和$low$的位数分别为$230,463$</p>
<p>所以理论上$(1)$式可以写成<br>$$<br>Plaintext_1 = 2^{693} \cdot high + 2^{463}\cdot g_1 + low<br>$$<br>这里就有个坑了, 字符串在拼接的时候肯定都是完整的字节在拼的, 所以每一段的位数都应该是8的倍数才对, 所以正确的$(1)$式应该为:<br>$$<br>Plaintext_1 = 2^{696} \cdot high + 2^{464} \cdot g_1 + low<br>$$<br> $g_1$的位数为$230$, 是满足coppersmith的条件的.</p>
<p>我们记$mbar = 2^{696}\cdot high + low$, 那么就有$c_1 = (mbar+2^{464}\cdot g_1)^3 \mod n_1$, 化成首一多项式后coppersmith method即可求出$g_1$</p>
<h3 id="further-attacks-on-server-aided-rsa"><a href="#further-attacks-on-server-aided-rsa" class="headerlink" title="further attacks on server-aided rsa"></a>further attacks on server-aided rsa</h3><p>我们从上部分得到了$g_1$ , 我们可以看看$p,q$和$g$的关系, 为了方便讨论, 直接记$g = 2g_1$<br>$$<br>p = xg+1 \\<br>q = yg+1<br>$$<br>那么我们有<br>$$<br>{N - 1 \over g} = xyg + (x+y) \tag 2<br>$$<br>这里设$xy = u - c, x+y =v+cg$, 那么$(2)$式可以化成<br>$$<br>{N - 1 \over g} = ug+v<br>$$<br>这里的$v &lt; g$ , 也就是把$v$看成是${N-1\over g }\mod g$的结果. 那么$u,v$都是可以计算出来的, 重点在于新引入的$c$, 求出$c$就可以求$p,q$了</p>
<p>paper里提供了一种利用bsgs<del>北上广深</del>思想的方法来求出这个c, 但这题跟paper在c的界上有区别.</p>
<blockquote>
<p>原paper是这样的, 我们随便找一个素数$a$ , 观察下面的式子<br>$$<br>a^{ug} \equiv a^{xyg+cg} \equiv a^{cg} \mod N<br>$$<br>为什么$a^{xyg}$没有了呢? 因为$k \cdot lcm(p-1,q-1) = xyg$ .</p>
<p>然后求一下$c$的上界, 后面要用到<br>$$<br>\begin{align}<br>&amp;\because x+y  =v+ cg \\<br>&amp;\therefore x+y &gt; cg \\<br>&amp;\because x,y \approx {\sqrt{N} \over g} \\<br>&amp;\therefore  cg &lt; {2 \sqrt{N} \over g} \\<br>&amp;\therefore 0&lt;c &lt; {2 \sqrt{N} \over g^2}<br>\end{align}<br>$$<br>记$b = a^g \mod N$, 我们有$b^u \equiv b^c \mod N$ , paper里提到了这个$u,c$是很大概率相等的, 有师傅知道为什么吗?<br>所以我们可以用bsgs的思想, 计算两组数.<br>$$<br>\begin{align}<br>&amp; b^0,b^D,b^{2D},\cdots,b^{D^2} \mod N \\<br>&amp; b^u,b^{u-1},b^{u-2},\cdots,b^{u-D} \mod N<br>\end{align}<br>$$<br>其中$D = \lfloor \sqrt{ {2 \sqrt N \over g^2}-0}\rceil$</p>
<p>在这两组数中搜索碰撞, 也就是$b^{u-i} \equiv b^{kD} \mod N$ . 找到碰撞以后就可以计算$c = kD + i$了, 有了$c$就可以分解$N$了</p>
</blockquote>
<p>当我看完paper以后兴奋的写了$exp$, 却发现这个北上广深把我内存全部吃完都没有结果(早上起来发现电脑屏幕都打不开了….<br>怎么会没结果啊…只能去看<a target="_blank" rel="noopener" href="https://d33b4t0.com/">d33</a>师傅的wp了! 因为他什么都会, 看完才明白原来paper里的界太松散了, 导致$D$太大, 跑出来需要多几根内存才行, 可是我只有一根8G的内存. </p>
<p>d33师傅的界:</p>
<p>因为$p,q$的位数相同, 所以我们还有一个隐藏的关系式<br>$$<br>p&gt;2q \implies x &lt; 2y \tag3 \implies {x\over 2}&lt; y<br>$$<br>这个式子很重要, 我们继续观察一下$x+y$和$c$的关系$x+y -v  = cg$, 我们可以根据基本不等式写出上界, 再根据$(3)$式写出下界<br>$$<br>{ 3\sqrt N \over 2g } - v\approx {3\over 2}x-v\leq cg \leq 2 \sqrt{xy} - v \approx {2\sqrt N \over g} -v<br>$$<br>根据这个, 咱们就有一个更加严格的$c$的界<br>$$<br>c \in [ { 3\sqrt N - 2gv\over 2g^2 },{2\sqrt N - gv \over g^2} ]<br>$$<br>同样的, 计算$D = \lfloor {2\sqrt N - gv \over g^2}- { 3\sqrt N - 2gv\over 2g^2 }  \rceil $, 再用bsgs就可以求出$c$了, <del>但我8G的小内存依旧跑不出来</del>, 只能借用一下d33师傅的数据了</p>
<p>分解了$n_1$就能求出$g_2$, 由于$g_2$的位数比较大, $g_2 &gt; x+y$, 直接就有:<br>$$<br>{n_2 - 1 \over 2g_2} = x+y \mod 2g_2<br>$$<br>$xy$也可以直接求出来了, 然后依旧是分解$n_2$, 就可以求出flag了</p>
<h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes <span class="keyword">as</span> l2b,bytes_to_long <span class="keyword">as</span> b2l</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line">n1 = <span class="number">0x48b11209b62c5bc580d00fc94886272b92814ce35fcd265b2915c6917a299bc54c2c0603c41f8bf7c8f6f2a545eb03d38f99ec995bf6658bb1a2d23056ee21c7230caa2decec688ea9ee00b0d50b39e8cd23eb2c3ddeb20f5ab26777b80052c171f47b716e72f6aee9cece92776fc65119046f9a1ad92c40e2094d7ed7526d49</span></span><br><span class="line">n2 = <span class="number">0x6d457110d6044472d786936acbd3cd93c7728daa3343b35ccaa5c55eba6b35c28c831bb245b8cdd8fc8cb67a72f57e62a0e1259f5e804c487a8478f6895b302d39277bd73947598a5f8ec0a535be9e9a4d34df91df948ee44cc3d13d14e23b9651089e4767c7f0e7245df55619c92fe24483225d35f5f3ee6f74375065766ffd</span></span><br><span class="line">c1 = <span class="number">0x27d8d7249643668ffc115be8b61775c60596e51f6313b47ad5af8493526922f5e10026a2cdaef74e22c3eec959dd8771abe3495b18d19f97623f5a3f65f22ff8fc294fc37ceb3b43ebbbf8a9bcf622922e22c5520dbd523483b9dc54fdffcd1a1b3f02ca1f53b75413fb79399ca00034f2acf108ac9a01bd24d2b9df6e27d156</span></span><br><span class="line">c2 = <span class="number">0xeaf06b9050a809659f962251b14d6b93009a7010f0e8d8f0fa4d71591757e98243b8ff50ec98a4e140fd8a63bbb4b8bb0a6d302a48845b8b09d1e40874fcb586ddccbb0bbf86d21540ec6c15c1d2bf925942f6f384fdc1baae7f8e06150ccd9459eb65d0f07eea16a911fa0a17e876a145dbfec83537ca2bee4641897b9f7f5</span></span><br><span class="line">c3 = <span class="number">0x15be2b0eaef8837a753587c47d3f31696a7d239d88837a9b7d903cd0d0648ef8e225ea555402693a23f305d19e7e13905be61b44c651dba5b26614bcf876234e765a724e0ed8af4a4e408e6a233c48ab9cc63e9c552ef9cd1999512aa0aca830fe6cbcbcc3c6bb354903124a2c3a12d442cdbdefdae6576f4bbc1515051b7111</span></span><br><span class="line">a = b2l(<span class="string">b&#x27;Common prime RSA is a variant of RSA&#x27;</span>) &lt;&lt; <span class="number">696</span></span><br><span class="line">b = b2l(<span class="string">b&#x27;And the common factor g is large prime and p=2ga+1 q=2gb+1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mbar = a+b</span><br><span class="line">R.&lt;x&gt; = Zmod(n1)[]</span><br><span class="line">f = ((<span class="number">2</span>^<span class="number">464</span>) * x + mbar) ^ <span class="number">3</span> - c1</span><br><span class="line">f = f.monic()</span><br><span class="line">g1 = <span class="built_in">int</span>(f.small_roots(X=<span class="number">2</span>^<span class="number">230</span>,beta=<span class="number">1</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">beta = <span class="number">2</span>* g1</span><br><span class="line">v = ((n1 - <span class="number">1</span>) // beta)% beta</span><br><span class="line">u = ((n1 - <span class="number">1</span>) // beta - v) // beta</span><br><span class="line">b = <span class="built_in">pow</span>(<span class="number">2</span>,beta,n1)</span><br><span class="line">left = (<span class="number">2</span>*<span class="built_in">int</span>(sqrt(n1))//beta-<span class="number">2</span>-v)//beta </span><br><span class="line">right = (<span class="number">3</span>*<span class="built_in">int</span>(sqrt(<span class="number">2</span>)*sqrt(n1))//(<span class="number">2</span>*beta) - <span class="number">2</span> - v )//beta </span><br><span class="line">D = <span class="built_in">int</span>(sqrt(right - left)) + <span class="number">1</span></span><br><span class="line"><span class="comment">#############################################################</span></span><br><span class="line"><span class="comment">#  这部分应该是bsgs部分由于没办法跑出结果,无法确定自己的算法是否正确  #</span></span><br><span class="line"><span class="comment">#  所以就先不放出来了,想知道具体的可以找d33师傅的博客               #</span></span><br><span class="line"><span class="comment">#############################################################</span></span><br><span class="line"></span><br><span class="line">c=left+<span class="number">698170</span>*D+<span class="number">5980588</span></span><br><span class="line">xy = u - c </span><br><span class="line">x_y = v + c * beta</span><br><span class="line">x = var(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">f = x^<span class="number">2</span> - x_y * x + xy</span><br><span class="line">x,y = f.roots()[<span class="number">0</span>][<span class="number">0</span>],f.roots()[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">p,q = x *beta+<span class="number">1</span>,y*beta+<span class="number">1</span></span><br><span class="line"><span class="keyword">assert</span> p*q == n1</span><br><span class="line">g2 = <span class="built_in">int</span>(<span class="built_in">pow</span>(c2,<span class="built_in">int</span>(inverse_mod(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))),n1))</span><br><span class="line">beta = <span class="number">2</span> * g2</span><br><span class="line">x_y = ((n2 - <span class="number">1</span>) // beta)% beta</span><br><span class="line">xy = ((n2 - <span class="number">1</span>) // beta - x_y) // beta</span><br><span class="line">x = var(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">f = x^<span class="number">2</span> - x_y * x + xy</span><br><span class="line">x,y = f.roots()[<span class="number">0</span>][<span class="number">0</span>],f.roots()[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">p,q = x *beta+<span class="number">1</span>,y*beta+<span class="number">1</span></span><br><span class="line"><span class="keyword">assert</span> p*q == n2</span><br><span class="line">l2b(<span class="built_in">pow</span>(c3,<span class="built_in">int</span>(inverse_mod(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))),n2))</span><br></pre></td></tr></table></figure>

<h1 id="Strange-CRT"><a href="#Strange-CRT" class="headerlink" title="Strange_CRT"></a>Strange_CRT</h1><h2 id="problem-2"><a href="#problem-2" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">beta = <span class="number">0.34</span></span><br><span class="line">delta = <span class="number">0.02</span></span><br><span class="line">amplification = <span class="number">2048</span></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="built_in">int</span>(beta * amplification))</span><br><span class="line">q = getPrime(<span class="built_in">int</span>((<span class="number">1</span> - beta) * amplification))</span><br><span class="line">N = p * q</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    dq = getrandbits(<span class="built_in">int</span>(delta*amplification))</span><br><span class="line">    dp = getrandbits(<span class="built_in">int</span>((beta-delta) * amplification))</span><br><span class="line">    <span class="keyword">if</span> (dp-dq) % gcd(p-<span class="number">1</span>, q-<span class="number">1</span>) != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    d = ((inverse((p-<span class="number">1</span>)//gcd(p-<span class="number">1</span>, q-<span class="number">1</span>), (q-<span class="number">1</span>)//gcd(p-<span class="number">1</span>, q-<span class="number">1</span>)) * (dq-dp)//gcd(p-<span class="number">1</span>, q-<span class="number">1</span>)) % ((q-<span class="number">1</span>)//gcd(p-<span class="number">1</span>, q-<span class="number">1</span>))) * (p-<span class="number">1</span>) + dp</span><br><span class="line">    <span class="keyword">if</span> gcd(d, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">e = inverse(d, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = bytes_to_long(flag.encode())</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, N)</span><br><span class="line">print(<span class="string">&#x27;N =&#x27;</span>, N)</span><br><span class="line">print(<span class="string">&#x27;e =&#x27;</span>, e)</span><br><span class="line">print(<span class="string">&#x27;c =&#x27;</span>, c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">N = 7194944829894746935571965271122989443610702698015123026500274312320541540511952275333536082176132102091625202863345739074691901574020649953130369453360247690506566827078013306825941200018330639608298539682191482947557146237487451707849833303794107411686130468587672820352641436722348277258977791778239539008852841749667581869688275892813664557078043533743669277649148468667399393518112220602616186358353262921270486781426670131125521444335280904901224934061164334131460273779473387748722008412594372005590209919098686472153912130124772089012962023984089123929555594332030502775588070235834837667605812843128059372243</span></span><br><span class="line"><span class="string">e = 5872666789397408936685003821802975734744078884385553897196686533187747297681714766542317071546532454504513425295170366015384657690105523240363850101369048640430719519784564240908244756652800934680608667950183962226340288720771217107508516125044088043789281574833079766048266075717484676158307477384862873719462770774288252074344824446884295300603035728339571606659365040029505127532956295163195257002051007447197735267997104725561159289832252522298457628452222155625714679911912616173849423059919537353814530280736653541415686756485413316581322357887750268983241858913704388088485132644523120028234659344174431547087</span></span><br><span class="line"><span class="string">c = 6601667269134560091452287214083525217696007424340765571114688738279264700361513951309195757650152324371826111195352731779137577044473630747863137747356695892337017953751159248388157498368915463745769509485009626774902347006319659852239932231921393353157319713540010424345134411781723171111939891127671029064626426950125001347122070491553845919803891156107693973027238705710354919725550360159383455222982999904576805089837067774838194257113022653159325313574447189639317397889065351340828031907571541750274329094240472180870714728295651611160552345500801797030280900507979459558944006193012524181456837126192865748097</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>May2002_Chapter_CryptanalysisOfUnbalancedRSAWi   这篇paper介绍了针对dp过小并且p,q相差过大的情况下对rsa的一种攻击方法, 具体的原理可以看这篇论文, 这边就简单的说一下条件</p>
</blockquote>
<p>要使用这个攻击方法必须满足两个条件<br>$$<br>q &lt; N^\beta, d_p &lt; N^\delta \<br>\beta &lt; 0.382 , \delta \ 越小越好吧 具体的界我也没看明白<br>$$<br>这个方法利用了一个定理 </p>
<blockquote>
<p>(Howgrave-Graham) Let f (x, y) be a polynomial that is a sum of at most ω monomial. Suppose f (x0, y 0) = 0 mod pm for some positive integer m, where |x0| ≤ X and |y0| ≤ Y . If || f (xX, yY )|| &lt; pm √ω , then f (x0, y 0) = 0 holds over the integers.</p>
<p>$f(x,y)$是一个最大w阶的多项式, 假设存在$|x_0| ≤ X,|y_0| ≤ Y$,对于一些正整数m有$f(x_0,y_0) = 0 \mod p^m$, 如果$||f(xX,yX)|| &lt; {p^m \over \sqrt w}$, 那么$f(x_0,y_0) = 0$在整数上成立, 垃圾翻译 大概就是这个意思</p>
</blockquote>
<p>构造格<br>$$<br>\begin{pmatrix}<br>N^2X^3&amp;&amp;&amp; \<br>eNX^3&amp;-NX^2Y&amp;&amp; \<br>e^2X^3&amp;-2eX^2Y&amp;XY^2&amp; \<br>e^3X^3&amp;-3e^2X^2Y&amp;3eXY^2&amp;-Y^3<br>\end{pmatrix}<br>$$<br>其中$X = N^\delta, Y = N^{\delta + \beta}$</p>
<p>这个格子每一行都是$eX - Y$的倍数, 所以最后组成的最短行向量中的$X,Y$替换成$x,y$, 得到的方程的根$(x_0,y_0)$就是,$ex-y$这个方程的根. </p>
<p>所以直接规约格基, 把最短向量中的$X,Y$都除掉, 利用得到的系数重新构造一个整数上的方程, 最后因式分解找到一次的项的系数就是$d_p,k+1$</p>
<h2 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">N = <span class="number">7194944829894746935571965271122989443610702698015123026500274312320541540511952275333536082176132102091625202863345739074691901574020649953130369453360247690506566827078013306825941200018330639608298539682191482947557146237487451707849833303794107411686130468587672820352641436722348277258977791778239539008852841749667581869688275892813664557078043533743669277649148468667399393518112220602616186358353262921270486781426670131125521444335280904901224934061164334131460273779473387748722008412594372005590209919098686472153912130124772089012962023984089123929555594332030502775588070235834837667605812843128059372243</span></span><br><span class="line">e = <span class="number">5872666789397408936685003821802975734744078884385553897196686533187747297681714766542317071546532454504513425295170366015384657690105523240363850101369048640430719519784564240908244756652800934680608667950183962226340288720771217107508516125044088043789281574833079766048266075717484676158307477384862873719462770774288252074344824446884295300603035728339571606659365040029505127532956295163195257002051007447197735267997104725561159289832252522298457628452222155625714679911912616173849423059919537353814530280736653541415686756485413316581322357887750268983241858913704388088485132644523120028234659344174431547087</span></span><br><span class="line">c = <span class="number">6601667269134560091452287214083525217696007424340765571114688738279264700361513951309195757650152324371826111195352731779137577044473630747863137747356695892337017953751159248388157498368915463745769509485009626774902347006319659852239932231921393353157319713540010424345134411781723171111939891127671029064626426950125001347122070491553845919803891156107693973027238705710354919725550360159383455222982999904576805089837067774838194257113022653159325313574447189639317397889065351340828031907571541750274329094240472180870714728295651611160552345500801797030280900507979459558944006193012524181456837126192865748097</span></span><br><span class="line"></span><br><span class="line">beta = <span class="number">0.34</span></span><br><span class="line">delta = <span class="number">0.02</span></span><br><span class="line">amplification = <span class="number">2048</span></span><br><span class="line"></span><br><span class="line">X = <span class="built_in">int</span>(N ** delta)</span><br><span class="line">Y = <span class="built_in">int</span>(N ** (delta + beta))</span><br><span class="line"></span><br><span class="line">M = Matrix(</span><br><span class="line">    [</span><br><span class="line">        [N ** <span class="number">2</span> * X ** <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [e * N * X ** <span class="number">3</span>, -N * X ** <span class="number">2</span> * Y, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [e ** <span class="number">2</span> * X ** <span class="number">3</span>, -<span class="number">2</span> * e * X ** <span class="number">2</span> * Y, X * Y ** <span class="number">2</span>, <span class="number">0</span>],</span><br><span class="line">        [e ** <span class="number">3</span> * X ** <span class="number">3</span>, -<span class="number">3</span> * e ** <span class="number">2</span> * X ** <span class="number">2</span> * Y, <span class="number">3</span> * e * X * Y ** <span class="number">2</span>, -(Y ** <span class="number">3</span>)],</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line">L = M.LLL()[<span class="number">0</span>]</span><br><span class="line">x,y = var(<span class="string">&#x27;x&#x27;</span>),var(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">f = x ** <span class="number">3</span>*(L[<span class="number">0</span>] // X ** <span class="number">3</span>) + x ** <span class="number">2</span> * y * (L[<span class="number">1</span>] // X**<span class="number">2</span> // Y)+ x * y ** <span class="number">2</span> * (L[<span class="number">2</span>] // X // Y ** <span class="number">2</span>)+ y ** <span class="number">3</span> * (L[<span class="number">3</span>] // Y** <span class="number">3</span>)</span><br><span class="line">print(f.factor())</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(144242809483056840663075735623298553029680437297789965222541248349475437890222709450048997656976387390752105996145725490546933534602744908786700426835710727511955799912350818546609860818884274334936799981304721460528637717*x + 636751972323*y)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">dp = <span class="number">636751972323</span></span><br><span class="line">k = <span class="number">144242809483056840663075735623298553029680437297789965222541248349475437890222709450048997656976387390752105996145725490546933534602744908786700426835710727511955799912350818546609860818884274334936799981304721460528637717</span> + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> (e * dp - <span class="number">1</span> ) % k == <span class="number">0</span></span><br><span class="line">p = (e * dp - <span class="number">1</span> ) // k + <span class="number">1</span></span><br><span class="line"><span class="keyword">assert</span> N % p == <span class="number">0</span></span><br><span class="line">q = N // p</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,phi)</span><br><span class="line">print(long_to_bytes(<span class="built_in">pow</span>(c,d,N)))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2021-04-17</span><a class="tag" href="/categories/WriteUp/" title="WriteUp">WriteUp </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Crypto/" title="Crypto">Crypto </a><i class="fa fa-tag"></i><a class="tag" href="/tags/RSA/" title="RSA">RSA </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Coppersmith/" title="Coppersmith">Coppersmith </a><span class="leancloud_visitors"></span><span>About 3869 words, 12 min 53 sec  read</span></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/page/9/">Previous</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/page/11/">Next</a></li></ul></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>