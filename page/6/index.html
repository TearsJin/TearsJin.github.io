<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="222222"/><link rel="alternate" href="/atom.xml" title="K1rit0's Blog" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="http://tearsjin.github.io/page/6/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" /><script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":true};
</script>

    <title>K1rit0's Blog</title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">K1rit0's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archives
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About
          </li>
      </a><a href="/link/">
        <li class="mobile-menu-item">Link
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">K1rit0's Blog</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            Categories
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            About
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/link/">
            Link
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><section id="posts" class="posts"><article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2021/09/07/writeup-for-2021-WMCTF/">writeup for 2021 WMCTF</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2021-09-07
        </span><span class="post-category">
            <a href="/categories/WriteUp/">WriteUp</a>
            </span>
        </div>
    </header>

    <div class="post-content"><p>æ¯”èµ›é‚£å¤©åˆšå¥½è¿”æ ¡, æ²¡æ€ä¹ˆæ‰“, å¤ç›˜ä¸€ä¸‹</p>
<h1 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h1><p>çŒœè°œä¸€æ ·â€¦ ç›´åˆ°æ˜¯èƒŒåŒ…é—®é¢˜ä¹Ÿä¸çŸ¥é“å…·ä½“è¯¥åšä»€ä¹ˆâ€¦. </p>
<p>æŒ‚ç€å…ˆ</p>
<h1 id="baby-OCB"><a href="#baby-OCB" class="headerlink" title="baby_OCB"></a>baby_OCB</h1><blockquote>
<p>çº¢æ˜å¤, ä¸‹æ¬¡ä¸€å®šå­¦ä¼šå’•å’•å’•å’•å’•</p>
</blockquote>
<h1 id="easylsb"><a href="#easylsb" class="headerlink" title="easylsb"></a>easylsb</h1><h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">password = <span class="string">b&#x27;Hidden&#x27;</span></span><br><span class="line">flag = (<span class="string">&#x27;flag&#123;&#x27;</span> + <span class="built_in">str</span>(uuid.uuid4()) + <span class="string">&#x27;&#125;&#x27;</span>).encode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># def proof_of_work():</span></span><br><span class="line"><span class="comment">#     random.seed(os.urandom(8))</span></span><br><span class="line"><span class="comment">#     proof = &#x27;&#x27;.join([random.choice(string.ascii_letters+string.digits) for _ in range(20)]).encode()</span></span><br><span class="line"><span class="comment">#     digest = sha256(proof).hexdigest()</span></span><br><span class="line"><span class="comment">#     printf(&quot;sha256(XXXX+%s) == %s&quot; % (proof[4:].decode(),digest))</span></span><br><span class="line"><span class="comment">#     printf(&#x27;Give me X<span class="doctag">XXX:</span>&#x27;)</span></span><br><span class="line"><span class="comment">#     x = read_str()</span></span><br><span class="line"><span class="comment">#     if len(x) != 4 or sha256(x.encode()+proof[4:]).hexdigest() != digest: </span></span><br><span class="line"><span class="comment">#         return False</span></span><br><span class="line"><span class="comment">#     return True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printf</span>(<span class="params">message</span>):</span></span><br><span class="line">    sys.stdout.write(<span class="string">&#x27;&#123;0&#125;\n&#x27;</span>.<span class="built_in">format</span>(message))</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    sys.stderr.flush()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_str</span>():</span></span><br><span class="line">    <span class="keyword">return</span> sys.stdin.readline().strip()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_int</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(sys.stdin.readline().strip())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">next_prime</span>(<span class="params">a</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> isPrime(a):</span><br><span class="line">        a += <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_prime</span>(<span class="params">a</span>):</span></span><br><span class="line">    suffix = getPrime(<span class="number">368</span>)</span><br><span class="line">    <span class="keyword">return</span> next_prime(a ** <span class="number">2</span> + suffix + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_pubkey</span>(<span class="params">key</span>):</span></span><br><span class="line">    p, q = get_prime(getPrime(<span class="number">512</span>)), get_prime(key)</span><br><span class="line">    n = p * q</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">airdrop</span>(<span class="params">a</span>):</span></span><br><span class="line">    n = generate_pubkey(a)</span><br><span class="line">    printf(<span class="string">&#x27;gift: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(n))</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hint</span>(<span class="params">n, e, c</span>):</span></span><br><span class="line">    printf(<span class="string">&#x27;n = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(n))</span><br><span class="line">    printf(<span class="string">&#x27;e = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(e))</span><br><span class="line">    printf(<span class="string">&#x27;c = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(c))</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span>():</span></span><br><span class="line">    p = get_prime(getPrime(<span class="number">512</span>))</span><br><span class="line">    e = <span class="number">0x1000</span></span><br><span class="line">    c = <span class="built_in">pow</span>(bytes_to_long(flag), e, p)</span><br><span class="line">    </span><br><span class="line">    hint(p, e, c)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backdoor</span>():</span></span><br><span class="line">    printf(<span class="string">&#x27;Input your password:&#x27;</span>)</span><br><span class="line">    user_input = read_str()</span><br><span class="line">    <span class="keyword">if</span> user_input.encode() == password:</span><br><span class="line">        leak()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        printf(<span class="string">&#x27;Wrong&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># if not proof_of_work():</span></span><br><span class="line">    <span class="comment">#     exit(0)</span></span><br><span class="line">    </span><br><span class="line">    a = getPrime(<span class="number">512</span>)</span><br><span class="line">    print(a)</span><br><span class="line">    p = get_prime(a)</span><br><span class="line">    q = get_prime(getPrime(<span class="number">512</span>))</span><br><span class="line">    n = p * q</span><br><span class="line">    e = <span class="number">0x10001</span></span><br><span class="line">    max_time = <span class="number">5</span></span><br><span class="line">    password_enc = <span class="built_in">pow</span>(bytes_to_long(password), e, n)</span><br><span class="line">    </span><br><span class="line">    printf(<span class="string">&#x27;====================================&#x27;</span>,)</span><br><span class="line">    printf(<span class="string">&#x27;1. Airdrop                          &#x27;</span>,)</span><br><span class="line">    printf(<span class="string">&#x27;2. Backdoor                         &#x27;</span>,)</span><br><span class="line">    printf(<span class="string">&#x27;3. Hint                             &#x27;</span>,)</span><br><span class="line">    printf(<span class="string">&#x27;4. Exit                             &#x27;</span>,)</span><br><span class="line">    printf(<span class="string">&#x27;====================================&#x27;</span>,)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            printf(<span class="string">&#x27;Your choice:&#x27;</span>)</span><br><span class="line">            choice = read_int()</span><br><span class="line">            <span class="keyword">if</span> choice == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">if</span> max_time &gt; <span class="number">1</span>:</span><br><span class="line">                    airdrop(a)</span><br><span class="line">                    max_time -= <span class="number">1</span></span><br><span class="line">                    printf(<span class="string">&#x27;Done!&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    printf(<span class="string">&#x27;Greed will destroy you!&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> choice == <span class="number">2</span>:</span><br><span class="line">                backdoor()</span><br><span class="line">                printf(<span class="string">&#x27;Done!&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> choice == <span class="number">3</span>:</span><br><span class="line">                hint(n, e, password_enc)</span><br><span class="line">                printf(<span class="string">&#x27;Done!&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> choice == <span class="number">4</span>:</span><br><span class="line">                printf(<span class="string">&#x27;bye~&#x27;</span>)</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                printf(<span class="string">&#x27;Invalid!&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        exit(-<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¦å¾—åˆ°<code>flag</code> å¿…é¡»é€šè¿‡<code>leak()</code> è€Œè¦è°ƒç”¨<code>leak()</code>å¿…é¡»çŸ¥é“<code>password</code></p>
<p>çœ‹ä¸€ä¸‹<code>airdrop()</code>å‡½æ•°</p>
<p>choice 1æ¯æ¬¡è°ƒç”¨éƒ½ä¼šç»™ä¸€ä¸ªgift ä¹Ÿå°±æ˜¯$n$<br>$$<br>n_i = q_i (a^2 + x_i) = q_ia^2 + q_ix_i<br>$$</p>
<h3 id="The-Approximate-GCD-Problem"><a href="#The-Approximate-GCD-Problem" class="headerlink" title="The Approximate GCD Problem"></a>The Approximate GCD Problem</h3><p>ä¹‹å‰çš„æ¯”èµ›ä¹Ÿæœ‰é‡åˆ°è¿‡, è¿™æ¬¡è®¤çœŸçš„å†çœ‹çœ‹$AGCD$</p>
<p>è¿™é‡Œæ˜¯ä¸ª$AGCD$é—®é¢˜, æ‰€è°“çš„$AGCD$å°±æ˜¯è¿‘ä¼¼å€¼$GCD$</p>
<p>æ¯”å¦‚ç°åœ¨æœ‰<br>$$<br>n_0 = p_0 \cdot q \<br>n_1 = p_1 \cdot q \<br>gcd(n_0,n_1) = q<br>$$<br>è¿™ä¸ªå°±æ˜¯ä¸€èˆ¬çš„$GCD$é—®é¢˜,è€Œ$AGCD$å‘¢å°±æ˜¯ç»™è¿™é‡Œçš„æ¯ä¸ª$n$éƒ½åŠ ä¸Šä¸€ä¸ª$error \ \ -&gt; \ (x)$<br>$$<br>n_0 = p_0 \cdot q + x_0\<br>n_1 = p_1 \cdot q + x_1\<br>$$<br>é‚£è¿™æ ·è¦æ±‚å‡º$q$å°±ä¸èƒ½ç”¨ä¹‹å‰çš„ç®—æ³•äº†. ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥æŠŠè¿™ä¸¤è¡Œåˆæˆä¸€ä¸‹<br>$$<br>p_1n_0 - p_0n_1 = p_1x_0 - p_0x_1<br>$$<br>åƒè¿™ç§å½¢å¼çš„ä¸€çœ‹å°±å¯ä»¥å†™åˆ°ä¸€ä¸ªæ ¼å­é‡Œé¢å»<br>$$<br>(p_0,p_1)<br>\begin{pmatrix}<br>R&amp;n_1 \<br>0&amp;-n_0<br>\end{pmatrix}<br>=(p_0R,p_1x_0-p_0x_1)<br>$$<br>å³è¾¹çš„å‘é‡çš„èŒƒæ•°è·Ÿ$R,p,x$æ˜¯æœ‰å…³çš„, è€Œ$R$æ˜¯å¯ä»¥è°ƒæ•´çš„, æ‰€ä»¥ç†è®ºä¸Šåªè¦å³è¾¹çš„å‡ ä¸ªå‚æ•°å¤Ÿå°, æˆ‘ä»¬æ˜¯æœ‰æœºä¼šæ‰¾åˆ°è¿™ä¸ªå‘é‡ä»è€Œæ±‚å‡º$p_0$, æ±‚å‡º$p_0$å°±èƒ½è§£å†³$AGCD$é—®é¢˜äº†.</p>
<p>ç°åœ¨å›åˆ°é¢˜ç›®. ç°åœ¨æœ‰äº”è¡Œå¼å­<br>$$<br>n_0 = q_0a^2 + q_0x_0 \<br>n_1 = q_1a^2 + q_1x_1 \<br>\cdots \<br>n_4 = q_4a^2 + q_4x_4 \<br>$$<br>å…¶å®è¿™é‡Œæˆ‘ä¸€æ‹¿åˆ°è¿™äº”è¡Œå°±å¼€å§‹æ„é€ æ ¼å­åšäº†, ä½†dbtğŸ‘´æé†’äº†æˆ‘, $AGCD$é—®é¢˜å³è¾¹å‚æ•°è¶Šå°è¶Šå¥½,  è€ƒè™‘ä¸€ä¸‹å¼€æ–¹, å› ä¸º$AGCD$é—®é¢˜æœ¬èº«å°±æ˜¯ä¸€ä¸ªè¿‘ä¼¼å€¼æ±‚è§£GCDçš„é—®é¢˜. æ‰€ä»¥æˆ‘ä»¬åœ¨åšçš„è¿‡ç¨‹ä¸­ä¹Ÿåšç‚¹è¿‘ä¼¼ä¸€èˆ¬æ˜¯ä¸ä¼šå½±å“çš„(?æœ‰çˆ·çˆ·ç ”ç©¶è¿‡è¿‘ä¼¼çš„ä¸€ä¸ªåº¦å—<br>$$<br>\sqrt{n_0} = \sqrt{q_0}\sqrt{a^2 + x_0} \<br>\sqrt{n_0} - \hat x \approx \sqrt{q_0}a \<br>\sqrt{n_i} =  \sqrt{q_i}a + \hat x_i<br>$$<br>è®©å³è¾¹çš„å¼å­æ›´å°ä¹‹å, ç”¨äº”ç»„æ•°æ®æ„é€ æ ¼å­<br>$$<br>\begin{pmatrix}<br>R&amp;\sqrt{n_1}&amp;\sqrt{n_2}&amp;\sqrt{n_3}&amp;\sqrt{n_4} \<br>0&amp;-\sqrt{n_0}&amp;0&amp;0&amp;0 \<br>0&amp;0&amp;-\sqrt{n_0}&amp;0&amp;0 \<br>0&amp;0&amp;0&amp;-\sqrt{n_0}&amp;0 \<br>0&amp;0&amp;0&amp;0&amp;-\sqrt{n_0}<br>\end{pmatrix}<br>$$<br>è§„çº¦ä¹‹åèƒ½æ‰¾åˆ°å‘é‡(åé¢çš„ä¸é‡è¦å°±å…ˆä¸å†™äº†)<br>$$<br>(R\sqrt{q_0},\cdots,\cdots,\cdots,\cdots)<br>$$<br>ä½†åœ¨è§„çº¦çš„æ—¶å€™, å› ä¸ºèŒƒæ•°çš„é—®é¢˜, éœ€è¦ä¸æ–­çš„è°ƒæ•´$R$çš„å€¼æ‰èƒ½æ‰¾æˆ‘ä»¬éœ€è¦çš„é‚£ä¸ªå‘é‡, è°ƒæ•´çš„ä¾æ®å°±æ˜¯è¿™ä¸ª$q_0$çš„å¤§å°, è¿™ä¸ªå¤§å°æ˜¯çŸ¥é“çš„$1024 bit$,æ‰€ä»¥æœ€åå¾—åˆ°çš„$\sqrt{q_0}$åº”è¯¥æ˜¯$512bit$</p>
<blockquote>
<p>äº‹å®ä¸Š, åœ¨æˆ‘çœ‹åˆ°çš„blogé‡Œé¢, è¿™ä¸ªRçš„å–å€¼æ˜¯æœ‰ä¸€å®šçš„æ–¹æ³•çš„, æ²¡æœ‰ææ‡‚å…·ä½“è¯¥æ€ä¹ˆå»åˆ¤æ–­, æ‰€ä»¥åªèƒ½é€šè¿‡è°ƒæ•´çš„æ–¹æ³•æ¥åšè¿™é¢˜äº†,</p>
<p>æƒ³èµ·æ¥è‡ªå·±çš„åšå®¢ä¹‹å‰ä¹Ÿæœ‰è¯•è¿‡å»æ¨ä¸€ä¸ªå¤§æ¦‚çš„å€¼, å¯ä»¥ç¿»å‰é¢çš„çœ‹çœ‹</p>
</blockquote>
<p>æ‰€ä»¥ç°åœ¨åªéœ€è¦ä¸æ–­çš„è°ƒæ•´$R$çš„å¤§å°, ç›´åˆ°æ‰¾å‡ºä¸€ä¸ª$512 bit$çš„çœŸæ­£çš„$\sqrt{q_0}$ ,æœ‰äº†$\sqrt{q_0}$å°±èƒ½æ±‚å‡º$a$äº†, </p>
<p>è§£å‡º$a$å‰©ä¸‹çš„å°±æ˜¯å·²çŸ¥$p$é«˜ä½äº†</p>
<blockquote>
<p>åšè¿™é¢˜çš„æ—¶å€™å‘ç°å¦‚æœåªç”¨å››ç»„æ•°æ®, ä¸ç®¡æ€ä¹ˆçš„è°ƒæ•´$R$, ä¹Ÿæ²¡æœ‰åŠæ³•æ‰¾å‡ºæƒ³è¦çš„é‚£ä¸ªå‘é‡å‡ºæ¥, ä¸çŸ¥é“æ˜¯ä¸æ˜¯å› ä¸ºå‚æ•°çš„å¤§å°, å››ç»„æ•°æ®ç»™å‡ºçš„çº¦æŸä¸å¤Ÿå¼º?</p>
</blockquote>
<p>è§£å®ŒAGCDä¹‹åå°±èƒ½æ‹¿åˆ°ä¸€ä¸ªåŠ å¯†çš„flag, eå’Œphiä¸äº’ç´ , å‘ç°eæ˜¯$2^{12}$, ç›´æ¥å¼€12æ¬¡å¹³æ–¹æ ¹å°±è¡Œäº†</p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">sys.path.append(<span class="string">&quot;/home/k1rit0/CTF/&quot;</span>)</span><br><span class="line"><span class="keyword">import</span> myCrypto.AMM <span class="keyword">as</span> AMM</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, isPrime, long_to_bytes</span><br><span class="line"></span><br><span class="line">LAM = <span class="number">380</span></span><br><span class="line">l = <span class="number">5</span></span><br><span class="line">M = [[<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(l)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(l)]</span><br><span class="line">N = [<span class="number">21068286322889605292449387381402285403911455560141090214735354974440606624419616964297007580321013791067226167439872996226832500580037706653803152998537359002847432836899418650117306549893607343160006144352760334920785866221130409904894118963374929467323935674617670738402419178327965359202178162667267351040190371168301980935481660326630257816016921697149710082155701629870160350348818834688225753303057415885022226024601907498521621901308603324694768684738802528845831936410741399435491742825201984427922436831471812070309418640813794622730842698875782093607446798284303784522710493344963880678737688403891400189331</span>,     </span><br><span class="line"><span class="number">12308853561607841041934092506744511689155586116240481655471529969953855274038227343811431655989608434591583673694139060863738492861944511267544267389946989849658784130545243679913412818685768313761630659910263680193434985838781131523993553907838129189461461476296694554655782825701774629683350764866069156868009043211117580921049441277102377562595106269789041165210135844474567428536421792003953066707002965308982249630472773112238349557943156998108879517471317999283500584387777397105486037127797366322210846034599129011995028171723686883387966414035624689126402104807914499946793228044511016295452985310557970379011</span>,     </span><br><span class="line"><span class="number">30738697791225132085580847654714047571186902668616746842899304102159584623469816318757206927486219023390491315148910896488732403322767246394501024688827804510369382155878820868892068583525039291929122306306627213766241320525799308714371006850194133645674073652842238370607838910482032953868627367283394607836966578300168303793400060582848922857236410576441317474208136497407564188049755626445760675555940268390636610085726624705570165069943427799504990418468772678900305743541682004982830947893963522764021022122922104982911181491725457610355492465006313490505471915305370861395875195908816803244772843442663436627811</span>,     </span><br><span class="line"><span class="number">8305502698327938163061403448570905343510072391121488812862051390404395134941843998819543534972233651342461635174480345500578515464031763529097882752145582280163441217012244252516496790390759043249994221367357315376275069348967721415258505344163223181510037360702185803627278919587509933485368201596116686196256578251198487468448008040978019816660838136301253757474040665970837583661727365857243232757366302995923446406792674664094421560455977644181219681801233665490911903627509944363786700632306093740157219837713108792604909612708233475959478546962262259340699913418281265092058666045625836471989209312154073075491</span>,      </span><br><span class="line"><span class="number">9249057556737779363640590847304104073427145700484200097209450631890326978899167760679154628208658960714377959140386507599020762987984595928908203986925752986701463694818100098371494812801057184146507393471109418242580315774651644212154315684690259768215107765517606521494940441845123991021958309973443907208341450704221754039776849253367952771456447007511355415631917532484344389697848200615413029231558971975377100287746424454815515972611696776506127916905426006223842544245270081659891304287086426791583147370534686626291189249685625856952980692492700851557019098598454447260906380261199261945010423393013023715209</span> ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">    N[i] = <span class="built_in">int</span>(sqrt(N[i]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,l):</span><br><span class="line">    M[i][i] = -N[<span class="number">0</span>]</span><br><span class="line">    M[<span class="number">0</span>][i] = N[i]</span><br><span class="line">M[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">2</span> ** LAM</span><br><span class="line">L = Matrix(M).LLL()[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">assert</span> L[<span class="number">0</span>] % <span class="number">2</span> ** LAM == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">q = <span class="built_in">abs</span>(L[<span class="number">0</span>] // <span class="number">2</span> ** LAM)</span><br><span class="line">n = N[<span class="number">0</span>]</span><br><span class="line">a = (n - (n % q)) // q</span><br><span class="line"><span class="comment"># Know high bit of p</span></span><br><span class="line">n = <span class="number">9249057556737779363640590847304104073427145700484200097209450631890326978899167760679154628208658960714377959140386507599020762987984595928908203986925752986701463694818100098371494812801057184146507393471109418242580315774651644212154315684690259768215107765517606521494940441845123991021958309973443907208341450704221754039776849253367952771456447007511355415631917532484344389697848200615413029231558971975377100287746424454815515972611696776506127916905426006223842544245270081659891304287086426791583147370534686626291189249685625856952980692492700851557019098598454447260906380261199261945010423393013023715209</span>        </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">596355871374007258796739088580480254690421307398563449520929804224579804032978250178898982384142847223103176953609592214108362545413436815340326688408982175941755069859344738153840235542651636279657627294019566968304679361239665444560606473133283058393087609946086549065553264454684624204753050326115020520403436076532095607286695957435489522985881581820635688415133423515447960953517405315231071959346343447601273197470177184887138457495799503680274625485150493280857586565387473867813858817367137470006514777542969192548145776362722942018998084778630461770023286812913356191141099060132770816764636107436181833654</span></span><br><span class="line"></span><br><span class="line">_p = a**<span class="number">2</span> </span><br><span class="line">R = PolynomialRing(Zmod(n),<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">x = R.gens()[<span class="number">0</span>]</span><br><span class="line">f = _p + x</span><br><span class="line">roots = f.small_roots(X=<span class="number">2</span> ** <span class="number">368</span>,beta = <span class="number">0.4</span>)</span><br><span class="line"><span class="keyword">if</span> roots:</span><br><span class="line">    p = _p + <span class="built_in">int</span>(roots[<span class="number">0</span>])</span><br><span class="line">    print(p)</span><br><span class="line"><span class="keyword">assert</span> n % p == <span class="number">0</span></span><br><span class="line">q = n // p</span><br><span class="line">phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,phi)</span><br><span class="line">print(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="number">117235409029105051846806067899523247170361728684595002856792997268214583527481018331523314373480172502868245719103537926811678162691190783273715963938227870577908696266175564889962816950193051688136250287087726752359306820791879258724210723175953346754995614733931375012961016374642411090783817788045807125779</span> </span><br><span class="line">e = <span class="number">4096</span></span><br><span class="line">c = <span class="number">9565562547953889050875342796317230683573917021053842636334550812905648260474828549598393988661413478381057558054348342995403993026447829846151651076469025927491897151314215230367392957203050021568190862146104714972731651005427897872753163387978990574633850084765886249824258759820964357075803586150088309646</span>   </span><br><span class="line"></span><br><span class="line">R = PolynomialRing(Zmod(p),<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">R1 = [c]</span><br><span class="line">R2 = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> R1:</span><br><span class="line">        x = R.gens()[<span class="number">0</span>]</span><br><span class="line">        f = x ^ <span class="number">2</span> - r </span><br><span class="line">        roots = f.roots()</span><br><span class="line">        <span class="keyword">if</span> roots:</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> roots:</span><br><span class="line">                R2.append(root[<span class="number">0</span>])</span><br><span class="line">    R1 = R2</span><br><span class="line">    R2 = []</span><br><span class="line">    print(R1)</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> R1:</span><br><span class="line">    print(long_to_bytes(m))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ezl1near"><a href="#ezl1near" class="headerlink" title="ezl1near"></a>ezl1near</h2><h2 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes , bytes_to_long , getPrime , inverse</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> socketserver , signal</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">flag = <span class="string">&#x27;aaaaaaaaaaaaaaaa&#x27;</span></span><br><span class="line">q = <span class="number">2</span>**<span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getrandbits</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> bytes_to_long(os.urandom(n // <span class="number">8</span>+<span class="number">1</span>)) &gt;&gt; (<span class="number">8</span>-n%<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">server</span>(<span class="params">socketserver.BaseRequestHandler</span>):</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_recv</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = self.request.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">return</span> data.strip()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_send</span>(<span class="params">self, msg, newline=<span class="literal">True</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg , <span class="built_in">bytes</span>):</span><br><span class="line">            msg += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            msg = msg.encode()</span><br><span class="line">        self.request.sendall(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>(<span class="params">self</span>):</span></span><br><span class="line">        random.seed(os.urandom(<span class="number">8</span>))</span><br><span class="line">        proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">        _hexdigest = sha256(proof.encode()).hexdigest()</span><br><span class="line">        self._send(<span class="string">f&quot;sha256(XXXX+<span class="subst">&#123;proof[<span class="number">4</span>:]&#125;</span>) == <span class="subst">&#123;_hexdigest&#125;</span>&quot;</span>.encode())</span><br><span class="line">        self._send(<span class="string">b&#x27;Give me XXXX: &#x27;</span>)</span><br><span class="line">        x = self._recv()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(x) != <span class="number">4</span> <span class="keyword">or</span> sha256(x+proof[<span class="number">4</span>:].encode()).hexdigest() != _hexdigest:</span><br><span class="line">            self.send(<span class="string">&#x27;wrong&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">genrsa</span>(<span class="params">self</span>):</span></span><br><span class="line">        _p = getPrime(<span class="number">1024</span>)</span><br><span class="line">        _q = getPrime(<span class="number">1024</span>)</span><br><span class="line">        self.n = _p * _q</span><br><span class="line">        self.e = <span class="number">65537</span></span><br><span class="line">        self.d = inverse(self.e , (_p-<span class="number">1</span>)*(_q-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_vec</span>(<span class="params">self,num , length</span>):</span></span><br><span class="line">        vec = []</span><br><span class="line">        <span class="keyword">while</span> length &gt; <span class="number">0</span>:</span><br><span class="line">            vec = [num % q] + vec</span><br><span class="line">            num //= q</span><br><span class="line">            length -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> vec</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_mat</span>(<span class="params">self,numlist</span>):</span></span><br><span class="line">        M =[]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> numlist:</span><br><span class="line">            M.append(self.to_vec(i , <span class="number">40</span>))</span><br><span class="line">        <span class="keyword">return</span> M</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">self, key , m</span>):</span></span><br><span class="line">        key = self.to_mat(key)  </span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">            temp = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">                temp += m[j]* key[j][i]</span><br><span class="line">                temp %= q</span><br><span class="line">            res.append(temp)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># signal.alarm(120)</span></span><br><span class="line">        <span class="comment"># self.proof_of_work()</span></span><br><span class="line">        self.genrsa()</span><br><span class="line">        self._send(<span class="built_in">str</span>(self.n))</span><br><span class="line">        self._send(<span class="built_in">str</span>(self.e))</span><br><span class="line">        secret = [<span class="number">1</span>] + [<span class="number">2</span>*getrandbits(<span class="number">23</span>)-<span class="number">1</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>)]</span><br><span class="line">        print(secret)</span><br><span class="line">        self._send(<span class="string">b&#x27;Please generate key for me and I will give you my secret.But you have only two chances.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">            key = []</span><br><span class="line">            f0 = getrandbits(<span class="number">480</span>)</span><br><span class="line">            print(f0)</span><br><span class="line">            key.append(f0)</span><br><span class="line">            self._send(<span class="built_in">str</span>(<span class="built_in">pow</span>(f0 , self.e , self.n)))</span><br><span class="line">            f0 += f0 &lt;&lt; <span class="number">480</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">                self._send(<span class="string">&#x27;key&#x27;</span>+<span class="built_in">str</span>(i+<span class="number">1</span>) + <span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">                c = <span class="built_in">int</span>(self._recv())</span><br><span class="line">                m = <span class="built_in">pow</span>(c , self.d , self.n)</span><br><span class="line">                f = m - f0</span><br><span class="line">                f %= self.n</span><br><span class="line">                key.append(f)</span><br><span class="line">            c = self.enc(key , secret)</span><br><span class="line">            self._send(<span class="string">&#x27;Thanks, here is your cipher:&#x27;</span> + <span class="built_in">str</span>(c))</span><br><span class="line">        self._send(<span class="string">b&#x27;do you know the secret?&#x27;</span>)</span><br><span class="line">        guess = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> self._recv().split(<span class="string">b&#x27; &#x27;</span>)]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(guess) == <span class="number">16</span>:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">                <span class="keyword">if</span> guess[j] != secret[j]:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">            </span><br><span class="line">                self._send(<span class="string">b&#x27;congratulations. here is your flag:&#x27;</span>)</span><br><span class="line">                self._send(flag)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._send(<span class="string">b&#x27;L1near don\&#x27;t care.&#x27;</span>)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForkedServer</span>(<span class="params">socketserver.ThreadingMixIn, socketserver.TCPServer</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">10000</span></span><br><span class="line">    server = ForkedServer((HOST, PORT), server)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server.serve_forever()</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æµç¨‹æœ‰ç‚¹é•¿, å¤§æ¦‚å°±æ˜¯éšæœºç”Ÿæˆä¸€ä¸ªå‘é‡$secret = (1,s_0,s_1,\cdots,s_{13},s_{14})$, æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯å¾—åˆ°è¿™ä¸ª</p>
<p>ä¸€å¼€å§‹ä»–ä¼šç”Ÿæˆä¸€ä¸ª$f_0$, å¹¶é€šè¿‡RSAåŠ å¯†ç„¶åç»™æˆ‘ä»¬å¯†æ–‡</p>
<p>ä¸­é—´ä»–ä¼šè®©æˆ‘ä»¬è¾“å…¥15ä¸ª$key$, ä½†æ˜¯è¿™åäº”ä¸ª$key$ä¸æ˜¯ç›´æ¥å’±ä»¬è¾“å…¥ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆçš„, ä»–ä¼šç»è¿‡ä¸€ä¸ªRSAçš„è§£å¯†</p>
<p>æœ€å$f_0$åŠ ä¸Šæˆ‘ä»¬è¾“å…¥çš„15ä¸ª$key$ä¸€èµ·ç”Ÿæˆä¸€ä¸ª$16 \cdot 40$çš„çŸ©é˜µ$M$(ä¸€ä¸ªkeyå°±ç”Ÿæˆä¸€è¡Œ)</p>
<p>ç„¶åè®¡ç®—å¯†æ–‡<br>$$<br>secret \cdot M = (c_0,c_1,\cdots,c_{38},c_{39})<br>$$<br>è¿™é‡Œå¯†æ–‡æˆ‘ä»¬æ˜¯çŸ¥é“çš„, æˆ‘ä»¬åªéœ€è¦å¼„åˆ°$M$å°±èƒ½å¾—åˆ°$secret$äº†</p>
<p>è€Œè¿™é‡Œ$M$é™¤äº†ç¬¬ä¸€è¡Œ, éƒ½æ˜¯æˆ‘ä»¬è‡ªå·±æ„é€ çš„, ä½†æ˜¯æ¯”è¾ƒéš¾æ§åˆ¶,å› ä¸ºå®é™…ä¸Šçš„keyå’Œæˆ‘ä»¬ä¼ è¿‡å»å·®ä¸€ä¸ªè§£å¯†, ä½†æ˜¯æˆ‘ä»¬æœ‰ä¸€ä¸ª$f_0$çš„å¯†æ–‡, æˆ‘ä»¬å¯ä»¥åˆ©ç”¨RSAçš„ä¹˜æ³•åŒæ€å°±æ„é€ $k\cdot f_0$, è¿™ä¸ª$k$æƒ³æ˜¯å¤šå°‘å°±æ˜¯å¤šå°‘.</p>
<p>è€Œä¸”è§‚å¯Ÿ$M$çš„ç”Ÿæˆ, æˆ‘ä»¬å‘ç°åªè¦å¾—åˆ°ç¬¬ä¸€è¡Œçš„æ‰€æœ‰æ•°, æˆ‘ä»¬å°±èƒ½è¿˜åŸå›$f_0$,  å› ä¸º$secret$çš„ç¬¬ä¸€ä¸ªå›ºå®šæ˜¯1, è€Œ$M$çš„ç¬¬ä¸€è¡Œåªæœ‰åé¢20ä¸ªæ‰æœ‰æ•°å­—, å‰é¢çš„20ä¸ªéƒ½æ˜¯0, æ‰€ä»¥æˆ‘ä»¬åªè¦è®©åé¢çš„20åˆ—é™¤äº†ç¬¬ä¸€è¡Œéƒ½æ˜¯0å°±å¯ä»¥å¾—åˆ°$f_0$äº†. è€Œä¸”, æˆ‘ä»¬å¯ä»¥ä¼ $Enc(q^if_0)$, è®©$M$çš„åé¢å‡ è¡Œçš„ç”Ÿæˆå°±æ˜¯ç¬¬ä¸€è¡Œçš„æ•°å­—å¾€å‰æ¨iä¸ª, æ‰€ä»¥æˆ‘ä»¬è®©$i=20$å°±èƒ½æ¨åˆ°åˆšå¥½åªæœ‰ç¬¬ä¸€è¡Œçš„åé¢$20$åˆ—æ˜¯æœ‰æ•°å­—çš„.</p>
<p>é‚£ä¹ˆå¤§æ¦‚çš„æ€è·¯æœ‰äº†, æ„é€ $M$, 1. å¿…é¡»å¾—å¯é€†, æ‰èƒ½æ±‚$secret$. 2. åé¢20åˆ—æ˜¯0<br>$$<br>(1,s_0,s_1,\cdots,s_{13},s_{14})<br>\begin{pmatrix}<br>0&amp;0&amp;\cdots&amp;0&amp;a_0&amp;a_1&amp;\cdots&amp;a_{19} \<br>k_{1,0}&amp;k_{1,1}&amp;\cdots&amp;k_{1,19}&amp;0&amp;0&amp;\cdots&amp;0 \<br>&amp;&amp;&amp;\cdots \<br>k_{15,0}&amp;k_{15,1}&amp;\cdots&amp;k_{15,19}&amp;0&amp;0&amp;\cdots&amp;0</p>
<p>\end{pmatrix}<br>\<br>=(c_0,c_1,\cdots,c_{19},a_0,a_1,\cdots,a_{19})<br>$$<br>æˆ‘ä»¬éœ€è¦è¿™ä¸ª$M$å¯é€†, å°±æ˜¯è¦æ»¡ç§©, å°±æ¯æ¬¡ä¼ çš„æ—¶å€™å†åŠ ä¸€ä¸ªéšæœºçš„ç³»æ•°$j$å°±è¡Œäº†, ä¹Ÿå°±æ˜¯ä¼ $Enc(jq^if_0)$</p>
<p>æ„é€ å‡ºäº†ä¸Šé¢è¿™ä¸ª, å°±èƒ½åˆ©ç”¨$a_0,\cdots,a_{19}$è¿˜åŸ$f_0$, å†ç”¨$f_0$ç”Ÿæˆæ•´ä¸ª$M$, æœ€åæ±‚ä¸ª$M^{-1}$ç®—å›$secret$å³å¯</p>
<h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> pwn</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">q = <span class="number">2</span>**<span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shiftf0</span>(<span class="params">enc_f0,i</span>):</span></span><br><span class="line">    a = <span class="number">2</span> ** <span class="number">480</span> + <span class="number">1</span> +  (i+<span class="number">1</span>) * q**<span class="number">20</span></span><br><span class="line">    <span class="keyword">return</span> ((enc_f0 * <span class="built_in">pow</span>(a,e,n)) % n)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_vec</span>(<span class="params">num , length</span>):</span></span><br><span class="line">    vec = []</span><br><span class="line">    <span class="keyword">while</span> length &gt; <span class="number">0</span>:</span><br><span class="line">        vec = [num % q] + vec</span><br><span class="line">        num //= q</span><br><span class="line">        length -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> vec</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_mat</span>(<span class="params">numlist</span>):</span></span><br><span class="line">    M =[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> numlist:</span><br><span class="line">        M.append(to_vec(i , <span class="number">40</span>))</span><br><span class="line">    <span class="keyword">return</span> M</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CON = pwn.remote(<span class="string">&#x27;172.27.176.1&#x27;</span>,<span class="number">10000</span>)</span><br><span class="line">resp = CON.recvuntil(<span class="string">&#x27;key1:\n&#x27;</span>).decode().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">n = <span class="built_in">int</span>(resp[<span class="number">0</span>])</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">enc = <span class="built_in">int</span>(resp[<span class="number">3</span>])</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14</span>):</span><br><span class="line">    CON.sendline(<span class="built_in">str</span>(shiftf0(enc,_)).encode())</span><br><span class="line">    resp = CON.recvuntil(<span class="string">&#x27;key1:\n&#x27;</span>).decode()</span><br><span class="line">    print(_,resp)</span><br><span class="line">CON.sendline(<span class="built_in">str</span>(shiftf0(enc,_+<span class="number">1</span>)).encode())</span><br><span class="line">resp = CON.recvuntil(<span class="string">&#x27;key2:\n&#x27;</span>).decode().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_res = resp[<span class="number">0</span>][<span class="number">29</span>:-<span class="number">1</span>].split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">res =[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> _res:</span><br><span class="line">    res += [<span class="built_in">int</span>(i)]</span><br><span class="line">f0 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res[-<span class="number">20</span>:]:</span><br><span class="line">    f0 += i</span><br><span class="line">    f0 = f0 &lt;&lt; <span class="number">24</span></span><br><span class="line">f0 = f0 &gt;&gt; <span class="number">24</span></span><br><span class="line">key = [f0]+ [((i+<span class="number">1</span>)* q**<span class="number">20</span>  * f0 ) % n <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>)]</span><br><span class="line">M = matrix(Zmod(q),to_mat(key))</span><br><span class="line">print(M.solve_left(vector(res)))</span><br></pre></td></tr></table></figure>


        </div></article>
      <nav class="pagination"><a class="prev" href="/page/5/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text">Prev</span>
      </a>
    <a class="next" href="/page/7/">
        <span class="next-text">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></section></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
        <a target="_blank" rel="noopener" href="https://github.com/tearsjin" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2020 - 2022<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">K1rit0</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
