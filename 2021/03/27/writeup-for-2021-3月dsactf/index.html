<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="writeup for 2021 3月dsactf"/><meta name="keywords" content="Crypto, NTRU, Stream, K1rit0's Blog" /><link rel="alternate" href="/atom.xml" title="K1rit0's Blog" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="http://tearsjin.github.io/2021/03/27/writeup-for-2021-3月dsactf/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" /><script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":true};
</script>

    <title>writeup for 2021 3月dsactf - K1rit0's Blog</title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">K1rit0's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archives
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">K1rit0's Blog</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            Categories
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            About
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">writeup for 2021 3月dsactf
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2021-03-27
        </span><span class="post-category">
            <a href="/categories/WriteUp/">WriteUp</a>
            </span>
        </div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-crypto-threshold"><span class="toc-text">0x00 crypto_threshold</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#problem"><span class="toc-text">problem</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#analyses"><span class="toc-text">analyses</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exp"><span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-FeedBack"><span class="toc-text">0x01 FeedBack</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#problem-1"><span class="toc-text">problem</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#analyses-1"><span class="toc-text">analyses</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exp-1"><span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-son-of-NTRU"><span class="toc-text">0x02 son_of_NTRU</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#problem-2"><span class="toc-text">problem</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#analyses-2"><span class="toc-text">analyses</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exp-2"><span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-threshold"><span class="toc-text">0x03 threshold</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#problem-3"><span class="toc-text">problem</span></a></li></ol></li></ol>
    </div>
  </div><div class="post-content"><blockquote>
<p>orz 还是太菜了，这个比赛密码都被A穿了，我还是做不出NTRU，师傅们都说简单，多项式杀我<br>还是详细记录一下吧，加油</p>
</blockquote>
<h1 id="0x00-crypto-threshold"><a href="#0x00-crypto-threshold" class="headerlink" title="0x00 crypto_threshold"></a>0x00 crypto_threshold</h1><blockquote>
<p>是签到没错了。。。</p>
</blockquote>
<h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lcg</span>(<span class="params">seed,params</span>):</span></span><br><span class="line">    (m,c,n)=params</span><br><span class="line">    s = seed % n</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        s = (m * s + c) % n</span><br><span class="line">        <span class="keyword">yield</span> s</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">seed = getPrime(<span class="number">128</span>)</span><br><span class="line">m = getPrime(<span class="number">128</span>)</span><br><span class="line">c = getPrime(<span class="number">128</span>)</span><br><span class="line">n = getPrime(<span class="number">129</span>)</span><br><span class="line"></span><br><span class="line">print(m,c,n)</span><br><span class="line">key_stream = lcg(seed,(m,c,n))</span><br><span class="line">num=[]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">	num.append(<span class="built_in">next</span>(key_stream))</span><br><span class="line">	</span><br><span class="line">print(num)</span><br><span class="line">secret =  <span class="built_in">next</span>(key_stream)</span><br><span class="line"></span><br><span class="line">e = nextprime(secret)</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_lambda = ((p-<span class="number">1</span>)*(q-<span class="number">1</span>)) / gcd(p-<span class="number">1</span>,q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">flag = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(_lambda)</span><br><span class="line">print(p*q)</span><br><span class="line">print(<span class="built_in">pow</span>(flag,e,p*q))</span><br><span class="line">        </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># data</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="analyses"><a href="#analyses" class="headerlink" title="analyses"></a>analyses</h2><p>条件全给的LCG，直接往下推就好了。<br>$\lambda$RSA, 直接求逆就是私钥了</p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lcg</span>(<span class="params">seed, params</span>):</span></span><br><span class="line">    (m, c, n) = params</span><br><span class="line">    s = seed % n</span><br><span class="line">    <span class="keyword">return</span> (m * s + c) % n</span><br><span class="line"></span><br><span class="line">m, c, n = (<span class="number">315926151576125492949520250047736865439</span>, <span class="number">204423972944032372640132172728460755543</span>,</span><br><span class="line">           <span class="number">375402477603617093440157245062608289367</span>)</span><br><span class="line">seed = <span class="number">287868671713011127830359814204794790287</span></span><br><span class="line">e = nextprime(lcg(seed, (m, c, n)))</span><br><span class="line">_lambda = </span><br><span class="line">d = invert(e, lam)</span><br><span class="line">n = </span><br><span class="line">c = </span><br><span class="line">print(long_to_bytes(<span class="built_in">pow</span>(c, d, n)))</span><br></pre></td></tr></table></figure>

<h1 id="0x01-FeedBack"><a href="#0x01-FeedBack" class="headerlink" title="0x01 FeedBack"></a>0x01 FeedBack</h1><blockquote>
<p>流密码的路子，再熟悉不过了</p>
</blockquote>
<h2 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> hexdigits</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cycle</span>(<span class="params">c:<span class="built_in">list</span>,a:<span class="built_in">list</span></span>)-&gt;int:</span></span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x,y: x+y,<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x[<span class="number">0</span>]*x[<span class="number">1</span>],<span class="built_in">zip</span>(c,a))) </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">m:<span class="built_in">list</span>,k:<span class="built_in">list</span></span>)-&gt;list:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(k)*<span class="number">2</span>):</span><br><span class="line">        m.append(cycle(m[i:i+<span class="built_in">len</span>(k)],k))</span><br><span class="line">    <span class="keyword">return</span> m[<span class="built_in">len</span>(k):]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    key=[<span class="built_in">ord</span>(random.choice(hexdigits)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag))]</span><br><span class="line">    c=enc(<span class="built_in">list</span>(flag),key)</span><br><span class="line">    print(c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># data</span></span><br></pre></td></tr></table></figure>

<h2 id="analyses-1"><a href="#analyses-1" class="headerlink" title="analyses"></a>analyses</h2><p>简单说一下整个过程吧，key和flag的长度都是27这个仔细点看应该就可以看出来了.<br>记$key = (k_0,k_1,\cdots,k_{26}),flag = (m_0,m_1,\cdots,m_{26})$<br>这里的加密其实就是计算$m_{n+1}$然后放在最后面<br>$$<br>m_{n+1} =m_nk_{26} + m_{n-1}k_{25}+\cdots +m_{n-26}k_0<br>$$<br>再来看看条件，题目给了$m_{27},m_{28},\cdots,m_{80}$一共54个。写成矩阵就知道这54个能干什么大事情了<br>$$<br>\begin{pmatrix}<br>m_{27}&amp;m_{28}&amp;\cdots&amp;m_{53} \\<br>m_{28}&amp;m_{29}&amp;\cdots&amp;m_{54} \\<br>\vdots&amp;\vdots&amp;\ddots&amp;\vdots \\<br>m_{53}&amp;m_{54}&amp;\cdots&amp;m_{79}<br>\end{pmatrix}<br>\begin{pmatrix}<br>k_0 \\<br>k_1 \\<br>\vdots \\<br>k_{26}<br>\end{pmatrix}<br>=<br>\begin{pmatrix}<br>m_{54} \\<br>m_{55} \\<br>\vdots \\<br>m_{80}<br>\end{pmatrix}<br>$$<br>所以这54个m已经可以解出全部的$key$了</p>
<p>解出27个$key$以后，就是题目所说的<code>feedback</code>了， 我们知道，前27个$m$计算下一个$m$，而$m_{53} = m_{52}k_{26}+\cdots+m_{26}k_0$, 可以看到这个式子里， 我们只有$m_{26}$不知道，直接解方程或者爆破都可以解出来。解出$m_{26}$就可以按着这个思路一路往回解，直到解出全部$m$。</p>
<h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sagemath</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cycle</span>(<span class="params">c,a</span>):</span></span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x,y: x+y,<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x[<span class="number">0</span>]*x[<span class="number">1</span>],<span class="built_in">zip</span>(c,a))) </span><br><span class="line"></span><br><span class="line">c = [...]</span><br><span class="line">A = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>):</span><br><span class="line">    v = c[i:i+<span class="number">27</span>]</span><br><span class="line">    A.append(v)</span><br><span class="line">s = vector(c[<span class="number">27</span>:])</span><br><span class="line">A = Matrix(A)</span><br><span class="line">a = A.solve_left(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = c[:<span class="number">27</span>]</span><br><span class="line">m = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xff</span>):</span><br><span class="line">        res = cycle([i] + c[:-<span class="number">1</span>],a)</span><br><span class="line">        <span class="keyword">if</span> res == c[-<span class="number">1</span>]:</span><br><span class="line">            c = [i] + c[:-<span class="number">1</span>]</span><br><span class="line">            m.append(<span class="built_in">chr</span>(i))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.join(m[::-<span class="number">1</span>])        </span><br></pre></td></tr></table></figure>

<h1 id="0x02-son-of-NTRU"><a href="#0x02-son-of-NTRU" class="headerlink" title="0x02 son_of_NTRU"></a>0x02 son_of_NTRU</h1><blockquote>
<p>做过一样的题了，那道题还是我格的启蒙，怎么会忘呢<br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7163">https://xz.aliyun.com/t/7163</a> - 从一道CTF题初探NTRU格密码</p>
</blockquote>
<h2 id="problem-2"><a href="#problem-2" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /bin/bash/env python3</span></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        a,b = b,a%b</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span>():</span></span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = randrange(<span class="number">1</span>,(p//<span class="number">2</span>)**(<span class="number">0.5</span>))</span><br><span class="line">        g = randrange((p//<span class="number">4</span>)**(<span class="number">0.5</span>),(p//<span class="number">2</span>)**(<span class="number">0.5</span>))</span><br><span class="line">        <span class="keyword">if</span> gcd(f,p)==<span class="number">1</span> <span class="keyword">and</span> gcd(f,g)==<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    h = (invert(f,p)*g)%p</span><br><span class="line">    <span class="keyword">return</span> h,p,f,g</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">m,h,p</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> m&lt;(p//<span class="number">4</span>)**(<span class="number">0.5</span>)</span><br><span class="line">    r = randrange(<span class="number">1</span>,(p//<span class="number">2</span>)**(<span class="number">0.5</span>))</span><br><span class="line">    c = (r*h+m)%p</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">h,p,f,g = generate()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line">c = encrypt(bytes_to_long(flag),h,p)</span><br><span class="line">print(<span class="string">&quot;h = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(h))</span><br><span class="line">print(<span class="string">&quot;p = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(p))</span><br><span class="line">print(<span class="string">&quot;c = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(c))</span><br><span class="line"><span class="comment"># h = 70851272226599856513658616506718804769182611213413854493145253337330709939355936692154199813179587933065165812259913249917314725765898812249062834111179900151466610356207921771928832591335738750053453046857602342378475278876652263044722419918958361163645152112020971804267503129035439011008349349624213734004</span></span><br><span class="line"><span class="comment"># p = 125796773654949906956757901514929172896506715196511121353157781851652093811702246079116208920427110231653664239838444378725001877052652056537732732266407477191221775698956008368755461680533430353707546171814962217736494341129233572423073286387554056407408816555382448824610216634458550949715062229816683685469</span></span><br><span class="line"><span class="comment"># c = 4691517945653877981376957637565364382959972087952249273292897076221178958350355396910942555879426136128610896883898318646711419768716904972164508407035668258209226498292327845169861395205212789741065517685193351416871631112431257858097798333893494180621728198734264288028849543413123321402664789239712408700</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="analyses-2"><a href="#analyses-2" class="headerlink" title="analyses"></a>analyses</h2><p>不多说了，前面说的那个blog说的超级清楚。这道题在生成参数的时候给了一大堆条件就是为了在格基规约的时候能够把$f$和$g$规约出来。还有！那个同余式要参数够小才能模$g$约去随机数$r$。</p>
<h2 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes <span class="keyword">as</span> l2b</span><br><span class="line">h = <span class="number">70851272226599856513658616506718804769182611213413854493145253337330709939355936692154199813179587933065165812259913249917314725765898812249062834111179900151466610356207921771928832591335738750053453046857602342378475278876652263044722419918958361163645152112020971804267503129035439011008349349624213734004</span></span><br><span class="line">p = <span class="number">125796773654949906956757901514929172896506715196511121353157781851652093811702246079116208920427110231653664239838444378725001877052652056537732732266407477191221775698956008368755461680533430353707546171814962217736494341129233572423073286387554056407408816555382448824610216634458550949715062229816683685469</span></span><br><span class="line">c = <span class="number">4691517945653877981376957637565364382959972087952249273292897076221178958350355396910942555879426136128610896883898318646711419768716904972164508407035668258209226498292327845169861395205212789741065517685193351416871631112431257858097798333893494180621728198734264288028849543413123321402664789239712408700</span></span><br><span class="line"></span><br><span class="line">v1 = vector([<span class="number">1</span>,h])</span><br><span class="line">v2 = vector([<span class="number">0</span>,p])</span><br><span class="line">f,g = Matrix([v1,v2]).LLL()[<span class="number">0</span>]</span><br><span class="line">f,g = <span class="built_in">abs</span>(f),<span class="built_in">abs</span>(g)</span><br><span class="line">d = <span class="built_in">int</span>(inverse_mod(f,g))</span><br><span class="line">x = <span class="built_in">int</span>((c * f) % p %g )</span><br><span class="line">l2b((x * d)%g)</span><br></pre></td></tr></table></figure>

<h1 id="0x03-threshold"><a href="#0x03-threshold" class="headerlink" title="0x03 threshold"></a>0x03 threshold</h1><blockquote>
<p>真正的NTRU，我太菜了不知道多项式要怎么处理，去dawn_wispher爷爷的Blog学习一下，学会了再来更新<br>3/29 俺回来了, 俺学会了, 不过这边只扔一波脚本, 具体原理可以去看我的另外一篇<a href="">Translation of LatticeHacks</a></p>
</blockquote>
<h2 id="problem-3"><a href="#problem-3" class="headerlink" title="problem"></a>problem</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#make.sage</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">flag = <span class="built_in">bytearray</span>(<span class="string">&quot;DASCTF&#123;********************************&#125;&quot;</span>.encode())</span><br><span class="line">flag = <span class="built_in">list</span>(flag)</span><br><span class="line">length = <span class="built_in">len</span>(flag)</span><br><span class="line">N=<span class="number">53</span></span><br><span class="line">p=<span class="number">257</span></span><br><span class="line">q=<span class="number">28019</span></span><br><span class="line">d=<span class="number">18</span></span><br><span class="line">f=[<span class="number">1</span>]*<span class="number">19</span>+[-<span class="number">1</span>]*<span class="number">18</span>+[<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">random.shuffle(f)</span><br><span class="line">g=[<span class="number">1</span>]*<span class="number">18</span>+[-<span class="number">1</span>]*<span class="number">18</span>+[<span class="number">0</span>]*<span class="number">17</span></span><br><span class="line">random.shuffle(g)</span><br><span class="line"></span><br><span class="line">Q.&lt;x&gt; = Zmod(q)[]</span><br><span class="line">P.&lt;y&gt; = Zmod(p)[]</span><br><span class="line">fx=Q(f)</span><br><span class="line">fy=P(f)</span><br><span class="line">gx=Q(g)</span><br><span class="line">Fqx=fx.inverse_mod(x^N-<span class="number">1</span>)</span><br><span class="line">Fpy=fy.inverse_mod(y^N-<span class="number">1</span>)</span><br><span class="line">hx=(Fqx*gx).mod(x^N-<span class="number">1</span>)</span><br><span class="line">r=[<span class="number">1</span>]*<span class="number">10</span>+[-<span class="number">1</span>]*<span class="number">22</span>+[<span class="number">0</span>]*<span class="number">21</span></span><br><span class="line">random.shuffle(r)</span><br><span class="line">rx=Q(r)</span><br><span class="line">mx=Q(flag)</span><br><span class="line">ex=(p*rx*hx+mx).mod(x^N-<span class="number">1</span>)</span><br><span class="line">print(ex)</span><br><span class="line">print(hx)</span><br><span class="line"></span><br><span class="line"><span class="comment">#7367*x^52 + 24215*x^51 + 5438*x^50 + 7552*x^49 + 22666*x^48 + 21907*x^47 + 10572*x^46 + 19756*x^45 + 4083*x^44 + 22080*x^43 + 1757*x^42 + 5708*x^41 + 22838*x^40 + 4022*x^39 + 9239*x^38 + 1949*x^37 + 27073*x^36 + 8192*x^35 + 955*x^34 + 4373*x^33 + 17877*x^32 + 25592*x^31 + 13535*x^30 + 185*x^29 + 9471*x^28 + 9793*x^27 + 22637*x^26 + 3293*x^25 + 27047*x^24 + 21985*x^23 + 13584*x^22 + 6809*x^21 + 24770*x^20 + 16964*x^19 + 8866*x^18 + 22102*x^17 + 18006*x^16 + 3198*x^15 + 19024*x^14 + 2777*x^13 + 9252*x^12 + 9684*x^11 + 3604*x^10 + 7840*x^9 + 17573*x^8 + 11382*x^7 + 12726*x^6 + 6811*x^5 + 10104*x^4 + 7485*x^3 + 858*x^2 + 15100*x + 15860</span></span><br><span class="line"><span class="comment">#14443*x^52 + 10616*x^51 + 11177*x^50 + 24769*x^49 + 23510*x^48 + 23059*x^47 + 21848*x^46 + 24145*x^45 + 12420*x^44 + 1976*x^43 + 16947*x^42 + 7373*x^41 + 16708*x^40 + 18435*x^39 + 18561*x^38 + 21557*x^37 + 16115*x^36 + 7873*x^35 + 20005*x^34 + 11543*x^33 + 9488*x^32 + 2865*x^31 + 11797*x^30 + 2961*x^29 + 14944*x^28 + 22631*x^27 + 24061*x^26 + 9792*x^25 + 6791*x^24 + 10423*x^23 + 3534*x^22 + 26233*x^21 + 14223*x^20 + 15555*x^19 + 3381*x^18 + 23641*x^17 + 2697*x^16 + 11303*x^15 + 6030*x^14 + 7355*x^13 + 20693*x^12 + 1768*x^11 + 10059*x^10 + 27822*x^9 + 8150*x^8 + 5458*x^7 + 21270*x^6 + 22651*x^5 + 8381*x^4 + 2819*x^3 + 3987*x^2 + 8610*x + 6022</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


      </div>
      <div class="post-copyright">
    <p class="copyright-item">
      <span>Author: </span>
      <a href="http://tearsjin.github.io">K1rit0</a>
    </p>
    <p class="copyright-item">
      <span>Link: </span>
      <a href="http://tearsjin.github.io/2021/03/27/writeup-for-2021-3%E6%9C%88dsactf/">http://tearsjin.github.io/2021/03/27/writeup-for-2021-3%E6%9C%88dsactf/</a>
    </p>
    <p class="copyright-item">
      <span>License: </span><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>
      <footer class="post-footer">
        <div class="post-tags">
            <a href="/tags/Crypto/">Crypto</a>
            <a href="/tags/NTRU/">NTRU</a>
            <a href="/tags/Stream/">Stream</a>
            </div>
        
        <nav class="post-nav"><a class="prev" href="/2021/03/28/Translation-of-LatticeHacks/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Translation of LatticeHacks</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    <a class="next" href="/2021/03/25/Reading-notes-An-Introduction-to-Lenstra-Lenstra-Lovasz-Lattice-Basis-Reduction-Algorithm/">
        <span class="next-text nav-default">Reading notes An Introduction to Lenstra-Lenstra-Lovasz Lattice Basis Reduction Algorithm</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
        <a target="_blank" rel="noopener" href="https://github.com/tearsjin" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2020 - 2021<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">K1rit0</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
